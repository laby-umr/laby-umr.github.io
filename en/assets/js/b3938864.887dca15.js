"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["325"],{44492:function(n,e,r){r.r(e),r.d(e,{metadata:()=>s,default:()=>h,frontMatter:()=>t,contentTitle:()=>a,toc:()=>c,assets:()=>d});var s=JSON.parse('{"id":"backend/database-orm/mongodb","title":"MongoDB\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3MongoDB\u6838\u5FC3\u7279\u6027\u3001\u67B6\u6784\u8BBE\u8BA1\u4E0ESpring Boot\u96C6\u6210","source":"@site/docs/backend/database-orm/mongodb.mdx","sourceDirName":"backend/database-orm","slug":"/backend/database-orm/mongodb","permalink":"/en/docs/backend/database-orm/mongodb","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/database-orm/mongodb.mdx","tags":[{"inline":true,"label":"MongoDB","permalink":"/en/docs/tags/mongo-db"},{"inline":true,"label":"NoSQL","permalink":"/en/docs/tags/no-sql"},{"inline":true,"label":"\u6587\u6863\u6570\u636E\u5E93","permalink":"/en/docs/tags/\u6587\u6863\u6570\u636E\u5E93"},{"inline":true,"label":"\u5206\u5E03\u5F0F\u6570\u636E\u5E93","permalink":"/en/docs/tags/\u5206\u5E03\u5F0F\u6570\u636E\u5E93"},{"inline":true,"label":"Spring Data","permalink":"/en/docs/tags/spring-data"}],"version":"current","lastUpdatedBy":"Laby","lastUpdatedAt":1756771200000,"sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"MongoDB\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3MongoDB\u6838\u5FC3\u7279\u6027\u3001\u67B6\u6784\u8BBE\u8BA1\u4E0ESpring Boot\u96C6\u6210","authors":["Laby"],"tags":["MongoDB","NoSQL","\u6587\u6863\u6570\u636E\u5E93","\u5206\u5E03\u5F0F\u6570\u636E\u5E93","Spring Data"],"last_update":{"date":"2025-09-02T00:00:00.000Z","author":"Laby"}},"sidebar":"tutorialSidebar","previous":{"title":"JPA\u8BE6\u89E3","permalink":"/en/docs/backend/database-orm/jpa"},"next":{"title":"MyBatis\u6846\u67B6\u8BE6\u89E3","permalink":"/en/docs/backend/database-orm/mybatis"}}'),i=r(74848),l=r(28453);r(78010),r(57250),r(25591);let t={sidebar_position:6,title:"MongoDB\u8BE6\u89E3",description:"\u6DF1\u5165\u7406\u89E3MongoDB\u6838\u5FC3\u7279\u6027\u3001\u67B6\u6784\u8BBE\u8BA1\u4E0ESpring Boot\u96C6\u6210",authors:["Laby"],tags:["MongoDB","NoSQL","\u6587\u6863\u6570\u636E\u5E93","\u5206\u5E03\u5F0F\u6570\u636E\u5E93","Spring Data"],last_update:{date:new Date("2025-09-02T00:00:00.000Z"),author:"Laby"}},a="MongoDB\u8BE6\u89E3",d={},c=[{value:"1. MongoDB\u57FA\u7840\u4E0E\u6838\u5FC3\u6982\u5FF5",id:"1-mongodb\u57FA\u7840\u4E0E\u6838\u5FC3\u6982\u5FF5",level:2},{value:"1.1 MongoDB\u67B6\u6784\u6982\u89C8",id:"11-mongodb\u67B6\u6784\u6982\u89C8",level:3},{value:"1.1.1 \u57FA\u672C\u672F\u8BED\u5BF9\u6BD4",id:"111-\u57FA\u672C\u672F\u8BED\u5BF9\u6BD4",level:4},{value:"1.2 \u6587\u6863\u6A21\u578B\u8BE6\u89E3",id:"12-\u6587\u6863\u6A21\u578B\u8BE6\u89E3",level:3},{value:"1.2.1 BSON\u683C\u5F0F",id:"121-bson\u683C\u5F0F",level:4},{value:"1.2.2 \u6587\u6863\u5927\u5C0F\u9650\u5236",id:"122-\u6587\u6863\u5927\u5C0F\u9650\u5236",level:4},{value:"1.2.3 _id\u5B57\u6BB5",id:"123-_id\u5B57\u6BB5",level:4},{value:"1.3 \u6570\u636E\u5E93\u64CD\u4F5C\u57FA\u7840",id:"13-\u6570\u636E\u5E93\u64CD\u4F5C\u57FA\u7840",level:3},{value:"1.3.1 \u521B\u5EFA\u6570\u636E\u5E93\u548C\u96C6\u5408",id:"131-\u521B\u5EFA\u6570\u636E\u5E93\u548C\u96C6\u5408",level:4},{value:"1.3.2 \u57FA\u672CCRUD\u64CD\u4F5C",id:"132-\u57FA\u672Ccrud\u64CD\u4F5C",level:4},{value:"1.3.3 \u67E5\u8BE2\u64CD\u4F5C\u7B26",id:"133-\u67E5\u8BE2\u64CD\u4F5C\u7B26",level:4},{value:"1.4 \u7D22\u5F15\u4E0E\u6027\u80FD",id:"14-\u7D22\u5F15\u4E0E\u6027\u80FD",level:3},{value:"1.4.1 \u7D22\u5F15\u7C7B\u578B",id:"141-\u7D22\u5F15\u7C7B\u578B",level:4},{value:"1.4.2 \u7D22\u5F15\u5C5E\u6027",id:"142-\u7D22\u5F15\u5C5E\u6027",level:4},{value:"1.4.3 \u67E5\u770B\u548C\u7BA1\u7406\u7D22\u5F15",id:"143-\u67E5\u770B\u548C\u7BA1\u7406\u7D22\u5F15",level:4},{value:"1.5 \u805A\u5408\u6846\u67B6",id:"15-\u805A\u5408\u6846\u67B6",level:3},{value:"1.5.1 \u57FA\u672C\u805A\u5408\u7BA1\u9053",id:"151-\u57FA\u672C\u805A\u5408\u7BA1\u9053",level:4},{value:"1.5.2 \u5E38\u7528\u805A\u5408\u64CD\u4F5C\u7B26",id:"152-\u5E38\u7528\u805A\u5408\u64CD\u4F5C\u7B26",level:4},{value:"1.5.3 \u805A\u5408\u8868\u8FBE\u5F0F",id:"153-\u805A\u5408\u8868\u8FBE\u5F0F",level:4},{value:"2. MongoDB\u9AD8\u7EA7\u6570\u636E\u5EFA\u6A21",id:"2-mongodb\u9AD8\u7EA7\u6570\u636E\u5EFA\u6A21",level:2},{value:"2.1 \u6570\u636E\u5EFA\u6A21\u7B56\u7565",id:"21-\u6570\u636E\u5EFA\u6A21\u7B56\u7565",level:3},{value:"2.1.1 \u5D4C\u5165\u5F0F\u6587\u6863 vs. \u5F15\u7528\u5173\u7CFB",id:"211-\u5D4C\u5165\u5F0F\u6587\u6863-vs-\u5F15\u7528\u5173\u7CFB",level:4},{value:"2.1.2 \u6A21\u5F0F\u8BBE\u8BA1\u6A21\u5F0F",id:"212-\u6A21\u5F0F\u8BBE\u8BA1\u6A21\u5F0F",level:4},{value:"2.2 \u590D\u6742\u5173\u7CFB\u5EFA\u6A21\u793A\u4F8B",id:"22-\u590D\u6742\u5173\u7CFB\u5EFA\u6A21\u793A\u4F8B",level:3},{value:"2.2.1 \u7535\u5B50\u5546\u52A1\u7CFB\u7EDF\u5EFA\u6A21",id:"221-\u7535\u5B50\u5546\u52A1\u7CFB\u7EDF\u5EFA\u6A21",level:4},{value:"2.2.2 \u793E\u4EA4\u7F51\u7EDC\u5EFA\u6A21",id:"222-\u793E\u4EA4\u7F51\u7EDC\u5EFA\u6A21",level:4},{value:"2.3 \u6A21\u5F0F\u9A8C\u8BC1",id:"23-\u6A21\u5F0F\u9A8C\u8BC1",level:3},{value:"2.4 \u6570\u636E\u4E00\u81F4\u6027\u4E0E\u4E8B\u52A1",id:"24-\u6570\u636E\u4E00\u81F4\u6027\u4E0E\u4E8B\u52A1",level:3},{value:"2.4.1 \u539F\u5B50\u6027\u64CD\u4F5C",id:"241-\u539F\u5B50\u6027\u64CD\u4F5C",level:4},{value:"2.4.2 \u591A\u6587\u6863\u4E8B\u52A1",id:"242-\u591A\u6587\u6863\u4E8B\u52A1",level:4},{value:"2.4.3 \u53CC\u5199\u5173\u6CE8",id:"243-\u53CC\u5199\u5173\u6CE8",level:4},{value:"3. MongoDB\u9AD8\u7EA7\u7279\u6027\u4E0E\u4F01\u4E1A\u529F\u80FD",id:"3-mongodb\u9AD8\u7EA7\u7279\u6027\u4E0E\u4F01\u4E1A\u529F\u80FD",level:2},{value:"3.1 \u590D\u5236\u96C6",id:"31-\u590D\u5236\u96C6",level:3},{value:"3.1.1 \u590D\u5236\u96C6\u67B6\u6784",id:"311-\u590D\u5236\u96C6\u67B6\u6784",level:4},{value:"3.1.2 \u590D\u5236\u96C6\u914D\u7F6E",id:"312-\u590D\u5236\u96C6\u914D\u7F6E",level:4},{value:"3.1.3 \u590D\u5236\u96C6\u8BFB\u5199\u5206\u79BB",id:"313-\u590D\u5236\u96C6\u8BFB\u5199\u5206\u79BB",level:4},{value:"3.2 \u5206\u7247\u96C6\u7FA4",id:"32-\u5206\u7247\u96C6\u7FA4",level:3},{value:"3.2.1 \u5206\u7247\u96C6\u7FA4\u67B6\u6784",id:"321-\u5206\u7247\u96C6\u7FA4\u67B6\u6784",level:4},{value:"3.2.2 \u5206\u7247\u7B56\u7565",id:"322-\u5206\u7247\u7B56\u7565",level:4},{value:"3.2.3 \u5206\u7247\u952E\u9009\u62E9",id:"323-\u5206\u7247\u952E\u9009\u62E9",level:4},{value:"3.2.4 \u533A\u57DF\u5206\u7247",id:"324-\u533A\u57DF\u5206\u7247",level:4},{value:"3.3 \u9AD8\u7EA7\u67E5\u8BE2\u529F\u80FD",id:"33-\u9AD8\u7EA7\u67E5\u8BE2\u529F\u80FD",level:3},{value:"3.3.1 Change Streams",id:"331-change-streams",level:4},{value:"3.3.2 \u5730\u7406\u7A7A\u95F4\u67E5\u8BE2",id:"332-\u5730\u7406\u7A7A\u95F4\u67E5\u8BE2",level:4},{value:"3.3.3 \u5168\u6587\u641C\u7D22",id:"333-\u5168\u6587\u641C\u7D22",level:4},{value:"3.3.4 \u56FE\u8868\u67E5\u8BE2",id:"334-\u56FE\u8868\u67E5\u8BE2",level:4},{value:"3.4 \u5B89\u5168\u6027\u4E0E\u5BA1\u8BA1",id:"34-\u5B89\u5168\u6027\u4E0E\u5BA1\u8BA1",level:3},{value:"3.4.1 \u8BA4\u8BC1\u4E0E\u6388\u6743",id:"341-\u8BA4\u8BC1\u4E0E\u6388\u6743",level:4},{value:"3.4.2 TLS/SSL\u52A0\u5BC6",id:"342-tlsssl\u52A0\u5BC6",level:4},{value:"3.4.3 \u5B57\u6BB5\u7EA7\u52A0\u5BC6",id:"343-\u5B57\u6BB5\u7EA7\u52A0\u5BC6",level:4},{value:"3.4.4 \u5BA1\u8BA1",id:"344-\u5BA1\u8BA1",level:4},{value:"3.5 \u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7",id:"35-\u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7",level:3},{value:"3.5.1 \u67E5\u8BE2\u4F18\u5316",id:"351-\u67E5\u8BE2\u4F18\u5316",level:4},{value:"3.5.2 \u7D22\u5F15\u4F18\u5316",id:"352-\u7D22\u5F15\u4F18\u5316",level:4},{value:"3.5.3 MongoDB Compass",id:"353-mongodb-compass",level:4},{value:"3.5.4 MongoDB Atlas\u76D1\u63A7",id:"354-mongodb-atlas\u76D1\u63A7",level:4},{value:"4. Spring Boot\u4E0EMongoDB\u96C6\u6210\u6700\u4F73\u5B9E\u8DF5",id:"4-spring-boot\u4E0Emongodb\u96C6\u6210\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"4.1 \u914D\u7F6EMongoDB\u8FDE\u63A5",id:"41-\u914D\u7F6Emongodb\u8FDE\u63A5",level:3},{value:"4.1.1 \u6DFB\u52A0\u4F9D\u8D56",id:"411-\u6DFB\u52A0\u4F9D\u8D56",level:4},{value:"4.1.2 \u914D\u7F6E\u8FDE\u63A5",id:"412-\u914D\u7F6E\u8FDE\u63A5",level:4},{value:"4.2 \u5B9A\u4E49\u6587\u6863\u6620\u5C04",id:"42-\u5B9A\u4E49\u6587\u6863\u6620\u5C04",level:3},{value:"4.2.1 \u57FA\u672C\u6587\u6863\u6620\u5C04",id:"421-\u57FA\u672C\u6587\u6863\u6620\u5C04",level:4},{value:"4.2.2 \u7D22\u5F15\u914D\u7F6E",id:"422-\u7D22\u5F15\u914D\u7F6E",level:4},{value:"4.2.3 \u5D4C\u5165\u5F0F\u6587\u6863",id:"423-\u5D4C\u5165\u5F0F\u6587\u6863",level:4},{value:"4.2.4 DBRef\u5F15\u7528",id:"424-dbref\u5F15\u7528",level:4},{value:"4.3 \u4F7F\u7528Spring Data MongoDB Repository",id:"43-\u4F7F\u7528spring-data-mongodb-repository",level:3},{value:"4.3.1 \u57FA\u672CRepository\u63A5\u53E3",id:"431-\u57FA\u672Crepository\u63A5\u53E3",level:4},{value:"4.3.2 \u81EA\u5B9A\u4E49\u67E5\u8BE2\u65B9\u6CD5",id:"432-\u81EA\u5B9A\u4E49\u67E5\u8BE2\u65B9\u6CD5",level:4},{value:"4.3.3 \u4F7F\u7528@Query\u6CE8\u89E3",id:"433-\u4F7F\u7528query\u6CE8\u89E3",level:4},{value:"4.3.4 \u5206\u9875\u4E0E\u6392\u5E8F",id:"434-\u5206\u9875\u4E0E\u6392\u5E8F",level:4},{value:"4.4 \u4F7F\u7528MongoTemplate\u8FDB\u884C\u9AD8\u7EA7\u64CD\u4F5C",id:"44-\u4F7F\u7528mongotemplate\u8FDB\u884C\u9AD8\u7EA7\u64CD\u4F5C",level:3},{value:"4.5 \u4E8B\u52A1\u7BA1\u7406",id:"45-\u4E8B\u52A1\u7BA1\u7406",level:3},{value:"4.5.1 \u914D\u7F6E\u4E8B\u52A1\u7BA1\u7406\u5668",id:"451-\u914D\u7F6E\u4E8B\u52A1\u7BA1\u7406\u5668",level:4},{value:"4.5.2 \u4F7F\u7528\u58F0\u660E\u5F0F\u4E8B\u52A1",id:"452-\u4F7F\u7528\u58F0\u660E\u5F0F\u4E8B\u52A1",level:4},{value:"4.5.3 \u7F16\u7A0B\u5F0F\u4E8B\u52A1",id:"453-\u7F16\u7A0B\u5F0F\u4E8B\u52A1",level:4},{value:"5. MongoDB\u6027\u80FD\u4F18\u5316",id:"5-mongodb\u6027\u80FD\u4F18\u5316",level:2},{value:"5.1 \u786C\u4EF6\u4E0E\u7CFB\u7EDF\u4F18\u5316",id:"51-\u786C\u4EF6\u4E0E\u7CFB\u7EDF\u4F18\u5316",level:3},{value:"5.1.1 \u786C\u4EF6\u9009\u62E9",id:"511-\u786C\u4EF6\u9009\u62E9",level:4},{value:"5.1.2 \u64CD\u4F5C\u7CFB\u7EDF\u914D\u7F6E",id:"512-\u64CD\u4F5C\u7CFB\u7EDF\u914D\u7F6E",level:4},{value:"5.2 MongoDB\u5B9E\u4F8B\u4F18\u5316",id:"52-mongodb\u5B9E\u4F8B\u4F18\u5316",level:3},{value:"5.2.1 \u5173\u952E\u914D\u7F6E\u53C2\u6570",id:"521-\u5173\u952E\u914D\u7F6E\u53C2\u6570",level:4},{value:"5.2.2 \u5206\u6790\u4E0E\u8C03\u4F18\u5DE5\u5177",id:"522-\u5206\u6790\u4E0E\u8C03\u4F18\u5DE5\u5177",level:4},{value:"5.3 \u6570\u636E\u6A21\u578B\u4E0E\u7D22\u5F15\u4F18\u5316",id:"53-\u6570\u636E\u6A21\u578B\u4E0E\u7D22\u5F15\u4F18\u5316",level:3},{value:"5.3.1 \u6570\u636E\u6A21\u578B\u4F18\u5316",id:"531-\u6570\u636E\u6A21\u578B\u4F18\u5316",level:4},{value:"5.3.2 \u9AD8\u6548\u7D22\u5F15\u7B56\u7565",id:"532-\u9AD8\u6548\u7D22\u5F15\u7B56\u7565",level:4},{value:"5.3.3 \u5B9A\u671F\u7D22\u5F15\u7EF4\u62A4",id:"533-\u5B9A\u671F\u7D22\u5F15\u7EF4\u62A4",level:4},{value:"5.4 \u67E5\u8BE2\u4F18\u5316\u6280\u672F",id:"54-\u67E5\u8BE2\u4F18\u5316\u6280\u672F",level:3},{value:"5.4.1 \u67E5\u8BE2\u5206\u6790\u4E0E\u4F18\u5316",id:"541-\u67E5\u8BE2\u5206\u6790\u4E0E\u4F18\u5316",level:4},{value:"5.4.2 \u6295\u5F71\u4F18\u5316",id:"542-\u6295\u5F71\u4F18\u5316",level:4},{value:"5.4.3 \u6279\u91CF\u64CD\u4F5C\u4F18\u5316",id:"543-\u6279\u91CF\u64CD\u4F5C\u4F18\u5316",level:4},{value:"5.4.4 \u8BFB\u53D6\u5206\u79BB\u4E0E\u67E5\u8BE2\u8DEF\u7531",id:"544-\u8BFB\u53D6\u5206\u79BB\u4E0E\u67E5\u8BE2\u8DEF\u7531",level:4},{value:"5.5 \u9AD8\u7EA7\u6027\u80FD\u4F18\u5316\u7B56\u7565",id:"55-\u9AD8\u7EA7\u6027\u80FD\u4F18\u5316\u7B56\u7565",level:3},{value:"5.5.1 \u6570\u636E\u5206\u7247\u7B56\u7565",id:"551-\u6570\u636E\u5206\u7247\u7B56\u7565",level:4},{value:"5.5.2 \u6570\u636E\u538B\u7F29\u4E0E\u5F52\u6863",id:"552-\u6570\u636E\u538B\u7F29\u4E0E\u5F52\u6863",level:4},{value:"5.5.3 \u7F13\u5B58\u7B56\u7565",id:"553-\u7F13\u5B58\u7B56\u7565",level:4},{value:"5.5.4 Change Streams\u4E0E\u5B9E\u65F6\u76D1\u63A7",id:"554-change-streams\u4E0E\u5B9E\u65F6\u76D1\u63A7",level:4},{value:"5.6 \u6027\u80FD\u6D4B\u8BD5\u4E0E\u57FA\u51C6",id:"56-\u6027\u80FD\u6D4B\u8BD5\u4E0E\u57FA\u51C6",level:3},{value:"5.7 \u76D1\u63A7\u4E0E\u9884\u8B66",id:"57-\u76D1\u63A7\u4E0E\u9884\u8B66",level:3},{value:"6. \u6700\u4F73\u5B9E\u8DF5\u4E0E\u8BBE\u8BA1\u6A21\u5F0F",id:"6-\u6700\u4F73\u5B9E\u8DF5\u4E0E\u8BBE\u8BA1\u6A21\u5F0F",level:2},{value:"6.1 MongoDB\u67B6\u6784\u8BBE\u8BA1\u6700\u4F73\u5B9E\u8DF5",id:"61-mongodb\u67B6\u6784\u8BBE\u8BA1\u6700\u4F73\u5B9E\u8DF5",level:3},{value:"6.1.1 \u9AD8\u53EF\u7528\u6027\u8BBE\u8BA1",id:"611-\u9AD8\u53EF\u7528\u6027\u8BBE\u8BA1",level:4},{value:"6.1.2 \u5907\u4EFD\u4E0E\u6062\u590D\u7B56\u7565",id:"612-\u5907\u4EFD\u4E0E\u6062\u590D\u7B56\u7565",level:4},{value:"6.1.3 \u5B89\u5168\u6700\u4F73\u5B9E\u8DF5",id:"613-\u5B89\u5168\u6700\u4F73\u5B9E\u8DF5",level:4},{value:"6.2 \u5E38\u89C1\u5E94\u7528\u573A\u666F\u6A21\u5F0F",id:"62-\u5E38\u89C1\u5E94\u7528\u573A\u666F\u6A21\u5F0F",level:3},{value:"6.2.1 \u7269\u8054\u7F51\u6570\u636E\u7BA1\u7406",id:"621-\u7269\u8054\u7F51\u6570\u636E\u7BA1\u7406",level:4},{value:"6.2.2 \u5B9E\u65F6\u5206\u6790\u7CFB\u7EDF",id:"622-\u5B9E\u65F6\u5206\u6790\u7CFB\u7EDF",level:4},{value:"6.2.3 \u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF",id:"623-\u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF",level:4},{value:"6.2.4 \u79FB\u52A8\u5E94\u7528\u540E\u7AEF",id:"624-\u79FB\u52A8\u5E94\u7528\u540E\u7AEF",level:4},{value:"6.3 \u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848",id:"63-\u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848",level:3},{value:"6.3.1 \u6570\u636E\u4E00\u81F4\u6027\u6311\u6218",id:"631-\u6570\u636E\u4E00\u81F4\u6027\u6311\u6218",level:4},{value:"6.3.2 \u6027\u80FD\u4E0B\u964D\u6392\u67E5",id:"632-\u6027\u80FD\u4E0B\u964D\u6392\u67E5",level:4},{value:"6.3.3 \u6269\u5C55\u6027\u95EE\u9898",id:"633-\u6269\u5C55\u6027\u95EE\u9898",level:4},{value:"6.3.4 \u8FC1\u79FB\u4E0E\u7248\u672C\u5347\u7EA7",id:"634-\u8FC1\u79FB\u4E0E\u7248\u672C\u5347\u7EA7",level:4},{value:"6.4 MongoDB\u4E0E\u5176\u4ED6\u6280\u672F\u7684\u96C6\u6210",id:"64-mongodb\u4E0E\u5176\u4ED6\u6280\u672F\u7684\u96C6\u6210",level:3},{value:"6.4.1 MongoDB\u4E0E\u6D88\u606F\u961F\u5217\u96C6\u6210",id:"641-mongodb\u4E0E\u6D88\u606F\u961F\u5217\u96C6\u6210",level:4},{value:"6.4.2 MongoDB\u4E0E\u641C\u7D22\u5F15\u64CE\u96C6\u6210",id:"642-mongodb\u4E0E\u641C\u7D22\u5F15\u64CE\u96C6\u6210",level:4},{value:"6.4.3 MongoDB\u4E0E\u7F13\u5B58\u7CFB\u7EDF\u96C6\u6210",id:"643-mongodb\u4E0E\u7F13\u5B58\u7CFB\u7EDF\u96C6\u6210",level:4},{value:"6.5 \u672A\u6765\u8D8B\u52BF\u4E0E\u6280\u672F\u5C55\u671B",id:"65-\u672A\u6765\u8D8B\u52BF\u4E0E\u6280\u672F\u5C55\u671B",level:3},{value:"6.5.1 \u5206\u5E03\u5F0F\u591A\u6587\u6863ACID\u4E8B\u52A1",id:"651-\u5206\u5E03\u5F0F\u591A\u6587\u6863acid\u4E8B\u52A1",level:4},{value:"6.5.2 \u4E91\u539F\u751F\u548C\u65E0\u670D\u52A1\u5668\u6570\u636E\u5E93",id:"652-\u4E91\u539F\u751F\u548C\u65E0\u670D\u52A1\u5668\u6570\u636E\u5E93",level:4},{value:"6.5.3 AI/ML\u4E0EMongoDB",id:"653-aiml\u4E0Emongodb",level:4},{value:"6.5.4 \u5B9E\u65F6\u534F\u4F5C\u5E94\u7528",id:"654-\u5B9E\u65F6\u534F\u4F5C\u5E94\u7528",level:4}];function o(n){let e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"mongodb\u8BE6\u89E3",children:"MongoDB\u8BE6\u89E3"})}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u662F\u4E00\u6B3E\u9886\u5148\u7684\u5F00\u6E90NoSQL\u6587\u6863\u6570\u636E\u5E93\uFF0C\u4EE5\u5176\u7075\u6D3B\u7684\u6587\u6863\u6A21\u578B\u3001\u5F3A\u5927\u7684\u67E5\u8BE2\u529F\u80FD\u548C\u5353\u8D8A\u7684\u53EF\u6269\u5C55\u6027\u8457\u79F0\u3002\u4F5C\u4E3A\u73B0\u4EE3\u5E94\u7528\u5F00\u53D1\u7684\u4F18\u9009\u6570\u636E\u5B58\u50A8\u65B9\u6848\uFF0CMongoDB\u80FD\u591F\u8F7B\u677E\u5904\u7406\u6D77\u91CF\u6570\u636E\u5E76\u652F\u6301\u5206\u5E03\u5F0F\u67B6\u6784\uFF0C\u9002\u5408\u654F\u6377\u5F00\u53D1\u548C\u5FAE\u670D\u52A1\u4F53\u7CFB\u7ED3\u6784\u3002"}),"\n",(0,i.jsxs)(e.admonition,{title:"\u6838\u5FC3\u4EF7\u503C",type:"tip",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"MongoDB = \u6587\u6863\u6A21\u578B + \u7075\u6D3B\u6269\u5C55 + \u9AD8\u53EF\u7528\u6027 + \u4E30\u5BCC\u7684\u67E5\u8BE2\u8BED\u8A00"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u{1F4C4} ",(0,i.jsx)(e.strong,{children:"\u6587\u6863\u6570\u636E\u6A21\u578B"}),"\uFF1A\u7075\u6D3B\u7684JSON(BSON)\u683C\u5F0F\uFF0C\u65E0\u9700\u9884\u5B9A\u4E49\u6A21\u5F0F"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F680} ",(0,i.jsx)(e.strong,{children:"\u9AD8\u6027\u80FD"}),"\uFF1A\u5185\u5B58\u6620\u5C04\u5B58\u50A8\u5F15\u64CE\u3001\u7D22\u5F15\u652F\u6301\u3001\u805A\u5408\u6846\u67B6"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F504} ",(0,i.jsx)(e.strong,{children:"\u6A2A\u5411\u6269\u5C55"}),"\uFF1A\u539F\u751F\u5206\u7247\u652F\u6301\uFF0C\u8F7B\u677E\u5B9E\u73B0\u6570\u636E\u5E93\u96C6\u7FA4"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F4BC} ",(0,i.jsx)(e.strong,{children:"\u4F01\u4E1A\u7EA7\u529F\u80FD"}),"\uFF1A\u590D\u5236\u96C6\u3001\u4E8B\u52A1\u652F\u6301\u3001\u5B89\u5168\u8BA4\u8BC1"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F50D} ",(0,i.jsx)(e.strong,{children:"\u5F3A\u5927\u7684\u67E5\u8BE2"}),"\uFF1A\u4E30\u5BCC\u7684\u67E5\u8BE2\u8BED\u8A00\u548C\u805A\u5408\u7BA1\u9053"]}),"\n"]})]}),"\n",(0,i.jsx)(e.p,{children:"\u672C\u6587\u5C06\u6DF1\u5165\u63A2\u8BA8MongoDB\u7684\u6838\u5FC3\u6982\u5FF5\u3001\u9AD8\u7EA7\u7279\u6027\u53CA\u5176\u5728Spring Boot\u5E94\u7528\u4E2D\u7684\u6700\u4F73\u5B9E\u8DF5\uFF0C\u5E2E\u52A9\u5F00\u53D1\u8005\u6784\u5EFA\u9AD8\u6027\u80FD\u3001\u53EF\u9760\u7684\u73B0\u4EE3\u5E94\u7528\u7A0B\u5E8F\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"1-mongodb\u57FA\u7840\u4E0E\u6838\u5FC3\u6982\u5FF5",children:"1. MongoDB\u57FA\u7840\u4E0E\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u4EE5\u5176\u7075\u6D3B\u6027\u548C\u53EF\u6269\u5C55\u6027\u6539\u53D8\u4E86\u4F20\u7EDF\u7684\u6570\u636E\u5B58\u50A8\u601D\u7EF4\u65B9\u5F0F\uFF0C\u6452\u5F03\u4E86\u5173\u7CFB\u578B\u6570\u636E\u5E93\u7684\u8868\u7ED3\u6784\u8BBE\u8BA1\uFF0C\u8F6C\u800C\u91C7\u7528\u6587\u6863\u6A21\u578B\u3002\u6DF1\u5165\u7406\u89E3\u5176\u57FA\u672C\u6982\u5FF5\u662F\u9AD8\u6548\u4F7F\u7528MongoDB\u7684\u524D\u63D0\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"11-mongodb\u67B6\u6784\u6982\u89C8",children:"1.1 MongoDB\u67B6\u6784\u6982\u89C8"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7684\u6574\u4F53\u67B6\u6784\u7531\u4EE5\u4E0B\u6838\u5FC3\u7EC4\u4EF6\u6784\u6210\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://www.mongodb.com/assets/images/resource-center/icons/icon-architecture-300x163.png",alt:"MongoDB\u67B6\u6784"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"MongoDB\u670D\u52A1\u5668"}),"\uFF1A\u6838\u5FC3\u6570\u636E\u5E93\u670D\u52A1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5B58\u50A8\u5F15\u64CE"}),"\uFF1A\u8D1F\u8D23\u6570\u636E\u6301\u4E45\u5316\uFF0C\u9ED8\u8BA4\u4E3AWiredTiger"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u590D\u5236\u96C6"}),"\uFF1A\u63D0\u4F9B\u6570\u636E\u5197\u4F59\u548C\u9AD8\u53EF\u7528\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u7247\u96C6\u7FA4"}),"\uFF1A\u5B9E\u73B0\u6C34\u5E73\u6269\u5C55\uFF0C\u5904\u7406\u5927\u6570\u636E\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"MongoDB\u5BA2\u6237\u7AEF"}),"\uFF1A\u5E94\u7528\u7A0B\u5E8F\u901A\u8FC7\u9A71\u52A8\u7A0B\u5E8F\u8FDE\u63A5\u6570\u636E\u5E93"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"111-\u57FA\u672C\u672F\u8BED\u5BF9\u6BD4",children:"1.1.1 \u57FA\u672C\u672F\u8BED\u5BF9\u6BD4"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u4E0E\u5173\u7CFB\u578B\u6570\u636E\u5E93\u5728\u6982\u5FF5\u4E0A\u6709\u8BB8\u591A\u5BF9\u5E94\u5173\u7CFB\uFF1A"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5173\u7CFB\u578B\u6570\u636E\u5E93"}),(0,i.jsx)(e.th,{children:"MongoDB"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6570\u636E\u5E93(Database)"}),(0,i.jsx)(e.td,{children:"\u6570\u636E\u5E93(Database)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8868(Table)"}),(0,i.jsx)(e.td,{children:"\u96C6\u5408(Collection)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u884C(Row)"}),(0,i.jsx)(e.td,{children:"\u6587\u6863(Document)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5217(Column)"}),(0,i.jsx)(e.td,{children:"\u5B57\u6BB5(Field)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4E3B\u952E(Primary Key)"}),(0,i.jsx)(e.td,{children:"ObjectId(_id)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7D22\u5F15(Index)"}),(0,i.jsx)(e.td,{children:"\u7D22\u5F15(Index)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8FDE\u63A5(Join)"}),(0,i.jsx)(e.td,{children:"\u5F15\u7528\u6216\u5D4C\u5165"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u89C6\u56FE(View)"}),(0,i.jsx)(e.td,{children:"\u89C6\u56FE(View)"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"12-\u6587\u6863\u6A21\u578B\u8BE6\u89E3",children:"1.2 \u6587\u6863\u6A21\u578B\u8BE6\u89E3"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7684\u6838\u5FC3\u662F\u6587\u6863\u6A21\u578B\uFF0C\u5B83\u4EE5BSON(Binary JSON)\u683C\u5F0F\u5B58\u50A8\u6570\u636E\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"121-bson\u683C\u5F0F",children:"1.2.1 BSON\u683C\u5F0F"}),"\n",(0,i.jsx)(e.p,{children:"BSON\u6269\u5C55\u4E86JSON\u683C\u5F0F\uFF0C\u589E\u52A0\u4E86\u989D\u5916\u7684\u6570\u636E\u7C7B\u578B\u652F\u6301\uFF08\u5982\u65E5\u671F\u3001\u4E8C\u8FDB\u5236\u6570\u636E\u3001\u6B63\u5219\u8868\u8FBE\u5F0F\u7B49\uFF09\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("507f1f77bcf86cd799439011"),\n  "name": "\u5F20\u4E09",\n  "age": 30,\n  "email": "zhangsan@example.com",\n  "created_at": ISODate("2023-01-15T09:30:00Z"),\n  "tags": ["vip", "active"],\n  "address": {\n    "city": "\u5317\u4EAC",\n    "street": "\u4E2D\u5173\u6751\u5927\u8857",\n    "zip": "100080"\n  },\n  "orders": [\n    { "product": "\u624B\u673A", "price": 4999 },\n    { "product": "\u8033\u673A", "price": 999 }\n  ]\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"122-\u6587\u6863\u5927\u5C0F\u9650\u5236",children:"1.2.2 \u6587\u6863\u5927\u5C0F\u9650\u5236"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5355\u4E2A\u6587\u6863\u6700\u5927\u4E0D\u8D85\u8FC716MB"}),"\n",(0,i.jsx)(e.li,{children:"\u5BF9\u4E8E\u5927\u578B\u6587\u6863\uFF0C\u53EF\u4EE5\u4F7F\u7528GridFS\u5B58\u50A8"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"123-_id\u5B57\u6BB5",children:"1.2.3 _id\u5B57\u6BB5"}),"\n",(0,i.jsxs)(e.p,{children:["\u6BCF\u4E2A\u6587\u6863\u5FC5\u987B\u6709\u4E00\u4E2A",(0,i.jsx)(e.code,{children:"_id"}),"\u5B57\u6BB5\u4F5C\u4E3A\u4E3B\u952E\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9ED8\u8BA4\u4E3AObjectId\u7C7B\u578B\uFF08\u81EA\u52A8\u751F\u6210\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u81EA\u5B9A\u4E49\u4E3A\u4EFB\u4F55\u552F\u4E00\u503C"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u53EF\u53D8\u4E14\u5FC5\u987B\u552F\u4E00"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"13-\u6570\u636E\u5E93\u64CD\u4F5C\u57FA\u7840",children:"1.3 \u6570\u636E\u5E93\u64CD\u4F5C\u57FA\u7840"}),"\n",(0,i.jsx)(e.h4,{id:"131-\u521B\u5EFA\u6570\u636E\u5E93\u548C\u96C6\u5408",children:"1.3.1 \u521B\u5EFA\u6570\u636E\u5E93\u548C\u96C6\u5408"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5207\u6362\u5230\u6307\u5B9A\u6570\u636E\u5E93\uFF08\u4E0D\u5B58\u5728\u5219\u9690\u5F0F\u521B\u5EFA\uFF09\nuse mydb\n\n// \u521B\u5EFA\u96C6\u5408\uFF08\u663E\u5F0F\u521B\u5EFA\uFF0C\u53EF\u6307\u5B9A\u9009\u9879\uFF09\ndb.createCollection("users", {\n  validator: {\n    $jsonSchema: {\n      bsonType: "object",\n      required: ["name", "email"],\n      properties: {\n        name: { bsonType: "string" },\n        email: { bsonType: "string", pattern: "^.+@.+$" }\n      }\n    }\n  }\n})\n\n// \u9690\u5F0F\u521B\u5EFA\u96C6\u5408\uFF08\u63D2\u5165\u6587\u6863\u65F6\u81EA\u52A8\u521B\u5EFA\uFF09\ndb.products.insertOne({\n  name: "\u667A\u80FD\u624B\u673A",\n  price: 4999,\n  stock: 200\n})\n'})}),"\n",(0,i.jsx)(e.h4,{id:"132-\u57FA\u672Ccrud\u64CD\u4F5C",children:"1.3.2 \u57FA\u672CCRUD\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u63D2\u5165\u6587\u6863\ndb.users.insertOne({\n  name: "\u674E\u56DB",\n  age: 28,\n  email: "lisi@example.com"\n})\n\n// \u6279\u91CF\u63D2\u5165\ndb.users.insertMany([\n  { name: "\u738B\u4E94", age: 35, email: "wangwu@example.com" },\n  { name: "\u8D75\u516D", age: 42, email: "zhaoliu@example.com" }\n])\n\n// \u67E5\u8BE2\u6587\u6863\ndb.users.find({ age: { $gt: 30 } })\n\n// \u66F4\u65B0\u6587\u6863\ndb.users.updateOne(\n  { name: "\u674E\u56DB" },\n  { $set: { age: 29 }, $currentDate: { lastModified: true } }\n)\n\n// \u5220\u9664\u6587\u6863\ndb.users.deleteOne({ name: "\u8D75\u516D" })\n'})}),"\n",(0,i.jsx)(e.h4,{id:"133-\u67E5\u8BE2\u64CD\u4F5C\u7B26",children:"1.3.3 \u67E5\u8BE2\u64CD\u4F5C\u7B26"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u63D0\u4F9B\u4E30\u5BCC\u7684\u67E5\u8BE2\u64CD\u4F5C\u7B26\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u6BD4\u8F83\u64CD\u4F5C\u7B26\ndb.products.find({ price: { $lt: 1000 } })  // \u5C0F\u4E8E\ndb.products.find({ price: { $gt: 1000, $lt: 5000 } })  // \u533A\u95F4\u67E5\u8BE2\n\n// \u903B\u8F91\u64CD\u4F5C\u7B26\ndb.users.find({ $or: [{ age: { $lt: 25 } }, { age: { $gt: 50 } }] })\n\n// \u5143\u7D20\u64CD\u4F5C\u7B26\ndb.users.find({ age: { $exists: true } })  // \u5B58\u5728\u5B57\u6BB5\ndb.users.find({ score: { $type: "number" } })  // \u7C7B\u578B\u5339\u914D\n\n// \u6570\u7EC4\u64CD\u4F5C\u7B26\ndb.posts.find({ tags: { $all: ["mongodb", "nosql"] } })  // \u5305\u542B\u6240\u6709\u6307\u5B9A\u5143\u7D20\ndb.posts.find({ tags: { $size: 3 } })  // \u6570\u7EC4\u957F\u5EA6\u5339\u914D\n'})}),"\n",(0,i.jsx)(e.h3,{id:"14-\u7D22\u5F15\u4E0E\u6027\u80FD",children:"1.4 \u7D22\u5F15\u4E0E\u6027\u80FD"}),"\n",(0,i.jsx)(e.h4,{id:"141-\u7D22\u5F15\u7C7B\u578B",children:"1.4.1 \u7D22\u5F15\u7C7B\u578B"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u652F\u6301\u591A\u79CD\u7D22\u5F15\u7C7B\u578B\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5355\u5B57\u6BB5\u7D22\u5F15\ndb.users.createIndex({ email: 1 })  // 1\u8868\u793A\u5347\u5E8F\uFF0C-1\u8868\u793A\u964D\u5E8F\n\n// \u590D\u5408\u7D22\u5F15\ndb.products.createIndex({ category: 1, price: -1 })\n\n// \u591A\u952E\u7D22\u5F15\uFF08\u6570\u7EC4\u5B57\u6BB5\uFF09\ndb.posts.createIndex({ tags: 1 })\n\n// \u5730\u7406\u7A7A\u95F4\u7D22\u5F15\ndb.places.createIndex({ location: "2dsphere" })\n\n// \u6587\u672C\u7D22\u5F15\uFF08\u5168\u6587\u641C\u7D22\uFF09\ndb.articles.createIndex({ title: "text", content: "text" })\n\n// \u54C8\u5E0C\u7D22\u5F15\ndb.users.createIndex({ username: "hashed" })\n'})}),"\n",(0,i.jsx)(e.h4,{id:"142-\u7D22\u5F15\u5C5E\u6027",children:"1.4.2 \u7D22\u5F15\u5C5E\u6027"}),"\n",(0,i.jsx)(e.p,{children:"\u7D22\u5F15\u53EF\u4EE5\u914D\u7F6E\u591A\u79CD\u5C5E\u6027\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u552F\u4E00\u7D22\u5F15\ndb.users.createIndex({ email: 1 }, { unique: true })\n\n// \u7A00\u758F\u7D22\u5F15\uFF08\u53EA\u7D22\u5F15\u5305\u542B\u8BE5\u5B57\u6BB5\u7684\u6587\u6863\uFF09\ndb.users.createIndex({ mobile: 1 }, { sparse: true })\n\n// TTL\u7D22\u5F15\uFF08\u81EA\u52A8\u8FC7\u671F\uFF09\ndb.sessions.createIndex(\n  { lastActive: 1 },\n  { expireAfterSeconds: 3600 }  // \u4E00\u5C0F\u65F6\u540E\u8FC7\u671F\n)\n\n// \u90E8\u5206\u7D22\u5F15\uFF08\u6761\u4EF6\u7D22\u5F15\uFF09\ndb.products.createIndex(\n  { price: 1 },\n  { partialFilterExpression: { quantity: { $gt: 0 } } }\n)\n"})}),"\n",(0,i.jsx)(e.h4,{id:"143-\u67E5\u770B\u548C\u7BA1\u7406\u7D22\u5F15",children:"1.4.3 \u67E5\u770B\u548C\u7BA1\u7406\u7D22\u5F15"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u67E5\u770B\u96C6\u5408\u7684\u6240\u6709\u7D22\u5F15\ndb.users.getIndexes()\n\n// \u5220\u9664\u7279\u5B9A\u7D22\u5F15\ndb.users.dropIndex("email_1")\n\n// \u5220\u9664\u6240\u6709\u7D22\u5F15\uFF08\u9664_id\u5916\uFF09\ndb.users.dropIndexes()\n'})}),"\n",(0,i.jsx)(e.h3,{id:"15-\u805A\u5408\u6846\u67B6",children:"1.5 \u805A\u5408\u6846\u67B6"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7684\u805A\u5408\u6846\u67B6\u63D0\u4F9B\u5F3A\u5927\u7684\u6570\u636E\u5904\u7406\u80FD\u529B\uFF0C\u53EF\u8FDB\u884C\u590D\u6742\u7684\u5206\u7EC4\u3001\u8FC7\u6EE4\u548C\u8F6C\u6362\u64CD\u4F5C\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"151-\u57FA\u672C\u805A\u5408\u7BA1\u9053",children:"1.5.1 \u57FA\u672C\u805A\u5408\u7BA1\u9053"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'db.orders.aggregate([\n  // \u7B5B\u9009\u9636\u6BB5\n  { $match: { status: "completed" } },\n  \n  // \u5206\u7EC4\u9636\u6BB5\n  { $group: {\n      _id: "$customer_id",\n      totalAmount: { $sum: "$amount" },\n      count: { $sum: 1 }\n  }},\n  \n  // \u6392\u5E8F\u9636\u6BB5\n  { $sort: { totalAmount: -1 } },\n  \n  // \u9650\u5236\u9636\u6BB5\n  { $limit: 10 }\n])\n'})}),"\n",(0,i.jsx)(e.h4,{id:"152-\u5E38\u7528\u805A\u5408\u64CD\u4F5C\u7B26",children:"1.5.2 \u5E38\u7528\u805A\u5408\u64CD\u4F5C\u7B26"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u6295\u5F71\u64CD\u4F5C\u7B26\ndb.users.aggregate([\n  { $project: {\n      _id: 0,\n      name: 1,\n      firstLetter: { $substr: ["$name", 0, 1] }\n  }}\n])\n\n// \u5C55\u5F00\u6570\u7EC4\ndb.products.aggregate([\n  { $unwind: "$categories" }\n])\n\n// \u67E5\u627E\u64CD\u4F5C\uFF08\u7C7B\u4F3C\u5173\u7CFB\u578B\u6570\u636E\u5E93\u7684JOIN\uFF09\ndb.orders.aggregate([\n  { $lookup: {\n      from: "users",\n      localField: "user_id",\n      foreignField: "_id",\n      as: "user_info"\n  }}\n])\n'})}),"\n",(0,i.jsx)(e.h4,{id:"153-\u805A\u5408\u8868\u8FBE\u5F0F",children:"1.5.3 \u805A\u5408\u8868\u8FBE\u5F0F"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u6761\u4EF6\u8868\u8FBE\u5F0F\ndb.products.aggregate([\n  { $project: {\n      name: 1,\n      price: 1,\n      priceCategory: {\n        $switch: {\n          branches: [\n            { case: { $lt: ["$price", 100] }, then: "\u4FBF\u5B9C" },\n            { case: { $lt: ["$price", 500] }, then: "\u9002\u4E2D" }\n          ],\n          default: "\u6602\u8D35"\n        }\n      }\n  }}\n])\n\n// \u65E5\u671F\u64CD\u4F5C\ndb.orders.aggregate([\n  { $project: {\n      year: { $year: "$created_at" },\n      month: { $month: "$created_at" },\n      day: { $dayOfMonth: "$created_at" }\n  }}\n])\n'})}),"\n",(0,i.jsx)(e.h2,{id:"2-mongodb\u9AD8\u7EA7\u6570\u636E\u5EFA\u6A21",children:"2. MongoDB\u9AD8\u7EA7\u6570\u636E\u5EFA\u6A21"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7684\u6587\u6863\u6A21\u578B\u63D0\u4F9B\u4E86\u6781\u5927\u7684\u8BBE\u8BA1\u7075\u6D3B\u6027\uFF0C\u4F46\u4F18\u79C0\u7684\u6570\u636E\u6A21\u578B\u8BBE\u8BA1\u5BF9\u6027\u80FD\u548C\u53EF\u7EF4\u62A4\u6027\u81F3\u5173\u91CD\u8981\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"21-\u6570\u636E\u5EFA\u6A21\u7B56\u7565",children:"2.1 \u6570\u636E\u5EFA\u6A21\u7B56\u7565"}),"\n",(0,i.jsx)(e.h4,{id:"211-\u5D4C\u5165\u5F0F\u6587\u6863-vs-\u5F15\u7528\u5173\u7CFB",children:"2.1.1 \u5D4C\u5165\u5F0F\u6587\u6863 vs. \u5F15\u7528\u5173\u7CFB"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u63D0\u4F9B\u4E24\u79CD\u4E3B\u8981\u7684\u5173\u7CFB\u5904\u7406\u65B9\u5F0F\uFF1A"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5D4C\u5165\u5F0F\u6587\u6863\uFF08\u53CD\u89C4\u8303\u5316\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5D4C\u5165\u5F0F\u6587\u6863\u793A\u4F8B - \u7528\u6237\u53CA\u5176\u5730\u5740\n{\n  "_id": ObjectId("..."),\n  "name": "\u5F20\u4E09",\n  "email": "zhangsan@example.com",\n  "addresses": [\n    {\n      "type": "home",\n      "street": "\u4E2D\u5173\u6751\u5927\u88571\u53F7",\n      "city": "\u5317\u4EAC",\n      "zip": "100080"\n    },\n    {\n      "type": "work",\n      "street": "\u91D1\u878D\u5927\u88572\u53F7",\n      "city": "\u5317\u4EAC",\n      "zip": "100033"\n    }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5F15\u7528\u5173\u7CFB\uFF08\u89C4\u8303\u5316\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u7528\u6237\u96C6\u5408\n{\n  "_id": ObjectId("user1"),\n  "name": "\u5F20\u4E09",\n  "email": "zhangsan@example.com"\n}\n\n// \u5730\u5740\u96C6\u5408\n{\n  "_id": ObjectId("addr1"),\n  "user_id": ObjectId("user1"),\n  "type": "home",\n  "street": "\u4E2D\u5173\u6751\u5927\u88571\u53F7",\n  "city": "\u5317\u4EAC",\n  "zip": "100080"\n}\n{\n  "_id": ObjectId("addr2"),\n  "user_id": ObjectId("user1"),\n  "type": "work",\n  "street": "\u91D1\u878D\u5927\u88572\u53F7",\n  "city": "\u5317\u4EAC",\n  "zip": "100033"\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u6807\u51C6"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5D4C\u5165\u5F0F\u9002\u7528\u4E8E\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E00\u5BF9\u4E00\u6216\u4E00\u5BF9\u5C11\u91CF\u5173\u7CFB"}),"\n",(0,i.jsx)(e.li,{children:"\u5B50\u6587\u6863\u662F\u4E3B\u6587\u6863\u7684\u7EC4\u6210\u90E8\u5206"}),"\n",(0,i.jsx)(e.li,{children:"\u5B50\u6587\u6863\u4E0D\u5355\u72EC\u8BBF\u95EE"}),"\n",(0,i.jsx)(e.li,{children:"\u6587\u6863\u603B\u5927\u5C0F\u572816MB\u4EE5\u5185"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"\u5F15\u7528\u9002\u7528\u4E8E\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E00\u5BF9\u591A\u6216\u591A\u5BF9\u591A\u5173\u7CFB"}),"\n",(0,i.jsx)(e.li,{children:"\u5B50\u6570\u636E\u9700\u8981\u5355\u72EC\u67E5\u8BE2"}),"\n",(0,i.jsx)(e.li,{children:"\u6587\u6863\u9891\u7E41\u53D8\u5316"}),"\n",(0,i.jsx)(e.li,{children:"\u6587\u6863\u5927\u5C0F\u63A5\u8FD1\u6216\u8D85\u8FC716MB\u9650\u5236"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"212-\u6A21\u5F0F\u8BBE\u8BA1\u6A21\u5F0F",children:"2.1.2 \u6A21\u5F0F\u8BBE\u8BA1\u6A21\u5F0F"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u76EE\u5F55\u6A21\u5F0F"}),"\uFF1A\u9002\u7528\u4E8E\u4EA7\u54C1\u76EE\u5F55\u7B49\u5C42\u6B21\u7ED3\u6784"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u4EA7\u54C1\u76EE\u5F55\u7ED3\u6784\n{\n  "_id": ObjectId("..."),\n  "name": "\u7535\u5B50\u4EA7\u54C1",\n  "path": ",\u7535\u5B50\u4EA7\u54C1,",\n  "parent_id": null,\n  "level": 1\n}\n\n{\n  "_id": ObjectId("..."),\n  "name": "\u624B\u673A",\n  "path": ",\u7535\u5B50\u4EA7\u54C1,\u624B\u673A,",\n  "parent_id": ObjectId("..."),\n  "level": 2\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u6001\u6A21\u5F0F"}),"\uFF1A\u9002\u7528\u4E8E\u5B58\u50A8\u76F8\u4F3C\u4F46\u4E0D\u5B8C\u5168\u76F8\u540C\u7684\u6570\u636E"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("..."),\n  "type": "book",\n  "title": "MongoDB\u5B9E\u6218",\n  "author": "\u5F20\u4E09",\n  "isbn": "978-1-4842-1182-3"\n}\n\n{\n  "_id": ObjectId("..."),\n  "type": "movie",\n  "title": "\u661F\u9645\u7A7F\u8D8A",\n  "director": "\u514B\u91CC\u65AF\u6258\u5F17\xb7\u8BFA\u5170",\n  "duration": 169\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7248\u672C\u63A7\u5236\u6A21\u5F0F"}),"\uFF1A\u8FFD\u8E2A\u6587\u6863\u5386\u53F2\u53D8\u66F4"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5F53\u524D\u7248\u672C\n{\n  "_id": ObjectId("..."),\n  "title": "MongoDB\u6307\u5357",\n  "content": "\u6700\u65B0\u5185\u5BB9...",\n  "version": 3,\n  "is_current": true\n}\n\n// \u5386\u53F2\u7248\u672C\n{\n  "_id": ObjectId("..."),\n  "title": "MongoDB\u5165\u95E8",\n  "content": "\u65E7\u7248\u5185\u5BB9...",\n  "version": 2,\n  "is_current": false,\n  "current_id": ObjectId("...") // \u6307\u5411\u5F53\u524D\u7248\u672C\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"22-\u590D\u6742\u5173\u7CFB\u5EFA\u6A21\u793A\u4F8B",children:"2.2 \u590D\u6742\u5173\u7CFB\u5EFA\u6A21\u793A\u4F8B"}),"\n",(0,i.jsx)(e.h4,{id:"221-\u7535\u5B50\u5546\u52A1\u7CFB\u7EDF\u5EFA\u6A21",children:"2.2.1 \u7535\u5B50\u5546\u52A1\u7CFB\u7EDF\u5EFA\u6A21"}),"\n",(0,i.jsx)(e.p,{children:"\u7535\u5B50\u5546\u52A1\u7CFB\u7EDF\u5305\u542B\u7528\u6237\u3001\u4EA7\u54C1\u3001\u8BA2\u5355\u7B49\u6838\u5FC3\u5BF9\u8C61\uFF0C\u5173\u7CFB\u8F83\u4E3A\u590D\u6742\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7528\u6237\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("user1"),\n  "name": "\u738B\u5C0F\u660E",\n  "email": "wang@example.com",\n  "shipping_addresses": [\n    {\n      "address_id": "addr1",\n      "street": "\u4E2D\u5173\u6751\u5927\u88571\u53F7",\n      "city": "\u5317\u4EAC",\n      "is_default": true\n    }\n  ],\n  "payment_methods": [\n    {\n      "type": "credit_card",\n      "last4": "1234",\n      "expires": "04/25",\n      "is_default": true\n    }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4EA7\u54C1\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("prod1"),\n  "name": "iPhone 13",\n  "description": "Apple\u6700\u65B0\u667A\u80FD\u624B\u673A",\n  "price": 5999,\n  "stock": 100,\n  "category": "\u624B\u673A",\n  "attributes": {\n    "color": ["\u9ED1\u8272", "\u767D\u8272", "\u84DD\u8272"],\n    "storage": ["128GB", "256GB", "512GB"]\n  },\n  "images": [\n    "iphone13_main.jpg",\n    "iphone13_back.jpg"\n  ],\n  "ratings": {\n    "average": 4.8,\n    "count": 245\n  }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8BA2\u5355\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("order1"),\n  "user_id": ObjectId("user1"),\n  "status": "shipped",\n  "created_at": ISODate("2023-06-15T10:30:00Z"),\n  "shipping_address": {\n    "street": "\u4E2D\u5173\u6751\u5927\u88571\u53F7",\n    "city": "\u5317\u4EAC"\n  },\n  "payment": {\n    "method": "credit_card",\n    "last4": "1234",\n    "amount": 6598,\n    "status": "paid"\n  },\n  "items": [\n    {\n      "product_id": ObjectId("prod1"),\n      "name": "iPhone 13",\n      "price": 5999,\n      "quantity": 1,\n      "attributes": {\n        "color": "\u9ED1\u8272",\n        "storage": "128GB"\n      }\n    },\n    {\n      "product_id": ObjectId("prod2"),\n      "name": "\u624B\u673A\u4FDD\u62A4\u58F3",\n      "price": 599,\n      "quantity": 1\n    }\n  ],\n  "shipping": {\n    "method": "express",\n    "fee": 0,\n    "tracking_number": "SF1234567890"\n  },\n  "total": 6598\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8BC4\u8BBA\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("review1"),\n  "product_id": ObjectId("prod1"),\n  "user_id": ObjectId("user1"),\n  "user_name": "\u738B\u5C0F\u660E", // \u5197\u4F59\u5B58\u50A8\n  "rating": 5,\n  "title": "\u975E\u5E38\u597D\u7528\u7684\u624B\u673A",\n  "content": "\u5C4F\u5E55\u6E05\u6670\uFF0C\u6027\u80FD\u5F3A\u52B2...",\n  "created_at": ISODate("2023-06-20T14:25:00Z"),\n  "helpful_votes": 12\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"222-\u793E\u4EA4\u7F51\u7EDC\u5EFA\u6A21",children:"2.2.2 \u793E\u4EA4\u7F51\u7EDC\u5EFA\u6A21"}),"\n",(0,i.jsx)(e.p,{children:"\u793E\u4EA4\u7F51\u7EDC\u5305\u542B\u7528\u6237\u3001\u5173\u7CFB\u7F51\u7EDC\u3001\u5E16\u5B50\u548C\u4E92\u52A8\u7B49\u5143\u7D20\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7528\u6237\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("user1"),\n  "username": "zhang_san",\n  "name": "\u5F20\u4E09",\n  "email": "zhangsan@example.com",\n  "profile": {\n    "avatar": "zhang_san.jpg",\n    "bio": "\u70ED\u7231\u6280\u672F\u4E0E\u521B\u65B0",\n    "location": "\u5317\u4EAC"\n  },\n  "stats": {\n    "followers_count": 1250,\n    "following_count": 350,\n    "posts_count": 142\n  },\n  "preferences": {\n    "privacy": "public",\n    "notifications": {\n      "likes": true,\n      "comments": true,\n      "follows": true\n    }\n  },\n  "created_at": ISODate("2020-01-15")\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5173\u7CFB\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("..."),\n  "follower": ObjectId("user2"),\n  "following": ObjectId("user1"),\n  "status": "active", // active, blocked, muted\n  "created_at": ISODate("2023-05-20")\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5E16\u5B50\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("post1"),\n  "user_id": ObjectId("user1"),\n  "user_info": {\n    "username": "zhang_san",\n    "name": "\u5F20\u4E09",\n    "avatar": "zhang_san.jpg"\n  },\n  "content": "\u4ECA\u5929\u5B66\u4E60\u4E86MongoDB\u7684\u9AD8\u7EA7\u6570\u636E\u5EFA\u6A21",\n  "media": [\n    {\n      "type": "image",\n      "url": "mongodb_diagram.jpg",\n      "width": 1200,\n      "height": 800\n    }\n  ],\n  "tags": ["\u6280\u672F", "\u6570\u636E\u5E93", "MongoDB"],\n  "location": {\n    "name": "\u5317\u4EAC\u79D1\u6280\u56ED",\n    "coordinates": [116.3, 40.0]\n  },\n  "stats": {\n    "likes": 45,\n    "comments": 12,\n    "shares": 5\n  },\n  "created_at": ISODate("2023-06-25T09:15:00Z")\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4E92\u52A8\u96C6\u5408"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'{\n  "_id": ObjectId("..."),\n  "type": "comment", // comment, like, share\n  "post_id": ObjectId("post1"),\n  "user_id": ObjectId("user3"),\n  "user_info": {\n    "username": "li_si",\n    "name": "\u674E\u56DB",\n    "avatar": "li_si.jpg"\n  },\n  "content": "\u975E\u5E38\u5B9E\u7528\u7684\u6587\u7AE0\uFF01",\n  "created_at": ISODate("2023-06-25T10:30:00Z")\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"23-\u6A21\u5F0F\u9A8C\u8BC1",children:"2.3 \u6A21\u5F0F\u9A8C\u8BC1"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB 3.6+\u652F\u6301JSON Schema\u9A8C\u8BC1\uFF0C\u53EF\u4EE5\u786E\u4FDD\u6570\u636E\u7B26\u5408\u9884\u5B9A\u4E49\u7684\u7ED3\u6784\u548C\u89C4\u5219\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'db.createCollection("products", {\n  validator: {\n    $jsonSchema: {\n      bsonType: "object",\n      required: ["name", "price", "category"],\n      properties: {\n        name: {\n          bsonType: "string",\n          description: "\u5FC5\u987B\u662F\u5B57\u7B26\u4E32\u4E14\u4E0D\u53EF\u4E3A\u7A7A"\n        },\n        price: {\n          bsonType: "number",\n          minimum: 0,\n          description: "\u5FC5\u987B\u662F\u975E\u8D1F\u6570"\n        },\n        stock: {\n          bsonType: "int",\n          minimum: 0,\n          description: "\u5FC5\u987B\u662F\u975E\u8D1F\u6574\u6570"\n        },\n        category: {\n          bsonType: "string",\n          enum: ["\u7535\u5B50\u4EA7\u54C1", "\u5BB6\u5C45", "\u670D\u88C5", "\u98DF\u54C1"],\n          description: "\u5FC5\u987B\u662F\u6307\u5B9A\u7C7B\u522B\u4E4B\u4E00"\n        },\n        tags: {\n          bsonType: "array",\n          items: {\n            bsonType: "string"\n          }\n        }\n      }\n    }\n  },\n  validationLevel: "moderate", // strict, moderate, off\n  validationAction: "error" // error, warn\n})\n'})}),"\n",(0,i.jsx)(e.h3,{id:"24-\u6570\u636E\u4E00\u81F4\u6027\u4E0E\u4E8B\u52A1",children:"2.4 \u6570\u636E\u4E00\u81F4\u6027\u4E0E\u4E8B\u52A1"}),"\n",(0,i.jsx)(e.h4,{id:"241-\u539F\u5B50\u6027\u64CD\u4F5C",children:"2.4.1 \u539F\u5B50\u6027\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u4FDD\u8BC1\u5355\u6587\u6863\u64CD\u4F5C\u7684\u539F\u5B50\u6027\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u66F4\u65B0\u6587\u6863\u4E2D\u7684\u7279\u5B9A\u5B57\u6BB5\uFF08\u539F\u5B50\u6027\u64CD\u4F5C\uFF09\ndb.inventory.updateOne(\n  { _id: "prod1", "quantity": { $gt: 0 } },\n  { \n    $inc: { quantity: -1 },\n    $push: { orders: { order_id: "12345", date: new Date() } }\n  }\n)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"242-\u591A\u6587\u6863\u4E8B\u52A1",children:"2.4.2 \u591A\u6587\u6863\u4E8B\u52A1"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB 4.0+\u652F\u6301\u591A\u6587\u6863\u4E8B\u52A1\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u542F\u52A8\u4F1A\u8BDD\u548C\u4E8B\u52A1\nconst session = db.getMongo().startSession();\nsession.startTransaction();\n\ntry {\n  // \u6263\u51CF\u5E93\u5B58\n  db.products.updateOne(\n    { _id: productId, stock: { $gte: quantity } },\n    { $inc: { stock: -quantity } },\n    { session }\n  );\n  \n  // \u521B\u5EFA\u8BA2\u5355\n  db.orders.insertOne({\n    user_id: userId,\n    product_id: productId,\n    quantity: quantity,\n    total: price * quantity,\n    status: "created",\n    created_at: new Date()\n  }, { session });\n  \n  // \u63D0\u4EA4\u4E8B\u52A1\n  session.commitTransaction();\n} catch (error) {\n  // \u56DE\u6EDA\u4E8B\u52A1\n  session.abortTransaction();\n  throw error;\n} finally {\n  // \u7ED3\u675F\u4F1A\u8BDD\n  session.endSession();\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"243-\u53CC\u5199\u5173\u6CE8",children:"2.4.3 \u53CC\u5199\u5173\u6CE8"}),"\n",(0,i.jsx)(e.p,{children:"\u5BF9\u4E8E\u5173\u952E\u6570\u636E\uFF0C\u53EF\u4EE5\u8BBE\u7F6E\u5199\u5165\u5173\u6CE8\u7EA7\u522B\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'db.orders.insertOne(\n  { /* \u8BA2\u5355\u6570\u636E */ },\n  { writeConcern: { w: "majority", j: true, wtimeout: 5000 } }\n)\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5199\u5165\u5173\u6CE8\u9009\u9879\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"w"}),"\uFF1A\u5199\u5165\u786E\u8BA4\u7EA7\u522B\uFF081\u3001majority\u3001\u6807\u7B7E\u540D\u79F0\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"j"}),"\uFF1A\u7B49\u5F85\u5199\u5165\u65E5\u5FD7"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"wtimeout"}),"\uFF1A\u5199\u5165\u8D85\u65F6\u65F6\u95F4"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"3-mongodb\u9AD8\u7EA7\u7279\u6027\u4E0E\u4F01\u4E1A\u529F\u80FD",children:"3. MongoDB\u9AD8\u7EA7\u7279\u6027\u4E0E\u4F01\u4E1A\u529F\u80FD"}),"\n",(0,i.jsx)(e.p,{children:"\u968F\u7740MongoDB\u7684\u53D1\u5C55\uFF0C\u5B83\u5DF2\u4ECE\u7B80\u5355\u7684\u6587\u6863\u6570\u636E\u5E93\u6F14\u53D8\u4E3A\u529F\u80FD\u5168\u9762\u7684\u6570\u636E\u5E73\u53F0\uFF0C\u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684\u4F01\u4E1A\u7EA7\u529F\u80FD\u6765\u6EE1\u8DB3\u5927\u89C4\u6A21\u5E94\u7528\u7684\u9700\u6C42\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"31-\u590D\u5236\u96C6",children:"3.1 \u590D\u5236\u96C6"}),"\n",(0,i.jsx)(e.p,{children:"\u590D\u5236\u96C6\u662FMongoDB\u5B9E\u73B0\u9AD8\u53EF\u7528\u6027\u7684\u5173\u952E\u673A\u5236\uFF0C\u901A\u8FC7\u591A\u4E2A\u8282\u70B9\u7684\u6570\u636E\u5197\u4F59\u786E\u4FDD\u7CFB\u7EDF\u53EF\u9760\u6027\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"311-\u590D\u5236\u96C6\u67B6\u6784",children:"3.1.1 \u590D\u5236\u96C6\u67B6\u6784"}),"\n",(0,i.jsx)(e.p,{children:"\u4E00\u4E2A\u5178\u578B\u7684MongoDB\u590D\u5236\u96C6\u5305\u542B\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4E00\u4E2A",(0,i.jsx)(e.strong,{children:"\u4E3B\u8282\u70B9"}),"(Primary)\uFF1A\u5904\u7406\u6240\u6709\u5199\u64CD\u4F5C"]}),"\n",(0,i.jsxs)(e.li,{children:["\u591A\u4E2A",(0,i.jsx)(e.strong,{children:"\u4ECE\u8282\u70B9"}),"(Secondary)\uFF1A\u590D\u5236\u4E3B\u8282\u70B9\u6570\u636E\uFF0C\u53EF\u5904\u7406\u8BFB\u64CD\u4F5C"]}),"\n",(0,i.jsxs)(e.li,{children:["\u53EF\u9009\u7684",(0,i.jsx)(e.strong,{children:"\u4EF2\u88C1\u8282\u70B9"}),"(Arbiter)\uFF1A\u53C2\u4E0E\u9009\u4E3E\u4F46\u4E0D\u5B58\u50A8\u6570\u636E"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://docs.mongodb.com/manual/images/replica-set-read-write-operations-primary.bakedsvg.svg",alt:"MongoDB\u590D\u5236\u96C6\u67B6\u6784"})}),"\n",(0,i.jsx)(e.h4,{id:"312-\u590D\u5236\u96C6\u914D\u7F6E",children:"3.1.2 \u590D\u5236\u96C6\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u57FA\u7840\u914D\u7F6E\u793A\u4F8B"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u51C6\u5907\u914D\u7F6E\u6587\u4EF6(mongod.conf)\uFF1A"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'replication:\n  replSetName: "rs0"\nnet:\n  bindIp: localhost\n  port: 27017\nstorage:\n  dbPath: "/var/lib/mongodb"\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"\u542F\u52A8\u591A\u4E2AMongoDB\u5B9E\u4F8B\uFF1A"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"mongod --config mongod.conf --port 27017\nmongod --config mongod.conf --port 27018 --dbpath /var/lib/mongodb-2\nmongod --config mongod.conf --port 27019 --dbpath /var/lib/mongodb-3\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:"\u521D\u59CB\u5316\u590D\u5236\u96C6\uFF1A"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u8FDE\u63A5\u5230\u5176\u4E2D\u4E00\u4E2A\u5B9E\u4F8B\nmongo --port 27017\n\n// \u521D\u59CB\u5316\u590D\u5236\u96C6\nrs.initiate({\n  _id: "rs0",\n  members: [\n    { _id: 0, host: "localhost:27017" },\n    { _id: 1, host: "localhost:27018" },\n    { _id: 2, host: "localhost:27019" }\n  ]\n})\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"4",children:["\n",(0,i.jsx)(e.li,{children:"\u590D\u5236\u96C6\u72B6\u6001\u68C0\u67E5\uFF1A"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"rs.status()  // \u67E5\u770B\u590D\u5236\u96C6\u72B6\u6001\nrs.isMaster()  // \u68C0\u67E5\u662F\u5426\u4E3A\u4E3B\u8282\u70B9\n"})}),"\n",(0,i.jsx)(e.h4,{id:"313-\u590D\u5236\u96C6\u8BFB\u5199\u5206\u79BB",children:"3.1.3 \u590D\u5236\u96C6\u8BFB\u5199\u5206\u79BB"}),"\n",(0,i.jsx)(e.p,{children:"\u53EF\u4EE5\u901A\u8FC7\u8BFB\u504F\u597D\u8BBE\u7F6E\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u9ED8\u8BA4\u4ECE\u4E3B\u8282\u70B9\u8BFB\u53D6\ndb.collection.find().readPref("primary")\n\n// \u4ECE\u6B21\u8981\u8282\u70B9\u8BFB\u53D6\ndb.collection.find().readPref("secondary")\n\n// \u5C31\u8FD1\u539F\u5219\ndb.collection.find().readPref("nearest")\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u9A71\u52A8\u7A0B\u5E8F\u4E2D\u914D\u7F6E\u8BFB\u504F\u597D\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// MongoDB Node.js\u9A71\u52A8\u793A\u4F8B\nconst client = new MongoClient(uri, {\n  readPreference: 'secondary',\n  readPreferenceTags: [\n    { datacenter: 'east' },\n    { datacenter: 'west' }\n  ]\n});\n"})}),"\n",(0,i.jsx)(e.h3,{id:"32-\u5206\u7247\u96C6\u7FA4",children:"3.2 \u5206\u7247\u96C6\u7FA4"}),"\n",(0,i.jsx)(e.p,{children:"\u5F53\u6570\u636E\u91CF\u548C\u5904\u7406\u9700\u6C42\u8D85\u51FA\u5355\u53F0\u670D\u52A1\u5668\u80FD\u529B\u65F6\uFF0C\u5206\u7247\u96C6\u7FA4\u5141\u8BB8MongoDB\u6C34\u5E73\u6269\u5C55\u4EE5\u652F\u6301\u5927\u578B\u5E94\u7528\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"321-\u5206\u7247\u96C6\u7FA4\u67B6\u6784",children:"3.2.1 \u5206\u7247\u96C6\u7FA4\u67B6\u6784"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u5206\u7247\u96C6\u7FA4\u7531\u4EE5\u4E0B\u7EC4\u4EF6\u7EC4\u6210\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u7247"}),"(Shard)\uFF1A\u6BCF\u4E2A\u5206\u7247\u662F\u4E00\u4E2A\u72EC\u7ACB\u7684\u590D\u5236\u96C6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u914D\u7F6E\u670D\u52A1\u5668"}),"(Config Server)\uFF1A\u5B58\u50A8\u96C6\u7FA4\u5143\u6570\u636E\u7684\u590D\u5236\u96C6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8DEF\u7531\u670D\u52A1"}),"(mongos)\uFF1A\u5C06\u5BA2\u6237\u7AEF\u8BF7\u6C42\u8DEF\u7531\u5230\u76F8\u5E94\u5206\u7247"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://docs.mongodb.com/manual/images/sharded-cluster-production-architecture.bakedsvg.svg",alt:"MongoDB\u5206\u7247\u96C6\u7FA4\u67B6\u6784"})}),"\n",(0,i.jsx)(e.h4,{id:"322-\u5206\u7247\u7B56\u7565",children:"3.2.2 \u5206\u7247\u7B56\u7565"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u652F\u6301\u4E24\u79CD\u4E3B\u8981\u5206\u7247\u7B56\u7565\uFF1A"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8303\u56F4\u5206\u7247"}),"\uFF1A\u57FA\u4E8E\u7247\u952E\u503C\u7684\u8FDE\u7EED\u8303\u56F4\u5212\u5206\u6570\u636E"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'sh.shardCollection("mydatabase.orders", { order_date: 1 })\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u54C8\u5E0C\u5206\u7247"}),"\uFF1A\u57FA\u4E8E\u7247\u952E\u503C\u7684\u54C8\u5E0C\u7ED3\u679C\u5747\u5300\u5206\u5E03\u6570\u636E"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'sh.shardCollection("mydatabase.users", { user_id: "hashed" })\n'})}),"\n",(0,i.jsx)(e.h4,{id:"323-\u5206\u7247\u952E\u9009\u62E9",children:"3.2.3 \u5206\u7247\u952E\u9009\u62E9"}),"\n",(0,i.jsx)(e.p,{children:"\u9009\u62E9\u826F\u597D\u7684\u5206\u7247\u952E\u5BF9\u6027\u80FD\u81F3\u5173\u91CD\u8981\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9AD8\u57FA\u6570"}),"\uFF1A\u53D6\u503C\u8303\u56F4\u5E7F\uFF0C\u5982UUID\u6216\u65F6\u95F4\u6233"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u5E03\u5747\u5300"}),"\uFF1A\u907F\u514D\u6570\u636E\u503E\u659C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u975E\u5355\u8C03\u589E\u957F"}),"\uFF1A\u907F\u514D\u5199\u5165\u70ED\u70B9"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5E38\u7528\u4E8E\u67E5\u8BE2"}),"\uFF1A\u51CF\u5C11\u8DE8\u5206\u7247\u67E5\u8BE2"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u590D\u5408\u5206\u7247\u952E\u793A\u4F8B\nsh.shardCollection("mydatabase.products", { category: 1, product_id: 1 })\n'})}),"\n",(0,i.jsx)(e.h4,{id:"324-\u533A\u57DF\u5206\u7247",children:"3.2.4 \u533A\u57DF\u5206\u7247"}),"\n",(0,i.jsx)(e.p,{children:"\u533A\u57DF\u5206\u7247\u5141\u8BB8\u6309\u5730\u7406\u4F4D\u7F6E\u6216\u5176\u4ED6\u6761\u4EF6\u5C06\u6570\u636E\u5206\u5E03\u5230\u7279\u5B9A\u5206\u7247\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5B9A\u4E49\u533A\u57DF\nsh.addShardToZone("shard0", "us-east")\nsh.addShardToZone("shard1", "us-west")\nsh.addShardToZone("shard2", "europe")\n\n// \u4E3A\u533A\u57DF\u8BBE\u7F6E\u8303\u56F4\nsh.updateZoneKeyRange(\n  "mydatabase.users",\n  { country: "US", state: "NY" },\n  { country: "US", state: "PA" },\n  "us-east"\n)\n'})}),"\n",(0,i.jsx)(e.h3,{id:"33-\u9AD8\u7EA7\u67E5\u8BE2\u529F\u80FD",children:"3.3 \u9AD8\u7EA7\u67E5\u8BE2\u529F\u80FD"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u63D0\u4F9B\u591A\u79CD\u9AD8\u7EA7\u67E5\u8BE2\u529F\u80FD\uFF0C\u7528\u4E8E\u590D\u6742\u7684\u6570\u636E\u5904\u7406\u548C\u5206\u6790\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"331-change-streams",children:"3.3.1 Change Streams"}),"\n",(0,i.jsx)(e.p,{children:"Change Streams\u5141\u8BB8\u5E94\u7528\u7A0B\u5E8F\u76D1\u542C\u6570\u636E\u5E93\u53D8\u66F4\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"const changeStream = db.collection('inventory').watch();\n\nchangeStream.on('change', (change) => {\n  console.log('Detected change:', change);\n  // \u6839\u636E\u53D8\u66F4\u7C7B\u578B\u8FDB\u884C\u5904\u7406\n  if (change.operationType === 'insert') {\n    // \u5904\u7406\u65B0\u63D2\u5165\u7684\u6587\u6863\n  } else if (change.operationType === 'update') {\n    // \u5904\u7406\u66F4\u65B0\u64CD\u4F5C\n  }\n});\n"})}),"\n",(0,i.jsx)(e.p,{children:"Change Streams\u53EF\u7528\u4E8E\u5B9E\u73B0\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7F13\u5B58\u5931\u6548"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65F6\u5206\u6790"}),"\n",(0,i.jsx)(e.li,{children:"\u4E8B\u4EF6\u9A71\u52A8\u67B6\u6784"}),"\n",(0,i.jsx)(e.li,{children:"\u8DE8\u7CFB\u7EDF\u6570\u636E\u540C\u6B65"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"332-\u5730\u7406\u7A7A\u95F4\u67E5\u8BE2",children:"3.3.2 \u5730\u7406\u7A7A\u95F4\u67E5\u8BE2"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u63D0\u4F9B\u5F3A\u5927\u7684\u5730\u7406\u7A7A\u95F4\u7D22\u5F15\u548C\u67E5\u8BE2\u529F\u80FD\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFA2dsphere\u7D22\u5F15\ndb.places.createIndex({ location: "2dsphere" })\n\n// \u9644\u8FD1\u67E5\u8BE2\ndb.places.find({\n  location: {\n    $near: {\n      $geometry: {\n        type: "Point",\n        coordinates: [121.4737, 31.2304]  // \u4E0A\u6D77\u5750\u6807\n      },\n      $maxDistance: 5000  // 5\u516C\u91CC\u5185\n    }\n  }\n})\n\n// \u5730\u7406\u8FB9\u754C\u6846\u67E5\u8BE2\ndb.places.find({\n  location: {\n    $geoWithin: {\n      $geometry: {\n        type: "Polygon",\n        coordinates: [[\n          [120.0, 30.0], [122.0, 30.0],\n          [122.0, 32.0], [120.0, 32.0],\n          [120.0, 30.0]\n        ]]\n      }\n    }\n  }\n})\n'})}),"\n",(0,i.jsx)(e.h4,{id:"333-\u5168\u6587\u641C\u7D22",children:"3.3.3 \u5168\u6587\u641C\u7D22"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7684\u6587\u672C\u641C\u7D22\u529F\u80FD\u652F\u6301\u591A\u8BED\u8A00\u5168\u6587\u68C0\u7D22\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFA\u6587\u672C\u7D22\u5F15\ndb.articles.createIndex({ title: "text", content: "text" })\n\n// \u57FA\u672C\u5168\u6587\u641C\u7D22\ndb.articles.find({ $text: { $search: "mongodb nosql \u6570\u636E\u5E93" } })\n\n// \u4F7F\u7528\u6743\u91CD\u548C\u8BC4\u5206\ndb.articles.find(\n  { $text: { $search: "mongodb nosql \u6570\u636E\u5E93" } },\n  { score: { $meta: "textScore" } }\n).sort({ score: { $meta: "textScore" } })\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u914D\u7F6E\u6587\u672C\u7D22\u5F15\u6743\u91CD\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u6807\u9898\u6743\u91CD\u9AD8\u4E8E\u5185\u5BB9\ndb.articles.createIndex(\n  { title: "text", content: "text" },\n  { weights: { title: 10, content: 5 } }\n)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"334-\u56FE\u8868\u67E5\u8BE2",children:"3.3.4 \u56FE\u8868\u67E5\u8BE2"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB 4.0+\u5F15\u5165\u4E86$graphLookup\uFF0C\u652F\u6301\u56FE\u8868\u6570\u636E\u7684\u9012\u5F52\u67E5\u8BE2\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u67E5\u8BE2\u5458\u5DE5\u7684\u6240\u6709\u4E0A\u7EA7\u7BA1\u7406\u5C42\ndb.employees.aggregate([\n  { $match: { name: "\u5F20\u4E09" } },\n  {\n    $graphLookup: {\n      from: "employees",\n      startWith: "$manager_id",\n      connectFromField: "manager_id",\n      connectToField: "_id",\n      as: "management_chain",\n      maxDepth: 5,\n      depthField: "level"\n    }\n  }\n])\n'})}),"\n",(0,i.jsx)(e.h3,{id:"34-\u5B89\u5168\u6027\u4E0E\u5BA1\u8BA1",children:"3.4 \u5B89\u5168\u6027\u4E0E\u5BA1\u8BA1"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u63D0\u4F9B\u5168\u9762\u7684\u5B89\u5168\u63A7\u5236\u673A\u5236\uFF0C\u4FDD\u62A4\u6570\u636E\u514D\u53D7\u672A\u6388\u6743\u8BBF\u95EE\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"341-\u8BA4\u8BC1\u4E0E\u6388\u6743",children:"3.4.1 \u8BA4\u8BC1\u4E0E\u6388\u6743"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u542F\u7528\u8BA4\u8BC1"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# mongod.conf\nsecurity:\n  authorization: enabled\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u521B\u5EFA\u7BA1\u7406\u5458\u7528\u6237"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'use admin\ndb.createUser({\n  user: "adminUser",\n  pwd: "securePassword",\n  roles: [{ role: "userAdminAnyDatabase", db: "admin" }]\n})\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u521B\u5EFA\u5E94\u7528\u7528\u6237"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'use mydb\ndb.createUser({\n  user: "appUser",\n  pwd: "appPassword",\n  roles: [\n    { role: "readWrite", db: "mydb" },\n    { role: "read", db: "reporting" }\n  ]\n})\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5185\u7F6E\u89D2\u8272"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u6570\u636E\u5E93\u7528\u6237\uFF1A",(0,i.jsx)(e.code,{children:"read"}),", ",(0,i.jsx)(e.code,{children:"readWrite"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u6570\u636E\u5E93\u7BA1\u7406\uFF1A",(0,i.jsx)(e.code,{children:"dbAdmin"}),", ",(0,i.jsx)(e.code,{children:"dbOwner"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u96C6\u7FA4\u7BA1\u7406\uFF1A",(0,i.jsx)(e.code,{children:"clusterAdmin"}),", ",(0,i.jsx)(e.code,{children:"clusterManager"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5907\u4EFD\u6062\u590D\uFF1A",(0,i.jsx)(e.code,{children:"backup"}),", ",(0,i.jsx)(e.code,{children:"restore"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u8D85\u7EA7\u7528\u6237\uFF1A",(0,i.jsx)(e.code,{children:"root"})]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u89D2\u8272"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'db.createRole({\n  role: "reportingRole",\n  privileges: [\n    {\n      resource: { db: "reporting", collection: "" },\n      actions: ["find"]\n    }\n  ],\n  roles: []\n})\n'})}),"\n",(0,i.jsx)(e.h4,{id:"342-tlsssl\u52A0\u5BC6",children:"3.4.2 TLS/SSL\u52A0\u5BC6"}),"\n",(0,i.jsx)(e.p,{children:"\u914D\u7F6EMongoDB\u4F7F\u7528TLS/SSL\u52A0\u5BC6\u8FDE\u63A5\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# mongod.conf\nnet:\n  ssl:\n    mode: requireSSL\n    PEMKeyFile: /path/to/mongodb.pem\n    CAFile: /path/to/ca.pem\n"})}),"\n",(0,i.jsx)(e.h4,{id:"343-\u5B57\u6BB5\u7EA7\u52A0\u5BC6",children:"3.4.3 \u5B57\u6BB5\u7EA7\u52A0\u5BC6"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB 4.2+\u652F\u6301\u5BA2\u6237\u7AEF\u5B57\u6BB5\u7EA7\u52A0\u5BC6\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFA\u52A0\u5BC6\u96C6\u5408\ndb.createCollection("patients", {\n  validator: {\n    $jsonSchema: {\n      bsonType: "object",\n      properties: {\n        name: {\n          encrypt: {\n            bsonType: "string",\n            algorithm: "AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic"\n          }\n        },\n        ssn: {\n          encrypt: {\n            bsonType: "string",\n            algorithm: "AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic"\n          }\n        },\n        bloodType: {\n          encrypt: {\n            bsonType: "string",\n            algorithm: "AEAD_AES_256_CBC_HMAC_SHA_512-Random"\n          }\n        },\n        medicalRecords: {\n          encrypt: {\n            bsonType: "object",\n            algorithm: "AEAD_AES_256_CBC_HMAC_SHA_512-Random"\n          }\n        }\n      }\n    }\n  }\n})\n'})}),"\n",(0,i.jsx)(e.h4,{id:"344-\u5BA1\u8BA1",children:"3.4.4 \u5BA1\u8BA1"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB Enterprise\u7248\u652F\u6301\u5BA1\u8BA1\u529F\u80FD\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'# mongod.conf\nauditLog:\n  destination: file\n  format: JSON\n  path: /var/log/mongodb/audit.json\n  filter: \'{ atype: { $in: ["authenticate", "createUser", "dropUser"] } }\'\n'})}),"\n",(0,i.jsx)(e.h3,{id:"35-\u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7",children:"3.5 \u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7"}),"\n",(0,i.jsx)(e.p,{children:"\u9AD8\u6548\u8FD0\u7EF4MongoDB\u9700\u8981\u6301\u7EED\u76D1\u63A7\u548C\u4F18\u5316\u7CFB\u7EDF\u6027\u80FD\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"351-\u67E5\u8BE2\u4F18\u5316",children:"3.5.1 \u67E5\u8BE2\u4F18\u5316"}),"\n",(0,i.jsxs)(e.p,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"explain()"}),"\u5206\u6790\u67E5\u8BE2\u6267\u884C\u8BA1\u5212\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u57FA\u672C\u6267\u884C\u8BA1\u5212\ndb.users.find({ age: { $gt: 30 } }).explain()\n\n// \u8BE6\u7EC6\u6267\u884C\u4FE1\u606F\ndb.users.find({ age: { $gt: 30 } }).explain("executionStats")\n\n// \u6240\u6709\u6267\u884C\u8BA1\u5212\ndb.users.find({ age: { $gt: 30 } }).explain("allPlansExecution")\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u67E5\u8BE2\u4F18\u5316\u6280\u5DE7\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"hint()"}),"\u5F3A\u5236\u4F7F\u7528\u7279\u5B9A\u7D22\u5F15"]}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5F53\u6295\u5F71\u4EC5\u8FD4\u56DE\u5FC5\u8981\u5B57\u6BB5"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u9002\u5F53\u7684\u7D22\u5F15\u8986\u76D6\u67E5\u8BE2"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u6B63\u5219\u8868\u8FBE\u5F0F\u524D\u7F00\u901A\u914D\u7B26"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"352-\u7D22\u5F15\u4F18\u5316",children:"3.5.2 \u7D22\u5F15\u4F18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"\u4F18\u5316\u7D22\u5F15\u7B56\u7565\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u652F\u6301\u67E5\u8BE2\u7684\u7D22\u5F15"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u521B\u5EFA\u5197\u4F59\u7D22\u5F15"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u671F\u68C0\u67E5\u7D22\u5F15\u4F7F\u7528\u60C5\u51B5"}),"\n",(0,i.jsx)(e.li,{children:"\u5728\u540E\u53F0\u521B\u5EFA\u5927\u578B\u7D22\u5F15"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u67E5\u770B\u7D22\u5F15\u4F7F\u7528\u7EDF\u8BA1\ndb.users.aggregate([{ $indexStats: {} }])\n\n// \u67E5\u627E\u672A\u4F7F\u7528\u7684\u7D22\u5F15\ndb.adminCommand({ serverStatus: 1 }).metrics.commands\n\n// \u5728\u540E\u53F0\u521B\u5EFA\u7D22\u5F15\ndb.users.createIndex({ email: 1 }, { background: true })\n"})}),"\n",(0,i.jsx)(e.h4,{id:"353-mongodb-compass",children:"3.5.3 MongoDB Compass"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB Compass\u662F\u5B98\u65B9GUI\u5DE5\u5177\uFF0C\u63D0\u4F9B\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6570\u636E\u53EF\u89C6\u5316"}),"\n",(0,i.jsx)(e.li,{children:"\u6027\u80FD\u5206\u6790"}),"\n",(0,i.jsx)(e.li,{children:"\u7D22\u5F15\u5EFA\u8BAE"}),"\n",(0,i.jsx)(e.li,{children:"\u805A\u5408\u7BA1\u9053\u6784\u5EFA"}),"\n",(0,i.jsx)(e.li,{children:"\u6A21\u5F0F\u53EF\u89C6\u5316"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"354-mongodb-atlas\u76D1\u63A7",children:"3.5.4 MongoDB Atlas\u76D1\u63A7"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB Atlas\u4E91\u670D\u52A1\u63D0\u4F9B\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65F6\u6027\u80FD\u76D1\u63A7"}),"\n",(0,i.jsx)(e.li,{children:"\u81EA\u52A8\u5316\u8B66\u62A5"}),"\n",(0,i.jsx)(e.li,{children:"\u67E5\u8BE2\u6027\u80FD\u5206\u6790"}),"\n",(0,i.jsx)(e.li,{children:"\u5BB9\u91CF\u89C4\u5212"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65F6\u65E5\u5FD7\u67E5\u770B"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"4-spring-boot\u4E0Emongodb\u96C6\u6210\u6700\u4F73\u5B9E\u8DF5",children:"4. Spring Boot\u4E0EMongoDB\u96C6\u6210\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.p,{children:"Spring Boot\u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684\u5DE5\u5177\u548C\u62BD\u8C61\uFF0C\u4F7FMongoDB\u96C6\u6210\u53D8\u5F97\u7B80\u5355\u800C\u5F3A\u5927\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"41-\u914D\u7F6Emongodb\u8FDE\u63A5",children:"4.1 \u914D\u7F6EMongoDB\u8FDE\u63A5"}),"\n",(0,i.jsx)(e.h4,{id:"411-\u6DFB\u52A0\u4F9D\u8D56",children:"4.1.1 \u6DFB\u52A0\u4F9D\u8D56"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728",(0,i.jsx)(e.code,{children:"pom.xml"}),"\u4E2D\u6DFB\u52A0\u5FC5\u8981\u4F9D\u8D56\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"\x3c!-- Spring Data MongoDB --\x3e\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-mongodb</artifactId>\n</dependency>\n\n\x3c!-- \u53EF\u9009\uFF1ALombok\u7B80\u5316\u4EE3\u7801 --\x3e\n<dependency>\n    <groupId>org.projectlombok</groupId>\n    <artifactId>lombok</artifactId>\n    <optional>true</optional>\n</dependency>\n"})}),"\n",(0,i.jsx)(e.h4,{id:"412-\u914D\u7F6E\u8FDE\u63A5",children:"4.1.2 \u914D\u7F6E\u8FDE\u63A5"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728",(0,i.jsx)(e.code,{children:"application.yml"}),"\u4E2D\u914D\u7F6EMongoDB\u8FDE\u63A5\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5355\u673A\u8FDE\u63A5"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\n  data:\n    mongodb:\n      uri: mongodb://username:password@localhost:27017/database\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u590D\u5236\u96C6\u8FDE\u63A5"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\n  data:\n    mongodb:\n      uri: mongodb://user:password@server1:27017,server2:27017,server3:27017/database?replicaSet=rs0&authSource=admin\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9AD8\u7EA7\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"spring:\n  data:\n    mongodb:\n      uri: mongodb://user:password@localhost:27017/database\n      auto-index-creation: true\n      field-naming-strategy: org.springframework.data.mapping.model.SnakeCaseFieldNamingStrategy\n      grid-fs-database: files\n      authentication-database: admin\n      uuid-representation: standard\n      connection-pool:\n        max-connection-life-time: 30000\n        max-idle-time: 60000\n        max-size: 100\n        min-size: 10\n"})}),"\n",(0,i.jsx)(e.h3,{id:"42-\u5B9A\u4E49\u6587\u6863\u6620\u5C04",children:"4.2 \u5B9A\u4E49\u6587\u6863\u6620\u5C04"}),"\n",(0,i.jsx)(e.h4,{id:"421-\u57FA\u672C\u6587\u6863\u6620\u5C04",children:"4.2.1 \u57FA\u672C\u6587\u6863\u6620\u5C04"}),"\n",(0,i.jsxs)(e.p,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"@Document"}),"\u6CE8\u89E3\u5C06Java\u7C7B\u6620\u5C04\u5230MongoDB\u96C6\u5408\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import org.springframework.data.mongodb.core.mapping.Document;\nimport org.springframework.data.annotation.Id;\nimport lombok.Data;\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n@Data\n@Document(collection = "products")\npublic class Product {\n    @Id\n    private String id;\n    \n    private String name;\n    private String description;\n    private double price;\n    private int stock;\n    \n    private List<String> categories;\n    \n    @Field("tech_specs")\n    private Map<String, String> technicalSpecifications;\n    \n    private LocalDateTime createdAt;\n    private LocalDateTime updatedAt;\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"422-\u7D22\u5F15\u914D\u7F6E",children:"4.2.2 \u7D22\u5F15\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.p,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"@Indexed"}),"\u6CE8\u89E3\u5B9A\u4E49\u7D22\u5F15\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Document(collection = "users")\npublic class User {\n    @Id\n    private String id;\n    \n    @Indexed(unique = true)\n    private String email;\n    \n    @Indexed\n    private String lastName;\n    \n    @TextIndexed\n    private String bio;\n    \n    @Indexed(direction = IndexDirection.DESCENDING)\n    private LocalDateTime createdAt;\n    \n    @CompoundIndex(name = "location_idx", def = "{\'address.city\': 1, \'address.country\': 1}")\n    private Address address;\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"423-\u5D4C\u5165\u5F0F\u6587\u6863",children:"4.2.3 \u5D4C\u5165\u5F0F\u6587\u6863"}),"\n",(0,i.jsx)(e.p,{children:"\u8868\u793A\u5D4C\u5165\u5F0F\u6587\u6863\u7ED3\u6784\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Data\npublic class Address {\n    private String street;\n    private String city;\n    private String state;\n    private String zipCode;\n    private String country;\n    \n    @GeoSpatialIndexed(type = GeoSpatialIndexType.GEO_2DSPHERE)\n    private GeoJsonPoint location;\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"424-dbref\u5F15\u7528",children:"4.2.4 DBRef\u5F15\u7528"}),"\n",(0,i.jsxs)(e.p,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"@DBRef"}),"\u8868\u793A\u6587\u6863\u5F15\u7528\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Document(collection = "orders")\npublic class Order {\n    @Id\n    private String id;\n    \n    @DBRef\n    private User customer;\n    \n    private List<OrderItem> items;\n    \n    private double totalAmount;\n    private String status;\n    private LocalDateTime orderDate;\n}\n\n@Data\npublic class OrderItem {\n    @DBRef(lazy = true)\n    private Product product;\n    \n    private int quantity;\n    private double price;\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"43-\u4F7F\u7528spring-data-mongodb-repository",children:"4.3 \u4F7F\u7528Spring Data MongoDB Repository"}),"\n",(0,i.jsx)(e.h4,{id:"431-\u57FA\u672Crepository\u63A5\u53E3",children:"4.3.1 \u57FA\u672CRepository\u63A5\u53E3"}),"\n",(0,i.jsxs)(e.p,{children:["\u521B\u5EFA\u7EE7\u627F",(0,i.jsx)(e.code,{children:"MongoRepository"}),"\u7684\u63A5\u53E3\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"import org.springframework.data.mongodb.repository.MongoRepository;\n\npublic interface ProductRepository extends MongoRepository<Product, String> {\n    // \u81EA\u52A8\u5B9E\u73B0\u5E38\u7528CRUD\u64CD\u4F5C\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"432-\u81EA\u5B9A\u4E49\u67E5\u8BE2\u65B9\u6CD5",children:"4.3.2 \u81EA\u5B9A\u4E49\u67E5\u8BE2\u65B9\u6CD5"}),"\n",(0,i.jsx)(e.p,{children:"\u57FA\u4E8E\u65B9\u6CD5\u540D\u5B9A\u4E49\u67E5\u8BE2\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public interface ProductRepository extends MongoRepository<Product, String> {\n    // \u67E5\u627E\u7279\u5B9A\u4EF7\u683C\u8303\u56F4\u5185\u7684\u4EA7\u54C1\n    List<Product> findByPriceBetween(double minPrice, double maxPrice);\n    \n    // \u67E5\u627E\u7279\u5B9A\u7C7B\u522B\u7684\u4EA7\u54C1\uFF0C\u5E76\u6309\u4EF7\u683C\u6392\u5E8F\n    List<Product> findByCategoriesContainingOrderByPriceAsc(String category);\n    \n    // \u4F7F\u7528\u6B63\u5219\u8868\u8FBE\u5F0F\u67E5\u627E\u540D\u79F0\u5339\u914D\u7684\u4EA7\u54C1\n    List<Product> findByNameRegex(String nameRegex);\n    \n    // \u7EDF\u8BA1\u5E93\u5B58\u4F4E\u4E8E\u6307\u5B9A\u503C\u7684\u4EA7\u54C1\u6570\u91CF\n    long countByStockLessThan(int threshold);\n    \n    // \u67E5\u627E\u67D0\u4E2A\u65E5\u671F\u4E4B\u540E\u521B\u5EFA\u7684\u4EA7\u54C1\n    List<Product> findByCreatedAtAfter(LocalDateTime date);\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"433-\u4F7F\u7528query\u6CE8\u89E3",children:"4.3.3 \u4F7F\u7528@Query\u6CE8\u89E3"}),"\n",(0,i.jsx)(e.p,{children:"\u4F7F\u7528MongoDB\u539F\u751F\u67E5\u8BE2\u8BED\u6CD5\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public interface UserRepository extends MongoRepository<User, String> {\n    // \u4F7F\u7528JSON\u67E5\u8BE2\n    @Query(\"{ 'age': { $gte: ?0, $lte: ?1 } }\")\n    List<User> findUsersInAgeRange(int minAge, int maxAge);\n    \n    // \u5B57\u6BB5\u6295\u5F71\n    @Query(value = \"{ 'status': ?0 }\", fields = \"{ 'name': 1, 'email': 1 }\")\n    List<User> findActiveUsersWithProjection(String status);\n    \n    // \u66F4\u65B0\u67E5\u8BE2\n    @Query(\"{ 'email': ?0 }\")\n    @Update(\"{ '$set': { 'status': ?1, 'lastLoginDate': ?2 } }\")\n    void updateUserStatus(String email, String status, LocalDateTime lastLogin);\n    \n    // \u805A\u5408\u7BA1\u9053\n    @Aggregation(\"{ $match: { 'department': ?0 } }, \"\n               + \"{ $group: { '_id': '$jobTitle', 'avgSalary': { $avg: '$salary' } } }, \"\n               + \"{ $sort: { 'avgSalary': -1 } }\")\n    List<Document> getAverageSalaryByJobTitle(String department);\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"434-\u5206\u9875\u4E0E\u6392\u5E8F",children:"4.3.4 \u5206\u9875\u4E0E\u6392\u5E8F"}),"\n",(0,i.jsx)(e.p,{children:"\u5B9E\u73B0\u5206\u9875\u67E5\u8BE2\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@GetMapping("/products")\npublic Page<Product> getProducts(\n    @RequestParam(defaultValue = "0") int page,\n    @RequestParam(defaultValue = "10") int size,\n    @RequestParam(defaultValue = "name") String sortBy\n) {\n    Pageable pageable = PageRequest.of(page, size, Sort.by(sortBy));\n    return productRepository.findAll(pageable);\n}\n\n// \u81EA\u5B9A\u4E49\u5206\u9875\u65B9\u6CD5\nPage<Product> findByCategoryAndPriceGreaterThan(\n    String category, double price, Pageable pageable);\n'})}),"\n",(0,i.jsx)(e.h3,{id:"44-\u4F7F\u7528mongotemplate\u8FDB\u884C\u9AD8\u7EA7\u64CD\u4F5C",children:"4.4 \u4F7F\u7528MongoTemplate\u8FDB\u884C\u9AD8\u7EA7\u64CD\u4F5C"}),"\n",(0,i.jsxs)(e.p,{children:["\u5BF9\u4E8E\u66F4\u590D\u6742\u7684\u64CD\u4F5C\uFF0C",(0,i.jsx)(e.code,{children:"MongoTemplate"}),"\u63D0\u4F9B\u4E86\u76F4\u63A5\u8BBF\u95EEMongoDB\u7684\u80FD\u529B\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class ProductService {\n    private final MongoTemplate mongoTemplate;\n    \n    public ProductService(MongoTemplate mongoTemplate) {\n        this.mongoTemplate = mongoTemplate;\n    }\n    \n    // \u4F7F\u7528criteria\u6784\u5EFA\u52A8\u6001\u67E5\u8BE2\n    public List<Product> findProductsByDynamicCriteria(String name, \n                                                      List<String> categories, \n                                                      Double minPrice, \n                                                      Double maxPrice) {\n        Criteria criteria = new Criteria();\n        \n        List<Criteria> filters = new ArrayList<>();\n        \n        if (name != null) {\n            filters.add(Criteria.where("name").regex(name, "i"));\n        }\n        \n        if (categories != null && !categories.isEmpty()) {\n            filters.add(Criteria.where("categories").in(categories));\n        }\n        \n        if (minPrice != null && maxPrice != null) {\n            filters.add(Criteria.where("price").gte(minPrice).lte(maxPrice));\n        } else if (minPrice != null) {\n            filters.add(Criteria.where("price").gte(minPrice));\n        } else if (maxPrice != null) {\n            filters.add(Criteria.where("price").lte(maxPrice));\n        }\n        \n        if (!filters.isEmpty()) {\n            criteria = new Criteria().andOperator(\n                filters.toArray(new Criteria[0]));\n        }\n        \n        Query query = new Query(criteria);\n        return mongoTemplate.find(query, Product.class);\n    }\n    \n    // \u4F7F\u7528\u66F4\u65B0\u64CD\u4F5C\u7B26\n    public long updateProductPrices(String category, double percentage) {\n        Query query = new Query(Criteria.where("categories").is(category));\n        Update update = new Update().multiply("price", 1 + (percentage / 100));\n        UpdateResult result = mongoTemplate.updateMulti(query, update, Product.class);\n        return result.getModifiedCount();\n    }\n    \n    // \u6267\u884C\u805A\u5408\u64CD\u4F5C\n    public List<CategoryStat> getProductStatsByCategory() {\n        TypedAggregation<Product> aggregation = Aggregation.newAggregation(\n            Product.class,\n            Aggregation.unwind("categories"),\n            Aggregation.group("categories")\n                .count().as("count")\n                .avg("price").as("averagePrice")\n                .max("price").as("maxPrice"),\n            Aggregation.sort(Sort.Direction.DESC, "count")\n        );\n        \n        AggregationResults<CategoryStat> results = \n            mongoTemplate.aggregate(aggregation, CategoryStat.class);\n        \n        return results.getMappedResults();\n    }\n    \n    // \u5730\u7406\u7A7A\u95F4\u67E5\u8BE2\n    public List<Store> findNearbyStores(double latitude, double longitude, double maxDistance) {\n        Point location = new Point(longitude, latitude);\n        Query query = new Query(\n            Criteria.where("location").nearSphere(location)\n                .maxDistance(maxDistance / 6378.1) // \u8F6C\u6362\u4E3A\u5F27\u5EA6\n        );\n        return mongoTemplate.find(query, Store.class);\n    }\n    \n    // \u6279\u91CF\u64CD\u4F5C\n    public void bulkUpsertProducts(List<Product> products) {\n        BulkOperations bulkOps = mongoTemplate.bulkOps(\n            BulkOperations.BulkMode.UNORDERED, Product.class);\n        \n        for (Product product : products) {\n            Query query = new Query(Criteria.where("sku").is(product.getSku()));\n            Update update = getProductUpdateDefinition(product);\n            bulkOps.upsert(query, update);\n        }\n        \n        BulkWriteResult result = bulkOps.execute();\n        System.out.println("Inserted: " + result.getInsertedCount());\n        System.out.println("Modified: " + result.getModifiedCount());\n    }\n    \n    private Update getProductUpdateDefinition(Product product) {\n        Update update = new Update();\n        // \u8BBE\u7F6E\u6240\u6709\u4EA7\u54C1\u5B57\u6BB5...\n        update.set("name", product.getName());\n        update.set("price", product.getPrice());\n        // ...\u5176\u4ED6\u5B57\u6BB5\n        update.set("updatedAt", LocalDateTime.now());\n        return update;\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"45-\u4E8B\u52A1\u7BA1\u7406",children:"4.5 \u4E8B\u52A1\u7BA1\u7406"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB 4.0+\u652F\u6301\u591A\u6587\u6863\u4E8B\u52A1\uFF0CSpring Data MongoDB\u63D0\u4F9B\u4E86\u4E8B\u52A1\u652F\u6301\uFF1A"}),"\n",(0,i.jsx)(e.h4,{id:"451-\u914D\u7F6E\u4E8B\u52A1\u7BA1\u7406\u5668",children:"4.5.1 \u914D\u7F6E\u4E8B\u52A1\u7BA1\u7406\u5668"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class MongoConfig extends AbstractMongoClientConfiguration {\n    \n    @Override\n    protected String getDatabaseName() {\n        return "mydatabase";\n    }\n    \n    @Bean\n    MongoTransactionManager transactionManager(MongoDatabaseFactory dbFactory) {\n        return new MongoTransactionManager(dbFactory);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"452-\u4F7F\u7528\u58F0\u660E\u5F0F\u4E8B\u52A1",children:"4.5.2 \u4F7F\u7528\u58F0\u660E\u5F0F\u4E8B\u52A1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class OrderService {\n    \n    private final OrderRepository orderRepository;\n    private final ProductRepository productRepository;\n    private final CustomerRepository customerRepository;\n    \n    // \u6784\u9020\u51FD\u6570\u6CE8\u5165...\n    \n    @Transactional\n    public Order createOrder(OrderRequest request) {\n        // \u68C0\u67E5\u5BA2\u6237\u662F\u5426\u5B58\u5728\n        Customer customer = customerRepository.findById(request.getCustomerId())\n            .orElseThrow(() -> new EntityNotFoundException("Customer not found"));\n            \n        // \u68C0\u67E5\u5E76\u66F4\u65B0\u4EA7\u54C1\u5E93\u5B58\n        List<OrderItem> items = new ArrayList<>();\n        for (OrderItemRequest itemReq : request.getItems()) {\n            Product product = productRepository.findById(itemReq.getProductId())\n                .orElseThrow(() -> new EntityNotFoundException("Product not found"));\n                \n            if (product.getStock() < itemReq.getQuantity()) {\n                throw new InsufficientStockException("Not enough stock for product: " + product.getName());\n            }\n            \n            // \u51CF\u5C11\u5E93\u5B58\n            product.setStock(product.getStock() - itemReq.getQuantity());\n            productRepository.save(product);\n            \n            // \u521B\u5EFA\u8BA2\u5355\u9879\n            OrderItem item = new OrderItem();\n            item.setProduct(product);\n            item.setQuantity(itemReq.getQuantity());\n            item.setPrice(product.getPrice());\n            items.add(item);\n        }\n        \n        // \u521B\u5EFA\u8BA2\u5355\n        Order order = new Order();\n        order.setCustomer(customer);\n        order.setItems(items);\n        order.setStatus("CREATED");\n        order.setOrderDate(LocalDateTime.now());\n        order.setTotalAmount(calculateTotalAmount(items));\n        \n        return orderRepository.save(order);\n    }\n    \n    private double calculateTotalAmount(List<OrderItem> items) {\n        return items.stream()\n            .mapToDouble(item -> item.getPrice() * item.getQuantity())\n            .sum();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"453-\u7F16\u7A0B\u5F0F\u4E8B\u52A1",children:"4.5.3 \u7F16\u7A0B\u5F0F\u4E8B\u52A1"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Service\npublic class InventoryService {\n    \n    private final MongoTemplate mongoTemplate;\n    private final TransactionTemplate transactionTemplate;\n    \n    public InventoryService(MongoTemplate mongoTemplate, \n                           PlatformTransactionManager transactionManager) {\n        this.mongoTemplate = mongoTemplate;\n        this.transactionTemplate = new TransactionTemplate(transactionManager);\n    }\n    \n    public boolean transferStock(String fromProductId, String toProductId, int quantity) {\n        return transactionTemplate.execute(status -> {\n            try {\n                // \u4ECE\u6E90\u4EA7\u54C1\u51CF\u5C11\u5E93\u5B58\n                Query fromQuery = new Query(Criteria.where("_id").is(fromProductId)\n                    .and("stock").gte(quantity));\n                Update fromUpdate = new Update().inc("stock", -quantity);\n                UpdateResult fromResult = mongoTemplate.updateFirst(\n                    fromQuery, fromUpdate, Product.class);\n                \n                if (fromResult.getModifiedCount() == 0) {\n                    status.setRollbackOnly();\n                    return false;\n                }\n                \n                // \u5411\u76EE\u6807\u4EA7\u54C1\u589E\u52A0\u5E93\u5B58\n                Query toQuery = new Query(Criteria.where("_id").is(toProductId));\n                Update toUpdate = new Update().inc("stock", quantity);\n                mongoTemplate.updateFirst(toQuery, toUpdate, Product.class);\n                \n                return true;\n            } catch (Exception e) {\n                status.setRollbackOnly();\n                throw e;\n            }\n        });\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"5-mongodb\u6027\u80FD\u4F18\u5316",children:"5. MongoDB\u6027\u80FD\u4F18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u6027\u80FD\u4F18\u5316\u662F\u4E00\u4E2A\u591A\u5C42\u6B21\u7684\u5DE5\u7A0B\uFF0C\u6D89\u53CA\u4ECE\u786C\u4EF6\u914D\u7F6E\u5230\u5E94\u7528\u8BBE\u8BA1\u7684\u5404\u4E2A\u73AF\u8282\u3002\u672C\u8282\u5C06\u5168\u9762\u4ECB\u7ECDMongoDB\u6027\u80FD\u4F18\u5316\u7684\u5173\u952E\u7B56\u7565\u548C\u6700\u4F73\u5B9E\u8DF5\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"51-\u786C\u4EF6\u4E0E\u7CFB\u7EDF\u4F18\u5316",children:"5.1 \u786C\u4EF6\u4E0E\u7CFB\u7EDF\u4F18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u6027\u80FD\u5728\u5F88\u5927\u7A0B\u5EA6\u4E0A\u53D7\u5230\u5E95\u5C42\u786C\u4EF6\u548C\u64CD\u4F5C\u7CFB\u7EDF\u7684\u5F71\u54CD\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"511-\u786C\u4EF6\u9009\u62E9",children:"5.1.1 \u786C\u4EF6\u9009\u62E9"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5B58\u50A8\u7C7B\u578B"}),"\uFF1A\u4F7F\u7528SSD/NVMe\u66FF\u4EE3HDD\uFF0C\u5C24\u5176\u662F\u5BF9\u4E8E\u9891\u7E41\u5199\u5165\u548C\u968F\u673A\u8BFB\u53D6\u573A\u666F"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u5BB9\u91CF"}),"\uFF1AMongoDB\u5229\u7528\u5185\u5B58\u6620\u5C04\u6587\u4EF6\u673A\u5236\uFF0C\u7406\u60F3\u60C5\u51B5\u4E0B\u5DE5\u4F5C\u96C6\u5E94\u5B8C\u5168\u9002\u5408RAM"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"CPU"}),"\uFF1A\u591A\u6838CPU\u6709\u5229\u4E8E\u5E76\u53D1\u64CD\u4F5C\u548C\u805A\u5408\u6846\u67B6\u7684\u5E76\u884C\u6267\u884C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7F51\u7EDC"}),"\uFF1A\u4F7F\u7528\u81F3\u5C11\u5343\u5146\u7F51\u7EDC\uFF0C\u5BF9\u5206\u7247\u96C6\u7FA4\u5C24\u4E3A\u91CD\u8981"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"512-\u64CD\u4F5C\u7CFB\u7EDF\u914D\u7F6E",children:"5.1.2 \u64CD\u4F5C\u7CFB\u7EDF\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Linux\u7CFB\u7EDF\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u6587\u4EF6\u63CF\u8FF0\u7B26\u9650\u5236\uFF08\u5BF9\u8FDE\u63A5\u6570\u91CF\u5F88\u91CD\u8981\uFF09\nsudo sysctl -w fs.file-max=100000\nsudo sysctl -w fs.nr_open=100000\n\n# \u7981\u7528\u900F\u660E\u5927\u9875\u9762\uFF08\u6781\u5176\u91CD\u8981\uFF09\necho never > /sys/kernel/mm/transparent_hugepage/enabled\necho never > /sys/kernel/mm/transparent_hugepage/defrag\n\n# readahead\u8BBE\u7F6E\uFF08\u9002\u7528\u4E8ESSD\uFF09\nsudo blockdev --setra 32 /dev/sda\n\n# \u589E\u52A0vm.swappiness\uFF08\u51CF\u5C11swap\u4F7F\u7528\uFF09\nsudo sysctl -w vm.swappiness=1\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5C06\u8FD9\u4E9B\u8BBE\u7F6E\u6DFB\u52A0\u5230",(0,i.jsx)(e.code,{children:"/etc/sysctl.conf"}),"\u4E2D\u4F7F\u5176\u6C38\u4E45\u751F\u6548\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"52-mongodb\u5B9E\u4F8B\u4F18\u5316",children:"5.2 MongoDB\u5B9E\u4F8B\u4F18\u5316"}),"\n",(0,i.jsx)(e.h4,{id:"521-\u5173\u952E\u914D\u7F6E\u53C2\u6570",children:"5.2.1 \u5173\u952E\u914D\u7F6E\u53C2\u6570"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"WiredTiger\u5B58\u50A8\u5F15\u64CE\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"storage:\n  wiredTiger:\n    engineConfig:\n      cacheSizeGB: 4  # \u9ED8\u8BA4\u662F\u7269\u7406\u5185\u5B58\u7684\u4E00\u534A\n      journalCompressor: snappy  # \u65E5\u5FD7\u538B\u7F29\u7B97\u6CD5\n    collectionConfig:\n      blockCompressor: snappy  # \u6570\u636E\u538B\u7F29\u7B97\u6CD5\n    indexConfig:\n      prefixCompression: true  # \u7D22\u5F15\u524D\u7F00\u538B\u7F29\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FDE\u63A5\u4E0E\u7F51\u7EDC\u8BBE\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"net:\n  maxIncomingConnections: 2000  # \u6700\u5927\u8FDE\u63A5\u6570\n  port: 27017\n  bindIp: localhost,192.168.1.100  # \u7ED1\u5B9A\u591A\u4E2AIP\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u64CD\u4F5C\u9650\u5236"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"operationProfiling:\n  mode: slowOp  # \u6162\u67E5\u8BE2\u8BB0\u5F55\u6A21\u5F0F\n  slowOpThresholdMs: 100  # \u6162\u67E5\u8BE2\u9608\u503C(\u6BEB\u79D2)\n"})}),"\n",(0,i.jsx)(e.h4,{id:"522-\u5206\u6790\u4E0E\u8C03\u4F18\u5DE5\u5177",children:"5.2.2 \u5206\u6790\u4E0E\u8C03\u4F18\u5DE5\u5177"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"mongostat"}),"\uFF1A\u76D1\u63A7\u5B9E\u4F8B\u6574\u4F53\u6027\u80FD"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"mongotop"}),"\uFF1A\u8BC6\u522B\u96C6\u5408\u7EA7\u522B\u7684\u8BFB\u5199\u6D3B\u52A8"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"MongoDB Compass"}),"\uFF1A\u53EF\u89C6\u5316\u5206\u6790\u5DE5\u5177"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Database Profiler"}),"\uFF1A\u8BE6\u7EC6\u5206\u6790\u6162\u67E5\u8BE2"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u542F\u7528\u6570\u636E\u5E93\u5206\u6790\u5668\ndb.setProfilingLevel(1, { slowms: 100 })\n\n// \u67E5\u8BE2\u6162\u64CD\u4F5C\ndb.system.profile.find({ millis: { $gt: 100 } }).sort({ ts: -1 })\n"})}),"\n",(0,i.jsx)(e.h3,{id:"53-\u6570\u636E\u6A21\u578B\u4E0E\u7D22\u5F15\u4F18\u5316",children:"5.3 \u6570\u636E\u6A21\u578B\u4E0E\u7D22\u5F15\u4F18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7684\u6027\u80FD\u5F88\u5927\u7A0B\u5EA6\u4E0A\u53D6\u51B3\u4E8E\u6570\u636E\u6A21\u578B\u8BBE\u8BA1\u548C\u7D22\u5F15\u7B56\u7565\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"531-\u6570\u636E\u6A21\u578B\u4F18\u5316",children:"5.3.1 \u6570\u636E\u6A21\u578B\u4F18\u5316"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6587\u6863\u7ED3\u6784\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6309\u8BBF\u95EE\u6A21\u5F0F\u8BBE\u8BA1"}),"\uFF1A\u5E38\u4E00\u8D77\u8BBF\u95EE\u7684\u6570\u636E\u5E94\u653E\u5728\u4E00\u8D77"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907F\u514D\u8FC7\u5927\u6587\u6863"}),"\uFF1A\u63A5\u8FD116MB\u9650\u5236\u7684\u6587\u6863\u4F1A\u5F71\u54CD\u6027\u80FD"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907F\u514D\u4E0D\u65AD\u589E\u957F\u7684\u6570\u7EC4"}),"\uFF1A\u5927\u578B\u6570\u7EC4\u53EF\u80FD\u5BFC\u81F4\u6587\u6863\u5927\u5C0F\u4E0D\u65AD\u589E\u957F"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u63A7\u5236\u5D4C\u5957\u6DF1\u5EA6"}),"\uFF1A\u6DF1\u5EA6\u5D4C\u5957\u6587\u6863\u589E\u52A0\u67E5\u8BE2\u590D\u6742\u5EA6"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u6709\u6548\u7684\u5D4C\u5165\u5F0F\u6587\u6863\u8BBE\u8BA1\n{\n  "_id": ObjectId("..."),\n  "order_id": "ORD123456",\n  "customer": {  // \u5D4C\u5165\u5E38\u7528\u4FE1\u606F\n    "id": "CUST789",\n    "name": "\u674E\u56DB",\n    "contact": "+86123456789"\n  },\n  "items": [  // \u63A7\u5236\u6570\u7EC4\u5927\u5C0F\n    {\n      "product_id": "PROD001",\n      "name": "\u5546\u54C1A",\n      "quantity": 2,\n      "price": 299\n    },\n    // \u901A\u5E38\u4E0D\u8D85\u8FC7100\u4E2A\u5143\u7D20\n  ]\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"532-\u9AD8\u6548\u7D22\u5F15\u7B56\u7565",children:"5.3.2 \u9AD8\u6548\u7D22\u5F15\u7B56\u7565"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7D22\u5F15\u4F18\u5316\u539F\u5219"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8986\u76D6\u67E5\u8BE2\u7D22\u5F15"}),"\uFF1A\u4F7F\u7528\u5305\u542B\u6240\u6709\u67E5\u8BE2\u5B57\u6BB5\u7684\u7D22\u5F15"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9AD8\u9009\u62E9\u6027\u524D\u7F00"}),"\uFF1A\u5728\u590D\u5408\u7D22\u5F15\u4E2D\uFF0C\u5C06\u9AD8\u9009\u62E9\u6027\u5B57\u6BB5\u653E\u5728\u524D\u9762"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9002\u5F53\u7684\u7D22\u5F15\u57FA\u6570"}),"\uFF1A\u907F\u514D\u5728\u4F4E\u57FA\u6570\u5B57\u6BB5\u4E0A\u521B\u5EFA\u5355\u5B57\u6BB5\u7D22\u5F15"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7D22\u5F15\u4EA4\u96C6"}),"\uFF1A\u5229\u7528MongoDB\u7684\u7D22\u5F15\u4EA4\u96C6\u529F\u80FD"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907F\u514D\u8FC7\u591A\u7D22\u5F15"}),"\uFF1A\u6BCF\u4E2A\u7D22\u5F15\u90FD\u589E\u52A0\u5199\u5165\u5F00\u9500"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFA\u652F\u6301\u591A\u79CD\u67E5\u8BE2\u7684\u590D\u5408\u7D22\u5F15\ndb.orders.createIndex({ customer_id: 1, order_date: -1, status: 1 })\n\n// \u9AD8\u6548\u5904\u7406\u6392\u5E8F\u7684\u7D22\u5F15\ndb.products.createIndex({ category: 1, price: -1 })\n\n// \u4F7F\u7528hint\u5F3A\u5236\u4F7F\u7528\u7279\u5B9A\u7D22\u5F15\uFF08\u6D4B\u8BD5\u6027\u80FD\u65F6\u4F7F\u7528\uFF09\ndb.orders.find({ customer_id: "C1001", status: "PENDING" })\n  .hint({ customer_id: 1, order_date: -1, status: 1 })\n'})}),"\n",(0,i.jsx)(e.h4,{id:"533-\u5B9A\u671F\u7D22\u5F15\u7EF4\u62A4",children:"5.3.3 \u5B9A\u671F\u7D22\u5F15\u7EF4\u62A4"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u68C0\u67E5\u7D22\u5F15\u4F7F\u7528\u60C5\u51B5\ndb.collection.aggregate([{ $indexStats: {} }])\n\n// \u67E5\u627E\u672A\u4F7F\u7528\u7684\u7D22\u5F15\ndb.collection.aggregate([\n  { $indexStats: {} },\n  { $match: { accesses: { $elemMatch: { count: 0 } } } }\n])\n\n// \u5220\u9664\u672A\u4F7F\u7528\u7684\u7D22\u5F15\ndb.collection.dropIndex("unused_index_name")\n'})}),"\n",(0,i.jsx)(e.h3,{id:"54-\u67E5\u8BE2\u4F18\u5316\u6280\u672F",children:"5.4 \u67E5\u8BE2\u4F18\u5316\u6280\u672F"}),"\n",(0,i.jsx)(e.h4,{id:"541-\u67E5\u8BE2\u5206\u6790\u4E0E\u4F18\u5316",children:"5.4.1 \u67E5\u8BE2\u5206\u6790\u4E0E\u4F18\u5316"}),"\n",(0,i.jsxs)(e.p,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"explain()"}),"\u662F\u4F18\u5316\u67E5\u8BE2\u7684\u5173\u952E\u5DE5\u5177\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5206\u6790\u67E5\u8BE2\u8BA1\u5212\ndb.orders.find({ status: "COMPLETED", order_date: { $gt: ISODate("2023-01-01") } })\n  .sort({ total_amount: -1 })\n  .explain("executionStats")\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u5173\u6CE8\u4EE5\u4E0B\u6267\u884C\u8BA1\u5212\u4FE1\u606F\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"COLLSCAN vs. IXSCAN"}),"\uFF1A\u5168\u8868\u626B\u63CFvs\u7D22\u5F15\u626B\u63CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"indexBounds"}),"\uFF1A\u7D22\u5F15\u4F7F\u7528\u8303\u56F4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"nReturned vs. totalKeysExamined"}),"\uFF1A\u8FD4\u56DE\u6587\u6863\u6570vs\u68C0\u67E5\u7684\u7D22\u5F15\u952E\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"executionTimeMillis"}),"\uFF1A\u6267\u884C\u65F6\u95F4"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"542-\u6295\u5F71\u4F18\u5316",children:"5.4.2 \u6295\u5F71\u4F18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"\u4EC5\u67E5\u8BE2\u9700\u8981\u7684\u5B57\u6BB5\u53EF\u4EE5\u663E\u8457\u63D0\u9AD8\u6027\u80FD\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u8FD4\u56DE\u6240\u6709\u5B57\u6BB5\ndb.products.find({ category: "electronics" })\n\n// \u597D\u7684\u505A\u6CD5\uFF1A\u53EA\u8FD4\u56DE\u9700\u8981\u7684\u5B57\u6BB5\ndb.products.find(\n  { category: "electronics" }, \n  { name: 1, price: 1, stock: 1, _id: 0 }\n)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"543-\u6279\u91CF\u64CD\u4F5C\u4F18\u5316",children:"5.4.3 \u6279\u91CF\u64CD\u4F5C\u4F18\u5316"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u5355\u6761\u63D2\u5165\uFF08\u6548\u7387\u4F4E\uFF09\nfor (let i = 0; i < 10000; i++) {\n  db.items.insertOne({ value: i });\n}\n\n// \u6279\u91CF\u63D2\u5165\uFF08\u6548\u7387\u9AD8\uFF09\nconst items = [];\nfor (let i = 0; i < 10000; i++) {\n  items.push({ value: i });\n}\ndb.items.insertMany(items, { ordered: false });\n"})}),"\n",(0,i.jsx)(e.h4,{id:"544-\u8BFB\u53D6\u5206\u79BB\u4E0E\u67E5\u8BE2\u8DEF\u7531",children:"5.4.4 \u8BFB\u53D6\u5206\u79BB\u4E0E\u67E5\u8BE2\u8DEF\u7531"}),"\n",(0,i.jsx)(e.p,{children:"\u4F7F\u7528\u8BFB\u504F\u597D\u8BBE\u7F6E\u53EF\u4EE5\u4F18\u5316\u8BFB\u53D6\u6027\u80FD\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u5728Node.js\u9A71\u52A8\u4E2D\u914D\u7F6E\nconst client = new MongoClient(uri, {\n  readPreference: 'secondaryPreferred',\n  // \u5176\u4ED6\u9009\u9879...\n});\n\n// \u9488\u5BF9\u5177\u4F53\u64CD\u4F5C\u8BBE\u7F6E\ndb.collection('orders').find().readPref('secondary');\n"})}),"\n",(0,i.jsx)(e.h3,{id:"55-\u9AD8\u7EA7\u6027\u80FD\u4F18\u5316\u7B56\u7565",children:"5.5 \u9AD8\u7EA7\u6027\u80FD\u4F18\u5316\u7B56\u7565"}),"\n",(0,i.jsx)(e.h4,{id:"551-\u6570\u636E\u5206\u7247\u7B56\u7565",children:"5.5.1 \u6570\u636E\u5206\u7247\u7B56\u7565"}),"\n",(0,i.jsx)(e.p,{children:"\u6709\u6548\u7684\u5206\u7247\u7B56\u7565\u5BF9\u5927\u89C4\u6A21\u90E8\u7F72\u81F3\u5173\u91CD\u8981\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u9009\u62E9\u6B63\u786E\u7684\u5206\u7247\u952E\n// 1. \u5BF9\u4E8E\u5199\u5165\u5BC6\u96C6\u578B\u5DE5\u4F5C\u8D1F\u8F7D:\nsh.shardCollection("database.logs", { timestamp: 1 }) // \u65F6\u95F4\u6233\u5206\u7247\n\n// 2. \u5BF9\u4E8E\u8BFB\u53D6\u5BC6\u96C6\u578B\u5DE5\u4F5C\u8D1F\u8F7D:\nsh.shardCollection("database.users", { country: 1, user_id: 1 }) // \u590D\u5408\u5206\u7247\u952E\n\n// 3. \u5747\u5300\u5206\u5E03\u7684\u54C8\u5E0C\u5206\u7247\nsh.shardCollection("database.messages", { _id: "hashed" }) // \u907F\u514D\u70ED\u70B9\n'})}),"\n",(0,i.jsx)(e.h4,{id:"552-\u6570\u636E\u538B\u7F29\u4E0E\u5F52\u6863",children:"5.5.2 \u6570\u636E\u538B\u7F29\u4E0E\u5F52\u6863"}),"\n",(0,i.jsx)(e.p,{children:"\u5904\u7406\u5386\u53F2\u6570\u636E\u7684\u7B56\u7565\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u65F6\u95F4\u5E8F\u5217\u6570\u636E\u5F52\u6863\u793A\u4F8B\n// 1. \u521B\u5EFA\u6309\u6708\u5F52\u6863\u96C6\u5408\ndb.createCollection("logs_archive_202301")\n\n// 2. \u590D\u5236\u4E00\u6708\u6570\u636E\u5230\u5F52\u6863\u96C6\u5408\ndb.logs.aggregate([\n  { $match: { timestamp: { $gte: ISODate("2023-01-01"), $lt: ISODate("2023-02-01") } } },\n  { $out: "logs_archive_202301" }\n])\n\n// 3. \u5220\u9664\u539F\u96C6\u5408\u4E2D\u7684\u5F52\u6863\u6570\u636E\ndb.logs.deleteMany({ timestamp: { $gte: ISODate("2023-01-01"), $lt: ISODate("2023-02-01") } })\n'})}),"\n",(0,i.jsx)(e.h4,{id:"553-\u7F13\u5B58\u7B56\u7565",children:"5.5.3 \u7F13\u5B58\u7B56\u7565"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFATTL\u7D22\u5F15\u7528\u4E8E\u7F13\u5B58\u96C6\u5408\ndb.cache.createIndex({ "createdAt": 1 }, { expireAfterSeconds: 3600 }) // \u4E00\u5C0F\u65F6\u540E\u8FC7\u671F\n\n// \u7269\u5316\u89C6\u56FE\u5B9E\u73B0\ndb.createView("active_users_view", "users", [\n  { $match: { status: "active" } },\n  { $project: { name: 1, email: 1, last_login: 1 } }\n])\n'})}),"\n",(0,i.jsx)(e.h4,{id:"554-change-streams\u4E0E\u5B9E\u65F6\u76D1\u63A7",children:"5.5.4 Change Streams\u4E0E\u5B9E\u65F6\u76D1\u63A7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u76D1\u63A7\u96C6\u5408\u53D8\u5316\u8FDB\u884C\u7F13\u5B58\u5931\u6548\nconst changeStream = db.products.watch();\nchangeStream.on('change', (change) => {\n  if (change.operationType === 'update' || change.operationType === 'replace') {\n    // \u6E05\u9664\u7F13\u5B58\n    cache.del(`product:${change.documentKey._id}`);\n  }\n});\n"})}),"\n",(0,i.jsx)(e.h3,{id:"56-\u6027\u80FD\u6D4B\u8BD5\u4E0E\u57FA\u51C6",children:"5.6 \u6027\u80FD\u6D4B\u8BD5\u4E0E\u57FA\u51C6"}),"\n",(0,i.jsx)(e.p,{children:"\u4EE5\u4E0B\u662F\u4E00\u4E9B\u5E38\u89C1\u64CD\u4F5C\u7684\u6027\u80FD\u57FA\u51C6\u6BD4\u8F83\uFF1A"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u64CD\u4F5C\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u4F18\u5316\u524D(ms)"}),(0,i.jsx)(e.th,{children:"\u4F18\u5316\u540E(ms)"}),(0,i.jsx)(e.th,{children:"\u6539\u8FDB"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5927\u578B\u96C6\u5408\u70B9\u67E5\u8BE2"}),(0,i.jsx)(e.td,{children:"120"}),(0,i.jsx)(e.td,{children:"5"}),(0,i.jsx)(e.td,{children:"\u521B\u5EFA\u4E86\u7CBE\u786E\u7D22\u5F15"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5206\u9875\u67E5\u8BE2(\u8DF3\u8FC71000\u6761)"}),(0,i.jsx)(e.td,{children:"350"}),(0,i.jsx)(e.td,{children:"30"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528\u6E38\u6807\u5206\u9875\u4EE3\u66FFskip"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u590D\u6742\u805A\u5408\u64CD\u4F5C"}),(0,i.jsx)(e.td,{children:"1200"}),(0,i.jsx)(e.td,{children:"300"}),(0,i.jsx)(e.td,{children:"\u521B\u5EFA\u7269\u5316\u89C6\u56FE\u9884\u8BA1\u7B97"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6279\u91CF\u63D2\u5165(10000\u6761)"}),(0,i.jsx)(e.td,{children:"5000"}),(0,i.jsx)(e.td,{children:"800"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528\u6279\u5904\u7406\u548Cunordered\u63D2\u5165"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"57-\u76D1\u63A7\u4E0E\u9884\u8B66",children:"5.7 \u76D1\u63A7\u4E0E\u9884\u8B66"}),"\n",(0,i.jsx)(e.p,{children:"\u6709\u6548\u7684\u76D1\u63A7\u662F\u6027\u80FD\u4F18\u5316\u7684\u91CD\u8981\u7EC4\u6210\u90E8\u5206\uFF1A"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5173\u952E\u6307\u6807\u76D1\u63A7"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u64CD\u4F5C\u5EF6\u8FDF"}),"\n",(0,i.jsx)(e.li,{children:"\u8FDE\u63A5\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u7B49\u5F85"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u5B58\u4F7F\u7528"}),"\n",(0,i.jsx)(e.li,{children:"\u67E5\u8BE2\u7387"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u76D1\u63A7\u5DE5\u5177"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"MongoDB Atlas\u76D1\u63A7"}),"\n",(0,i.jsx)(e.li,{children:"Prometheus + Grafana"}),"\n",(0,i.jsx)(e.li,{children:"mongostat\u548Cmongotop"}),"\n",(0,i.jsx)(e.li,{children:"\u65E5\u5FD7\u5206\u6790"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9884\u8B66\u673A\u5236"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u54CD\u5E94\u65F6\u95F4\u8D85\u9608\u503C\u8B66\u62A5"}),"\n",(0,i.jsx)(e.li,{children:"\u8FDE\u63A5\u6570\u63A5\u8FD1\u6700\u5927\u503C\u8B66\u62A5"}),"\n",(0,i.jsx)(e.li,{children:"\u78C1\u76D8\u7A7A\u95F4\u4E0D\u8DB3\u8B66\u62A5"}),"\n",(0,i.jsx)(e.li,{children:"\u590D\u5236\u96C6\u5EF6\u8FDF\u8B66\u62A5"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"6-\u6700\u4F73\u5B9E\u8DF5\u4E0E\u8BBE\u8BA1\u6A21\u5F0F",children:"6. \u6700\u4F73\u5B9E\u8DF5\u4E0E\u8BBE\u8BA1\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.h3,{id:"61-mongodb\u67B6\u6784\u8BBE\u8BA1\u6700\u4F73\u5B9E\u8DF5",children:"6.1 MongoDB\u67B6\u6784\u8BBE\u8BA1\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.h4,{id:"611-\u9AD8\u53EF\u7528\u6027\u8BBE\u8BA1",children:"6.1.1 \u9AD8\u53EF\u7528\u6027\u8BBE\u8BA1"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u590D\u5236\u96C6\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u81F3\u5C113\u4E2A\u8282\u70B9\u7684\u590D\u5236\u96C6\uFF082\u4E2A\u6570\u636E\u8282\u70B9+1\u4E2A\u4EF2\u88C1\u8282\u70B9\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u5728\u4E0D\u540C\u670D\u52A1\u5668/\u673A\u67B6/\u6570\u636E\u4E2D\u5FC3\u90E8\u7F72\u8282\u70B9"}),"\n",(0,i.jsx)(e.li,{children:'\u914D\u7F6E\u9002\u5F53\u7684\u5199\u5165\u5173\u6CE8\u7EA7\u522B(w: "majority")'}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BD\u9002\u5F53\u7684\u5FC3\u8DF3\u8D85\u65F6\u8BBE\u7F6E"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFA\u590D\u5236\u96C6\u793A\u4F8B\u914D\u7F6E\nrs.initiate({\n  _id: "rs0",\n  members: [\n    { _id: 0, host: "server1:27017", priority: 2 },  // \u4F18\u5148\u6210\u4E3A\u4E3B\u8282\u70B9\n    { _id: 1, host: "server2:27017", priority: 1 },\n    { _id: 2, host: "server3:27017", priority: 1 }\n  ],\n  settings: {\n    heartbeatTimeoutSecs: 10,\n    electionTimeoutMillis: 10000\n  }\n})\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u7247\u96C6\u7FA4\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6BCF\u4E2A\u5206\u7247\u4F7F\u7528\u72EC\u7ACB\u590D\u5236\u96C6"}),"\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E\u670D\u52A1\u5668\u4F7F\u7528\u72EC\u7ACB\u590D\u5236\u96C6"}),"\n",(0,i.jsx)(e.li,{children:"\u90E8\u7F72\u591A\u4E2Amongos\u5B9E\u4F8B\u4F5C\u4E3A\u8DEF\u7531\u670D\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u9009\u62E9\u5408\u9002\u7684\u5206\u7247\u952E"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u671F\u5747\u8861\u6570\u636E\u5206\u5E03"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"612-\u5907\u4EFD\u4E0E\u6062\u590D\u7B56\u7565",children:"6.1.2 \u5907\u4EFD\u4E0E\u6062\u590D\u7B56\u7565"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5907\u4EFD\u9009\u9879"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"mongodump/mongorestore"}),"\uFF1A"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u5168\u91CF\u5907\u4EFD\nmongodump --uri="mongodb://user:password@localhost:27017/mydatabase" --out=/backup/mongodb/$(date +"%Y-%m-%d")\n\n# \u6062\u590D\nmongorestore --uri="mongodb://user:password@localhost:27017/" --dir=/backup/mongodb/2023-05-15\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6587\u4EF6\u7CFB\u7EDF\u5FEB\u7167"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E\u5B58\u50A8\u7CFB\u7EDF\u652F\u6301\u4E00\u81F4\u6027\u5FEB\u7167"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u6587\u4EF6\u7CFB\u7EDF\u6216\u4E91\u670D\u52A1\u63D0\u4F9B\u7684\u5FEB\u7167\u529F\u80FD"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"oplog\u5907\u4EFD"}),"\uFF1A"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u5907\u4EFDoplog\u7528\u4E8E\u65F6\u95F4\u70B9\u6062\u590D\nmongodump --uri="mongodb://user:password@localhost:27017/local" --collection=oplog.rs --out=/backup/oplog/$(date +"%Y-%m-%d")\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6062\u590D\u8BA1\u5212"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5236\u5B9A\u660E\u786E\u7684RTO(\u6062\u590D\u65F6\u95F4\u76EE\u6807)\u548CRPO(\u6062\u590D\u70B9\u76EE\u6807)"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u671F\u6D4B\u8BD5\u5907\u4EFD\u6709\u6548\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u8BB0\u5F55\u6062\u590D\u6B65\u9AA4\u5E76\u8FDB\u884C\u6F14\u7EC3"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"613-\u5B89\u5168\u6700\u4F73\u5B9E\u8DF5",children:"6.1.3 \u5B89\u5168\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B89\u5168\u57FA\u7840"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u542F\u7528\u8EAB\u4EFD\u9A8C\u8BC1\u548C\u6388\u6743"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u5F3A\u5BC6\u7801\u548C\u6700\u5C0F\u6743\u9650\u539F\u5219"}),"\n",(0,i.jsx)(e.li,{children:"\u542F\u7528TLS/SSL\u52A0\u5BC6"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BD\u7F51\u7EDC\u9694\u79BB\u548C\u9632\u706B\u5899\u4FDD\u62A4"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9AD8\u7EA7\u5B89\u5168\u63AA\u65BD"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BDLDAP\u6216Kerberos\u96C6\u6210"}),"\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E\u5B57\u6BB5\u7EA7\u52A0\u5BC6\u4FDD\u62A4\u654F\u611F\u6570\u636E"}),"\n",(0,i.jsx)(e.li,{children:"\u542F\u7528\u5BA1\u8BA1\u529F\u80FD\u8BB0\u5F55\u5173\u952E\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u671F\u5B89\u5168\u626B\u63CF\u548C\u66F4\u65B0"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u521B\u5EFA\u53EA\u8BFB\u7528\u6237\u793A\u4F8B\nuse reporting\ndb.createUser({\n  user: "reporting_user",\n  pwd: "strong_password_here",\n  roles: [\n    { role: "read", db: "reporting" },\n    { role: "readAnyDatabase", db: "admin" }\n  ],\n  authenticationRestrictions: [\n    { clientSource: ["192.168.1.0/24"] }  // IP\u9650\u5236\n  ]\n})\n'})}),"\n",(0,i.jsx)(e.h3,{id:"62-\u5E38\u89C1\u5E94\u7528\u573A\u666F\u6A21\u5F0F",children:"6.2 \u5E38\u89C1\u5E94\u7528\u573A\u666F\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.h4,{id:"621-\u7269\u8054\u7F51\u6570\u636E\u7BA1\u7406",children:"6.2.1 \u7269\u8054\u7F51\u6570\u636E\u7BA1\u7406"}),"\n",(0,i.jsx)(e.p,{children:"IoT\u5E94\u7528\u901A\u5E38\u4EA7\u751F\u5927\u91CF\u65F6\u5E8F\u6570\u636E\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u4F7F\u7528\u65F6\u95F4\u5E8F\u5217\u96C6\u5408\uFF08MongoDB 5.0+\uFF09\ndb.createCollection("device_readings", {\n  timeseries: {\n    timeField: "timestamp",\n    metaField: "device_id",\n    granularity: "minutes"\n  }\n})\n\n// \u63D2\u5165\u4F20\u611F\u5668\u6570\u636E\ndb.device_readings.insertOne({\n  timestamp: ISODate("2023-06-01T10:15:30Z"),\n  device_id: "thermostat-1",\n  temperature: 22.5,\n  humidity: 45,\n  battery: 87\n})\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"IoT\u6570\u636E\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u5206\u7247\u6309\u8BBE\u5907ID\u6216\u65F6\u95F4\u8303\u56F4\u5206\u5E03\u6570\u636E"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BDTTL\u7D22\u5F15\u6216\u5F52\u6863\u7B56\u7565\u7BA1\u7406\u6570\u636E\u751F\u547D\u5468\u671F"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u9884\u805A\u5408\u964D\u4F4E\u5B9E\u65F6\u5206\u6790\u6210\u672C"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u538B\u7F29\u5B58\u50A8\u51CF\u5C11\u7A7A\u95F4\u5360\u7528"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"622-\u5B9E\u65F6\u5206\u6790\u7CFB\u7EDF",children:"6.2.2 \u5B9E\u65F6\u5206\u6790\u7CFB\u7EDF"}),"\n",(0,i.jsx)(e.p,{children:"\u4F7F\u7528MongoDB\u8FDB\u884C\u5B9E\u65F6\u5206\u6790\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u4F7F\u7528Change Streams\u8DDF\u8E2A\u5B9E\u65F6\u53D8\u5316\nconst pipeline = [\n  { $match: { "operationType": { $in: ["insert", "update", "replace"] } } },\n  { $match: { "fullDocument.important_flag": true } }\n];\n\nconst changeStream = db.collection(\'events\').watch(pipeline);\nchangeStream.on(\'change\', (change) => {\n  // \u5904\u7406\u91CD\u8981\u4E8B\u4EF6\uFF0C\u66F4\u65B0\u4EEA\u8868\u677F\u7B49\n  updateDashboard(change.fullDocument);\n});\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B9E\u65F6\u5206\u6790\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u9488\u5BF9\u5206\u6790\u67E5\u8BE2\u7684\u4E13\u7528\u89C6\u56FE\u548C\u7D22\u5F15"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u7269\u5316\u89C6\u56FE\u9884\u8BA1\u7B97\u5E38\u7528\u805A\u5408"}),"\n",(0,i.jsx)(e.li,{children:"\u5229\u7528\u8BFB\u53D6\u504F\u597D\u4ECE\u6B21\u8981\u8282\u70B9\u8BFB\u53D6\u964D\u4F4E\u4E3B\u8282\u70B9\u8D1F\u62C5"}),"\n",(0,i.jsx)(e.li,{children:"\u7ED3\u5408\u5185\u5B58\u6570\u636E\u5E93\u6216\u6D41\u5904\u7406\u7CFB\u7EDF\u5904\u7406\u6781\u7AEF\u5B9E\u65F6\u9700\u6C42"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"623-\u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF",children:"6.2.3 \u5185\u5BB9\u7BA1\u7406\u7CFB\u7EDF"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u9002\u5408\u5B58\u50A8\u548C\u7BA1\u7406\u5404\u79CD\u5185\u5BB9\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5185\u5BB9\u6587\u6863\u793A\u4F8B\ndb.articles.insertOne({\n  title: "MongoDB\u6700\u4F73\u5B9E\u8DF5",\n  slug: "mongodb-best-practices",\n  content: "\u6B63\u6587\u5185\u5BB9...",\n  author: ObjectId("author_id"),\n  status: "published",\n  categories: ["database", "nosql", "performance"],\n  tags: ["mongodb", "optimization", "schema-design"],\n  created_at: ISODate("2023-06-01T09:00:00Z"),\n  updated_at: ISODate("2023-06-05T14:30:00Z"),\n  comments: [\n    {\n      user: ObjectId("user_id"),\n      text: "\u975E\u5E38\u6709\u5E2E\u52A9\u7684\u6587\u7AE0!",\n      created_at: ISODate("2023-06-02T10:15:00Z")\n    }\n  ],\n  metadata: {\n    views: 1250,\n    likes: 42,\n    reading_time: 8  // \u5206\u949F\n  }\n})\n\n// \u521B\u5EFA\u5168\u6587\u7D22\u5F15\u652F\u6301\u641C\u7D22\ndb.articles.createIndex(\n  { title: "text", content: "text", tags: "text" },\n  { weights: { title: 10, content: 5, tags: 3 } }\n)\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CMS\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528GridFS\u5B58\u50A8\u5927\u578B\u6587\u4EF6\u548C\u5A92\u4F53"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BD\u7248\u672C\u63A7\u5236\u6A21\u5F0F\u8DDF\u8E2A\u5185\u5BB9\u4FEE\u6539"}),"\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u590D\u5408\u7D22\u5F15\u652F\u6301\u5E38\u89C1\u8FC7\u6EE4\u548C\u6392\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u6295\u5F71\u9650\u5236\u8FD4\u56DE\u7279\u5B9A\u5B57\u6BB5\u63D0\u9AD8\u6027\u80FD"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"624-\u79FB\u52A8\u5E94\u7528\u540E\u7AEF",children:"6.2.4 \u79FB\u52A8\u5E94\u7528\u540E\u7AEF"}),"\n",(0,i.jsx)(e.p,{children:"\u4E3A\u79FB\u52A8\u5E94\u7528\u8BBE\u8BA1MongoDB\u540E\u7AEF\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u7528\u6237\u6A21\u5F0F\u793A\u4F8B\nconst userSchema = {\n  username: String,\n  email: String,\n  profile: {\n    name: String,\n    avatar: String,\n    preferences: Object\n  },\n  devices: [\n    {\n      device_id: String,\n      platform: String,  // "ios", "android"\n      push_token: String,\n      last_login: Date\n    }\n  ],\n  status: String,\n  created_at: Date\n};\n\n// \u6570\u636E\u540C\u6B65\u8BBE\u8BA1\ndb.user_data.updateOne(\n  { user_id: "user123", last_sync: { $lt: ISODate("2023-06-01T10:00:00Z") } },\n  { \n    $set: { \n      "sync_status": "pending",\n      "last_sync_attempt": new Date()\n    } \n  }\n);\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u79FB\u52A8\u5E94\u7528\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BD\u6709\u6548\u7684\u540C\u6B65\u673A\u5236\u5904\u7406\u79BB\u7EBF\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528TTL\u7D22\u5F15\u7BA1\u7406\u4E34\u65F6\u6570\u636E\uFF08\u5982\u4F1A\u8BDD\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u9488\u5BF9\u5730\u7406\u4F4D\u7F6E\u7684\u7D22\u5F15\u652F\u6301\u57FA\u4E8E\u4F4D\u7F6E\u7684\u529F\u80FD"}),"\n",(0,i.jsx)(e.li,{children:"\u4F18\u5316\u67E5\u8BE2\u51CF\u5C11\u7F51\u7EDC\u6D41\u91CF\u548C\u7535\u6C60\u6D88\u8017"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"63-\u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848",children:"6.3 \u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848"}),"\n",(0,i.jsx)(e.h4,{id:"631-\u6570\u636E\u4E00\u81F4\u6027\u6311\u6218",children:"6.3.1 \u6570\u636E\u4E00\u81F4\u6027\u6311\u6218"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u95EE\u9898"}),"\uFF1AMongoDB\u7684\u5206\u5E03\u5F0F\u7279\u6027\u5E26\u6765\u4E00\u81F4\u6027\u6311\u6218\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u9002\u5F53\u7684\u5199\u5165\u5173\u6CE8\u548C\u8BFB\u53D6\u504F\u597D"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BD\u4E50\u89C2\u5E76\u53D1\u63A7\u5236"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u591A\u6587\u6863\u4E8B\u52A1\u5904\u7406\u5173\u952E\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u5728\u5E94\u7528\u5C42\u5B9E\u73B0\u8865\u507F\u673A\u5236"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u9AD8\u4E00\u81F4\u6027\u64CD\u4F5C\u914D\u7F6E\ndb.accounts.updateOne(\n  { _id: accountId, balance: { $gte: amount } },\n  { $inc: { balance: -amount } },\n  { writeConcern: { w: "majority", j: true } }\n);\n'})}),"\n",(0,i.jsx)(e.h4,{id:"632-\u6027\u80FD\u4E0B\u964D\u6392\u67E5",children:"6.3.2 \u6027\u80FD\u4E0B\u964D\u6392\u67E5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u95EE\u9898"}),"\uFF1A\u968F\u7740\u6570\u636E\u589E\u957F\uFF0C\u67E5\u8BE2\u6027\u80FD\u53EF\u80FD\u4E0B\u964D\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6392\u67E5\u6B65\u9AA4"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4F7F\u7528",(0,i.jsx)(e.code,{children:"explain()"}),"\u5206\u6790\u6162\u67E5\u8BE2"]}),"\n",(0,i.jsx)(e.li,{children:"\u68C0\u67E5\u7D22\u5F15\u4F7F\u7528\u60C5\u51B5\u548C\u8986\u76D6\u8303\u56F4"}),"\n",(0,i.jsx)(e.li,{children:"\u8BC4\u4F30\u5DE5\u4F5C\u96C6\u5927\u5C0F\u4E0E\u53EF\u7528\u5185\u5B58"}),"\n",(0,i.jsx)(e.li,{children:"\u5206\u6790\u7CFB\u7EDF\u8D44\u6E90\u4F7F\u7528\u60C5\u51B5"}),"\n",(0,i.jsx)(e.li,{children:"\u68C0\u67E5\u7F51\u7EDC\u5EF6\u8FDF\u548C\u8FDE\u63A5\u95EE\u9898"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u6216\u8C03\u6574\u7D22\u5F15"}),"\n",(0,i.jsx)(e.li,{children:"\u4F18\u5316\u67E5\u8BE2\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.li,{children:"\u589E\u52A0\u7CFB\u7EDF\u8D44\u6E90"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u5206\u7247\u6216\u5F52\u6863\u6570\u636E"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"633-\u6269\u5C55\u6027\u95EE\u9898",children:"6.3.3 \u6269\u5C55\u6027\u95EE\u9898"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u95EE\u9898"}),"\uFF1A\u5E94\u7528\u589E\u957F\u5BFC\u81F4\u6570\u636E\u5E93\u538B\u529B\u589E\u52A0\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5782\u76F4\u6269\u5C55"}),"\uFF1A\u589E\u52A0\u5355\u673A\u8D44\u6E90\uFF08\u5185\u5B58\u3001CPU\u3001\u5B58\u50A8\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6C34\u5E73\u6269\u5C55"}),"\uFF1A\u5B9E\u65BD\u5206\u7247\u96C6\u7FA4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u529F\u80FD\u5206\u89E3"}),"\uFF1A\u5C06\u4E0D\u540C\u6570\u636E\u96C6\u5206\u6563\u5230\u4E0D\u540C\u5B9E\u4F8B"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8BFB\u5199\u5206\u79BB"}),"\uFF1A\u914D\u7F6E\u8BFB\u53D6\u504F\u597D\u4ECE\u6B21\u8981\u8282\u70B9\u8BFB\u53D6"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:'// \u5B9E\u65BD\u8BFB\u5199\u5206\u79BB\n// \u5199\u64CD\u4F5C\u4F7F\u7528\u9ED8\u8BA4\u914D\u7F6E\ndb.orders.insertOne({ ... });\n\n// \u8BFB\u64CD\u4F5C\u4F7F\u7528secondaryPreferred\ndb.orders.find({ status: "pending" }).readPref("secondaryPreferred");\n'})}),"\n",(0,i.jsx)(e.h4,{id:"634-\u8FC1\u79FB\u4E0E\u7248\u672C\u5347\u7EA7",children:"6.3.4 \u8FC1\u79FB\u4E0E\u7248\u672C\u5347\u7EA7"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u95EE\u9898"}),"\uFF1A\u6570\u636E\u5E93\u8FC1\u79FB\u548C\u7248\u672C\u5347\u7EA7\u5B58\u5728\u98CE\u9669\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5236\u5B9A\u8BE6\u7EC6\u7684\u8FC1\u79FB\u8BA1\u5212\u548C\u56DE\u6EDA\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u5728\u6D4B\u8BD5\u73AF\u5883\u5B8C\u6574\u9A8C\u8BC1\u5347\u7EA7\u6D41\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u6EDA\u52A8\u5347\u7EA7\u51CF\u5C11\u505C\u673A\u65F6\u95F4"}),"\n",(0,i.jsx)(e.li,{children:"\u76D1\u63A7\u6574\u4E2A\u8FC7\u7A0B\u7684\u7CFB\u7EDF\u5065\u5EB7\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"\u4FDD\u7559\u8DB3\u591F\u7684\u5907\u4EFD\u4EE5\u9632\u610F\u5916"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u6EDA\u52A8\u5347\u7EA7\u590D\u5236\u96C6\u793A\u4F8B\uFF08\u6BCF\u6B21\u4E00\u4E2A\u8282\u70B9\uFF09\n# 1. \u5347\u7EA7\u6B21\u8981\u8282\u70B9\nssh secondary1\nsudo systemctl stop mongod\nsudo apt update && sudo apt install -y mongodb-org\nsudo systemctl start mongod\n\n# 2. \u7B49\u5F85\u540C\u6B65\u5B8C\u6210\u540E\u7EE7\u7EED\u5176\u4ED6\u8282\u70B9...\n"})}),"\n",(0,i.jsx)(e.h3,{id:"64-mongodb\u4E0E\u5176\u4ED6\u6280\u672F\u7684\u96C6\u6210",children:"6.4 MongoDB\u4E0E\u5176\u4ED6\u6280\u672F\u7684\u96C6\u6210"}),"\n",(0,i.jsx)(e.h4,{id:"641-mongodb\u4E0E\u6D88\u606F\u961F\u5217\u96C6\u6210",children:"6.4.1 MongoDB\u4E0E\u6D88\u606F\u961F\u5217\u96C6\u6210"}),"\n",(0,i.jsx)(e.p,{children:"\u5C06MongoDB\u4E0EKafka\u6216RabbitMQ\u96C6\u6210\u53EF\u4EE5\u521B\u5EFA\u5F3A\u5927\u7684\u6570\u636E\u7BA1\u9053\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// Kafka Consumer\u5C06\u6D88\u606F\u5199\u5165MongoDB\nkafkaConsumer.on('message', async (message) => {\n  try {\n    const data = JSON.parse(message.value);\n    // \u6570\u636E\u9A8C\u8BC1\u548C\u8F6C\u6362\n    const result = await db.collection('incoming_data').insertOne({\n      ...data,\n      kafka_offset: message.offset,\n      processed_at: new Date()\n    });\n    // \u63D0\u4EA4\u504F\u79FB\u91CF\n    kafkaConsumer.commitMessage(message);\n  } catch (error) {\n    // \u9519\u8BEF\u5904\u7406\n    errorLogger.error(`Failed to process message: ${error.message}`);\n  }\n});\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u65BD\u5E42\u7B49\u6027\u64CD\u4F5C\u907F\u514D\u91CD\u590D\u5904\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u6279\u91CF\u5199\u5165\u63D0\u9AD8\u6027\u80FD"}),"\n",(0,i.jsx)(e.li,{children:"\u521B\u5EFA\u9002\u5F53\u7684\u7D22\u5F15\u652F\u6301\u67E5\u8BE2\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u4F7F\u7528Change Streams\u89E6\u53D1\u4E0B\u6E38\u5904\u7406"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"642-mongodb\u4E0E\u641C\u7D22\u5F15\u64CE\u96C6\u6210",children:"6.4.2 MongoDB\u4E0E\u641C\u7D22\u5F15\u64CE\u96C6\u6210"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u53EF\u4EE5\u4E0EElasticsearch\u7B49\u641C\u7D22\u5F15\u64CE\u534F\u540C\u5DE5\u4F5C\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// MongoDB Change Stream\u89E6\u53D1Elasticsearch\u7D22\u5F15\u66F4\u65B0\nconst changeStream = db.collection('products').watch();\n\nchangeStream.on('change', async (change) => {\n  if (change.operationType === 'insert' || change.operationType === 'update') {\n    // \u8F6C\u6362\u4E3A\u641C\u7D22\u5F15\u64CE\u6587\u6863\n    const searchDoc = transformToSearchDocument(change.fullDocument);\n    \n    // \u66F4\u65B0\u641C\u7D22\u5F15\u64CE\n    await elasticClient.index({\n      index: 'products',\n      id: change.fullDocument._id.toString(),\n      body: searchDoc\n    });\n  } else if (change.operationType === 'delete') {\n    // \u4ECE\u641C\u7D22\u5F15\u64CE\u4E2D\u5220\u9664\n    await elasticClient.delete({\n      index: 'products',\n      id: change.documentKey._id.toString()\n    });\n  }\n});\n"})}),"\n",(0,i.jsx)(e.h4,{id:"643-mongodb\u4E0E\u7F13\u5B58\u7CFB\u7EDF\u96C6\u6210",children:"6.4.3 MongoDB\u4E0E\u7F13\u5B58\u7CFB\u7EDF\u96C6\u6210"}),"\n",(0,i.jsx)(e.p,{children:"\u5C06MongoDB\u4E0ERedis\u7B49\u7F13\u5B58\u7CFB\u7EDF\u7ED3\u5408\u4F7F\u7528\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u4F7F\u7528\u7F13\u5B58-\u7A7F\u900F\u7B56\u7565\nasync function getProductById(id) {\n  // \u68C0\u67E5\u7F13\u5B58\n  const cachedProduct = await redisClient.get(`product:${id}`);\n  if (cachedProduct) {\n    return JSON.parse(cachedProduct);\n  }\n  \n  // \u7F13\u5B58\u672A\u547D\u4E2D\uFF0C\u4ECEMongoDB\u83B7\u53D6\n  const product = await db.collection('products').findOne({ _id: ObjectId(id) });\n  \n  if (product) {\n    // \u5B58\u50A8\u5230\u7F13\u5B58\uFF08\u8BBE\u7F6E30\u5206\u949F\u8FC7\u671F\uFF09\n    await redisClient.setex(`product:${id}`, 1800, JSON.stringify(product));\n  }\n  \n  return product;\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"65-\u672A\u6765\u8D8B\u52BF\u4E0E\u6280\u672F\u5C55\u671B",children:"6.5 \u672A\u6765\u8D8B\u52BF\u4E0E\u6280\u672F\u5C55\u671B"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u6301\u7EED\u53D1\u5C55\uFF0C\u4EE5\u4E0B\u662F\u503C\u5F97\u5173\u6CE8\u7684\u8D8B\u52BF\uFF1A"}),"\n",(0,i.jsx)(e.h4,{id:"651-\u5206\u5E03\u5F0F\u591A\u6587\u6863acid\u4E8B\u52A1",children:"6.5.1 \u5206\u5E03\u5F0F\u591A\u6587\u6863ACID\u4E8B\u52A1"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB 4.0+\u652F\u6301\u591A\u6587\u6863\u4E8B\u52A1\uFF0C\u4F7F\u5176\u80FD\u591F\u5904\u7406\u66F4\u590D\u6742\u7684\u4E8B\u52A1\u6027\u5DE5\u4F5C\u8D1F\u8F7D\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u4F7F\u7528\u4E8B\u52A1\u5B9E\u73B0\u8D26\u6237\u8F6C\u8D26\nconst session = client.startSession();\nsession.startTransaction();\n\ntry {\n  await db.collection('accounts').updateOne(\n    { _id: fromAccount, balance: { $gte: amount } },\n    { $inc: { balance: -amount } },\n    { session }\n  );\n  \n  await db.collection('accounts').updateOne(\n    { _id: toAccount },\n    { $inc: { balance: amount } },\n    { session }\n  );\n  \n  await db.collection('transfers').insertOne(\n    {\n      from: fromAccount,\n      to: toAccount,\n      amount: amount,\n      date: new Date()\n    },\n    { session }\n  );\n  \n  await session.commitTransaction();\n} catch (error) {\n  await session.abortTransaction();\n  throw error;\n} finally {\n  session.endSession();\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"652-\u4E91\u539F\u751F\u548C\u65E0\u670D\u52A1\u5668\u6570\u636E\u5E93",children:"6.5.2 \u4E91\u539F\u751F\u548C\u65E0\u670D\u52A1\u5668\u6570\u636E\u5E93"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB Atlas serverless\u63D0\u4F9B\u4E86\u81EA\u52A8\u7F29\u653E\u7684\u4E91\u539F\u751F\u6570\u636E\u5E93\u4F53\u9A8C\uFF0C\u65E0\u9700\u7BA1\u7406\u57FA\u7840\u8BBE\u65BD\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"653-aiml\u4E0Emongodb",children:"6.5.3 AI/ML\u4E0EMongoDB"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u4E0E\u673A\u5668\u5B66\u4E60\u96C6\u6210\u65E5\u76CA\u7D27\u5BC6\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528MongoDB\u5B58\u50A8\u8BAD\u7EC3\u6570\u636E\u548C\u6A21\u578B\u7ED3\u679C"}),"\n",(0,i.jsx)(e.li,{children:"\u5229\u7528\u805A\u5408\u6846\u67B6\u8FDB\u884C\u7279\u5F81\u5DE5\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528Atlas Data Lake\u5206\u6790\u5927\u89C4\u6A21\u6570\u636E"}),"\n",(0,i.jsx)(e.li,{children:"\u7ED3\u5408\u5411\u91CF\u641C\u7D22\u652F\u6301AI\u5E94\u7528\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"654-\u5B9E\u65F6\u534F\u4F5C\u5E94\u7528",children:"6.5.4 \u5B9E\u65F6\u534F\u4F5C\u5E94\u7528"}),"\n",(0,i.jsx)(e.p,{children:"MongoDB\u7ED3\u5408Change Streams\u975E\u5E38\u9002\u5408\u6784\u5EFA\u5B9E\u65F6\u534F\u4F5C\u5E94\u7528\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u670D\u52A1\u5668\u7AEF\u76D1\u63A7\u6587\u6863\u53D8\u5316\u5E76\u5E7F\u64AD\nconst changeStream = db.collection('shared_documents').watch();\n\nchangeStream.on('change', (change) => {\n  // \u901A\u8FC7WebSocket\u5E7F\u64AD\u53D8\u5316\n  const roomId = change.fullDocument.room_id;\n  io.to(roomId).emit('document_updated', {\n    documentId: change.fullDocument._id,\n    updatedFields: change.updateDescription?.updatedFields,\n    operationType: change.operationType\n  });\n});\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u901A\u8FC7\u638C\u63E1\u8FD9\u4E9B\u6700\u4F73\u5B9E\u8DF5\u548C\u8BBE\u8BA1\u6A21\u5F0F\uFF0C\u60A8\u53EF\u4EE5\u5145\u5206\u53D1\u6325MongoDB\u7684\u6F5C\u529B\uFF0C\u6784\u5EFA\u9AD8\u6027\u80FD\u3001\u53EF\u6269\u5C55\u4E14\u53EF\u9760\u7684\u5E94\u7528\u7CFB\u7EDF\u3002"})]})}function h(n={}){let{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},57250:function(n,e,r){r.d(e,{A:()=>l});var s=r(74848);r(96540);var i=r(34164);function l({children:n,hidden:e,className:r}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,i.A)("tabItem_Ymn6",r),hidden:e,children:n})}},78010:function(n,e,r){r.d(e,{A:()=>b});var s=r(74848),i=r(96540),l=r(34164),t=r(88287),a=r(28584),d=r(56347),c=r(99989),o=r(96629),h=r(80618),u=r(41367);function g(n){return i.Children.toArray(n).filter(n=>"\n"!==n).map(n=>{if(!n||(0,i.isValidElement)(n)&&function(n){let{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function x({value:n,tabValues:e}){return e.some(e=>e.value===n)}var p=r(19863);function j({className:n,block:e,selectedValue:r,selectValue:i,tabValues:t}){let d=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),o=n=>{let e=n.currentTarget,s=t[d.indexOf(e)].value;s!==r&&(c(e),i(s))},h=n=>{let e=null;switch(n.key){case"Enter":o(n);break;case"ArrowRight":{let r=d.indexOf(n.currentTarget)+1;e=d[r]??d[0];break}case"ArrowLeft":{let r=d.indexOf(n.currentTarget)-1;e=d[r]??d[d.length-1]}}e?.focus()};return(0,s.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":e},n),children:t.map(({value:n,label:e,attributes:i})=>(0,s.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:n=>{d.push(n)},onKeyDown:h,onClick:o,...i,className:(0,l.A)("tabs__item","tabItem_LNqP",i?.className,{"tabs__item--active":r===n}),children:e??n},n))})}function m({lazy:n,children:e,selectedValue:r}){let t=(Array.isArray(e)?e:[e]).filter(Boolean);if(n){let n=t.find(n=>n.props.value===r);return n?(0,i.cloneElement)(n,{className:(0,l.A)("margin-top--md",n.props.className)}):null}return(0,s.jsx)("div",{className:"margin-top--md",children:t.map((n,e)=>(0,i.cloneElement)(n,{key:e,hidden:n.props.value!==r}))})}function v(n){let e=function(n){let e,{defaultValue:r,queryString:s=!1,groupId:l}=n,t=function(n){let{values:e,children:r}=n;return(0,i.useMemo)(()=>{let n=e??g(r).map(({props:{value:n,label:e,attributes:r,default:s}})=>({value:n,label:e,attributes:r,default:s})),s=(0,h.XI)(n,(n,e)=>n.value===e.value);if(s.length>0)throw Error(`Docusaurus error: Duplicate values "${s.map(n=>n.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return n},[e,r])}(n),[a,p]=(0,i.useState)(()=>(function({defaultValue:n,tabValues:e}){if(0===e.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!x({value:n,tabValues:e}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${e.map(n=>n.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let r=e.find(n=>n.default)??e[0];if(!r)throw Error("Unexpected error: 0 tabValues");return r.value})({defaultValue:r,tabValues:t})),[j,m]=function({queryString:n=!1,groupId:e}){let r=(0,d.W6)(),s=function({queryString:n=!1,groupId:e}){if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!e)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return e??null}({queryString:n,groupId:e});return[(0,o.aZ)(s),(0,i.useCallback)(n=>{if(!s)return;let e=new URLSearchParams(r.location.search);e.set(s,n),r.replace({...r.location,search:e.toString()})},[s,r])]}({queryString:s,groupId:l}),[v,b]=function({groupId:n}){let e=n?`docusaurus.tab.${n}`:null,[r,s]=(0,u.Dv)(e);return[r,(0,i.useCallback)(n=>{e&&s.set(n)},[e,s])]}({groupId:l}),y=x({value:e=j??v,tabValues:t})?e:null;return(0,c.A)(()=>{y&&p(y)},[y]),{selectedValue:a,selectValue:(0,i.useCallback)(n=>{if(!x({value:n,tabValues:t}))throw Error(`Can't select invalid tab value=${n}`);p(n),m(n),b(n)},[m,b,t]),tabValues:t}}(n);return(0,s.jsxs)("div",{className:(0,l.A)(t.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,s.jsx)(j,{...e,...n}),(0,s.jsx)(m,{...e,...n})]})}function b(n){let e=(0,p.A)();return(0,s.jsx)(v,{...n,children:g(n.children)},String(e))}},67810:function(n,e,r){r.d(e,{A:()=>l});var s=r(83941),i=r(61022);function l(){let{prism:n}=(0,i.p)(),{colorMode:e}=(0,s.G)(),r=n.theme,l=n.darkTheme||r;return"dark"===e?l:r}},25591:function(n,e,r){r.d(e,{A:()=>g});var s=r(74848),i=r(96540),l=r(34164),t=r(71765),a=r(33436),d=r(61022),c=r(67810);let o="codeDot_PWGG",h="langIcon_gX7_",u="copyButtonIcon_f_OW",g=function({children:n,className:e,metastring:r,title:g}){let x,p,[j,m]=(0,i.useState)(!1),[v,b]=(0,i.useState)(!1),y=(0,i.useRef)(null),f=(0,i.useRef)(null),D=(0,i.useRef)(null),{prism:w}=(0,d.p)(),S=(0,c.A)();(0,i.useEffect)(()=>{b(!0)},[]),(0,i.useEffect)(()=>{let n;if(!D.current)return;let e=document.createElement("canvas"),r=document.createElement("div");r.className="matrixContainer_iCb4",r.appendChild(e),D.current.prepend(r);let s=e.getContext("2d"),i=()=>{let n=D.current.getBoundingClientRect();e.width=n.width,e.height=n.height};i(),window.addEventListener("resize",i);let l=()=>"dark"===document.documentElement.getAttribute("data-theme"),t=()=>{let n=(l(),15),r=Math.floor(e.width/n);return{fontSize:n,columns:r}},{fontSize:a,columns:d}=t(),c=[];for(let n=0;n<d;n++)c[n]=Math.floor(Math.random()*e.height/a);let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789labylabylaby",h=()=>{let r=d;if({fontSize:a,columns:d}=t(),d!==r)for(let n=0;n<d;n++)n<r||(c[n]=Math.floor(Math.random()*e.height/a));l()?s.fillStyle="rgba(0, 0, 0, 0.05)":s.fillStyle="rgba(255, 255, 255, 0.05)",s.fillRect(0,0,e.width,e.height),l()?s.fillStyle="#0F0":s.fillStyle="rgba(0, 80, 0, 0.8)",s.font=`${a}px 'Courier New', monospace`,s.textBaseline="top";for(let n=0;n<c.length;n++){let r=o[Math.floor(Math.random()*o.length)];s.fillText(r,n*a,c[n]*a),c[n]*a>e.height&&Math.random()>.975&&(c[n]=0),Math.random()>.6&&c[n]++}n=setTimeout(()=>requestAnimationFrame(h),70)};h();let u=new MutationObserver(n=>{n.forEach(n=>{"data-theme"===n.attributeName&&s.clearRect(0,0,e.width,e.height)})});return u.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{u.disconnect(),window.removeEventListener("resize",i),clearTimeout(n),cancelAnimationFrame(n)}},[v]);let M=e&&(/language-(\w+)/.exec(e)||["","text"])[1],_=g||(r&&r.match(/title="([^"]+)"/))?.[1]||"";return(0,s.jsxs)("div",{className:(0,l.A)("codeBlockContainer_X7hc",M&&`language-${M}`),ref:f,children:[(0,s.jsxs)("div",{className:"codeBlockHeader_viex",children:[(0,s.jsxs)("div",{className:"codeBlockControls_mxj2",children:[(0,s.jsx)("span",{className:(0,l.A)(o,"codeDotRed_ANoD")}),(0,s.jsx)("span",{className:(0,l.A)(o,"codeDotYellow_HH1J")}),(0,s.jsx)("span",{className:(0,l.A)(o,"codeDotGreen_RM6U")})]}),_&&(0,s.jsx)("div",{className:"codeBlockTitle_B2tn",children:_}),(0,s.jsxs)("div",{className:"codeBlockMeta_lRk3",children:[M&&(0,s.jsxs)("div",{className:"codeBlockLanguage_Vqu6",children:[(x={javascript:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM243.8 381.4c0 43.6-25.6 63.5-62.9 63.5-33.7 0-53.2-17.4-63.2-38.5l34.3-20.7c6.6 11.7 12.6 21.6 27.1 21.6 13.8 0 22.6-5.4 22.6-26.5V237.7h42.1v143.7zm99.6 63.5c-39.1 0-64.4-18.6-76.7-43l34.3-19.8c9 14.7 20.8 25.6 41.5 25.6 17.4 0 28.6-8.7 28.6-20.8 0-14.4-11.4-19.5-30.7-28l-10.5-4.5c-30.4-12.9-50.5-29.2-50.5-63.5 0-31.6 24.1-55.6 61.6-55.6 26.8 0 46 9.3 59.8 33.7L368 290c-7.2-12.9-15-18-27.1-18-12.3 0-20.1 7.8-20.1 18 0 12.6 7.8 17.7 25.9 25.6l10.5 4.5c35.8 15.3 55.9 31 55.9 66.2 0 37.8-29.8 58.6-69.7 58.6z"})}),jsx:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M418.2 177.2c-5.4-1.8-10.8-3.5-16.2-5.1.9-3.7 1.7-7.4 2.5-11.1 12.3-59.6 4.2-107.5-23.1-123.3-26.3-15.1-69.2.6-112.6 38.4-4.3 3.7-8.5 7.6-12.5 11.5-2.7-2.6-5.5-5.2-8.3-7.7-45.5-40.4-91.1-57.4-118.4-41.5-26.2 15.2-34 60.3-23 116.7 1.1 5.6 2.3 11.1 3.7 16.7-6.4 1.8-12.7 3.8-18.6 5.9C38.3 196.2 0 225.4 0 255.6c0 31.2 40.8 62.5 96.3 81.5 4.5 1.5 9 3 13.6 4.3-1.5 6-2.8 11.9-4 18-10.5 55.5-2.3 99.5 23.9 114.6 27 15.6 72.4-.4 116.6-39.1 3.5-3.1 7-6.3 10.5-9.7 4.4 4.3 9 8.4 13.6 12.4 42.8 36.8 85.1 51.7 111.2 36.6 27-15.6 35.8-62.9 24.4-120.5-.9-4.4-1.9-8.9-3-13.5 3.2-.9 6.3-1.9 9.4-2.9 57.7-19.1 99.5-50 99.5-81.7 0-30.3-39.4-59.7-93.8-78.4zM282.9 92.3c37.2-32.4 71.9-45.1 87.7-36 16.9 9.7 23.4 48.9 12.8 100.4-.7 3.4-1.4 6.7-2.3 10-22.2-5-44.7-8.6-67.3-10.6-13-18.6-27.2-36.4-42.6-53.1 3.9-3.7 7.7-7.2 11.7-10.7zM167.2 307.5c5.1 8.7 10.3 17.4 15.8 25.9-15.6-1.7-31.1-4.2-46.4-7.5 4.4-14.4 9.9-29.3 16.3-44.5 4.6 8.8 9.3 17.5 14.3 26.1zm-30.3-120.3c14.4-3.2 29.7-5.8 45.6-7.8-5.3 8.3-10.5 16.8-15.4 25.4-4.9 8.5-9.7 17.2-14.2 26-6.3-14.9-11.6-29.5-16-43.6zm27.4 68.9c6.6-13.8 13.8-27.3 21.4-40.6s15.8-26.2 24.4-38.9c15-1.1 30.3-1.7 45.9-1.7s31 .6 45.9 1.7c8.5 12.6 16.6 25.5 24.3 38.7s14.9 26.7 21.7 40.4c-6.7 13.8-13.9 27.4-21.6 40.8-7.6 13.3-15.7 26.2-24.2 39-14.9 1.1-30.4 1.6-46.1 1.6s-30.9-.5-45.6-1.4c-8.7-12.7-16.9-25.7-24.6-39s-14.8-26.8-21.5-40.6zm180.6 51.2c5.1-8.8 9.9-17.7 14.6-26.7 6.4 14.5 12 29.2 16.9 44.3-15.5 3.5-31.2 6.2-47 8 5.4-8.4 10.5-17 15.5-25.6zm14.4-76.5c-4.7-8.8-9.5-17.6-14.5-26.2-4.9-8.5-10-16.9-15.3-25.2 16.1 2 31.5 4.7 45.9 8-4.6 14.8-10 29.2-16.1 43.4zM256.2 118.3c10.5 11.4 20.4 23.4 29.6 35.8-19.8-.9-39.7-.9-59.5 0 9.8-12.9 19.9-24.9 29.9-35.8zM140.2 57c16.8-9.8 54.1 4.2 93.4 39 2.5 2.2 5 4.6 7.6 7-15.5 16.7-29.8 34.5-42.9 53.1-22.6 2-45 5.5-67.2 10.4-1.3-5.1-2.4-10.3-3.5-15.5-9.4-48.4-3.2-84.9 12.6-94zm-24.5 263.6c-4.2-1.2-8.3-2.5-12.4-3.9-21.3-6.7-45.5-17.3-63-31.2-10.1-7-16.9-17.8-18.8-29.9 0-18.3 31.6-41.7 77.2-57.6 5.7-2 11.5-3.8 17.3-5.5 6.8 21.7 15 43 24.5 63.6-9.6 20.9-17.9 42.5-24.8 64.5zm116.6 98c-16.5 15.1-35.6 27.1-56.4 35.3-11.1 5.3-23.9 5.8-35.3 1.3-15.9-9.2-22.5-44.5-13.5-92 1.1-5.6 2.3-11.2 3.7-16.7 22.4 4.8 45 8.1 67.9 9.8 13.2 18.7 27.7 36.6 43.2 53.4-3.2 3.1-6.4 6.1-9.6 8.9zm24.5-24.3c-10.2-11-20.4-23.2-30.3-36.3 9.6.4 19.5.6 29.5.6 10.3 0 20.4-.2 30.4-.7-9.2 12.7-19.1 24.8-29.6 36.4zm130.7 30c-.9 12.2-6.9 23.6-16.5 31.3-15.9 9.2-49.8-2.8-86.4-34.2-4.2-3.6-8.4-7.5-12.7-11.5 15.3-16.9 29.4-34.8 42.2-53.6 22.9-1.9 45.7-5.4 68.2-10.5 1 4.1 1.9 8.2 2.7 12.2 4.9 21.6 5.7 44.1 2.5 66.3zm18.2-107.5c-2.8.9-5.6 1.8-8.5 2.6-7-21.8-15.6-43.1-25.5-63.8 9.6-20.4 17.7-41.4 24.5-62.9 5.2 1.5 10.2 3.1 15 4.7 46.6 16 79.3 39.8 79.3 58 0 19.6-34.9 44.9-84.8 61.4zm-149.7-15c25.3 0 45.8-20.5 45.8-45.8s-20.5-45.8-45.8-45.8c-25.3 0-45.8 20.5-45.8 45.8s20.5 45.8 45.8 45.8z"})}),typescript:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",className:h,children:[(0,s.jsx)("path",{fill:"currentColor",d:"M233.277 177.622h-82.44v156.756h32.967v-58.743h49.472c39.168 0 71.15-26.284 71.15-49.006.001-22.729-31.981-49.007-71.15-49.007zm-3.533 66.293H183.71v-33.496h46.034c17.392 0 31.407 7.41 31.407 16.747.001 9.341-14.014 16.75-31.407 16.75zm212.408-66.293v32.965h-33.403v123.79h-32.973v-123.79h-33.405v-32.966h99.781z"}),(0,s.jsx)("path",{fill:"currentColor",d:"M512 256.001c0 141.395-114.606 255.996-255.996 255.996C114.606 511.997 0 397.396 0 256.001 0 114.606 114.606 0 256.004 0 397.394 0 512 114.606 512 256.001z",opacity:".1"})]}),css:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"})}),html:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L191.5 480l157.6-52.2L384 32H0zm308.2 127.9H124.4l4.1 49.4h175.6l-13.6 148.4-97.9 27v.3h-1.1l-98.7-27.3-6-75.8h47.7L138 320l53.5 14.5 53.7-14.5 6-62.2H84.3L71.5 112.2h241.1l-4.4 47.7z"})}),java:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"})}),python:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"})}),bash:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"})}),json:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"})}),yaml:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"})}),markdown:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 208 128",className:h,children:[(0,s.jsx)("rect",{width:"198",height:"118",x:"5",y:"5",ry:"10",stroke:"currentColor",strokeWidth:"10",fill:"none"}),(0,s.jsx)("path",{d:"M30 98V30h20l20 25 20-25h20v68H90V59L70 84 50 59v39zm125 0l-30-33h20V30h20v35h20z",fill:"currentColor"})]}),sql:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"})})},p=(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",className:h,children:(0,s.jsx)("path",{fill:"currentColor",d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"})}),x["string"==typeof M&&M?M.toLowerCase():""]||p),(0,s.jsx)("span",{children:M})]}),(0,s.jsx)("button",{ref:y,type:"button","aria-label":"\u590D\u5236\u4EE3\u7801",className:"copyButton_H_xL",onClick:()=>{if(f.current){let n=f.current.textContent;(0,a.A)(n),m(!0),setTimeout(()=>{m(!1)},2e3)}},children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:u,children:(0,s.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),(0,s.jsx)("span",{children:"\u5DF2\u590D\u5236"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:u,children:(0,s.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),(0,s.jsx)("span",{children:"\u590D\u5236"})]})})]})]}),(0,s.jsx)("div",{className:"codeBlockContent_vqWU",ref:D,children:(0,s.jsx)(t.f4,{code:n.trim(),language:M||"text",theme:S,children:({className:n,style:e,tokens:r,getLineProps:i,getTokenProps:t})=>(0,s.jsx)("pre",{className:(0,l.A)(n,"codeBlock_wPnj"),style:e,children:(0,s.jsx)("code",{className:"codeBlockLines_fQUY",children:r.map((n,e)=>{1===n.length&&"\n"===n[0].content&&(n[0].content="");let{key:r,...a}=i({line:n,key:e});return(0,s.jsxs)("div",{...a,className:(0,l.A)(a.className,"codeLine_fSta"),children:[(0,s.jsx)("span",{className:"codeLineNumber_x9bH",children:e+1}),(0,s.jsx)("span",{className:"codeLineContent_HA3z",children:n.map((n,e)=>{let{key:r,...i}=t({token:n,key:e});return(0,s.jsx)("span",{...i},r||e)})})]},r||e)})})})})})]})}},28453:function(n,e,r){r.d(e,{R:()=>t,x:()=>a});var s=r(96540);let i={},l=s.createContext(i);function t(n){let e=s.useContext(l);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),s.createElement(l.Provider,{value:e},n.children)}},33436:function(n,e,r){r.d(e,{A:()=>s});function s(n,{target:e=document.body}={}){if("string"!=typeof n)throw TypeError(`Expected parameter \`text\` to be a \`string\`, got \`${typeof n}\`.`);let r=document.createElement("textarea"),i=document.activeElement;r.value=n,r.setAttribute("readonly",""),r.style.all="unset",r.style.contain="strict",r.style.position="absolute",r.style.left="-9999px",r.style.width="2em",r.style.height="2em",r.style.padding="0",r.style.border="none",r.style.outline="none",r.style.boxShadow="none",r.style.background="transparent",r.style.fontSize="12pt",r.style.whiteSpace="pre";let l=document.getSelection(),t=l.rangeCount>0&&l.getRangeAt(0);e.append(r),r.select(),r.selectionStart=0,r.selectionEnd=n.length;let a=!1;try{a=document.execCommand("copy")}catch{}return r.remove(),t&&(l.removeAllRanges(),l.addRange(t)),i&&i.focus(),a}}}]);