"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["30481"],{47242:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>d,frontMatter:()=>s,contentTitle:()=>l,toc:()=>u,assets:()=>o});var t=JSON.parse('{"id":"backend/microservices/api-gateway","title":"API\u7F51\u5173\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3\u5FAE\u670D\u52A1API\u7F51\u5173\u7684\u6838\u5FC3\u6982\u5FF5\u3001\u5B9E\u73B0\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5","source":"@site/docs/backend/microservices/api-gateway.mdx","sourceDirName":"backend/microservices","slug":"/backend/microservices/api-gateway","permalink":"/en/docs/backend/microservices/api-gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/microservices/api-gateway.mdx","tags":[{"inline":true,"label":"API\u7F51\u5173","permalink":"/en/docs/tags/api\u7F51\u5173"},{"inline":true,"label":"\u5FAE\u670D\u52A1","permalink":"/en/docs/tags/\u5FAE\u670D\u52A1"},{"inline":true,"label":"\u8D1F\u8F7D\u5747\u8861","permalink":"/en/docs/tags/\u8D1F\u8F7D\u5747\u8861"},{"inline":true,"label":"\u670D\u52A1\u6CBB\u7406","permalink":"/en/docs/tags/\u670D\u52A1\u6CBB\u7406"},{"inline":true,"label":"Spring Cloud Gateway","permalink":"/en/docs/tags/spring-cloud-gateway"}],"version":"current","lastUpdatedBy":"Laby","lastUpdatedAt":1755216000000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"API\u7F51\u5173\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3\u5FAE\u670D\u52A1API\u7F51\u5173\u7684\u6838\u5FC3\u6982\u5FF5\u3001\u5B9E\u73B0\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5","authors":["Laby"],"tags":["API\u7F51\u5173","\u5FAE\u670D\u52A1","\u8D1F\u8F7D\u5747\u8861","\u670D\u52A1\u6CBB\u7406","Spring Cloud Gateway"],"last_update":{"date":"2025-08-15T00:00:00.000Z","author":"Laby"}},"sidebar":"tutorialSidebar","previous":{"title":"\u670D\u52A1\u6CE8\u518C\u4E0E\u53D1\u73B0\u8BE6\u89E3","permalink":"/en/docs/backend/microservices/service-discovery"},"next":{"title":"\u670D\u52A1\u7194\u65AD\u4E0E\u964D\u7EA7\u8BE6\u89E3","permalink":"/en/docs/backend/microservices/circuit-breaker"}}'),i=r(74848),a=r(28453);r(78010),r(57250),r(25956);let s={sidebar_position:1,title:"API\u7F51\u5173\u8BE6\u89E3",description:"\u6DF1\u5165\u7406\u89E3\u5FAE\u670D\u52A1API\u7F51\u5173\u7684\u6838\u5FC3\u6982\u5FF5\u3001\u5B9E\u73B0\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5",authors:["Laby"],tags:["API\u7F51\u5173","\u5FAE\u670D\u52A1","\u8D1F\u8F7D\u5747\u8861","\u670D\u52A1\u6CBB\u7406","Spring Cloud Gateway"],last_update:{date:new Date("2025-08-15T00:00:00.000Z"),author:"Laby"}},l="API\u7F51\u5173\u8BE6\u89E3",o={},u=[{value:"1. API\u7F51\u5173\u6838\u5FC3\u529F\u80FD",id:"1-api\u7F51\u5173\u6838\u5FC3\u529F\u80FD",level:2},{value:"1.1 \u8BF7\u6C42\u8DEF\u7531",id:"11-\u8BF7\u6C42\u8DEF\u7531",level:3},{value:"1.2 \u8D1F\u8F7D\u5747\u8861",id:"12-\u8D1F\u8F7D\u5747\u8861",level:3},{value:"1.3 \u8BA4\u8BC1\u6388\u6743",id:"13-\u8BA4\u8BC1\u6388\u6743",level:3},{value:"2. \u9650\u6D41\u4E0E\u7194\u65AD",id:"2-\u9650\u6D41\u4E0E\u7194\u65AD",level:2},{value:"2.1 \u9650\u6D41\u5B9E\u73B0",id:"21-\u9650\u6D41\u5B9E\u73B0",level:3},{value:"2.2 \u7194\u65AD\u5668\u5B9E\u73B0",id:"22-\u7194\u65AD\u5668\u5B9E\u73B0",level:3},{value:"3. \u76D1\u63A7\u4E0E\u65E5\u5FD7",id:"3-\u76D1\u63A7\u4E0E\u65E5\u5FD7",level:2},{value:"3.1 \u8BF7\u6C42\u65E5\u5FD7\u8BB0\u5F55",id:"31-\u8BF7\u6C42\u65E5\u5FD7\u8BB0\u5F55",level:3},{value:"4. \u914D\u7F6E\u7BA1\u7406",id:"4-\u914D\u7F6E\u7BA1\u7406",level:2},{value:"4.1 \u52A8\u6001\u8DEF\u7531\u914D\u7F6E",id:"41-\u52A8\u6001\u8DEF\u7531\u914D\u7F6E",level:3}];function c(e){let n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"api\u7F51\u5173\u8BE6\u89E3",children:"API\u7F51\u5173\u8BE6\u89E3"})}),"\n",(0,i.jsx)(n.p,{children:"API\u7F51\u5173\u662F\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u91CD\u8981\u7EC4\u4EF6\uFF0C\u4F5C\u4E3A\u7CFB\u7EDF\u7684\u7EDF\u4E00\u5165\u53E3\uFF0C\u8D1F\u8D23\u8BF7\u6C42\u8DEF\u7531\u3001\u8D1F\u8F7D\u5747\u8861\u3001\u8BA4\u8BC1\u6388\u6743\u3001\u9650\u6D41\u7194\u65AD\u7B49\u529F\u80FD\u3002"}),"\n",(0,i.jsxs)(n.admonition,{title:"\u6838\u5FC3\u4EF7\u503C",type:"tip",children:[(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"API\u7F51\u5173 = \u7EDF\u4E00\u5165\u53E3 + \u670D\u52A1\u6CBB\u7406 + \u5B89\u5168\u63A7\u5236 + \u6027\u80FD\u4F18\u5316"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u{1F310} ",(0,i.jsx)(n.strong,{children:"\u7EDF\u4E00\u5165\u53E3"}),"\uFF1A\u4E3A\u6240\u6709\u5FAE\u670D\u52A1\u63D0\u4F9B\u7EDF\u4E00\u7684\u8BBF\u95EE\u5165\u53E3"]}),"\n",(0,i.jsxs)(n.li,{children:["\u{1F512} ",(0,i.jsx)(n.strong,{children:"\u5B89\u5168\u63A7\u5236"}),"\uFF1A\u96C6\u4E2D\u5904\u7406\u8BA4\u8BC1\u3001\u6388\u6743\u3001\u52A0\u5BC6\u7B49\u5B89\u5168\u529F\u80FD"]}),"\n",(0,i.jsxs)(n.li,{children:["\u26A1 ",(0,i.jsx)(n.strong,{children:"\u6027\u80FD\u4F18\u5316"}),"\uFF1A\u8D1F\u8F7D\u5747\u8861\u3001\u7F13\u5B58\u3001\u538B\u7F29\u7B49\u6027\u80FD\u4F18\u5316"]}),"\n",(0,i.jsxs)(n.li,{children:["\u{1F6E1}\uFE0F ",(0,i.jsx)(n.strong,{children:"\u670D\u52A1\u6CBB\u7406"}),"\uFF1A\u9650\u6D41\u3001\u7194\u65AD\u3001\u76D1\u63A7\u3001\u65E5\u5FD7\u7B49\u6CBB\u7406\u529F\u80FD"]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"1-api\u7F51\u5173\u6838\u5FC3\u529F\u80FD",children:"1. API\u7F51\u5173\u6838\u5FC3\u529F\u80FD"}),"\n",(0,i.jsx)(n.h3,{id:"11-\u8BF7\u6C42\u8DEF\u7531",children:"1.1 \u8BF7\u6C42\u8DEF\u7531"}),"\n",(0,i.jsx)(n.p,{children:"API\u7F51\u5173\u6839\u636E\u8BF7\u6C42\u7684URL\u3001\u5934\u90E8\u4FE1\u606F\u7B49\u5C06\u8BF7\u6C42\u8DEF\u7531\u5230\u76F8\u5E94\u7684\u540E\u7AEF\u670D\u52A1\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="Spring Cloud Gateway\u8DEF\u7531\u914D\u7F6E"',children:'@Configuration\npublic class GatewayConfig {\n    \n    @Bean\n    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {\n        return builder.routes()\n            // \u7528\u6237\u670D\u52A1\u8DEF\u7531\n            .route("user-service", r -> r\n                .path("/api/users/**")\n                .uri("lb://user-service"))\n            \n            // \u8BA2\u5355\u670D\u52A1\u8DEF\u7531\n            .route("order-service", r -> r\n                .path("/api/orders/**")\n                .uri("lb://order-service"))\n            \n            // \u652F\u4ED8\u670D\u52A1\u8DEF\u7531\n            .route("payment-service", r -> r\n                .path("/api/payments/**")\n                .uri("lb://payment-service"))\n            \n            .build();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"12-\u8D1F\u8F7D\u5747\u8861",children:"1.2 \u8D1F\u8F7D\u5747\u8861"}),"\n",(0,i.jsx)(n.p,{children:"API\u7F51\u5173\u53EF\u4EE5\u5728\u591A\u4E2A\u670D\u52A1\u5B9E\u4F8B\u4E4B\u95F4\u5206\u53D1\u8BF7\u6C42\uFF0C\u63D0\u9AD8\u7CFB\u7EDF\u7684\u53EF\u7528\u6027\u548C\u6027\u80FD\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="\u8D1F\u8F7D\u5747\u8861\u914D\u7F6E"',children:"@Configuration\npublic class LoadBalancerConfig {\n    \n    @Bean\n    @LoadBalanced\n    public RestTemplate restTemplate() {\n        return new RestTemplate();\n    }\n    \n    // \u81EA\u5B9A\u4E49\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\n    @Bean\n    public ReactorLoadBalancer<ServiceInstance> userServiceLoadBalancer(\n            Environment environment,\n            LoadBalancerClientFactory loadBalancerClientFactory) {\n        \n        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);\n        return new RoundRobinLoadBalancer(\n            loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class),\n            name);\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"13-\u8BA4\u8BC1\u6388\u6743",children:"1.3 \u8BA4\u8BC1\u6388\u6743"}),"\n",(0,i.jsx)(n.p,{children:"API\u7F51\u5173\u53EF\u4EE5\u96C6\u4E2D\u5904\u7406\u8BA4\u8BC1\u548C\u6388\u6743\u903B\u8F91\uFF0C\u786E\u4FDD\u53EA\u6709\u5408\u6CD5\u7528\u6237\u624D\u80FD\u8BBF\u95EE\u7CFB\u7EDF\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="JWT\u8BA4\u8BC1\u8FC7\u6EE4\u5668"',children:'@Component\npublic class JwtAuthenticationFilter implements GlobalFilter, Ordered {\n    \n    private final JwtTokenProvider jwtTokenProvider;\n    \n    public JwtAuthenticationFilter(JwtTokenProvider jwtTokenProvider) {\n        this.jwtTokenProvider = jwtTokenProvider;\n    }\n    \n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        ServerHttpRequest request = exchange.getRequest();\n        \n        // \u8DF3\u8FC7\u4E0D\u9700\u8981\u8BA4\u8BC1\u7684\u8DEF\u5F84\n        if (isPublicPath(request.getPath().value())) {\n            return chain.filter(exchange);\n        }\n        \n        // \u83B7\u53D6Authorization\u5934\n        String authHeader = request.getHeaders().getFirst("Authorization");\n        if (authHeader == null || !authHeader.startsWith("Bearer ")) {\n            return handleUnauthorized(exchange);\n        }\n        \n        String token = authHeader.substring(7);\n        \n        try {\n            // \u9A8C\u8BC1JWT token\n            if (jwtTokenProvider.validateToken(token)) {\n                // \u63D0\u53D6\u7528\u6237\u4FE1\u606F\u5E76\u6DFB\u52A0\u5230\u8BF7\u6C42\u5934\n                String userId = jwtTokenProvider.getUserIdFromToken(token);\n                String userRole = jwtTokenProvider.getUserRoleFromToken(token);\n                \n                ServerHttpRequest modifiedRequest = request.mutate()\n                    .header("X-User-Id", userId)\n                    .header("X-User-Role", userRole)\n                    .build();\n                \n                return chain.filter(exchange.mutate().request(modifiedRequest).build());\n            } else {\n                return handleUnauthorized(exchange);\n            }\n        } catch (Exception e) {\n            return handleUnauthorized(exchange);\n        }\n    }\n    \n    private boolean isPublicPath(String path) {\n        return path.startsWith("/api/auth/") || \n               path.startsWith("/api/public/") ||\n               path.equals("/health");\n    }\n    \n    private Mono<Void> handleUnauthorized(ServerWebExchange exchange) {\n        ServerHttpResponse response = exchange.getResponse();\n        response.setStatusCode(HttpStatus.UNAUTHORIZED);\n        response.getHeaders().add("Content-Type", "application/json");\n        \n        String body = "{\\"error\\":\\"Unauthorized\\",\\"message\\":\\"Invalid or missing token\\"}";\n        DataBuffer buffer = response.bufferFactory().wrap(body.getBytes());\n        return response.writeWith(Mono.just(buffer));\n    }\n    \n    @Override\n    public int getOrder() {\n        return -100; // \u9AD8\u4F18\u5148\u7EA7\uFF0C\u5728\u5176\u4ED6\u8FC7\u6EE4\u5668\u4E4B\u524D\u6267\u884C\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"2-\u9650\u6D41\u4E0E\u7194\u65AD",children:"2. \u9650\u6D41\u4E0E\u7194\u65AD"}),"\n",(0,i.jsx)(n.h3,{id:"21-\u9650\u6D41\u5B9E\u73B0",children:"2.1 \u9650\u6D41\u5B9E\u73B0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="Redis\u9650\u6D41\u8FC7\u6EE4\u5668"',children:'@Component\npublic class RateLimitFilter implements GlobalFilter, Ordered {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final RedisScript<Long> rateLimitScript;\n    \n    public RateLimitFilter(RedisTemplate<String, String> redisTemplate) {\n        this.redisTemplate = redisTemplate;\n        this.rateLimitScript = createRateLimitScript();\n    }\n    \n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        ServerHttpRequest request = exchange.getRequest();\n        String clientId = getClientId(request);\n        String path = request.getPath().value();\n        \n        // \u6784\u5EFA\u9650\u6D41key\n        String rateLimitKey = "rate_limit:" + clientId + ":" + path;\n        \n        // \u6267\u884C\u9650\u6D41\u68C0\u67E5\n        Long currentRequests = redisTemplate.execute(\n            rateLimitScript,\n            Collections.singletonList(rateLimitKey),\n            "10", // \u9650\u5236\uFF1A10\u6B21/\u5206\u949F\n            "60"  // \u65F6\u95F4\u7A97\u53E3\uFF1A60\u79D2\n        );\n        \n        if (currentRequests != null && currentRequests > 10) {\n            return handleRateLimitExceeded(exchange);\n        }\n        \n        return chain.filter(exchange);\n    }\n    \n    private String getClientId(ServerHttpRequest request) {\n        // \u4F18\u5148\u4F7F\u7528API Key\n        String apiKey = request.getHeaders().getFirst("X-API-Key");\n        if (apiKey != null) {\n            return "api_key:" + apiKey;\n        }\n        \n        // \u4F7F\u7528IP\u5730\u5740\u4F5C\u4E3Afallback\n        String clientIp = getClientIp(request);\n        return "ip:" + clientIp;\n    }\n    \n    private String getClientIp(ServerHttpRequest request) {\n        String xForwardedFor = request.getHeaders().getFirst("X-Forwarded-For");\n        if (xForwardedFor != null && !xForwardedFor.isEmpty()) {\n            return xForwardedFor.split(",")[0].trim();\n        }\n        \n        String xRealIp = request.getHeaders().getFirst("X-Real-IP");\n        if (xRealIp != null && !xRealIp.isEmpty()) {\n            return xRealIp;\n        }\n        \n        return request.getRemoteAddress() != null ? \n               request.getRemoteAddress().getAddress().getHostAddress() : "unknown";\n    }\n    \n    private RedisScript<Long> createRateLimitScript() {\n        String script = \n            "local key = KEYS[1] " +\n            "local limit = tonumber(ARGV[1]) " +\n            "local window = tonumber(ARGV[2]) " +\n            "local current = redis.call(\'incr\', key) " +\n            "if current == 1 then " +\n            "    redis.call(\'expire\', key, window) " +\n            "end " +\n            "return current";\n        \n        return RedisScript.of(script, Long.class);\n    }\n    \n    private Mono<Void> handleRateLimitExceeded(ServerWebExchange exchange) {\n        ServerHttpResponse response = exchange.getResponse();\n        response.setStatusCode(HttpStatus.TOO_MANY_REQUESTS);\n        response.getHeaders().add("Content-Type", "application/json");\n        \n        String body = "{\\"error\\":\\"Rate limit exceeded\\",\\"message\\":\\"Too many requests\\"}";\n        DataBuffer buffer = response.bufferFactory().wrap(body.getBytes());\n        return response.writeWith(Mono.just(buffer));\n    }\n    \n    @Override\n    public int getOrder() {\n        return -50;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"22-\u7194\u65AD\u5668\u5B9E\u73B0",children:"2.2 \u7194\u65AD\u5668\u5B9E\u73B0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="\u7194\u65AD\u5668\u8FC7\u6EE4\u5668"',children:'@Component\npublic class CircuitBreakerFilter implements GlobalFilter, Ordered {\n    \n    private final CircuitBreakerRegistry circuitBreakerRegistry;\n    \n    public CircuitBreakerFilter(CircuitBreakerRegistry circuitBreakerRegistry) {\n        this.circuitBreakerRegistry = circuitBreakerRegistry;\n    }\n    \n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        String serviceName = getServiceName(exchange.getRequest());\n        CircuitBreaker circuitBreaker = circuitBreakerRegistry.circuitBreaker(serviceName);\n        \n        return circuitBreaker.executeSupplier(() -> chain.filter(exchange))\n            .onErrorResume(Exception.class, ex -> handleCircuitBreakerOpen(exchange, ex));\n    }\n    \n    private String getServiceName(ServerHttpRequest request) {\n        String path = request.getPath().value();\n        if (path.startsWith("/api/users")) return "user-service";\n        if (path.startsWith("/api/orders")) return "order-service";\n        if (path.startsWith("/api/payments")) return "payment-service";\n        return "default-service";\n    }\n    \n    private Mono<Void> handleCircuitBreakerOpen(ServerWebExchange exchange, Exception ex) {\n        ServerHttpResponse response = exchange.getResponse();\n        response.setStatusCode(HttpStatus.SERVICE_UNAVAILABLE);\n        response.getHeaders().add("Content-Type", "application/json");\n        \n        String body = "{\\"error\\":\\"Service unavailable\\",\\"message\\":\\"Circuit breaker is open\\"}";\n        DataBuffer buffer = response.bufferFactory().wrap(body.getBytes());\n        return response.writeWith(Mono.just(buffer));\n    }\n    \n    @Override\n    public int getOrder() {\n        return 0;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"3-\u76D1\u63A7\u4E0E\u65E5\u5FD7",children:"3. \u76D1\u63A7\u4E0E\u65E5\u5FD7"}),"\n",(0,i.jsx)(n.h3,{id:"31-\u8BF7\u6C42\u65E5\u5FD7\u8BB0\u5F55",children:"3.1 \u8BF7\u6C42\u65E5\u5FD7\u8BB0\u5F55"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="\u8BF7\u6C42\u65E5\u5FD7\u8FC7\u6EE4\u5668"',children:'@Component\n@Slf4j\npublic class RequestLoggingFilter implements GlobalFilter, Ordered {\n    \n    @Override\n    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {\n        ServerHttpRequest request = exchange.getRequest();\n        long startTime = System.currentTimeMillis();\n        \n        // \u8BB0\u5F55\u8BF7\u6C42\u4FE1\u606F\n        String requestId = UUID.randomUUID().toString();\n        exchange.getAttributes().put("requestId", requestId);\n        exchange.getAttributes().put("startTime", startTime);\n        \n        log.info("Request started - ID: {}, Method: {}, Path: {}, Client: {}", \n                requestId, request.getMethod(), request.getPath(), \n                getClientIp(request));\n        \n        return chain.filter(exchange).then(\n            Mono.fromRunnable(() -> {\n                long endTime = System.currentTimeMillis();\n                long duration = endTime - startTime;\n                \n                ServerHttpResponse response = exchange.getResponse();\n                log.info("Request completed - ID: {}, Status: {}, Duration: {}ms", \n                        requestId, response.getStatusCode(), duration);\n            })\n        );\n    }\n    \n    private String getClientIp(ServerHttpRequest request) {\n        String xForwardedFor = request.getHeaders().getFirst("X-Forwarded-For");\n        if (xForwardedFor != null && !xForwardedFor.isEmpty()) {\n            return xForwardedFor.split(",")[0].trim();\n        }\n        return request.getRemoteAddress() != null ? \n               request.getRemoteAddress().getAddress().getHostAddress() : "unknown";\n    }\n    \n    @Override\n    public int getOrder() {\n        return Ordered.HIGHEST_PRECEDENCE;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"4-\u914D\u7F6E\u7BA1\u7406",children:"4. \u914D\u7F6E\u7BA1\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"41-\u52A8\u6001\u8DEF\u7531\u914D\u7F6E",children:"4.1 \u52A8\u6001\u8DEF\u7531\u914D\u7F6E"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:'spring:\n  cloud:\n    gateway:\n      routes:\n        - id: user-service\n          uri: lb://user-service\n          predicates:\n            - Path=/api/users/**\n          filters:\n            - StripPrefix=2\n            - AddRequestHeader=X-Service-Name, user-service\n            - name: RequestRateLimiter\n              args:\n                redis-rate-limiter.replenishRate: 10\n                redis-rate-limiter.burstCapacity: 20\n                key-resolver: "#{@userKeyResolver}"\n        \n        - id: order-service\n          uri: lb://order-service\n          predicates:\n            - Path=/api/orders/**\n          filters:\n            - StripPrefix=2\n            - AddRequestHeader=X-Service-Name, order-service\n            - name: CircuitBreaker\n              args:\n                name: order-service-cb\n                fallbackUri: forward:/fallback/orders\n        \n        - id: payment-service\n          uri: lb://payment-service\n          predicates:\n            - Path=/api/payments/**\n          filters:\n            - StripPrefix=2\n            - AddRequestHeader=X-Service-Name, payment-service\n            - name: Retry\n              args:\n                retries: 3\n                statuses: BAD_GATEWAY,GATEWAY_TIMEOUT\n                backoff:\n                  firstBackoff: 10ms\n                  maxBackoff: 50ms\n                  factor: 2\n\n  # Redis\u914D\u7F6E\uFF08\u7528\u4E8E\u9650\u6D41\uFF09\n  redis:\n    host: localhost\n    port: 6379\n    timeout: 2000ms\n    lettuce:\n      pool:\n        max-active: 8\n        max-idle: 8\n        min-idle: 0\n\n# \u7194\u65AD\u5668\u914D\u7F6E\nresilience4j:\n  circuitbreaker:\n    instances:\n      user-service-cb:\n        slidingWindowSize: 10\n        minimumNumberOfCalls: 5\n        failureRateThreshold: 50\n        waitDurationInOpenState: 30s\n        permittedNumberOfCallsInHalfOpenState: 3\n      order-service-cb:\n        slidingWindowSize: 20\n        minimumNumberOfCalls: 10\n        failureRateThreshold: 60\n        waitDurationInOpenState: 60s\n      payment-service-cb:\n        slidingWindowSize: 15\n        minimumNumberOfCalls: 8\n        failureRateThreshold: 40\n        waitDurationInOpenState: 45s\n\n# \u76D1\u63A7\u914D\u7F6E\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,prometheus\n  endpoint:\n    health:\n      show-details: always\n  metrics:\n    export:\n      prometheus:\n        enabled: true\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u901A\u8FC7\u672C\u7AE0\u7684\u5B66\u4E60\uFF0C\u4F60\u5E94\u8BE5\u5DF2\u7ECF\u6DF1\u5165\u7406\u89E3\u4E86API\u7F51\u5173\u7684\u6838\u5FC3\u6982\u5FF5\u3001\u5B9E\u73B0\u65B9\u6848\u548C\u6700\u4F73\u5B9E\u8DF5\u3002API\u7F51\u5173\u662F\u5FAE\u670D\u52A1\u67B6\u6784\u7684\u91CD\u8981\u57FA\u7840\u8BBE\u65BD\uFF0C\u5408\u7406\u4F7F\u7528\u7F51\u5173\u53EF\u4EE5\u663E\u8457\u63D0\u9AD8\u7CFB\u7EDF\u7684\u5B89\u5168\u6027\u3001\u53EF\u7EF4\u62A4\u6027\u548C\u53EF\u6269\u5C55\u6027\u3002\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u8981\u6839\u636E\u4E1A\u52A1\u9700\u6C42\u9009\u62E9\u5408\u9002\u7684\u7F51\u5173\u65B9\u6848\uFF0C\u5E76\u6CE8\u91CD\u6027\u80FD\u4F18\u5316\u548C\u76D1\u63A7\u8FD0\u7EF4\u3002"})]})}function d(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},57250:function(e,n,r){r.d(n,{A:()=>a});var t=r(74848);r(96540);var i=r(34164);function a({children:e,hidden:n,className:r}){return(0,t.jsx)("div",{role:"tabpanel",className:(0,i.A)("tabItem_Ymn6",r),hidden:n,children:e})}},78010:function(e,n,r){r.d(n,{A:()=>x});var t=r(74848),i=r(96540),a=r(34164),s=r(88287),l=r(28584),o=r(56347),u=r(99989),c=r(96629),d=r(80618),p=r(41367);function h(e){return i.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}var g=r(19863);function v({className:e,block:n,selectedValue:r,selectValue:i,tabValues:s}){let o=[],{blockElementScrollPositionUntilNextRender:u}=(0,l.a_)(),c=e=>{let n=e.currentTarget,t=s[o.indexOf(n)].value;t!==r&&(u(n),i(t))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{let r=o.indexOf(e.currentTarget)+1;n=o[r]??o[0];break}case"ArrowLeft":{let r=o.indexOf(e.currentTarget)-1;n=o[r]??o[o.length-1]}}n?.focus()};return(0,t.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:i})=>(0,t.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...i,className:(0,a.A)("tabs__item","tabItem_LNqP",i?.className,{"tabs__item--active":r===e}),children:n??e},e))})}function b({lazy:e,children:n,selectedValue:r}){let s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){let e=s.find(e=>e.props.value===r);return e?(0,i.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,t.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==r}))})}function f(e){let n=function(e){let n,{defaultValue:r,queryString:t=!1,groupId:a}=e,s=function(e){let{values:n,children:r}=e;return(0,i.useMemo)(()=>{let e=n??h(r).map(({props:{value:e,label:n,attributes:r,default:t}})=>({value:e,label:n,attributes:r,default:t})),t=(0,d.XI)(e,(e,n)=>e.value===n.value);if(t.length>0)throw Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[n,r])}(e),[l,g]=(0,i.useState)(()=>(function({defaultValue:e,tabValues:n}){if(0===n.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let r=n.find(e=>e.default)??n[0];if(!r)throw Error("Unexpected error: 0 tabValues");return r.value})({defaultValue:r,tabValues:s})),[v,b]=function({queryString:e=!1,groupId:n}){let r=(0,o.W6)(),t=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(t),(0,i.useCallback)(e=>{if(!t)return;let n=new URLSearchParams(r.location.search);n.set(t,e),r.replace({...r.location,search:n.toString()})},[t,r])]}({queryString:t,groupId:a}),[f,x]=function({groupId:e}){let n=e?`docusaurus.tab.${e}`:null,[r,t]=(0,p.Dv)(n);return[r,(0,i.useCallback)(e=>{n&&t.set(e)},[n,t])]}({groupId:a}),y=m({value:n=v??f,tabValues:s})?n:null;return(0,u.A)(()=>{y&&g(y)},[y]),{selectedValue:l,selectValue:(0,i.useCallback)(e=>{if(!m({value:e,tabValues:s}))throw Error(`Can't select invalid tab value=${e}`);g(e),b(e),x(e)},[b,x,s]),tabValues:s}}(e);return(0,t.jsxs)("div",{className:(0,a.A)(s.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,t.jsx)(v,{...n,...e}),(0,t.jsx)(b,{...n,...e})]})}function x(e){let n=(0,g.A)();return(0,t.jsx)(f,{...e,children:h(e.children)},String(n))}},25956:function(e,n,r){r.d(n,{A:()=>a});var t=r(74848);r(96540);let i={comparisonContainer:"comparisonContainer_JIlh",title:"title_DO8g",tableWrapper:"tableWrapper_sDL2",comparisonTable:"comparisonTable_TXOe",header:"header_ovSW",row:"row_y6JN",cell:"cell_zzax",cellContent:"cellContent__KQW",highlight:"highlight_aULN"};function a({headers:e,rows:n,caption:r}){return(0,t.jsx)("div",{className:i.tableContainer,children:(0,t.jsxs)("table",{className:i.comparisonTable,children:[r&&(0,t.jsx)("caption",{className:i.caption,children:r}),(0,t.jsx)("thead",{children:(0,t.jsx)("tr",{children:e.map((e,n)=>(0,t.jsx)("th",{children:e},n))})}),(0,t.jsx)("tbody",{children:n.map((e,n)=>(0,t.jsx)("tr",{children:e.map((e,n)=>(0,t.jsx)("td",{children:e},n))},n))})]})})}},28453:function(e,n,r){r.d(n,{R:()=>s,x:()=>l});var t=r(96540);let i={},a=t.createContext(i);function s(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);