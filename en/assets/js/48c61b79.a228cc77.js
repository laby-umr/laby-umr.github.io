"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["56046"],{45335:function(n,e,t){t.r(e),t.d(e,{metadata:()=>r,default:()=>d,frontMatter:()=>s,contentTitle:()=>c,toc:()=>l,assets:()=>o});var r=JSON.parse('{"id":"backend/microservices/distributed-tracing","title":"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3\u5FAE\u670D\u52A1\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u7684\u8BBE\u8BA1\u539F\u7406\u3001\u5B9E\u73B0\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5","source":"@site/docs/backend/microservices/distributed-tracing.mdx","sourceDirName":"backend/microservices","slug":"/backend/microservices/distributed-tracing","permalink":"/en/docs/backend/microservices/distributed-tracing","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/microservices/distributed-tracing.mdx","tags":[],"version":"current","lastUpdatedBy":"Laby","lastUpdatedAt":1754524800000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3\u5FAE\u670D\u52A1\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u7684\u8BBE\u8BA1\u539F\u7406\u3001\u5B9E\u73B0\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5","authors":["Laby"],"last_update":{"date":"2025-08-07T00:00:00.000Z","author":"Laby"}},"sidebar":"tutorialSidebar","previous":{"title":"\u914D\u7F6E\u4E2D\u5FC3\u8BE6\u89E3","permalink":"/en/docs/backend/microservices/config-center"},"next":{"title":"\u5206\u5E03\u5F0F\u7CFB\u7EDF\u7406\u8BBA\u57FA\u7840\u8BE6\u89E3","permalink":"/en/docs/backend/distributed-systems/distributed-theory"}}'),a=t(74848),i=t(28453);let s={sidebar_position:5,title:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u8BE6\u89E3",description:"\u6DF1\u5165\u7406\u89E3\u5FAE\u670D\u52A1\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u7684\u8BBE\u8BA1\u539F\u7406\u3001\u5B9E\u73B0\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5",authors:["Laby"],last_update:{date:new Date("2025-08-07T00:00:00.000Z"),author:"Laby"}},c="\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u8BE6\u89E3",o={},l=[{value:"1. \u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u57FA\u7840\u6982\u5FF5",id:"1-\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u57FA\u7840\u6982\u5FF5",level:2},{value:"1.1 \u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\uFF1F",id:"11-\u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A",level:3},{value:"\u6838\u5FC3\u6982\u5FF5\u8BE6\u89E3",id:"\u6838\u5FC3\u6982\u5FF5\u8BE6\u89E3",level:4},{value:"\u94FE\u8DEF\u8FFD\u8E2A\u6570\u636E\u6A21\u578B",id:"\u94FE\u8DEF\u8FFD\u8E2A\u6570\u636E\u6A21\u578B",level:4},{value:"\u94FE\u8DEF\u8FFD\u8E2A\u793A\u4F8B\u573A\u666F",id:"\u94FE\u8DEF\u8FFD\u8E2A\u793A\u4F8B\u573A\u666F",level:4},{value:"1.2 \u94FE\u8DEF\u8FFD\u8E2A\u67B6\u6784\u6A21\u5F0F",id:"12-\u94FE\u8DEF\u8FFD\u8E2A\u67B6\u6784\u6A21\u5F0F",level:3},{value:"\u91C7\u6837\u67B6\u6784\u8BE6\u89E3",id:"\u91C7\u6837\u67B6\u6784\u8BE6\u89E3",level:4},{value:"\u91C7\u6837\u7B56\u7565\u5BF9\u6BD4",id:"\u91C7\u6837\u7B56\u7565\u5BF9\u6BD4",level:4},{value:"1.3 \u94FE\u8DEF\u8FFD\u8E2A\u7684\u4F18\u52BF\u4E0E\u6311\u6218",id:"13-\u94FE\u8DEF\u8FFD\u8E2A\u7684\u4F18\u52BF\u4E0E\u6311\u6218",level:3},{value:"\u6838\u5FC3\u4F18\u52BF\u8BE6\u89E3",id:"\u6838\u5FC3\u4F18\u52BF\u8BE6\u89E3",level:4},{value:"\u4E3B\u8981\u6311\u6218\u4E0E\u89E3\u51B3\u65B9\u6848",id:"\u4E3B\u8981\u6311\u6218\u4E0E\u89E3\u51B3\u65B9\u6848",level:4},{value:"\u6027\u80FD\u5F71\u54CD\u5206\u6790",id:"\u6027\u80FD\u5F71\u54CD\u5206\u6790",level:4},{value:"2. \u94FE\u8DEF\u4F20\u64AD\u5668\u4E0E\u4E0A\u4E0B\u6587\u7BA1\u7406",id:"2-\u94FE\u8DEF\u4F20\u64AD\u5668\u4E0E\u4E0A\u4E0B\u6587\u7BA1\u7406",level:2},{value:"2.1 \u94FE\u8DEF\u4F20\u64AD\u5668\u8BE6\u89E3",id:"21-\u94FE\u8DEF\u4F20\u64AD\u5668\u8BE6\u89E3",level:3},{value:"\u4F20\u64AD\u5668\u8BBE\u8BA1\u6A21\u5F0F",id:"\u4F20\u64AD\u5668\u8BBE\u8BA1\u6A21\u5F0F",level:4},{value:"\u4F20\u64AD\u5668\u7C7B\u578B\u5BF9\u6BD4",id:"\u4F20\u64AD\u5668\u7C7B\u578B\u5BF9\u6BD4",level:4},{value:"2.2 \u4E0A\u4E0B\u6587\u7BA1\u7406\u7B56\u7565",id:"22-\u4E0A\u4E0B\u6587\u7BA1\u7406\u7B56\u7565",level:3},{value:"\u4E0A\u4E0B\u6587\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",id:"\u4E0A\u4E0B\u6587\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",level:4},{value:"3. \u5B9E\u9645\u5E94\u7528\u573A\u666F\u4E0E\u6700\u4F73\u5B9E\u8DF5",id:"3-\u5B9E\u9645\u5E94\u7528\u573A\u666F\u4E0E\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"3.1 \u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u94FE\u8DEF\u8FFD\u8E2A",id:"31-\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u94FE\u8DEF\u8FFD\u8E2A",level:3},{value:"3.2 \u6570\u636E\u5E93\u64CD\u4F5C\u8FFD\u8E2A",id:"32-\u6570\u636E\u5E93\u64CD\u4F5C\u8FFD\u8E2A",level:3},{value:"3.3 \u6D88\u606F\u961F\u5217\u94FE\u8DEF\u8FFD\u8E2A",id:"33-\u6D88\u606F\u961F\u5217\u94FE\u8DEF\u8FFD\u8E2A",level:3},{value:"3.4 \u7F13\u5B58\u94FE\u8DEF\u8FFD\u8E2A",id:"34-\u7F13\u5B58\u94FE\u8DEF\u8FFD\u8E2A",level:3},{value:"\u94FE\u8DEF\u8FFD\u8E2A\u6700\u4F73\u5B9E\u8DF5\u603B\u7ED3",id:"\u94FE\u8DEF\u8FFD\u8E2A\u6700\u4F73\u5B9E\u8DF5\u603B\u7ED3",level:4},{value:"4. \u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u603B\u7ED3",id:"4-\u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u603B\u7ED3",level:2},{value:"4.1 \u57FA\u7840\u6982\u5FF5\u9762\u8BD5\u9898",id:"41-\u57FA\u7840\u6982\u5FF5\u9762\u8BD5\u9898",level:3},{value:"4.2 \u6280\u672F\u5B9E\u73B0\u9762\u8BD5\u9898",id:"42-\u6280\u672F\u5B9E\u73B0\u9762\u8BD5\u9898",level:3},{value:"4.3 \u67B6\u6784\u8BBE\u8BA1\u9762\u8BD5\u9898",id:"43-\u67B6\u6784\u8BBE\u8BA1\u9762\u8BD5\u9898",level:3},{value:"4.4 \u5B9E\u6218\u5E94\u7528\u9762\u8BD5\u9898",id:"44-\u5B9E\u6218\u5E94\u7528\u9762\u8BD5\u9898",level:3},{value:"5. \u603B\u7ED3\u4E0E\u5C55\u671B",id:"5-\u603B\u7ED3\u4E0E\u5C55\u671B",level:2},{value:"5.1 \u6280\u672F\u53D1\u5C55\u8D8B\u52BF",id:"51-\u6280\u672F\u53D1\u5C55\u8D8B\u52BF",level:3},{value:"5.2 \u6700\u4F73\u5B9E\u8DF5\u5EFA\u8BAE",id:"52-\u6700\u4F73\u5B9E\u8DF5\u5EFA\u8BAE",level:3},{value:"\u7ED3\u8BBA",id:"\u7ED3\u8BBA",level:3}];function p(n){let e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u8BE6\u89E3",children:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u8BE6\u89E3"})}),"\n",(0,a.jsx)(e.p,{children:"\u5728\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C\u4E00\u4E2A\u7528\u6237\u8BF7\u6C42\u53EF\u80FD\u4F1A\u7ECF\u8FC7\u591A\u4E2A\u670D\u52A1\u7684\u5904\u7406\uFF0C\u4ECE\u7F51\u5173\u5230\u8BA4\u8BC1\u670D\u52A1\uFF0C\u518D\u5230\u4E1A\u52A1\u670D\u52A1\uFF0C\u6700\u540E\u5230\u6570\u636E\u5E93\u3002\u5F53\u51FA\u73B0\u6027\u80FD\u95EE\u9898\u6216\u9519\u8BEF\u65F6\uFF0C\u4F20\u7EDF\u7684\u5355\u4F53\u5E94\u7528\u8C03\u8BD5\u65B9\u6CD5\u5DF2\u7ECF\u65E0\u6CD5\u6EE1\u8DB3\u9700\u6C42\u3002\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u6280\u672F\u80FD\u591F\u8FFD\u8E2A\u8BF7\u6C42\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u5B8C\u6574\u8C03\u7528\u94FE\u8DEF\uFF0C\u5E2E\u52A9\u5F00\u53D1\u8005\u5FEB\u901F\u5B9A\u4F4D\u95EE\u9898\u3001\u5206\u6790\u6027\u80FD\u74F6\u9888\u3001\u7406\u89E3\u670D\u52A1\u4F9D\u8D56\u5173\u7CFB\u3002"}),"\n",(0,a.jsx)(e.admonition,{title:"\u6838\u5FC3\u4EF7\u503C",type:"tip",children:(0,a.jsx)(e.p,{children:"\u94FE\u8DEF\u8FFD\u8E2A = \u8BF7\u6C42\u8FFD\u8E2A + \u6027\u80FD\u5206\u6790 + \u6545\u969C\u5B9A\u4F4D + \u4F9D\u8D56\u5206\u6790 + \u4E1A\u52A1\u6D1E\u5BDF + \u5BB9\u91CF\u89C4\u5212"})}),"\n",(0,a.jsx)(e.h2,{id:"1-\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u57FA\u7840\u6982\u5FF5",children:"1. \u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u57FA\u7840\u6982\u5FF5"}),"\n",(0,a.jsx)(e.h3,{id:"11-\u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A",children:"1.1 \u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\uFF1F"}),"\n",(0,a.jsx)(e.p,{children:'\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\uFF08Distributed Tracing\uFF09\u662F\u4E00\u79CD\u7528\u4E8E\u76D1\u63A7\u548C\u8BCA\u65AD\u5206\u5E03\u5F0F\u7CFB\u7EDF\u7684\u6280\u672F\uFF0C\u5B83\u901A\u8FC7\u8FFD\u8E2A\u8BF7\u6C42\u5728\u7CFB\u7EDF\u4E2D\u7684\u5B8C\u6574\u8C03\u7528\u94FE\u8DEF\uFF0C\u63D0\u4F9B\u7AEF\u5230\u7AEF\u7684\u53EF\u89C1\u6027\u3002\u5C31\u50CF\u7ED9\u6BCF\u4E2A\u8BF7\u6C42\u8D34\u4E0A\u4E00\u4E2A"\u8EAB\u4EFD\u8BC1"\uFF0C\u65E0\u8BBA\u5B83\u8D70\u5230\u54EA\u91CC\uFF0C\u6211\u4EEC\u90FD\u80FD\u8FFD\u8E2A\u5230\u5B83\u7684\u5B8C\u6574\u8DEF\u5F84\u3002'}),"\n",(0,a.jsx)(e.h4,{id:"\u6838\u5FC3\u6982\u5FF5\u8BE6\u89E3",children:"\u6838\u5FC3\u6982\u5FF5\u8BE6\u89E3"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"Trace\uFF08\u94FE\u8DEF\uFF09"}),"\uFF1A\u4E00\u6B21\u5B8C\u6574\u7684\u8BF7\u6C42\u8C03\u7528\u94FE\u8DEF\uFF0C\u5305\u542B\u4ECE\u8BF7\u6C42\u5F00\u59CB\u5230\u54CD\u5E94\u7ED3\u675F\u7684\u6240\u6709\u64CD\u4F5C\u3002\u6BCF\u4E2ATrace\u90FD\u6709\u4E00\u4E2A\u5168\u5C40\u552F\u4E00\u7684TraceId\u3002"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"Span\uFF08\u8DE8\u5EA6\uFF09"}),"\uFF1A\u94FE\u8DEF\u4E2D\u7684\u4E00\u4E2A\u8C03\u7528\u7247\u6BB5\uFF0C\u4EE3\u8868\u4E00\u4E2A\u670D\u52A1\u5185\u90E8\u7684\u64CD\u4F5C\u6216\u670D\u52A1\u95F4\u7684\u8C03\u7528\u3002\u6BCF\u4E2ASpan\u90FD\u6709\u552F\u4E00\u7684SpanId\uFF0C\u5E76\u4E14\u53EF\u4EE5\u5305\u542B\u5B50Span\u3002"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"TraceId"}),"\uFF1A\u5168\u5C40\u552F\u4E00\u7684\u94FE\u8DEF\u6807\u8BC6\u7B26\uFF0C\u7528\u4E8E\u5173\u8054\u540C\u4E00\u4E2A\u8BF7\u6C42\u7684\u6240\u6709Span\u3002"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"SpanId"}),"\uFF1ASpan\u7684\u552F\u4E00\u6807\u8BC6\u7B26\uFF0C\u7528\u4E8E\u6807\u8BC6\u7279\u5B9A\u7684\u64CD\u4F5C\u3002"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"ParentId"}),"\uFF1A\u7236Span\u7684ID\uFF0C\u7528\u4E8E\u6784\u5EFASpan\u4E4B\u95F4\u7684\u7236\u5B50\u5173\u7CFB\u3002"]}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"Baggage\uFF08\u884C\u674E\uFF09"}),"\uFF1A\u8DE8\u670D\u52A1\u4F20\u9012\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F\uFF0C\u5982\u7528\u6237ID\u3001\u8BF7\u6C42\u6765\u6E90\u7B49\u3002"]}),"\n",(0,a.jsx)(e.h4,{id:"\u94FE\u8DEF\u8FFD\u8E2A\u6570\u636E\u6A21\u578B",children:"\u94FE\u8DEF\u8FFD\u8E2A\u6570\u636E\u6A21\u578B"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u94FE\u8DEF\u8FFD\u8E2A\u6838\u5FC3\u6570\u636E\u6A21\u578B"',children:'public class TracingDataModel {\n    /*\n     * \u94FE\u8DEF\u8FFD\u8E2A\u7684\u6838\u5FC3\u6570\u636E\u6A21\u578B\n     * 1. Trace\uFF1A\u5B8C\u6574\u7684\u8BF7\u6C42\u94FE\u8DEF\uFF0C\u5305\u542B\u591A\u4E2ASpan\n     * 2. Span\uFF1A\u5355\u4E2A\u64CD\u4F5C\u7247\u6BB5\uFF0C\u5305\u542B\u8BE6\u7EC6\u7684\u6267\u884C\u4FE1\u606F\n     * 3. TraceContext\uFF1A\u94FE\u8DEF\u4E0A\u4E0B\u6587\uFF0C\u7528\u4E8E\u4F20\u64AD\u8FFD\u8E2A\u4FE1\u606F\n     * 4. Baggage\uFF1A\u8DE8\u670D\u52A1\u4F20\u9012\u7684\u989D\u5916\u4FE1\u606F\n     */\n    \n    // Trace\u5B9A\u4E49 - \u5B8C\u6574\u7684\u8BF7\u6C42\u94FE\u8DEF\n    public class Trace {\n        private String traceId;           // \u5168\u5C40\u552F\u4E00\u7684\u94FE\u8DEFID\n        private String serviceName;       // \u53D1\u8D77\u8BF7\u6C42\u7684\u670D\u52A1\u540D\u79F0\n        private long startTime;           // \u8BF7\u6C42\u5F00\u59CB\u65F6\u95F4\u6233\n        private long endTime;             // \u8BF7\u6C42\u7ED3\u675F\u65F6\u95F4\u6233\n        private List<Span> spans;         // \u94FE\u8DEF\u4E2D\u7684\u6240\u6709Span\n        private Map<String, String> tags; // \u94FE\u8DEF\u7EA7\u522B\u7684\u6807\u7B7E\n        private String status;            // \u94FE\u8DEF\u72B6\u6001\uFF1ASUCCESS/ERROR/TIMEOUT\n        private String errorMessage;      // \u9519\u8BEF\u4FE1\u606F\uFF08\u5982\u679C\u6709\uFF09\n        private long totalDuration;       // \u603B\u8017\u65F6\n        private int spanCount;            // Span\u6570\u91CF\n        private String rootSpanId;        // \u6839Span\u7684ID\n        \n        // \u6784\u9020\u51FD\u6570\n        public Trace(String traceId, String serviceName) {\n            this.traceId = traceId;\n            this.serviceName = serviceName;\n            this.startTime = System.currentTimeMillis();\n            this.spans = new ArrayList<>();\n            this.tags = new HashMap<>();\n            this.status = "SUCCESS";\n        }\n        \n        // \u6DFB\u52A0Span\u5230\u94FE\u8DEF\n        public void addSpan(Span span) {\n            this.spans.add(span);\n            this.spanCount = spans.size();\n            \n            // \u66F4\u65B0\u7ED3\u675F\u65F6\u95F4\u548C\u603B\u8017\u65F6\n            if (span.getEndTime() > this.endTime) {\n                this.endTime = span.getEndTime();\n                this.totalDuration = this.endTime - this.startTime;\n            }\n            \n            // \u8BBE\u7F6E\u6839Span\n            if (span.getParentSpanId() == null) {\n                this.rootSpanId = span.getSpanId();\n            }\n        }\n        \n        // \u68C0\u67E5\u94FE\u8DEF\u662F\u5426\u5B8C\u6210\n        public boolean isCompleted() {\n            return this.endTime > 0 && this.spans.stream()\n                .allMatch(span -> span.getEndTime() > 0);\n        }\n        \n        // \u83B7\u53D6\u94FE\u8DEF\u7EDF\u8BA1\u4FE1\u606F\n        public TraceStatistics getStatistics() {\n            TraceStatistics stats = new TraceStatistics();\n            stats.setTotalSpans(spanCount);\n            stats.setTotalDuration(totalDuration);\n            stats.setAverageSpanDuration(spans.stream()\n                .mapToLong(Span::getDuration)\n                .average()\n                .orElse(0.0));\n            stats.setErrorCount((int) spans.stream()\n                .filter(span -> "ERROR".equals(span.getStatus()))\n                .count());\n            return stats;\n        }\n    }\n    \n    // Span\u5B9A\u4E49 - \u5355\u4E2A\u64CD\u4F5C\u7247\u6BB5\n    public class Span {\n        private String spanId;            // Span\u7684\u552F\u4E00\u6807\u8BC6\u7B26\n        private String traceId;           // \u6240\u5C5E\u94FE\u8DEF\u7684ID\n        private String parentSpanId;      // \u7236Span\u7684ID\uFF08\u6839Span\u4E3Anull\uFF09\n        private String serviceName;       // \u670D\u52A1\u540D\u79F0\n        private String operationName;     // \u64CD\u4F5C\u540D\u79F0\uFF08\u5982\u65B9\u6CD5\u540D\u3001API\u8DEF\u5F84\uFF09\n        private long startTime;           // \u5F00\u59CB\u65F6\u95F4\u6233\n        private long endTime;             // \u7ED3\u675F\u65F6\u95F4\u6233\n        private long duration;            // \u6301\u7EED\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\n        private String kind;              // Span\u7C7B\u578B\uFF1ASERVER/CLIENT/PRODUCER/CONSUMER\n        private Map<String, String> tags; // \u6807\u7B7E\u4FE1\u606F\n        private List<Log> logs;           // \u65E5\u5FD7\u8BB0\u5F55\n        private List<Event> events;       // \u4E8B\u4EF6\u8BB0\u5F55\n        private String status;            // \u72B6\u6001\uFF1ASUCCESS/ERROR/TIMEOUT\n        private String errorMessage;      // \u9519\u8BEF\u4FE1\u606F\n        private Map<String, Object> baggage; // \u884C\u674E\u4FE1\u606F\n        \n        // \u6784\u9020\u51FD\u6570\n        public Span(String spanId, String traceId, String serviceName, String operationName) {\n            this.spanId = spanId;\n            this.traceId = traceId;\n            this.serviceName = serviceName;\n            this.operationName = operationName;\n            this.startTime = System.currentTimeMillis();\n            this.tags = new HashMap<>();\n            this.logs = new ArrayList<>();\n            this.events = new ArrayList<>();\n            this.baggage = new HashMap<>();\n            this.status = "SUCCESS";\n        }\n        \n        // \u7ED3\u675FSpan\n        public void finish() {\n            this.endTime = System.currentTimeMillis();\n            this.duration = this.endTime - this.startTime;\n        }\n        \n        // \u7ED3\u675FSpan\uFF08\u5E26\u9519\u8BEF\u4FE1\u606F\uFF09\n        public void finishWithError(String errorMessage) {\n            this.endTime = System.currentTimeMillis();\n            this.duration = this.endTime - this.startTime;\n            this.status = "ERROR";\n            this.errorMessage = errorMessage;\n        }\n        \n        // \u6DFB\u52A0\u6807\u7B7E\n        public void addTag(String key, String value) {\n            this.tags.put(key, value);\n        }\n        \n        // \u6DFB\u52A0\u65E5\u5FD7\n        public void addLog(String message) {\n            Log log = new Log();\n            log.setTimestamp(System.currentTimeMillis());\n            log.setMessage(message);\n            this.logs.add(log);\n        }\n        \n        // \u6DFB\u52A0\u4E8B\u4EF6\n        public void addEvent(String eventName, Map<String, Object> attributes) {\n            Event event = new Event();\n            event.setTimestamp(System.currentTimeMillis());\n            event.setName(eventName);\n            event.setAttributes(attributes);\n            this.events.add(event);\n        }\n        \n        // \u8BBE\u7F6E\u884C\u674E\u4FE1\u606F\n        public void setBaggage(String key, Object value) {\n            this.baggage.put(key, value);\n        }\n    }\n    \n    // \u94FE\u8DEF\u4E0A\u4E0B\u6587 - \u7528\u4E8E\u4F20\u64AD\u8FFD\u8E2A\u4FE1\u606F\n    public class TraceContext {\n        private String traceId;           // \u94FE\u8DEFID\n        private String spanId;            // \u5F53\u524DSpan\u7684ID\n        private String parentSpanId;      // \u7236Span\u7684ID\n        private Map<String, Object> baggage; // \u884C\u674E\u4FE1\u606F\n        private boolean sampled;          // \u662F\u5426\u91C7\u6837\n        private String flags;             // \u6807\u5FD7\u4F4D\n        private long startTime;           // \u4E0A\u4E0B\u6587\u521B\u5EFA\u65F6\u95F4\n        \n        // \u6784\u9020\u51FD\u6570\n        public TraceContext(String traceId, String spanId) {\n            this.traceId = traceId;\n            this.spanId = spanId;\n            this.baggage = new HashMap<>();\n            this.sampled = true;\n            this.startTime = System.currentTimeMillis();\n        }\n        \n        // \u521B\u5EFA\u5B50\u4E0A\u4E0B\u6587\n        public TraceContext createChild(String childSpanId) {\n            TraceContext child = new TraceContext(this.traceId, childSpanId);\n            child.parentSpanId = this.spanId;\n            child.baggage = new HashMap<>(this.baggage);\n            child.sampled = this.sampled;\n            child.flags = this.flags;\n            return child;\n        }\n        \n        // \u8BBE\u7F6E\u884C\u674E\u4FE1\u606F\n        public void setBaggage(String key, Object value) {\n            this.baggage.put(key, value);\n        }\n        \n        // \u83B7\u53D6\u884C\u674E\u4FE1\u606F\n        public Object getBaggage(String key) {\n            return this.baggage.get(key);\n        }\n    }\n    \n    // \u8F85\u52A9\u7C7B\u5B9A\u4E49\n    public class Log {\n        private long timestamp;\n        private String message;\n        private Map<String, Object> fields;\n    }\n    \n    public class Event {\n        private long timestamp;\n        private String name;\n        private Map<String, Object> attributes;\n    }\n    \n    public class TraceStatistics {\n        private int totalSpans;\n        private long totalDuration;\n        private double averageSpanDuration;\n        private int errorCount;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u94FE\u8DEF\u8FFD\u8E2A\u793A\u4F8B\u573A\u666F",children:"\u94FE\u8DEF\u8FFD\u8E2A\u793A\u4F8B\u573A\u666F"}),"\n",(0,a.jsx)(e.p,{children:"\u8BA9\u6211\u4EEC\u901A\u8FC7\u4E00\u4E2A\u7535\u5546\u8BA2\u5355\u5904\u7406\u7684\u4F8B\u5B50\u6765\u7406\u89E3\u94FE\u8DEF\u8FFD\u8E2A\uFF1A"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u7528\u6237\u4E0B\u5355\u8BF7\u6C42\u7684\u5B8C\u6574\u94FE\u8DEF\uFF1A\n\u250C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Trace: order-12345                      \u2502\n\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Gateway Service (100ms)                                        \u2502\n\u2502 \u251C\u2500\u2500 Authentication (50ms)                                      \u2502\n\u2502 \u2514\u2500\u2500 Order Service (200ms)                                      \u2502\n\u2502     \u251C\u2500\u2500 Inventory Check (80ms)                                 \u2502\n\u2502     \u251C\u2500\u2500 Payment Service (150ms)                                \u2502\n\u2502     \u2502   \u251C\u2500\u2500 Credit Card Validation (30ms)                      \u2502\n\u2502     \u2502   \u2514\u2500\u2500 Payment Processing (120ms)                         \u2502\n\u2502     \u2514\u2500\u2500 Notification Service (50ms)                            \u2502\n\u2502         \u2514\u2500\u2500 Email Service (40ms)                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u603B\u8017\u65F6: 500ms\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5728\u8FD9\u4E2A\u4F8B\u5B50\u4E2D\uFF1A"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"TraceId"}),": ",(0,a.jsx)(e.code,{children:"order-12345"})," - \u552F\u4E00\u6807\u8BC6\u8FD9\u6B21\u8BA2\u5355\u8BF7\u6C42"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6839Span"}),": Gateway Service - \u8BF7\u6C42\u7684\u5165\u53E3\u70B9"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B50Span"}),": \u5404\u4E2A\u670D\u52A1\u7684\u8C03\u7528\uFF0C\u5F62\u6210\u6811\u72B6\u7ED3\u6784"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u8017\u65F6\u5206\u6790"}),": \u53EF\u4EE5\u770B\u5230Payment Service\u662F\u6700\u5927\u7684\u6027\u80FD\u74F6\u9888\uFF08150ms\uFF09"]}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"12-\u94FE\u8DEF\u8FFD\u8E2A\u67B6\u6784\u6A21\u5F0F",children:"1.2 \u94FE\u8DEF\u8FFD\u8E2A\u67B6\u6784\u6A21\u5F0F"}),"\n",(0,a.jsx)(e.h4,{id:"\u91C7\u6837\u67B6\u6784\u8BE6\u89E3",children:"\u91C7\u6837\u67B6\u6784\u8BE6\u89E3"}),"\n",(0,a.jsx)(e.p,{children:"\u91C7\u6837\u662F\u94FE\u8DEF\u8FFD\u8E2A\u4E2D\u7684\u5173\u952E\u6280\u672F\uFF0C\u56E0\u4E3A\u5728\u9AD8\u5E76\u53D1\u7CFB\u7EDF\u4E2D\uFF0C\u5982\u679C\u5BF9\u6BCF\u4E2A\u8BF7\u6C42\u90FD\u8FDB\u884C\u5B8C\u6574\u8FFD\u8E2A\uFF0C\u4F1A\u4EA7\u751F\u5DE8\u5927\u7684\u6027\u80FD\u5F00\u9500\u548C\u5B58\u50A8\u6210\u672C\u3002\u5408\u7406\u7684\u91C7\u6837\u7B56\u7565\u53EF\u4EE5\u5728\u4FDD\u8BC1\u76D1\u63A7\u6548\u679C\u7684\u540C\u65F6\uFF0C\u663E\u8457\u964D\u4F4E\u7CFB\u7EDF\u5F00\u9500\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u91C7\u6837\u67B6\u6784\u5B9E\u73B0"',children:'public class SamplingArchitecture {\n    /*\n     * \u91C7\u6837\u67B6\u6784\u7684\u6838\u5FC3\u7EC4\u4EF6\n     * 1. \u91C7\u6837\u5668\uFF1A\u51B3\u5B9A\u662F\u5426\u5BF9\u8BF7\u6C42\u8FDB\u884C\u8FFD\u8E2A\n     * 2. \u91C7\u6837\u7B56\u7565\uFF1A\u4E0D\u540C\u7684\u91C7\u6837\u7B97\u6CD5\u548C\u89C4\u5219\n     * 3. \u52A8\u6001\u91C7\u6837\uFF1A\u6839\u636E\u7CFB\u7EDF\u8D1F\u8F7D\u8C03\u6574\u91C7\u6837\u7387\n     * 4. \u91C7\u6837\u51B3\u7B56\uFF1A\u5728\u8BF7\u6C42\u5165\u53E3\u5904\u8FDB\u884C\u91C7\u6837\u5224\u65AD\n     */\n    \n    // \u91C7\u6837\u5668\u63A5\u53E3\n    public interface Sampler {\n        // \u51B3\u5B9A\u662F\u5426\u91C7\u6837\n        SamplingDecision shouldSample(TraceContext context);\n        \n        // \u83B7\u53D6\u91C7\u6837\u7387\n        double getSamplingRate();\n        \n        // \u83B7\u53D6\u91C7\u6837\u5668\u7C7B\u578B\n        String getSamplerType();\n        \n        // \u83B7\u53D6\u91C7\u6837\u5668\u63CF\u8FF0\n        String getDescription();\n    }\n    \n    // \u91C7\u6837\u51B3\u7B56\n    public class SamplingDecision {\n        private boolean sampled;          // \u662F\u5426\u91C7\u6837\n        private double samplingRate;      // \u91C7\u6837\u7387\n        private Map<String, String> tags; // \u91C7\u6837\u76F8\u5173\u7684\u6807\u7B7E\n        private String reason;            // \u91C7\u6837\u539F\u56E0\n        \n        public SamplingDecision(boolean sampled, double samplingRate) {\n            this.sampled = sampled;\n            this.samplingRate = samplingRate;\n            this.tags = new HashMap<>();\n        }\n        \n        // \u6DFB\u52A0\u91C7\u6837\u6807\u7B7E\n        public void addTag(String key, String value) {\n            this.tags.put(key, value);\n        }\n    }\n    \n    // \u6982\u7387\u91C7\u6837\u5668 - \u6700\u7B80\u5355\u7684\u91C7\u6837\u7B56\u7565\n    public class ProbabilitySampler implements Sampler {\n        private final double samplingRate;\n        private final Random random;\n        private final String description;\n        \n        public ProbabilitySampler(double samplingRate) {\n            if (samplingRate < 0.0 || samplingRate > 1.0) {\n                throw new IllegalArgumentException("Sampling rate must be between 0.0 and 1.0");\n            }\n            this.samplingRate = samplingRate;\n            this.random = new Random();\n            this.description = String.format("ProbabilitySampler(rate=%.2f)", samplingRate);\n        }\n        \n        @Override\n        public SamplingDecision shouldSample(TraceContext context) {\n            boolean sampled = random.nextDouble() < samplingRate;\n            SamplingDecision decision = new SamplingDecision(sampled, samplingRate);\n            \n            if (sampled) {\n                decision.addTag("sampler.type", "probability");\n                decision.addTag("sampler.rate", String.valueOf(samplingRate));\n                decision.setReason("Random sampling based on probability");\n            } else {\n                decision.setReason("Request not sampled due to probability");\n            }\n            \n            return decision;\n        }\n        \n        @Override\n        public double getSamplingRate() {\n            return samplingRate;\n        }\n        \n        @Override\n        public String getSamplerType() {\n            return "Probability";\n        }\n        \n        @Override\n        public String getDescription() {\n            return description;\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u91C7\u6837\u7B56\u7565\u5BF9\u6BD4",children:"\u91C7\u6837\u7B56\u7565\u5BF9\u6BD4"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"\u91C7\u6837\u7B56\u7565"}),(0,a.jsx)(e.th,{children:"\u4F18\u70B9"}),(0,a.jsx)(e.th,{children:"\u7F3A\u70B9"}),(0,a.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u6982\u7387\u91C7\u6837"})}),(0,a.jsx)(e.td,{children:"\u5B9E\u73B0\u7B80\u5355\uFF0C\u5F00\u9500\u5C0F"}),(0,a.jsx)(e.td,{children:"\u53EF\u80FD\u9057\u6F0F\u91CD\u8981\u8BF7\u6C42"}),(0,a.jsx)(e.td,{children:"\u4E00\u822C\u76D1\u63A7\u573A\u666F"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u89C4\u5219\u91C7\u6837"})}),(0,a.jsx)(e.td,{children:"\u7075\u6D3B\uFF0C\u53EF\u9488\u5BF9\u7279\u5B9A\u573A\u666F"}),(0,a.jsx)(e.td,{children:"\u914D\u7F6E\u590D\u6742\uFF0C\u7EF4\u62A4\u6210\u672C\u9AD8"}),(0,a.jsx)(e.td,{children:"\u9700\u8981\u7CBE\u786E\u63A7\u5236\u7684\u573A\u666F"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u52A8\u6001\u91C7\u6837"})}),(0,a.jsx)(e.td,{children:"\u81EA\u9002\u5E94\uFF0C\u5E73\u8861\u6027\u80FD\u548C\u6570\u636E"}),(0,a.jsx)(e.td,{children:"\u5B9E\u73B0\u590D\u6742\uFF0C\u9700\u8981\u76D1\u63A7\u7CFB\u7EDF"}),(0,a.jsx)(e.td,{children:"\u9AD8\u8D1F\u8F7D\u7CFB\u7EDF"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u5173\u952E\u8DEF\u5F84\u91C7\u6837"})}),(0,a.jsx)(e.td,{children:"\u4FDD\u8BC1\u91CD\u8981\u8BF7\u6C42\u7684\u5B8C\u6574\u6027"}),(0,a.jsx)(e.td,{children:"\u91C7\u6837\u7387\u53EF\u80FD\u5F88\u9AD8"}),(0,a.jsx)(e.td,{children:"\u5173\u952E\u4E1A\u52A1\u573A\u666F"})]})]})]}),"\n",(0,a.jsx)(e.admonition,{title:"\u91C7\u6837\u7B56\u7565\u9009\u62E9\u5EFA\u8BAE",type:"info",children:(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F00\u53D1\u73AF\u5883"}),"\uFF1A\u4F7F\u7528\u9AD8\u91C7\u6837\u7387\uFF08\u598250%-100%\uFF09\u4EE5\u83B7\u53D6\u8BE6\u7EC6\u4FE1\u606F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6D4B\u8BD5\u73AF\u5883"}),"\uFF1A\u4F7F\u7528\u4E2D\u7B49\u91C7\u6837\u7387\uFF08\u598210%-30%\uFF09\u5E73\u8861\u6027\u80FD\u548C\u76D1\u63A7"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u751F\u4EA7\u73AF\u5883"}),"\uFF1A\u4F7F\u7528\u4F4E\u91C7\u6837\u7387\uFF08\u59821%-5%\uFF09\u51CF\u5C11\u6027\u80FD\u5F71\u54CD"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5173\u952E\u4E1A\u52A1"}),"\uFF1A\u5BF9\u91CD\u8981\u63A5\u53E3\u4F7F\u7528\u89C4\u5219\u91C7\u6837\uFF0C\u4FDD\u8BC1100%\u91C7\u6837"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u9AD8\u8D1F\u8F7D\u7CFB\u7EDF"}),"\uFF1A\u4F7F\u7528\u52A8\u6001\u91C7\u6837\uFF0C\u6839\u636E\u7CFB\u7EDF\u8D1F\u8F7D\u8C03\u6574\u91C7\u6837\u7387"]}),"\n"]})}),"\n",(0,a.jsx)(e.h3,{id:"13-\u94FE\u8DEF\u8FFD\u8E2A\u7684\u4F18\u52BF\u4E0E\u6311\u6218",children:"1.3 \u94FE\u8DEF\u8FFD\u8E2A\u7684\u4F18\u52BF\u4E0E\u6311\u6218"}),"\n",(0,a.jsx)(e.h4,{id:"\u6838\u5FC3\u4F18\u52BF\u8BE6\u89E3",children:"\u6838\u5FC3\u4F18\u52BF\u8BE6\u89E3"}),"\n",(0,a.jsx)(e.p,{children:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u6280\u672F\u4E3A\u5FAE\u670D\u52A1\u67B6\u6784\u5E26\u6765\u4E86\u9769\u547D\u6027\u7684\u76D1\u63A7\u548C\u8BCA\u65AD\u80FD\u529B\uFF0C\u8BA9\u6211\u4EEC\u80FD\u591F\u4ECE\u591A\u4E2A\u7EF4\u5EA6\u6DF1\u5165\u7406\u89E3\u7CFB\u7EDF\u884C\u4E3A\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u94FE\u8DEF\u8FFD\u8E2A\u6838\u5FC3\u4F18\u52BF\u5B9E\u73B0"',children:'public class TracingAdvantages {\n    /*\n     * \u94FE\u8DEF\u8FFD\u8E2A\u7684\u6838\u5FC3\u4F18\u52BF\n     * 1. \u7AEF\u5230\u7AEF\u53EF\u89C1\u6027\uFF1A\u5B8C\u6574\u8FFD\u8E2A\u8BF7\u6C42\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u6D41\u8F6C\n     * 2. \u6027\u80FD\u5206\u6790\uFF1A\u7CBE\u786E\u5206\u6790\u6BCF\u4E2A\u73AF\u8282\u7684\u8017\u65F6\u548C\u74F6\u9888\n     * 3. \u6545\u969C\u5B9A\u4F4D\uFF1A\u5FEB\u901F\u5B9A\u4F4D\u9519\u8BEF\u53D1\u751F\u7684\u5177\u4F53\u4F4D\u7F6E\u548C\u539F\u56E0\n     * 4. \u4F9D\u8D56\u5206\u6790\uFF1A\u7406\u89E3\u670D\u52A1\u95F4\u7684\u8C03\u7528\u5173\u7CFB\u548C\u4F9D\u8D56\u94FE\n     * 5. \u4E1A\u52A1\u6D1E\u5BDF\uFF1A\u7ED3\u5408\u4E1A\u52A1\u6570\u636E\uFF0C\u63D0\u4F9B\u4E1A\u52A1\u5C42\u9762\u7684\u5206\u6790\n     * 6. \u5BB9\u91CF\u89C4\u5212\uFF1A\u57FA\u4E8E\u8C03\u7528\u94FE\u6570\u636E\uFF0C\u8FDB\u884C\u5408\u7406\u7684\u5BB9\u91CF\u89C4\u5212\n     */\n    \n    // \u6027\u80FD\u5206\u6790\u7EC4\u4EF6\n    public class PerformanceAnalysis {\n        private List<ServicePerformanceMetrics> metrics;\n        private List<PerformanceBottleneck> bottlenecks;\n        private Map<String, Double> serviceLatencyP95;\n        private Map<String, Double> serviceLatencyP99;\n        \n        public PerformanceAnalysis() {\n            this.metrics = new ArrayList<>();\n            this.bottlenecks = new ArrayList<>();\n            this.serviceLatencyP95 = new HashMap<>();\n            this.serviceLatencyP99 = new HashMap<>();\n        }\n        \n        // \u5206\u6790\u94FE\u8DEF\u6027\u80FD\n        public void analyzeTracePerformance(Trace trace) {\n            // \u8BA1\u7B97\u6BCF\u4E2A\u670D\u52A1\u7684\u6027\u80FD\u6307\u6807\n            Map<String, List<Long>> serviceDurations = new HashMap<>();\n            \n            for (Span span : trace.getSpans()) {\n                String serviceName = span.getServiceName();\n                serviceDurations.computeIfAbsent(serviceName, k -> new ArrayList<>())\n                    .add(span.getDuration());\n            }\n            \n            // \u8BA1\u7B97P95\u548CP99\u5EF6\u8FDF\n            for (Map.Entry<String, List<Long>> entry : serviceDurations.entrySet()) {\n                String serviceName = entry.getKey();\n                List<Long> durations = entry.getValue();\n                Collections.sort(durations);\n                \n                int p95Index = (int) Math.ceil(durations.size() * 0.95) - 1;\n                int p99Index = (int) Math.ceil(durations.size() * 0.99) - 1;\n                \n                serviceLatencyP95.put(serviceName, (double) durations.get(p95Index));\n                serviceLatencyP99.put(serviceName, (double) durations.get(p99Index));\n            }\n            \n            // \u8BC6\u522B\u6027\u80FD\u74F6\u9888\n            identifyBottlenecks(trace);\n        }\n        \n        // \u8BC6\u522B\u6027\u80FD\u74F6\u9888\n        private void identifyBottlenecks(Trace trace) {\n            List<Span> spans = trace.getSpans();\n            \n            // \u6309\u8017\u65F6\u6392\u5E8F\uFF0C\u627E\u51FA\u6700\u6162\u7684Span\n            spans.sort((a, b) -> Long.compare(b.getDuration(), a.getDuration()));\n            \n            // \u524D3\u4E2A\u6700\u6162\u7684Span\u4F5C\u4E3A\u6F5C\u5728\u74F6\u9888\n            for (int i = 0; i < Math.min(3, spans.size()); i++) {\n                Span span = spans.get(i);\n                PerformanceBottleneck bottleneck = new PerformanceBottleneck();\n                bottleneck.setServiceName(span.getServiceName());\n                bottleneck.setOperationName(span.getOperationName());\n                bottleneck.setDuration(span.getDuration());\n                bottleneck.setPercentage((double) span.getDuration() / trace.getTotalDuration() * 100);\n                bottleneck.setSeverity(getBottleneckSeverity(bottleneck.getPercentage()));\n                \n                bottlenecks.add(bottleneck);\n            }\n        }\n        \n        // \u5224\u65AD\u74F6\u9888\u4E25\u91CD\u7A0B\u5EA6\n        private String getBottleneckSeverity(double percentage) {\n            if (percentage > 50) return "CRITICAL";\n            if (percentage > 30) return "HIGH";\n            if (percentage > 15) return "MEDIUM";\n            return "LOW";\n        }\n        \n        // \u751F\u6210\u6027\u80FD\u62A5\u544A\n        public String generatePerformanceReport() {\n            StringBuilder report = new StringBuilder();\n            report.append("=== \u6027\u80FD\u5206\u6790\u62A5\u544A ===\\n");\n            \n            report.append("\u670D\u52A1\u5EF6\u8FDF\u7EDF\u8BA1 (P95):\\n");\n            serviceLatencyP95.forEach((service, latency) -> \n                report.append(String.format("  %s: %.2fms\\n", service, latency)));\n            \n            report.append("\\n\u6027\u80FD\u74F6\u9888\u5206\u6790:\\n");\n            bottlenecks.forEach(bottleneck -> \n                report.append(String.format("  %s.%s: %.2fms (%.1f%%) [%s]\\n", \n                    bottleneck.getServiceName(), \n                    bottleneck.getOperationName(),\n                    bottleneck.getDuration(),\n                    bottleneck.getPercentage(),\n                    bottleneck.getSeverity())));\n            \n            return report.toString();\n        }\n    }\n    \n    // \u6545\u969C\u5B9A\u4F4D\u7EC4\u4EF6\n    public class FaultLocalization {\n        private List<FaultRootCause> rootCauses;\n        private List<ErrorPropagationStep> errorSteps;\n        private Map<String, ErrorImpactAnalysis> impactAnalysis;\n        \n        public FaultLocalization() {\n            this.rootCauses = new ArrayList<>();\n            this.errorSteps = new ArrayList<>();\n            this.impactAnalysis = new HashMap<>();\n        }\n        \n        // \u5206\u6790\u94FE\u8DEF\u4E2D\u7684\u9519\u8BEF\n        public void analyzeTraceErrors(Trace trace) {\n            List<Span> errorSpans = trace.getSpans().stream()\n                .filter(span -> "ERROR".equals(span.getStatus()))\n                .collect(Collectors.toList());\n            \n            if (errorSpans.isEmpty()) {\n                return;\n            }\n            \n            // \u5206\u6790\u9519\u8BEF\u4F20\u64AD\u8DEF\u5F84\n            analyzeErrorPropagation(trace, errorSpans);\n            \n            // \u8BC6\u522B\u6839\u672C\u539F\u56E0\n            identifyRootCauses(errorSpans);\n            \n            // \u5206\u6790\u9519\u8BEF\u5F71\u54CD\n            analyzeErrorImpact(trace, errorSpans);\n        }\n        \n        // \u5206\u6790\u9519\u8BEF\u4F20\u64AD\u8DEF\u5F84\n        private void analyzeErrorPropagation(Trace trace, List<Span> errorSpans) {\n            for (Span errorSpan : errorSpans) {\n                ErrorPropagationStep step = new ErrorPropagationStep();\n                step.setServiceName(errorSpan.getServiceName());\n                step.setOperationName(errorSpan.getOperationName());\n                step.setErrorMessage(errorSpan.getErrorMessage());\n                step.setTimestamp(errorSpan.getEndTime());\n                step.setDuration(errorSpan.getDuration());\n                \n                // \u67E5\u627E\u7236\u7EA7Span\uFF0C\u4E86\u89E3\u9519\u8BEF\u4F20\u64AD\u94FE\n                String parentId = errorSpan.getParentSpanId();\n                if (parentId != null) {\n                    Span parentSpan = trace.getSpans().stream()\n                        .filter(span -> span.getSpanId().equals(parentId))\n                        .findFirst()\n                        .orElse(null);\n                    \n                    if (parentSpan != null) {\n                        step.setParentService(parentSpan.getServiceName());\n                        step.setParentOperation(parentSpan.getOperationName());\n                    }\n                }\n                \n                errorSteps.add(step);\n            }\n            \n            // \u6309\u65F6\u95F4\u6392\u5E8F\n            errorSteps.sort(Comparator.comparing(ErrorPropagationStep::getTimestamp));\n        }\n        \n        // \u8BC6\u522B\u6839\u672C\u539F\u56E0\n        private void identifyRootCauses(List<Span> errorSpans) {\n            for (Span errorSpan : errorSpans) {\n                FaultRootCause rootCause = new FaultRootCause();\n                rootCause.setServiceName(errorSpan.getServiceName());\n                rootCause.setOperationName(errorSpan.getOperationName());\n                rootCause.setErrorMessage(errorSpan.getErrorMessage());\n                rootCause.setTimestamp(errorSpan.getEndTime());\n                \n                // \u5206\u6790\u9519\u8BEF\u7C7B\u578B\n                String errorMessage = errorSpan.getErrorMessage();\n                if (errorMessage.contains("timeout")) {\n                    rootCause.setErrorType("TIMEOUT");\n                    rootCause.setSeverity("HIGH");\n                } else if (errorMessage.contains("connection")) {\n                    rootCause.setErrorType("NETWORK");\n                    rootCause.setSeverity("MEDIUM");\n                } else if (errorMessage.contains("database")) {\n                    rootCause.setErrorType("DATABASE");\n                    rootCause.setSeverity("HIGH");\n                } else {\n                    rootCause.setErrorType("BUSINESS");\n                    rootCause.setSeverity("MEDIUM");\n                }\n                \n                rootCauses.add(rootCause);\n            }\n        }\n        \n        // \u5206\u6790\u9519\u8BEF\u5F71\u54CD\n        private void analyzeErrorImpact(Trace trace, List<Span> errorSpans) {\n            for (Span errorSpan : errorSpans) {\n                String serviceName = errorSpan.getServiceName();\n                \n                ErrorImpactAnalysis impact = impactAnalysis.computeIfAbsent(\n                    serviceName, k -> new ErrorImpactAnalysis());\n                \n                impact.setServiceName(serviceName);\n                impact.incrementErrorCount();\n                impact.addErrorDuration(errorSpan.getDuration());\n                \n                // \u8BA1\u7B97\u9519\u8BEF\u7387\n                long totalSpansForService = trace.getSpans().stream()\n                    .filter(span -> span.getServiceName().equals(serviceName))\n                    .count();\n                impact.setErrorRate((double) impact.getErrorCount() / totalSpansForService);\n            }\n        }\n        \n        // \u751F\u6210\u6545\u969C\u62A5\u544A\n        public String generateFaultReport() {\n            StringBuilder report = new StringBuilder();\n            report.append("=== \u6545\u969C\u5B9A\u4F4D\u62A5\u544A ===\\n");\n            \n            report.append("\u9519\u8BEF\u4F20\u64AD\u8DEF\u5F84:\\n");\n            errorSteps.forEach(step -> \n                report.append(String.format("  %s.%s -> %s.%s: %s\\n", \n                    step.getParentService(), \n                    step.getParentOperation(),\n                    step.getServiceName(), \n                    step.getOperationName(),\n                    step.getErrorMessage())));\n            \n            report.append("\\n\u6839\u672C\u539F\u56E0\u5206\u6790:\\n");\n            rootCauses.forEach(cause -> \n                report.append(String.format("  %s.%s: %s [%s] - %s\\n", \n                    cause.getServiceName(), \n                    cause.getOperationName(),\n                    cause.getErrorType(),\n                    cause.getSeverity(),\n                    cause.getErrorMessage())));\n            \n            report.append("\\n\u9519\u8BEF\u5F71\u54CD\u5206\u6790:\\n");\n            impactAnalysis.values().forEach(impact -> \n                report.append(String.format("  %s: \u9519\u8BEF\u7387 %.2f%%, \u5E73\u5747\u9519\u8BEF\u8017\u65F6 %.2fms\\n", \n                    impact.getServiceName(),\n                    impact.getErrorRate() * 100,\n                    impact.getAverageErrorDuration())));\n            \n            return report.toString();\n        }\n    }\n    \n    // \u4F9D\u8D56\u5206\u6790\u7EC4\u4EF6\n    public class DependencyAnalysis {\n        private Map<String, ServiceDependency> dependencies;\n        private List<String> criticalPaths;\n        private Map<String, Integer> serviceCallCounts;\n        \n        public DependencyAnalysis() {\n            this.dependencies = new HashMap<>();\n            this.criticalPaths = new ArrayList<>();\n            this.serviceCallCounts = new HashMap<>();\n        }\n        \n        // \u5206\u6790\u670D\u52A1\u4F9D\u8D56\u5173\u7CFB\n        public void analyzeServiceDependencies(Trace trace) {\n            Map<String, Set<String>> serviceCalls = new HashMap<>();\n            \n            for (Span span : trace.getSpans()) {\n                String serviceName = span.getServiceName();\n                String parentId = span.getParentSpanId();\n                \n                if (parentId != null) {\n                    Span parentSpan = trace.getSpans().stream()\n                        .filter(s -> s.getSpanId().equals(parentId))\n                        .findFirst()\n                        .orElse(null);\n                    \n                    if (parentSpan != null) {\n                        String parentService = parentSpan.getServiceName();\n                        serviceCalls.computeIfAbsent(parentService, k -> new HashSet<>())\n                            .add(serviceName);\n                        \n                        // \u7EDF\u8BA1\u8C03\u7528\u6B21\u6570\n                        String callKey = parentService + "->" + serviceName;\n                        serviceCallCounts.put(callKey, \n                            serviceCallCounts.getOrDefault(callKey, 0) + 1);\n                    }\n                }\n            }\n            \n            // \u6784\u5EFA\u4F9D\u8D56\u5173\u7CFB\n            for (Map.Entry<String, Set<String>> entry : serviceCalls.entrySet()) {\n                String caller = entry.getKey();\n                Set<String> callees = entry.getValue();\n                \n                for (String callee : callees) {\n                    ServiceDependency dependency = new ServiceDependency();\n                    dependency.setCallerService(caller);\n                    dependency.setCalleeService(callee);\n                    dependency.setCallCount(serviceCallCounts.get(caller + "->" + callee));\n                    \n                    dependencies.put(caller + "->" + callee, dependency);\n                }\n            }\n            \n            // \u8BC6\u522B\u5173\u952E\u8DEF\u5F84\n            identifyCriticalPaths(trace);\n        }\n        \n        // \u8BC6\u522B\u5173\u952E\u8DEF\u5F84\n        private void identifyCriticalPaths(Trace trace) {\n            // \u627E\u51FA\u8017\u65F6\u6700\u957F\u7684\u8C03\u7528\u94FE\n            List<Span> spans = trace.getSpans();\n            Map<String, Long> pathDurations = new HashMap<>();\n            \n            for (Span span : spans) {\n                String path = buildServicePath(span, spans);\n                pathDurations.put(path, \n                    pathDurations.getOrDefault(path, 0L) + span.getDuration());\n            }\n            \n            // \u6309\u8017\u65F6\u6392\u5E8F\uFF0C\u53D6\u524D3\u4E2A\u4F5C\u4E3A\u5173\u952E\u8DEF\u5F84\n            pathDurations.entrySet().stream()\n                .sorted(Map.Entry.<String, Long>comparingByValue().reversed())\n                .limit(3)\n                .forEach(entry -> criticalPaths.add(entry.getKey()));\n        }\n        \n        // \u6784\u5EFA\u670D\u52A1\u8C03\u7528\u8DEF\u5F84\n        private String buildServicePath(Span span, List<Span> allSpans) {\n            List<String> path = new ArrayList<>();\n            Span current = span;\n            \n            while (current != null) {\n                path.add(0, current.getServiceName());\n                String parentId = current.getParentSpanId();\n                current = parentId != null ? \n                    allSpans.stream().filter(s -> s.getSpanId().equals(parentId))\n                        .findFirst().orElse(null) : null;\n            }\n            \n            return String.join(" -> ", path);\n        }\n        \n        // \u751F\u6210\u4F9D\u8D56\u62A5\u544A\n        public String generateDependencyReport() {\n            StringBuilder report = new StringBuilder();\n            report.append("=== \u4F9D\u8D56\u5206\u6790\u62A5\u544A ===\\n");\n            \n            report.append("\u670D\u52A1\u4F9D\u8D56\u5173\u7CFB:\\n");\n            dependencies.values().forEach(dep -> \n                report.append(String.format("  %s -> %s (\u8C03\u7528\u6B21\u6570: %d)\\n", \n                    dep.getCallerService(), \n                    dep.getCalleeService(),\n                    dep.getCallCount())));\n            \n            report.append("\\n\u5173\u952E\u8C03\u7528\u8DEF\u5F84:\\n");\n            criticalPaths.forEach(path -> \n                report.append(String.format("  %s\\n", path)));\n            \n            return report.toString();\n        }\n    }\n    \n    // \u8F85\u52A9\u6570\u636E\u6A21\u578B\n    public class ServicePerformanceMetrics {\n        private String serviceName;\n        private double avgLatency;\n        private double p95Latency;\n        private double p99Latency;\n        private int requestCount;\n        private int errorCount;\n        private double errorRate;\n    }\n    \n    public class PerformanceBottleneck {\n        private String serviceName;\n        private String operationName;\n        private long duration;\n        private double percentage;\n        private String severity;\n    }\n    \n    public class ServiceDependency {\n        private String callerService;\n        private String calleeService;\n        private int callCount;\n        private double avgLatency;\n    }\n    \n    public class FaultRootCause {\n        private String serviceName;\n        private String operationName;\n        private String errorMessage;\n        private String errorType;\n        private String severity;\n        private long timestamp;\n    }\n    \n    public class ErrorPropagationStep {\n        private String serviceName;\n        private String operationName;\n        private String parentService;\n        private String parentOperation;\n        private String errorMessage;\n        private long timestamp;\n        private long duration;\n    }\n    \n    public class ErrorImpactAnalysis {\n        private String serviceName;\n        private int errorCount;\n        private long totalErrorDuration;\n        private double errorRate;\n        private double averageErrorDuration;\n    }\n    \n    public class TimeRange {\n        private long startTime;\n        private long endTime;\n        private long duration;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u4E3B\u8981\u6311\u6218\u4E0E\u89E3\u51B3\u65B9\u6848",children:"\u4E3B\u8981\u6311\u6218\u4E0E\u89E3\u51B3\u65B9\u6848"}),"\n",(0,a.jsx)(e.p,{children:"\u867D\u7136\u94FE\u8DEF\u8FFD\u8E2A\u6280\u672F\u5E26\u6765\u4E86\u5DE8\u5927\u7684\u4EF7\u503C\uFF0C\u4F46\u5728\u5B9E\u9645\u5E94\u7528\u4E2D\u4E5F\u4F1A\u9762\u4E34\u4E00\u4E9B\u6311\u6218\u3002\u7406\u89E3\u8FD9\u4E9B\u6311\u6218\u5E76\u91C7\u53D6\u76F8\u5E94\u7684\u89E3\u51B3\u65B9\u6848\uFF0C\u662F\u6210\u529F\u5B9E\u65BD\u94FE\u8DEF\u8FFD\u8E2A\u7684\u5173\u952E\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u94FE\u8DEF\u8FFD\u8E2A\u6311\u6218\u4E0E\u89E3\u51B3\u65B9\u6848"',children:'public class TracingChallenges {\n    /*\n     * \u94FE\u8DEF\u8FFD\u8E2A\u9762\u4E34\u7684\u4E3B\u8981\u6311\u6218\n     * 1. \u6027\u80FD\u5F00\u9500\uFF1A\u91C7\u6837\u548C\u8FFD\u8E2A\u5BF9\u7CFB\u7EDF\u6027\u80FD\u7684\u5F71\u54CD\n     * 2. \u5B58\u50A8\u6210\u672C\uFF1A\u5927\u91CF\u8FFD\u8E2A\u6570\u636E\u7684\u5B58\u50A8\u548C\u7BA1\u7406\n     * 3. \u91C7\u6837\u7B56\u7565\uFF1A\u5982\u4F55\u5E73\u8861\u6570\u636E\u5B8C\u6574\u6027\u548C\u7CFB\u7EDF\u6027\u80FD\n     * 4. \u4E0A\u4E0B\u6587\u4F20\u64AD\uFF1A\u8DE8\u670D\u52A1\u3001\u8DE8\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\u4F20\u9012\n     * 5. \u6570\u636E\u4E00\u81F4\u6027\uFF1A\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u7684\u6570\u636E\u4E00\u81F4\u6027\u95EE\u9898\n     * 6. \u9690\u79C1\u4FDD\u62A4\uFF1A\u654F\u611F\u6570\u636E\u7684\u5904\u7406\u548C\u4F20\u8F93\n     */\n    \n    // \u6027\u80FD\u4F18\u5316\u7EC4\u4EF6\n    public class PerformanceOptimization {\n        private AsyncSampler asyncSampler;\n        private BatchExporter batchExporter;\n        private SpanCompressor spanCompressor;\n        private CacheManager cacheManager;\n        \n        public PerformanceOptimization() {\n            this.asyncSampler = new AsyncSampler();\n            this.batchExporter = new BatchExporter();\n            this.spanCompressor = new SpanCompressor();\n            this.cacheManager = new CacheManager();\n        }\n        \n        // \u5F02\u6B65\u91C7\u6837\u5668 - \u51CF\u5C11\u540C\u6B65\u5F00\u9500\n        public class AsyncSampler {\n            private final ExecutorService executor;\n            private final BlockingQueue<SamplingTask> taskQueue;\n            private final AtomicLong processedCount;\n            private final AtomicLong droppedCount;\n            \n            public AsyncSampler() {\n                this.executor = Executors.newSingleThreadExecutor(r -> {\n                    Thread t = new Thread(r, "async-sampler");\n                    t.setDaemon(true);\n                    return t;\n                });\n                this.taskQueue = new LinkedBlockingQueue<>(10000);\n                this.processedCount = new AtomicLong(0);\n                this.droppedCount = new AtomicLong(0);\n                \n                startProcessing();\n            }\n            \n            // \u5F02\u6B65\u91C7\u6837\n            public void sampleAsync(TraceContext context, Runnable samplingAction) {\n                SamplingTask task = new SamplingTask(context, samplingAction);\n                \n                if (!taskQueue.offer(task)) {\n                    droppedCount.incrementAndGet();\n                    // \u961F\u5217\u6EE1\u65F6\uFF0C\u76F4\u63A5\u6267\u884C\u91C7\u6837\u51B3\u7B56\n                    samplingAction.run();\n                }\n            }\n            \n            // \u542F\u52A8\u5904\u7406\u7EBF\u7A0B\n            private void startProcessing() {\n                executor.submit(() -> {\n                    while (!Thread.currentInterrupted()) {\n                        try {\n                            SamplingTask task = taskQueue.take();\n                            task.execute();\n                            processedCount.incrementAndGet();\n                        } catch (InterruptedException e) {\n                            Thread.currentThread().interrupt();\n                            break;\n                        }\n                    }\n                });\n            }\n            \n            // \u83B7\u53D6\u7EDF\u8BA1\u4FE1\u606F\n            public SamplingStats getStats() {\n                SamplingStats stats = new SamplingStats();\n                stats.setProcessedCount(processedCount.get());\n                stats.setDroppedCount(droppedCount.get());\n                stats.setQueueSize(taskQueue.size());\n                return stats;\n            }\n        }\n        \n        // \u6279\u91CF\u5BFC\u51FA\u5668 - \u51CF\u5C11\u7F51\u7EDC\u5F00\u9500\n        public class BatchExporter {\n            private final BlockingQueue<Span> spanQueue;\n            private final ExecutorService executor;\n            private final int batchSize;\n            private final long flushInterval;\n            private final SpanExporter exporter;\n            \n            public BatchExporter(int batchSize, long flushInterval, SpanExporter exporter) {\n                this.spanQueue = new LinkedBlockingQueue<>(10000);\n                this.executor = Executors.newSingleThreadExecutor(r -> {\n                    Thread t = new Thread(r, "batch-exporter");\n                    t.setDaemon(true);\n                    return t;\n                });\n                this.batchSize = batchSize;\n                this.flushInterval = flushInterval;\n                this.exporter = exporter;\n                \n                startBatchProcessing();\n            }\n            \n            // \u6DFB\u52A0Span\u5230\u6279\u91CF\u961F\u5217\n            public void addSpan(Span span) {\n                spanQueue.offer(span);\n            }\n            \n            // \u542F\u52A8\u6279\u91CF\u5904\u7406\n            private void startBatchProcessing() {\n                executor.submit(() -> {\n                    List<Span> batch = new ArrayList<>();\n                    long lastFlushTime = System.currentTimeMillis();\n                    \n                    while (!Thread.currentInterrupted()) {\n                        try {\n                            // \u5C1D\u8BD5\u4ECE\u961F\u5217\u83B7\u53D6Span\n                            Span span = spanQueue.poll(flushInterval, TimeUnit.MILLISECONDS);\n                            \n                            if (span != null) {\n                                batch.add(span);\n                            }\n                            \n                            long currentTime = System.currentTimeMillis();\n                            \n                            // \u6EE1\u8DB3\u6279\u91CF\u6761\u4EF6\u65F6\u5BFC\u51FA\n                            if (batch.size() >= batchSize || \n                                (currentTime - lastFlushTime >= flushInterval && !batch.isEmpty())) {\n                                \n                                if (!batch.isEmpty()) {\n                                    exporter.export(batch);\n                                    batch.clear();\n                                    lastFlushTime = currentTime;\n                                }\n                            }\n                        } catch (InterruptedException e) {\n                            Thread.currentThread().interrupt();\n                            break;\n                        }\n                    }\n                    \n                    // \u5BFC\u51FA\u5269\u4F59\u7684Span\n                    if (!batch.isEmpty()) {\n                        exporter.export(batch);\n                    }\n                });\n            }\n        }\n        \n        // Span\u538B\u7F29\u5668 - \u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\n        public class SpanCompressor {\n            private final Map<String, String> commonTags;\n            private final Map<String, String> commonOperations;\n            \n            public SpanCompressor() {\n                this.commonTags = new HashMap<>();\n                this.commonOperations = new HashMap<>();\n            }\n        \n            // \u538B\u7F29Span\u6570\u636E\n            public CompressedSpan compress(Span span) {\n                CompressedSpan compressed = new CompressedSpan();\n                \n                // \u538B\u7F29\u6807\u7B7E\n                Map<String, Integer> tagIndices = new HashMap<>();\n                for (Map.Entry<String, String> entry : span.getTags().entrySet()) {\n                    String key = entry.getKey();\n                    String value = entry.getValue();\n                    \n                    // \u68C0\u67E5\u662F\u5426\u662F\u5E38\u89C1\u6807\u7B7E\n                    String commonKey = key + ":" + value;\n                    if (commonTags.containsKey(commonKey)) {\n                        tagIndices.put(key, commonTags.get(commonKey).hashCode());\n                    } else {\n                        commonTags.put(commonKey, value);\n                        tagIndices.put(key, value.hashCode());\n                    }\n                }\n                \n                compressed.setTagIndices(tagIndices);\n                compressed.setStartTime(span.getStartTime());\n                compressed.setDuration(span.getDuration());\n                compressed.setStatus(span.getStatus());\n                \n                return compressed;\n            }\n            \n            // \u89E3\u538B\u7F29Span\u6570\u636E\n            public Span decompress(CompressedSpan compressed) {\n                Span span = new Span();\n                \n                // \u89E3\u538B\u7F29\u6807\u7B7E\n                Map<String, String> tags = new HashMap<>();\n                for (Map.Entry<String, Integer> entry : compressed.getTagIndices().entrySet()) {\n                    String key = entry.getKey();\n                    Integer index = entry.getValue();\n                    \n                    // \u4ECE\u5E38\u89C1\u6807\u7B7E\u4E2D\u67E5\u627E\n                    String value = commonTags.values().stream()\n                        .filter(v -> v.hashCode() == index)\n                        .findFirst()\n                        .orElse(String.valueOf(index));\n                    \n                    tags.put(key, value);\n                }\n                \n                span.setTags(tags);\n                span.setStartTime(compressed.getStartTime());\n                span.setDuration(compressed.getDuration());\n                span.setStatus(compressed.getStatus());\n                \n                return span;\n            }\n        }\n        \n        // \u7F13\u5B58\u7BA1\u7406\u5668 - \u51CF\u5C11\u91CD\u590D\u8BA1\u7B97\n        public class CacheManager {\n            private final Cache<String, TraceContext> contextCache;\n            private final Cache<String, SamplingDecision> samplingCache;\n            private final Cache<String, ServiceDependency> dependencyCache;\n            \n            public CacheManager() {\n                this.contextCache = Caffeine.newBuilder()\n                    .maximumSize(10000)\n                    .expireAfterWrite(5, TimeUnit.MINUTES)\n                    .build();\n                    \n                this.samplingCache = Caffeine.newBuilder()\n                    .maximumSize(1000)\n                    .expireAfterWrite(1, TimeUnit.MINUTES)\n                    .build();\n                    \n                this.dependencyCache = Caffeine.newBuilder()\n                    .maximumSize(1000)\n                    .expireAfterWrite(10, TimeUnit.MINUTES)\n                    .build();\n            }\n            \n            // \u7F13\u5B58TraceContext\n            public TraceContext getContext(String traceId) {\n                return contextCache.getIfPresent(traceId);\n            }\n            \n            public void putContext(String traceId, TraceContext context) {\n                contextCache.put(traceId, context);\n            }\n            \n            // \u7F13\u5B58\u91C7\u6837\u51B3\u7B56\n            public SamplingDecision getSamplingDecision(String key) {\n                return samplingCache.getIfPresent(key);\n            }\n            \n            public void putSamplingDecision(String key, SamplingDecision decision) {\n                samplingCache.put(key, decision);\n            }\n            \n            // \u7F13\u5B58\u4F9D\u8D56\u5173\u7CFB\n            public ServiceDependency getDependency(String key) {\n                return dependencyCache.getIfPresent(key);\n            }\n            \n            public void putDependency(String key, ServiceDependency dependency) {\n                dependencyCache.put(key, dependency);\n            }\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u4F20\u64AD\u7EC4\u4EF6\n    public class ContextPropagation {\n        private ThreadContextPropagation threadPropagation;\n        private ServiceContextPropagation servicePropagation;\n        private TraceContextInterceptor interceptor;\n        \n        public ContextPropagation() {\n            this.threadPropagation = new ThreadContextPropagation();\n            this.servicePropagation = new ServiceContextPropagation();\n            this.interceptor = new TraceContextInterceptor();\n        }\n        \n        // \u7EBF\u7A0B\u4E0A\u4E0B\u6587\u4F20\u64AD\n        public class ThreadContextPropagation {\n            private final ThreadLocal<TraceContext> contextHolder;\n            private final ThreadLocal<Map<String, Object>> baggageHolder;\n            \n            public ThreadContextPropagation() {\n                this.contextHolder = new ThreadLocal<>();\n                this.baggageHolder = new ThreadLocal<>();\n            }\n            \n            // \u8BBE\u7F6E\u5F53\u524D\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\n            public void setContext(TraceContext context) {\n                contextHolder.set(context);\n                baggageHolder.set(context.getBaggage());\n            }\n            \n            // \u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\n            public TraceContext getContext() {\n                return contextHolder.get();\n            }\n            \n            // \u6E05\u9664\u5F53\u524D\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\n            public void clearContext() {\n                contextHolder.remove();\n                baggageHolder.remove();\n            }\n            \n            // \u521B\u5EFA\u5B50\u4E0A\u4E0B\u6587\n            public TraceContext createChildContext(String childSpanId) {\n                TraceContext current = getContext();\n                if (current == null) {\n                    return null;\n                }\n                \n                return current.createChild(childSpanId);\n            }\n            \n            // \u8BBE\u7F6E\u884C\u674E\u4FE1\u606F\n            public void setBaggage(String key, Object value) {\n                Map<String, Object> baggage = baggageHolder.get();\n                if (baggage != null) {\n                    baggage.put(key, value);\n                }\n            }\n            \n            // \u83B7\u53D6\u884C\u674E\u4FE1\u606F\n            public Object getBaggage(String key) {\n                Map<String, Object> baggage = baggageHolder.get();\n                return baggage != null ? baggage.get(key) : null;\n            }\n        }\n        \n        // \u670D\u52A1\u95F4\u4E0A\u4E0B\u6587\u4F20\u64AD\n        public class ServiceContextPropagation {\n            private final Map<String, Propagator> propagators;\n            \n            public ServiceContextPropagation() {\n                this.propagators = new HashMap<>();\n                this.propagators.put("http", new HttpPropagator());\n                this.propagators.put("grpc", new GrpcPropagator());\n                this.propagators.put("kafka", new KafkaPropagator());\n                this.propagators.put("redis", new RedisPropagator());\n            }\n            \n            // \u6CE8\u5165\u4E0A\u4E0B\u6587\u5230\u8BF7\u6C42\n            public void inject(TraceContext context, Object carrier, String type) {\n                Propagator propagator = propagators.get(type);\n                if (propagator != null) {\n                    propagator.inject(context, carrier);\n                }\n            }\n            \n            // \u4ECE\u8BF7\u6C42\u4E2D\u63D0\u53D6\u4E0A\u4E0B\u6587\n            public TraceContext extract(Object carrier, String type) {\n                Propagator propagator = propagators.get(type);\n                if (propagator != null) {\n                    return propagator.extract(carrier);\n                }\n                return null;\n            }\n            \n            // \u4F20\u64AD\u5668\u63A5\u53E3\n            public interface Propagator {\n                void inject(TraceContext context, Object carrier);\n                TraceContext extract(Object carrier);\n            }\n            \n            // HTTP\u4F20\u64AD\u5668\n            public class HttpPropagator implements Propagator {\n                @Override\n                public void inject(TraceContext context, Object carrier) {\n                    if (carrier instanceof HttpHeaders) {\n                        HttpHeaders headers = (HttpHeaders) carrier;\n                        headers.set("X-Trace-Id", context.getTraceId());\n                        headers.set("X-Span-Id", context.getSpanId());\n                        headers.set("X-Parent-Span-Id", context.getParentSpanId());\n                        headers.set("X-Sampled", String.valueOf(context.isSampled()));\n                        \n                        // \u6CE8\u5165\u884C\u674E\u4FE1\u606F\n                        for (Map.Entry<String, Object> entry : context.getBaggage().entrySet()) {\n                            headers.set("X-Baggage-" + entry.getKey(), \n                                String.valueOf(entry.getValue()));\n                        }\n                    }\n                }\n                \n                @Override\n                public TraceContext extract(Object carrier) {\n                    if (carrier instanceof HttpHeaders) {\n                        HttpHeaders headers = (HttpHeaders) carrier;\n                        String traceId = headers.getFirst("X-Trace-Id");\n                        String spanId = headers.getFirst("X-Span-Id");\n                        \n                        if (traceId != null && spanId != null) {\n                            TraceContext context = new TraceContext(traceId, spanId);\n                            context.setParentSpanId(headers.getFirst("X-Parent-Span-Id"));\n                            context.setSampled(Boolean.parseBoolean(\n                                headers.getFirst("X-Sampled")));\n                            \n                            // \u63D0\u53D6\u884C\u674E\u4FE1\u606F\n                            headers.forEach((key, values) -> {\n                                if (key.startsWith("X-Baggage-")) {\n                                    String baggageKey = key.substring(10);\n                                    String baggageValue = values.get(0);\n                                    context.setBaggage(baggageKey, baggageValue);\n                                }\n                            });\n                            \n                            return context;\n                        }\n                    }\n                    return null;\n                }\n            }\n            \n            // Kafka\u4F20\u64AD\u5668\n            public class KafkaPropagator implements Propagator {\n                @Override\n                public void inject(TraceContext context, Object carrier) {\n                    if (carrier instanceof ProducerRecord) {\n                        ProducerRecord<?, ?> record = (ProducerRecord<?, ?>) carrier;\n                        record.headers().add("X-Trace-Id", \n                            context.getTraceId().getBytes());\n                        record.headers().add("X-Span-Id", \n                            context.getSpanId().getBytes());\n                        record.headers().add("X-Parent-Span-Id", \n                            context.getParentSpanId() != null ? \n                            context.getParentSpanId().getBytes() : new byte[0]);\n                        record.headers().add("X-Sampled", \n                            String.valueOf(context.isSampled()).getBytes());\n                    }\n                }\n                \n                @Override\n                public TraceContext extract(Object carrier) {\n                    if (carrier instanceof ConsumerRecord) {\n                        ConsumerRecord<?, ?> record = (ConsumerRecord<?, ?>) carrier;\n                        Header traceIdHeader = record.headers().lastHeader("X-Trace-Id");\n                        Header spanIdHeader = record.headers().lastHeader("X-Span-Id");\n                        \n                        if (traceIdHeader != null && spanIdHeader != null) {\n                            String traceId = new String(traceIdHeader.value());\n                            String spanId = new String(spanIdHeader.value());\n                            \n                            TraceContext context = new TraceContext(traceId, spanId);\n                            \n                            Header parentSpanIdHeader = record.headers()\n                                .lastHeader("X-Parent-Span-Id");\n                            if (parentSpanIdHeader != null && parentSpanIdHeader.value().length > 0) {\n                                context.setParentSpanId(new String(parentSpanIdHeader.value()));\n                            }\n                            \n                            Header sampledHeader = record.headers().lastHeader("X-Sampled");\n                            if (sampledHeader != null) {\n                                context.setSampled(Boolean.parseBoolean(\n                                    new String(sampledHeader.value())));\n                            }\n                            \n                            return context;\n                        }\n                    }\n                    return null;\n                }\n            }\n        }\n        \n        // \u62E6\u622A\u5668\n        public class TraceContextInterceptor {\n            private final List<ContextInterceptor> interceptors;\n            \n            public TraceContextInterceptor() {\n                this.interceptors = new ArrayList<>();\n                this.interceptors.add(new ThreadPoolInterceptor());\n                this.interceptors.add(new AsyncInterceptor());\n                this.interceptors.add(new ScheduledInterceptor());\n            }\n            \n            // \u6267\u884C\u62E6\u622A\u5668\u94FE\n            public void beforeExecute(TraceContext context) {\n                for (ContextInterceptor interceptor : interceptors) {\n                    interceptor.beforeExecute(context);\n                }\n            }\n            \n            public void afterExecute(TraceContext context) {\n                for (ContextInterceptor interceptor : interceptors) {\n                    interceptor.afterExecute(context);\n                }\n            }\n            \n            // \u62E6\u622A\u5668\u63A5\u53E3\n            public interface ContextInterceptor {\n                void beforeExecute(TraceContext context);\n                void afterExecute(TraceContext context);\n            }\n            \n            // \u7EBF\u7A0B\u6C60\u62E6\u622A\u5668\n            public class ThreadPoolInterceptor implements ContextInterceptor {\n                @Override\n                public void beforeExecute(TraceContext context) {\n                    // \u5728\u7EBF\u7A0B\u6C60\u6267\u884C\u524D\u8BBE\u7F6E\u4E0A\u4E0B\u6587\n                    ThreadContextPropagation threadPropagation = new ThreadContextPropagation();\n                    threadPropagation.setContext(context);\n                }\n                \n                @Override\n                public void afterExecute(TraceContext context) {\n                    // \u5728\u7EBF\u7A0B\u6C60\u6267\u884C\u540E\u6E05\u7406\u4E0A\u4E0B\u6587\n                    ThreadContextPropagation threadPropagation = new ThreadContextPropagation();\n                    threadPropagation.clearContext();\n                }\n            }\n        }\n    }\n    \n    // \u8F85\u52A9\u7C7B\n    public class SamplingTask {\n        private final TraceContext context;\n        private final Runnable action;\n        \n        public SamplingTask(TraceContext context, Runnable action) {\n            this.context = context;\n            this.action = action;\n        }\n        \n        public void execute() {\n            action.run();\n        }\n    }\n    \n    public class SamplingStats {\n        private long processedCount;\n        private long droppedCount;\n        private int queueSize;\n    }\n    \n    public class CompressedSpan {\n        private Map<String, Integer> tagIndices;\n        private long startTime;\n        private long duration;\n        private String status;\n    }\n    \n    public class SpanExporter {\n        public void export(List<Span> spans) {\n            // \u5B9E\u9645\u7684\u5BFC\u51FA\u903B\u8F91\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u6027\u80FD\u5F71\u54CD\u5206\u6790",children:"\u6027\u80FD\u5F71\u54CD\u5206\u6790"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"\u6027\u80FD\u5F71\u54CD\u56E0\u7D20"}),(0,a.jsx)(e.th,{children:"\u5F71\u54CD\u7A0B\u5EA6"}),(0,a.jsx)(e.th,{children:"\u4F18\u5316\u7B56\u7565"}),(0,a.jsx)(e.th,{children:"\u9884\u671F\u6539\u5584"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u540C\u6B65\u91C7\u6837\u5F00\u9500"})}),(0,a.jsx)(e.td,{children:"\u9AD8"}),(0,a.jsx)(e.td,{children:"\u5F02\u6B65\u91C7\u6837\u3001\u7F13\u5B58\u51B3\u7B56"}),(0,a.jsx)(e.td,{children:"\u51CF\u5C1150-80%\u5EF6\u8FDF"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u7F51\u7EDC\u4F20\u8F93\u5F00\u9500"})}),(0,a.jsx)(e.td,{children:"\u4E2D"}),(0,a.jsx)(e.td,{children:"\u6279\u91CF\u5BFC\u51FA\u3001\u538B\u7F29\u4F20\u8F93"}),(0,a.jsx)(e.td,{children:"\u51CF\u5C1160-90%\u5E26\u5BBD"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u5B58\u50A8\u7A7A\u95F4\u5F00\u9500"})}),(0,a.jsx)(e.td,{children:"\u4E2D"}),(0,a.jsx)(e.td,{children:"\u6570\u636E\u538B\u7F29\u3001TTL\u6E05\u7406"}),(0,a.jsx)(e.td,{children:"\u51CF\u5C1170-85%\u5B58\u50A8"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u5185\u5B58\u5360\u7528\u5F00\u9500"})}),(0,a.jsx)(e.td,{children:"\u4F4E"}),(0,a.jsx)(e.td,{children:"\u5BF9\u8C61\u6C60\u3001\u5F31\u5F15\u7528"}),(0,a.jsx)(e.td,{children:"\u51CF\u5C1130-50%\u5185\u5B58"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"CPU\u8BA1\u7B97\u5F00\u9500"})}),(0,a.jsx)(e.td,{children:"\u4F4E"}),(0,a.jsx)(e.td,{children:"\u91C7\u6837\u7B56\u7565\u3001\u7F13\u5B58"}),(0,a.jsx)(e.td,{children:"\u51CF\u5C1120-40%CPU"})]})]})]}),"\n",(0,a.jsx)(e.admonition,{title:"\u6027\u80FD\u4F18\u5316\u6CE8\u610F\u4E8B\u9879",type:"warning",children:(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u91C7\u6837\u7387\u8BBE\u7F6E"}),"\uFF1A\u751F\u4EA7\u73AF\u5883\u5EFA\u8BAE1-5%\uFF0C\u5173\u952E\u4E1A\u52A1\u53EF\u9002\u5F53\u63D0\u9AD8"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F02\u6B65\u5904\u7406"}),"\uFF1A\u91C7\u6837\u548C\u5BFC\u51FA\u90FD\u5E94\u91C7\u7528\u5F02\u6B65\u65B9\u5F0F\uFF0C\u907F\u514D\u963B\u585E\u4E3B\u6D41\u7A0B"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6279\u91CF\u64CD\u4F5C"}),"\uFF1ASpan\u5BFC\u51FA\u5E94\u91C7\u7528\u6279\u91CF\u65B9\u5F0F\uFF0C\u51CF\u5C11\u7F51\u7EDC\u5F80\u8FD4"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7F13\u5B58\u7B56\u7565"}),"\uFF1A\u5BF9\u91CD\u590D\u7684\u91C7\u6837\u51B3\u7B56\u548C\u4E0A\u4E0B\u6587\u4FE1\u606F\u8FDB\u884C\u7F13\u5B58"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u8D44\u6E90\u6E05\u7406"}),"\uFF1A\u53CA\u65F6\u6E05\u7406\u8FC7\u671F\u7684\u4E0A\u4E0B\u6587\u548C\u7F13\u5B58\u6570\u636E"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u76D1\u63A7\u544A\u8B66"}),"\uFF1A\u5BF9\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u672C\u8EAB\u7684\u6027\u80FD\u8FDB\u884C\u76D1\u63A7"]}),"\n"]})}),"\n",(0,a.jsx)(e.h2,{id:"2-\u94FE\u8DEF\u4F20\u64AD\u5668\u4E0E\u4E0A\u4E0B\u6587\u7BA1\u7406",children:"2. \u94FE\u8DEF\u4F20\u64AD\u5668\u4E0E\u4E0A\u4E0B\u6587\u7BA1\u7406"}),"\n",(0,a.jsx)(e.h3,{id:"21-\u94FE\u8DEF\u4F20\u64AD\u5668\u8BE6\u89E3",children:"2.1 \u94FE\u8DEF\u4F20\u64AD\u5668\u8BE6\u89E3"}),"\n",(0,a.jsx)(e.p,{children:"\u94FE\u8DEF\u4F20\u64AD\u5668\uFF08Trace Propagator\uFF09\u662F\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u4E2D\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0C\u8D1F\u8D23\u5728\u4E0D\u540C\u670D\u52A1\u3001\u4E0D\u540C\u7EBF\u7A0B\u3001\u4E0D\u540C\u8FDB\u7A0B\u4E4B\u95F4\u4F20\u9012\u8FFD\u8E2A\u4E0A\u4E0B\u6587\u4FE1\u606F\u3002\u5B83\u786E\u4FDD\u4E86\u8FFD\u8E2A\u4FE1\u606F\u7684\u8FDE\u7EED\u6027\u548C\u5B8C\u6574\u6027\uFF0C\u662F\u6574\u4E2A\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u80FD\u591F\u6B63\u5E38\u5DE5\u4F5C\u7684\u57FA\u7840\u3002"}),"\n",(0,a.jsx)(e.h4,{id:"\u4F20\u64AD\u5668\u8BBE\u8BA1\u6A21\u5F0F",children:"\u4F20\u64AD\u5668\u8BBE\u8BA1\u6A21\u5F0F"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u94FE\u8DEF\u4F20\u64AD\u5668\u8BBE\u8BA1\u5B9E\u73B0"',children:'public class TracePropagatorDesign {\n    /*\n     * \u94FE\u8DEF\u4F20\u64AD\u5668\u7684\u6838\u5FC3\u8BBE\u8BA1\n     * 1. \u4F20\u64AD\u5668\u63A5\u53E3\uFF1A\u5B9A\u4E49\u6807\u51C6\u7684\u6CE8\u5165\u548C\u63D0\u53D6\u65B9\u6CD5\n     * 2. \u8F7D\u4F53\u9002\u914D\uFF1A\u652F\u6301\u4E0D\u540C\u7684\u4F20\u8F93\u8F7D\u4F53\uFF08HTTP\u3001\u6D88\u606F\u961F\u5217\u3001RPC\u7B49\uFF09\n     * 3. \u4E0A\u4E0B\u6587\u5E8F\u5217\u5316\uFF1A\u5C06\u4E0A\u4E0B\u6587\u4FE1\u606F\u5E8F\u5217\u5316\u4E3A\u53EF\u4F20\u8F93\u7684\u683C\u5F0F\n     * 4. \u9519\u8BEF\u5904\u7406\uFF1A\u5904\u7406\u4F20\u64AD\u8FC7\u7A0B\u4E2D\u7684\u5F02\u5E38\u60C5\u51B5\n     * 5. \u6027\u80FD\u4F18\u5316\uFF1A\u51CF\u5C11\u4F20\u64AD\u8FC7\u7A0B\u4E2D\u7684\u6027\u80FD\u5F00\u9500\n     */\n    \n    // \u4F20\u64AD\u5668\u63A5\u53E3\u5B9A\u4E49\n    public interface TracePropagator {\n        // \u6CE8\u5165\u4E0A\u4E0B\u6587\u5230\u8F7D\u4F53\n        void inject(TraceContext context, Object carrier);\n        \n        // \u4ECE\u8F7D\u4F53\u4E2D\u63D0\u53D6\u4E0A\u4E0B\u6587\n        TraceContext extract(Object carrier);\n        \n        // \u83B7\u53D6\u4F20\u64AD\u5668\u7C7B\u578B\n        String getPropagatorType();\n        \n        // \u83B7\u53D6\u652F\u6301\u7684\u8F7D\u4F53\u7C7B\u578B\n        List<String> getSupportedCarriers();\n        \n        // \u9A8C\u8BC1\u8F7D\u4F53\u662F\u5426\u652F\u6301\n        boolean supportsCarrier(Object carrier);\n        \n        // \u83B7\u53D6\u4F20\u64AD\u5668\u914D\u7F6E\n        PropagatorConfig getConfig();\n    }\n    \n    // \u4F20\u64AD\u5668\u914D\u7F6E\n    public class PropagatorConfig {\n        private boolean enabled;\n        private int maxBaggageSize;\n        private List<String> allowedBaggageKeys;\n        private boolean compressBaggage;\n        private String encoding;\n        private int timeout;\n        \n        public PropagatorConfig() {\n            this.enabled = true;\n            this.maxBaggageSize = 8192; // 8KB\n            this.allowedBaggageKeys = new ArrayList<>();\n            this.compressBaggage = false;\n            this.encoding = "UTF-8";\n            this.timeout = 5000; // 5\u79D2\n        }\n        \n        // \u9A8C\u8BC1\u884C\u674E\u4FE1\u606F\u5927\u5C0F\n        public boolean validateBaggageSize(Map<String, Object> baggage) {\n            int totalSize = baggage.entrySet().stream()\n                .mapToInt(entry -> entry.getKey().length() + \n                    String.valueOf(entry.getValue()).length())\n                .sum();\n            return totalSize <= maxBaggageSize;\n        }\n        \n        // \u8FC7\u6EE4\u884C\u674E\u4FE1\u606F\n        public Map<String, Object> filterBaggage(Map<String, Object> baggage) {\n            if (allowedBaggageKeys.isEmpty()) {\n                return baggage;\n            }\n            \n            return baggage.entrySet().stream()\n                .filter(entry -> allowedBaggageKeys.contains(entry.getKey()))\n                .collect(Collectors.toMap(\n                    Map.Entry::getKey,\n                    Map.Entry::getValue\n                ));\n        }\n    }\n    \n    // HTTP\u4F20\u64AD\u5668\u5B9E\u73B0\n    public class HttpTracePropagator implements TracePropagator {\n        private final PropagatorConfig config;\n        private final String traceIdHeader;\n        private final String spanIdHeader;\n        private final String parentSpanIdHeader;\n        private final String sampledHeader;\n        private final String baggagePrefix;\n        \n        public HttpTracePropagator() {\n            this.config = new PropagatorConfig();\n            this.traceIdHeader = "X-Trace-Id";\n            this.spanIdHeader = "X-Span-Id";\n            this.parentSpanIdHeader = "X-Parent-Span-Id";\n            this.sampledHeader = "X-Sampled";\n            this.baggagePrefix = "X-Baggage-";\n        }\n        \n        @Override\n        public void inject(TraceContext context, Object carrier) {\n            if (!supportsCarrier(carrier)) {\n                throw new IllegalArgumentException("Unsupported carrier type: " + \n                    carrier.getClass().getName());\n            }\n            \n            try {\n                HttpHeaders headers = (HttpHeaders) carrier;\n                \n                // \u6CE8\u5165\u57FA\u672C\u8FFD\u8E2A\u4FE1\u606F\n                headers.set(traceIdHeader, context.getTraceId());\n                headers.set(spanIdHeader, context.getSpanId());\n                \n                if (context.getParentSpanId() != null) {\n                    headers.set(parentSpanIdHeader, context.getParentSpanId());\n                }\n                \n                headers.set(sampledHeader, String.valueOf(context.isSampled()));\n                \n                // \u6CE8\u5165\u884C\u674E\u4FE1\u606F\n                Map<String, Object> filteredBaggage = config.filterBaggage(context.getBaggage());\n                \n                if (!config.validateBaggageSize(filteredBaggage)) {\n                    throw new IllegalArgumentException("Baggage size exceeds limit: " + \n                        config.getMaxBaggageSize());\n                }\n                \n                for (Map.Entry<String, Object> entry : filteredBaggage.entrySet()) {\n                    String headerName = baggagePrefix + entry.getKey();\n                    String headerValue = String.valueOf(entry.getValue());\n                    \n                    // \u5BF9\u884C\u674E\u503C\u8FDB\u884C\u7F16\u7801\n                    if (config.isCompressBaggage()) {\n                        headerValue = compressValue(headerValue);\n                    }\n                    \n                    headers.set(headerName, headerValue);\n                }\n                \n            } catch (Exception e) {\n                throw new PropagationException("Failed to inject context into HTTP headers", e);\n            }\n        }\n        \n        @Override\n        public TraceContext extract(Object carrier) {\n            if (!supportsCarrier(carrier)) {\n                return null;\n            }\n            \n            try {\n                HttpHeaders headers = (HttpHeaders) carrier;\n                \n                // \u63D0\u53D6\u57FA\u672C\u8FFD\u8E2A\u4FE1\u606F\n                String traceId = headers.getFirst(traceIdHeader);\n                String spanId = headers.getFirst(spanIdHeader);\n                \n                if (traceId == null || spanId == null) {\n                    return null;\n                }\n                \n                TraceContext context = new TraceContext(traceId, spanId);\n                \n                // \u63D0\u53D6\u7236Span ID\n                String parentSpanId = headers.getFirst(parentSpanIdHeader);\n                if (parentSpanId != null && !parentSpanId.isEmpty()) {\n                    context.setParentSpanId(parentSpanId);\n                }\n                \n                // \u63D0\u53D6\u91C7\u6837\u6807\u5FD7\n                String sampled = headers.getFirst(sampledHeader);\n                if (sampled != null) {\n                    context.setSampled(Boolean.parseBoolean(sampled));\n                }\n                \n                // \u63D0\u53D6\u884C\u674E\u4FE1\u606F\n                Map<String, Object> baggage = new HashMap<>();\n                headers.forEach((key, values) -> {\n                    if (key.startsWith(baggagePrefix) && !values.isEmpty()) {\n                        String baggageKey = key.substring(baggagePrefix.length());\n                        String baggageValue = values.get(0);\n                        \n                        // \u89E3\u538B\u7F29\u884C\u674E\u503C\n                        if (config.isCompressBaggage()) {\n                            baggageValue = decompressValue(baggageValue);\n                        }\n                        \n                        baggage.put(baggageKey, baggageValue);\n                    }\n                });\n                \n                context.setBaggage(baggage);\n                \n                return context;\n                \n            } catch (Exception e) {\n                throw new PropagationException("Failed to extract context from HTTP headers", e);\n            }\n        }\n        \n        @Override\n        public String getPropagatorType() {\n            return "HTTP";\n        }\n        \n        @Override\n        public List<String> getSupportedCarriers() {\n            return Arrays.asList("HttpHeaders", "HttpServletRequest", "HttpServletResponse");\n        }\n        \n        @Override\n        public boolean supportsCarrier(Object carrier) {\n            return carrier instanceof HttpHeaders || \n                   carrier instanceof HttpServletRequest || \n                   carrier instanceof HttpServletResponse;\n        }\n        \n        @Override\n        public PropagatorConfig getConfig() {\n            return config;\n        }\n        \n        // \u538B\u7F29\u884C\u674E\u503C\n        private String compressValue(String value) {\n            try {\n                byte[] bytes = value.getBytes(config.getEncoding());\n                ByteArrayOutputStream baos = new ByteArrayOutputStream();\n                GZIPOutputStream gzip = new GZIPOutputStream(baos);\n                gzip.write(bytes);\n                gzip.close();\n                return Base64.getEncoder().encodeToString(baos.toByteArray());\n            } catch (Exception e) {\n                return value; // \u538B\u7F29\u5931\u8D25\u65F6\u8FD4\u56DE\u539F\u503C\n            }\n        }\n        \n        // \u89E3\u538B\u7F29\u884C\u674E\u503C\n        private String decompressValue(String value) {\n            try {\n                byte[] bytes = Base64.getDecoder().decode(value);\n                ByteArrayInputStream bais = new ByteArrayInputStream(bytes);\n                GZIPInputStream gzip = new GZIPInputStream(bais);\n                byte[] decompressed = gzip.readAllBytes();\n                return new String(decompressed, config.getEncoding());\n            } catch (Exception e) {\n                return value; // \u89E3\u538B\u7F29\u5931\u8D25\u65F6\u8FD4\u56DE\u539F\u503C\n            }\n        }\n    }\n    \n    // \u6D88\u606F\u961F\u5217\u4F20\u64AD\u5668\u5B9E\u73B0\n    public class MessageQueueTracePropagator implements TracePropagator {\n        private final PropagatorConfig config;\n        private final Map<String, MessageQueueAdapter> adapters;\n        \n        public MessageQueueTracePropagator() {\n            this.config = new PropagatorConfig();\n            this.adapters = new HashMap<>();\n            \n            // \u6CE8\u518C\u4E0D\u540C\u6D88\u606F\u961F\u5217\u7684\u9002\u914D\u5668\n            this.adapters.put("kafka", new KafkaAdapter());\n            this.adapters.put("rabbitmq", new RabbitMQAdapter());\n            this.adapters.put("rocketmq", new RocketMQAdapter());\n        }\n        \n        @Override\n        public void inject(TraceContext context, Object carrier) {\n            MessageQueueAdapter adapter = findAdapter(carrier);\n            if (adapter == null) {\n                throw new IllegalArgumentException("Unsupported message queue carrier: " + \n                    carrier.getClass().getName());\n            }\n            \n            try {\n                adapter.injectContext(context, carrier);\n            } catch (Exception e) {\n                throw new PropagationException("Failed to inject context into message queue", e);\n            }\n        }\n        \n        @Override\n        public TraceContext extract(Object carrier) {\n            MessageQueueAdapter adapter = findAdapter(carrier);\n            if (adapter == null) {\n                return null;\n            }\n            \n            try {\n                return adapter.extractContext(carrier);\n            } catch (Exception e) {\n                throw new PropagationException("Failed to extract context from message queue", e);\n            }\n        }\n        \n        @Override\n        public String getPropagatorType() {\n            return "MessageQueue";\n        }\n        \n        @Override\n        public List<String> getSupportedCarriers() {\n            return new ArrayList<>(adapters.keySet());\n        }\n        \n        @Override\n        public boolean supportsCarrier(Object carrier) {\n            return findAdapter(carrier) != null;\n        }\n        \n        @Override\n        public PropagatorConfig getConfig() {\n            return config;\n        }\n        \n        // \u67E5\u627E\u9002\u914D\u5668\n        private MessageQueueAdapter findAdapter(Object carrier) {\n            for (MessageQueueAdapter adapter : adapters.values()) {\n                if (adapter.supportsCarrier(carrier)) {\n                    return adapter;\n                }\n            }\n            return null;\n        }\n        \n        // \u6D88\u606F\u961F\u5217\u9002\u914D\u5668\u63A5\u53E3\n        public interface MessageQueueAdapter {\n            void injectContext(TraceContext context, Object carrier);\n            TraceContext extractContext(Object carrier);\n            boolean supportsCarrier(Object carrier);\n        }\n        \n        // Kafka\u9002\u914D\u5668\n        public class KafkaAdapter implements MessageQueueAdapter {\n            @Override\n            public void injectContext(TraceContext context, Object carrier) {\n                if (carrier instanceof ProducerRecord) {\n                    ProducerRecord<?, ?> record = (ProducerRecord<?, ?>) carrier;\n                    \n                    record.headers().add("X-Trace-Id", context.getTraceId().getBytes());\n                    record.headers().add("X-Span-Id", context.getSpanId().getBytes());\n                    \n                    if (context.getParentSpanId() != null) {\n                        record.headers().add("X-Parent-Span-Id", \n                            context.getParentSpanId().getBytes());\n                    }\n                    \n                    record.headers().add("X-Sampled", \n                        String.valueOf(context.isSampled()).getBytes());\n                    \n                    // \u6CE8\u5165\u884C\u674E\u4FE1\u606F\n                    for (Map.Entry<String, Object> entry : context.getBaggage().entrySet()) {\n                        String headerName = "X-Baggage-" + entry.getKey();\n                        String headerValue = String.valueOf(entry.getValue());\n                        record.headers().add(headerName, headerValue.getBytes());\n                    }\n                }\n            }\n            \n            @Override\n            public TraceContext extractContext(Object carrier) {\n                if (carrier instanceof ConsumerRecord) {\n                    ConsumerRecord<?, ?> record = (ConsumerRecord<?, ?>) carrier;\n                    \n                    Header traceIdHeader = record.headers().lastHeader("X-Trace-Id");\n                    Header spanIdHeader = record.headers().lastHeader("X-Span-Id");\n                    \n                    if (traceIdHeader == null || spanIdHeader == null) {\n                        return null;\n                    }\n                    \n                    String traceId = new String(traceIdHeader.value());\n                    String spanId = new String(spanIdHeader.value());\n                    \n                    TraceContext context = new TraceContext(traceId, spanId);\n                    \n                    // \u63D0\u53D6\u7236Span ID\n                    Header parentSpanIdHeader = record.headers().lastHeader("X-Parent-Span-Id");\n                    if (parentSpanIdHeader != null && parentSpanIdHeader.value().length > 0) {\n                        context.setParentSpanId(new String(parentSpanIdHeader.value()));\n                    }\n                    \n                    // \u63D0\u53D6\u91C7\u6837\u6807\u5FD7\n                    Header sampledHeader = record.headers().lastHeader("X-Sampled");\n                    if (sampledHeader != null) {\n                        context.setSampled(Boolean.parseBoolean(\n                            new String(sampledHeader.value())));\n                    }\n                    \n                    // \u63D0\u53D6\u884C\u674E\u4FE1\u606F\n                    Map<String, Object> baggage = new HashMap<>();\n                    record.headers().forEach(header -> {\n                        if (header.key().startsWith("X-Baggage-")) {\n                            String baggageKey = header.key().substring(10);\n                            String baggageValue = new String(header.value());\n                            baggage.put(baggageKey, baggageValue);\n                        }\n                    });\n                    \n                    context.setBaggage(baggage);\n                    \n                    return context;\n                }\n                \n                return null;\n            }\n            \n            @Override\n            public boolean supportsCarrier(Object carrier) {\n                return carrier instanceof ProducerRecord || carrier instanceof ConsumerRecord;\n            }\n        }\n        \n        // RabbitMQ\u9002\u914D\u5668\n        public class RabbitMQAdapter implements MessageQueueAdapter {\n            @Override\n            public void injectContext(TraceContext context, Object carrier) {\n                if (carrier instanceof Message) {\n                    Message message = (Message) carrier;\n                    AMQP.BasicProperties props = message.getProperties();\n                    \n                    Map<String, Object> headers = new HashMap<>();\n                    if (props.getHeaders() != null) {\n                        headers.putAll(props.getHeaders());\n                    }\n                    \n                    headers.put("X-Trace-Id", context.getTraceId());\n                    headers.put("X-Span-Id", context.getSpanId());\n                    \n                    if (context.getParentSpanId() != null) {\n                        headers.put("X-Parent-Span-Id", context.getParentSpanId());\n                    }\n                    \n                    headers.put("X-Sampled", context.isSampled());\n                    \n                    // \u6CE8\u5165\u884C\u674E\u4FE1\u606F\n                    for (Map.Entry<String, Object> entry : context.getBaggage().entrySet()) {\n                        headers.put("X-Baggage-" + entry.getKey(), entry.getValue());\n                    }\n                    \n                    AMQP.BasicProperties newProps = new AMQP.BasicProperties.Builder()\n                        .headers(headers)\n                        .build();\n                    \n                    message.setProperties(newProps);\n                }\n            }\n            \n            @Override\n            public TraceContext extractContext(Object carrier) {\n                if (carrier instanceof Message) {\n                    Message message = (Message) carrier;\n                    AMQP.BasicProperties props = message.getProperties();\n                    \n                    if (props == null || props.getHeaders() == null) {\n                        return null;\n                    }\n                    \n                    Map<String, Object> headers = props.getHeaders();\n                    String traceId = (String) headers.get("X-Trace-Id");\n                    String spanId = (String) headers.get("X-Span-Id");\n                    \n                    if (traceId == null || spanId == null) {\n                        return null;\n                    }\n                    \n                    TraceContext context = new TraceContext(traceId, spanId);\n                    \n                    // \u63D0\u53D6\u7236Span ID\n                    String parentSpanId = (String) headers.get("X-Parent-Span-Id");\n                    if (parentSpanId != null) {\n                        context.setParentSpanId(parentSpanId);\n                    }\n                    \n                    // \u63D0\u53D6\u91C7\u6837\u6807\u5FD7\n                    Object sampled = headers.get("X-Sampled");\n                    if (sampled != null) {\n                        context.setSampled(Boolean.parseBoolean(sampled.toString()));\n                    }\n                    \n                    // \u63D0\u53D6\u884C\u674E\u4FE1\u606F\n                    Map<String, Object> baggage = new HashMap<>();\n                    headers.forEach((key, value) -> {\n                        if (key.startsWith("X-Baggage-")) {\n                            String baggageKey = key.substring(10);\n                            baggage.put(baggageKey, value);\n                        }\n                    });\n                    \n                    context.setBaggage(baggage);\n                    \n                    return context;\n                }\n                \n                return null;\n            }\n            \n            @Override\n            public boolean supportsCarrier(Object carrier) {\n                return carrier instanceof Message;\n            }\n        }\n        \n        // RocketMQ\u9002\u914D\u5668\n        public class RocketMQAdapter implements MessageQueueAdapter {\n            @Override\n            public void injectContext(TraceContext context, Object carrier) {\n                if (carrier instanceof MessageExt) {\n                    MessageExt message = (MessageExt) carrier;\n                    Map<String, String> properties = message.getProperties();\n                    \n                    properties.put("X-Trace-Id", context.getTraceId());\n                    properties.put("X-Span-Id", context.getSpanId());\n                    \n                    if (context.getParentSpanId() != null) {\n                        properties.put("X-Parent-Span-Id", context.getParentSpanId());\n                    }\n                    \n                    properties.put("X-Sampled", String.valueOf(context.isSampled()));\n                    \n                    // \u6CE8\u5165\u884C\u674E\u4FE1\u606F\n                    for (Map.Entry<String, Object> entry : context.getBaggage().entrySet()) {\n                        properties.put("X-Baggage-" + entry.getKey(), \n                            String.valueOf(entry.getValue()));\n                    }\n                }\n            }\n            \n            @Override\n            public TraceContext extractContext(Object carrier) {\n                if (carrier instanceof MessageExt) {\n                    MessageExt message = (MessageExt) carrier;\n                    Map<String, String> properties = message.getProperties();\n                    \n                    String traceId = properties.get("X-Trace-Id");\n                    String spanId = properties.get("X-Span-Id");\n                    \n                    if (traceId == null || spanId == null) {\n                        return null;\n                    }\n                    \n                    TraceContext context = new TraceContext(traceId, spanId);\n                    \n                    // \u63D0\u53D6\u7236Span ID\n                    String parentSpanId = properties.get("X-Parent-Span-Id");\n                    if (parentSpanId != null) {\n                        context.setParentSpanId(parentSpanId);\n                    }\n                    \n                    // \u63D0\u53D6\u91C7\u6837\u6807\u5FD7\n                    String sampled = properties.get("X-Sampled");\n                    if (sampled != null) {\n                        context.setSampled(Boolean.parseBoolean(sampled));\n                    }\n                    \n                    // \u63D0\u53D6\u884C\u674E\u4FE1\u606F\n                    Map<String, Object> baggage = new HashMap<>();\n                    properties.forEach((key, value) -> {\n                        if (key.startsWith("X-Baggage-")) {\n                            String baggageKey = key.substring(10);\n                            baggage.put(baggageKey, value);\n                        }\n                    });\n                    \n                    context.setBaggage(baggage);\n                    \n                    return context;\n                }\n                \n                return null;\n            }\n            \n            @Override\n            public boolean supportsCarrier(Object carrier) {\n                return carrier instanceof MessageExt;\n            }\n        }\n    }\n    \n    // \u4F20\u64AD\u5F02\u5E38\n    public class PropagationException extends RuntimeException {\n        public PropagationException(String message) {\n            super(message);\n        }\n        \n        public PropagationException(String message, Throwable cause) {\n            super(message, cause);\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u4F20\u64AD\u5668\u7C7B\u578B\u5BF9\u6BD4",children:"\u4F20\u64AD\u5668\u7C7B\u578B\u5BF9\u6BD4"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"\u4F20\u64AD\u5668\u7C7B\u578B"}),(0,a.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"}),(0,a.jsx)(e.th,{children:"\u4F18\u70B9"}),(0,a.jsx)(e.th,{children:"\u7F3A\u70B9"}),(0,a.jsx)(e.th,{children:"\u5B9E\u73B0\u590D\u6742\u5EA6"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"HTTP\u4F20\u64AD\u5668"})}),(0,a.jsx)(e.td,{children:"Web\u670D\u52A1\u3001REST API"}),(0,a.jsx)(e.td,{children:"\u6807\u51C6\u5316\u3001\u517C\u5BB9\u6027\u597D"}),(0,a.jsx)(e.td,{children:"\u5934\u90E8\u5927\u5C0F\u9650\u5236"}),(0,a.jsx)(e.td,{children:"\u4F4E"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u6D88\u606F\u961F\u5217\u4F20\u64AD\u5668"})}),(0,a.jsx)(e.td,{children:"\u5F02\u6B65\u6D88\u606F\u5904\u7406"}),(0,a.jsx)(e.td,{children:"\u652F\u6301\u5F02\u6B65\u4F20\u64AD"}),(0,a.jsx)(e.td,{children:"\u9700\u8981\u9002\u914D\u4E0D\u540CMQ"}),(0,a.jsx)(e.td,{children:"\u4E2D"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"RPC\u4F20\u64AD\u5668"})}),(0,a.jsx)(e.td,{children:"\u5FAE\u670D\u52A1\u95F4\u8C03\u7528"}),(0,a.jsx)(e.td,{children:"\u6027\u80FD\u597D\u3001\u7C7B\u578B\u5B89\u5168"}),(0,a.jsx)(e.td,{children:"\u534F\u8BAE\u7ED1\u5B9A"}),(0,a.jsx)(e.td,{children:"\u4E2D"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u6570\u636E\u5E93\u4F20\u64AD\u5668"})}),(0,a.jsx)(e.td,{children:"\u6570\u636E\u5E93\u64CD\u4F5C\u8FFD\u8E2A"}),(0,a.jsx)(e.td,{children:"\u76F4\u63A5\u5173\u8054\u6570\u636E"}),(0,a.jsx)(e.td,{children:"\u5F71\u54CDSQL\u6027\u80FD"}),(0,a.jsx)(e.td,{children:"\u9AD8"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:(0,a.jsx)(e.strong,{children:"\u7F13\u5B58\u4F20\u64AD\u5668"})}),(0,a.jsx)(e.td,{children:"\u7F13\u5B58\u64CD\u4F5C\u8FFD\u8E2A"}),(0,a.jsx)(e.td,{children:"\u8F7B\u91CF\u7EA7"}),(0,a.jsx)(e.td,{children:"\u529F\u80FD\u6709\u9650"}),(0,a.jsx)(e.td,{children:"\u4F4E"})]})]})]}),"\n",(0,a.jsx)(e.h3,{id:"22-\u4E0A\u4E0B\u6587\u7BA1\u7406\u7B56\u7565",children:"2.2 \u4E0A\u4E0B\u6587\u7BA1\u7406\u7B56\u7565"}),"\n",(0,a.jsx)(e.p,{children:"\u4E0A\u4E0B\u6587\u7BA1\u7406\u662F\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u4E2D\u7684\u53E6\u4E00\u4E2A\u5173\u952E\u7EC4\u4EF6\uFF0C\u8D1F\u8D23\u5728\u5355\u673A\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\u7EF4\u62A4\u548C\u4F20\u64AD\u8FFD\u8E2A\u4E0A\u4E0B\u6587\u3002\u826F\u597D\u7684\u4E0A\u4E0B\u6587\u7BA1\u7406\u7B56\u7565\u80FD\u591F\u786E\u4FDD\u8FFD\u8E2A\u4FE1\u606F\u7684\u8FDE\u7EED\u6027\u548C\u51C6\u786E\u6027\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u4E0A\u4E0B\u6587\u7BA1\u7406\u7B56\u7565\u5B9E\u73B0"',children:'public class ContextManagementStrategy {\n    /*\n     * \u4E0A\u4E0B\u6587\u7BA1\u7406\u7684\u6838\u5FC3\u7B56\u7565\n     * 1. ThreadLocal\u7BA1\u7406\uFF1A\u7EBF\u7A0B\u7EA7\u522B\u7684\u4E0A\u4E0B\u6587\u5B58\u50A8\n     * 2. \u4E0A\u4E0B\u6587\u4F20\u64AD\uFF1A\u8DE8\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\u4F20\u9012\n     * 3. \u4E0A\u4E0B\u6587\u6E05\u7406\uFF1A\u9632\u6B62\u5185\u5B58\u6CC4\u6F0F\n     * 4. \u4E0A\u4E0B\u6587\u7EE7\u627F\uFF1A\u5B50\u7EBF\u7A0B\u7EE7\u627F\u7236\u7EBF\u7A0B\u4E0A\u4E0B\u6587\n     * 5. \u4E0A\u4E0B\u6587\u9694\u79BB\uFF1A\u4E0D\u540C\u8BF7\u6C42\u95F4\u7684\u4E0A\u4E0B\u6587\u9694\u79BB\n     */\n    \n    // \u5168\u5C40\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668\n    public class GlobalContextManager {\n        private static final ThreadLocal<TraceContext> contextHolder = new ThreadLocal<>();\n        private static final ThreadLocal<Map<String, Object>> baggageHolder = new ThreadLocal<>();\n        private static final ContextCleanupStrategy cleanupStrategy;\n        private static final ContextPropagationInterceptor propagationInterceptor;\n        \n        static {\n            cleanupStrategy = new ContextCleanupStrategy();\n            propagationInterceptor = new ContextPropagationInterceptor();\n        }\n        \n        // \u8BBE\u7F6E\u5F53\u524D\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\n        public static void setContext(TraceContext context) {\n            if (context == null) {\n                clearContext();\n                return;\n            }\n            \n            contextHolder.set(context);\n            baggageHolder.set(new HashMap<>(context.getBaggage()));\n            \n            // \u6CE8\u518C\u6E05\u7406\u7B56\u7565\n            cleanupStrategy.registerContext(context);\n        }\n        \n        // \u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\n        public static TraceContext getContext() {\n            return contextHolder.get();\n        }\n        \n        // \u6E05\u9664\u5F53\u524D\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\n        public static void clearContext() {\n            TraceContext context = contextHolder.get();\n            if (context != null) {\n                cleanupStrategy.unregisterContext(context);\n            }\n            \n            contextHolder.remove();\n            baggageHolder.remove();\n        }\n        \n        // \u521B\u5EFA\u5B50\u4E0A\u4E0B\u6587\n        public static TraceContext createChildContext(String childSpanId) {\n            TraceContext current = getContext();\n            if (current == null) {\n                return null;\n            }\n            \n            return current.createChild(childSpanId);\n        }\n        \n        // \u8BBE\u7F6E\u884C\u674E\u4FE1\u606F\n        public static void setBaggage(String key, Object value) {\n            Map<String, Object> baggage = baggageHolder.get();\n            if (baggage != null) {\n                baggage.put(key, value);\n                \n                // \u540C\u6B65\u5230TraceContext\n                TraceContext context = contextHolder.get();\n                if (context != null) {\n                    context.setBaggage(key, value);\n                }\n            }\n        }\n        \n        // \u83B7\u53D6\u884C\u674E\u4FE1\u606F\n        public static Object getBaggage(String key) {\n            Map<String, Object> baggage = baggageHolder.get();\n            return baggage != null ? baggage.get(key) : null;\n        }\n        \n        // \u83B7\u53D6\u6240\u6709\u884C\u674E\u4FE1\u606F\n        public static Map<String, Object> getAllBaggage() {\n            Map<String, Object> baggage = baggageHolder.get();\n            return baggage != null ? new HashMap<>(baggage) : new HashMap<>();\n        }\n        \n        // \u68C0\u67E5\u662F\u5426\u6709\u6D3B\u8DC3\u4E0A\u4E0B\u6587\n        public static boolean hasActiveContext() {\n            return contextHolder.get() != null;\n        }\n        \n        // \u83B7\u53D6\u4E0A\u4E0B\u6587\u7EDF\u8BA1\u4FE1\u606F\n        public static ContextStats getContextStats() {\n            return cleanupStrategy.getStats();\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u6E05\u7406\u7B56\u7565\n    public class ContextCleanupStrategy {\n        private final Map<String, Long> contextTimestamps;\n        private final ScheduledExecutorService cleanupExecutor;\n        private final long cleanupInterval;\n        private final long contextTimeout;\n        private final AtomicLong totalContexts;\n        private final AtomicLong cleanedContexts;\n        \n        public ContextCleanupStrategy() {\n            this.contextTimestamps = new ConcurrentHashMap<>();\n            this.cleanupExecutor = Executors.newSingleThreadScheduledExecutor(r -> {\n                Thread t = new Thread(r, "context-cleanup");\n                t.setDaemon(true);\n                return t;\n            });\n            this.cleanupInterval = 60000; // 1\u5206\u949F\n            this.contextTimeout = 300000; // 5\u5206\u949F\n            this.totalContexts = new AtomicLong(0);\n            this.cleanedContexts = new AtomicLong(0);\n            \n            startCleanupTask();\n        }\n        \n        // \u6CE8\u518C\u4E0A\u4E0B\u6587\n        public void registerContext(TraceContext context) {\n            String contextId = context.getTraceId() + ":" + context.getSpanId();\n            contextTimestamps.put(contextId, System.currentTimeMillis());\n            totalContexts.incrementAndGet();\n        }\n        \n        // \u6CE8\u9500\u4E0A\u4E0B\u6587\n        public void unregisterContext(TraceContext context) {\n            String contextId = context.getTraceId() + ":" + context.getSpanId();\n            contextTimestamps.remove(contextId);\n        }\n        \n        // \u542F\u52A8\u6E05\u7406\u4EFB\u52A1\n        private void startCleanupTask() {\n            cleanupExecutor.scheduleAtFixedRate(() -> {\n                try {\n                    cleanupExpiredContexts();\n                } catch (Exception e) {\n                    // \u8BB0\u5F55\u6E05\u7406\u5F02\u5E38\uFF0C\u4F46\u4E0D\u4E2D\u65AD\u4EFB\u52A1\n                    System.err.println("Context cleanup failed: " + e.getMessage());\n                }\n            }, cleanupInterval, cleanupInterval, TimeUnit.MILLISECONDS);\n        }\n        \n        // \u6E05\u7406\u8FC7\u671F\u4E0A\u4E0B\u6587\n        private void cleanupExpiredContexts() {\n            long currentTime = System.currentTimeMillis();\n            long expiredTime = currentTime - contextTimeout;\n            \n            List<String> expiredContexts = contextTimestamps.entrySet().stream()\n                .filter(entry -> entry.getValue() < expiredTime)\n                .map(Map.Entry::getKey)\n                .collect(Collectors.toList());\n            \n            for (String contextId : expiredContexts) {\n                contextTimestamps.remove(contextId);\n                cleanedContexts.incrementAndGet();\n            }\n            \n            if (!expiredContexts.isEmpty()) {\n                System.out.println("Cleaned " + expiredContexts.size() + " expired contexts");\n            }\n        }\n        \n        // \u83B7\u53D6\u7EDF\u8BA1\u4FE1\u606F\n        public ContextStats getStats() {\n            ContextStats stats = new ContextStats();\n            stats.setTotalContexts(totalContexts.get());\n            stats.setCleanedContexts(cleanedContexts.get());\n            stats.setActiveContexts(contextTimestamps.size());\n            stats.setCleanupInterval(cleanupInterval);\n            stats.setContextTimeout(contextTimeout);\n            return stats;\n        }\n        \n        // \u5173\u95ED\u6E05\u7406\u5668\n        public void shutdown() {\n            cleanupExecutor.shutdown();\n            try {\n                if (!cleanupExecutor.awaitTermination(5, TimeUnit.SECONDS)) {\n                    cleanupExecutor.shutdownNow();\n                }\n            } catch (InterruptedException e) {\n                cleanupExecutor.shutdownNow();\n                Thread.currentThread().interrupt();\n            }\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u4F20\u64AD\u62E6\u622A\u5668\n    public class ContextPropagationInterceptor {\n        private final List<ContextInterceptor> interceptors;\n        \n        public ContextPropagationInterceptor() {\n            this.interceptors = new ArrayList<>();\n            this.interceptors.add(new ThreadPoolInterceptor());\n            this.interceptors.add(new AsyncInterceptor());\n            this.interceptors.add(new ScheduledInterceptor());\n        }\n        \n        // \u6267\u884C\u524D\u62E6\u622A\n        public void beforeExecute(TraceContext context) {\n            for (ContextInterceptor interceptor : interceptors) {\n                try {\n                    interceptor.beforeExecute(context);\n                } catch (Exception e) {\n                    // \u8BB0\u5F55\u62E6\u622A\u5668\u5F02\u5E38\uFF0C\u4F46\u4E0D\u4E2D\u65AD\u6267\u884C\n                    System.err.println("Interceptor beforeExecute failed: " + e.getMessage());\n                }\n            }\n        }\n        \n        // \u6267\u884C\u540E\u62E6\u622A\n        public void afterExecute(TraceContext context) {\n            for (ContextInterceptor interceptor : interceptors) {\n                try {\n                    interceptor.afterExecute(context);\n                } catch (Exception e) {\n                    // \u8BB0\u5F55\u62E6\u622A\u5668\u5F02\u5E38\uFF0C\u4F46\u4E0D\u4E2D\u65AD\u6267\u884C\n                    System.err.println("Interceptor afterExecute failed: " + e.getMessage());\n                }\n            }\n        }\n        \n        // \u62E6\u622A\u5668\u63A5\u53E3\n        public interface ContextInterceptor {\n            void beforeExecute(TraceContext context);\n            void afterExecute(TraceContext context);\n        }\n        \n        // \u7EBF\u7A0B\u6C60\u62E6\u622A\u5668\n        public class ThreadPoolInterceptor implements ContextInterceptor {\n            @Override\n            public void beforeExecute(TraceContext context) {\n                // \u5728\u7EBF\u7A0B\u6C60\u6267\u884C\u524D\u8BBE\u7F6E\u4E0A\u4E0B\u6587\n                GlobalContextManager.setContext(context);\n            }\n            \n            @Override\n            public void afterExecute(TraceContext context) {\n                // \u5728\u7EBF\u7A0B\u6C60\u6267\u884C\u540E\u6E05\u7406\u4E0A\u4E0B\u6587\n                GlobalContextManager.clearContext();\n            }\n        }\n        \n        // \u5F02\u6B65\u62E6\u622A\u5668\n        public class AsyncInterceptor implements ContextInterceptor {\n            @Override\n            public void beforeExecute(TraceContext context) {\n                // \u5728\u5F02\u6B65\u6267\u884C\u524D\u8BBE\u7F6E\u4E0A\u4E0B\u6587\n                GlobalContextManager.setContext(context);\n            }\n            \n            @Override\n            public void afterExecute(TraceContext context) {\n                // \u5728\u5F02\u6B65\u6267\u884C\u540E\u6E05\u7406\u4E0A\u4E0B\u6587\n                GlobalContextManager.clearContext();\n            }\n        }\n        \n        // \u5B9A\u65F6\u4EFB\u52A1\u62E6\u622A\u5668\n        public class ScheduledInterceptor implements ContextInterceptor {\n            @Override\n            public void beforeExecute(TraceContext context) {\n                // \u5728\u5B9A\u65F6\u4EFB\u52A1\u6267\u884C\u524D\u8BBE\u7F6E\u4E0A\u4E0B\u6587\n                GlobalContextManager.setContext(context);\n            }\n            \n            @Override\n            public void afterExecute(TraceContext context) {\n                // \u5728\u5B9A\u65F6\u4EFB\u52A1\u6267\u884C\u540E\u6E05\u7406\u4E0A\u4E0B\u6587\n                GlobalContextManager.clearContext();\n            }\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u611F\u77E5\u7684\u7EBF\u7A0B\u6C60\u6267\u884C\u5668\n    public class ContextAwareThreadPoolExecutor extends ThreadPoolExecutor {\n        private final ContextPropagationInterceptor interceptor;\n        \n        public ContextAwareThreadPoolExecutor(int corePoolSize, int maximumPoolSize,\n                                            long keepAliveTime, TimeUnit unit,\n                                            BlockingQueue<Runnable> workQueue) {\n            super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);\n            this.interceptor = new ContextPropagationInterceptor();\n        }\n        \n        @Override\n        public void execute(Runnable command) {\n            TraceContext context = GlobalContextManager.getContext();\n            if (context != null) {\n                command = new ContextAwareRunnable(command, context, interceptor);\n            }\n            super.execute(command);\n        }\n        \n        @Override\n        public <T> Future<T> submit(Callable<T> task) {\n            TraceContext context = GlobalContextManager.getContext();\n            if (context != null) {\n                task = new ContextAwareCallable<>(task, context, interceptor);\n            }\n            return super.submit(task);\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u611F\u77E5\u7684Runnable\n    public class ContextAwareRunnable implements Runnable {\n        private final Runnable delegate;\n        private final TraceContext context;\n        private final ContextPropagationInterceptor interceptor;\n        \n        public ContextAwareRunnable(Runnable delegate, TraceContext context,\n                                  ContextPropagationInterceptor interceptor) {\n            this.delegate = delegate;\n            this.context = context;\n            this.interceptor = interceptor;\n        }\n        \n        @Override\n        public void run() {\n            try {\n                interceptor.beforeExecute(context);\n                delegate.run();\n            } finally {\n                interceptor.afterExecute(context);\n            }\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u611F\u77E5\u7684Callable\n    public class ContextAwareCallable<T> implements Callable<T> {\n        private final Callable<T> delegate;\n        private final TraceContext context;\n        private final ContextPropagationInterceptor interceptor;\n        \n        public ContextAwareCallable(Callable<T> delegate, TraceContext context,\n                                  ContextPropagationInterceptor interceptor) {\n            this.delegate = delegate;\n            this.context = context;\n            this.interceptor = interceptor;\n        }\n        \n        @Override\n        public T call() throws Exception {\n            try {\n                interceptor.beforeExecute(context);\n                return delegate.call();\n            } finally {\n                interceptor.afterExecute(context);\n            }\n        }\n    }\n    \n    // \u4E0A\u4E0B\u6587\u7EDF\u8BA1\u4FE1\u606F\n    public class ContextStats {\n        private long totalContexts;\n        private long cleanedContexts;\n        private int activeContexts;\n        private long cleanupInterval;\n        private long contextTimeout;\n        \n        // Getters and setters\n        public long getTotalContexts() { return totalContexts; }\n        public void setTotalContexts(long totalContexts) { this.totalContexts = totalContexts; }\n        \n        public long getCleanedContexts() { return cleanedContexts; }\n        public void setCleanedContexts(long cleanedContexts) { this.cleanedContexts = cleanedContexts; }\n        \n        public int getActiveContexts() { return activeContexts; }\n        public void setActiveContexts(int activeContexts) { this.activeContexts = activeContexts; }\n        \n        public long getCleanupInterval() { return cleanupInterval; }\n        public void setCleanupInterval(long cleanupInterval) { this.cleanupInterval = cleanupInterval; }\n        \n        public long getContextTimeout() { return contextTimeout; }\n        public void setContextTimeout(long contextTimeout) { this.contextTimeout = contextTimeout; }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u4E0A\u4E0B\u6587\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",children:"\u4E0A\u4E0B\u6587\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,a.jsx)(e.admonition,{title:"\u4E0A\u4E0B\u6587\u7BA1\u7406\u6700\u4F73\u5B9E\u8DF5",type:"info",children:(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u53CA\u65F6\u6E05\u7406"}),"\uFF1A\u5728\u8BF7\u6C42\u7ED3\u675F\u65F6\u53CA\u65F6\u6E05\u7406ThreadLocal\uFF0C\u9632\u6B62\u5185\u5B58\u6CC4\u6F0F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F02\u5E38\u5904\u7406"}),"\uFF1A\u5728finally\u5757\u4E2D\u6E05\u7406\u4E0A\u4E0B\u6587\uFF0C\u786E\u4FDD\u5373\u4F7F\u53D1\u751F\u5F02\u5E38\u4E5F\u80FD\u6E05\u7406"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7EBF\u7A0B\u6C60\u9002\u914D"}),"\uFF1A\u4F7F\u7528ContextAwareThreadPoolExecutor\u786E\u4FDD\u7EBF\u7A0B\u6C60\u4EFB\u52A1\u80FD\u7EE7\u627F\u4E0A\u4E0B\u6587"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F02\u6B65\u5904\u7406"}),"\uFF1A\u5BF9CompletableFuture\u3001RxJava\u7B49\u5F02\u6B65\u6846\u67B6\u8FDB\u884C\u9002\u914D"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B9A\u65F6\u4EFB\u52A1"}),"\uFF1A\u5BF9ScheduledExecutorService\u8FDB\u884C\u9002\u914D\uFF0C\u786E\u4FDD\u5B9A\u65F6\u4EFB\u52A1\u6709\u6B63\u786E\u7684\u4E0A\u4E0B\u6587"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u76D1\u63A7\u544A\u8B66"}),"\uFF1A\u76D1\u63A7\u6D3B\u8DC3\u4E0A\u4E0B\u6587\u6570\u91CF\uFF0C\u9632\u6B62\u5185\u5B58\u6CC4\u6F0F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5316"}),"\uFF1A\u4F7F\u7528\u5F31\u5F15\u7528\u548C\u5B9A\u671F\u6E05\u7406\u7B56\u7565\uFF0C\u5E73\u8861\u6027\u80FD\u548C\u5185\u5B58\u4F7F\u7528"]}),"\n"]})}),"\n",(0,a.jsx)(e.h2,{id:"3-\u5B9E\u9645\u5E94\u7528\u573A\u666F\u4E0E\u6700\u4F73\u5B9E\u8DF5",children:"3. \u5B9E\u9645\u5E94\u7528\u573A\u666F\u4E0E\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,a.jsx)(e.h3,{id:"31-\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u94FE\u8DEF\u8FFD\u8E2A",children:"3.1 \u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u94FE\u8DEF\u8FFD\u8E2A"}),"\n",(0,a.jsx)(e.p,{children:"\u5728Spring Boot\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u96C6\u6210\u94FE\u8DEF\u8FFD\u8E2A\uFF0C\u80FD\u591F\u63D0\u4F9B\u5B8C\u6574\u7684\u8BF7\u6C42\u8FFD\u8E2A\u80FD\u529B\u3002\u901A\u8FC7\u81EA\u52A8\u914D\u7F6E\u548C\u6CE8\u89E3\u9A71\u52A8\u7684\u65B9\u5F0F\uFF0C\u53EF\u4EE5\u6700\u5C0F\u5316\u4EE3\u7801\u4FB5\u5165\u6027\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="Spring Boot\u94FE\u8DEF\u8FFD\u8E2A\u96C6\u6210"',children:'@Configuration\n@EnableTracing\npublic class SpringBootTracingIntegration {\n    \n    /*\n     * Spring Boot\u94FE\u8DEF\u8FFD\u8E2A\u96C6\u6210\u914D\u7F6E\n     * 1. \u81EA\u52A8\u914D\u7F6E\uFF1A\u57FA\u4E8ESpring Boot\u7684\u81EA\u52A8\u914D\u7F6E\u673A\u5236\n     * 2. \u6CE8\u89E3\u9A71\u52A8\uFF1A\u4F7F\u7528@Traced\u6CE8\u89E3\u6807\u8BB0\u9700\u8981\u8FFD\u8E2A\u7684\u65B9\u6CD5\n     * 3. \u62E6\u622A\u5668\uFF1AHTTP\u8BF7\u6C42\u62E6\u622A\u5668\u81EA\u52A8\u6CE8\u5165\u548C\u63D0\u53D6\u4E0A\u4E0B\u6587\n     * 4. \u91C7\u6837\u7B56\u7565\uFF1A\u53EF\u914D\u7F6E\u7684\u91C7\u6837\u7B56\u7565\n     * 5. \u5BFC\u51FA\u914D\u7F6E\uFF1A\u652F\u6301\u591A\u79CD\u540E\u7AEF\u5B58\u50A8\n     */\n    \n    // \u81EA\u52A8\u914D\u7F6E\u7C7B\n    @Configuration\n    @ConditionalOnClass(TraceContext.class)\n    @EnableConfigurationProperties(TracingProperties.class)\n    public static class TracingAutoConfiguration {\n        \n        @Bean\n        @ConditionalOnMissingBean\n        public TracePropagator httpTracePropagator() {\n            return new HttpTracePropagator();\n        }\n        \n        @Bean\n        @ConditionalOnMissingBean\n        public Sampler probabilitySampler(TracingProperties properties) {\n            return new ProbabilitySampler(properties.getSamplingRate());\n        }\n        \n        @Bean\n        @ConditionalOnMissingBean\n        public SpanExporter jaegerExporter(TracingProperties properties) {\n            return new JaegerExporter(properties.getJaegerEndpoint());\n        }\n        \n        @Bean\n        @ConditionalOnMissingBean\n        public TracingAspect tracingAspect(Sampler sampler, SpanExporter exporter) {\n            return new TracingAspect(sampler, exporter);\n        }\n    }\n    \n    // \u914D\u7F6E\u5C5E\u6027\n    @ConfigurationProperties(prefix = "tracing")\n    public static class TracingProperties {\n        private double samplingRate = 0.1; // 10%\u91C7\u6837\u7387\n        private String jaegerEndpoint = "http://localhost:14268/api/traces";\n        private boolean enabled = true;\n        private String serviceName;\n        private Map<String, String> tags = new HashMap<>();\n        \n        // getters and setters\n    }\n    \n    // \u81EA\u5B9A\u4E49\u6CE8\u89E3\n    @Target({ElementType.METHOD, ElementType.TYPE})\n    @Retention(RetentionPolicy.RUNTIME)\n    public @interface Traced {\n        String operationName() default "";\n        String[] tags() default {};\n        boolean includeArgs() default false;\n        boolean includeResult() default false;\n    }\n    \n    // AOP\u5207\u9762\n    @Aspect\n    @Component\n    public static class TracingAspect {\n        private final Sampler sampler;\n        private final SpanExporter exporter;\n        \n        public TracingAspect(Sampler sampler, SpanExporter exporter) {\n            this.sampler = sampler;\n            this.exporter = exporter;\n        }\n        \n        @Around("@annotation(traced)")\n        public Object traceMethod(ProceedingJoinPoint joinPoint, Traced traced) throws Throwable {\n            // \u521B\u5EFASpan\n            Span span = createSpan(joinPoint, traced);\n            \n            try {\n                // \u6267\u884C\u65B9\u6CD5\n                Object result = joinPoint.proceed();\n                \n                // \u8BB0\u5F55\u7ED3\u679C\n                if (traced.includeResult()) {\n                    span.addTag("result", String.valueOf(result));\n                }\n                \n                span.finish();\n                return result;\n                \n            } catch (Exception e) {\n                // \u8BB0\u5F55\u5F02\u5E38\n                span.finishWithError(e.getMessage());\n                throw e;\n            } finally {\n                // \u5BFC\u51FASpan\n                exporter.export(Collections.singletonList(span));\n            }\n        }\n        \n        private Span createSpan(ProceedingJoinPoint joinPoint, Traced traced) {\n            String operationName = traced.operationName();\n            if (operationName.isEmpty()) {\n                operationName = joinPoint.getSignature().getName();\n            }\n            \n            Span span = new Span(generateSpanId(), getCurrentTraceId(), \n                getServiceName(), operationName);\n            \n            // \u6DFB\u52A0\u6807\u7B7E\n            for (String tag : traced.tags()) {\n                String[] parts = tag.split("=");\n                if (parts.length == 2) {\n                    span.addTag(parts[0], parts[1]);\n                }\n            }\n            \n            // \u6DFB\u52A0\u53C2\u6570\n            if (traced.includeArgs()) {\n                Object[] args = joinPoint.getArgs();\n                for (int i = 0; i < args.length; i++) {\n                    span.addTag("arg." + i, String.valueOf(args[i]));\n                }\n            }\n            \n            return span;\n        }\n    }\n    \n    // HTTP\u62E6\u622A\u5668\n    @Component\n    public static class TracingHttpInterceptor implements HandlerInterceptor {\n        private final TracePropagator propagator;\n        private final Sampler sampler;\n        \n        @Override\n        public boolean preHandle(HttpServletRequest request, \n                               HttpServletResponse response, \n                               Object handler) throws Exception {\n            \n            // \u63D0\u53D6\u4E0A\u4E0B\u6587\n            TraceContext context = propagator.extract(request);\n            \n            if (context != null && sampler.shouldSample(context).isSampled()) {\n                // \u8BBE\u7F6E\u4E0A\u4E0B\u6587\n                GlobalContextManager.setContext(context);\n                \n                // \u521B\u5EFASpan\n                Span span = new Span(context.getSpanId(), context.getTraceId(),\n                    getServiceName(), request.getMethod() + " " + request.getRequestURI());\n                \n                span.addTag("http.method", request.getMethod());\n                span.addTag("http.url", request.getRequestURL().toString());\n                span.addTag("http.user_agent", request.getHeader("User-Agent"));\n                \n                // \u5B58\u50A8Span\u5230\u8BF7\u6C42\u5C5E\u6027\n                request.setAttribute("tracing.span", span);\n            }\n            \n            return true;\n        }\n        \n        @Override\n        public void afterCompletion(HttpServletRequest request, \n                                  HttpServletResponse response, \n                                  Object handler, Exception ex) throws Exception {\n            \n            Span span = (Span) request.getAttribute("tracing.span");\n            if (span != null) {\n                // \u6DFB\u52A0\u54CD\u5E94\u4FE1\u606F\n                span.addTag("http.status_code", String.valueOf(response.getStatus()));\n                \n                if (ex != null) {\n                    span.finishWithError(ex.getMessage());\n                } else {\n                    span.finish();\n                }\n                \n                // \u5BFC\u51FASpan\n                exporter.export(Collections.singletonList(span));\n            }\n            \n            // \u6E05\u7406\u4E0A\u4E0B\u6587\n            GlobalContextManager.clearContext();\n        }\n    }\n    \n    // \u793A\u4F8B\u63A7\u5236\u5668\n    @RestController\n    @RequestMapping("/api/orders")\n    public static class OrderController {\n        \n        @Autowired\n        private OrderService orderService;\n        \n        @GetMapping("/{id}")\n        @Traced(operationName = "getOrder", tags = {"component=controller"})\n        public ResponseEntity<Order> getOrder(@PathVariable Long id) {\n            Order order = orderService.getOrder(id);\n            return ResponseEntity.ok(order);\n        }\n        \n        @PostMapping\n        @Traced(operationName = "createOrder", includeArgs = true, includeResult = true)\n        public ResponseEntity<Order> createOrder(@RequestBody OrderRequest request) {\n            Order order = orderService.createOrder(request);\n            return ResponseEntity.status(HttpStatus.CREATED).body(order);\n        }\n    }\n    \n    // \u793A\u4F8B\u670D\u52A1\n    @Service\n    public static class OrderService {\n        \n        @Traced(operationName = "getOrderFromDatabase")\n        public Order getOrder(Long id) {\n            // \u6A21\u62DF\u6570\u636E\u5E93\u67E5\u8BE2\n            return new Order(id, "Sample Order");\n        }\n        \n        @Traced(operationName = "createOrderInDatabase", includeArgs = true)\n        public Order createOrder(OrderRequest request) {\n            // \u6A21\u62DF\u8BA2\u5355\u521B\u5EFA\n            return new Order(System.currentTimeMillis(), request.getProductName());\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"32-\u6570\u636E\u5E93\u64CD\u4F5C\u8FFD\u8E2A",children:"3.2 \u6570\u636E\u5E93\u64CD\u4F5C\u8FFD\u8E2A"}),"\n",(0,a.jsx)(e.p,{children:"\u6570\u636E\u5E93\u64CD\u4F5C\u662F\u5FAE\u670D\u52A1\u4E2D\u7684\u5173\u952E\u73AF\u8282\uFF0C\u901A\u8FC7JDBC\u5305\u88C5\u548C\u4E8B\u52A1\u7BA1\u7406\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u5BF9\u6570\u636E\u5E93\u64CD\u4F5C\u7684\u5B8C\u6574\u8FFD\u8E2A\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u6570\u636E\u5E93\u94FE\u8DEF\u8FFD\u8E2A\u96C6\u6210"',children:'public class DatabaseTracingIntegration {\n    \n    /*\n     * \u6570\u636E\u5E93\u64CD\u4F5C\u94FE\u8DEF\u8FFD\u8E2A\n     * 1. JDBC\u5305\u88C5\uFF1A\u5305\u88C5DataSource\u3001Connection\u3001Statement\u7B49\n     * 2. SQL\u8FFD\u8E2A\uFF1A\u8BB0\u5F55SQL\u8BED\u53E5\u3001\u53C2\u6570\u3001\u6267\u884C\u65F6\u95F4\n     * 3. \u4E8B\u52A1\u8FFD\u8E2A\uFF1A\u8FFD\u8E2A\u4E8B\u52A1\u7684\u5F00\u59CB\u3001\u63D0\u4EA4\u3001\u56DE\u6EDA\n     * 4. \u8FDE\u63A5\u6C60\u8FFD\u8E2A\uFF1A\u76D1\u63A7\u8FDE\u63A5\u6C60\u7684\u4F7F\u7528\u60C5\u51B5\n     * 5. \u6162\u67E5\u8BE2\u544A\u8B66\uFF1A\u5BF9\u6162\u67E5\u8BE2\u8FDB\u884C\u544A\u8B66\n     */\n    \n    // \u53EF\u8FFD\u8E2A\u7684\u6570\u636E\u6E90\n    public class TracingDataSource implements DataSource {\n        private final DataSource delegate;\n        private final String serviceName;\n        \n        @Override\n        public Connection getConnection() throws SQLException {\n            Connection connection = delegate.getConnection();\n            return new TracingConnection(connection, serviceName);\n        }\n        \n        @Override\n        public Connection getConnection(String username, String password) throws SQLException {\n            Connection connection = delegate.getConnection(username, password);\n            return new TracingConnection(connection, serviceName);\n        }\n    }\n    \n    // \u53EF\u8FFD\u8E2A\u7684\u8FDE\u63A5\n    public class TracingConnection implements Connection {\n        private final Connection delegate;\n        private final String serviceName;\n        private final String connectionId;\n        \n        public TracingConnection(Connection delegate, String serviceName) {\n            this.delegate = delegate;\n            this.serviceName = serviceName;\n            this.connectionId = generateConnectionId();\n        }\n        \n        @Override\n        public Statement createStatement() throws SQLException {\n            Statement statement = delegate.createStatement();\n            return new TracingStatement(statement, serviceName, connectionId);\n        }\n        \n        @Override\n        public PreparedStatement prepareStatement(String sql) throws SQLException {\n            PreparedStatement statement = delegate.prepareStatement(sql);\n            return new TracingPreparedStatement(statement, sql, serviceName, connectionId);\n        }\n        \n        @Override\n        public void commit() throws SQLException {\n            Span span = createSpan("db.commit", serviceName);\n            try {\n                delegate.commit();\n                span.finish();\n            } catch (SQLException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n        \n        @Override\n        public void rollback() throws SQLException {\n            Span span = createSpan("db.rollback", serviceName);\n            try {\n                delegate.rollback();\n                span.finish();\n            } catch (SQLException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n    }\n    \n    // \u53EF\u8FFD\u8E2A\u7684Statement\n    public class TracingStatement implements Statement {\n        private final Statement delegate;\n        private final String serviceName;\n        private final String connectionId;\n        \n        @Override\n        public boolean execute(String sql) throws SQLException {\n            Span span = createSpan("db.execute", serviceName);\n            span.addTag("db.sql", sql);\n            span.addTag("db.connection_id", connectionId);\n            \n            try {\n                boolean result = delegate.execute(sql);\n                span.addTag("db.result", String.valueOf(result));\n                span.finish();\n                return result;\n            } catch (SQLException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n        \n        @Override\n        public ResultSet executeQuery(String sql) throws SQLException {\n            Span span = createSpan("db.executeQuery", serviceName);\n            span.addTag("db.sql", sql);\n            span.addTag("db.connection_id", connectionId);\n            \n            try {\n                ResultSet resultSet = delegate.executeQuery(sql);\n                span.finish();\n                return resultSet;\n            } catch (SQLException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n    }\n    \n    // \u53EF\u8FFD\u8E2A\u7684PreparedStatement\n    public class TracingPreparedStatement implements PreparedStatement {\n        private final PreparedStatement delegate;\n        private final String sql;\n        private final String serviceName;\n        private final String connectionId;\n        \n        @Override\n        public boolean execute() throws SQLException {\n            Span span = createSpan("db.executePrepared", serviceName);\n            span.addTag("db.sql", sql);\n            span.addTag("db.connection_id", connectionId);\n            \n            try {\n                boolean result = delegate.execute();\n                span.addTag("db.result", String.valueOf(result));\n                span.finish();\n                return result;\n            } catch (SQLException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n    }\n    \n    // \u4E8B\u52A1\u7BA1\u7406\u5668\n    public class TracingTransactionManager implements PlatformTransactionManager {\n        private final PlatformTransactionManager delegate;\n        private final String serviceName;\n        \n        @Override\n        public TransactionStatus getTransaction(TransactionDefinition definition) throws TransactionException {\n            Span span = createSpan("db.transaction.begin", serviceName);\n            span.addTag("db.transaction.isolation", String.valueOf(definition.getIsolationLevel()));\n            span.addTag("db.transaction.propagation", String.valueOf(definition.getPropagationBehavior()));\n            \n            try {\n                TransactionStatus status = delegate.getTransaction(definition);\n                span.addTag("db.transaction.new", String.valueOf(status.isNewTransaction()));\n                span.finish();\n                return status;\n            } catch (TransactionException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n        \n        @Override\n        public void commit(TransactionStatus status) throws TransactionException {\n            Span span = createSpan("db.transaction.commit", serviceName);\n            \n            try {\n                delegate.commit(status);\n                span.finish();\n            } catch (TransactionException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n        \n        @Override\n        public void rollback(TransactionStatus status) throws TransactionException {\n            Span span = createSpan("db.transaction.rollback", serviceName);\n            \n            try {\n                delegate.rollback(status);\n                span.finish();\n            } catch (TransactionException e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"33-\u6D88\u606F\u961F\u5217\u94FE\u8DEF\u8FFD\u8E2A",children:"3.3 \u6D88\u606F\u961F\u5217\u94FE\u8DEF\u8FFD\u8E2A"}),"\n",(0,a.jsx)(e.p,{children:"\u6D88\u606F\u961F\u5217\u662F\u5FAE\u670D\u52A1\u95F4\u5F02\u6B65\u901A\u4FE1\u7684\u91CD\u8981\u7EC4\u4EF6\uFF0C\u901A\u8FC7\u751F\u4EA7\u8005\u62E6\u622A\u5668\u548C\u6D88\u8D39\u8005\u62E6\u622A\u5668\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u6D88\u606F\u7684\u5B8C\u6574\u8FFD\u8E2A\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u6D88\u606F\u961F\u5217\u94FE\u8DEF\u8FFD\u8E2A\u96C6\u6210"',children:'public class MessageQueueTracingIntegration {\n    \n    /*\n     * \u6D88\u606F\u961F\u5217\u94FE\u8DEF\u8FFD\u8E2A\n     * 1. Kafka\u8FFD\u8E2A\uFF1AProducer\u548CConsumer\u7684\u62E6\u622A\u5668\n     * 2. RabbitMQ\u8FFD\u8E2A\uFF1ATemplate\u548CListener\u7684\u5305\u88C5\n     * 3. \u6D88\u606F\u5C5E\u6027\uFF1A\u5728\u6D88\u606F\u4E2D\u6CE8\u5165\u8FFD\u8E2A\u4FE1\u606F\n     * 4. \u5F02\u6B65\u8FFD\u8E2A\uFF1A\u652F\u6301\u5F02\u6B65\u6D88\u606F\u7684\u8FFD\u8E2A\n     * 5. \u6279\u91CF\u8FFD\u8E2A\uFF1A\u652F\u6301\u6279\u91CF\u6D88\u606F\u7684\u8FFD\u8E2A\n     */\n    \n    // Kafka Producer\u62E6\u622A\u5668\n    public class TracingKafkaProducerInterceptor implements ProducerInterceptor<String, String> {\n        private final String serviceName;\n        \n        @Override\n        public ProducerRecord<String, String> onSend(ProducerRecord<String, String> record) {\n            TraceContext context = GlobalContextManager.getContext();\n            if (context != null) {\n                // \u6CE8\u5165\u8FFD\u8E2A\u4FE1\u606F\u5230\u6D88\u606F\u5934\n                record.headers().add("X-Trace-Id", context.getTraceId().getBytes());\n                record.headers().add("X-Span-Id", context.getSpanId().getBytes());\n                record.headers().add("X-Parent-Span-Id", \n                    context.getParentSpanId() != null ? \n                    context.getParentSpanId().getBytes() : new byte[0]);\n                record.headers().add("X-Sampled", \n                    String.valueOf(context.isSampled()).getBytes());\n                \n                // \u6CE8\u5165\u884C\u674E\u4FE1\u606F\n                for (Map.Entry<String, Object> entry : context.getBaggage().entrySet()) {\n                    String headerName = "X-Baggage-" + entry.getKey();\n                    String headerValue = String.valueOf(entry.getValue());\n                    record.headers().add(headerName, headerValue.getBytes());\n                }\n            }\n            \n            return record;\n        }\n        \n        @Override\n        public void onAcknowledgement(RecordMetadata metadata, Exception exception) {\n            // \u8BB0\u5F55\u53D1\u9001\u7ED3\u679C\n            if (exception != null) {\n                Span span = createSpan("kafka.producer.error", serviceName);\n                span.addTag("kafka.topic", metadata.topic());\n                span.addTag("kafka.partition", String.valueOf(metadata.partition()));\n                span.addTag("kafka.offset", String.valueOf(metadata.offset()));\n                span.finishWithError(exception.getMessage());\n            }\n        }\n    }\n    \n    // Kafka Consumer\u62E6\u622A\u5668\n    public class TracingKafkaConsumerInterceptor implements ConsumerInterceptor<String, String> {\n        private final String serviceName;\n        \n        @Override\n        public ConsumerRecords<String, String> onConsume(ConsumerRecords<String, String> records) {\n            for (ConsumerRecord<String, String> record : records) {\n                // \u63D0\u53D6\u8FFD\u8E2A\u4FE1\u606F\n                Header traceIdHeader = record.headers().lastHeader("X-Trace-Id");\n                Header spanIdHeader = record.headers().lastHeader("X-Span-Id");\n                \n                if (traceIdHeader != null && spanIdHeader != null) {\n                    String traceId = new String(traceIdHeader.value());\n                    String spanId = new String(spanIdHeader.value());\n                    \n                    TraceContext context = new TraceContext(traceId, spanId);\n                    \n                    // \u63D0\u53D6\u7236Span ID\n                    Header parentSpanIdHeader = record.headers().lastHeader("X-Parent-Span-Id");\n                    if (parentSpanIdHeader != null && parentSpanIdHeader.value().length > 0) {\n                        context.setParentSpanId(new String(parentSpanIdHeader.value()));\n                    }\n                    \n                    // \u8BBE\u7F6E\u4E0A\u4E0B\u6587\n                    GlobalContextManager.setContext(context);\n                    \n                    // \u521B\u5EFA\u6D88\u8D39Span\n                    Span span = createSpan("kafka.consume", serviceName);\n                    span.addTag("kafka.topic", record.topic());\n                    span.addTag("kafka.partition", String.valueOf(record.partition()));\n                    span.addTag("kafka.offset", String.valueOf(record.offset()));\n                    span.addTag("kafka.key", record.key());\n                    \n                    // \u5B58\u50A8Span\u5230\u8BB0\u5F55\u5C5E\u6027\n                    record.headers().add("X-Consume-Span-Id", span.getSpanId().getBytes());\n                }\n            }\n            \n            return records;\n        }\n    }\n    \n    // RabbitMQ Template\u5305\u88C5\n    public class TracingRabbitTemplate extends RabbitTemplate {\n        private final String serviceName;\n        \n        @Override\n        public void convertAndSend(String exchange, String routingKey, Object message) {\n            TraceContext context = GlobalContextManager.getContext();\n            if (context != null) {\n                // \u521B\u5EFA\u53D1\u9001Span\n                Span span = createSpan("rabbitmq.send", serviceName);\n                span.addTag("rabbitmq.exchange", exchange);\n                span.addTag("rabbitmq.routing_key", routingKey);\n                \n                try {\n                    super.convertAndSend(exchange, routingKey, message);\n                    span.finish();\n                } catch (Exception e) {\n                    span.finishWithError(e.getMessage());\n                    throw e;\n                }\n            } else {\n                super.convertAndSend(exchange, routingKey, message);\n            }\n        }\n    }\n    \n    // RabbitMQ Listener\u5305\u88C5\n    public class TracingMessageListenerAdapter extends MessageListenerAdapter {\n        private final String serviceName;\n        \n        @Override\n        public void onMessage(Message message, Channel channel) throws Exception {\n            // \u63D0\u53D6\u8FFD\u8E2A\u4FE1\u606F\n            AMQP.BasicProperties props = message.getProperties();\n            if (props != null && props.getHeaders() != null) {\n                Map<String, Object> headers = props.getHeaders();\n                String traceId = (String) headers.get("X-Trace-Id");\n                String spanId = (String) headers.get("X-Span-Id");\n                \n                if (traceId != null && spanId != null) {\n                    TraceContext context = new TraceContext(traceId, spanId);\n                    GlobalContextManager.setContext(context);\n                    \n                    // \u521B\u5EFA\u6D88\u8D39Span\n                    Span span = createSpan("rabbitmq.consume", serviceName);\n                    span.addTag("rabbitmq.exchange", \n                        (String) headers.get("X-Exchange"));\n                    span.addTag("rabbitmq.routing_key", \n                        (String) headers.get("X-Routing-Key"));\n                    \n                    try {\n                        super.onMessage(message, channel);\n                        span.finish();\n                    } catch (Exception e) {\n                        span.finishWithError(e.getMessage());\n                        throw e;\n                    } finally {\n                        GlobalContextManager.clearContext();\n                    }\n                }\n            } else {\n                super.onMessage(message, channel);\n            }\n        }\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h3,{id:"34-\u7F13\u5B58\u94FE\u8DEF\u8FFD\u8E2A",children:"3.4 \u7F13\u5B58\u94FE\u8DEF\u8FFD\u8E2A"}),"\n",(0,a.jsx)(e.p,{children:"\u7F13\u5B58\u64CD\u4F5C\u5BF9\u7CFB\u7EDF\u6027\u80FD\u6709\u91CD\u8981\u5F71\u54CD\uFF0C\u901A\u8FC7\u7F13\u5B58\u62E6\u622A\u5668\u548C\u6307\u6807\u6536\u96C6\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u5BF9\u7F13\u5B58\u64CD\u4F5C\u7684\u5B8C\u6574\u76D1\u63A7\u3002"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",metastring:'title="\u7F13\u5B58\u94FE\u8DEF\u8FFD\u8E2A\u96C6\u6210"',children:'public class CacheTracingIntegration {\n    \n    /*\n     * \u7F13\u5B58\u94FE\u8DEF\u8FFD\u8E2A\n     * 1. Redis\u8FFD\u8E2A\uFF1ARedis\u64CD\u4F5C\u7684\u62E6\u622A\u548C\u76D1\u63A7\n     * 2. \u672C\u5730\u7F13\u5B58\u8FFD\u8E2A\uFF1ACaffeine\u3001Guava Cache\u7684\u5305\u88C5\n     * 3. \u7F13\u5B58\u547D\u4E2D\u7387\uFF1A\u76D1\u63A7\u7F13\u5B58\u7684\u547D\u4E2D\u60C5\u51B5\n     * 4. \u7F13\u5B58\u6027\u80FD\uFF1A\u76D1\u63A7\u7F13\u5B58\u7684\u54CD\u5E94\u65F6\u95F4\n     * 5. \u7F13\u5B58\u4E00\u81F4\u6027\uFF1A\u76D1\u63A7\u7F13\u5B58\u7684\u6570\u636E\u4E00\u81F4\u6027\n     */\n    \n    // Redis\u64CD\u4F5C\u8FFD\u8E2A\n    public class TracingRedisTemplate extends RedisTemplate<String, Object> {\n        private final String serviceName;\n        \n        @Override\n        public <T> T execute(RedisCallback<T> action) {\n            Span span = createSpan("redis.execute", serviceName);\n            \n            try {\n                T result = super.execute(action);\n                span.finish();\n                return result;\n            } catch (Exception e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n        \n        @Override\n        public <T> T execute(SessionCallback<T> session) {\n            Span span = createSpan("redis.session", serviceName);\n            \n            try {\n                T result = super.execute(session);\n                span.finish();\n                return result;\n            } catch (Exception e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n    }\n    \n    // \u672C\u5730\u7F13\u5B58\u8FFD\u8E2A\n    public class TracingCaffeineCache<K, V> {\n        private final Cache<K, V> delegate;\n        private final String serviceName;\n        private final CacheMetricsCollector metricsCollector;\n        \n        public V get(K key) {\n            Span span = createSpan("cache.get", serviceName);\n            span.addTag("cache.key", String.valueOf(key));\n            \n            try {\n                V value = delegate.getIfPresent(key);\n                \n                if (value != null) {\n                    span.addTag("cache.hit", "true");\n                    metricsCollector.recordHit();\n                } else {\n                    span.addTag("cache.hit", "false");\n                    metricsCollector.recordMiss();\n                }\n                \n                span.finish();\n                return value;\n            } catch (Exception e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n        \n        public void put(K key, V value) {\n            Span span = createSpan("cache.put", serviceName);\n            span.addTag("cache.key", String.valueOf(key));\n            \n            try {\n                delegate.put(key, value);\n                span.finish();\n            } catch (Exception e) {\n                span.finishWithError(e.getMessage());\n                throw e;\n            }\n        }\n    }\n    \n    // \u7F13\u5B58\u6307\u6807\u6536\u96C6\u5668\n    public class CacheMetricsCollector {\n        private final AtomicLong hitCount = new AtomicLong(0);\n        private final AtomicLong missCount = new AtomicLong(0);\n        private final AtomicLong totalCount = new AtomicLong(0);\n        private final String cacheName;\n        \n        public void recordHit() {\n            hitCount.incrementAndGet();\n            totalCount.incrementAndGet();\n        }\n        \n        public void recordMiss() {\n            missCount.incrementAndGet();\n            totalCount.incrementAndGet();\n        }\n        \n        public CacheMetrics getMetrics() {\n            CacheMetrics metrics = new CacheMetrics();\n            metrics.setCacheName(cacheName);\n            metrics.setHitCount(hitCount.get());\n            metrics.setMissCount(missCount.get());\n            metrics.setTotalCount(totalCount.get());\n            metrics.setHitRate((double) hitCount.get() / totalCount.get());\n            return metrics;\n        }\n    }\n    \n    // \u7F13\u5B58\u6307\u6807\n    public class CacheMetrics {\n        private String cacheName;\n        private long hitCount;\n        private long missCount;\n        private long totalCount;\n        private double hitRate;\n        private long avgResponseTime;\n        private long maxResponseTime;\n        private long minResponseTime;\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h4,{id:"\u94FE\u8DEF\u8FFD\u8E2A\u6700\u4F73\u5B9E\u8DF5\u603B\u7ED3",children:"\u94FE\u8DEF\u8FFD\u8E2A\u6700\u4F73\u5B9E\u8DF5\u603B\u7ED3"}),"\n",(0,a.jsx)(e.admonition,{title:"\u94FE\u8DEF\u8FFD\u8E2A\u6700\u4F73\u5B9E\u8DF5",type:"tip",children:(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7EDF\u4E00\u914D\u7F6E"}),"\uFF1A\u4F7F\u7528\u7EDF\u4E00\u7684\u914D\u7F6E\u7BA1\u7406\uFF0C\u786E\u4FDD\u6240\u6709\u670D\u52A1\u4F7F\u7528\u76F8\u540C\u7684\u91C7\u6837\u7B56\u7565"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5408\u7406\u91C7\u6837"}),"\uFF1A\u6839\u636E\u73AF\u5883\u548C\u670D\u52A1\u91CD\u8981\u6027\u8BBE\u7F6E\u4E0D\u540C\u7684\u91C7\u6837\u7387"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6027\u80FD\u76D1\u63A7"}),"\uFF1A\u76D1\u63A7\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u672C\u8EAB\u7684\u6027\u80FD\uFF0C\u907F\u514D\u5F71\u54CD\u4E1A\u52A1"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6570\u636E\u6E05\u7406"}),"\uFF1A\u5B9A\u671F\u6E05\u7406\u8FC7\u671F\u7684\u8FFD\u8E2A\u6570\u636E\uFF0C\u63A7\u5236\u5B58\u50A8\u6210\u672C"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u544A\u8B66\u673A\u5236"}),"\uFF1A\u5BF9\u5F02\u5E38\u94FE\u8DEF\u548C\u6027\u80FD\u95EE\u9898\u8FDB\u884C\u544A\u8B66"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6587\u6863\u5B8C\u5584"}),"\uFF1A\u4E3A\u56E2\u961F\u63D0\u4F9B\u8BE6\u7EC6\u7684\u4F7F\u7528\u6587\u6863\u548C\u6700\u4F73\u5B9E\u8DF5\u6307\u5357"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6301\u7EED\u4F18\u5316"}),"\uFF1A\u6839\u636E\u5B9E\u9645\u4F7F\u7528\u60C5\u51B5\u6301\u7EED\u4F18\u5316\u914D\u7F6E\u548C\u7B56\u7565"]}),"\n"]})}),"\n",(0,a.jsx)(e.h2,{id:"4-\u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u603B\u7ED3",children:"4. \u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u603B\u7ED3"}),"\n",(0,a.jsx)(e.h3,{id:"41-\u57FA\u7840\u6982\u5FF5\u9762\u8BD5\u9898",children:"4.1 \u57FA\u7840\u6982\u5FF5\u9762\u8BD5\u9898"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q1: \u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\uFF1F\u5B83\u7684\u6838\u5FC3\u6982\u5FF5\u6709\u54EA\u4E9B\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u662F\u4E00\u79CD\u7528\u4E8E\u76D1\u63A7\u548C\u8BCA\u65AD\u5206\u5E03\u5F0F\u7CFB\u7EDF\u7684\u6280\u672F\uFF0C\u901A\u8FC7\u8FFD\u8E2A\u8BF7\u6C42\u5728\u7CFB\u7EDF\u4E2D\u7684\u5B8C\u6574\u8C03\u7528\u94FE\u8DEF\uFF0C\u63D0\u4F9B\u7AEF\u5230\u7AEF\u7684\u53EF\u89C1\u6027\u3002"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6838\u5FC3\u6982\u5FF5\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Trace\uFF08\u94FE\u8DEF\uFF09"}),"\uFF1A\u4E00\u6B21\u5B8C\u6574\u7684\u8BF7\u6C42\u8C03\u7528\u94FE\u8DEF\uFF0C\u5305\u542B\u4ECE\u8BF7\u6C42\u5F00\u59CB\u5230\u54CD\u5E94\u7ED3\u675F\u7684\u6240\u6709\u64CD\u4F5C"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Span\uFF08\u8DE8\u5EA6\uFF09"}),"\uFF1A\u94FE\u8DEF\u4E2D\u7684\u4E00\u4E2A\u8C03\u7528\u7247\u6BB5\uFF0C\u4EE3\u8868\u4E00\u4E2A\u670D\u52A1\u5185\u90E8\u7684\u64CD\u4F5C\u6216\u670D\u52A1\u95F4\u7684\u8C03\u7528"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"TraceId"}),"\uFF1A\u5168\u5C40\u552F\u4E00\u7684\u94FE\u8DEF\u6807\u8BC6\u7B26\uFF0C\u7528\u4E8E\u5173\u8054\u540C\u4E00\u4E2A\u8BF7\u6C42\u7684\u6240\u6709Span"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"SpanId"}),"\uFF1ASpan\u7684\u552F\u4E00\u6807\u8BC6\u7B26\uFF0C\u7528\u4E8E\u6807\u8BC6\u7279\u5B9A\u7684\u64CD\u4F5C"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"ParentId"}),"\uFF1A\u7236Span\u7684ID\uFF0C\u7528\u4E8E\u6784\u5EFASpan\u4E4B\u95F4\u7684\u7236\u5B50\u5173\u7CFB"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Baggage\uFF08\u884C\u674E\uFF09"}),"\uFF1A\u8DE8\u670D\u52A1\u4F20\u9012\u7684\u4E0A\u4E0B\u6587\u4FE1\u606F\uFF0C\u5982\u7528\u6237ID\u3001\u8BF7\u6C42\u6765\u6E90\u7B49"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q2: \u4E3A\u4EC0\u4E48\u9700\u8981\u91C7\u6837\uFF1F\u91C7\u6837\u7B56\u7565\u6709\u54EA\u4E9B\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u5728\u9AD8\u5E76\u53D1\u7CFB\u7EDF\u4E2D\uFF0C\u5982\u679C\u5BF9\u6BCF\u4E2A\u8BF7\u6C42\u90FD\u8FDB\u884C\u5B8C\u6574\u8FFD\u8E2A\uFF0C\u4F1A\u4EA7\u751F\u5DE8\u5927\u7684\u6027\u80FD\u5F00\u9500\u548C\u5B58\u50A8\u6210\u672C\u3002\u91C7\u6837\u53EF\u4EE5\u5728\u4FDD\u8BC1\u76D1\u63A7\u6548\u679C\u7684\u540C\u65F6\uFF0C\u663E\u8457\u964D\u4F4E\u7CFB\u7EDF\u5F00\u9500\u3002"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u91C7\u6837\u7B56\u7565\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6982\u7387\u91C7\u6837"}),"\uFF1A\u6309\u56FA\u5B9A\u6982\u7387\u5BF9\u8BF7\u6C42\u8FDB\u884C\u91C7\u6837\uFF0C\u5B9E\u73B0\u7B80\u5355\uFF0C\u5F00\u9500\u5C0F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u89C4\u5219\u91C7\u6837"}),"\uFF1A\u6839\u636E\u7279\u5B9A\u89C4\u5219\uFF08\u5982URL\u3001\u7528\u6237ID\u7B49\uFF09\u51B3\u5B9A\u662F\u5426\u91C7\u6837\uFF0C\u7075\u6D3B\u4F46\u914D\u7F6E\u590D\u6742"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u52A8\u6001\u91C7\u6837"}),"\uFF1A\u6839\u636E\u7CFB\u7EDF\u8D1F\u8F7D\u52A8\u6001\u8C03\u6574\u91C7\u6837\u7387\uFF0C\u5E73\u8861\u6027\u80FD\u548C\u6570\u636E\u5B8C\u6574\u6027"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5173\u952E\u8DEF\u5F84\u91C7\u6837"}),"\uFF1A\u5BF9\u91CD\u8981\u4E1A\u52A1\u8DEF\u5F84\u8FDB\u884C100%\u91C7\u6837\uFF0C\u4FDD\u8BC1\u5173\u952E\u6570\u636E\u7684\u5B8C\u6574\u6027"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q3: \u94FE\u8DEF\u8FFD\u8E2A\u7684\u4F18\u52BF\u548C\u6311\u6218\u662F\u4EC0\u4E48\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"}),"\n",(0,a.jsx)(e.strong,{children:"\u4F18\u52BF\uFF1A"})]}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u7AEF\u5230\u7AEF\u53EF\u89C1\u6027\uFF1A\u5B8C\u6574\u8FFD\u8E2A\u8BF7\u6C42\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u6D41\u8F6C"}),"\n",(0,a.jsx)(e.li,{children:"\u6027\u80FD\u5206\u6790\uFF1A\u7CBE\u786E\u5206\u6790\u6BCF\u4E2A\u73AF\u8282\u7684\u8017\u65F6\u548C\u74F6\u9888"}),"\n",(0,a.jsx)(e.li,{children:"\u6545\u969C\u5B9A\u4F4D\uFF1A\u5FEB\u901F\u5B9A\u4F4D\u9519\u8BEF\u53D1\u751F\u7684\u5177\u4F53\u4F4D\u7F6E\u548C\u539F\u56E0"}),"\n",(0,a.jsx)(e.li,{children:"\u4F9D\u8D56\u5206\u6790\uFF1A\u7406\u89E3\u670D\u52A1\u95F4\u7684\u8C03\u7528\u5173\u7CFB\u548C\u4F9D\u8D56\u94FE"}),"\n",(0,a.jsx)(e.li,{children:"\u4E1A\u52A1\u6D1E\u5BDF\uFF1A\u7ED3\u5408\u4E1A\u52A1\u6570\u636E\uFF0C\u63D0\u4F9B\u4E1A\u52A1\u5C42\u9762\u7684\u5206\u6790"}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6311\u6218\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u6027\u80FD\u5F00\u9500\uFF1A\u91C7\u6837\u548C\u8FFD\u8E2A\u5BF9\u7CFB\u7EDF\u6027\u80FD\u7684\u5F71\u54CD"}),"\n",(0,a.jsx)(e.li,{children:"\u5B58\u50A8\u6210\u672C\uFF1A\u5927\u91CF\u8FFD\u8E2A\u6570\u636E\u7684\u5B58\u50A8\u548C\u7BA1\u7406"}),"\n",(0,a.jsx)(e.li,{children:"\u4E0A\u4E0B\u6587\u4F20\u64AD\uFF1A\u8DE8\u670D\u52A1\u3001\u8DE8\u7EBF\u7A0B\u7684\u4E0A\u4E0B\u6587\u4F20\u9012"}),"\n",(0,a.jsx)(e.li,{children:"\u6570\u636E\u4E00\u81F4\u6027\uFF1A\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u7684\u6570\u636E\u4E00\u81F4\u6027\u95EE\u9898"}),"\n",(0,a.jsx)(e.li,{children:"\u9690\u79C1\u4FDD\u62A4\uFF1A\u654F\u611F\u6570\u636E\u7684\u5904\u7406\u548C\u4F20\u8F93"}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"42-\u6280\u672F\u5B9E\u73B0\u9762\u8BD5\u9898",children:"4.2 \u6280\u672F\u5B9E\u73B0\u9762\u8BD5\u9898"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q4: \u5982\u4F55\u5B9E\u73B0\u8DE8\u670D\u52A1\u7684\u4E0A\u4E0B\u6587\u4F20\u64AD\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u8DE8\u670D\u52A1\u4E0A\u4E0B\u6587\u4F20\u64AD\u4E3B\u8981\u901A\u8FC7\u4F20\u64AD\u5668\uFF08Propagator\uFF09\u5B9E\u73B0\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"HTTP\u4F20\u64AD\u5668\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'// \u6CE8\u5165\u4E0A\u4E0B\u6587\u5230HTTP\u5934\u90E8\nheaders.set("X-Trace-Id", context.getTraceId());\nheaders.set("X-Span-Id", context.getSpanId());\nheaders.set("X-Parent-Span-Id", context.getParentSpanId());\nheaders.set("X-Sampled", String.valueOf(context.isSampled()));\n\n// \u4ECEHTTP\u5934\u90E8\u63D0\u53D6\u4E0A\u4E0B\u6587\nString traceId = headers.getFirst("X-Trace-Id");\nString spanId = headers.getFirst("X-Span-Id");\nTraceContext context = new TraceContext(traceId, spanId);\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6D88\u606F\u961F\u5217\u4F20\u64AD\u5668\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'// Kafka\u6D88\u606F\u5934\u6CE8\u5165\nrecord.headers().add("X-Trace-Id", context.getTraceId().getBytes());\nrecord.headers().add("X-Span-Id", context.getSpanId().getBytes());\n\n// RabbitMQ\u6D88\u606F\u5C5E\u6027\u6CE8\u5165\nheaders.put("X-Trace-Id", context.getTraceId());\nheaders.put("X-Span-Id", context.getSpanId());\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q5: \u5982\u4F55\u89E3\u51B3ThreadLocal\u5728\u5F02\u6B65\u73AF\u5883\u4E0B\u7684\u4E0A\u4E0B\u6587\u4F20\u64AD\u95EE\u9898\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u5728\u5F02\u6B65\u73AF\u5883\u4E0B\uFF0CThreadLocal\u65E0\u6CD5\u81EA\u52A8\u4F20\u64AD\u5230\u5B50\u7EBF\u7A0B\uFF0C\u9700\u8981\u901A\u8FC7\u4EE5\u4E0B\u65B9\u5F0F\u89E3\u51B3\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u7EBF\u7A0B\u6C60\u9002\u914D\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class ContextAwareThreadPoolExecutor extends ThreadPoolExecutor {\n    @Override\n    public void execute(Runnable command) {\n        TraceContext context = GlobalContextManager.getContext();\n        if (context != null) {\n            command = new ContextAwareRunnable(command, context);\n        }\n        super.execute(command);\n    }\n}\n\npublic class ContextAwareRunnable implements Runnable {\n    private final Runnable delegate;\n    private final TraceContext context;\n    \n    @Override\n    public void run() {\n        try {\n            GlobalContextManager.setContext(context);\n            delegate.run();\n        } finally {\n            GlobalContextManager.clearContext();\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"CompletableFuture\u9002\u914D\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class TracingCompletableFuture {\n    public static <T> CompletableFuture<T> supplyAsync(Supplier<T> supplier) {\n        TraceContext context = GlobalContextManager.getContext();\n        return CompletableFuture.supplyAsync(() -> {\n            try {\n                GlobalContextManager.setContext(context);\n                return supplier.get();\n            } finally {\n                GlobalContextManager.clearContext();\n            }\n        });\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q6: \u5982\u4F55\u4F18\u5316\u94FE\u8DEF\u8FFD\u8E2A\u7684\u6027\u80FD\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u94FE\u8DEF\u8FFD\u8E2A\u6027\u80FD\u4F18\u5316\u53EF\u4EE5\u4ECE\u4EE5\u4E0B\u51E0\u4E2A\u65B9\u9762\u5165\u624B\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5F02\u6B65\u91C7\u6837\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class AsyncSampler {\n    private final BlockingQueue<SamplingTask> taskQueue;\n    \n    public void sampleAsync(TraceContext context, Runnable samplingAction) {\n        SamplingTask task = new SamplingTask(context, samplingAction);\n        taskQueue.offer(task); // \u5F02\u6B65\u5904\u7406\uFF0C\u4E0D\u963B\u585E\u4E3B\u6D41\u7A0B\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6279\u91CF\u5BFC\u51FA\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class BatchExporter {\n    private final BlockingQueue<Span> spanQueue;\n    private final int batchSize;\n    \n    public void addSpan(Span span) {\n        spanQueue.offer(span);\n        if (spanQueue.size() >= batchSize) {\n            flushBatch(); // \u6279\u91CF\u5BFC\u51FA\uFF0C\u51CF\u5C11\u7F51\u7EDC\u5F00\u9500\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6570\u636E\u538B\u7F29\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class SpanCompressor {\n    public CompressedSpan compress(Span span) {\n        // \u538B\u7F29Span\u6570\u636E\uFF0C\u51CF\u5C11\u5B58\u50A8\u7A7A\u95F4\u548C\u4F20\u8F93\u5E26\u5BBD\n        Map<String, Integer> tagIndices = new HashMap<>();\n        // \u5C06\u91CD\u590D\u7684\u6807\u7B7E\u503C\u66FF\u6362\u4E3A\u7D22\u5F15\n        return new CompressedSpan(tagIndices, span.getStartTime(), span.getDuration());\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"43-\u67B6\u6784\u8BBE\u8BA1\u9762\u8BD5\u9898",children:"4.3 \u67B6\u6784\u8BBE\u8BA1\u9762\u8BD5\u9898"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q7: \u5982\u4F55\u8BBE\u8BA1\u4E00\u4E2A\u9AD8\u53EF\u7528\u7684\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u9AD8\u53EF\u7528\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u8BBE\u8BA1\u9700\u8981\u8003\u8651\u4EE5\u4E0B\u65B9\u9762\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5B58\u50A8\u5C42\u8BBE\u8BA1\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5206\u5E03\u5F0F\u5B58\u50A8"}),"\uFF1A\u4F7F\u7528Elasticsearch\u3001Cassandra\u7B49\u5206\u5E03\u5F0F\u5B58\u50A8\u7CFB\u7EDF"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6570\u636E\u5206\u7247"}),"\uFF1A\u6309\u65F6\u95F4\u6216TraceId\u8FDB\u884C\u6570\u636E\u5206\u7247\uFF0C\u63D0\u9AD8\u67E5\u8BE2\u6027\u80FD"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u526F\u672C\u673A\u5236"}),"\uFF1A\u914D\u7F6E\u9002\u5F53\u7684\u6570\u636E\u526F\u672C\uFF0C\u4FDD\u8BC1\u6570\u636E\u53EF\u9760\u6027"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"TTL\u7B56\u7565"}),"\uFF1A\u8BBE\u7F6E\u6570\u636E\u8FC7\u671F\u65F6\u95F4\uFF0C\u63A7\u5236\u5B58\u50A8\u6210\u672C"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u91C7\u96C6\u5C42\u8BBE\u8BA1\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u672C\u5730\u7F13\u51B2"}),"\uFF1A\u5728\u5E94\u7528\u672C\u5730\u7F13\u51B2Span\u6570\u636E\uFF0C\u907F\u514D\u7F51\u7EDC\u6296\u52A8\u5F71\u54CD"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u91CD\u8BD5\u673A\u5236"}),"\uFF1A\u5BF9\u5931\u8D25\u7684Span\u5BFC\u51FA\u8FDB\u884C\u91CD\u8BD5\uFF0C\u4FDD\u8BC1\u6570\u636E\u4E0D\u4E22\u5931"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u964D\u7EA7\u7B56\u7565"}),"\uFF1A\u5728\u7CFB\u7EDF\u538B\u529B\u5927\u65F6\uFF0C\u964D\u4F4E\u91C7\u6837\u7387\u6216\u6682\u505C\u91C7\u96C6"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u591A\u540E\u7AEF\u652F\u6301"}),"\uFF1A\u652F\u6301\u591A\u4E2A\u540E\u7AEF\u5B58\u50A8\uFF0C\u63D0\u9AD8\u7CFB\u7EDF\u53EF\u7528\u6027"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u67E5\u8BE2\u5C42\u8BBE\u8BA1\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7F13\u5B58\u673A\u5236"}),"\uFF1A\u5BF9\u70ED\u70B9\u67E5\u8BE2\u7ED3\u679C\u8FDB\u884C\u7F13\u5B58\uFF0C\u63D0\u9AD8\u67E5\u8BE2\u6027\u80FD"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7D22\u5F15\u4F18\u5316"}),"\uFF1A\u4E3A\u5E38\u7528\u67E5\u8BE2\u5B57\u6BB5\u5EFA\u7ACB\u7D22\u5F15\uFF0C\u52A0\u901F\u67E5\u8BE2"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5206\u9875\u67E5\u8BE2"}),"\uFF1A\u652F\u6301\u5206\u9875\u67E5\u8BE2\uFF0C\u907F\u514D\u5927\u91CF\u6570\u636E\u5F71\u54CD\u6027\u80FD"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u805A\u5408\u67E5\u8BE2"}),"\uFF1A\u652F\u6301\u6309\u65F6\u95F4\u3001\u670D\u52A1\u7B49\u7EF4\u5EA6\u8FDB\u884C\u805A\u5408\u67E5\u8BE2"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q8: \u5982\u4F55\u8BBE\u8BA1\u94FE\u8DEF\u8FFD\u8E2A\u7684\u91C7\u6837\u7B56\u7565\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u91C7\u6837\u7B56\u7565\u8BBE\u8BA1\u9700\u8981\u8003\u8651\u4E1A\u52A1\u573A\u666F\u548C\u7CFB\u7EDF\u6027\u80FD\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5206\u5C42\u91C7\u6837\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class LayeredSamplingStrategy {\n    // \u5173\u952E\u4E1A\u52A1100%\u91C7\u6837\n    public boolean shouldSampleCriticalBusiness(TraceContext context) {\n        return true;\n    }\n    \n    // \u4E00\u822C\u4E1A\u52A1\u6309\u6982\u7387\u91C7\u6837\n    public boolean shouldSampleNormalBusiness(TraceContext context) {\n        return random.nextDouble() < 0.1; // 10%\u91C7\u6837\u7387\n    }\n    \n    // \u9519\u8BEF\u8BF7\u6C42100%\u91C7\u6837\n    public boolean shouldSampleError(TraceContext context) {\n        return context.hasError();\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u52A8\u6001\u91C7\u6837\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class DynamicSamplingStrategy {\n    private final SystemLoadMonitor loadMonitor;\n    \n    public double getSamplingRate() {\n        double cpuUsage = loadMonitor.getCpuUsage();\n        if (cpuUsage > 80) {\n            return 0.01; // \u9AD8\u8D1F\u8F7D\u65F6\u964D\u4F4E\u91C7\u6837\u7387\n        } else if (cpuUsage > 60) {\n            return 0.05; // \u4E2D\u7B49\u8D1F\u8F7D\u65F6\u4E2D\u7B49\u91C7\u6837\u7387\n        } else {\n            return 0.1; // \u4F4E\u8D1F\u8F7D\u65F6\u9AD8\u91C7\u6837\u7387\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.h3,{id:"44-\u5B9E\u6218\u5E94\u7528\u9762\u8BD5\u9898",children:"4.4 \u5B9E\u6218\u5E94\u7528\u9762\u8BD5\u9898"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q9: \u5982\u4F55\u6392\u67E5\u4E00\u4E2A\u8DE8\u591A\u4E2A\u670D\u52A1\u7684\u6027\u80FD\u95EE\u9898\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u4F7F\u7528\u94FE\u8DEF\u8FFD\u8E2A\u6392\u67E5\u8DE8\u670D\u52A1\u6027\u80FD\u95EE\u9898\u7684\u6B65\u9AA4\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"1. \u5B9A\u4F4D\u95EE\u9898\u94FE\u8DEF\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'// \u6839\u636ETraceId\u67E5\u8BE2\u5B8C\u6574\u7684\u8C03\u7528\u94FE\u8DEF\nTrace trace = traceService.getTrace("trace-12345");\nList<Span> spans = trace.getSpans();\n\n// \u6309\u8017\u65F6\u6392\u5E8F\uFF0C\u627E\u51FA\u6700\u6162\u7684Span\nspans.sort((a, b) -> Long.compare(b.getDuration(), a.getDuration()));\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"2. \u5206\u6790\u6027\u80FD\u74F6\u9888\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"// \u8BA1\u7B97\u6BCF\u4E2A\u670D\u52A1\u7684\u6027\u80FD\u6307\u6807\nMap<String, PerformanceMetrics> serviceMetrics = new HashMap<>();\nfor (Span span : spans) {\n    String serviceName = span.getServiceName();\n    PerformanceMetrics metrics = serviceMetrics.computeIfAbsent(\n        serviceName, k -> new PerformanceMetrics());\n    metrics.addDuration(span.getDuration());\n    metrics.addCount();\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"3. \u8BC6\u522B\u5F02\u5E38\u6A21\u5F0F\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'// \u67E5\u627E\u5F02\u5E38Span\nList<Span> errorSpans = spans.stream()\n    .filter(span -> "ERROR".equals(span.getStatus()))\n    .collect(Collectors.toList());\n\n// \u5206\u6790\u9519\u8BEF\u4F20\u64AD\u8DEF\u5F84\nfor (Span errorSpan : errorSpans) {\n    String parentId = errorSpan.getParentSpanId();\n    // \u5411\u4E0A\u8FFD\u6EAF\u9519\u8BEF\u4F20\u64AD\u94FE\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"4. \u751F\u6210\u5206\u6790\u62A5\u544A\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'public String generatePerformanceReport(Trace trace) {\n    StringBuilder report = new StringBuilder();\n    report.append("=== \u6027\u80FD\u5206\u6790\u62A5\u544A ===\\n");\n    \n    // \u603B\u4F53\u7EDF\u8BA1\n    report.append("\u603B\u8017\u65F6: ").append(trace.getTotalDuration()).append("ms\\n");\n    report.append("Span\u6570\u91CF: ").append(trace.getSpanCount()).append("\\n");\n    \n    // \u670D\u52A1\u6027\u80FD\u6392\u540D\n    report.append("\u670D\u52A1\u6027\u80FD\u6392\u540D:\\n");\n    // \u6309\u5E73\u5747\u8017\u65F6\u6392\u5E8F\u663E\u793A\u5404\u670D\u52A1\u6027\u80FD\n    \n    // \u6027\u80FD\u74F6\u9888\n    report.append("\u6027\u80FD\u74F6\u9888:\\n");\n    // \u663E\u793A\u6700\u6162\u76843\u4E2ASpan\n    \n    return report.toString();\n}\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"Q10: \u5982\u4F55\u8BBE\u8BA1\u94FE\u8DEF\u8FFD\u8E2A\u7684\u544A\u8B66\u673A\u5236\uFF1F"})}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.strong,{children:"A:"})," \u94FE\u8DEF\u8FFD\u8E2A\u544A\u8B66\u673A\u5236\u8BBE\u8BA1\uFF1A"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u544A\u8B66\u89C4\u5219\u914D\u7F6E\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:"public class TracingAlertRule {\n    private String ruleName;\n    private String serviceName;\n    private String operationName;\n    private double threshold; // \u9608\u503C\uFF08\u6BEB\u79D2\uFF09\n    private double errorRateThreshold; // \u9519\u8BEF\u7387\u9608\u503C\n    private int windowSize; // \u65F6\u95F4\u7A97\u53E3\uFF08\u5206\u949F\uFF09\n    private String alertLevel; // \u544A\u8B66\u7EA7\u522B\n}\n\npublic class TracingAlertManager {\n    private final List<TracingAlertRule> rules;\n    private final AlertNotifier notifier;\n    \n    public void checkAlerts(List<Span> spans) {\n        for (TracingAlertRule rule : rules) {\n            // \u8FC7\u6EE4\u7B26\u5408\u6761\u4EF6\u7684Span\n            List<Span> filteredSpans = spans.stream()\n                .filter(span -> matchesRule(span, rule))\n                .collect(Collectors.toList());\n            \n            // \u8BA1\u7B97\u6307\u6807\n            double avgDuration = calculateAverageDuration(filteredSpans);\n            double errorRate = calculateErrorRate(filteredSpans);\n            \n            // \u68C0\u67E5\u544A\u8B66\u6761\u4EF6\n            if (avgDuration > rule.getThreshold() || errorRate > rule.getErrorRateThreshold()) {\n                sendAlert(rule, avgDuration, errorRate);\n            }\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u544A\u8B66\u901A\u77E5\uFF1A"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'public class AlertNotifier {\n    public void sendAlert(TracingAlertRule rule, double avgDuration, double errorRate) {\n        AlertMessage alert = new AlertMessage();\n        alert.setRuleName(rule.getRuleName());\n        alert.setServiceName(rule.getServiceName());\n        alert.setOperationName(rule.getOperationName());\n        alert.setAvgDuration(avgDuration);\n        alert.setErrorRate(errorRate);\n        alert.setThreshold(rule.getThreshold());\n        alert.setTimestamp(System.currentTimeMillis());\n        \n        // \u53D1\u9001\u544A\u8B66\u901A\u77E5\n        if ("CRITICAL".equals(rule.getAlertLevel())) {\n            sendSmsAlert(alert);\n            sendEmailAlert(alert);\n        } else if ("WARNING".equals(rule.getAlertLevel())) {\n            sendEmailAlert(alert);\n        }\n        \n        // \u8BB0\u5F55\u544A\u8B66\u65E5\u5FD7\n        logAlert(alert);\n    }\n}\n'})}),"\n",(0,a.jsx)(e.h2,{id:"5-\u603B\u7ED3\u4E0E\u5C55\u671B",children:"5. \u603B\u7ED3\u4E0E\u5C55\u671B"}),"\n",(0,a.jsx)(e.h3,{id:"51-\u6280\u672F\u53D1\u5C55\u8D8B\u52BF",children:"5.1 \u6280\u672F\u53D1\u5C55\u8D8B\u52BF"}),"\n",(0,a.jsx)(e.p,{children:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u6280\u672F\u6B63\u5728\u5FEB\u901F\u53D1\u5C55\uFF0C\u672A\u6765\u5C06\u5448\u73B0\u4EE5\u4E0B\u8D8B\u52BF\uFF1A"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6807\u51C6\u5316\u8D8B\u52BF\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"OpenTelemetry"}),"\uFF1A\u5C06\u6210\u4E3A\u94FE\u8DEF\u8FFD\u8E2A\u7684\u6807\u51C6\uFF0C\u7EDF\u4E00\u4E0D\u540C\u5382\u5546\u7684\u5B9E\u73B0"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"W3C Trace Context"}),"\uFF1AHTTP\u5934\u90E8\u6807\u51C6\u5316\uFF0C\u63D0\u9AD8\u8DE8\u5E73\u53F0\u517C\u5BB9\u6027"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"OTLP\u534F\u8BAE"}),"\uFF1A\u7EDF\u4E00\u7684\u4F20\u8F93\u534F\u8BAE\uFF0C\u7B80\u5316\u7CFB\u7EDF\u96C6\u6210"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u667A\u80FD\u5316\u8D8B\u52BF\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"AI\u5206\u6790"}),"\uFF1A\u4F7F\u7528\u673A\u5668\u5B66\u4E60\u81EA\u52A8\u8BC6\u522B\u6027\u80FD\u74F6\u9888\u548C\u5F02\u5E38\u6A21\u5F0F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u667A\u80FD\u91C7\u6837"}),"\uFF1A\u6839\u636E\u4E1A\u52A1\u91CD\u8981\u6027\u81EA\u52A8\u8C03\u6574\u91C7\u6837\u7B56\u7565"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u9884\u6D4B\u544A\u8B66"}),"\uFF1A\u57FA\u4E8E\u5386\u53F2\u6570\u636E\u9884\u6D4B\u6F5C\u5728\u95EE\u9898\uFF0C\u63D0\u524D\u544A\u8B66"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u4E91\u539F\u751F\u8D8B\u52BF\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Kubernetes\u96C6\u6210"}),"\uFF1A\u6DF1\u5EA6\u96C6\u6210K8s\uFF0C\u63D0\u4F9BPod\u7EA7\u522B\u7684\u8FFD\u8E2A"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Service Mesh"}),"\uFF1A\u4E0EIstio\u3001Linkerd\u7B49Service Mesh\u6DF1\u5EA6\u96C6\u6210"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Serverless\u652F\u6301"}),"\uFF1A\u652F\u6301FaaS\u73AF\u5883\u7684\u94FE\u8DEF\u8FFD\u8E2A"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5B9E\u65F6\u5316\u8D8B\u52BF\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B9E\u65F6\u5206\u6790"}),"\uFF1A\u652F\u6301\u5B9E\u65F6\u94FE\u8DEF\u5206\u6790\u548C\u544A\u8B66"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6D41\u5F0F\u5904\u7406"}),"\uFF1A\u4F7F\u7528Kafka Streams\u7B49\u6D41\u5904\u7406\u6280\u672F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B9E\u65F6\u53EF\u89C6\u5316"}),"\uFF1A\u63D0\u4F9B\u5B9E\u65F6\u7684\u94FE\u8DEF\u53EF\u89C6\u5316\u754C\u9762"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u53EF\u89C2\u6D4B\u6027\u7EDF\u4E00\uFF1A"})}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u4E09\u4F4D\u4E00\u4F53"}),"\uFF1A\u94FE\u8DEF\u8FFD\u8E2A\u3001\u6307\u6807\u76D1\u63A7\u3001\u65E5\u5FD7\u5206\u6790\u7684\u7EDF\u4E00\u5E73\u53F0"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5173\u8054\u5206\u6790"}),"\uFF1A\u5C06\u4E09\u79CD\u6570\u636E\u6E90\u5173\u8054\u5206\u6790\uFF0C\u63D0\u4F9B\u5B8C\u6574\u89C6\u89D2"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7EDF\u4E00\u67E5\u8BE2"}),"\uFF1A\u652F\u6301\u8DE8\u6570\u636E\u6E90\u7684\u7EDF\u4E00\u67E5\u8BE2\u8BED\u8A00"]}),"\n"]}),"\n",(0,a.jsx)(e.h3,{id:"52-\u6700\u4F73\u5B9E\u8DF5\u5EFA\u8BAE",children:"5.2 \u6700\u4F73\u5B9E\u8DF5\u5EFA\u8BAE"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u5B9E\u65BD\u7B56\u7565\uFF1A"})}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6E10\u8FDB\u5F0F\u5B9E\u65BD"}),"\uFF1A\u4ECE\u6838\u5FC3\u4E1A\u52A1\u5F00\u59CB\uFF0C\u9010\u6B65\u6269\u5C55\u5230\u5168\u7CFB\u7EDF"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6807\u51C6\u5316\u5148\u884C"}),"\uFF1A\u4F18\u5148\u91C7\u7528OpenTelemetry\u7B49\u6807\u51C6\u5B9E\u73B0"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5148"}),"\uFF1A\u786E\u4FDD\u94FE\u8DEF\u8FFD\u8E2A\u4E0D\u5F71\u54CD\u4E1A\u52A1\u6027\u80FD"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6570\u636E\u9A71\u52A8"}),"\uFF1A\u57FA\u4E8E\u5B9E\u9645\u6570\u636E\u4F18\u5316\u914D\u7F6E\u548C\u7B56\u7565"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6280\u672F\u9009\u62E9\uFF1A"})}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F00\u6E90\u4F18\u5148"}),"\uFF1A\u4F18\u5148\u9009\u62E9\u6210\u719F\u7684\u5F00\u6E90\u89E3\u51B3\u65B9\u6848"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u4E91\u539F\u751F\u53CB\u597D"}),"\uFF1A\u9009\u62E9\u652F\u6301\u4E91\u539F\u751F\u67B6\u6784\u7684\u6280\u672F\u6808"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u751F\u6001\u4E30\u5BCC"}),"\uFF1A\u9009\u62E9\u751F\u6001\u4E30\u5BCC\u3001\u793E\u533A\u6D3B\u8DC3\u7684\u6280\u672F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6210\u672C\u53EF\u63A7"}),"\uFF1A\u8003\u8651\u603B\u4F53\u62E5\u6709\u6210\u672C\uFF08TCO\uFF09"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5316\uFF1A"})}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u91C7\u6837\u7B56\u7565"}),"\uFF1A\u6839\u636E\u4E1A\u52A1\u573A\u666F\u5236\u5B9A\u5408\u7406\u7684\u91C7\u6837\u7B56\u7565"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F02\u6B65\u5904\u7406"}),"\uFF1A\u91C7\u6837\u548C\u5BFC\u51FA\u90FD\u91C7\u7528\u5F02\u6B65\u65B9\u5F0F"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6279\u91CF\u64CD\u4F5C"}),"\uFF1A\u4F7F\u7528\u6279\u91CF\u5BFC\u51FA\u51CF\u5C11\u7F51\u7EDC\u5F00\u9500"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7F13\u5B58\u673A\u5236"}),"\uFF1A\u5BF9\u91CD\u590D\u8BA1\u7B97\u8FDB\u884C\u7F13\u5B58"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u8FD0\u7EF4\u7BA1\u7406\uFF1A"})}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u76D1\u63A7\u544A\u8B66"}),"\uFF1A\u5BF9\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\u672C\u8EAB\u8FDB\u884C\u76D1\u63A7"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5BB9\u91CF\u89C4\u5212"}),"\uFF1A\u6839\u636E\u4E1A\u52A1\u589E\u957F\u89C4\u5212\u5B58\u50A8\u5BB9\u91CF"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6570\u636E\u6CBB\u7406"}),"\uFF1A\u5236\u5B9A\u6570\u636E\u4FDD\u7559\u548C\u6E05\u7406\u7B56\u7565"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B89\u5168\u63A7\u5236"}),"\uFF1A\u63A7\u5236\u654F\u611F\u6570\u636E\u7684\u8BBF\u95EE\u548C\u4F20\u8F93"]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.strong,{children:"\u6301\u7EED\u6539\u8FDB\uFF1A"})}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B9A\u671F\u8BC4\u4F30"}),"\uFF1A\u5B9A\u671F\u8BC4\u4F30\u94FE\u8DEF\u8FFD\u8E2A\u7684\u6548\u679C\u548C\u4EF7\u503C"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7528\u6237\u53CD\u9988"}),"\uFF1A\u6536\u96C6\u7528\u6237\u53CD\u9988\uFF0C\u6301\u7EED\u4F18\u5316\u4F53\u9A8C"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6280\u672F\u66F4\u65B0"}),"\uFF1A\u5173\u6CE8\u65B0\u6280\u672F\u53D1\u5C55\uFF0C\u53CA\u65F6\u5347\u7EA7"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A\u603B\u7ED3\u548C\u5206\u4EAB\u6700\u4F73\u5B9E\u8DF5"]}),"\n"]}),"\n",(0,a.jsx)(e.admonition,{title:"\u5B66\u4E60\u5EFA\u8BAE",type:"info",children:(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u7406\u8BBA\u57FA\u7840"}),"\uFF1A\u6DF1\u5165\u7406\u89E3\u5206\u5E03\u5F0F\u7CFB\u7EDF\u3001\u7F51\u7EDC\u534F\u8BAE\u3001\u6570\u636E\u5B58\u50A8\u7B49\u57FA\u7840\u77E5\u8BC6"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5B9E\u8DF5\u9879\u76EE"}),"\uFF1A\u642D\u5EFA\u5B8C\u6574\u7684\u94FE\u8DEF\u8FFD\u8E2A\u7CFB\u7EDF\uFF0C\u8FDB\u884C\u5B9E\u9645\u6D4B\u8BD5"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u5F00\u6E90\u8D21\u732E"}),"\uFF1A\u53C2\u4E0EOpenTelemetry\u7B49\u5F00\u6E90\u9879\u76EE\uFF0C\u4E86\u89E3\u6700\u65B0\u53D1\u5C55"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u793E\u533A\u4EA4\u6D41"}),"\uFF1A\u53C2\u52A0\u6280\u672F\u4F1A\u8BAE\u548C\u793E\u533A\u6D3B\u52A8\uFF0C\u4E0E\u540C\u884C\u4EA4\u6D41\u7ECF\u9A8C"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"\u6301\u7EED\u5B66\u4E60"}),"\uFF1A\u5173\u6CE8\u884C\u4E1A\u52A8\u6001\u548C\u6280\u672F\u8D8B\u52BF\uFF0C\u4FDD\u6301\u5B66\u4E60\u70ED\u60C5"]}),"\n"]})}),"\n",(0,a.jsx)(e.h3,{id:"\u7ED3\u8BBA",children:"\u7ED3\u8BBA"}),"\n",(0,a.jsx)(e.p,{children:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A\u6280\u672F\u5DF2\u7ECF\u6210\u4E3A\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u4E0D\u53EF\u6216\u7F3A\u7684\u7EC4\u6210\u90E8\u5206\u3002\u5B83\u4E0D\u4EC5\u80FD\u591F\u5E2E\u52A9\u6211\u4EEC\u5FEB\u901F\u5B9A\u4F4D\u95EE\u9898\u3001\u5206\u6790\u6027\u80FD\u74F6\u9888\uFF0C\u8FD8\u80FD\u63D0\u4F9B\u4E1A\u52A1\u6D1E\u5BDF\u548C\u5BB9\u91CF\u89C4\u5212\u7684\u4F9D\u636E\u3002\u968F\u7740\u6280\u672F\u7684\u4E0D\u65AD\u53D1\u5C55\u548C\u6807\u51C6\u5316\u8FDB\u7A0B\u7684\u63A8\u8FDB\uFF0C\u94FE\u8DEF\u8FFD\u8E2A\u5C06\u5728\u53EF\u89C2\u6D4B\u6027\u9886\u57DF\u53D1\u6325\u8D8A\u6765\u8D8A\u91CD\u8981\u7684\u4F5C\u7528\u3002"}),"\n",(0,a.jsx)(e.p,{children:"\u5BF9\u4E8E\u5F00\u53D1\u8005\u548C\u67B6\u6784\u5E08\u6765\u8BF4\uFF0C\u638C\u63E1\u94FE\u8DEF\u8FFD\u8E2A\u6280\u672F\u4E0D\u4EC5\u80FD\u591F\u63D0\u5347\u7CFB\u7EDF\u7684\u53EF\u89C2\u6D4B\u6027\uFF0C\u8FD8\u80FD\u591F\u63D0\u9AD8\u95EE\u9898\u6392\u67E5\u7684\u6548\u7387\uFF0C\u964D\u4F4E\u8FD0\u7EF4\u6210\u672C\u3002\u901A\u8FC7\u5408\u7406\u7684\u8BBE\u8BA1\u548C\u5B9E\u65BD\uFF0C\u94FE\u8DEF\u8FFD\u8E2A\u5C06\u6210\u4E3A\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\u7684\u5F3A\u5927\u5DE5\u5177\uFF0C\u4E3A\u4E1A\u52A1\u53D1\u5C55\u63D0\u4F9B\u6709\u529B\u652F\u6491\u3002"}),"\n",(0,a.jsx)(e.p,{children:"\u5728\u672A\u6765\u7684\u5FAE\u670D\u52A1\u67B6\u6784\u4E2D\uFF0C\u94FE\u8DEF\u8FFD\u8E2A\u5C06\u4E0E\u6307\u6807\u76D1\u63A7\u3001\u65E5\u5FD7\u5206\u6790\u4E00\u8D77\uFF0C\u6784\u6210\u5B8C\u6574\u7684\u53EF\u89C2\u6D4B\u6027\u4F53\u7CFB\uFF0C\u4E3A\u7CFB\u7EDF\u7684\u7A33\u5B9A\u8FD0\u884C\u548C\u6301\u7EED\u4F18\u5316\u63D0\u4F9B\u5168\u9762\u7684\u6570\u636E\u652F\u6491\u3002\u53EA\u6709\u6DF1\u5165\u7406\u89E3\u5E76\u6B63\u786E\u5E94\u7528\u8FD9\u4E9B\u6280\u672F\uFF0C\u624D\u80FD\u5728\u5FAE\u670D\u52A1\u67B6\u6784\u7684\u590D\u6742\u73AF\u5883\u4E2D\u6E38\u5203\u6709\u4F59\uFF0C\u6784\u5EFA\u51FA\u9AD8\u6027\u80FD\u3001\u9AD8\u53EF\u7528\u7684\u5206\u5E03\u5F0F\u7CFB\u7EDF\u3002"})]})}function d(n={}){let{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(p,{...n})}):p(n)}},28453:function(n,e,t){t.d(e,{R:()=>s,x:()=>c});var r=t(96540);let a={},i=r.createContext(a);function s(n){let e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);