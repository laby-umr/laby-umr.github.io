---
sidebar_position: 3
title: Angularè·¯ç”±ä¸å¯¼èˆª
description: Angularè·¯ç”±ç³»ç»Ÿè¯¦è§£ï¼ŒåŒ…æ‹¬è·¯ç”±é…ç½®ã€æ‡’åŠ è½½ã€å®ˆå«ä¸æœ€ä½³å®è·µ
authors: [Laby]
tags: [Angular, è·¯ç”±, å¯¼èˆª, æ‡’åŠ è½½, è·¯ç”±å®ˆå«]
last_update:
  date: 2025-08-15
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# Angularè·¯ç”±ä¸å¯¼èˆª

Angularè·¯ç”±ç³»ç»Ÿå…è®¸åœ¨ç”¨æˆ·å¯¼èˆªåº”ç”¨ç¨‹åºçš„ä¸åŒè§†å›¾ä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå®ƒæ”¯æŒè·¯ç”±å‚æ•°ã€åµŒå¥—è·¯ç”±ã€è·¯ç”±å®ˆå«å’Œå»¶è¿ŸåŠ è½½ç­‰é«˜çº§åŠŸèƒ½ã€‚

:::tip æ ¸å¿ƒä»·å€¼
**Angularè·¯ç”±ä¼˜åŠ¿**
- ğŸ§­ **å•é¡µé¢åº”ç”¨**ï¼šæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢å³å¯åˆ‡æ¢è§†å›¾
- ğŸ”— **URLç®¡ç†**ï¼šæä¾›æ¸…æ™°å¯å…±äº«çš„URLï¼Œæ”¯æŒä¹¦ç­¾å’Œå†å²
- ğŸ§© **æ¨¡å—åŒ–è·¯ç”±**ï¼šæ”¯æŒç‰¹æ€§æ¨¡å—çš„è·¯ç”±åˆ†ç¦»
- ğŸ”„ **å»¶è¿ŸåŠ è½½**ï¼šæŒ‰éœ€åŠ è½½æ¨¡å—ï¼Œæå‡åˆå§‹åŠ è½½æ€§èƒ½
- ğŸ›¡ï¸ **è·¯ç”±å®ˆå«**ï¼šä¿æŠ¤è·¯ç”±ï¼Œå®ç°æƒé™æ§åˆ¶
:::

## 1. è·¯ç”±åŸºç¡€

### 1.1 é…ç½®è·¯ç”±

åœ¨Angularåº”ç”¨ä¸­é…ç½®è·¯ç”±éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

1. åˆ›å»ºè·¯ç”±æ¨¡å—ï¼š

```typescript title="app-routing.module.ts"
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';

import { HomeComponent } from './home/home.component';
import { AboutComponent } from './about/about.component';
import { ContactComponent } from './contact/contact.component';
import { NotFoundComponent } from './not-found/not-found.component';

const routes: Routes = [
  { path: '', component: HomeComponent },
  { path: 'home', redirectTo: '', pathMatch: 'full' },
  { path: 'about', component: AboutComponent },
  { path: 'contact', component: ContactComponent },
  { path: '**', component: NotFoundComponent }  // é€šé…ç¬¦è·¯ç”±å¿…é¡»æ”¾åœ¨æœ€å
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }
```

2. åœ¨ä¸»æ¨¡å—ä¸­å¯¼å…¥è·¯ç”±æ¨¡å—ï¼š

```typescript title="app.module.ts"
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
// å¯¼å…¥ç»„ä»¶
import { HomeComponent } from './home/home.component';
import { AboutComponent } from './about/about.component';
import { ContactComponent } from './contact/contact.component';
import { NotFoundComponent } from './not-found/not-found.component';

@NgModule({
  declarations: [
    AppComponent,
    HomeComponent,
    AboutComponent,
    ContactComponent,
    NotFoundComponent
  ],
  imports: [
    BrowserModule,
    AppRoutingModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }
```

3. æ·»åŠ è·¯ç”±å‡ºå£å’Œå¯¼èˆªé“¾æ¥ï¼š

```html title="app.component.html"
<header>
  <nav>
    <ul>
      <li><a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">é¦–é¡µ</a></li>
      <li><a routerLink="/about" routerLinkActive="active">å…³äºæˆ‘ä»¬</a></li>
      <li><a routerLink="/contact" routerLinkActive="active">è”ç³»æˆ‘ä»¬</a></li>
    </ul>
  </nav>
</header>

<main>
  <!-- è·¯ç”±å‡ºå£ - åŒ¹é…çš„ç»„ä»¶å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
  <router-outlet></router-outlet>
</main>

<footer>
  <p>Â© 2025 Angularè·¯ç”±ç¤ºä¾‹</p>
</footer>
```

### 1.2 è·¯ç”±é…ç½®é€‰é¡¹

Angularè·¯ç”±æ”¯æŒå¤šç§é…ç½®é€‰é¡¹ï¼š

```typescript
const routes: Routes = [
  { 
    path: 'products', 
    component: ProductListComponent,
    children: [                              // åµŒå¥—è·¯ç”±
      { 
        path: ':id', 
        component: ProductDetailComponent 
      }
    ],
    canActivate: [AuthGuard],                // è·¯ç”±å®ˆå«
    data: { title: 'äº§å“åˆ—è¡¨', permissions: ['view-products'] },  // è·¯ç”±æ•°æ®
    resolve: {                               // é¢„å…ˆè§£ææ•°æ®
      products: ProductsResolver
    }
  },
  { 
    path: 'admin', 
    loadChildren: () => import('./admin/admin.module')
      .then(m => m.AdminModule)              // æ‡’åŠ è½½æ¨¡å—
  }
];
```

### 1.3 Routerç›¸å…³æŒ‡ä»¤

Angularè·¯ç”±ç³»ç»Ÿæä¾›äº†å‡ ä¸ªé‡è¦çš„æŒ‡ä»¤ï¼š

1. **RouterOutlet**: `<router-outlet></router-outlet>` - æ˜¾ç¤ºåŒ¹é…çš„ç»„ä»¶
2. **RouterLink**: `<a routerLink="/path">` - å£°æ˜å¼å¯¼èˆªé“¾æ¥
3. **RouterLinkActive**: `<a routerLinkActive="active">` - å½“é“¾æ¥æ¿€æ´»æ—¶åº”ç”¨çš„CSSç±»
4. **RouterLinkActiveOptions**: `[routerLinkActiveOptions]="{exact: true}"` - é…ç½®æ¿€æ´»è¡Œä¸º

### 1.4 ç¨‹åºå¼å¯¼èˆª

é™¤äº†ä½¿ç”¨æŒ‡ä»¤è¿›è¡Œå¯¼èˆªå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡RouteræœåŠ¡è¿›è¡Œç¨‹åºå¼å¯¼èˆªï¼š

```typescript
import { Component } from '@angular/core';
import { Router, ActivatedRoute } from '@angular/router';

@Component({
  selector: 'app-navigation-demo',
  template: `
    <button (click)="goToProducts()">æŸ¥çœ‹äº§å“</button>
    <button (click)="goToProductDetail(123)">æŸ¥çœ‹äº§å“è¯¦æƒ…</button>
    <button (click)="goBack()">è¿”å›</button>
  `
})
export class NavigationDemoComponent {
  constructor(
    private router: Router,
    private route: ActivatedRoute
  ) {}
  
  goToProducts() {
    this.router.navigate(['/products']);
  }
  
  goToProductDetail(id: number) {
    // ç›¸å¯¹äºå½“å‰è·¯ç”±çš„å¯¼èˆª
    this.router.navigate([id], { relativeTo: this.route });
    
    // æˆ–ä½¿ç”¨ç»å¯¹è·¯å¾„
    // this.router.navigate(['/products', id]);
  }
  
  goToProductWithQueryParams(category: string) {
    this.router.navigate(['/products'], { 
      queryParams: { category: category },
      queryParamsHandling: 'merge' // åˆå¹¶ç°æœ‰æŸ¥è¯¢å‚æ•°
    });
  }
  
  goBack() {
    window.history.back();
  }
}
```

## 2. è·¯ç”±å‚æ•°ä¸æ•°æ®ä¼ é€’

### 2.1 è·¯ç”±å‚æ•°

Angularè·¯ç”±æ”¯æŒä¸‰ç§å‚æ•°ä¼ é€’æ–¹å¼ï¼š

1. **è·¯å¾„å‚æ•°**ï¼šä½œä¸ºURLè·¯å¾„çš„ä¸€éƒ¨åˆ†
2. **æŸ¥è¯¢å‚æ•°**ï¼šä½œä¸ºURLæŸ¥è¯¢å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†
3. **è·¯ç”±æ•°æ®**ï¼šåœ¨è·¯ç”±é…ç½®ä¸­å®šä¹‰çš„é™æ€æ•°æ®

#### è·¯å¾„å‚æ•°ç¤ºä¾‹

```typescript title="app-routing.module.ts"
const routes: Routes = [
  { 
    path: 'products/:id', 
    component: ProductDetailComponent 
  }
];
```

```typescript title="product-detail.component.ts"
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, ParamMap } from '@angular/router';
import { switchMap } from 'rxjs/operators';
import { ProductService } from '../services/product.service';
import { Observable } from 'rxjs';
import { Product } from '../models/product.model';

@Component({
  selector: 'app-product-detail',
  template: `
    <div *ngIf="product$ | async as product; else loading">
      <h2>{{ product.name }}</h2>
      <p>{{ product.description }}</p>
      <p>ä»·æ ¼: {{ product.price | currency:'CNY' }}</p>
    </div>
    <ng-template #loading>åŠ è½½ä¸­...</ng-template>
  `
})
export class ProductDetailComponent implements OnInit {
  product$: Observable<Product>;
  
  constructor(
    private route: ActivatedRoute,
    private productService: ProductService
  ) {}
  
  ngOnInit() {
    // æ–¹å¼1ï¼šä½¿ç”¨å¿«ç…§ï¼ˆä»…é€‚ç”¨äºç»„ä»¶ä¸ä¼šé‡ç”¨çš„æƒ…å†µï¼‰
    // const id = this.route.snapshot.paramMap.get('id');
    // this.product$ = this.productService.getProduct(id);
    
    // æ–¹å¼2ï¼šä½¿ç”¨å¯è§‚å¯Ÿå¯¹è±¡ï¼ˆé€‚ç”¨äºç»„ä»¶é‡ç”¨çš„æƒ…å†µï¼‰
    this.product$ = this.route.paramMap.pipe(
      switchMap((params: ParamMap) => {
        const id = params.get('id');
        return this.productService.getProduct(id);
      })
    );
  }
}
```

#### æŸ¥è¯¢å‚æ•°ç¤ºä¾‹

```typescript title="product-list.component.ts"
import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { ProductService } from '../services/product.service';
import { Product } from '../models/product.model';

@Component({
  selector: 'app-product-list',
  template: `
    <div class="filters">
      <button (click)="filterByCategory('electronics')">ç”µå­äº§å“</button>
      <button (click)="filterByCategory('clothing')">æœè£…</button>
      <button (click)="filterByCategory('books')">å›¾ä¹¦</button>
      <button (click)="clearFilters()">æ¸…é™¤ç­›é€‰</button>
    </div>
    
    <div class="product-list">
      <div *ngFor="let product of products" class="product-item">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description }}</p>
        <p>{{ product.price | currency:'CNY' }}</p>
        <button (click)="viewDetails(product.id)">æŸ¥çœ‹è¯¦æƒ…</button>
      </div>
    </div>
  `
})
export class ProductListComponent implements OnInit {
  products: Product[] = [];
  
  constructor(
    private route: ActivatedRoute,
    private router: Router,
    private productService: ProductService
  ) {}
  
  ngOnInit() {
    this.route.queryParams.subscribe(params => {
      const category = params['category'];
      if (category) {
        this.loadProductsByCategory(category);
      } else {
        this.loadAllProducts();
      }
    });
  }
  
  filterByCategory(category: string) {
    this.router.navigate([], {
      relativeTo: this.route,
      queryParams: { category: category },
      queryParamsHandling: 'merge'
    });
  }
  
  clearFilters() {
    this.router.navigate([], {
      relativeTo: this.route,
      queryParams: {}
    });
  }
  
  viewDetails(id: string) {
    this.router.navigate(['/products', id]);
  }
  
  private loadAllProducts() {
    this.productService.getProducts().subscribe(products => {
      this.products = products;
    });
  }
  
  private loadProductsByCategory(category: string) {
    this.productService.getProductsByCategory(category).subscribe(products => {
      this.products = products;
    });
  }
}
```

#### è·¯ç”±æ•°æ®ç¤ºä¾‹

```typescript title="app-routing.module.ts"
const routes: Routes = [
  { 
    path: 'products', 
    component: ProductListComponent,
    data: { 
      title: 'äº§å“åˆ—è¡¨', 
      breadcrumb: 'äº§å“',
      permissions: ['view-products']
    }
  }
];
```

```typescript title="product-list.component.ts"
ngOnInit() {
  // è®¿é—®é™æ€è·¯ç”±æ•°æ®
  this.route.data.subscribe(data => {
    this.pageTitle = data['title'];
    document.title = this.pageTitle; // æ›´æ–°é¡µé¢æ ‡é¢˜
    
    // æ£€æŸ¥æƒé™
    const permissions = data['permissions'];
    this.canEdit = this.authService.hasPermissions(permissions);
  });
}
```

### 2.2 è·¯ç”±è§£æå™¨(Resolver)

è·¯ç”±è§£æå™¨å…è®¸åœ¨æ¿€æ´»è·¯ç”±ä¹‹å‰è·å–æ•°æ®ï¼Œé¿å…åœ¨ç»„ä»¶åŠ è½½åæ˜¾ç¤ºç©ºç™½çŠ¶æ€æˆ–åŠ è½½æŒ‡ç¤ºå™¨ï¼š

```typescript title="product-resolver.service.ts"
import { Injectable } from '@angular/core';
import { Resolve, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';
import { Observable, of } from 'rxjs';
import { catchError } from 'rxjs/operators';
import { ProductService } from './product.service';
import { Product } from '../models/product.model';

@Injectable({
  providedIn: 'root'
})
export class ProductResolver implements Resolve<Product> {
  constructor(private productService: ProductService) {}
  
  resolve(
    route: ActivatedRouteSnapshot,
    state: RouterStateSnapshot
  ): Observable<Product> {
    const id = route.paramMap.get('id');
    return this.productService.getProduct(id).pipe(
      catchError(error => {
        console.error('äº§å“æ•°æ®è·å–å¤±è´¥', error);
        // è¿”å›é»˜è®¤äº§å“æˆ–ç©ºå¯¹è±¡
        return of({ id: null, name: 'æœªæ‰¾åˆ°äº§å“', description: '', price: 0 });
      })
    );
  }
}
```

```typescript title="app-routing.module.ts"
const routes: Routes = [
  { 
    path: 'products/:id', 
    component: ProductDetailComponent,
    resolve: {
      product: ProductResolver
    }
  }
];
```

```typescript title="product-detail.component.ts"
ngOnInit() {
  // ä½¿ç”¨è§£æå™¨æä¾›çš„æ•°æ®ï¼Œæ— éœ€ç­‰å¾…
  this.route.data.subscribe(data => {
    this.product = data['product'];
  });
}
```

## 3. åµŒå¥—è·¯ç”±ä¸å­è·¯ç”±

### 3.1 åµŒå¥—è·¯ç”±é…ç½®

åµŒå¥—è·¯ç”±å…è®¸åˆ›å»ºæ›´å¤æ‚çš„åº”ç”¨ç¨‹åºç»“æ„ï¼Œå…¶ä¸­å­è·¯ç”±ä¸çˆ¶è·¯ç”±ç›¸å…³ï¼š

```typescript title="app-routing.module.ts"
const routes: Routes = [
  { 
    path: 'admin', 
    component: AdminComponent,
    children: [
      { path: '', redirectTo: 'dashboard', pathMatch: 'full' },
      { path: 'dashboard', component: AdminDashboardComponent },
      { path: 'users', component: UserManagementComponent },
      { path: 'products', component: ProductManagementComponent }
    ]
  }
];
```

```html title="admin.component.html"
<div class="admin-layout">
  <aside class="sidebar">
    <nav>
      <ul>
        <li><a routerLink="/admin/dashboard" routerLinkActive="active">ä»ªè¡¨ç›˜</a></li>
        <li><a routerLink="/admin/users" routerLinkActive="active">ç”¨æˆ·ç®¡ç†</a></li>
        <li><a routerLink="/admin/products" routerLinkActive="active">äº§å“ç®¡ç†</a></li>
      </ul>
    </nav>
  </aside>
  
  <main class="content">
    <!-- å­è·¯ç”±å°†åœ¨è¿™é‡Œæ¸²æŸ“ -->
    <router-outlet></router-outlet>
  </main>
</div>
```

### 3.2 å‘½åè·¯ç”±å‡ºå£

Angularæ”¯æŒå¤šä¸ªå‘½åçš„è·¯ç”±å‡ºå£ï¼Œå…è®¸åœ¨åŒä¸€è§†å›¾ä¸­åŒæ—¶æ˜¾ç¤ºå¤šä¸ªè·¯ç”±ç»„ä»¶ï¼š

```typescript title="app-routing.module.ts"
const routes: Routes = [
  {
    path: 'workspace',
    component: WorkspaceComponent,
    children: [
      { 
        path: ':id',
        component: WorkspaceContentComponent,
        children: [
          { path: '', component: WorkspaceDetailComponent, outlet: 'detail' },
          { path: '', component: WorkspacePropertiesComponent, outlet: 'properties' }
        ]
      }
    ]
  }
];
```

```html title="workspace.component.html"
<div class="workspace-layout">
  <aside class="sidebar">
    <app-workspace-list></app-workspace-list>
  </aside>
  
  <main class="main-content">
    <!-- ä¸»è·¯ç”±å‡ºå£ -->
    <router-outlet></router-outlet>
  </main>
</div>
```

```html title="workspace-content.component.html"
<div class="content-container">
  <div class="detail-panel">
    <!-- å‘½åä¸º"detail"çš„è·¯ç”±å‡ºå£ -->
    <router-outlet name="detail"></router-outlet>
  </div>
  
  <div class="properties-panel">
    <!-- å‘½åä¸º"properties"çš„è·¯ç”±å‡ºå£ -->
    <router-outlet name="properties"></router-outlet>
  </div>
</div>
```

### 3.3 ç›¸å¯¹å¯¼èˆª

åœ¨åµŒå¥—è·¯ç”±ç»“æ„ä¸­ï¼Œç›¸å¯¹å¯¼èˆªéå¸¸æœ‰ç”¨ï¼š

```typescript
// å¯¼èˆªåˆ°å½“å‰è·¯ç”±çš„å­è·¯ç”±
this.router.navigate(['child'], { relativeTo: this.route });

// å¯¼èˆªåˆ°çˆ¶è·¯ç”±
this.router.navigate(['../'], { relativeTo: this.route });

// å¯¼èˆªåˆ°å…„å¼Ÿè·¯ç”±
this.router.navigate(['../sibling'], { relativeTo: this.route });
```

## 4. è·¯ç”±å®ˆå«

è·¯ç”±å®ˆå«æ˜¯æ‹¦æˆªå¯¼èˆªè¿‡ç¨‹å¹¶å†³å®šæ˜¯å¦å…è®¸å¯¼èˆªç»§ç»­çš„æœåŠ¡ã€‚Angularæä¾›äº†å¤šç§ç±»å‹çš„å®ˆå«ï¼š

### 4.1 CanActivateå®ˆå«

æ§åˆ¶æ˜¯å¦å¯ä»¥è®¿é—®è·¯ç”±ï¼š

```typescript title="auth.guard.ts"
import { Injectable } from '@angular/core';
import { CanActivate, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree, Router } from '@angular/router';
import { Observable } from 'rxjs';
import { AuthService } from './auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {
  constructor(private authService: AuthService, private router: Router) {}
  
  canActivate(
    route: ActivatedRouteSnapshot,
    state: RouterStateSnapshot
  ): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    if (this.authService.isLoggedIn()) {
      // æ£€æŸ¥ç‰¹å®šæƒé™
      const requiredPermissions = route.data['permissions'] as string[];
      if (requiredPermissions && !this.authService.hasPermissions(requiredPermissions)) {
        // é‡å®šå‘åˆ°æƒé™ä¸è¶³é¡µé¢
        return this.router.createUrlTree(['/forbidden']);
      }
      
      return true;
    }
    
    // ä¿å­˜åŸå§‹URLï¼Œç™»å½•åé‡å®šå‘å›æ¥
    return this.router.createUrlTree(['/login'], { 
      queryParams: { returnUrl: state.url } 
    });
  }
}
```

### 4.2 CanActivateChildå®ˆå«

æ§åˆ¶æ˜¯å¦å¯ä»¥è®¿é—®å­è·¯ç”±ï¼š

```typescript title="admin.guard.ts"
import { Injectable } from '@angular/core';
import { CanActivateChild, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree, Router } from '@angular/router';
import { Observable } from 'rxjs';
import { AuthService } from './auth.service';

@Injectable({
  providedIn: 'root'
})
export class AdminGuard implements CanActivateChild {
  constructor(private authService: AuthService, private router: Router) {}
  
  canActivateChild(
    childRoute: ActivatedRouteSnapshot,
    state: RouterStateSnapshot
  ): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    if (this.authService.isAdmin()) {
      return true;
    }
    
    return this.router.createUrlTree(['/forbidden']);
  }
}
```

### 4.3 CanDeactivateå®ˆå«

æ§åˆ¶æ˜¯å¦å¯ä»¥ç¦»å¼€å½“å‰è·¯ç”±ï¼Œé€šå¸¸ç”¨äºé˜²æ­¢ç”¨æˆ·æ„å¤–ä¸¢å¤±æœªä¿å­˜çš„æ›´æ”¹ï¼š

```typescript title="can-deactivate.guard.ts"
import { Injectable } from '@angular/core';
import { CanDeactivate, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree } from '@angular/router';
import { Observable } from 'rxjs';

export interface CanComponentDeactivate {
  canDeactivate: () => Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree;
}

@Injectable({
  providedIn: 'root'
})
export class CanDeactivateGuard implements CanDeactivate<CanComponentDeactivate> {
  canDeactivate(
    component: CanComponentDeactivate,
    currentRoute: ActivatedRouteSnapshot,
    currentState: RouterStateSnapshot,
    nextState?: RouterStateSnapshot
  ): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {
    return component.canDeactivate ? component.canDeactivate() : true;
  }
}
```

```typescript title="product-edit.component.ts"
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { CanComponentDeactivate } from '../can-deactivate.guard';
import { Observable } from 'rxjs';

@Component({
  selector: 'app-product-edit',
  templateUrl: './product-edit.component.html'
})
export class ProductEditComponent implements OnInit, CanComponentDeactivate {
  productForm: FormGroup;
  originalProduct: any;
  hasUnsavedChanges = false;
  
  constructor(private fb: FormBuilder) {}
  
  ngOnInit() {
    this.productForm = this.fb.group({
      name: ['', Validators.required],
      price: [0, [Validators.required, Validators.min(0)]],
      description: ['']
    });
    
    // ç›‘å¬è¡¨å•æ›´æ”¹
    this.productForm.valueChanges.subscribe(() => {
      this.hasUnsavedChanges = this.productForm.dirty;
    });
    
    // è·å–åŸå§‹äº§å“æ•°æ®...
  }
  
  // å®ç°CanComponentDeactivateæ¥å£
  canDeactivate(): Observable<boolean> | Promise<boolean> | boolean {
    if (!this.hasUnsavedChanges) {
      return true;
    }
    
    // å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
    return window.confirm('æ‚¨æœ‰æœªä¿å­˜çš„æ›´æ”¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ');
  }
  
  saveChanges() {
    // ä¿å­˜è¡¨å•æ•°æ®...
    this.hasUnsavedChanges = false;
  }
}
```

### 4.4 CanLoadå®ˆå«

æ§åˆ¶æ˜¯å¦å¯ä»¥åŠ è½½å»¶è¿ŸåŠ è½½æ¨¡å—ï¼š

```typescript title="auth.guard.ts"
import { Injectable } from '@angular/core';
import { CanLoad, Route, UrlSegment, Router } from '@angular/router';
import { Observable } from 'rxjs';
import { AuthService } from './auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanLoad {
  constructor(private authService: AuthService, private router: Router) {}
  
  canLoad(
    route: Route,
    segments: UrlSegment[]
  ): Observable<boolean> | Promise<boolean> | boolean {
    if (this.authService.isLoggedIn()) {
      return true;
    }
    
    // æœªç™»å½•ï¼Œå¯¼èˆªåˆ°ç™»å½•é¡µé¢
    this.router.navigate(['/login']);
    return false;
  }
}
```

### 4.5 Resolveå®ˆå«

å‰é¢å·²ç»ä»‹ç»è¿‡ï¼Œç”¨äºåœ¨è·¯ç”±æ¿€æ´»å‰é¢„å…ˆè·å–æ•°æ®ã€‚

## 5. å»¶è¿ŸåŠ è½½

å»¶è¿ŸåŠ è½½æ˜¯Angularè·¯ç”±ç³»ç»Ÿçš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸å°†åº”ç”¨ç¨‹åºæ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œå¹¶åœ¨éœ€è¦æ—¶æŒ‰éœ€åŠ è½½ï¼Œè¿™å¯ä»¥æ˜¾è‘—æé«˜åˆå§‹åŠ è½½æ€§èƒ½ã€‚

### 5.1 é…ç½®å»¶è¿ŸåŠ è½½æ¨¡å—

```typescript title="app-routing.module.ts"
const routes: Routes = [
  { path: '', component: HomeComponent },
  { 
    path: 'products', 
    loadChildren: () => import('./products/products.module').then(m => m.ProductsModule),
    canLoad: [AuthGuard]
  },
  { 
    path: 'admin', 
    loadChildren: () => import('./admin/admin.module').then(m => m.AdminModule),
    canLoad: [AdminGuard]
  }
];
```

### 5.2 å»¶è¿ŸåŠ è½½æ¨¡å—é…ç½®

æ¯ä¸ªå»¶è¿ŸåŠ è½½çš„æ¨¡å—å¿…é¡»æœ‰è‡ªå·±çš„è·¯ç”±é…ç½®ï¼š

```typescript title="products/products-routing.module.ts"
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';

import { ProductListComponent } from './product-list.component';
import { ProductDetailComponent } from './product-detail.component';
import { ProductEditComponent } from './product-edit.component';
import { ProductResolver } from './product.resolver';
import { CanDeactivateGuard } from '../can-deactivate.guard';

const routes: Routes = [
  { path: '', component: ProductListComponent },
  { 
    path: ':id', 
    component: ProductDetailComponent,
    resolve: { product: ProductResolver }
  },
  { 
    path: ':id/edit', 
    component: ProductEditComponent,
    canDeactivate: [CanDeactivateGuard]
  }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class ProductsRoutingModule { }
```

```typescript title="products/products.module.ts"
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';

import { ProductsRoutingModule } from './products-routing.module';
import { ProductListComponent } from './product-list.component';
import { ProductDetailComponent } from './product-detail.component';
import { ProductEditComponent } from './product-edit.component';

@NgModule({
  declarations: [
    ProductListComponent,
    ProductDetailComponent,
    ProductEditComponent
  ],
  imports: [
    CommonModule,
    ReactiveFormsModule,
    ProductsRoutingModule
  ]
})
export class ProductsModule { }
```

### 5.3 é¢„åŠ è½½ç­–ç•¥

Angularè·¯ç”±ç³»ç»Ÿæ”¯æŒå¤šç§é¢„åŠ è½½ç­–ç•¥ï¼š

```typescript title="app-routing.module.ts"
import { PreloadAllModules, NoPreloading } from '@angular/router';

@NgModule({
  imports: [
    RouterModule.forRoot(routes, {
      preloadingStrategy: PreloadAllModules,  // é¢„åŠ è½½æ‰€æœ‰å»¶è¿ŸåŠ è½½æ¨¡å—
      // æˆ–è€…ä¸é¢„åŠ è½½
      // preloadingStrategy: NoPreloading
    })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }
```

ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„é¢„åŠ è½½ç­–ç•¥ï¼š

```typescript title="selective-preloading-strategy.service.ts"
import { Injectable } from '@angular/core';
import { PreloadingStrategy, Route } from '@angular/router';
import { Observable, of } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class SelectivePreloadingStrategy implements PreloadingStrategy {
  preload(route: Route, load: () => Observable<any>): Observable<any> {
    if (route.data && route.data['preload']) {
      return load();
    }
    return of(null);
  }
}
```

```typescript title="app-routing.module.ts"
const routes: Routes = [
  { 
    path: 'products', 
    loadChildren: () => import('./products/products.module').then(m => m.ProductsModule),
    data: { preload: true }  // æ ‡è®°æ­¤æ¨¡å—è¿›è¡Œé¢„åŠ è½½
  },
  { 
    path: 'admin', 
    loadChildren: () => import('./admin/admin.module').then(m => m.AdminModule)
    // ä¸é¢„åŠ è½½
  }
];

@NgModule({
  imports: [
    RouterModule.forRoot(routes, {
      preloadingStrategy: SelectivePreloadingStrategy
    })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }
```

## 6. è·¯ç”±äº‹ä»¶ä¸ç”Ÿå‘½å‘¨æœŸ

Angularè·¯ç”±ç³»ç»Ÿè§¦å‘ä¸€ç³»åˆ—çš„äº‹ä»¶ï¼Œå¯ç”¨äºè·Ÿè¸ªè·¯ç”±è¿‡ç¨‹å¹¶å®ç°åŠ è½½æŒ‡ç¤ºå™¨æˆ–åˆ†æè·Ÿè¸ªï¼š

```typescript title="app.component.ts"
import { Component, OnInit } from '@angular/core';
import { Router, NavigationStart, NavigationEnd, NavigationCancel, NavigationError, Event } from '@angular/router';
import { filter } from 'rxjs/operators';

@Component({
  selector: 'app-root',
  template: `
    <div class="loading-indicator" *ngIf="loading">åŠ è½½ä¸­...</div>
    <router-outlet></router-outlet>
  `
})
export class AppComponent implements OnInit {
  loading = false;
  
  constructor(private router: Router) {}
  
  ngOnInit() {
    this.router.events.subscribe((event: Event) => {
      switch (true) {
        case event instanceof NavigationStart:
          this.loading = true;
          break;
          
        case event instanceof NavigationEnd:
        case event instanceof NavigationCancel:
        case event instanceof NavigationError:
          this.loading = false;
          break;
      }
    });
    
    // é¡µé¢æ ‡é¢˜æ›´æ–°
    this.router.events.pipe(
      filter(event => event instanceof NavigationEnd)
    ).subscribe(() => {
      const rt = this.getChild(this.router.routerState.root);
      rt.data.subscribe(data => {
        // æ›´æ–°é¡µé¢æ ‡é¢˜
        if (data.title) {
          document.title = `${data.title} - My App`;
        }
      });
    });
  }
  
  // é€’å½’è·å–æ´»åŠ¨è·¯ç”±
  private getChild(activatedRoute: ActivatedRoute): ActivatedRoute {
    if (activatedRoute.firstChild) {
      return this.getChild(activatedRoute.firstChild);
    } else {
      return activatedRoute;
    }
  }
}
```

## 7. è·¯ç”±æœ€ä½³å®è·µ

### 7.1 è·¯ç”±ç»„ç»‡æ¨¡å¼

å¯¹äºå¤§å‹åº”ç”¨ï¼Œå»ºè®®é‡‡ç”¨ä»¥ä¸‹è·¯ç”±ç»„ç»‡æ¨¡å¼ï¼š

1. **æ¨¡å—åŒ–è·¯ç”±**ï¼šæ¯ä¸ªåŠŸèƒ½æ¨¡å—æœ‰è‡ªå·±çš„è·¯ç”±é…ç½®
2. **åŸºäºç‰¹æ€§çš„ç»„ç»‡**ï¼šæŒ‰ç‰¹æ€§æˆ–ä¸šåŠ¡é¢†åŸŸç»„ç»‡è·¯ç”±
3. **æ‡’åŠ è½½ä¸é¢„åŠ è½½**ï¼šåˆç†ä½¿ç”¨æ‡’åŠ è½½å’Œé¢„åŠ è½½ç­–ç•¥

### 7.2 è·¯ç”±å‘½åçº¦å®š

ä½¿ç”¨ä¸€è‡´çš„è·¯ç”±å‘½åçº¦å®šæœ‰åŠ©äºæé«˜å¯ç»´æŠ¤æ€§ï¼š

1. **ä½¿ç”¨kebab-case**ï¼šä¾‹å¦‚`/user-profile`è€Œä¸æ˜¯`/userProfile`
2. **èµ„æºæ ‡è¯†**ï¼šå¯¹äºRESTfulé£æ ¼çš„è·¯ç”±ï¼Œä½¿ç”¨`/resources/:id/action`æ ¼å¼
3. **é¿å…åŠ¨è¯**ï¼šä½¿ç”¨åè¯å‘½åè·¯ç”±ï¼Œä¾‹å¦‚`/products`è€Œä¸æ˜¯`/get-products`

### 7.3 è·¯ç”±å®‰å…¨

å®æ–½å¤šå±‚è·¯ç”±å®‰å…¨ç­–ç•¥ï¼š

1. **è®¤è¯å®ˆå«**ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
2. **æˆæƒå®ˆå«**ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®ç‰¹å®šèµ„æº
3. **æ•°æ®éªŒè¯**ï¼šåœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éªŒè¯è·¯ç”±å‚æ•°
4. **CSRFä¿æŠ¤**ï¼šé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»

### 7.4 è·¯ç”±çŠ¶æ€ç®¡ç†

æœ‰æ•ˆç®¡ç†è·¯ç”±çŠ¶æ€ï¼š

1. **ä½¿ç”¨æŸ¥è¯¢å‚æ•°**ï¼šå­˜å‚¨è¿‡æ»¤ã€æ’åºã€åˆ†é¡µç­‰UIçŠ¶æ€
2. **è·¯ç”±å‚æ•°åºåˆ—åŒ–**ï¼šå¯¹å¤æ‚çš„æŸ¥è¯¢å‚æ•°è¿›è¡Œåºåˆ—åŒ–
3. **ä¿æŒURLæ¸…æ™°**ï¼šURLåº”è¯¥æ˜¯å¯è¯»çš„ï¼Œå¯åˆ†äº«çš„ï¼Œå¯ä¹¦ç­¾çš„

### 7.5 è·¯ç”±æ€§èƒ½ä¼˜åŒ–

æé«˜è·¯ç”±æ€§èƒ½ï¼š

1. **å»¶è¿ŸåŠ è½½**ï¼šæŒ‰éœ€åŠ è½½æ¨¡å—
2. **è·¯ç”±é¢„åŠ è½½**ï¼šåœ¨ç©ºé—²æ—¶é¢„åŠ è½½å¸¸ç”¨æ¨¡å—
3. **æ•°æ®ç¼“å­˜**ï¼šç¼“å­˜è·¯ç”±è§£æå™¨è·å–çš„æ•°æ®
4. **Route Reuseç­–ç•¥**ï¼šå®ç°è‡ªå®šä¹‰è·¯ç”±å¤ç”¨ç­–ç•¥ï¼Œé¿å…ä¸å¿…è¦çš„ç»„ä»¶é‡å»º

```typescript title="custom-route-reuse-strategy.ts"
import { ActivatedRouteSnapshot, DetachedRouteHandle, RouteReuseStrategy } from '@angular/router';

export class CustomRouteReuseStrategy implements RouteReuseStrategy {
  private storedRoutes = new Map<string, DetachedRouteHandle>();
  
  // ç¡®å®šæ˜¯å¦å¤ç”¨è·¯ç”±
  shouldDetach(route: ActivatedRouteSnapshot): boolean {
    // åªå­˜å‚¨æ ‡è®°ä¸ºå¯å¤ç”¨çš„è·¯ç”±
    return route.data && route.data['reuseRoute'];
  }
  
  // å­˜å‚¨åˆ†ç¦»çš„è·¯ç”±
  store(route: ActivatedRouteSnapshot, handle: DetachedRouteHandle): void {
    const id = this.getRouteId(route);
    this.storedRoutes.set(id, handle);
  }
  
  // ç¡®å®šæ˜¯å¦æœ‰å­˜å‚¨çš„è·¯ç”±
  shouldAttach(route: ActivatedRouteSnapshot): boolean {
    const id = this.getRouteId(route);
    return this.storedRoutes.has(id);
  }
  
  // æ¢å¤å­˜å‚¨çš„è·¯ç”±
  retrieve(route: ActivatedRouteSnapshot): DetachedRouteHandle | null {
    const id = this.getRouteId(route);
    if (!this.storedRoutes.has(id)) return null;
    return this.storedRoutes.get(id);
  }
  
  // ç¡®å®šæ˜¯å¦åº”è¯¥å¤ç”¨è·¯ç”±
  shouldReuseRoute(future: ActivatedRouteSnapshot, curr: ActivatedRouteSnapshot): boolean {
    // é»˜è®¤çš„å¤ç”¨ç­–ç•¥
    return future.routeConfig === curr.routeConfig;
  }
  
  // è·å–è·¯ç”±ID
  private getRouteId(route: ActivatedRouteSnapshot): string {
    // åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„è·¯ç”±æ ‡è¯†ç¬¦ï¼Œè€ƒè™‘è·¯å¾„å’Œå‚æ•°
    const path = route.routeConfig ? route.routeConfig.path : '';
    const id = path || '';
    
    // å¦‚æœæœ‰è·¯ç”±å‚æ•°ï¼Œå°†å…¶æ·»åŠ åˆ°IDä¸­
    if (route.params) {
      Object.keys(route.params).forEach(key => {
        id += `|${key}=${route.params[key]}`;
      });
    }
    
    return id;
  }
}
```

```typescript title="app.module.ts"
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { RouteReuseStrategy } from '@angular/router';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { CustomRouteReuseStrategy } from './custom-route-reuse-strategy';

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, AppRoutingModule],
  providers: [
    { provide: RouteReuseStrategy, useClass: CustomRouteReuseStrategy }
  ],
  bootstrap: [AppComponent]
})
export class AppModule { }
``` 