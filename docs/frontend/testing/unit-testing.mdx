---
sidebar_position: 2
title: å‰ç«¯å•å…ƒæµ‹è¯•å®Œå…¨æŒ‡å—
description: æ·±å…¥è§£æå‰ç«¯å•å…ƒæµ‹è¯•å®è·µï¼šJestã€React Testing Libraryã€æµ‹è¯•ç­–ç•¥ä¸æœ€ä½³å®è·µ
authors: [Laby]
tags: [å•å…ƒæµ‹è¯•, Jest, React Testing Library, æµ‹è¯•é©±åŠ¨å¼€å‘, Mock, æµ‹è¯•è¦†ç›–ç‡]
last_update:
  date: 2025-08-14
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# å‰ç«¯å•å…ƒæµ‹è¯•å®Œå…¨æŒ‡å—

å•å…ƒæµ‹è¯•æ˜¯æµ‹è¯•é‡‘å­—å¡”çš„åŸºç¡€ï¼Œä¸“æ³¨äºæµ‹è¯•å•ä¸ªå‡½æ•°ã€ç»„ä»¶æˆ–æ¨¡å—çš„åŠŸèƒ½ã€‚é€šè¿‡ç³»ç»ŸåŒ–çš„å•å…ƒæµ‹è¯•å®è·µï¼Œå¯ä»¥å¿«é€ŸéªŒè¯ä»£ç é€»è¾‘ã€æä¾›å³æ—¶åé¦ˆã€ç¡®ä¿ä»£ç è´¨é‡ï¼Œå¹¶ä¸ºé‡æ„æä¾›å®‰å…¨ä¿éšœã€‚

:::tip æ ¸å¿ƒä»·å€¼
**å•å…ƒæµ‹è¯• = å¿«é€Ÿåé¦ˆ + ä»£ç è´¨é‡ + é‡æ„å®‰å…¨ + æ–‡æ¡£ä»·å€¼**
- ğŸš€ **å¿«é€Ÿåé¦ˆ**ï¼šæ¯«ç§’çº§æµ‹è¯•æ‰§è¡Œï¼Œå³æ—¶å‘ç°é—®é¢˜
- ğŸ¯ **ä»£ç è´¨é‡**ï¼šå¼ºåˆ¶æ€è€ƒè¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
- ğŸ›¡ï¸ **é‡æ„å®‰å…¨**ï¼šä¸ºä»£ç é‡æ„æä¾›å®‰å…¨ç½‘
- ğŸ“š **æ–‡æ¡£ä»·å€¼**ï¼šæµ‹è¯•ç”¨ä¾‹ä½œä¸ºä»£ç ä½¿ç”¨è¯´æ˜
- ğŸ”§ **å¼€å‘æ•ˆç‡**ï¼šå‡å°‘æ‰‹åŠ¨æµ‹è¯•æ—¶é—´ï¼Œæé«˜å¼€å‘é€Ÿåº¦
- ğŸ“Š **è¦†ç›–ç‡ç›‘æ§**ï¼šé‡åŒ–æµ‹è¯•å®Œæ•´æ€§ï¼Œè¯†åˆ«æµ‹è¯•ç›²ç‚¹
:::

## 1. æµ‹è¯•ç¯å¢ƒæ­å»ºä¸é…ç½®

### 1.1 ç°ä»£æµ‹è¯•å·¥å…·é“¾

æ„å»ºé«˜æ•ˆçš„æµ‹è¯•ç¯å¢ƒéœ€è¦é€‰æ‹©åˆé€‚çš„å·¥å…·ç»„åˆï¼Œæ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ç‰¹å®šçš„èŒè´£å’Œä¼˜åŠ¿ã€‚

```mermaid
graph TB
    subgraph "å‰ç«¯æµ‹è¯•å·¥å…·ç”Ÿæ€"
        A[æµ‹è¯•æ¡†æ¶] --> A1[Jest]
        A --> A2[Vitest]
        A --> A3[Mocha]
        
        B[æ–­è¨€åº“] --> B1[Jestå†…ç½®]
        B --> B2[Chai]
        B --> B3[Expect]
        
        C[æµ‹è¯•å·¥å…·] --> C1[React Testing Library]
        C --> C2[Enzyme]
        C --> C3[Vue Test Utils]
        
        D[Mockå·¥å…·] --> D1[Jest Mock]
        D --> D2[Sinon]
        D --> D3[MSW]
        
        E[è¦†ç›–ç‡å·¥å…·] --> E1[Istanbul]
        E --> E2[C8]
        E --> E3[NYC]
    end
```

#### æµ‹è¯•å·¥å…·å¯¹æ¯”

| å·¥å…· | ç±»å‹ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|----------|
| **Jest** | æµ‹è¯•æ¡†æ¶ | é›¶é…ç½®ã€åŠŸèƒ½å…¨é¢ã€ç”Ÿæ€ä¸°å¯Œ | è¾ƒé‡ã€å¯åŠ¨æ…¢ | Reacté¡¹ç›®ã€å¤§å‹åº”ç”¨ |
| **Vitest** | æµ‹è¯•æ¡†æ¶ | å¿«é€Ÿã€ç°ä»£ã€Viteé›†æˆ | ç”Ÿæ€è¾ƒæ–° | Viteé¡¹ç›®ã€ç°ä»£åº”ç”¨ |
| **React Testing Library** | æµ‹è¯•å·¥å…· | ç”¨æˆ·è¡Œä¸ºå¯¼å‘ã€æœ€ä½³å®è·µ | å­¦ä¹ æ›²çº¿ | Reactç»„ä»¶æµ‹è¯• |
| **MSW** | Mockå·¥å…· | çœŸå®ç½‘ç»œæ¨¡æ‹Ÿã€å¼€å‘å‹å¥½ | é…ç½®å¤æ‚ | APIæµ‹è¯•ã€é›†æˆæµ‹è¯• |

<Tabs>
<TabItem value="jest-setup" label="Jesté…ç½®">

### Jestå®Œæ•´é…ç½®

```javascript title="jest.config.js - å®Œæ•´é…ç½®ç¤ºä¾‹"
module.exports = {
  // åŸºç¡€é…ç½®
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  
  // æ–‡ä»¶è·¯å¾„é…ç½®
  roots: ['<rootDir>/src'],
  testMatch: [
    '<rootDir>/src/**/__tests__/**/*.{js,jsx,ts,tsx}',
    '<rootDir>/src/**/*.(test|spec).{js,jsx,ts,tsx}'
  ],
  
  // æ¨¡å—è§£æ
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
    '^@components/(.*)$': '<rootDir>/src/components/$1',
    '^@utils/(.*)$': '<rootDir>/src/utils/$1',
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
    '\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2)$': 'jest-transform-stub'
  },
  
  // è®¾ç½®æ–‡ä»¶
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  
  // è½¬æ¢é…ç½®
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': 'ts-jest',
    '^.+\\.css$': 'jest-transform-css'
  },
  
  // å¿½ç•¥è½¬æ¢çš„æ¨¡å—
  transformIgnorePatterns: [
    'node_modules/(?!(axios|@testing-library)/)'
  ],
  
  // è¦†ç›–ç‡é…ç½®
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
    '!src/serviceWorker.ts',
    '!src/reportWebVitals.ts',
    '!src/**/*.stories.{js,jsx,ts,tsx}',
    '!src/**/*.test.{js,jsx,ts,tsx}'
  ],
  
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    },
    './src/components/': {
      branches: 90,
      functions: 90,
      lines: 90,
      statements: 90
    },
    './src/utils/': {
      branches: 95,
      functions: 95,
      lines: 95,
      statements: 95
    }
  },
  
  coverageReporters: ['text', 'lcov', 'html', 'json-summary'],
  
  // æ€§èƒ½é…ç½®
  maxWorkers: '50%',
  cache: true,
  cacheDirectory: '<rootDir>/.jest-cache',
  
  // å…¨å±€å˜é‡
  globals: {
    'ts-jest': {
      tsconfig: 'tsconfig.json',
      isolatedModules: true
    }
  },
  
  // æµ‹è¯•è¶…æ—¶
  testTimeout: 10000,
  
  // æ¸…ç†é…ç½®
  clearMocks: true,
  restoreMocks: true,
  
  // è¯¦ç»†è¾“å‡º
  verbose: true,
  
  // é”™è¯¯å¤„ç†
  errorOnDeprecated: true
};
```

```typescript title="setupTests.ts - æµ‹è¯•ç¯å¢ƒè®¾ç½®"
import '@testing-library/jest-dom';
import 'jest-canvas-mock';

// å…¨å±€Mock
global.fetch = jest.fn();
global.ResizeObserver = jest.fn().mockImplementation(() => ({
  observe: jest.fn(),
  unobserve: jest.fn(),
  disconnect: jest.fn(),
}));

global.IntersectionObserver = jest.fn().mockImplementation(() => ({
  observe: jest.fn(),
  unobserve: jest.fn(),
  disconnect: jest.fn(),
}));

// Mock localStorage
const localStorageMock = {
  getItem: jest.fn(),
  setItem: jest.fn(),
  removeItem: jest.fn(),
  clear: jest.fn(),
  length: 0,
  key: jest.fn(),
};
global.localStorage = localStorageMock;

// Mock sessionStorage
global.sessionStorage = localStorageMock;

// Mock window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: jest.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});

// Mock console methods for cleaner test output
const originalError = console.error;
beforeAll(() => {
  console.error = (...args: any[]) => {
    if (
      typeof args[0] === 'string' &&
      args[0].includes('Warning: ReactDOM.render is no longer supported')
    ) {
      return;
    }
    originalError.call(console, ...args);
  };
});

afterAll(() => {
  console.error = originalError;
});

// å…¨å±€æµ‹è¯•å·¥å…·
global.testUtils = {
  // ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
  waitForAsync: (ms = 0) => new Promise(resolve => setTimeout(resolve, ms)),
  
  // åˆ›å»ºæ¨¡æ‹Ÿäº‹ä»¶
  createMockEvent: (type: string, properties = {}) => ({
    type,
    preventDefault: jest.fn(),
    stopPropagation: jest.fn(),
    target: { value: '' },
    ...properties
  }),
  
  // æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
  mockUserInput: (element: HTMLElement, value: string) => {
    const event = new Event('input', { bubbles: true });
    Object.defineProperty(event, 'target', {
      writable: false,
      value: { value }
    });
    element.dispatchEvent(event);
  }
};

// æ¸…ç†å‡½æ•°
afterEach(() => {
  jest.clearAllMocks();
  localStorage.clear();
  sessionStorage.clear();
});
```

</TabItem>
<TabItem value="vitest-setup" label="Vitesté…ç½®">

### Vitestç°ä»£åŒ–é…ç½®

```typescript title="vitest.config.ts - Vitesté…ç½®"
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  
  test: {
    // æµ‹è¯•ç¯å¢ƒ
    environment: 'jsdom',
    
    // å…¨å±€è®¾ç½®
    globals: true,
    
    // è®¾ç½®æ–‡ä»¶
    setupFiles: ['./src/setupTests.ts'],
    
    // åŒ…å«çš„æµ‹è¯•æ–‡ä»¶
    include: [
      'src/**/*.{test,spec}.{js,jsx,ts,tsx}',
      'src/**/__tests__/**/*.{js,jsx,ts,tsx}'
    ],
    
    // æ’é™¤çš„æ–‡ä»¶
    exclude: [
      'node_modules',
      'dist',
      '.idea',
      '.git',
      '.cache'
    ],
    
    // è¦†ç›–ç‡é…ç½®
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      include: ['src/**/*.{js,jsx,ts,tsx}'],
      exclude: [
        'src/**/*.d.ts',
        'src/**/*.stories.{js,jsx,ts,tsx}',
        'src/**/*.test.{js,jsx,ts,tsx}',
        'src/main.tsx',
        'src/vite-env.d.ts'
      ],
      thresholds: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80
        }
      }
    },
    
    // æ€§èƒ½é…ç½®
    pool: 'threads',
    poolOptions: {
      threads: {
        singleThread: false,
        maxThreads: 4,
        minThreads: 1
      }
    },
    
    // è¶…æ—¶é…ç½®
    testTimeout: 10000,
    hookTimeout: 10000,
    
    // ç›‘å¬æ¨¡å¼é…ç½®
    watch: {
      ignore: ['node_modules/**', 'dist/**']
    },
    
    // æŠ¥å‘Šå™¨é…ç½®
    reporter: ['verbose', 'json', 'html'],
    
    // å¹¶å‘é…ç½®
    sequence: {
      concurrent: true
    }
  },
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
      '@utils': path.resolve(__dirname, './src/utils'),
      '@hooks': path.resolve(__dirname, './src/hooks'),
      '@types': path.resolve(__dirname, './src/types')
    }
  }
});
```

</TabItem>
<TabItem value="package-scripts" label="NPMè„šæœ¬">

### æµ‹è¯•ç›¸å…³NPMè„šæœ¬

```json title="package.json - æµ‹è¯•è„šæœ¬é…ç½®"
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:ci": "jest --coverage --watchAll=false --passWithNoTests",
    "test:debug": "node --inspect-brk node_modules/.bin/jest --runInBand",
    "test:update": "jest --updateSnapshot",
    "test:clear": "jest --clearCache",
    
    // Vitestè„šæœ¬
    "test:vitest": "vitest",
    "test:vitest:ui": "vitest --ui",
    "test:vitest:coverage": "vitest --coverage",
    "test:vitest:run": "vitest run",
    
    // æµ‹è¯•ç›¸å…³å·¥å…·
    "lint:test": "eslint 'src/**/*.test.{js,jsx,ts,tsx}'",
    "type-check:test": "tsc --noEmit --project tsconfig.test.json"
  },
  
  "devDependencies": {
    "@testing-library/jest-dom": "^6.1.4",
    "@testing-library/react": "^13.4.0",
    "@testing-library/user-event": "^14.5.1",
    "@types/jest": "^29.5.8",
    "jest": "^29.7.0",
    "jest-environment-jsdom": "^29.7.0",
    "jest-transform-stub": "^2.0.0",
    "ts-jest": "^29.1.1",
    
    // Vitestç›¸å…³
    "vitest": "^1.0.0",
    "@vitest/ui": "^1.0.0",
    "jsdom": "^23.0.0",
    
    // Mockç›¸å…³
    "msw": "^2.0.0",
    "jest-canvas-mock": "^2.5.2"
  }
}
```

</TabItem>
</Tabs>

## 2. å·¥å…·å‡½æ•°æµ‹è¯•å®è·µ

### å®‰è£…å’Œé…ç½®
```bash
# å®‰è£…Jest
npm install --save-dev jest

# å®‰è£…TypeScriptæ”¯æŒ
npm install --save-dev @types/jest ts-jest
```

```javascript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1'
  }
};
```

### åŸºæœ¬æµ‹è¯•ç»“æ„
```javascript
// math.test.js
function add(a, b) {
  return a + b;
}

function multiply(a, b) {
  return a * b;
}

describe('Math functions', () => {
  describe('add', () => {
    it('should add two positive numbers', () => {
      expect(add(2, 3)).toBe(5);
    });

    it('should handle negative numbers', () => {
      expect(add(-1, 1)).toBe(0);
    });

    it('should handle zero', () => {
      expect(add(0, 5)).toBe(5);
    });
  });

  describe('multiply', () => {
    it('should multiply two numbers', () => {
      expect(multiply(2, 3)).toBe(6);
    });
  });
});
```

## æµ‹è¯•å·¥å…·å‡½æ•°

### å·¥å…·å‡½æ•°æµ‹è¯•
```javascript
// utils.js
export function formatDate(date) {
  return date.toISOString().split('T')[0];
}

export function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

export function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}
```

```javascript
// utils.test.js
import { formatDate, debounce, validateEmail } from './utils';

describe('Utils', () => {
  describe('formatDate', () => {
    it('should format date correctly', () => {
      const date = new Date('2023-12-25T10:30:00Z');
      expect(formatDate(date)).toBe('2023-12-25');
    });
  });

  describe('debounce', () => {
    it('should debounce function calls', (done) => {
      let callCount = 0;
      const debouncedFn = debounce(() => {
        callCount++;
      }, 100);

      debouncedFn();
      debouncedFn();
      debouncedFn();

      setTimeout(() => {
        expect(callCount).toBe(1);
        done();
      }, 150);
    });
  });

  describe('validateEmail', () => {
    it('should validate correct email addresses', () => {
      expect(validateEmail('test@example.com')).toBe(true);
      expect(validateEmail('user.name@domain.co.uk')).toBe(true);
    });

    it('should reject invalid email addresses', () => {
      expect(validateEmail('invalid-email')).toBe(false);
      expect(validateEmail('test@')).toBe(false);
      expect(validateEmail('@example.com')).toBe(false);
    });
  });
});
```

## Reactç»„ä»¶æµ‹è¯•

### å®‰è£…æµ‹è¯•åº“
```bash
npm install --save-dev @testing-library/react @testing-library/jest-dom
```

```javascript
// setupTests.js
import '@testing-library/jest-dom';
```

### åŸºç¡€ç»„ä»¶æµ‹è¯•
```javascript
// Button.jsx
import React from 'react';

function Button({ children, onClick, disabled = false, variant = 'primary' }) {
  return (
    <button 
      onClick={onClick} 
      disabled={disabled}
      className={`btn btn-${variant}`}
    >
      {children}
    </button>
  );
}

export default Button;
```

```javascript
// Button.test.jsx
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import Button from './Button';

describe('Button', () => {
  it('renders with correct text', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('calls onClick when clicked', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByText('Click me'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('is disabled when disabled prop is true', () => {
    render(<Button disabled>Click me</Button>);
    expect(screen.getByText('Click me')).toBeDisabled();
  });

  it('applies correct variant class', () => {
    render(<Button variant="secondary">Click me</Button>);
    expect(screen.getByText('Click me')).toHaveClass('btn-secondary');
  });
});
```

### è¡¨å•ç»„ä»¶æµ‹è¯•
```javascript
// LoginForm.jsx
import React, { useState } from 'react';

function LoginForm({ onSubmit }) {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit({ email, password });
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="Email"
        required
      />
      <input
        type="password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        placeholder="Password"
        required
      />
      <button type="submit">Login</button>
    </form>
  );
}

export default LoginForm;
```

```javascript
// LoginForm.test.jsx
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import LoginForm from './LoginForm';

describe('LoginForm', () => {
  it('renders form elements', () => {
    render(<LoginForm onSubmit={jest.fn()} />);
    
    expect(screen.getByPlaceholderText('Email')).toBeInTheDocument();
    expect(screen.getByPlaceholderText('Password')).toBeInTheDocument();
    expect(screen.getByRole('button', { name: 'Login' })).toBeInTheDocument();
  });

  it('updates input values', () => {
    render(<LoginForm onSubmit={jest.fn()} />);
    
    const emailInput = screen.getByPlaceholderText('Email');
    const passwordInput = screen.getByPlaceholderText('Password');
    
    fireEvent.change(emailInput, { target: { value: 'test@example.com' } });
    fireEvent.change(passwordInput, { target: { value: 'password123' } });
    
    expect(emailInput.value).toBe('test@example.com');
    expect(passwordInput.value).toBe('password123');
  });

  it('calls onSubmit with form data', () => {
    const mockOnSubmit = jest.fn();
    render(<LoginForm onSubmit={mockOnSubmit} />);
    
    fireEvent.change(screen.getByPlaceholderText('Email'), {
      target: { value: 'test@example.com' }
    });
    fireEvent.change(screen.getByPlaceholderText('Password'), {
      target: { value: 'password123' }
    });
    fireEvent.click(screen.getByRole('button', { name: 'Login' }));
    
    expect(mockOnSubmit).toHaveBeenCalledWith({
      email: 'test@example.com',
      password: 'password123'
    });
  });
});
```

## å¼‚æ­¥æµ‹è¯•

### Promiseæµ‹è¯•
```javascript
// api.js
export async function fetchUser(id) {
  const response = await fetch(`/api/users/${id}`);
  if (!response.ok) {
    throw new Error('User not found');
  }
  return response.json();
}
```

```javascript
// api.test.js
import { fetchUser } from './api';

// Mock fetch
global.fetch = jest.fn();

describe('fetchUser', () => {
  beforeEach(() => {
    fetch.mockClear();
  });

  it('should fetch user successfully', async () => {
    const mockUser = { id: 1, name: 'John Doe' };
    fetch.mockResolvedValueOnce({
      ok: true,
      json: async () => mockUser
    });

    const result = await fetchUser(1);
    expect(result).toEqual(mockUser);
    expect(fetch).toHaveBeenCalledWith('/api/users/1');
  });

  it('should throw error when user not found', async () => {
    fetch.mockResolvedValueOnce({
      ok: false
    });

    await expect(fetchUser(999)).rejects.toThrow('User not found');
  });
});
```

### å¼‚æ­¥ç»„ä»¶æµ‹è¯•
```javascript
// UserProfile.jsx
import React, { useState, useEffect } from 'react';

function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function loadUser() {
      try {
        const response = await fetch(`/api/users/${userId}`);
        if (!response.ok) {
          throw new Error('User not found');
        }
        const userData = await response.json();
        setUser(userData);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    loadUser();
  }, [userId]);

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  if (!user) return <div>No user found</div>;

  return (
    <div>
      <h1>{user.name}</h1>
      <p>{user.email}</p>
    </div>
  );
}

export default UserProfile;
```

```javascript
// UserProfile.test.jsx
import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import UserProfile from './UserProfile';

// Mock fetch
global.fetch = jest.fn();

describe('UserProfile', () => {
  beforeEach(() => {
    fetch.mockClear();
  });

  it('shows loading state initially', () => {
    render(<UserProfile userId={1} />);
    expect(screen.getByText('Loading...')).toBeInTheDocument();
  });

  it('shows user data when fetch succeeds', async () => {
    const mockUser = { name: 'John Doe', email: 'john@example.com' };
    fetch.mockResolvedValueOnce({
      ok: true,
      json: async () => mockUser
    });

    render(<UserProfile userId={1} />);

    await waitFor(() => {
      expect(screen.getByText('John Doe')).toBeInTheDocument();
    });
    expect(screen.getByText('john@example.com')).toBeInTheDocument();
  });

  it('shows error when fetch fails', async () => {
    fetch.mockResolvedValueOnce({
      ok: false
    });

    render(<UserProfile userId={999} />);

    await waitFor(() => {
      expect(screen.getByText('Error: User not found')).toBeInTheDocument();
    });
  });
});
```

## Mockå’ŒStub

### å‡½æ•°Mock
```javascript
// calculator.js
export function add(a, b) {
  return a + b;
}

export function multiply(a, b) {
  return a * b;
}

export function calculate(a, b, operation) {
  switch (operation) {
    case 'add':
      return add(a, b);
    case 'multiply':
      return multiply(a, b);
    default:
      throw new Error('Unknown operation');
  }
}
```

```javascript
// calculator.test.js
import { calculate, add, multiply } from './calculator';

// Mock the add and multiply functions
jest.mock('./calculator', () => ({
  ...jest.requireActual('./calculator'),
  add: jest.fn(),
  multiply: jest.fn()
}));

describe('calculate', () => {
  beforeEach(() => {
    add.mockClear();
    multiply.mockClear();
  });

  it('should call add function for add operation', () => {
    add.mockReturnValue(5);
    
    const result = calculate(2, 3, 'add');
    
    expect(add).toHaveBeenCalledWith(2, 3);
    expect(result).toBe(5);
  });

  it('should call multiply function for multiply operation', () => {
    multiply.mockReturnValue(6);
    
    const result = calculate(2, 3, 'multiply');
    
    expect(multiply).toHaveBeenCalledWith(2, 3);
    expect(result).toBe(6);
  });
});
```

### æ¨¡å—Mock
```javascript
// userService.js
import { fetchUser } from './api';

export async function getUserName(id) {
  const user = await fetchUser(id);
  return user.name;
}
```

```javascript
// userService.test.js
import { getUserName } from './userService';

// Mock the api module
jest.mock('./api', () => ({
  fetchUser: jest.fn()
}));

import { fetchUser } from './api';

describe('getUserName', () => {
  beforeEach(() => {
    fetchUser.mockClear();
  });

  it('should return user name', async () => {
    fetchUser.mockResolvedValue({ name: 'John Doe' });
    
    const result = await getUserName(1);
    
    expect(fetchUser).toHaveBeenCalledWith(1);
    expect(result).toBe('John Doe');
  });
});
```

## æµ‹è¯•è¦†ç›–ç‡

### é…ç½®è¦†ç›–ç‡
```javascript
// jest.config.js
module.exports = {
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
    '!src/serviceWorker.ts'
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};
```

### è¿è¡Œè¦†ç›–ç‡
```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# åªè¿è¡Œè¦†ç›–ç‡
npm test -- --coverage --watchAll=false
```

## æµ‹è¯•æœ€ä½³å®è·µ

### æµ‹è¯•å‘½å
```javascript
describe('UserService', () => {
  describe('getUser', () => {
    it('should return user when valid ID is provided', () => {
      // test implementation
    });

    it('should throw error when user not found', () => {
      // test implementation
    });
  });
});
```

### æµ‹è¯•æ•°æ®å·¥å‚
```javascript
// testFactories.js
export function createUser(overrides = {}) {
  return {
    id: 1,
    name: 'John Doe',
    email: 'john@example.com',
    ...overrides
  };
}

export function createUserList(count = 3) {
  return Array.from({ length: count }, (_, index) => 
    createUser({ id: index + 1, name: `User ${index + 1}` })
  );
}
```

### æµ‹è¯•æ¸…ç†
```javascript
describe('UserService', () => {
  beforeEach(() => {
    // è®¾ç½®æµ‹è¯•ç¯å¢ƒ
    jest.clearAllMocks();
  });

  afterEach(() => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
  });

  afterAll(() => {
    // æ¸…ç†å…¨å±€çŠ¶æ€
  });
});
``` 