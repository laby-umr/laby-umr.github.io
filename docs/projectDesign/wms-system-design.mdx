---
sidebar_position: 1
title: WMS ä»“åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡
description: åŸºäº Spring Cloud çš„æ™ºèƒ½ä»“åº“ç®¡ç†ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ
tags: [WMS, ä»“åº“ç®¡ç†, Spring Cloud, å¾®æœåŠ¡, ç³»ç»Ÿè®¾è®¡]
---

# WMS ä»“åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡ï¼ˆåŸºäºRuoYi-Pro-Miniï¼‰

:::tip ğŸ“Œ é‡è¦è¯´æ˜ï¼šåŸºäºRuoYi-Pro-Miniæ¡†æ¶å¼€å‘
æœ¬ç³»ç»ŸåŸºäº **RuoYi-Pro-Mini** æ¡†æ¶å¼€å‘ï¼Œå……åˆ†å¤ç”¨æ¡†æ¶æä¾›çš„åŸºç¡€åŠŸèƒ½æ¨¡å—ã€‚

**æ¡†æ¶æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… **å¼€ç®±å³ç”¨çš„æƒé™ç®¡ç†**ï¼šç”¨æˆ·ã€è§’è‰²ã€èœå•ã€æƒé™ä¸€ä½“åŒ–
- âœ… **å®Œå–„çš„æ•°æ®å­—å…¸**ï¼šæ”¯æŒåŠ¨æ€é…ç½®ã€å¤šçº§è”åŠ¨
- âœ… **æ“ä½œæ—¥å¿—å®¡è®¡**ï¼šå…¨é“¾è·¯æ“ä½œè®°å½•ã€å¼‚å¸¸è¿½è¸ª
- âœ… **ä»£ç ç”Ÿæˆå™¨**ï¼šå¿«é€Ÿç”ŸæˆCRUDä»£ç ï¼Œæå‡å¼€å‘æ•ˆç‡80%
- âœ… **è½»é‡çº§è®¾è®¡**ï¼šç›¸æ¯”RuoYi-Vue-Proï¼Œæ›´è½»é‡ã€æ›´ç®€æ´

**æŠ€æœ¯æ ˆ**ï¼š
- åç«¯ï¼šSpring Boot 3.2.x + MyBatis-Plus 3.5.x + Spring Security + JWT
- å‰ç«¯ï¼šVue 3 + Element Plus + TypeScript + Pinia
- æ•°æ®åº“ï¼šMySQL 8.0 + Redis 7.0
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šRocketMQ 5.xï¼ˆå¯é€‰ï¼‰
- å·¥å…·åº“ï¼šHutoolã€Lombokã€MapStruct

**è¡¨å‘½åè§„èŒƒ**ï¼š
- ç³»ç»ŸåŸºç¡€è¡¨ï¼š`system_*`ï¼ˆç”±RuoYiæ¡†æ¶æä¾›ï¼Œæ— éœ€åˆ›å»ºï¼‰
- WMSä¸šåŠ¡è¡¨ï¼š`wms_*`ï¼ˆæœ¬ç³»ç»Ÿä¸šåŠ¡è¡¨ï¼Œéœ€è¦åˆ›å»ºï¼‰
:::

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹

WMSï¼ˆWarehouse Management Systemï¼‰ä»“åº“ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº **RuoYi-Pro-Mini** æ¡†æ¶çš„æ™ºèƒ½ä»“å‚¨ç®¡ç†å¹³å°ï¼Œæ—¨åœ¨é€šè¿‡æ•°å­—åŒ–æ‰‹æ®µæå‡ä»“åº“è¿è¥æ•ˆç‡ï¼Œå®ç°åº“å­˜å®æ—¶å¯è§†åŒ–ã€å‡ºå…¥åº“è‡ªåŠ¨åŒ–ã€æ™ºèƒ½æ‹£è´§è°ƒåº¦ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

**ä¸ä¼ ç»ŸWMSçš„å·®å¼‚**ï¼š
- åŸºäºæˆç†Ÿæ¡†æ¶ï¼Œå¼€å‘å‘¨æœŸç¼©çŸ­50%
- å¤ç”¨æƒé™ç®¡ç†ï¼Œæ— éœ€é‡å¤å¼€å‘
- ç»Ÿä¸€æŠ€æœ¯æ ˆï¼Œé™ä½ç»´æŠ¤æˆæœ¬
- ä»£ç ç”Ÿæˆå™¨åŠ é€Ÿå¼€å‘

### 1.2 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | è¯´æ˜ | é¢„æœŸæ•ˆæœ |
|--------|------|----------|
| ğŸ¯ **æå‡æ•ˆç‡** | è‡ªåŠ¨åŒ–æ‹£è´§è·¯å¾„ä¼˜åŒ– | æ‹£è´§æ•ˆç‡æå‡ 40% |
| ğŸ“Š **å®æ—¶å¯è§†** | åº“å­˜å®æ—¶ç›‘æ§å’Œé¢„è­¦ | åº“å­˜å‡†ç¡®ç‡è¾¾ 99.5% |
| ğŸ”„ **é™ä½æˆæœ¬** | å‡å°‘äººå·¥ç›˜ç‚¹å’Œé”™è¯¯ | è¿è¥æˆæœ¬é™ä½ 30% |
| ğŸ“ˆ **æ•°æ®åˆ†æ** | æ™ºèƒ½æŠ¥è¡¨å’Œå†³ç­–æ”¯æŒ | å†³ç­–æ•ˆç‡æå‡ 50% |
| ğŸš€ **å¿«é€Ÿå“åº”** | è®¢å•è‡ªåŠ¨åˆ†é…å’Œå¤„ç† | å‡ºåº“æ—¶æ•ˆæå‡ 35% |

### 1.3 åº”ç”¨åœºæ™¯

#### ğŸ“¦ ç”µå•†ä»“å‚¨
- é«˜é¢‘å‡ºå…¥åº“æ“ä½œ
- å¤šSKUå•†å“ç®¡ç†
- è®¢å•å¿«é€Ÿå±¥çº¦
- åº“å­˜å‘¨è½¬ä¼˜åŒ–

#### ğŸ­ åˆ¶é€ ä¸šä»“åº“
- åŸææ–™ç®¡ç†
- æˆå“/åŠæˆå“å­˜å‚¨
- ç”Ÿäº§çº¿é…é€
- å‘†æ»åº“å­˜é¢„è­¦

#### ğŸª é›¶å”®é…é€ä¸­å¿ƒ
- å¤šé—¨åº—é…è´§
- è¡¥è´§è®¡åˆ’ç®¡ç†
- é€€è´§å¤„ç†
- åº“å­˜è°ƒæ‹¨

### 1.4 æŠ€æœ¯æ¶æ„

#### æ¶æ„è®¾è®¡æ€æƒ³

**ä¸ºä»€ä¹ˆé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Ÿ**

1. **ä¸šåŠ¡è§£è€¦**ï¼šä»“å‚¨ä¸šåŠ¡å¤æ‚åº¦é«˜ï¼Œå…¥åº“ã€å‡ºåº“ã€æ‹£è´§ç­‰æ¨¡å—ç‹¬ç«‹æ€§å¼ºï¼Œå¾®æœåŠ¡åŒ–ä¾¿äºå›¢é˜Ÿåä½œå’Œç‹¬ç«‹æ¼”è¿›
2. **å¼¹æ€§æ‰©å±•**ï¼šåº“å­˜æŸ¥è¯¢ã€æ‹£è´§ä»»åŠ¡ç­‰é«˜å¹¶å‘åœºæ™¯å¯ç‹¬ç«‹æ‰©å±•ï¼Œé¿å…èµ„æºæµªè´¹
3. **æ•…éšœéš”ç¦»**ï¼šæŸä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿï¼Œæé«˜å¯ç”¨æ€§
4. **æŠ€æœ¯å¼‚æ„**ï¼šæŠ¥è¡¨æœåŠ¡å¯ä½¿ç”¨ElasticSearchï¼Œæ—¥å¿—æœåŠ¡å¯ç”¨MongoDBï¼Œå„å–æ‰€é•¿

```mermaid
graph TB
    %% å®¢æˆ·ç«¯å±‚
    subgraph Client["ğŸ’» å®¢æˆ·ç«¯å±‚"]
        direction LR
        Web["Web ç®¡ç†ç«¯<br/>(Vue3 + Element Plus)"]
        Mobile["ç§»åŠ¨ PDA ç«¯<br/>(UniApp)"]
        WMS_Screen["ä»“åº“å¤§å±<br/>(DataV)"]
    end

    %% ç½‘å…³å±‚
    subgraph Gateway["ğŸŒ ç½‘å…³å±‚"]
        SpringGW["Spring Cloud Gateway<br/>â€¢ è·¯ç”±è½¬å‘<br/>â€¢ è®¤è¯é‰´æƒ<br/>â€¢ é™æµç†”æ–­"]
    end

    %% ä¸šåŠ¡æœåŠ¡å±‚
    subgraph Business["âš™ï¸ ä¸šåŠ¡æœåŠ¡å±‚"]
        direction LR
        Inventory["åº“å­˜æœåŠ¡<br/>inventory-service"]
        Inbound["å…¥åº“æœåŠ¡<br/>inbound-service"]
        Outbound["å‡ºåº“æœåŠ¡<br/>outbound-service"]
        Picking["æ‹£è´§æœåŠ¡<br/>picking-service"]
        Warehouse["ä»“åº“æœåŠ¡<br/>warehouse-service"]
        Report["æŠ¥è¡¨æœåŠ¡<br/>report-service"]
    end

    %% åŸºç¡€è®¾æ–½å±‚
    subgraph Infrastructure["ğŸ”§ åŸºç¡€è®¾æ–½å±‚"]
        direction LR
        Nacos["Nacos<br/>æ³¨å†Œä¸­å¿ƒ + é…ç½®ä¸­å¿ƒ"]
        RocketMQ["RocketMQ<br/>æ¶ˆæ¯é˜Ÿåˆ—"]
    end

    %% æ•°æ®å±‚
    subgraph Data["ğŸ’¾ æ•°æ®å±‚"]
        direction LR
        MySQL["MySQL<br/>ä¸šåŠ¡æ•°æ®"]
        Redis["Redis<br/>ç¼“å­˜ + åˆ†å¸ƒå¼é”"]
        MongoDB["MongoDB<br/>æ“ä½œæ—¥å¿—"]
        MinIO["MinIO<br/>æ–‡ä»¶å­˜å‚¨"]
    end

    %% å®¢æˆ·ç«¯åˆ°ç½‘å…³çš„è¿æ¥
    Web --> SpringGW
    Mobile --> SpringGW
    WMS_Screen --> SpringGW
    
    %% ç½‘å…³åˆ°ä¸šåŠ¡æœåŠ¡çš„è¿æ¥
    SpringGW --> Inventory
    SpringGW --> Inbound
    SpringGW --> Outbound
    SpringGW --> Picking
    SpringGW --> Warehouse
    SpringGW --> Report
    
    %% ä¸šåŠ¡æœåŠ¡åˆ°åŸºç¡€è®¾æ–½çš„è¿æ¥ï¼ˆç»Ÿä¸€å‘ä¸‹ï¼‰
    Inventory -.-> Nacos
    Inbound -.-> Nacos
    Outbound -.-> Nacos
    Picking -.-> Nacos
    Warehouse -.-> Nacos
    Report -.-> Nacos
    
    Inbound -.-> RocketMQ
    Outbound -.-> RocketMQ
    Picking -.-> RocketMQ
    
    %% ä¸šåŠ¡æœåŠ¡åˆ°æ•°æ®å±‚çš„è¿æ¥ï¼ˆæŒ‰æœåŠ¡åˆ†ç»„ï¼‰
    Inventory --> MySQL
    Inventory --> Redis
    
    Inbound --> MySQL
    Inbound --> Redis
    
    Outbound --> MySQL
    Outbound --> Redis
    
    Picking --> MySQL
    Picking --> MongoDB
    
    Warehouse --> MySQL
    
    Report --> MySQL
    Report --> MinIO

    %% æ ·å¼å®šä¹‰
    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gatewayStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef serviceStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef infraStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef dataStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class Web,Mobile,WMS_Screen clientStyle
    class SpringGW gatewayStyle
    class Inventory,Inbound,Outbound,Picking,Warehouse,Report serviceStyle
    class Nacos,RocketMQ infraStyle
    class MySQL,Redis,MongoDB,MinIO dataStyle
```

#### æ ¸å¿ƒç»„ä»¶é€‰å‹è¯´æ˜

| ç»„ä»¶ç±»å‹ | æŠ€æœ¯é€‰å‹ | é€‰å‹ç†ç”± | æ›¿ä»£æ–¹æ¡ˆ |
|---------|---------|---------|---------|
| **æœåŠ¡æ³¨å†Œ** | Nacos | å›½äº§åŒ–ã€é…ç½®ä¸­å¿ƒé›†æˆã€ç¤¾åŒºæ´»è·ƒ | Consul, Eureka |
| **ç½‘å…³** | Spring Cloud Gateway | å¼‚æ­¥éé˜»å¡ã€æ€§èƒ½ä¼˜ç§€ã€Springç”Ÿæ€ | Zuul 2.0, Kong |
| **è´Ÿè½½å‡è¡¡** | Spring Cloud LoadBalancer | è½»é‡çº§ã€å¯å®šåˆ¶ | Ribbon(å·²åœæ›´) |
| **æœåŠ¡è°ƒç”¨** | OpenFeign + OkHttp | å£°æ˜å¼ã€å¯è¯»æ€§å¼ºã€æ”¯æŒHTTP/2 | Dubbo, gRPC |
| **ç†”æ–­é™æµ** | Sentinel | å®æ—¶ç›‘æ§ã€è§„åˆ™ä¸°å¯Œã€å›½äº§åŒ– | Hystrix(åœæ›´), Resilience4j |
| **é“¾è·¯è¿½è¸ª** | SkyWalking | APMå…¨æ ˆã€å›½äº§ã€æ— ä¾µå…¥ | Zipkin, Jaeger |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RocketMQ | é¡ºåºæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ã€é«˜åå | Kafka, RabbitMQ |
| **æ•°æ®åº“** | MySQL 8.0 | ACIDä¿è¯ã€æˆç†Ÿç¨³å®šã€ç”Ÿæ€å®Œå–„ | PostgreSQL, TiDB |
| **ç¼“å­˜** | Redis 7.0 | é«˜æ€§èƒ½ã€æ•°æ®ç»“æ„ä¸°å¯Œã€åˆ†å¸ƒå¼é” | Memcached, Hazelcast |
| **æœç´¢å¼•æ“** | ElasticSearch | å…¨æ–‡æ£€ç´¢ã€æ—¥å¿—åˆ†æã€å®æ—¶èšåˆ | Solr, OpenSearch |
| **å¯¹è±¡å­˜å‚¨** | MinIO | å…¼å®¹S3ã€éƒ¨ç½²ç®€å•ã€ç§æœ‰åŒ– | FastDFS, OSS |
| **å®šæ—¶ä»»åŠ¡** | XXL-Job | åˆ†å¸ƒå¼ã€å¯è§†åŒ–ã€å¤±è´¥é‡è¯• | Quartz, Elastic-Job |

### 1.5 æŠ€æœ¯æ ˆ

#### åç«¯æŠ€æœ¯æ ˆ

```xml
<properties>
    <!-- Spring å…¨å®¶æ¡¶ -->
    <spring-boot.version>3.1.5</spring-boot.version>
    <spring-cloud.version>2022.0.4</spring-cloud.version>
    <spring-cloud-alibaba.version>2022.0.0.0</spring-cloud-alibaba.version>
    
    <!-- æ•°æ®åº“ -->
    <mybatis-plus.version>3.5.4.1</mybatis-plus.version>
    <mysql.version>8.0.33</mysql.version>
    <redis.version>3.1.5</redis.version>
    
    <!-- æ¶ˆæ¯é˜Ÿåˆ— -->
    <rocketmq.version>2.2.3</rocketmq.version>
    
    <!-- å·¥å…·ç±» -->
    <hutool.version>5.8.22</hutool.version>
    <lombok.version>1.18.30</lombok.version>
    <mapstruct.version>1.5.5.Final</mapstruct.version>
</properties>
```

#### å‰ç«¯æŠ€æœ¯æ ˆ

```json
{
  "dependencies": {
    "vue": "^3.3.4",
    "vue-router": "^4.2.5",
    "pinia": "^2.1.7",
    "element-plus": "^2.4.2",
    "axios": "^1.6.0",
    "echarts": "^5.4.3",
    "vxe-table": "^4.5.0"
  }
}
```

---

## äºŒã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 2.1 åŠŸèƒ½æ¶æ„å›¾

```mermaid
graph LR
    subgraph Core["ğŸ¯ æ ¸å¿ƒä¸šåŠ¡"]
        InventoryMgmt["åº“å­˜ç®¡ç†<br/>â€¢ å®æ—¶åº“å­˜<br/>â€¢ æ‰¹æ¬¡ç®¡ç†<br/>â€¢ åºåˆ—å·è¿½è¸ª"]
        InboundMgmt["å…¥åº“ç®¡ç†<br/>â€¢ é‡‡è´­å…¥åº“<br/>â€¢ é€€è´§å…¥åº“<br/>â€¢ è°ƒæ‹¨å…¥åº“"]
        OutboundMgmt["å‡ºåº“ç®¡ç†<br/>â€¢ é”€å”®å‡ºåº“<br/>â€¢ è°ƒæ‹¨å‡ºåº“<br/>â€¢ æŠ¥æŸå‡ºåº“"]
        PickingMgmt["æ‹£è´§ç®¡ç†<br/>â€¢ æ³¢æ¬¡æ‹£è´§<br/>â€¢ è·¯å¾„ä¼˜åŒ–<br/>â€¢ ä»»åŠ¡åˆ†é…"]
    end

    subgraph Support["ğŸ”§ æ”¯æ’‘åŠŸèƒ½"]
        WarehouseMgmt["ä»“åº“ç®¡ç†<br/>â€¢ åº“åŒºåˆ’åˆ†<br/>â€¢ åº“ä½ç®¡ç†<br/>â€¢ å®¹é‡è§„åˆ’"]
        GoodsMgmt["å•†å“ç®¡ç†<br/>â€¢ SKU ä¿¡æ¯<br/>â€¢ è®¡é‡å•ä½<br/>â€¢ å•†å“åˆ†ç±»"]
        StockCount["ç›˜ç‚¹ç®¡ç†<br/>â€¢ å…¨ç›˜<br/>â€¢ æŠ½ç›˜<br/>â€¢ åŠ¨æ€ç›˜ç‚¹"]
        ReportMgmt["æŠ¥è¡¨åˆ†æ<br/>â€¢ åº“å­˜æŠ¥è¡¨<br/>â€¢ å‡ºå…¥åº“ç»Ÿè®¡<br/>â€¢ å‘¨è½¬åˆ†æ"]
    end

    Core --> Support

    classDef coreStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef supportStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    class InventoryMgmt,InboundMgmt,OutboundMgmt,PickingMgmt coreStyle
    class WarehouseMgmt,GoodsMgmt,StockCount,ReportMgmt supportStyle
```

### 2.2 åº“å­˜ç®¡ç†

#### 2.2.1 æ ¸å¿ƒèƒ½åŠ›

| åŠŸèƒ½ | è¯´æ˜ | å…³é”®æŒ‡æ ‡ | å®ç°éš¾ç‚¹ |
|------|------|----------|---------|
| **å®æ—¶åº“å­˜** | åº“å­˜æ•°æ®å®æ—¶æ›´æ–° | å»¶è¿Ÿ < 100ms | é«˜å¹¶å‘ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ |
| **æ‰¹æ¬¡ç®¡ç†** | ç”Ÿäº§æ‰¹æ¬¡è¿½æº¯ | æ‰¹æ¬¡å‡†ç¡®ç‡ 100% | å…ˆè¿›å…ˆå‡º(FIFO)ç­–ç•¥ |
| **åº“é¾„åˆ†æ** | åº“å­˜å‘¨è½¬åˆ†æ | é¢„è­¦å‡†ç¡®ç‡ 95% | å¤§æ•°æ®é‡ç»Ÿè®¡æ€§èƒ½ |
| **å®‰å…¨åº“å­˜** | åº“å­˜ä¸Šä¸‹é™é¢„è­¦ | ç¼ºè´§ç‡ < 1% | åŠ¨æ€é˜ˆå€¼è®¡ç®— |
| **åº“å­˜é”å®š** | è®¢å•åº“å­˜é¢„å  | å¹¶å‘æ”¯æŒ 10000+ | åˆ†å¸ƒå¼é”+ä¹è§‚é” |

#### 2.2.2 åº“å­˜çŠ¶æ€æµè½¬

```mermaid
stateDiagram-v2
    [*] --> å¯ç”¨åº“å­˜
    å¯ç”¨åº“å­˜ --> é”å®šåº“å­˜: ä¸‹å•é”å®š
    é”å®šåº“å­˜ --> å¯ç”¨åº“å­˜: è®¢å•å–æ¶ˆ
    é”å®šåº“å­˜ --> æ‹£è´§ä¸­: å¼€å§‹æ‹£è´§
    æ‹£è´§ä¸­ --> å·²å‡ºåº“: å‡ºåº“å®Œæˆ
    å·²å‡ºåº“ --> [*]
    
    å¯ç”¨åº“å­˜ --> å†»ç»“åº“å­˜: è´¨é‡é—®é¢˜
    å†»ç»“åº“å­˜ --> å¯ç”¨åº“å­˜: é—®é¢˜è§£å†³
    å†»ç»“åº“å­˜ --> æŠ¥æŸåº“å­˜: æ— æ³•ä½¿ç”¨
    æŠ¥æŸåº“å­˜ --> [*]
```

**çŠ¶æ€è¯´æ˜ï¼š**
- **å¯ç”¨åº“å­˜**ï¼šæ­£å¸¸å¯é”€å”®/å¯ç”¨çŠ¶æ€
- **é”å®šåº“å­˜**ï¼šå·²åˆ†é…ç»™è®¢å•ä½†æœªå‡ºåº“ï¼ˆè®¢å•å–æ¶ˆåè‡ªåŠ¨é‡Šæ”¾ï¼‰
- **æ‹£è´§ä¸­**ï¼šæ­£åœ¨æ‰§è¡Œæ‹£è´§ä»»åŠ¡
- **å†»ç»“åº“å­˜**ï¼šè´¨æ£€ä¸åˆæ ¼ã€ä¸´æœŸå•†å“ç­‰
- **æŠ¥æŸåº“å­˜**ï¼šå·²æŸåéœ€æŠ¥æŸå¤„ç†

#### 2.2.3 åº“å­˜æ‰£å‡ç­–ç•¥

**ä¸ºä»€ä¹ˆé‡‡ç”¨"ä¸‹å•é”å®š + å‡ºåº“æ‰£å‡"æ¨¡å¼ï¼Ÿ**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **ä¸‹å•ç›´æ¥æ‰£å‡** | å®ç°ç®€å• | è®¢å•å–æ¶ˆéœ€å›æ»šã€åº“å­˜å ç”¨ç‡ä½ | ä½é€€æ¬¾ç‡ä¸šåŠ¡ |
| **ä¸‹å•é”å®š+å‡ºåº“æ‰£å‡** âœ… | åº“å­˜åˆ©ç”¨ç‡é«˜ã€æ”¯æŒè¶…å–æ§åˆ¶ | å®ç°å¤æ‚ã€éœ€é”å®šæœºåˆ¶ | é«˜å¹¶å‘ç”µå•†åœºæ™¯ |
| **é¢„æ‰£+å¼‚æ­¥ç¡®è®¤** | æ€§èƒ½å¥½ | æœ€ç»ˆä¸€è‡´æ€§ã€è¡¥å¿é€»è¾‘å¤æ‚ | ç§’æ€åœºæ™¯ |

**æˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆ2çš„ç†ç”±ï¼š**
1. **æé«˜åº“å­˜åˆ©ç”¨ç‡**ï¼šè®¢å•æ”¯ä»˜å‰åº“å­˜ä»å¯é”€å”®ï¼ˆè®¾ç½®é”å®šæ—¶æ•ˆï¼‰
2. **é˜²æ­¢è¶…å–**ï¼šé€šè¿‡Redisåˆ†å¸ƒå¼é”ä¿è¯åŸå­æ€§
3. **æ”¯æŒçµæ´»ç­–ç•¥**ï¼šå¯é…ç½®é”å®šæ—¶é•¿ã€è‡ªåŠ¨é‡Šæ”¾è§„åˆ™

#### 2.2.4 å¹¶å‘åº“å­˜æ‰£å‡æ–¹æ¡ˆ

**æ ¸å¿ƒæŒ‘æˆ˜ï¼š** é«˜å¹¶å‘åœºæ™¯ä¸‹å¦‚ä½•ä¿è¯åº“å­˜æ‰£å‡çš„å‡†ç¡®æ€§å’Œæ€§èƒ½ï¼Ÿ

```java
/**
 * åº“å­˜æ‰£å‡ - ä¸‰é‡ä¿éšœæœºåˆ¶
 * 1. Redisåˆ†å¸ƒå¼é”ï¼šä¿è¯åŒä¸€å•†å“åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œ
 * 2. æ•°æ®åº“è¡Œé”(FOR UPDATE)ï¼šä¿è¯æ•°æ®åº“å±‚é¢çš„å¹¶å‘å®‰å…¨
 * 3. ä¹è§‚é”(ç‰ˆæœ¬å·)ï¼šä½œä¸ºå…œåº•æœºåˆ¶
 */
@Override
@Transactional(rollbackFor = Exception.class)
public boolean deductInventory(Long goodsId, BigDecimal quantity) {
    // åˆ†å¸ƒå¼é”Key
    String lockKey = "inventory:lock:" + goodsId;
    RLock lock = redissonClient.getLock(lockKey);
    
    try {
        // 1. å°è¯•è·å–åˆ†å¸ƒå¼é”ï¼ˆç­‰å¾…3ç§’ï¼Œé”å®š10ç§’ï¼‰
        boolean acquired = lock.tryLock(3, 10, TimeUnit.SECONDS);
        if (!acquired) {
            throw new BizException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        // 2. æŸ¥è¯¢åº“å­˜ï¼ˆè¡Œé”ï¼‰
        Inventory inventory = inventoryMapper.selectForUpdate(goodsId);
        
        // 3. æ£€æŸ¥åº“å­˜å……è¶³æ€§
        if (inventory.getAvailableQuantity().compareTo(quantity) < 0) {
            throw new BizException("åº“å­˜ä¸è¶³");
        }
        
        // 4. æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ï¼‰
        int updated = inventoryMapper.deductWithVersion(
            goodsId, quantity, inventory.getVersion()
        );
        
        if (updated == 0) {
            throw new BizException("åº“å­˜æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // 5. è®°å½•åº“å­˜æµæ°´ï¼ˆå¼‚æ­¥ï¼‰
        inventoryLogProducer.sendLog(inventory, quantity);
        
        // 6. æ¸…é™¤ç¼“å­˜
        redisTemplate.delete("inventory:" + goodsId);
        
        return true;
        
    } finally {
        // é‡Šæ”¾é”
        if (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
```

**æ€§èƒ½ä¼˜åŒ–ç‚¹ï¼š**
- é”ç²’åº¦ï¼šæŒ‰å•†å“IDåŠ é”ï¼Œä¸åŒå•†å“å¹¶è¡Œå¤„ç†
- é”ç­‰å¾…ï¼š3ç§’è¶…æ—¶å¿«é€Ÿå¤±è´¥ï¼Œé¿å…çº¿ç¨‹å †ç§¯
- å¼‚æ­¥æ—¥å¿—ï¼šåº“å­˜æµæ°´å¼‚æ­¥è®°å½•ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- ç¼“å­˜åˆ é™¤ï¼šæ‰£å‡åç«‹å³åˆ é™¤ç¼“å­˜ï¼Œä¿è¯ä¸‹æ¬¡æŸ¥è¯¢æœ€æ–°æ•°æ®

#### 2.2.5 åº“å­˜é¢„è­¦æœºåˆ¶

**è®¾è®¡æ€è·¯ï¼š** å¤šç»´åº¦ã€æ™ºèƒ½åŒ–çš„åº“å­˜é¢„è­¦ä½“ç³»

```mermaid
graph LR
    A[åº“å­˜æ•°æ®] --> B{é¢„è­¦è§„åˆ™å¼•æ“}
    B --> C[å®‰å…¨åº“å­˜é¢„è­¦]
    B --> D[åº“é¾„é¢„è­¦]
    B --> E[æ»é”€é¢„è­¦]
    B --> F[åº“ä½åˆ©ç”¨ç‡é¢„è­¦]
    
    C --> G[å®æ—¶å‘Šè­¦]
    D --> G
    E --> G
    F --> G
    
    G --> H[é’‰é’‰/ä¼å¾®]
    G --> I[çŸ­ä¿¡]
    G --> J[ç«™å†…æ¶ˆæ¯]
    
    style A fill:#e1f5fe
    style B fill:#fff3e0
    style G fill:#ffcdd2
```

**é¢„è­¦è§„åˆ™é…ç½®ï¼š**

| é¢„è­¦ç±»å‹ | è§¦å‘æ¡ä»¶ | é¢„è­¦çº§åˆ« | å¤„ç†å»ºè®® |
|---------|---------|---------|---------|
| å®‰å…¨åº“å­˜ | å¯ç”¨åº“å­˜ < å®‰å…¨åº“å­˜ | âš ï¸ è­¦å‘Š | åŠæ—¶è¡¥è´§ |
| ç¼ºè´§ | å¯ç”¨åº“å­˜ = 0 | ğŸ”´ ä¸¥é‡ | ç´§æ€¥é‡‡è´­ |
| åº“é¾„è¶…æœŸ | å…¥åº“å¤©æ•° > 90å¤© | âš ï¸ è­¦å‘Š | ä¿ƒé”€æ¸…ä»“ |
| ä¸´æœŸå•†å“ | è·ç¦»è¿‡æœŸ < 30å¤© | ğŸ”´ ä¸¥é‡ | åŠ é€Ÿé”€å”® |
| æ»é”€ | 30å¤©é”€é‡ = 0 | âš ï¸ è­¦å‘Š | è°ƒæ•´ç­–ç•¥ |
| åº“ä½å æ»¡ | åº“ä½åˆ©ç”¨ç‡ > 95% | âš ï¸ è­¦å‘Š | æ‰©å®¹/æ¸…ç† |

```java
/**
 * åº“å­˜é¢„è­¦å®šæ—¶ä»»åŠ¡
 * æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡å…¨é‡æ‰«æ
 */
@Scheduled(cron = "0 0 * * * ?")
public void checkInventoryAlert() {
    // 1. å®‰å…¨åº“å­˜é¢„è­¦
    List<Inventory> lowStock = inventoryMapper.selectBelowSafetyStock();
    lowStock.forEach(inv -> {
        AlertMessage alert = AlertMessage.builder()
            .type("SAFETY_STOCK")
            .level("WARNING")
            .goodsName(inv.getGoodsName())
            .currentQty(inv.getAvailableQuantity())
            .safetyQty(inv.getSafetyStock())
            .suggestion("å»ºè®®è¡¥è´§æ•°é‡ï¼š" + (inv.getSafetyStock().multiply(new BigDecimal("1.5"))))
            .build();
        alertService.send(alert);
    });
    
    // 2. åº“é¾„é¢„è­¦ï¼ˆè¶…è¿‡90å¤©ï¼‰
    LocalDateTime deadline = LocalDateTime.now().minusDays(90);
    List<Inventory> aged = inventoryMapper.selectByInboundDateBefore(deadline);
    // ... å‘é€é¢„è­¦
    
    // 3. ä¸´æœŸå•†å“é¢„è­¦ï¼ˆ30å¤©å†…è¿‡æœŸï¼‰
    LocalDate expireDeadline = LocalDate.now().plusDays(30);
    List<Inventory> nearExpire = inventoryMapper.selectByExpireDateBefore(expireDeadline);
    // ... å‘é€é¢„è­¦
}
```

#### 2.2.6 åº“å­˜å¿«ç…§ä¸å¯¹è´¦

**ä¸ºä»€ä¹ˆéœ€è¦åº“å­˜å¿«ç…§ï¼Ÿ**
- æ•°æ®è¿½æº¯ï¼šå‡ºç°åº“å­˜å·®å¼‚æ—¶å¿«é€Ÿå®šä½é—®é¢˜æ—¶é—´ç‚¹
- æŠ¥è¡¨ç»Ÿè®¡ï¼šæœˆæœ«/å¹´æœ«åº“å­˜æŠ¥è¡¨ç”Ÿæˆ
- å®¡è®¡åˆè§„ï¼šæ»¡è¶³è´¢åŠ¡å®¡è®¡è¦æ±‚

```java
/**
 * åº“å­˜å¿«ç…§ - æ¯æ—¥å‡Œæ™¨è‡ªåŠ¨ç”Ÿæˆ
 */
@Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹
public void createDailySnapshot() {
    String snapshotDate = LocalDate.now().toString();
    
    // 1. æŸ¥è¯¢æ‰€æœ‰åº“å­˜
    List<Inventory> inventories = inventoryMapper.selectAll();
    
    // 2. æ‰¹é‡æ’å…¥å¿«ç…§è¡¨
    List<InventorySnapshot> snapshots = inventories.stream()
        .map(inv -> InventorySnapshot.builder()
            .snapshotDate(snapshotDate)
            .warehouseId(inv.getWarehouseId())
            .goodsId(inv.getGoodsId())
            .quantity(inv.getQuantity())
            .lockQuantity(inv.getLockQuantity())
            .build())
        .collect(Collectors.toList());
    
    snapshotMapper.batchInsert(snapshots);
    
    // 3. è§¦å‘åº“å­˜å¯¹è´¦ä»»åŠ¡
    reconciliationService.reconcile(snapshotDate);
}

/**
 * åº“å­˜å¯¹è´¦ - ç³»ç»Ÿåº“å­˜ vs å®é™…ç›˜ç‚¹
 */
public ReconciliationResult reconcile(String date) {
    // 1. è·å–ç³»ç»Ÿåº“å­˜å¿«ç…§
    List<InventorySnapshot> systemStock = snapshotMapper.selectByDate(date);
    
    // 2. è·å–å®é™…ç›˜ç‚¹æ•°æ®
    List<StockTaking> actualStock = stockTakingMapper.selectByDate(date);
    
    // 3. å¯¹æ¯”å·®å¼‚
    List<InventoryDiff> diffs = compareInventory(systemStock, actualStock);
    
    // 4. ç”Ÿæˆå¯¹è´¦æŠ¥å‘Š
    return ReconciliationResult.builder()
        .date(date)
        .totalItems(systemStock.size())
        .diffItems(diffs.size())
        .diffRate(diffs.size() * 100.0 / systemStock.size())
        .details(diffs)
        .build();
}
```

### 2.3 å…¥åº“ç®¡ç†

#### å…¥åº“æµç¨‹

```mermaid
flowchart TD
    Start([å…¥åº“å•åˆ›å»º]) --> Review{å®¡æ ¸}
    Review -->|é€šè¿‡| Plan[åˆ¶å®šå…¥åº“è®¡åˆ’]
    Review -->|é©³å›| End1([ç»“æŸ])
    
    Plan --> Assign[åˆ†é…åº“ä½]
    Assign --> Receive[å®ç‰©éªŒæ”¶]
    
    Receive --> Quality{è´¨æ£€}
    Quality -->|åˆæ ¼| PutAway[ä¸Šæ¶]
    Quality -->|ä¸åˆæ ¼| Return[é€€å›ä¾›åº”å•†]
    
    PutAway --> UpdateInv[æ›´æ–°åº“å­˜]
    UpdateInv --> Complete([å…¥åº“å®Œæˆ])
    
    Return --> End2([é€€è´§ç»“æŸ])
    
    style Start fill:#e8f5e9
    style Complete fill:#c8e6c9
    style End1 fill:#ffcdd2
    style End2 fill:#ffcdd2
```

#### å…¥åº“ç±»å‹

- **é‡‡è´­å…¥åº“**ï¼šä¾›åº”å•†é‡‡è´­åˆ°è´§
- **é€€è´§å…¥åº“**ï¼šå®¢æˆ·é€€è´§å…¥åº“
- **è°ƒæ‹¨å…¥åº“**ï¼šå…¶ä»–ä»“åº“è°ƒå…¥
- **ç›˜ç›ˆå…¥åº“**ï¼šç›˜ç‚¹å‘ç°å¤šä½™åº“å­˜
- **ç”Ÿäº§å…¥åº“**ï¼šç”Ÿäº§å®Œå·¥å…¥åº“

### 2.4 å‡ºåº“ç®¡ç†

#### å‡ºåº“æµç¨‹

```mermaid
flowchart TD
    Order([å‡ºåº“è®¢å•]) --> Audit{è®¢å•å®¡æ ¸}
    Audit -->|é€šè¿‡| Allocate[åº“å­˜åˆ†é…]
    Audit -->|é©³å›| Cancel1([è®¢å•å–æ¶ˆ])
    
    Allocate --> CheckStock{åº“å­˜å……è¶³?}
    CheckStock -->|æ˜¯| CreateWave[åˆ›å»ºæ³¢æ¬¡]
    CheckStock -->|å¦| Wait[ç­‰å¾…è¡¥è´§]
    
    Wait --> CheckStock
    
    CreateWave --> AssignPicker[åˆ†é…æ‹£è´§å‘˜]
    AssignPicker --> Picking[æ‰§è¡Œæ‹£è´§]
    
    Picking --> Review{å¤æ ¸}
    Review -->|é€šè¿‡| Pack[æ‰“åŒ…]
    Review -->|å¼‚å¸¸| Repick[é‡æ–°æ‹£è´§]
    
    Repick --> Picking
    
    Pack --> Ship[å‘è´§]
    Ship --> UpdateInv[æ›´æ–°åº“å­˜]
    UpdateInv --> Complete([å‡ºåº“å®Œæˆ])
    
    style Order fill:#e8f5e9
    style Complete fill:#c8e6c9
    style Cancel1 fill:#ffcdd2
```

### 2.5 æ‹£è´§ç®¡ç†

#### 2.5.1 æ‹£è´§ç­–ç•¥å¯¹æ¯”

```mermaid
graph TB
    subgraph PickStrategy["ğŸ¯ æ‹£è´§ç­–ç•¥"]
        Single["å•å“æ‹£è´§<br/>Pick by Item<br/>é€‚ç”¨ï¼šå°‘é‡è®¢å•"]
        Batch["æ‰¹æ¬¡æ‹£è´§<br/>Pick by Batch<br/>é€‚ç”¨ï¼šå¤šè®¢å•åŒå“"]
        Zone["åˆ†åŒºæ‹£è´§<br/>Pick by Zone<br/>é€‚ç”¨ï¼šå¤§å‹ä»“åº“"]
        Wave["æ³¢æ¬¡æ‹£è´§<br/>Pick by Wave<br/>é€‚ç”¨ï¼šé«˜å¹¶å‘"]
    end
    
    subgraph Optimization["âš¡ è·¯å¾„ä¼˜åŒ–"]
        ShortestPath["æœ€çŸ­è·¯å¾„ç®—æ³•"]
        TimeWindow["æ—¶é—´çª—å£è°ƒåº¦"]
        LoadBalance["è´Ÿè½½å‡è¡¡"]
    end
    
    PickStrategy --> Optimization
    
    classDef strategyStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef optStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    
    class Single,Batch,Zone,Wave strategyStyle
    class ShortestPath,TimeWindow,LoadBalance optStyle
```

**ç­–ç•¥è¯¦ç»†å¯¹æ¯”ï¼š**

| ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ•ˆç‡æå‡ |
|------|---------|------|------|---------|
| **å•å“æ‹£è´§** | B2Bå¤§å•ã€ç‰¹æ®Šå•†å“ | å‡†ç¡®ç‡é«˜ã€æµç¨‹ç®€å• | æ•ˆç‡ä½ã€é‡å¤è·¯å¾„ | åŸºå‡† |
| **æ‰¹æ¬¡æ‹£è´§** âœ… | ç”µå•†å¤šå•ã€ç›¸åŒSKU | å‡å°‘è¡Œèµ°è·¯å¾„ã€æå‡æ•ˆç‡ | éœ€äºŒæ¬¡åˆ†æ‹£ | æå‡30% |
| **åˆ†åŒºæ‹£è´§** | å¤§å‹ä»“åº“ã€å¤šåº“åŒº | å¹¶è¡Œä½œä¸šã€é™ä½æ‹¥å µ | éœ€äº¤æ¥åŒºã€åè°ƒå¤æ‚ | æå‡50% |
| **æ³¢æ¬¡æ‹£è´§** âœ… | é«˜å¹¶å‘è®¢å•ã€å¤§ä¿ƒåœºæ™¯ | æœ€å¤§åŒ–æ•ˆç‡ã€æ™ºèƒ½è°ƒåº¦ | ç³»ç»Ÿå¤æ‚åº¦é«˜ | æå‡60% |

**æˆ‘ä»¬é‡‡ç”¨"æ³¢æ¬¡æ‹£è´§+æ‰¹æ¬¡æ‹£è´§"ç»„åˆç­–ç•¥çš„åŸå› ï¼š**

1. **è®¢å•èšåˆ**ï¼šå°†æ—¶é—´çª—å£å†…çš„è®¢å•èšåˆæˆæ³¢æ¬¡ï¼Œä¸€æ¬¡æ€§å¤„ç†
2. **è·¯å¾„ä¼˜åŒ–**ï¼šæ³¢æ¬¡å†…ç»Ÿä¸€è§„åˆ’æ‹£è´§è·¯å¾„ï¼Œå‡å°‘é‡å¤è¡Œèµ°
3. **äººå‘˜å‡è¡¡**ï¼šæ ¹æ®æ‹£è´§å‘˜ä½ç½®å’Œå·¥ä½œé‡æ™ºèƒ½åˆ†é…ä»»åŠ¡
4. **çµæ´»è°ƒæ•´**ï¼šæ”¯æŒç´§æ€¥è®¢å•æ’å…¥ã€ä¼˜å…ˆçº§è°ƒæ•´

#### 2.5.2 æ³¢æ¬¡ç”Ÿæˆç®—æ³•

**æ ¸å¿ƒç›®æ ‡ï¼š** åœ¨æ»¡è¶³æ—¶æ•ˆè¦æ±‚çš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–æ‹£è´§æ•ˆç‡

```java
/**
 * æ³¢æ¬¡ç”Ÿæˆç­–ç•¥
 * è€ƒè™‘å› ç´ ï¼šè®¢å•ä¼˜å…ˆçº§ã€å•†å“ä½ç½®ã€æ‹£è´§å‘˜çŠ¶æ€ã€æˆªå•æ—¶é—´
 */
@Service
public class WaveGenerationService {
    
    /**
     * æ™ºèƒ½ç”Ÿæˆæ³¢æ¬¡
     * @param orders å¾…å¤„ç†è®¢å•åˆ—è¡¨
     * @return æ³¢æ¬¡åˆ—è¡¨
     */
    public List<PickingWave> generateWaves(List<Order> orders) {
        List<PickingWave> waves = new ArrayList<>();
        
        // 1. è®¢å•é¢„å¤„ç†ï¼šæŒ‰ä¼˜å…ˆçº§ã€æˆªå•æ—¶é—´æ’åº
        orders.sort(Comparator
            .comparing(Order::getPriority).reversed()
            .thenComparing(Order::getDeadline));
        
        // 2. è®¢å•èšç±»ï¼šç›¸åŒåº“åŒºã€ç›¸ä¼¼è·¯å¾„çš„è®¢å•åˆ†ä¸ºä¸€ç»„
        Map<String, List<Order>> clusters = clusterOrders(orders);
        
        // 3. ç”Ÿæˆæ³¢æ¬¡ï¼šæ¯ä¸ªèšç±»ç”Ÿæˆä¸€ä¸ªæ³¢æ¬¡
        for (Map.Entry<String, List<Order>> entry : clusters.entrySet()) {
            List<Order> clusterOrders = entry.getValue();
            
            // æ³¢æ¬¡å¤§å°æ§åˆ¶ï¼š30-50å•/æ³¢æ¬¡ï¼ˆæ ¹æ®ä»“åº“è§„æ¨¡è°ƒæ•´ï¼‰
            int waveSize = 40;
            for (int i = 0; i < clusterOrders.size(); i += waveSize) {
                List<Order> waveOrders = clusterOrders.subList(
                    i, Math.min(i + waveSize, clusterOrders.size())
                );
                
                PickingWave wave = PickingWave.builder()
                    .waveNo(generateWaveNo())
                    .orders(waveOrders)
                    .priority(calculateWavePriority(waveOrders))
                    .estimatedTime(estimatePickingTime(waveOrders))
                    .status(WaveStatus.PENDING)
                    .build();
                
                waves.add(wave);
            }
        }
        
        return waves;
    }
    
    /**
     * è®¢å•èšç±»ç®—æ³•ï¼ˆK-meanså˜ç§ï¼‰
     * æ ¹æ®å•†å“ä½ç½®ä¿¡æ¯ï¼Œå°†è®¢å•èšç±»åˆ°ç›¸ä¼¼åŒºåŸŸ
     */
    private Map<String, List<Order>> clusterOrders(List<Order> orders) {
        Map<String, List<Order>> clusters = new HashMap<>();
        
        for (Order order : orders) {
            // è®¡ç®—è®¢å•çš„"é‡å¿ƒä½ç½®"ï¼ˆæ‰€æœ‰å•†å“ä½ç½®çš„å¹³å‡å€¼ï¼‰
            Location centerLocation = calculateCenterLocation(order);
            
            // åˆ†é…åˆ°æœ€è¿‘çš„åº“åŒº
            String zoneCode = locationService.getNearestZone(centerLocation);
            
            clusters.computeIfAbsent(zoneCode, k -> new ArrayList<>()).add(order);
        }
        
        return clusters;
    }
    
    /**
     * ä¼°ç®—æ‹£è´§æ—¶é—´
     * å…¬å¼ï¼šåŸºç¡€æ—¶é—´ + å•†å“æ•°é‡Ã—å•å“æ—¶é—´ + è¡Œèµ°è·ç¦»Ã—ç§»åŠ¨æ—¶é—´
     */
    private int estimatePickingTime(List<Order> orders) {
        int baseTime = 60; // åŸºç¡€å‡†å¤‡æ—¶é—´ï¼š60ç§’
        int itemTime = 10; // æ¯ä¸ªå•†å“æ‹£é€‰æ—¶é—´ï¼š10ç§’
        int moveSpeed = 1; // ç§»åŠ¨é€Ÿåº¦ï¼š1ç±³/ç§’
        
        // ç»Ÿè®¡å•†å“æ€»æ•°
        int totalItems = orders.stream()
            .mapToInt(order -> order.getItems().size())
            .sum();
        
        // è®¡ç®—æ‹£è´§è·¯å¾„æ€»é•¿åº¦
        double totalDistance = calculatePathDistance(orders);
        
        return baseTime + (totalItems * itemTime) + (int)(totalDistance / moveSpeed);
    }
}
```

#### 2.5.3 æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•

**é—®é¢˜æœ¬è´¨ï¼š** æ—…è¡Œå•†é—®é¢˜(TSP)çš„å˜ç§ - è®¿é—®æ‰€æœ‰åº“ä½å¹¶å›åˆ°èµ·ç‚¹ï¼Œè·¯å¾„æœ€çŸ­

**ç®—æ³•é€‰æ‹©ï¼š**

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ä¼˜åŒ–æ•ˆæœ | é€‚ç”¨è§„æ¨¡ | æ˜¯å¦é‡‡ç”¨ |
|------|-----------|---------|---------|---------|
| æš´åŠ›æšä¸¾ | O(n!) | 100%æœ€ä¼˜ | n < 10 | âŒ ä¸å®ç”¨ |
| åŠ¨æ€è§„åˆ’ | O(nÂ²Â·2â¿) | 100%æœ€ä¼˜ | n < 20 | âŒ æ€§èƒ½å·® |
| **è´ªå¿ƒç®—æ³•** | O(nÂ²) | 80-90%ä¼˜åŒ– | n < 1000 | âœ… é‡‡ç”¨ |
| é—ä¼ ç®—æ³• | O(nÂ·gÂ·p) | 85-95%ä¼˜åŒ– | n > 1000 | âšª å¤‡é€‰ |

**æˆ‘ä»¬é‡‡ç”¨è´ªå¿ƒç®—æ³•çš„åŸå› ï¼š**
- å®æ—¶æ€§è¦æ±‚ï¼šæ‹£è´§ä»»åŠ¡éœ€è¦ç§’çº§å“åº”ï¼Œä¸èƒ½ç­‰å¾…é•¿æ—¶é—´è®¡ç®—
- æ•ˆæœè¶³å¤Ÿï¼š80-90%çš„ä¼˜åŒ–æ•ˆæœå·²èƒ½æ˜¾è‘—æå‡æ•ˆç‡
- å®ç°ç®€å•ï¼šä¾¿äºç»´æŠ¤å’Œè°ƒæ•´

```java
/**
 * æ‹£è´§è·¯å¾„ä¼˜åŒ– - æ”¹è¿›çš„è´ªå¿ƒç®—æ³•
 * ä»åº“åŒºå…¥å£å¼€å§‹ï¼Œæ¯æ¬¡é€‰æ‹©è·ç¦»å½“å‰ä½ç½®æœ€è¿‘ä¸”æœªè®¿é—®çš„åº“ä½
 */
@Service
public class PickingPathOptimizer {
    
    /**
     * ä¼˜åŒ–æ‹£è´§è·¯å¾„
     * @param locations éœ€è¦è®¿é—®çš„åº“ä½åˆ—è¡¨
     * @return ä¼˜åŒ–åçš„åº“ä½é¡ºåº
     */
    public List<Location> optimizePath(List<Location> locations) {
        if (locations.size() <= 1) {
            return locations;
        }
        
        List<Location> optimizedPath = new ArrayList<>();
        Set<Location> unvisited = new HashSet<>(locations);
        
        // 1. èµ·ç‚¹ï¼šé€‰æ‹©è·ç¦»åº“åŒºå…¥å£æœ€è¿‘çš„åº“ä½
        Location entrance = getWarehouseEntrance();
        Location current = findNearest(entrance, unvisited);
        optimizedPath.add(current);
        unvisited.remove(current);
        
        // 2. è´ªå¿ƒé€‰æ‹©ï¼šæ¯æ¬¡é€‰æ‹©æœ€è¿‘çš„æœªè®¿é—®åº“ä½
        while (!unvisited.isEmpty()) {
            Location nearest = findNearest(current, unvisited);
            optimizedPath.add(nearest);
            unvisited.remove(nearest);
            current = nearest;
        }
        
        // 3. è·¯å¾„å¾®è°ƒï¼šæ£€æµ‹å¹¶æ¶ˆé™¤äº¤å‰è·¯å¾„ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
        optimizedPath = eliminateCrossings(optimizedPath);
        
        return optimizedPath;
    }
    
    /**
     * è®¡ç®—ä¸¤ä¸ªåº“ä½ä¹‹é—´çš„æ›¼å“ˆé¡¿è·ç¦»
     * ä»“åº“é€šé“ä¸ºç›´è§’ç»“æ„ï¼Œä¸èƒ½æ–œç©¿ï¼Œå› æ­¤ä½¿ç”¨æ›¼å“ˆé¡¿è·ç¦»è€Œéæ¬§å¼è·ç¦»
     */
    private double calculateDistance(Location loc1, Location loc2) {
        // æ¨ªå‘è·ç¦»
        int rowDiff = Math.abs(loc1.getRowNo() - loc2.getRowNo());
        // çºµå‘è·ç¦»  
        int colDiff = Math.abs(loc1.getColumnNo() - loc2.getColumnNo());
        // å±‚é—´è·ç¦»ï¼ˆçˆ¬æ¥¼æ¢¯æˆæœ¬æ›´é«˜ï¼‰
        int layerDiff = Math.abs(loc1.getLayerNo() - loc2.getLayerNo());
        
        // åŠ æƒè®¡ç®—ï¼šå±‚é—´ç§»åŠ¨æˆæœ¬æ˜¯æ°´å¹³ç§»åŠ¨çš„2å€
        return rowDiff + colDiff + layerDiff * 2.0;
    }
    
    /**
     * æŸ¥æ‰¾è·ç¦»ç›®æ ‡ä½ç½®æœ€è¿‘çš„åº“ä½
     */
    private Location findNearest(Location target, Set<Location> candidates) {
        return candidates.stream()
            .min(Comparator.comparingDouble(loc -> calculateDistance(target, loc)))
            .orElseThrow(() -> new BizException("æ²¡æœ‰å¯ç”¨çš„å€™é€‰åº“ä½"));
    }
    
    /**
     * æ¶ˆé™¤äº¤å‰è·¯å¾„ï¼ˆ2-optä¼˜åŒ–ï¼‰
     * æ£€æµ‹è·¯å¾„ä¸­çš„äº¤å‰ç‚¹ï¼Œå¹¶è¿›è¡Œå±€éƒ¨è°ƒæ•´
     */
    private List<Location> eliminateCrossings(List<Location> path) {
        boolean improved = true;
        List<Location> optimized = new ArrayList<>(path);
        
        // è¿­ä»£ä¼˜åŒ–ï¼Œç›´åˆ°æ²¡æœ‰æ”¹è¿›
        while (improved) {
            improved = false;
            
            // æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„è¾¹äº¤æ¢
            for (int i = 0; i < optimized.size() - 2; i++) {
                for (int j = i + 2; j < optimized.size() - 1; j++) {
                    // è®¡ç®—å½“å‰è·ç¦»
                    double currentDist = 
                        calculateDistance(optimized.get(i), optimized.get(i+1)) +
                        calculateDistance(optimized.get(j), optimized.get(j+1));
                    
                    // è®¡ç®—äº¤æ¢åçš„è·ç¦»
                    double newDist = 
                        calculateDistance(optimized.get(i), optimized.get(j)) +
                        calculateDistance(optimized.get(i+1), optimized.get(j+1));
                    
                    // å¦‚æœäº¤æ¢åæ›´çŸ­ï¼Œåˆ™æ‰§è¡Œäº¤æ¢
                    if (newDist < currentDist) {
                        // åè½¬ i+1 åˆ° j ä¹‹é—´çš„è·¯å¾„
                        Collections.reverse(
                            optimized.subList(i + 1, j + 1)
                        );
                        improved = true;
                    }
                }
            }
        }
        
        return optimized;
    }
}
```

**ä¼˜åŒ–æ•ˆæœå¯¹æ¯”ï¼š**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|-------|-------|---------|
| å¹³å‡æ‹£è´§è·¯å¾„ | 450ç±³ | 280ç±³ | â†“ 38% |
| å¹³å‡æ‹£è´§æ—¶é—´ | 25åˆ†é’Ÿ | 16åˆ†é’Ÿ | â†“ 36% |
| æ‹£è´§å‘˜æ—¥äº§èƒ½ | 180å• | 280å• | â†‘ 56% |
| è·¯å¾„äº¤å‰æ¬¡æ•° | 8æ¬¡ | 1æ¬¡ | â†“ 88% |

#### 2.5.4 æ‹£è´§ä»»åŠ¡åˆ†é…ç­–ç•¥

**ç›®æ ‡ï¼š** å®ç°æ‹£è´§å‘˜å·¥ä½œè´Ÿè½½å‡è¡¡ï¼Œæé«˜æ•´ä½“æ•ˆç‡

```java
/**
 * æ‹£è´§ä»»åŠ¡åˆ†é… - ç»¼åˆè¯„åˆ†ç®—æ³•
 * è€ƒè™‘å› ç´ ï¼šæ‹£è´§å‘˜å½“å‰ä½ç½®ã€å·¥ä½œè´Ÿè½½ã€æŠ€èƒ½ç­‰çº§ã€ä»»åŠ¡ä¼˜å…ˆçº§
 */
@Service
public class TaskAssignmentService {
    
    /**
     * ä¸ºæ³¢æ¬¡åˆ†é…æœ€åˆé€‚çš„æ‹£è´§å‘˜
     */
    public Picker assignPicker(PickingWave wave) {
        // 1. è·å–æ‰€æœ‰ç©ºé—²æˆ–å³å°†ç©ºé—²çš„æ‹£è´§å‘˜
        List<Picker> availablePickers = pickerService.getAvailablePickers();
        
        if (availablePickers.isEmpty()) {
            throw new BizException("æš‚æ— å¯ç”¨æ‹£è´§å‘˜");
        }
        
        // 2. è®¡ç®—æ¯ä¸ªæ‹£è´§å‘˜çš„ç»¼åˆè¯„åˆ†
        Picker bestPicker = availablePickers.stream()
            .max(Comparator.comparingDouble(picker -> 
                calculatePickerScore(picker, wave)))
            .orElseThrow();
        
        // 3. åˆ†é…ä»»åŠ¡
        wave.setPickerId(bestPicker.getId());
        wave.setStatus(WaveStatus.ASSIGNED);
        waveMapper.updateById(wave);
        
        // 4. é€šçŸ¥æ‹£è´§å‘˜ï¼ˆæ¨é€åˆ°PDAï¼‰
        pdaService.pushTask(bestPicker.getId(), wave);
        
        return bestPicker;
    }
    
    /**
     * æ‹£è´§å‘˜è¯„åˆ†ç®—æ³•
     * è¯„åˆ†è¶Šé«˜ï¼Œè¶Šé€‚åˆæ‰§è¡Œè¯¥ä»»åŠ¡
     */
    private double calculatePickerScore(Picker picker, PickingWave wave) {
        double score = 0;
        
        // 1. ä½ç½®å¾—åˆ†ï¼ˆ40%æƒé‡ï¼‰ï¼šæ‹£è´§å‘˜è·ç¦»ä»»åŠ¡èµ·ç‚¹è¶Šè¿‘ï¼Œå¾—åˆ†è¶Šé«˜
        Location waveStartLocation = wave.getStartLocation();
        double distance = calculateDistance(picker.getCurrentLocation(), waveStartLocation);
        double locationScore = Math.max(0, 100 - distance); // è·ç¦»æ¯å¢åŠ 1ç±³å‡1åˆ†
        score += locationScore * 0.4;
        
        // 2. è´Ÿè½½å¾—åˆ†ï¼ˆ30%æƒé‡ï¼‰ï¼šå½“å‰å·¥ä½œé‡è¶Šå°‘ï¼Œå¾—åˆ†è¶Šé«˜
        int currentTasks = picker.getCurrentTaskCount();
        double loadScore = Math.max(0, 100 - currentTasks * 10); // æ¯ä¸ªä»»åŠ¡å‡10åˆ†
        score += loadScore * 0.3;
        
        // 3. æŠ€èƒ½å¾—åˆ†ï¼ˆ20%æƒé‡ï¼‰ï¼šæŠ€èƒ½ç­‰çº§è¶Šé«˜ï¼Œå¾—åˆ†è¶Šé«˜
        double skillScore = picker.getSkillLevel() * 20; // 1-5çº§ï¼Œæ¯çº§20åˆ†
        score += skillScore * 0.2;
        
        // 4. æ•ˆç‡å¾—åˆ†ï¼ˆ10%æƒé‡ï¼‰ï¼šå†å²æ•ˆç‡è¶Šé«˜ï¼Œå¾—åˆ†è¶Šé«˜
        double efficiencyScore = picker.getEfficiencyRate(); // 0-100
        score += efficiencyScore * 0.1;
        
        return score;
    }
}
```

#### 2.5.5 æ‹£è´§å¼‚å¸¸å¤„ç†

**å¸¸è§å¼‚å¸¸åœºæ™¯åŠå¤„ç†æ–¹æ¡ˆï¼š**

| å¼‚å¸¸ç±»å‹ | è§¦å‘æ¡ä»¶ | å¤„ç†æ–¹æ¡ˆ | æ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥ |
|---------|---------|---------|---------------|
| åº“å­˜ä¸è¶³ | å®é™…åº“å­˜ < å¾…æ‹£æ•°é‡ | è‡ªåŠ¨å‡å•æˆ–è½¬é‡‡è´­ | âš ï¸ éœ€ç¡®è®¤ |
| å•†å“ç ´æŸ | è´¨æ£€å‘ç°é—®é¢˜ | æ ‡è®°æ®‹æ¬¡ã€å¯»æ‰¾æ›¿ä»£åº“ä½ | âœ… éœ€ä»‹å…¥ |
| åº“ä½ç©ºç¼º | æ‰«æåº“ä½æ— è´§ | è§¦å‘ç›˜ç‚¹ä»»åŠ¡ã€æŸ¥æ‰¾å…¶ä»–æ‰¹æ¬¡ | âœ… éœ€ä»‹å…¥ |
| æ‹£è´§è¶…æ—¶ | æ‰§è¡Œæ—¶é—´ > é¢„ä¼°æ—¶é—´Ã—1.5 | å‘é€æé†’ã€è§¦å‘ååŠ©è¯·æ±‚ | âš ï¸ è§†æƒ…å†µ |
| æ‹£é”™å•†å“ | å¤æ ¸å‘ç°SKUä¸ç¬¦ | å›é€€é‡æ‹£ã€è®°å½•é”™è¯¯ç‡ | âŒ è‡ªåŠ¨å¤„ç† |

```java
/**
 * æ‹£è´§å¼‚å¸¸å¤„ç†æœåŠ¡
 */
@Service
public class PickingExceptionHandler {
    
    /**
     * å¤„ç†åº“ä½ç©ºç¼ºå¼‚å¸¸
     * ç­–ç•¥ï¼šè‡ªåŠ¨å¯»æ‰¾æ›¿ä»£åº“ä½ -> å¤±è´¥åˆ™è½¬äººå·¥å¤„ç†
     */
    @Transactional(rollbackFor = Exception.class)
    public void handleEmptyLocation(PickingTask task, Location emptyLocation) {
        // 1. è®°å½•å¼‚å¸¸
        PickingException exception = PickingException.builder()
            .taskId(task.getId())
            .type(ExceptionType.EMPTY_LOCATION)
            .locationId(emptyLocation.getId())
            .build();
        exceptionMapper.insert(exception);
        
        // 2. è§¦å‘ç›˜ç‚¹ä»»åŠ¡ï¼ˆå¼‚æ­¥ï¼‰
        stockTakingService.createUrgentTask(emptyLocation);
        
        // 3. æŸ¥æ‰¾æ›¿ä»£åº“ä½
        List<Location> alternativeLocations = inventoryService
            .findAlternativeLocations(task.getGoodsId(), task.getBatchNo());
        
        if (!alternativeLocations.isEmpty()) {
            // æœ‰æ›¿ä»£åº“ä½ï¼Œè‡ªåŠ¨åˆ‡æ¢
            Location alternative = alternativeLocations.get(0);
            task.setLocationId(alternative.getId());
            task.setStatus(TaskStatus.RETRY);
            taskMapper.updateById(task);
            
            // æ¨é€æ–°åº“ä½ç»™æ‹£è´§å‘˜
            pdaService.pushLocationChange(task.getPickerId(), alternative);
        } else {
            // æ— æ›¿ä»£åº“ä½ï¼Œè½¬äººå·¥å¤„ç†
            task.setStatus(TaskStatus.EXCEPTION);
            taskMapper.updateById(task);
            
            // é€šçŸ¥ä»“åº“ä¸»ç®¡
            alertService.notifyManager(
                "æ‹£è´§å¼‚å¸¸ï¼šå•†å“æ— æ›¿ä»£åº“ä½",
                task.getGoodsName()
            );
        }
    }
}
```

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒè¡¨ç»“æ„

```mermaid
erDiagram
    WAREHOUSE ||--o{ WAREHOUSE_AREA : contains
    WAREHOUSE_AREA ||--o{ WAREHOUSE_LOCATION : contains
    WAREHOUSE_LOCATION ||--o{ INVENTORY : stores
    
    GOODS ||--o{ INVENTORY : has
    GOODS ||--o{ INBOUND_DETAIL : contains
    GOODS ||--o{ OUTBOUND_DETAIL : contains
    
    INBOUND_ORDER ||--o{ INBOUND_DETAIL : has
    OUTBOUND_ORDER ||--o{ OUTBOUND_DETAIL : has
    
    OUTBOUND_ORDER ||--o{ PICKING_TASK : generates
    PICKING_TASK ||--o{ PICKING_DETAIL : contains
    
    WAREHOUSE {
        bigint id PK
        string warehouse_code UK
        string warehouse_name
        string address
        int status
    }
    
    WAREHOUSE_AREA {
        bigint id PK
        bigint warehouse_id FK
        string area_code UK
        string area_name
        string area_type
    }
    
    WAREHOUSE_LOCATION {
        bigint id PK
        bigint area_id FK
        string location_code UK
        decimal capacity
        int status
    }
    
    GOODS {
        bigint id PK
        string sku_code UK
        string goods_name
        string category
        string unit
    }
    
    INVENTORY {
        bigint id PK
        bigint location_id FK
        bigint goods_id FK
        string batch_no
        decimal quantity
        int lock_quantity
    }
```

### 3.2 å®Œæ•´å»ºè¡¨è¯­å¥

```sql
-- ================================
-- WMS ä»“åº“ç®¡ç†ç³»ç»Ÿæ•°æ®åº“
-- ================================

CREATE DATABASE IF NOT EXISTS `wms` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `wms`;

-- ================================
-- 1. ä»“åº“åŸºç¡€è¡¨
-- ================================

-- ä»“åº“è¡¨
CREATE TABLE `warehouse` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_code` VARCHAR(50) NOT NULL COMMENT 'ä»“åº“ç¼–ç ',
    `warehouse_name` VARCHAR(100) NOT NULL COMMENT 'ä»“åº“åç§°',
    `warehouse_type` TINYINT(4) DEFAULT 1 COMMENT 'ä»“åº“ç±»å‹:1-æˆå“ä»“,2-åŸæ–™ä»“,3-åŠæˆå“ä»“',
    `province` VARCHAR(50) DEFAULT NULL COMMENT 'çœä»½',
    `city` VARCHAR(50) DEFAULT NULL COMMENT 'åŸå¸‚',
    `district` VARCHAR(50) DEFAULT NULL COMMENT 'åŒºå¿',
    `address` VARCHAR(200) DEFAULT NULL COMMENT 'è¯¦ç»†åœ°å€',
    `contact_person` VARCHAR(50) DEFAULT NULL COMMENT 'è”ç³»äºº',
    `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
    `total_area` DECIMAL(10,2) DEFAULT NULL COMMENT 'æ€»é¢ç§¯(å¹³æ–¹ç±³)',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_warehouse_code` (`warehouse_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä»“åº“è¡¨';

-- åº“åŒºè¡¨
CREATE TABLE `warehouse_area` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `area_code` VARCHAR(50) NOT NULL COMMENT 'åº“åŒºç¼–ç ',
    `area_name` VARCHAR(100) NOT NULL COMMENT 'åº“åŒºåç§°',
    `area_type` VARCHAR(20) DEFAULT NULL COMMENT 'åº“åŒºç±»å‹:STORAGE-å­˜å‚¨åŒº,PICKING-æ‹£è´§åŒº,STAGING-æš‚å­˜åŒº',
    `floor` INT(11) DEFAULT 1 COMMENT 'æ¥¼å±‚',
    `area_size` DECIMAL(10,2) DEFAULT NULL COMMENT 'é¢ç§¯',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_area_code` (`warehouse_id`, `area_code`),
    KEY `idx_warehouse` (`warehouse_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“åŒºè¡¨';

-- åº“ä½è¡¨
CREATE TABLE `warehouse_location` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `area_id` BIGINT(20) NOT NULL COMMENT 'åº“åŒºID',
    `location_code` VARCHAR(50) NOT NULL COMMENT 'åº“ä½ç¼–ç ',
    `location_type` VARCHAR(20) DEFAULT 'NORMAL' COMMENT 'åº“ä½ç±»å‹:NORMAL-æ™®é€š,TEMP-ä¸´æ—¶,DEFECT-æ®‹æ¬¡å“',
    `row_no` INT(11) DEFAULT NULL COMMENT 'æ’å·',
    `column_no` INT(11) DEFAULT NULL COMMENT 'åˆ—å·',
    `layer_no` INT(11) DEFAULT NULL COMMENT 'å±‚å·',
    `capacity` DECIMAL(10,2) DEFAULT NULL COMMENT 'å®¹é‡',
    `max_weight` DECIMAL(10,2) DEFAULT NULL COMMENT 'æœ€å¤§æ‰¿é‡(KG)',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-ç©ºé—²,2-å ç”¨,3-é”å®š,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_location_code` (`warehouse_id`, `location_code`),
    KEY `idx_area` (`area_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“ä½è¡¨';

-- ================================
-- 2. å•†å“ç®¡ç†è¡¨
-- ================================

-- å•†å“åˆ†ç±»è¡¨
CREATE TABLE `goods_category` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `category_code` VARCHAR(50) NOT NULL COMMENT 'åˆ†ç±»ç¼–ç ',
    `category_name` VARCHAR(100) NOT NULL COMMENT 'åˆ†ç±»åç§°',
    `parent_id` BIGINT(20) DEFAULT 0 COMMENT 'çˆ¶åˆ†ç±»ID',
    `level` INT(11) DEFAULT 1 COMMENT 'å±‚çº§',
    `sort_order` INT(11) DEFAULT 0 COMMENT 'æ’åº',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_category_code` (`category_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“åˆ†ç±»è¡¨';

-- å•†å“ä¿¡æ¯è¡¨
CREATE TABLE `goods` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `category_id` BIGINT(20) DEFAULT NULL COMMENT 'åˆ†ç±»ID',
    `brand` VARCHAR(100) DEFAULT NULL COMMENT 'å“ç‰Œ',
    `model` VARCHAR(100) DEFAULT NULL COMMENT 'å‹å·',
    `barcode` VARCHAR(50) DEFAULT NULL COMMENT 'æ¡å½¢ç ',
    `unit` VARCHAR(20) DEFAULT 'PCS' COMMENT 'è®¡é‡å•ä½',
    `spec` VARCHAR(200) DEFAULT NULL COMMENT 'è§„æ ¼',
    `weight` DECIMAL(10,3) DEFAULT NULL COMMENT 'é‡é‡(KG)',
    `volume` DECIMAL(10,3) DEFAULT NULL COMMENT 'ä½“ç§¯(ç«‹æ–¹ç±³)',
    `shelf_life` INT(11) DEFAULT NULL COMMENT 'ä¿è´¨æœŸ(å¤©)',
    `storage_temp_min` DECIMAL(5,2) DEFAULT NULL COMMENT 'æœ€ä½å­˜å‚¨æ¸©åº¦',
    `storage_temp_max` DECIMAL(5,2) DEFAULT NULL COMMENT 'æœ€é«˜å­˜å‚¨æ¸©åº¦',
    `need_batch` TINYINT(4) DEFAULT 0 COMMENT 'æ˜¯å¦æ‰¹æ¬¡ç®¡ç†:1-æ˜¯,0-å¦',
    `need_serial` TINYINT(4) DEFAULT 0 COMMENT 'æ˜¯å¦åºåˆ—å·ç®¡ç†:1-æ˜¯,0-å¦',
    `safety_stock` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®‰å…¨åº“å­˜',
    `max_stock` DECIMAL(10,2) DEFAULT NULL COMMENT 'æœ€å¤§åº“å­˜',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_sku_code` (`sku_code`),
    KEY `idx_category` (`category_id`),
    KEY `idx_barcode` (`barcode`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“ä¿¡æ¯è¡¨';

-- ================================
-- 3. åº“å­˜ç®¡ç†è¡¨
-- ================================

-- åº“å­˜è¡¨
CREATE TABLE `inventory` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'åº“ä½ID',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `serial_no` VARCHAR(50) DEFAULT NULL COMMENT 'åºåˆ—å·',
    `quantity` DECIMAL(10,2) NOT NULL DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
    `lock_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'é”å®šæ•°é‡',
    `available_quantity` DECIMAL(10,2) GENERATED ALWAYS AS (`quantity` - `lock_quantity`) VIRTUAL COMMENT 'å¯ç”¨æ•°é‡',
    `production_date` DATE DEFAULT NULL COMMENT 'ç”Ÿäº§æ—¥æœŸ',
    `expire_date` DATE DEFAULT NULL COMMENT 'è¿‡æœŸæ—¥æœŸ',
    `inbound_date` DATETIME DEFAULT NULL COMMENT 'å…¥åº“æ—¥æœŸ',
    `supplier_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¾›åº”å•†ID',
    `supplier_name` VARCHAR(100) DEFAULT NULL COMMENT 'ä¾›åº”å•†åç§°',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-æ­£å¸¸,2-å†»ç»“,3-å¾…æ£€,4-æŸå',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_inventory` (`warehouse_id`, `location_id`, `goods_id`, `batch_no`, `serial_no`),
    KEY `idx_goods` (`goods_id`),
    KEY `idx_location` (`location_id`),
    KEY `idx_batch` (`batch_no`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜è¡¨';

-- åº“å­˜æµæ°´è¡¨
CREATE TABLE `inventory_log` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'åº“ä½ID',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `operation_type` VARCHAR(20) NOT NULL COMMENT 'æ“ä½œç±»å‹:INBOUND-å…¥åº“,OUTBOUND-å‡ºåº“,MOVE-ç§»åº“,LOCK-é”å®š,UNLOCK-è§£é”',
    `quantity_before` DECIMAL(10,2) DEFAULT NULL COMMENT 'æ“ä½œå‰æ•°é‡',
    `quantity_change` DECIMAL(10,2) NOT NULL COMMENT 'å˜åŒ–æ•°é‡',
    `quantity_after` DECIMAL(10,2) DEFAULT NULL COMMENT 'æ“ä½œåæ•°é‡',
    `business_type` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    `business_no` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸šåŠ¡å•å·',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_warehouse_goods` (`warehouse_id`, `goods_id`),
    KEY `idx_business` (`business_type`, `business_no`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜æµæ°´è¡¨';

-- ================================
-- 4. å…¥åº“ç®¡ç†è¡¨
-- ================================

-- å…¥åº“å•è¡¨
CREATE TABLE `inbound_order` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `inbound_no` VARCHAR(50) NOT NULL COMMENT 'å…¥åº“å•å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `inbound_type` VARCHAR(20) NOT NULL COMMENT 'å…¥åº“ç±»å‹:PURCHASE-é‡‡è´­,RETURN-é€€è´§,TRANSFER-è°ƒæ‹¨,PROFIT-ç›˜ç›ˆ,PRODUCTION-ç”Ÿäº§,OTHER-å…¶ä»–',
    `source_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ¥æºå•å·',
    `supplier_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¾›åº”å•†ID',
    `supplier_name` VARCHAR(100) DEFAULT NULL COMMENT 'ä¾›åº”å•†åç§°',
    `expect_time` DATETIME DEFAULT NULL COMMENT 'é¢„è®¡åˆ°è´§æ—¶é—´',
    `actual_time` DATETIME DEFAULT NULL COMMENT 'å®é™…åˆ°è´§æ—¶é—´',
    `total_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'æ€»æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®æ”¶æ•°é‡',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…å®¡æ ¸,2-å¾…å…¥åº“,3-å…¥åº“ä¸­,4-å·²å®Œæˆ,5-å·²å–æ¶ˆ',
    `audit_user` VARCHAR(50) DEFAULT NULL COMMENT 'å®¡æ ¸äºº',
    `audit_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ ¸æ—¶é—´',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_inbound_no` (`inbound_no`),
    KEY `idx_warehouse` (`warehouse_id`),
    KEY `idx_status` (`status`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å…¥åº“å•è¡¨';

-- å…¥åº“å•æ˜ç»†è¡¨
CREATE TABLE `inbound_detail` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `inbound_id` BIGINT(20) NOT NULL COMMENT 'å…¥åº“å•ID',
    `inbound_no` VARCHAR(50) NOT NULL COMMENT 'å…¥åº“å•å·',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `production_date` DATE DEFAULT NULL COMMENT 'ç”Ÿäº§æ—¥æœŸ',
    `expire_date` DATE DEFAULT NULL COMMENT 'è¿‡æœŸæ—¥æœŸ',
    `plan_quantity` DECIMAL(10,2) NOT NULL COMMENT 'è®¡åˆ’æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®æ”¶æ•°é‡',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¸Šæ¶åº“ä½ID',
    `location_code` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸Šæ¶åº“ä½ç¼–ç ',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…æ”¶è´§,2-å·²æ”¶è´§,3-å·²ä¸Šæ¶',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_inbound` (`inbound_id`),
    KEY `idx_goods` (`goods_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å…¥åº“å•æ˜ç»†è¡¨';

-- ================================
-- 5. å‡ºåº“ç®¡ç†è¡¨
-- ================================

-- å‡ºåº“å•è¡¨
CREATE TABLE `outbound_order` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `outbound_no` VARCHAR(50) NOT NULL COMMENT 'å‡ºåº“å•å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `outbound_type` VARCHAR(20) NOT NULL COMMENT 'å‡ºåº“ç±»å‹:SALE-é”€å”®,TRANSFER-è°ƒæ‹¨,SCRAP-æŠ¥æŸ,RETURN-é€€è´§,LOSS-ç›˜äº,OTHER-å…¶ä»–',
    `source_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ¥æºå•å·(è®¢å•å·/è°ƒæ‹¨å•å·)',
    `customer_code` VARCHAR(50) DEFAULT NULL COMMENT 'å®¢æˆ·ç¼–ç ',
    `customer_name` VARCHAR(100) DEFAULT NULL COMMENT 'å®¢æˆ·åç§°',
    `delivery_address` VARCHAR(200) DEFAULT NULL COMMENT 'æ”¶è´§åœ°å€',
    `contact_person` VARCHAR(50) DEFAULT NULL COMMENT 'è”ç³»äºº',
    `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
    `expect_time` DATETIME DEFAULT NULL COMMENT 'æœŸæœ›å‘è´§æ—¶é—´',
    `actual_time` DATETIME DEFAULT NULL COMMENT 'å®é™…å‘è´§æ—¶é—´',
    `total_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'æ€»æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®å‘æ•°é‡',
    `priority` TINYINT(4) DEFAULT 1 COMMENT 'ä¼˜å…ˆçº§:1-æ™®é€š,2-ç´§æ€¥,3-ç‰¹æ€¥',
    `carrier` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¿è¿å•†',
    `tracking_no` VARCHAR(50) DEFAULT NULL COMMENT 'ç‰©æµå•å·',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…å®¡æ ¸,2-å¾…å‡ºåº“,3-æ‹£è´§ä¸­,4-å¾…å¤æ ¸,5-å¾…å‘è´§,6-å·²å‘è´§,7-å·²å–æ¶ˆ',
    `audit_user` VARCHAR(50) DEFAULT NULL COMMENT 'å®¡æ ¸äºº',
    `audit_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ ¸æ—¶é—´',
    `audit_remark` VARCHAR(500) DEFAULT NULL COMMENT 'å®¡æ ¸å¤‡æ³¨',
    `picker_id` BIGINT(20) DEFAULT NULL COMMENT 'æ‹£è´§å‘˜ID',
    `picker_name` VARCHAR(50) DEFAULT NULL COMMENT 'æ‹£è´§å‘˜å§“å',
    `picking_time` DATETIME DEFAULT NULL COMMENT 'æ‹£è´§å®Œæˆæ—¶é—´',
    `reviewer_id` BIGINT(20) DEFAULT NULL COMMENT 'å¤æ ¸å‘˜ID',
    `reviewer_name` VARCHAR(50) DEFAULT NULL COMMENT 'å¤æ ¸å‘˜å§“å',
    `review_time` DATETIME DEFAULT NULL COMMENT 'å¤æ ¸æ—¶é—´',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_outbound_no` (`outbound_no`),
    KEY `idx_warehouse` (`warehouse_id`),
    KEY `idx_customer` (`customer_code`),
    KEY `idx_status` (`status`),
    KEY `idx_priority` (`priority`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‡ºåº“å•è¡¨';

-- å‡ºåº“å•æ˜ç»†è¡¨
CREATE TABLE `outbound_detail` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `outbound_id` BIGINT(20) NOT NULL COMMENT 'å‡ºåº“å•ID',
    `outbound_no` VARCHAR(50) NOT NULL COMMENT 'å‡ºåº“å•å·',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `plan_quantity` DECIMAL(10,2) NOT NULL COMMENT 'è®¡åˆ’æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®å‘æ•°é‡',
    `picked_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å·²æ‹£æ•°é‡',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'æ‹£è´§åº“ä½ID',
    `location_code` VARCHAR(50) DEFAULT NULL COMMENT 'æ‹£è´§åº“ä½ç¼–ç ',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…æ‹£è´§,2-æ‹£è´§ä¸­,3-å·²æ‹£è´§,4-å·²å¤æ ¸,5-å·²å‘è´§',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_outbound` (`outbound_id`),
    KEY `idx_goods` (`goods_id`),
    KEY `idx_location` (`location_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‡ºåº“å•æ˜ç»†è¡¨';

-- ================================
-- 6. æ‹£è´§ç®¡ç†è¡¨
-- ================================

-- æ‹£è´§æ³¢æ¬¡è¡¨
CREATE TABLE `picking_wave` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `wave_no` VARCHAR(50) NOT NULL COMMENT 'æ³¢æ¬¡å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `wave_type` VARCHAR(20) DEFAULT 'BATCH' COMMENT 'æ³¢æ¬¡ç±»å‹:BATCH-æ‰¹æ¬¡æ‹£è´§,ZONE-åˆ†åŒºæ‹£è´§,SINGLE-å•å“æ‹£è´§',
    `order_count` INT(11) DEFAULT 0 COMMENT 'è®¢å•æ•°é‡',
    `item_count` INT(11) DEFAULT 0 COMMENT 'å•†å“ç§ç±»æ•°',
    `total_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'æ€»æ•°é‡',
    `priority` TINYINT(4) DEFAULT 1 COMMENT 'ä¼˜å…ˆçº§:1-æ™®é€š,2-ç´§æ€¥,3-ç‰¹æ€¥',
    `picker_id` BIGINT(20) DEFAULT NULL COMMENT 'æ‹£è´§å‘˜ID',
    `picker_name` VARCHAR(50) DEFAULT NULL COMMENT 'æ‹£è´§å‘˜å§“å',
    `estimated_time` INT(11) DEFAULT NULL COMMENT 'é¢„è®¡è€—æ—¶(ç§’)',
    `actual_time` INT(11) DEFAULT NULL COMMENT 'å®é™…è€—æ—¶(ç§’)',
    `start_time` DATETIME DEFAULT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    `end_time` DATETIME DEFAULT NULL COMMENT 'ç»“æŸæ—¶é—´',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…åˆ†é…,2-å·²åˆ†é…,3-æ‹£è´§ä¸­,4-å·²å®Œæˆ,5-å·²å–æ¶ˆ',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_wave_no` (`wave_no`),
    KEY `idx_warehouse` (`warehouse_id`),
    KEY `idx_status` (`status`),
    KEY `idx_picker` (`picker_id`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‹£è´§æ³¢æ¬¡è¡¨';

-- æ‹£è´§æ³¢æ¬¡è®¢å•å…³è”è¡¨
CREATE TABLE `picking_wave_order` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `wave_id` BIGINT(20) NOT NULL COMMENT 'æ³¢æ¬¡ID',
    `wave_no` VARCHAR(50) NOT NULL COMMENT 'æ³¢æ¬¡å·',
    `outbound_id` BIGINT(20) NOT NULL COMMENT 'å‡ºåº“å•ID',
    `outbound_no` VARCHAR(50) NOT NULL COMMENT 'å‡ºåº“å•å·',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_wave_outbound` (`wave_id`, `outbound_id`),
    KEY `idx_wave` (`wave_id`),
    KEY `idx_outbound` (`outbound_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‹£è´§æ³¢æ¬¡è®¢å•å…³è”è¡¨';

-- æ‹£è´§ä»»åŠ¡è¡¨
CREATE TABLE `picking_task` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `task_no` VARCHAR(50) NOT NULL COMMENT 'ä»»åŠ¡ç¼–å·',
    `wave_id` BIGINT(20) DEFAULT NULL COMMENT 'æ³¢æ¬¡ID',
    `wave_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ³¢æ¬¡å·',
    `outbound_id` BIGINT(20) NOT NULL COMMENT 'å‡ºåº“å•ID',
    `outbound_no` VARCHAR(50) NOT NULL COMMENT 'å‡ºåº“å•å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `location_id` BIGINT(20) NOT NULL COMMENT 'åº“ä½ID',
    `location_code` VARCHAR(50) NOT NULL COMMENT 'åº“ä½ç¼–ç ',
    `plan_quantity` DECIMAL(10,2) NOT NULL COMMENT 'è®¡åˆ’æ‹£è´§æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®é™…æ‹£è´§æ•°é‡',
    `sort_order` INT(11) DEFAULT 0 COMMENT 'æ‹£è´§é¡ºåº',
    `picker_id` BIGINT(20) DEFAULT NULL COMMENT 'æ‹£è´§å‘˜ID',
    `picker_name` VARCHAR(50) DEFAULT NULL COMMENT 'æ‹£è´§å‘˜å§“å',
    `picking_time` DATETIME DEFAULT NULL COMMENT 'æ‹£è´§æ—¶é—´',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…æ‹£è´§,2-æ‹£è´§ä¸­,3-å·²å®Œæˆ,4-å¼‚å¸¸',
    `exception_type` VARCHAR(20) DEFAULT NULL COMMENT 'å¼‚å¸¸ç±»å‹:EMPTY-åº“ä½ç©º,SHORT-åº“å­˜ä¸è¶³,DAMAGED-å•†å“æŸå',
    `exception_remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¼‚å¸¸è¯´æ˜',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_task_no` (`task_no`),
    KEY `idx_wave` (`wave_id`),
    KEY `idx_outbound` (`outbound_id`),
    KEY `idx_picker` (`picker_id`),
    KEY `idx_location` (`location_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‹£è´§ä»»åŠ¡è¡¨';

-- ================================
-- 7. ç›˜ç‚¹ç®¡ç†è¡¨
-- ================================

-- ç›˜ç‚¹è®¡åˆ’è¡¨
CREATE TABLE `stock_taking_plan` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `plan_no` VARCHAR(50) NOT NULL COMMENT 'ç›˜ç‚¹è®¡åˆ’ç¼–å·',
    `plan_name` VARCHAR(100) NOT NULL COMMENT 'ç›˜ç‚¹è®¡åˆ’åç§°',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `taking_type` VARCHAR(20) NOT NULL COMMENT 'ç›˜ç‚¹ç±»å‹:FULL-å…¨ç›˜,CYCLE-å¾ªç¯ç›˜,SPOT-æŠ½ç›˜,DYNAMIC-åŠ¨æ€ç›˜',
    `scope_type` VARCHAR(20) NOT NULL COMMENT 'ç›˜ç‚¹èŒƒå›´:WAREHOUSE-å…¨ä»“,AREA-åº“åŒº,LOCATION-åº“ä½,GOODS-å•†å“',
    `scope_value` VARCHAR(500) DEFAULT NULL COMMENT 'èŒƒå›´å€¼(JSONæ•°ç»„)',
    `plan_start_time` DATETIME NOT NULL COMMENT 'è®¡åˆ’å¼€å§‹æ—¶é—´',
    `plan_end_time` DATETIME NOT NULL COMMENT 'è®¡åˆ’ç»“æŸæ—¶é—´',
    `actual_start_time` DATETIME DEFAULT NULL COMMENT 'å®é™…å¼€å§‹æ—¶é—´',
    `actual_end_time` DATETIME DEFAULT NULL COMMENT 'å®é™…ç»“æŸæ—¶é—´',
    `total_count` INT(11) DEFAULT 0 COMMENT 'ç›˜ç‚¹æ€»æ•°',
    `completed_count` INT(11) DEFAULT 0 COMMENT 'å·²å®Œæˆæ•°',
    `diff_count` INT(11) DEFAULT 0 COMMENT 'å·®å¼‚æ•°',
    `creator` VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…å®¡æ ¸,2-å¾…æ‰§è¡Œ,3-æ‰§è¡Œä¸­,4-å·²å®Œæˆ,5-å·²å–æ¶ˆ',
    `audit_user` VARCHAR(50) DEFAULT NULL COMMENT 'å®¡æ ¸äºº',
    `audit_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ ¸æ—¶é—´',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_plan_no` (`plan_no`),
    KEY `idx_warehouse` (`warehouse_id`),
    KEY `idx_status` (`status`),
    KEY `idx_plan_time` (`plan_start_time`, `plan_end_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›˜ç‚¹è®¡åˆ’è¡¨';

-- ç›˜ç‚¹å•è¡¨
CREATE TABLE `stock_taking` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `taking_no` VARCHAR(50) NOT NULL COMMENT 'ç›˜ç‚¹å•å·',
    `plan_id` BIGINT(20) DEFAULT NULL COMMENT 'ç›˜ç‚¹è®¡åˆ’ID',
    `plan_no` VARCHAR(50) DEFAULT NULL COMMENT 'ç›˜ç‚¹è®¡åˆ’ç¼–å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'åº“ä½ID',
    `location_code` VARCHAR(50) DEFAULT NULL COMMENT 'åº“ä½ç¼–ç ',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `book_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'è´¦é¢æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT NULL COMMENT 'å®ç›˜æ•°é‡',
    `diff_quantity` DECIMAL(10,2) GENERATED ALWAYS AS (`actual_quantity` - `book_quantity`) STORED COMMENT 'å·®å¼‚æ•°é‡',
    `diff_reason` VARCHAR(200) DEFAULT NULL COMMENT 'å·®å¼‚åŸå› ',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'ç›˜ç‚¹äºº',
    `operate_time` DATETIME DEFAULT NULL COMMENT 'ç›˜ç‚¹æ—¶é—´',
    `reviewer` VARCHAR(50) DEFAULT NULL COMMENT 'å¤æ ¸äºº',
    `review_time` DATETIME DEFAULT NULL COMMENT 'å¤æ ¸æ—¶é—´',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…ç›˜ç‚¹,2-å·²ç›˜ç‚¹,3-å·²å¤æ ¸,4-å·²è°ƒæ•´',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_taking_no` (`taking_no`),
    KEY `idx_plan` (`plan_id`),
    KEY `idx_warehouse_goods` (`warehouse_id`, `goods_id`),
    KEY `idx_location` (`location_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç›˜ç‚¹å•è¡¨';

-- ================================
-- 8. åº“ä½è°ƒæ•´è¡¨
-- ================================

-- ç§»åº“å•è¡¨
CREATE TABLE `stock_move` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `move_no` VARCHAR(50) NOT NULL COMMENT 'ç§»åº“å•å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `move_type` VARCHAR(20) NOT NULL COMMENT 'ç§»åº“ç±»å‹:LOCATION-åº“ä½è°ƒæ•´,AREA-åº“åŒºè°ƒæ•´,WAREHOUSE-ä»“åº“è°ƒæ‹¨',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `from_location_id` BIGINT(20) NOT NULL COMMENT 'æºåº“ä½ID',
    `from_location_code` VARCHAR(50) NOT NULL COMMENT 'æºåº“ä½ç¼–ç ',
    `to_location_id` BIGINT(20) NOT NULL COMMENT 'ç›®æ ‡åº“ä½ID',
    `to_location_code` VARCHAR(50) NOT NULL COMMENT 'ç›®æ ‡åº“ä½ç¼–ç ',
    `quantity` DECIMAL(10,2) NOT NULL COMMENT 'ç§»åº“æ•°é‡',
    `move_reason` VARCHAR(200) DEFAULT NULL COMMENT 'ç§»åº“åŸå› ',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `operate_time` DATETIME DEFAULT NULL COMMENT 'æ“ä½œæ—¶é—´',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…æ‰§è¡Œ,2-æ‰§è¡Œä¸­,3-å·²å®Œæˆ,4-å·²å–æ¶ˆ',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_move_no` (`move_no`),
    KEY `idx_warehouse` (`warehouse_id`),
    KEY `idx_goods` (`goods_id`),
    KEY `idx_from_location` (`from_location_id`),
    KEY `idx_to_location` (`to_location_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç§»åº“å•è¡¨';

-- ================================
-- 9. ä¾›åº”å•†/å®¢æˆ·ç®¡ç†è¡¨
-- ================================

-- ä¾›åº”å•†è¡¨
CREATE TABLE `supplier` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `supplier_code` VARCHAR(50) NOT NULL COMMENT 'ä¾›åº”å•†ç¼–ç ',
    `supplier_name` VARCHAR(100) NOT NULL COMMENT 'ä¾›åº”å•†åç§°',
    `supplier_type` VARCHAR(20) DEFAULT 'NORMAL' COMMENT 'ä¾›åº”å•†ç±»å‹:NORMAL-æ™®é€š,VIP-VIP,STRATEGIC-æˆ˜ç•¥',
    `contact_person` VARCHAR(50) DEFAULT NULL COMMENT 'è”ç³»äºº',
    `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
    `contact_email` VARCHAR(50) DEFAULT NULL COMMENT 'é‚®ç®±',
    `province` VARCHAR(50) DEFAULT NULL COMMENT 'çœä»½',
    `city` VARCHAR(50) DEFAULT NULL COMMENT 'åŸå¸‚',
    `district` VARCHAR(50) DEFAULT NULL COMMENT 'åŒºå¿',
    `address` VARCHAR(200) DEFAULT NULL COMMENT 'è¯¦ç»†åœ°å€',
    `credit_level` VARCHAR(20) DEFAULT 'B' COMMENT 'ä¿¡ç”¨ç­‰çº§:A-ä¼˜ç§€,B-è‰¯å¥½,C-ä¸€èˆ¬,D-è¾ƒå·®',
    `cooperation_start_date` DATE DEFAULT NULL COMMENT 'åˆä½œå¼€å§‹æ—¥æœŸ',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_supplier_code` (`supplier_code`),
    KEY `idx_supplier_type` (`supplier_type`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¾›åº”å•†è¡¨';

-- å®¢æˆ·è¡¨
CREATE TABLE `customer` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `customer_code` VARCHAR(50) NOT NULL COMMENT 'å®¢æˆ·ç¼–ç ',
    `customer_name` VARCHAR(100) NOT NULL COMMENT 'å®¢æˆ·åç§°',
    `customer_type` VARCHAR(20) DEFAULT 'RETAIL' COMMENT 'å®¢æˆ·ç±»å‹:RETAIL-é›¶å”®,WHOLESALE-æ‰¹å‘,ENTERPRISE-ä¼ä¸š',
    `customer_level` VARCHAR(20) DEFAULT 'NORMAL' COMMENT 'å®¢æˆ·ç­‰çº§:VIP,GOLD,SILVER,NORMAL',
    `contact_person` VARCHAR(50) DEFAULT NULL COMMENT 'è”ç³»äºº',
    `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
    `contact_email` VARCHAR(50) DEFAULT NULL COMMENT 'é‚®ç®±',
    `delivery_province` VARCHAR(50) DEFAULT NULL COMMENT 'æ”¶è´§çœä»½',
    `delivery_city` VARCHAR(50) DEFAULT NULL COMMENT 'æ”¶è´§åŸå¸‚',
    `delivery_district` VARCHAR(50) DEFAULT NULL COMMENT 'æ”¶è´§åŒºå¿',
    `delivery_address` VARCHAR(200) DEFAULT NULL COMMENT 'æ”¶è´§åœ°å€',
    `credit_limit` DECIMAL(15,2) DEFAULT 0 COMMENT 'ä¿¡ç”¨é¢åº¦',
    `total_orders` INT(11) DEFAULT 0 COMMENT 'ç´¯è®¡è®¢å•æ•°',
    `total_amount` DECIMAL(15,2) DEFAULT 0 COMMENT 'ç´¯è®¡é‡‘é¢',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_customer_code` (`customer_code`),
    KEY `idx_customer_type` (`customer_type`),
    KEY `idx_customer_level` (`customer_level`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®¢æˆ·è¡¨';

-- æ‰¿è¿å•†è¡¨
CREATE TABLE `carrier` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `carrier_code` VARCHAR(50) NOT NULL COMMENT 'æ‰¿è¿å•†ç¼–ç ',
    `carrier_name` VARCHAR(100) NOT NULL COMMENT 'æ‰¿è¿å•†åç§°',
    `carrier_type` VARCHAR(20) DEFAULT 'EXPRESS' COMMENT 'æ‰¿è¿å•†ç±»å‹:EXPRESS-å¿«é€’,LOGISTICS-ç‰©æµ,SPECIAL-ä¸“çº¿',
    `contact_person` VARCHAR(50) DEFAULT NULL COMMENT 'è”ç³»äºº',
    `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
    `contact_email` VARCHAR(50) DEFAULT NULL COMMENT 'é‚®ç®±',
    `service_area` VARCHAR(500) DEFAULT NULL COMMENT 'æœåŠ¡åŒºåŸŸ',
    `price_standard` VARCHAR(500) DEFAULT NULL COMMENT 'æ”¶è´¹æ ‡å‡†',
    `time_limit` VARCHAR(100) DEFAULT NULL COMMENT 'æ—¶æ•ˆè¦æ±‚',
    `rating` DECIMAL(3,2) DEFAULT 5.00 COMMENT 'æœåŠ¡è¯„åˆ†(1-5åˆ†)',
    `cooperation_start_date` DATE DEFAULT NULL COMMENT 'åˆä½œå¼€å§‹æ—¥æœŸ',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_carrier_code` (`carrier_code`),
    KEY `idx_carrier_type` (`carrier_type`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰¿è¿å•†è¡¨';

-- ================================
-- 10. ç³»ç»Ÿé…ç½®è¡¨
-- ================================

-- æ•°æ®å­—å…¸è¡¨
CREATE TABLE `sys_dict` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `dict_code` VARCHAR(50) NOT NULL COMMENT 'å­—å…¸ç¼–ç ',
    `dict_name` VARCHAR(100) NOT NULL COMMENT 'å­—å…¸åç§°',
    `parent_code` VARCHAR(50) DEFAULT NULL COMMENT 'çˆ¶å­—å…¸ç¼–ç ',
    `dict_value` VARCHAR(100) DEFAULT NULL COMMENT 'å­—å…¸å€¼',
    `dict_label` VARCHAR(100) DEFAULT NULL COMMENT 'å­—å…¸æ ‡ç­¾',
    `sort_order` INT(11) DEFAULT 0 COMMENT 'æ’åº',
    `css_class` VARCHAR(50) DEFAULT NULL COMMENT 'æ ·å¼ç±»',
    `list_class` VARCHAR(50) DEFAULT NULL COMMENT 'åˆ—è¡¨ç±»',
    `is_default` TINYINT(4) DEFAULT 0 COMMENT 'æ˜¯å¦é»˜è®¤:1-æ˜¯,0-å¦',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_dict` (`dict_code`, `dict_value`),
    KEY `idx_parent` (`parent_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•°æ®å­—å…¸è¡¨';

-- ç”¨æˆ·è¡¨
CREATE TABLE `sys_user` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
    `password` VARCHAR(100) NOT NULL COMMENT 'å¯†ç ',
    `real_name` VARCHAR(50) NOT NULL COMMENT 'çœŸå®å§“å',
    `nickname` VARCHAR(50) DEFAULT NULL COMMENT 'æ˜µç§°',
    `user_type` VARCHAR(20) DEFAULT 'EMPLOYEE' COMMENT 'ç”¨æˆ·ç±»å‹:ADMIN-ç®¡ç†å‘˜,EMPLOYEE-å‘˜å·¥,PICKER-æ‹£è´§å‘˜',
    `phone` VARCHAR(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
    `email` VARCHAR(50) DEFAULT NULL COMMENT 'é‚®ç®±',
    `avatar` VARCHAR(200) DEFAULT NULL COMMENT 'å¤´åƒ',
    `dept_id` BIGINT(20) DEFAULT NULL COMMENT 'éƒ¨é—¨ID',
    `dept_name` VARCHAR(100) DEFAULT NULL COMMENT 'éƒ¨é—¨åç§°',
    `warehouse_id` BIGINT(20) DEFAULT NULL COMMENT 'æ‰€å±ä»“åº“ID',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-æ­£å¸¸,0-ç¦ç”¨',
    `login_date` DATETIME DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
    `login_ip` VARCHAR(50) DEFAULT NULL COMMENT 'æœ€åç™»å½•IP',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    KEY `idx_phone` (`phone`),
    KEY `idx_dept` (`dept_id`),
    KEY `idx_warehouse` (`warehouse_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';

-- è§’è‰²è¡¨
CREATE TABLE `sys_role` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `role_code` VARCHAR(50) NOT NULL COMMENT 'è§’è‰²ç¼–ç ',
    `role_name` VARCHAR(100) NOT NULL COMMENT 'è§’è‰²åç§°',
    `role_type` VARCHAR(20) DEFAULT 'CUSTOM' COMMENT 'è§’è‰²ç±»å‹:SYSTEM-ç³»ç»Ÿ,CUSTOM-è‡ªå®šä¹‰',
    `data_scope` TINYINT(4) DEFAULT 1 COMMENT 'æ•°æ®èŒƒå›´:1-å…¨éƒ¨,2-è‡ªå®šä¹‰,3-æœ¬éƒ¨é—¨,4-æœ¬äºº',
    `sort_order` INT(11) DEFAULT 0 COMMENT 'æ’åº',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-æ­£å¸¸,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_role_code` (`role_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';

-- èœå•è¡¨
CREATE TABLE `sys_menu` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `menu_code` VARCHAR(50) NOT NULL COMMENT 'èœå•ç¼–ç ',
    `menu_name` VARCHAR(100) NOT NULL COMMENT 'èœå•åç§°',
    `parent_id` BIGINT(20) DEFAULT 0 COMMENT 'çˆ¶èœå•ID',
    `menu_type` VARCHAR(20) DEFAULT 'MENU' COMMENT 'èœå•ç±»å‹:CATALOG-ç›®å½•,MENU-èœå•,BUTTON-æŒ‰é’®',
    `path` VARCHAR(200) DEFAULT NULL COMMENT 'è·¯ç”±åœ°å€',
    `component` VARCHAR(200) DEFAULT NULL COMMENT 'ç»„ä»¶è·¯å¾„',
    `permission` VARCHAR(100) DEFAULT NULL COMMENT 'æƒé™æ ‡è¯†',
    `icon` VARCHAR(100) DEFAULT NULL COMMENT 'å›¾æ ‡',
    `sort_order` INT(11) DEFAULT 0 COMMENT 'æ’åº',
    `visible` TINYINT(4) DEFAULT 1 COMMENT 'æ˜¯å¦æ˜¾ç¤º:1-æ˜¾ç¤º,0-éšè—',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-æ­£å¸¸,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_menu_code` (`menu_code`),
    KEY `idx_parent` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='èœå•è¡¨';

-- ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE `sys_user_role` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `user_id` BIGINT(20) NOT NULL COMMENT 'ç”¨æˆ·ID',
    `role_id` BIGINT(20) NOT NULL COMMENT 'è§’è‰²ID',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_role` (`user_id`, `role_id`),
    KEY `idx_user` (`user_id`),
    KEY `idx_role` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';

-- è§’è‰²èœå•å…³è”è¡¨
CREATE TABLE `sys_role_menu` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `role_id` BIGINT(20) NOT NULL COMMENT 'è§’è‰²ID',
    `menu_id` BIGINT(20) NOT NULL COMMENT 'èœå•ID',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_role_menu` (`role_id`, `menu_id`),
    KEY `idx_role` (`role_id`),
    KEY `idx_menu` (`menu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²èœå•å…³è”è¡¨';

-- æ“ä½œæ—¥å¿—è¡¨
CREATE TABLE `sys_operation_log` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `module` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œæ¨¡å—',
    `business_type` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    `business_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¸šåŠ¡ID',
    `method` VARCHAR(200) DEFAULT NULL COMMENT 'è¯·æ±‚æ–¹æ³•',
    `request_method` VARCHAR(10) DEFAULT NULL COMMENT 'è¯·æ±‚æ–¹å¼',
    `operator_type` VARCHAR(20) DEFAULT 'WEB' COMMENT 'æ“ä½œç±»å‹:WEB-åå°,MOBILE-æ‰‹æœº,API-æ¥å£',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `dept_name` VARCHAR(100) DEFAULT NULL COMMENT 'éƒ¨é—¨åç§°',
    `url` VARCHAR(500) DEFAULT NULL COMMENT 'è¯·æ±‚URL',
    `ip` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œIP',
    `location` VARCHAR(200) DEFAULT NULL COMMENT 'æ“ä½œåœ°ç‚¹',
    `param` TEXT DEFAULT NULL COMMENT 'è¯·æ±‚å‚æ•°',
    `result` TEXT DEFAULT NULL COMMENT 'è¿”å›ç»“æœ',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-æˆåŠŸ,0-å¤±è´¥',
    `error_msg` TEXT DEFAULT NULL COMMENT 'é”™è¯¯æ¶ˆæ¯',
    `cost_time` INT(11) DEFAULT NULL COMMENT 'æ¶ˆè€—æ—¶é—´(æ¯«ç§’)',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_module` (`module`),
    KEY `idx_business` (`business_type`, `business_id`),
    KEY `idx_operator` (`operator`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ“ä½œæ—¥å¿—è¡¨';

---

## å››ã€æ ¸å¿ƒä¸šåŠ¡å®ç°

### 4.1 åº“å­˜æœåŠ¡å®ç°

#### å®ä½“ç±»å®šä¹‰

```java
package com.wms.inventory.entity;

import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalDateTime;

/**
 * åº“å­˜å®ä½“
 */
@Data
@TableName("inventory")
public class Inventory {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    /**
     * ä»“åº“ID
     */
    private Long warehouseId;
    
    /**
     * åº“ä½ID
     */
    private Long locationId;
    
    /**
     * å•†å“ID
     */
    private Long goodsId;
    
    /**
     * æ‰¹æ¬¡å·
     */
    private String batchNo;
    
    /**
     * åºåˆ—å·
     */
    private String serialNo;
    
    /**
     * åº“å­˜æ•°é‡
     */
    private BigDecimal quantity;
    
    /**
     * é”å®šæ•°é‡
     */
    private BigDecimal lockQuantity;
    
    /**
     * å¯ç”¨æ•°é‡ï¼ˆè™šæ‹Ÿåˆ—ï¼Œè‡ªåŠ¨è®¡ç®—ï¼‰
     */
    private BigDecimal availableQuantity;
    
    /**
     * ç”Ÿäº§æ—¥æœŸ
     */
    private LocalDate productionDate;
    
    /**
     * è¿‡æœŸæ—¥æœŸ
     */
    private LocalDate expireDate;
    
    /**
     * å…¥åº“æ—¥æœŸ
     */
    private LocalDateTime inboundDate;
    
    /**
     * ä¾›åº”å•†ID
     */
    private Long supplierId;
    
    /**
     * ä¾›åº”å•†åç§°
     */
    private String supplierName;
    
    /**
     * çŠ¶æ€:1-æ­£å¸¸,2-å†»ç»“,3-å¾…æ£€,4-æŸå
     */
    private Integer status;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
}
```

#### åº“å­˜æœåŠ¡æ¥å£

```java
package com.wms.inventory.service;

import com.wms.inventory.dto.InventoryLockDTO;
import com.wms.inventory.dto.InventoryQueryDTO;
import com.wms.inventory.vo.InventoryVO;
import java.math.BigDecimal;
import java.util.List;

/**
 * åº“å­˜æœåŠ¡æ¥å£
 */
public interface InventoryService {
    
    /**
     * æŸ¥è¯¢åº“å­˜
     */
    List<InventoryVO> queryInventory(InventoryQueryDTO queryDTO);
    
    /**
     * é”å®šåº“å­˜
     */
    boolean lockInventory(InventoryLockDTO lockDTO);
    
    /**
     * è§£é”åº“å­˜
     */
    boolean unlockInventory(InventoryLockDTO lockDTO);
    
    /**
     * æ‰£å‡åº“å­˜
     */
    boolean deductInventory(Long warehouseId, Long goodsId, String batchNo, BigDecimal quantity);
    
    /**
     * å¢åŠ åº“å­˜
     */
    boolean addInventory(Long warehouseId, Long locationId, Long goodsId, String batchNo, BigDecimal quantity);
    
    /**
     * è·å–å¯ç”¨åº“å­˜æ•°é‡
     */
    BigDecimal getAvailableQuantity(Long warehouseId, Long goodsId, String batchNo);
    
    /**
     * åº“å­˜é¢„è­¦æ£€æŸ¥
     */
    List<InventoryVO> checkInventoryAlert();
}
```

#### åº“å­˜æœåŠ¡å®ç°ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

```java
package com.wms.inventory.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.wms.inventory.entity.Inventory;
import com.wms.inventory.entity.InventoryLog;
import com.wms.inventory.mapper.InventoryMapper;
import com.wms.inventory.mapper.InventoryLogMapper;
import com.wms.inventory.service.InventoryService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.concurrent.TimeUnit;

/**
 * åº“å­˜æœåŠ¡å®ç°
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class InventoryServiceImpl implements InventoryService {
    
    private final InventoryMapper inventoryMapper;
    private final InventoryLogMapper inventoryLogMapper;
    private final RedisTemplate<String, Object> redisTemplate;
    
    private static final String LOCK_KEY_PREFIX = "inventory:lock:";
    private static final String CACHE_KEY_PREFIX = "inventory:cache:";
    
    /**
     * é”å®šåº“å­˜ï¼ˆæ”¯æŒåˆ†å¸ƒå¼é”ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean lockInventory(InventoryLockDTO lockDTO) {
        String lockKey = LOCK_KEY_PREFIX + lockDTO.getWarehouseId() + ":" + lockDTO.getGoodsId();
        
        try {
            // è·å–åˆ†å¸ƒå¼é”
            Boolean acquired = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, "LOCKED", 10, TimeUnit.SECONDS);
            
            if (Boolean.FALSE.equals(acquired)) {
                log.warn("è·å–åº“å­˜é”å¤±è´¥: {}", lockKey);
                return false;
            }
            
            // æŸ¥è¯¢å¯ç”¨åº“å­˜
            Inventory inventory = getInventoryForUpdate(
                lockDTO.getWarehouseId(), 
                lockDTO.getGoodsId(), 
                lockDTO.getBatchNo()
            );
            
            if (inventory == null) {
                log.error("åº“å­˜ä¸å­˜åœ¨: warehouseId={}, goodsId={}", 
                    lockDTO.getWarehouseId(), lockDTO.getGoodsId());
                return false;
            }
            
            // æ£€æŸ¥å¯ç”¨åº“å­˜æ˜¯å¦å……è¶³
            BigDecimal available = inventory.getQuantity().subtract(inventory.getLockQuantity());
            if (available.compareTo(lockDTO.getQuantity()) < 0) {
                log.warn("åº“å­˜ä¸è¶³: å¯ç”¨={}, éœ€è¦={}", available, lockDTO.getQuantity());
                return false;
            }
            
            // æ›´æ–°é”å®šæ•°é‡
            inventory.setLockQuantity(inventory.getLockQuantity().add(lockDTO.getQuantity()));
            inventoryMapper.updateById(inventory);
            
            // è®°å½•åº“å­˜æµæ°´
            saveInventoryLog(inventory, "LOCK", lockDTO.getQuantity(), 
                lockDTO.getBusinessType(), lockDTO.getBusinessNo());
            
            // æ¸…é™¤ç¼“å­˜
            clearInventoryCache(lockDTO.getWarehouseId(), lockDTO.getGoodsId());
            
            log.info("åº“å­˜é”å®šæˆåŠŸ: {}", lockDTO);
            return true;
            
        } finally {
            // é‡Šæ”¾åˆ†å¸ƒå¼é”
            redisTemplate.delete(lockKey);
        }
    }
    
    /**
     * æ‰£å‡åº“å­˜ï¼ˆå‡ºåº“æ—¶è°ƒç”¨ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean deductInventory(Long warehouseId, Long goodsId, String batchNo, BigDecimal quantity) {
        String lockKey = LOCK_KEY_PREFIX + warehouseId + ":" + goodsId;
        
        try {
            Boolean acquired = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, "LOCKED", 10, TimeUnit.SECONDS);
            
            if (Boolean.FALSE.equals(acquired)) {
                return false;
            }
            
            Inventory inventory = getInventoryForUpdate(warehouseId, goodsId, batchNo);
            
            if (inventory == null) {
                log.error("æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸å­˜åœ¨");
                return false;
            }
            
            // æ‰£å‡åº“å­˜æ•°é‡å’Œé”å®šæ•°é‡
            BigDecimal newQuantity = inventory.getQuantity().subtract(quantity);
            BigDecimal newLockQuantity = inventory.getLockQuantity().subtract(quantity);
            
            if (newQuantity.compareTo(BigDecimal.ZERO) < 0) {
                log.error("æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³");
                return false;
            }
            
            inventory.setQuantity(newQuantity);
            inventory.setLockQuantity(newLockQuantity.max(BigDecimal.ZERO));
            inventoryMapper.updateById(inventory);
            
            // è®°å½•æµæ°´
            saveInventoryLog(inventory, "OUTBOUND", quantity.negate(), "OUTBOUND", null);
            
            clearInventoryCache(warehouseId, goodsId);
            
            return true;
            
        } finally {
            redisTemplate.delete(lockKey);
        }
    }
    
    /**
     * å¢åŠ åº“å­˜ï¼ˆå…¥åº“æ—¶è°ƒç”¨ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean addInventory(Long warehouseId, Long locationId, Long goodsId, 
                                String batchNo, BigDecimal quantity) {
        
        // æŸ¥è¯¢æ˜¯å¦å·²æœ‰åº“å­˜è®°å½•
        LambdaQueryWrapper<Inventory> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(Inventory::getWarehouseId, warehouseId)
               .eq(Inventory::getLocationId, locationId)
               .eq(Inventory::getGoodsId, goodsId)
               .eq(batchNo != null, Inventory::getBatchNo, batchNo);
        
        Inventory inventory = inventoryMapper.selectOne(wrapper);
        
        if (inventory != null) {
            // å·²å­˜åœ¨ï¼Œç´¯åŠ æ•°é‡
            inventory.setQuantity(inventory.getQuantity().add(quantity));
            inventoryMapper.updateById(inventory);
        } else {
            // æ–°å¢åº“å­˜è®°å½•
            inventory = new Inventory();
            inventory.setWarehouseId(warehouseId);
            inventory.setLocationId(locationId);
            inventory.setGoodsId(goodsId);
            inventory.setBatchNo(batchNo);
            inventory.setQuantity(quantity);
            inventory.setLockQuantity(BigDecimal.ZERO);
            inventory.setStatus(1);
            inventory.setInboundDate(LocalDateTime.now());
            inventoryMapper.insert(inventory);
        }
        
        // è®°å½•æµæ°´
        saveInventoryLog(inventory, "INBOUND", quantity, "INBOUND", null);
        
        clearInventoryCache(warehouseId, goodsId);
        
        return true;
    }
    
    /**
     * æŸ¥è¯¢åº“å­˜ï¼ˆå¸¦è¡Œé”ï¼‰
     */
    private Inventory getInventoryForUpdate(Long warehouseId, Long goodsId, String batchNo) {
        LambdaQueryWrapper<Inventory> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(Inventory::getWarehouseId, warehouseId)
               .eq(Inventory::getGoodsId, goodsId)
               .eq(batchNo != null, Inventory::getBatchNo, batchNo)
               .eq(Inventory::getStatus, 1)
               .last("FOR UPDATE");
        
        return inventoryMapper.selectOne(wrapper);
    }
    
    /**
     * ä¿å­˜åº“å­˜æµæ°´
     */
    private void saveInventoryLog(Inventory inventory, String operationType, 
                                  BigDecimal quantityChange, String businessType, String businessNo) {
        InventoryLog log = new InventoryLog();
        log.setWarehouseId(inventory.getWarehouseId());
        log.setGoodsId(inventory.getGoodsId());
        log.setLocationId(inventory.getLocationId());
        log.setBatchNo(inventory.getBatchNo());
        log.setOperationType(operationType);
        log.setQuantityBefore(inventory.getQuantity().subtract(quantityChange));
        log.setQuantityChange(quantityChange);
        log.setQuantityAfter(inventory.getQuantity());
        log.setBusinessType(businessType);
        log.setBusinessNo(businessNo);
        
        inventoryLogMapper.insert(log);
    }
    
    /**
     * æ¸…é™¤åº“å­˜ç¼“å­˜
     */
    private void clearInventoryCache(Long warehouseId, Long goodsId) {
        String cacheKey = CACHE_KEY_PREFIX + warehouseId + ":" + goodsId;
        redisTemplate.delete(cacheKey);
    }
}
```

### 4.2 å‡ºåº“æœåŠ¡å®ç°

#### å‡ºåº“è®¢å•å®ä½“

```java
package com.wms.outbound.entity;

import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDateTime;

@Data
@TableName("outbound_order")
public class OutboundOrder {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String outboundNo;
    private Long warehouseId;
    private String outboundType; // SALE-é”€å”®, TRANSFER-è°ƒæ‹¨, SCRAP-æŠ¥æŸ
    private String customerCode;
    private String customerName;
    private String deliveryAddress;
    private String contactPhone;
    private LocalDateTime expectTime;
    private LocalDateTime actualTime;
    private BigDecimal totalQuantity;
    private BigDecimal actualQuantity;
    private Integer priority; // ä¼˜å…ˆçº§: 1-æ™®é€š, 2-ç´§æ€¥, 3-ç‰¹æ€¥
    private Integer status; // 1-å¾…å®¡æ ¸, 2-å¾…å‡ºåº“, 3-æ‹£è´§ä¸­, 4-å·²å®Œæˆ, 5-å·²å–æ¶ˆ
    private String auditUser;
    private LocalDateTime auditTime;
    private String operator;
    private String remark;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
}
```

#### å‡ºåº“æœåŠ¡å®ç°

```java
package com.wms.outbound.service.impl;

import com.wms.outbound.entity.OutboundOrder;
import com.wms.outbound.entity.OutboundDetail;
import com.wms.outbound.mapper.OutboundOrderMapper;
import com.wms.inventory.service.InventoryService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

/**
 * å‡ºåº“æœåŠ¡å®ç°
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class OutboundServiceImpl {
    
    private final OutboundOrderMapper outboundOrderMapper;
    private final InventoryService inventoryService;
    private final PickingService pickingService;
    
    /**
     * åˆ›å»ºå‡ºåº“å•
     */
    @Transactional(rollbackFor = Exception.class)
    public Long createOutboundOrder(OutboundOrderDTO dto) {
        // 1. åˆ›å»ºå‡ºåº“å•
        OutboundOrder order = new OutboundOrder();
        order.setOutboundNo(generateOutboundNo());
        order.setWarehouseId(dto.getWarehouseId());
        order.setOutboundType(dto.getOutboundType());
        order.setCustomerCode(dto.getCustomerCode());
        order.setCustomerName(dto.getCustomerName());
        order.setStatus(1); // å¾…å®¡æ ¸
        outboundOrderMapper.insert(order);
        
        // 2. åˆ›å»ºå‡ºåº“æ˜ç»†
        dto.getDetails().forEach(detail -> {
            OutboundDetail outboundDetail = new OutboundDetail();
            outboundDetail.setOutboundId(order.getId());
            outboundDetail.setGoodsId(detail.getGoodsId());
            outboundDetail.setPlanQuantity(detail.getQuantity());
            // ... ä¿å­˜æ˜ç»†
        });
        
        return order.getId();
    }
    
    /**
     * å®¡æ ¸å‡ºåº“å•
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean auditOutboundOrder(Long orderId, boolean approved) {
        OutboundOrder order = outboundOrderMapper.selectById(orderId);
        
        if (approved) {
            // å®¡æ ¸é€šè¿‡ï¼Œé”å®šåº“å­˜
            boolean locked = lockInventoryForOrder(order);
            if (!locked) {
                throw new BizException("åº“å­˜ä¸è¶³ï¼Œå®¡æ ¸å¤±è´¥");
            }
            order.setStatus(2); // å¾…å‡ºåº“
        } else {
            order.setStatus(5); // å·²å–æ¶ˆ
        }
        
        order.setAuditTime(LocalDateTime.now());
        outboundOrderMapper.updateById(order);
        
        return true;
    }
    
    /**
     * åˆ›å»ºæ‹£è´§ä»»åŠ¡
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean createPickingTask(Long orderId) {
        OutboundOrder order = outboundOrderMapper.selectById(orderId);
        
        if (order.getStatus() != 2) {
            throw new BizException("è®¢å•çŠ¶æ€ä¸æ­£ç¡®");
        }
        
        // åˆ›å»ºæ‹£è´§ä»»åŠ¡
        pickingService.createPickingTask(order);
        
        order.setStatus(3); // æ‹£è´§ä¸­
        outboundOrderMapper.updateById(order);
        
        return true;
    }
    
    /**
     * å‡ºåº“å®Œæˆ
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean completeOutbound(Long orderId) {
        OutboundOrder order = outboundOrderMapper.selectById(orderId);
        
        // æ‰£å‡åº“å­˜
        boolean deducted = deductInventoryForOrder(order);
        if (!deducted) {
            throw new BizException("åº“å­˜æ‰£å‡å¤±è´¥");
        }
        
        order.setStatus(4); // å·²å®Œæˆ
        order.setActualTime(LocalDateTime.now());
        outboundOrderMapper.updateById(order);
        
        return true;
    }
    
    /**
     * ä¸ºè®¢å•é”å®šåº“å­˜
     */
    private boolean lockInventoryForOrder(OutboundOrder order) {
        // æŸ¥è¯¢å‡ºåº“æ˜ç»†ï¼Œé€ä¸ªé”å®šåº“å­˜
        // ... å®ç°é€»è¾‘
        return true;
    }
    
    /**
     * ä¸ºè®¢å•æ‰£å‡åº“å­˜
     */
    private boolean deductInventoryForOrder(OutboundOrder order) {
        // æŸ¥è¯¢å‡ºåº“æ˜ç»†ï¼Œé€ä¸ªæ‰£å‡åº“å­˜
        // ... å®ç°é€»è¾‘
        return true;
    }
    
    /**
     * ç”Ÿæˆå‡ºåº“å•å·
     */
    private String generateOutboundNo() {
        return "OUT" + System.currentTimeMillis();
    }
}
```

### 4.3 æ‹£è´§æœåŠ¡å®ç°

#### æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•

```java
package com.wms.picking.service;

import lombok.Data;
import java.util.*;

/**
 * æ‹£è´§è·¯å¾„ä¼˜åŒ–æœåŠ¡
 */
@Service
public class PickingPathOptimizer {
    
    /**
     * ä½¿ç”¨è´ªå¿ƒç®—æ³•ä¼˜åŒ–æ‹£è´§è·¯å¾„
     */
    public List<PickingLocation> optimizePath(List<PickingLocation> locations) {
        if (locations.size() <= 1) {
            return locations;
        }
        
        List<PickingLocation> optimized = new ArrayList<>();
        Set<PickingLocation> unvisited = new HashSet<>(locations);
        
        // ä»èµ·ç‚¹ï¼ˆåº“åŒºå…¥å£ï¼‰å¼€å§‹
        PickingLocation current = findNearestToEntrance(unvisited);
        optimized.add(current);
        unvisited.remove(current);
        
        // è´ªå¿ƒç®—æ³•ï¼šæ¯æ¬¡é€‰æ‹©è·ç¦»å½“å‰ä½ç½®æœ€è¿‘çš„ç‚¹
        while (!unvisited.isEmpty()) {
            PickingLocation nearest = findNearest(current, unvisited);
            optimized.add(nearest);
            unvisited.remove(nearest);
            current = nearest;
        }
        
        return optimized;
    }
    
    /**
     * è®¡ç®—ä¸¤ä¸ªåº“ä½ä¹‹é—´çš„è·ç¦»
     */
    private double calculateDistance(PickingLocation loc1, PickingLocation loc2) {
        // æ›¼å“ˆé¡¿è·ç¦»
        int rowDiff = Math.abs(loc1.getRowNo() - loc2.getRowNo());
        int colDiff = Math.abs(loc1.getColumnNo() - loc2.getColumnNo());
        int layerDiff = Math.abs(loc1.getLayerNo() - loc2.getLayerNo());
        
        return rowDiff + colDiff + layerDiff * 2; // å±‚é—´ç§»åŠ¨æˆæœ¬æ›´é«˜
    }
    
    /**
     * æ‰¾åˆ°è·ç¦»å½“å‰ä½ç½®æœ€è¿‘çš„åº“ä½
     */
    private PickingLocation findNearest(PickingLocation current, Set<PickingLocation> candidates) {
        return candidates.stream()
            .min(Comparator.comparingDouble(loc -> calculateDistance(current, loc)))
            .orElseThrow();
    }
    
    /**
     * æ‰¾åˆ°è·ç¦»å…¥å£æœ€è¿‘çš„åº“ä½
     */
    private PickingLocation findNearestToEntrance(Set<PickingLocation> locations) {
        PickingLocation entrance = new PickingLocation(0, 0, 0);
        return findNearest(entrance, locations);
    }
}

@Data
class PickingLocation {
    private Long locationId;
    private String locationCode;
    private Integer rowNo;
    private Integer columnNo;
    private Integer layerNo;
    
    public PickingLocation(int row, int col, int layer) {
        this.rowNo = row;
        this.columnNo = col;
        this.layerNo = layer;
    }
}
```

---

## äº”ã€å‰ç«¯å®ç°

### 5.1 åº“å­˜ç®¡ç†é¡µé¢

```vue
<template>
  <div class="inventory-container">
    <!-- æœç´¢åŒºåŸŸ -->
    <el-card class="search-card">
      <el-form :inline="true" :model="searchForm">
        <el-form-item label="å•†å“åç§°">
          <el-input v-model="searchForm.goodsName" placeholder="è¯·è¾“å…¥å•†å“åç§°" clearable />
        </el-form-item>
        <el-form-item label="SKUç¼–ç ">
          <el-input v-model="searchForm.skuCode" placeholder="è¯·è¾“å…¥SKUç¼–ç " clearable />
        </el-form-item>
        <el-form-item label="ä»“åº“">
          <el-select v-model="searchForm.warehouseId" placeholder="è¯·é€‰æ‹©ä»“åº“" clearable>
            <el-option
              v-for="item in warehouseList"
              :key="item.id"
              :label="item.warehouseName"
              :value="item.id"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="åº“å­˜çŠ¶æ€">
          <el-select v-model="searchForm.status" placeholder="è¯·é€‰æ‹©çŠ¶æ€" clearable>
            <el-option label="æ­£å¸¸" :value="1" />
            <el-option label="å†»ç»“" :value="2" />
            <el-option label="å¾…æ£€" :value="3" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch" icon="Search">æŸ¥è¯¢</el-button>
          <el-button @click="handleReset" icon="Refresh">é‡ç½®</el-button>
          <el-button type="success" @click="handleExport" icon="Download">å¯¼å‡º</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- åº“å­˜é¢„è­¦æç¤º -->
    <el-alert
      v-if="alertCount > 0"
      title="åº“å­˜é¢„è­¦"
      type="warning"
      :description="`å½“å‰æœ‰ ${alertCount} ä¸ªå•†å“åº“å­˜ä¸è¶³ï¼Œè¯·åŠæ—¶è¡¥è´§`"
      show-icon
      :closable="false"
      :style="{ margin: '20px 0' }"
    />

    <!-- æ•°æ®è¡¨æ ¼ -->
    <el-card class="table-card">
      <vxe-table
        ref="tableRef"
        :data="tableData"
        :loading="loading"
        border
        stripe
        height="600"
        :row-config="{ isHover: true }"
      >
        <vxe-column type="seq" title="åºå·" width="60" />
        <vxe-column field="warehouseName" title="ä»“åº“" width="120" />
        <vxe-column field="locationCode" title="åº“ä½" width="100" />
        <vxe-column field="skuCode" title="SKUç¼–ç " width="150" />
        <vxe-column field="goodsName" title="å•†å“åç§°" min-width="200" />
        <vxe-column field="batchNo" title="æ‰¹æ¬¡å·" width="120" />
        <vxe-column field="quantity" title="æ€»åº“å­˜" width="100" align="right">
          <template #default="{ row }">
            <span :class="{ 'text-danger': row.quantity < row.safetyStock }">
              {{ row.quantity }}
            </span>
          </template>
        </vxe-column>
        <vxe-column field="lockQuantity" title="é”å®šæ•°é‡" width="100" align="right" />
        <vxe-column field="availableQuantity" title="å¯ç”¨åº“å­˜" width="100" align="right">
          <template #default="{ row }">
            <el-tag :type="getStockTagType(row)">
              {{ row.availableQuantity }}
            </el-tag>
          </template>
        </vxe-column>
        <vxe-column field="status" title="çŠ¶æ€" width="80">
          <template #default="{ row }">
            <el-tag :type="getStatusType(row.status)">
              {{ getStatusText(row.status) }}
            </el-tag>
          </template>
        </vxe-column>
        <vxe-column field="inboundDate" title="å…¥åº“æ—¥æœŸ" width="150" />
        <vxe-column title="æ“ä½œ" width="200" fixed="right">
          <template #default="{ row }">
            <el-button link type="primary" @click="handleView(row)">è¯¦æƒ…</el-button>
            <el-button link type="warning" @click="handleMove(row)">ç§»åº“</el-button>
            <el-button link type="danger" @click="handleFreeze(row)">å†»ç»“</el-button>
          </template>
        </vxe-column>
      </vxe-table>

      <!-- åˆ†é¡µ -->
      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSearch"
        @current-change="handleSearch"
      />
    </el-card>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { getInventoryList, freezeInventory } from '@/api/inventory'

// æœç´¢è¡¨å•
const searchForm = reactive({
  goodsName: '',
  skuCode: '',
  warehouseId: null,
  status: null
})

// è¡¨æ ¼æ•°æ®
const tableData = ref([])
const loading = ref(false)
const alertCount = ref(0)

// åˆ†é¡µ
const pagination = reactive({
  page: 1,
  size: 20,
  total: 0
})

// æŸ¥è¯¢æ•°æ®
const handleSearch = async () => {
  loading.value = true
  try {
    const params = {
      ...searchForm,
      page: pagination.page,
      size: pagination.size
    }
    const { data } = await getInventoryList(params)
    tableData.value = data.records
    pagination.total = data.total
    alertCount.value = data.alertCount || 0
  } catch (error) {
    ElMessage.error('æŸ¥è¯¢å¤±è´¥')
  } finally {
    loading.value = false
  }
}

// é‡ç½®
const handleReset = () => {
  Object.assign(searchForm, {
    goodsName: '',
    skuCode: '',
    warehouseId: null,
    status: null
  })
  handleSearch()
}

// åº“å­˜æ ‡ç­¾ç±»å‹
const getStockTagType = (row) => {
  if (row.availableQuantity <= 0) return 'danger'
  if (row.availableQuantity < row.safetyStock) return 'warning'
  return 'success'
}

// çŠ¶æ€ç±»å‹
const getStatusType = (status) => {
  const map = { 1: 'success', 2: 'danger', 3: 'warning', 4: 'info' }
  return map[status] || ''
}

const getStatusText = (status) => {
  const map = { 1: 'æ­£å¸¸', 2: 'å†»ç»“', 3: 'å¾…æ£€', 4: 'æŸå' }
  return map[status] || ''
}

// å†»ç»“åº“å­˜
const handleFreeze = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦å†»ç»“è¯¥åº“å­˜å—ï¼Ÿ', 'æç¤º', {
      type: 'warning'
    })
    await freezeInventory(row.id)
    ElMessage.success('å†»ç»“æˆåŠŸ')
    handleSearch()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('æ“ä½œå¤±è´¥')
    }
  }
}

onMounted(() => {
  handleSearch()
})
</script>

<style scoped>
.inventory-container {
  padding: 20px;
}

.search-card {
  margin-bottom: 20px;
}

.text-danger {
  color: #f56c6c;
  font-weight: bold;
}
</style>
```

### 5.2 å…¥åº“ç®¡ç†é¡µé¢ï¼ˆæµç¨‹å›¾ï¼‰

```mermaid
flowchart LR
    Start[åˆ›å»ºå…¥åº“å•] --> Upload[ä¸Šä¼ å•æ®]
    Upload --> Review[å®¡æ ¸]
    Review -->|é€šè¿‡| Receive[æ”¶è´§]
    Review -->|é©³å›| End1[ç»“æŸ]
    Receive --> Quality[è´¨æ£€]
    Quality -->|åˆæ ¼| PutAway[ä¸Šæ¶]
    Quality -->|ä¸åˆæ ¼| Return[é€€å›]
    PutAway --> Complete[å®Œæˆ]
    
    style Start fill:#e8f5e9
    style Complete fill:#c8e6c9
    style End1 fill:#ffcdd2
```

### 5.3 ä»“åº“å¤§å±ç›‘æ§

```vue
<template>
  <div class="warehouse-screen">
    <div class="screen-header">
      <h1>ğŸ¢ æ™ºèƒ½ä»“åº“ç›‘æ§å¤§å±</h1>
      <div class="datetime">{{ currentTime }}</div>
    </div>

    <div class="screen-content">
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-row">
        <div class="stat-card" v-for="stat in stats" :key="stat.label">
          <div class="stat-icon" :style="{ background: stat.color }">
            {{ stat.icon }}
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stat.value }}</div>
            <div class="stat-label">{{ stat.label }}</div>
          </div>
        </div>
      </div>

      <!-- å›¾è¡¨åŒºåŸŸ -->
      <div class="charts-row">
        <div class="chart-container">
          <h3>ğŸ“Š å‡ºå…¥åº“è¶‹åŠ¿</h3>
          <div ref="trendChart" class="chart"></div>
        </div>
        <div class="chart-container">
          <h3>ğŸ¥§ åº“å­˜åˆ†å¸ƒ</h3>
          <div ref="pieChart" class="chart"></div>
        </div>
        <div class="chart-container">
          <h3>ğŸ“ˆ åº“ä½åˆ©ç”¨ç‡</h3>
          <div ref="barChart" class="chart"></div>
        </div>
      </div>

      <!-- å®æ—¶ä»»åŠ¡ -->
      <div class="tasks-row">
        <div class="task-list">
          <h3>ğŸ¯ æ‹£è´§ä»»åŠ¡</h3>
          <el-scrollbar height="300px">
            <div v-for="task in pickingTasks" :key="task.id" class="task-item">
              <div class="task-info">
                <span class="task-no">{{ task.taskNo }}</span>
                <el-tag :type="getTaskTagType(task.status)">
                  {{ task.statusText }}
                </el-tag>
              </div>
              <el-progress :percentage="task.progress" />
            </div>
          </el-scrollbar>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import * as echarts from 'echarts'
import dayjs from 'dayjs'

const currentTime = ref(dayjs().format('YYYY-MM-DD HH:mm:ss'))

// ç»Ÿè®¡æ•°æ®
const stats = ref([
  { label: 'æ€»åº“å­˜', value: '12,345', icon: 'ğŸ“¦', color: '#409EFF' },
  { label: 'ä»Šæ—¥å…¥åº“', value: '856', icon: 'ğŸ“¥', color: '#67C23A' },
  { label: 'ä»Šæ—¥å‡ºåº“', value: '1,032', icon: 'ğŸ“¤', color: '#E6A23C' },
  { label: 'é¢„è­¦å•†å“', value: '23', icon: 'âš ï¸', color: '#F56C6C' }
])

// ECharts å›¾è¡¨åˆå§‹åŒ–
const trendChart = ref(null)
const pieChart = ref(null)
const barChart = ref(null)

const initCharts = () => {
  // è¶‹åŠ¿å›¾
  const trend = echarts.init(trendChart.value)
  trend.setOption({
    tooltip: { trigger: 'axis' },
    legend: { data: ['å…¥åº“', 'å‡ºåº“'] },
    xAxis: { type: 'category', data: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'] },
    yAxis: { type: 'value' },
    series: [
      { name: 'å…¥åº“', type: 'line', data: [820, 932, 901, 934, 1290, 1330, 1320], smooth: true },
      { name: 'å‡ºåº“', type: 'line', data: [680, 732, 701, 734, 1090, 1130, 1120], smooth: true }
    ]
  })

  // é¥¼å›¾
  const pie = echarts.init(pieChart.value)
  pie.setOption({
    tooltip: { trigger: 'item' },
    series: [{
      type: 'pie',
      radius: '60%',
      data: [
        { value: 4500, name: 'ç”µå­äº§å“' },
        { value: 3200, name: 'æ—¥ç”¨å“' },
        { value: 2800, name: 'é£Ÿå“' },
        { value: 1845, name: 'å…¶ä»–' }
      ]
    }]
  })

  // æŸ±çŠ¶å›¾
  const bar = echarts.init(barChart.value)
  bar.setOption({
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'category', data: ['AåŒº', 'BåŒº', 'CåŒº', 'DåŒº', 'EåŒº'] },
    yAxis: { type: 'value', max: 100 },
    series: [{
      type: 'bar',
      data: [85, 92, 78, 88, 95],
      itemStyle: { color: '#409EFF' }
    }]
  })
}

onMounted(() => {
  initCharts()
  // å®šæ—¶åˆ·æ–°æ—¶é—´
  const timer = setInterval(() => {
    currentTime.value = dayjs().format('YYYY-MM-DD HH:mm:ss')
  }, 1000)
  
  onUnmounted(() => clearInterval(timer))
})
</script>

<style scoped>
.warehouse-screen {
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
  color: #fff;
  padding: 20px;
  overflow: hidden;
}

.screen-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  display: flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 20px;
}

.stat-icon {
  font-size: 48px;
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  margin-right: 20px;
}

.stat-value {
  font-size: 32px;
  font-weight: bold;
}

.charts-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.chart-container {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 20px;
}

.chart {
  height: 300px;
}
</style>
```

---

## å…­ã€éƒ¨ç½²æ–¹æ¡ˆ

### 6.1 å¾®æœåŠ¡æ¶æ„éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  # Nacos æ³¨å†Œä¸­å¿ƒ
  nacos:
    image: nacos/nacos-server:v2.2.3
    container_name: wms-nacos
    environment:
      - MODE=standalone
      - SPRING_DATASOURCE_PLATFORM=mysql
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_USER=root
      - MYSQL_SERVICE_PASSWORD=123456
    ports:
      - "8848:8848"
      - "9848:9848"
    networks:
      - wms-network
    depends_on:
      - mysql

  # MySQL æ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: wms-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=123456
      - MYSQL_DATABASE=wms
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ./init-sql:/docker-entrypoint-initdb.d
    networks:
      - wms-network

  # Redis ç¼“å­˜
  redis:
    image: redis:7.0-alpine
    container_name: wms-redis
    command: redis-server --requirepass 123456
    ports:
      - "6379:6379"
    networks:
      - wms-network

  # RocketMQ NameServer
  rocketmq-nameserver:
    image: apache/rocketmq:5.1.0
    container_name: wms-rocketmq-nameserver
    command: sh mqnamesrv
    ports:
      - "9876:9876"
    networks:
      - wms-network

  # RocketMQ Broker
  rocketmq-broker:
    image: apache/rocketmq:5.1.0
    container_name: wms-rocketmq-broker
    command: sh mqbroker -n rocketmq-nameserver:9876
    ports:
      - "10909:10909"
      - "10911:10911"
    environment:
      - NAMESRV_ADDR=rocketmq-nameserver:9876
    depends_on:
      - rocketmq-nameserver
    networks:
      - wms-network

  # API ç½‘å…³
  gateway:
    image: wms/gateway:latest
    container_name: wms-gateway
    ports:
      - "8080:8080"
    environment:
      - NACOS_SERVER=nacos:8848
      - REDIS_HOST=redis
    depends_on:
      - nacos
      - redis
    networks:
      - wms-network

  # åº“å­˜æœåŠ¡
  inventory-service:
    image: wms/inventory-service:latest
    container_name: wms-inventory-service
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - nacos
      - mysql
      - redis
    networks:
      - wms-network
    deploy:
      replicas: 2

  # å…¥åº“æœåŠ¡
  inbound-service:
    image: wms/inbound-service:latest
    container_name: wms-inbound-service
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - ROCKETMQ_NAMESRV=rocketmq-nameserver:9876
    depends_on:
      - nacos
      - mysql
      - rocketmq-nameserver
    networks:
      - wms-network

  # å‡ºåº“æœåŠ¡
  outbound-service:
    image: wms/outbound-service:latest
    container_name: wms-outbound-service
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - ROCKETMQ_NAMESRV=rocketmq-nameserver:9876
    depends_on:
      - nacos
      - mysql
      - rocketmq-nameserver
    networks:
      - wms-network

networks:
  wms-network:
    driver: bridge

volumes:
  mysql-data:
```

### 6.2 Kubernetes éƒ¨ç½²é…ç½®

```yaml
# k8s-deployment.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: inventory-service
  namespace: wms
spec:
  replicas: 3
  selector:
    matchLabels:
      app: inventory-service
  template:
    metadata:
      labels:
        app: inventory-service
    spec:
      containers:
      - name: inventory-service
        image: wms/inventory-service:v1.0.0
        ports:
        - containerPort: 8081
        env:
        - name: NACOS_SERVER
          value: "nacos.wms.svc.cluster.local:8848"
        - name: MYSQL_HOST
          value: "mysql.wms.svc.cluster.local"
        - name: REDIS_HOST
          value: "redis.wms.svc.cluster.local"
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8081
          initialDelaySeconds: 60
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8081
          initialDelaySeconds: 30
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: inventory-service
  namespace: wms
spec:
  selector:
    app: inventory-service
  ports:
  - protocol: TCP
    port: 8081
    targetPort: 8081
  type: ClusterIP
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: inventory-service-hpa
  namespace: wms
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: inventory-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

### 6.3 ç›‘æ§é…ç½®ï¼ˆPrometheus + Grafanaï¼‰

```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Spring Boot Actuator ç›‘æ§
  - job_name: 'wms-services'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets:
        - 'inventory-service:8081'
        - 'inbound-service:8082'
        - 'outbound-service:8083'
        - 'picking-service:8084'
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '([^:]+)(:[0-9]+)?'
        replacement: '${1}'

  # MySQL ç›‘æ§
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-exporter:9104']

  # Redis ç›‘æ§
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
```

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 æ•°æ®åº“ä¼˜åŒ–

#### 7.1.1 åˆ†åº“åˆ†è¡¨ç­–ç•¥

**ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ**

| é—®é¢˜ | æ•°æ®é‡é˜ˆå€¼ | å½±å“ | è§£å†³æ–¹æ¡ˆ |
|------|-----------|------|---------|
| å•è¡¨æ•°æ®è¿‡å¤§ | > 500ä¸‡è¡Œ | æŸ¥è¯¢æ…¢ã€ç´¢å¼•å¤±æ•ˆ | åˆ†è¡¨ |
| å¹¶å‘å†™å…¥ç“¶é¢ˆ | > 5000 TPS | é”ç­‰å¾…ã€æ€§èƒ½ä¸‹é™ | åˆ†åº“ |
| å†å²æ•°æ®å†—ä½™ | å¢é•¿æ— é™åˆ¶ | ç£ç›˜å ç”¨ã€å¤‡ä»½æ…¢ | å½’æ¡£ |

**æˆ‘ä»¬çš„åˆ†è¡¨ç­–ç•¥ï¼š**

```java
/**
 * åº“å­˜æµæ°´è¡¨åˆ†è¡¨ç­–ç•¥
 * æŒ‰æœˆä»½åˆ†è¡¨: inventory_log_202401, inventory_log_202402 ...
 * 
 * é€‰æ‹©æœˆä»½åˆ†è¡¨çš„åŸå› ï¼š
 * 1. æµæ°´æ•°æ®æŒ‰æ—¶é—´æŸ¥è¯¢å±…å¤šï¼Œæœˆä»½åˆ†è¡¨æŸ¥è¯¢æ•ˆç‡é«˜
 * 2. æ¯æœˆæ•°æ®é‡å¯æ§ï¼ˆçº¦100-200ä¸‡æ¡ï¼‰
 * 3. ä¾¿äºå†å²æ•°æ®å½’æ¡£ï¼ˆè¶…è¿‡12ä¸ªæœˆè‡ªåŠ¨å½’æ¡£åˆ°å†·å­˜å‚¨ï¼‰
 */
@Component
public class InventoryLogShardingAlgorithm implements StandardShardingAlgorithm<LocalDateTime> {
    
    @Override
    public String doSharding(Collection<String> availableTargetNames, 
                            PreciseShardingValue<LocalDateTime> shardingValue) {
        LocalDateTime createTime = shardingValue.getValue();
        String suffix = createTime.format(DateTimeFormatter.ofPattern("yyyyMM"));
        return "inventory_log_" + suffix;
    }
    
    @Override
    public Collection<String> doSharding(Collection<String> availableTargetNames,
                                        RangeShardingValue<LocalDateTime> shardingValue) {
        // èŒƒå›´æŸ¥è¯¢ï¼šè·¨æœˆæŸ¥è¯¢æ—¶è·¯ç”±åˆ°å¤šä¸ªåˆ†è¡¨
        LocalDateTime start = shardingValue.getValueRange().lowerEndpoint();
        LocalDateTime end = shardingValue.getValueRange().upperEndpoint();
        
        Set<String> tables = new HashSet<>();
        YearMonth startMonth = YearMonth.from(start);
        YearMonth endMonth = YearMonth.from(end);
        
        while (!startMonth.isAfter(endMonth)) {
            String tableName = "inventory_log_" + startMonth.format(DateTimeFormatter.ofPattern("yyyyMM"));
            tables.add(tableName);
            startMonth = startMonth.plusMonths(1);
        }
        
        return tables;
    }
}
```

**é…ç½®ç¤ºä¾‹ï¼š**

```yaml
# ShardingSphere é…ç½®
spring:
  shardingsphere:
    rules:
      sharding:
        tables:
          # åº“å­˜æµæ°´è¡¨åˆ†è¡¨é…ç½®
          inventory_log:
            actual-data-nodes: ds0.inventory_log_$->{202401..202412}
            table-strategy:
              standard:
                sharding-column: create_time
                sharding-algorithm-name: inventory-log-sharding
        sharding-algorithms:
          inventory-log-sharding:
            type: CLASS_BASED
            props:
              strategy: STANDARD
              algorithm-class-name: com.wms.config.InventoryLogShardingAlgorithm
```

#### 7.1.2 ç´¢å¼•ä¼˜åŒ–

**ç´¢å¼•è®¾è®¡åŸåˆ™ï¼š**

1. **è¦†ç›–ç´¢å¼•ä¼˜å…ˆ**ï¼šæŸ¥è¯¢å­—æ®µå…¨éƒ¨åœ¨ç´¢å¼•ä¸­ï¼Œé¿å…å›è¡¨
2. **æœ€å·¦å‰ç¼€åŒ¹é…**ï¼šç»„åˆç´¢å¼•æŒ‰æŸ¥è¯¢é¢‘ç‡æ’åˆ—
3. **é¿å…è¿‡åº¦ç´¢å¼•**ï¼šæ¯ä¸ªç´¢å¼•éƒ½æœ‰ç»´æŠ¤æˆæœ¬
4. **å®šæœŸåˆ†æç´¢å¼•**ï¼šåˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•

```sql
-- ========================================
-- æ ¸å¿ƒç´¢å¼•è®¾è®¡
-- ========================================

-- 1. åº“å­˜è¡¨ç»„åˆç´¢å¼•ï¼ˆè¦†ç›–å¸¸ç”¨æŸ¥è¯¢ï¼‰
-- æŸ¥è¯¢åœºæ™¯ï¼šæŒ‰ä»“åº“ã€å•†å“ã€æ‰¹æ¬¡æŸ¥è¯¢åº“å­˜
CREATE INDEX idx_warehouse_goods_batch 
ON inventory(warehouse_id, goods_id, batch_no, quantity, lock_quantity);

-- 2. åº“å­˜è¡¨çŠ¶æ€ç´¢å¼•
-- æŸ¥è¯¢åœºæ™¯ï¼šæŸ¥è¯¢å¼‚å¸¸åº“å­˜ã€å†»ç»“åº“å­˜
CREATE INDEX idx_status_goods 
ON inventory(status, goods_id) WHERE status != 1;

-- 3. å‡ºåº“å•çŠ¶æ€ + åˆ›å»ºæ—¶é—´ç´¢å¼•
-- æŸ¥è¯¢åœºæ™¯ï¼šæŸ¥è¯¢å¾…å¤„ç†è®¢å•ã€ä»Šæ—¥è®¢å•
CREATE INDEX idx_status_create_time 
ON outbound_order(status, create_time DESC)
WHERE status IN (1, 2, 3); -- åªç´¢å¼•æœªå®ŒæˆçŠ¶æ€

-- 4. æ‹£è´§ä»»åŠ¡åˆ†é…ç´¢å¼•
-- æŸ¥è¯¢åœºæ™¯ï¼šæŸ¥æ‰¾å¯åˆ†é…ä»»åŠ¡
CREATE INDEX idx_warehouse_status_priority 
ON picking_task(warehouse_id, status, priority DESC, create_time)
WHERE status = 1; -- åªç´¢å¼•å¾…åˆ†é…çŠ¶æ€

-- 5. åº“å­˜æµæ°´æ—¶é—´èŒƒå›´æŸ¥è¯¢
-- æŸ¥è¯¢åœºæ™¯ï¼šç»Ÿè®¡æŸæ®µæ—¶é—´çš„å‡ºå…¥åº“è®°å½•
CREATE INDEX idx_create_time_operation 
ON inventory_log(create_time, operation_type, quantity_change);

-- 6. å•†å“åç§°å…¨æ–‡ç´¢å¼•ï¼ˆç”¨äºæœç´¢ï¼‰
CREATE FULLTEXT INDEX idx_goods_name_fulltext 
ON goods(goods_name, brand, model);

-- ========================================
-- ç´¢å¼•ç›‘æ§ä¸ä¼˜åŒ–
-- ========================================

-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•
SELECT 
    t.table_schema,
    t.table_name,
    s.index_name,
    s.rows_read,
    s.rows_inserted
FROM information_schema.tables t
LEFT JOIN performance_schema.table_io_waits_summary_by_index_usage s 
    ON t.table_name = s.object_name
WHERE t.table_schema = 'wms'
    AND s.index_name IS NOT NULL
    AND s.index_name != 'PRIMARY'
    AND s.rows_read = 0
ORDER BY t.table_name;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨é¢‘ç‡
SELECT 
    object_name AS table_name,
    index_name,
    count_star AS queries,
    sum_timer_wait / 1000000000000 AS total_latency_sec,
    avg_timer_wait / 1000000000 AS avg_latency_ms
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'wms'
ORDER BY sum_timer_wait DESC
LIMIT 20;
```

**ç´¢å¼•ä¼˜åŒ–æ•ˆæœï¼š**

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-------|-------|-------|------|
| åº“å­˜æŸ¥è¯¢å“åº”æ—¶é—´ | 450ms | 35ms | â†“ 92% |
| è®¢å•åˆ—è¡¨æŸ¥è¯¢ | 1.2s | 180ms | â†“ 85% |
| æ‹£è´§ä»»åŠ¡åˆ†é… | 680ms | 45ms | â†“ 93% |
| ç´¢å¼•æ•°é‡ | 28ä¸ª | 18ä¸ª | â†“ 36% |

#### 7.1.3 SQLä¼˜åŒ–å®è·µ

**æ…¢æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹ï¼š**

```sql
-- âŒ ä¼˜åŒ–å‰ï¼šæŸ¥è¯¢æŸå•†å“çš„å¯ç”¨åº“å­˜æ€»é‡
-- é—®é¢˜ï¼šå…¨è¡¨æ‰«æï¼Œæœªä½¿ç”¨ç´¢å¼•
SELECT SUM(quantity - lock_quantity) AS available_qty
FROM inventory
WHERE goods_id = 12345
  AND status = 1;

-- æ‰§è¡Œæ—¶é—´ï¼š850msï¼ˆæ‰«æ50ä¸‡è¡Œï¼‰

-- âœ… ä¼˜åŒ–åï¼šæ·»åŠ ç´¢å¼• + ä½¿ç”¨è¦†ç›–ç´¢å¼•
CREATE INDEX idx_goods_status_qty 
ON inventory(goods_id, status, quantity, lock_quantity);

-- æ‰§è¡Œæ—¶é—´ï¼š15msï¼ˆåªæ‰«æç›¸å…³è¡Œï¼‰


-- âŒ ä¼˜åŒ–å‰ï¼šåˆ†é¡µæŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼ˆåç§»é‡å¤§æ—¶æ€§èƒ½å·®ï¼‰
SELECT * FROM outbound_order
WHERE status = 2
ORDER BY create_time DESC
LIMIT 10000, 20;

-- æ‰§è¡Œæ—¶é—´ï¼š2.3sï¼ˆéœ€è¦è·³è¿‡10000æ¡è®°å½•ï¼‰

-- âœ… ä¼˜åŒ–åï¼šä½¿ç”¨å»¶è¿Ÿå…³è” + å­æŸ¥è¯¢ä¼˜åŒ–
SELECT o.* FROM outbound_order o
INNER JOIN (
    SELECT id FROM outbound_order
    WHERE status = 2
    ORDER BY create_time DESC
    LIMIT 10000, 20
) AS t ON o.id = t.id;

-- æ‰§è¡Œæ—¶é—´ï¼š180msï¼ˆå­æŸ¥è¯¢åªæŸ¥IDï¼Œå‡å°‘æ•°æ®ä¼ è¾“ï¼‰


-- âŒ ä¼˜åŒ–å‰ï¼šç»Ÿè®¡æ¯ä¸ªå•†å“çš„åº“å­˜åˆ†å¸ƒï¼ˆN+1æŸ¥è¯¢ï¼‰
-- Javaä»£ç ä¸­å¾ªç¯æŸ¥è¯¢ï¼Œäº§ç”Ÿå¤§é‡SQL
for (Goods goods : goodsList) {
    List<Inventory> invs = inventoryMapper.selectByGoodsId(goods.getId());
    // ... å¤„ç†
}

-- æ‰§è¡Œæ—¶é—´ï¼š1000 * 50ms = 50ç§’

-- âœ… ä¼˜åŒ–åï¼šæ‰¹é‡æŸ¥è¯¢ + JOIN
SELECT g.id, g.goods_name, i.warehouse_id, SUM(i.quantity) AS total_qty
FROM goods g
LEFT JOIN inventory i ON g.id = i.goods_id
WHERE g.id IN (1, 2, 3, ..., 1000)
  AND i.status = 1
GROUP BY g.id, i.warehouse_id;

-- æ‰§è¡Œæ—¶é—´ï¼š350ms
```

### 7.2 ç¼“å­˜ç­–ç•¥

```java
/**
 * å¤šçº§ç¼“å­˜ç­–ç•¥
 */
@Service
public class InventoryCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private final Cache<String, InventoryVO> localCache = CacheBuilder.newBuilder()
        .maximumSize(10000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    /**
     * æŸ¥è¯¢åº“å­˜ï¼ˆå¤šçº§ç¼“å­˜ï¼‰
     */
    public InventoryVO getInventory(Long warehouseId, Long goodsId) {
        String key = "inv:" + warehouseId + ":" + goodsId;
        
        // 1. æŸ¥è¯¢æœ¬åœ°ç¼“å­˜
        InventoryVO cached = localCache.getIfPresent(key);
        if (cached != null) {
            return cached;
        }
        
        // 2. æŸ¥è¯¢ Redis
        cached = (InventoryVO) redisTemplate.opsForValue().get(key);
        if (cached != null) {
            localCache.put(key, cached);
            return cached;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        InventoryVO inventory = inventoryMapper.selectByWarehouseAndGoods(warehouseId, goodsId);
        
        // 4. å†™å…¥ç¼“å­˜
        if (inventory != null) {
            redisTemplate.opsForValue().set(key, inventory, 10, TimeUnit.MINUTES);
            localCache.put(key, inventory);
        }
        
        return inventory;
    }
}
```

### 7.3 æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†

```java
/**
 * å‡ºåº“æ¶ˆæ¯ç”Ÿäº§è€…
 */
@Service
public class OutboundMessageProducer {
    
    @Autowired
    private RocketMQTemplate rocketMQTemplate;
    
    /**
     * å‘é€å‡ºåº“å®Œæˆæ¶ˆæ¯
     */
    public void sendOutboundCompletedMessage(Long orderId) {
        OutboundCompletedEvent event = new OutboundCompletedEvent();
        event.setOrderId(orderId);
        event.setTimestamp(LocalDateTime.now());
        
        // å¼‚æ­¥å‘é€
        rocketMQTemplate.asyncSend("OUTBOUND_COMPLETED_TOPIC", event, new SendCallback() {
            @Override
            public void onSuccess(SendResult sendResult) {
                log.info("å‡ºåº“æ¶ˆæ¯å‘é€æˆåŠŸ: orderId={}", orderId);
            }
            
            @Override
            public void onException(Throwable throwable) {
                log.error("å‡ºåº“æ¶ˆæ¯å‘é€å¤±è´¥: orderId={}", orderId, throwable);
                // é‡è¯•æˆ–è®°å½•è¡¥å¿ä»»åŠ¡
            }
        });
    }
}

/**
 * åº“å­˜æ‰£å‡æ¶ˆè´¹è€…
 */
@Service
@RocketMQMessageListener(
    topic = "OUTBOUND_COMPLETED_TOPIC",
    consumerGroup = "inventory-consumer-group"
)
public class InventoryDeductConsumer implements RocketMQListener<OutboundCompletedEvent> {
    
    @Autowired
    private InventoryService inventoryService;
    
    @Override
    public void onMessage(OutboundCompletedEvent event) {
        try {
            // æ‰£å‡åº“å­˜
            inventoryService.deductInventoryForOrder(event.getOrderId());
            log.info("åº“å­˜æ‰£å‡å®Œæˆ: orderId={}", event.getOrderId());
        } catch (Exception e) {
            log.error("åº“å­˜æ‰£å‡å¤±è´¥: orderId={}", event.getOrderId(), e);
            throw new RuntimeException("åº“å­˜æ‰£å‡å¤±è´¥ï¼Œè§¦å‘é‡è¯•", e);
        }
    }
}
```

---

## å…«ã€æ€»ç»“ä¸å±•æœ›

### 8.1 ç³»ç»Ÿç‰¹ç‚¹

| ç‰¹ç‚¹ | è¯´æ˜ |
|------|------|
| âš¡ **é«˜æ€§èƒ½** | Redis ç¼“å­˜ + æ•°æ®åº“ä¼˜åŒ–ï¼Œæ”¯æŒ 10000+ TPS |
| ğŸ”’ **é«˜å¯é ** | åˆ†å¸ƒå¼é” + äº‹åŠ¡ä¿è¯ï¼Œåº“å­˜å‡†ç¡®ç‡ 99.9% |
| ğŸ“ˆ **å¯æ‰©å±•** | å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒæ°´å¹³æ‰©å±• |
| ğŸ¯ **æ™ºèƒ½åŒ–** | æ‹£è´§è·¯å¾„ä¼˜åŒ–ï¼Œæ•ˆç‡æå‡ 40% |
| ğŸ“Š **å¯è§†åŒ–** | å®æ—¶ç›‘æ§å¤§å±ï¼Œæ•°æ®ä¸€ç›®äº†ç„¶ |

### 8.2 æœªæ¥è§„åˆ’

#### ğŸ¤– AI æ™ºèƒ½åŒ–
- åº“å­˜éœ€æ±‚é¢„æµ‹
- æ™ºèƒ½è¡¥è´§å»ºè®®
- å¼‚å¸¸æ£€æµ‹å‘Šè­¦

#### ğŸ“± ç§»åŠ¨åŒ–
- PDA æ‰‹æŒç»ˆç«¯
- è¯­éŸ³æ‹£è´§
- AR è¾…åŠ©æ‹£è´§

#### ğŸŒ IoT ç‰©è”ç½‘
- RFID è‡ªåŠ¨è¯†åˆ«
- æ¸©æ¹¿åº¦ç›‘æ§
- è‡ªåŠ¨åŒ–ç«‹ä½“åº“

#### ğŸ”— åŒºå—é“¾è¿½æº¯
- å•†å“æº¯æº
- é˜²ä¼ªéªŒè¯
- ä¾›åº”é“¾ååŒ

---

## é™„å½•

### A. å¸¸è§é—®é¢˜

**Q1: å¦‚ä½•å¤„ç†åº“å­˜å¹¶å‘é—®é¢˜ï¼Ÿ**

A: ä½¿ç”¨ Redis åˆ†å¸ƒå¼é” + æ•°æ®åº“è¡Œé”ï¼ˆFOR UPDATEï¼‰åŒé‡ä¿è¯ã€‚

**Q2: æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•å¤æ‚åº¦å¦‚ä½•ï¼Ÿ**

A: è´ªå¿ƒç®—æ³•æ—¶é—´å¤æ‚åº¦ O(nÂ²)ï¼Œé€‚ç”¨äºä¸­å°è§„æ¨¡ï¼ˆ< 1000 ä¸ªåº“ä½ï¼‰ã€‚

**Q3: å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ**

A: é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSeataï¼‰+ æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—è¡¥å¿ï¼‰ã€‚

### B. å‚è€ƒèµ„æ–™

- [Spring Cloud å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-cloud)
- [MyBatis-Plus å®˜æ–¹æ–‡æ¡£](https://baomidou.com/)
- [RocketMQ å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/zh-cn/)

---

:::info[ğŸ“„ æ–‡æ¡£ä¿¡æ¯]
**ğŸ‰ WMS ä»“åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£**

- **ç‰ˆæœ¬**: v1.0.0
- **æ›´æ–°æ—¶é—´**: 2025-10-16
- **ä½œè€…**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ
- **æ ‡ç­¾**: WMS, ä»“åº“ç®¡ç†, Spring Cloud, å¾®æœåŠ¡æ¶æ„
:::

---

## ä¹ã€å®Œæ•´æ•°æ®å­—å…¸

### 9.1 çŠ¶æ€ç å­—å…¸

#### å…¥åº“å•çŠ¶æ€ (inbound_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ | å¯æ“ä½œ |
|-------|---------|------|--------|
| 1 | å¾…å®¡æ ¸ | å…¥åº“å•å·²åˆ›å»º,ç­‰å¾…å®¡æ ¸ | å®¡æ ¸é€šè¿‡/é©³å› |
| 2 | å¾…å…¥åº“ | å®¡æ ¸é€šè¿‡,ç­‰å¾…æ”¶è´§ | å¼€å§‹æ”¶è´§ |
| 3 | å…¥åº“ä¸­ | æ­£åœ¨æ”¶è´§ä¸Šæ¶ | ç»§ç»­å…¥åº“/å®Œæˆå…¥åº“ |
| 4 | å·²å®Œæˆ | å…¥åº“å®Œæˆ | æŸ¥çœ‹ |
| 5 | å·²å–æ¶ˆ | å…¥åº“å•å·²å–æ¶ˆ | æŸ¥çœ‹ |

#### å‡ºåº“å•çŠ¶æ€ (outbound_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ | å¯æ“ä½œ |
|-------|---------|------|--------|
| 1 | å¾…å®¡æ ¸ | å‡ºåº“å•å·²åˆ›å»º,ç­‰å¾…å®¡æ ¸ | å®¡æ ¸é€šè¿‡/é©³å› |
| 2 | å¾…å‡ºåº“ | å®¡æ ¸é€šè¿‡,ç­‰å¾…åˆ›å»ºæ‹£è´§ä»»åŠ¡ | åˆ›å»ºæ³¢æ¬¡ |
| 3 | æ‹£è´§ä¸­ | æ­£åœ¨æ‰§è¡Œæ‹£è´§ | æŸ¥çœ‹è¿›åº¦ |
| 4 | å¾…å¤æ ¸ | æ‹£è´§å®Œæˆ,ç­‰å¾…å¤æ ¸ | å¼€å§‹å¤æ ¸ |
| 5 | å¾…å‘è´§ | å¤æ ¸å®Œæˆ,ç­‰å¾…æ‰“åŒ…å‘è´§ | ç¡®è®¤å‘è´§ |
| 6 | å·²å‘è´§ | å•†å“å·²å‘å‡º | æŸ¥çœ‹ç‰©æµ |
| 7 | å·²å–æ¶ˆ | å‡ºåº“å•å·²å–æ¶ˆ | æŸ¥çœ‹ |

#### åº“å­˜çŠ¶æ€ (inventory_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | é¢œè‰²æ ‡è¯† | è¯´æ˜ |
|-------|---------|---------|------|
| 1 | æ­£å¸¸ | success | å¯æ­£å¸¸å‡ºåº“ |
| 2 | å†»ç»“ | danger | ä¸å¯å‡ºåº“,å¾…å¤„ç† |
| 3 | å¾…æ£€ | warning | è´¨æ£€ä¸­,ä¸å¯å‡ºåº“ |
| 4 | æŸå | info | å·²æŸå,å¾…æŠ¥æŸ |

#### æ‹£è´§ä»»åŠ¡çŠ¶æ€ (picking_task_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…æ‹£è´§ | ä»»åŠ¡å·²åˆ†é…,æœªå¼€å§‹ |
| 2 | æ‹£è´§ä¸­ | æ‹£è´§å‘˜æ­£åœ¨æ‰§è¡Œ |
| 3 | å·²å®Œæˆ | æ‹£è´§å®Œæˆ |
| 4 | å¼‚å¸¸ | æ‹£è´§å¼‚å¸¸(åº“ä½ç©º/åº“å­˜ä¸è¶³/å•†å“æŸå) |

#### ç›˜ç‚¹å•çŠ¶æ€ (stock_taking_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…ç›˜ç‚¹ | ç›˜ç‚¹å•å·²ç”Ÿæˆ,æœªç›˜ç‚¹ |
| 2 | å·²ç›˜ç‚¹ | å®ç›˜å®Œæˆ,å¾…å¤æ ¸ |
| 3 | å·²å¤æ ¸ | å¤æ ¸å®Œæˆ,å¾…è°ƒæ•´åº“å­˜ |
| 4 | å·²è°ƒæ•´ | åº“å­˜å·²è°ƒæ•´ |

### 9.2 ç±»å‹å­—å…¸

#### å…¥åº“ç±»å‹ (inbound_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | å›¾æ ‡ | ä¸šåŠ¡åœºæ™¯ |
|-------|---------|------|---------|
| PURCHASE | é‡‡è´­å…¥åº“ | ğŸ“¦ | ä¾›åº”å•†é‡‡è´­åˆ°è´§ |
| RETURN | é€€è´§å…¥åº“ | ğŸ”™ | å®¢æˆ·é€€è´§å…¥ä»“ |
| TRANSFER | è°ƒæ‹¨å…¥åº“ | ğŸ”„ | å…¶ä»–ä»“åº“è°ƒå…¥ |
| PROFIT | ç›˜ç›ˆå…¥åº“ | â• | ç›˜ç‚¹å‘ç°å¤šä½™åº“å­˜ |
| PRODUCTION | ç”Ÿäº§å…¥åº“ | ğŸ­ | ç”Ÿäº§å®Œå·¥å…¥åº“ |
| OTHER | å…¶ä»–å…¥åº“ | ğŸ“ | å…¶ä»–å…¥åº“åœºæ™¯ |

#### å‡ºåº“ç±»å‹ (outbound_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | å›¾æ ‡ | ä¸šåŠ¡åœºæ™¯ |
|-------|---------|------|---------|
| SALE | é”€å”®å‡ºåº“ | ğŸ›’ | å®¢æˆ·è®¢å•å‘è´§ |
| TRANSFER | è°ƒæ‹¨å‡ºåº“ | ğŸ”„ | è°ƒæ‹¨åˆ°å…¶ä»–ä»“åº“ |
| SCRAP | æŠ¥æŸå‡ºåº“ | âŒ | æŸåå•†å“æŠ¥æŸ |
| RETURN | é€€è´§å‡ºåº“ | ğŸ”™ | é€€è´§ç»™ä¾›åº”å•† |
| LOSS | ç›˜äºå‡ºåº“ | â– | ç›˜ç‚¹å‘ç°çŸ­ç¼º |
| OTHER | å…¶ä»–å‡ºåº“ | ğŸ“ | å…¶ä»–å‡ºåº“åœºæ™¯ |

#### ç›˜ç‚¹ç±»å‹ (stock_taking_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | é€‚ç”¨åœºæ™¯ | é¢‘ç‡å»ºè®® |
|-------|---------|---------|---------|
| FULL | å…¨ç›˜ | å…¨ä»“æ‰€æœ‰å•†å“ç›˜ç‚¹ | æ¯å¹´1-2æ¬¡ |
| CYCLE | å¾ªç¯ç›˜ | æŒ‰ABCåˆ†ç±»åˆ†æ‰¹ç›˜ç‚¹ | æ¯æœˆ1æ¬¡ |
| SPOT | æŠ½ç›˜ | éšæœºæŠ½å–éƒ¨åˆ†å•†å“ | æ¯å‘¨1æ¬¡ |
| DYNAMIC | åŠ¨æ€ç›˜ | é›¶åº“å­˜å•†å“ç›˜ç‚¹ | éšæ—¶ |

#### ç§»åº“ç±»å‹ (stock_move_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| LOCATION | åº“ä½è°ƒæ•´ | åŒä¸€åº“åŒºå†…åº“ä½é—´ç§»åŠ¨ |
| AREA | åº“åŒºè°ƒæ•´ | åŒä¸€ä»“åº“å†…åº“åŒºé—´ç§»åŠ¨ |
| WAREHOUSE | ä»“åº“è°ƒæ‹¨ | ä¸åŒä»“åº“é—´è°ƒæ‹¨ |

### 9.3 æšä¸¾å­—å…¸

#### ä¼˜å…ˆçº§ (priority)

| ä¼˜å…ˆçº§å€¼ | ä¼˜å…ˆçº§åç§° | é¢œè‰² | å¤„ç†æ—¶æ•ˆ |
|---------|-----------|-----|---------|
| 1 | æ™®é€š | default | 24å°æ—¶å†… |
| 2 | ç´§æ€¥ | warning | 8å°æ—¶å†… |
| 3 | ç‰¹æ€¥ | danger | 2å°æ—¶å†… |

#### è®¡é‡å•ä½ (unit)

| å•ä½ä»£ç  | å•ä½åç§° | è‹±æ–‡ |
|---------|---------|------|
| PCS | ä¸ª/ä»¶ | Piece |
| BOX | ç®± | Box |
| CTN | çº¸ç®± | Carton |
| PLT | æ‰˜ç›˜ | Pallet |
| KG | åƒå…‹ | Kilogram |
| METER | ç±³ | Meter |
| LITER | å‡ | Liter |

#### å¼‚å¸¸ç±»å‹ (exception_type)

| å¼‚å¸¸ä»£ç  | å¼‚å¸¸åç§° | å¤„ç†æ–¹å¼ |
|---------|---------|---------|
| EMPTY | åº“ä½ç©ºç¼º | è§¦å‘ç›˜ç‚¹,æŸ¥æ‰¾æ›¿ä»£åº“ä½ |
| SHORT | åº“å­˜ä¸è¶³ | å‡å•æˆ–ç­‰å¾…è¡¥è´§ |
| DAMAGED | å•†å“æŸå | æ ‡è®°æ®‹æ¬¡,æŸ¥æ‰¾æ›¿ä»£æ‰¹æ¬¡ |
| EXPIRED | å•†å“è¿‡æœŸ | å†»ç»“åº“å­˜,å®‰æ’æŠ¥æŸ |
| WRONG | æ‹£é”™å•†å“ | å›é€€é‡æ‹£,è®°å½•é”™è¯¯ç‡ |

### 9.4 è¡¥å……å­—å…¸

#### ä»“åº“ç±»å‹ (warehouse_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | æˆå“ä»“ | å­˜å‚¨æˆå“å•†å“ |
| 2 | åŸæ–™ä»“ | å­˜å‚¨åŸææ–™ |
| 3 | åŠæˆå“ä»“ | å­˜å‚¨åŠæˆå“ |

#### åº“åŒºç±»å‹ (warehouse_area_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| STORAGE | å­˜å‚¨åŒº | é•¿æœŸå­˜å‚¨åŒºåŸŸ |
| PICKING | æ‹£è´§åŒº | é«˜é¢‘å‡ºåº“å•†å“å­˜å‚¨ |
| STAGING | æš‚å­˜åŒº | ä¸´æ—¶å­˜æ”¾åŒºåŸŸ |
| RECEIVING | æ”¶è´§åŒº | æ”¶è´§éªŒæ”¶åŒºåŸŸ |
| SHIPPING | å‘è´§åŒº | æ‰“åŒ…å‘è´§åŒºåŸŸ |

#### åº“ä½ç±»å‹ (location_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| NORMAL | æ™®é€šåº“ä½ | æ ‡å‡†å­˜å‚¨åº“ä½ |
| TEMP | ä¸´æ—¶åº“ä½ | ä¸´æ—¶å­˜æ”¾ |
| DEFECT | æ®‹æ¬¡å“åº“ä½ | å­˜æ”¾æ®‹æ¬¡å“ |
| FROZEN | å†·å†»åº“ä½ | éœ€å†·è—å•†å“ |

#### åº“ä½çŠ¶æ€ (location_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | ç©ºé—² | åº“ä½ç©ºé—²å¯ç”¨ |
| 2 | å ç”¨ | åº“ä½å·²å­˜æ”¾å•†å“ |
| 3 | é”å®š | åº“ä½é”å®šä¸å¯ç”¨ |
| 0 | ç¦ç”¨ | åº“ä½ç¦ç”¨ |

#### æ‹£è´§æ³¢æ¬¡ç±»å‹ (wave_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| BATCH | æ‰¹æ¬¡æ‹£è´§ | å¤šè®¢å•æ‰¹é‡æ‹£è´§ |
| ZONE | åˆ†åŒºæ‹£è´§ | æŒ‰åº“åŒºåˆ†åŒºæ‹£è´§ |
| SINGLE | å•å“æ‹£è´§ | å•ä¸ªè®¢å•æ‹£è´§ |

#### æ‹£è´§æ³¢æ¬¡çŠ¶æ€ (wave_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…åˆ†é… | æ³¢æ¬¡å·²ç”Ÿæˆ,å¾…åˆ†é…æ‹£è´§å‘˜ |
| 2 | å·²åˆ†é… | å·²åˆ†é…æ‹£è´§å‘˜,å¾…å¼€å§‹ |
| 3 | æ‹£è´§ä¸­ | æ­£åœ¨æ‰§è¡Œæ‹£è´§ |
| 4 | å·²å®Œæˆ | æ‹£è´§å®Œæˆ |
| 5 | å·²å–æ¶ˆ | æ³¢æ¬¡å–æ¶ˆ |

#### ç›˜ç‚¹è®¡åˆ’çŠ¶æ€ (stock_taking_plan_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…å®¡æ ¸ | è®¡åˆ’å·²åˆ›å»º,å¾…å®¡æ ¸ |
| 2 | å¾…æ‰§è¡Œ | å®¡æ ¸é€šè¿‡,å¾…æ‰§è¡Œ |
| 3 | æ‰§è¡Œä¸­ | æ­£åœ¨ç›˜ç‚¹ |
| 4 | å·²å®Œæˆ | ç›˜ç‚¹å®Œæˆ |
| 5 | å·²å–æ¶ˆ | è®¡åˆ’å–æ¶ˆ |

#### ç§»åº“å•çŠ¶æ€ (stock_move_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…æ‰§è¡Œ | ç§»åº“å•å·²åˆ›å»º,å¾…æ‰§è¡Œ |
| 2 | æ‰§è¡Œä¸­ | æ­£åœ¨ç§»åº“ |
| 3 | å·²å®Œæˆ | ç§»åº“å®Œæˆ |
| 4 | å·²å–æ¶ˆ | ç§»åº“å–æ¶ˆ |

#### å…¥åº“å•æ˜ç»†çŠ¶æ€ (inbound_detail_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…æ”¶è´§ | å¾…æ”¶è´§éªŒæ”¶ |
| 2 | å·²æ”¶è´§ | å·²æ”¶è´§å¾…ä¸Šæ¶ |
| 3 | å·²ä¸Šæ¶ | å·²ä¸Šæ¶å®Œæˆ |

#### å‡ºåº“å•æ˜ç»†çŠ¶æ€ (outbound_detail_status)

| çŠ¶æ€å€¼ | çŠ¶æ€åç§° | è¯´æ˜ |
|-------|---------|------|
| 1 | å¾…æ‹£è´§ | å¾…æ‹£è´§ |
| 2 | æ‹£è´§ä¸­ | æ­£åœ¨æ‹£è´§ |
| 3 | å·²æ‹£è´§ | æ‹£è´§å®Œæˆå¾…å¤æ ¸ |
| 4 | å·²å¤æ ¸ | å¤æ ¸å®Œæˆå¾…å‘è´§ |
| 5 | å·²å‘è´§ | å·²å‘è´§ |

#### ä¾›åº”å•†ç±»å‹ (supplier_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| NORMAL | æ™®é€šä¾›åº”å•† | ä¸€èˆ¬åˆä½œä¾›åº”å•† |
| VIP | VIPä¾›åº”å•† | é‡è¦åˆä½œä¼™ä¼´ |
| STRATEGIC | æˆ˜ç•¥ä¾›åº”å•† | æˆ˜ç•¥åˆä½œä¼™ä¼´ |

#### å®¢æˆ·ç±»å‹ (customer_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| RETAIL | é›¶å”®å®¢æˆ· | é›¶å”®ç»ˆç«¯å®¢æˆ· |
| WHOLESALE | æ‰¹å‘å®¢æˆ· | æ‰¹å‘å•†å®¢æˆ· |
| ENTERPRISE | ä¼ä¸šå®¢æˆ· | ä¼ä¸šçº§å®¢æˆ· |

#### å®¢æˆ·ç­‰çº§ (customer_level)

| ç­‰çº§å€¼ | ç­‰çº§åç§° | è¯´æ˜ |
|-------|---------|------|
| VIP | VIPå®¢æˆ· | æœ€é«˜çº§å®¢æˆ· |
| GOLD | é‡‘ç‰Œå®¢æˆ· | é«˜ä»·å€¼å®¢æˆ· |
| SILVER | é“¶ç‰Œå®¢æˆ· | ä¸­ç­‰ä»·å€¼å®¢æˆ· |
| NORMAL | æ™®é€šå®¢æˆ· | ä¸€èˆ¬å®¢æˆ· |

#### æ‰¿è¿å•†ç±»å‹ (carrier_type)

| ç±»å‹å€¼ | ç±»å‹åç§° | è¯´æ˜ |
|-------|---------|------|
| EXPRESS | å¿«é€’ | å¿«é€’å…¬å¸ |
| LOGISTICS | ç‰©æµ | ç‰©æµå…¬å¸ |
| SPECIAL | ä¸“çº¿ | ä¸“çº¿ç‰©æµ |

## åã€å®Œæ•´ç³»ç»ŸåŠŸèƒ½æ¸…å•

### 10.1 èœå•ç»“æ„æ ‘

```
WMS ä»“åº“ç®¡ç†ç³»ç»Ÿ
â”œâ”€â”€ ğŸ“Š å·¥ä½œå°
â”‚   â”œâ”€â”€ é¦–é¡µä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ å¾…åŠä»»åŠ¡
â”‚   â””â”€â”€ æ•°æ®å¤§å±
â”œâ”€â”€ ğŸ“¦ åº“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ åº“å­˜æŸ¥è¯¢
â”‚   â”œâ”€â”€ åº“å­˜é¢„è­¦
â”‚   â”œâ”€â”€ åº“å­˜æµæ°´
â”‚   â”œâ”€â”€ åº“å­˜å¿«ç…§
â”‚   â””â”€â”€ åº“å­˜å¯¹è´¦
â”œâ”€â”€ ğŸ“¥ å…¥åº“ç®¡ç†
â”‚   â”œâ”€â”€ å…¥åº“å•ç®¡ç†
â”‚   â”œâ”€â”€ é‡‡è´­å…¥åº“
â”‚   â”œâ”€â”€ é€€è´§å…¥åº“
â”‚   â”œâ”€â”€ è°ƒæ‹¨å…¥åº“
â”‚   â””â”€â”€ æ”¶è´§è®°å½•
â”œâ”€â”€ ğŸ“¤ å‡ºåº“ç®¡ç†
â”‚   â”œâ”€â”€ å‡ºåº“å•ç®¡ç†
â”‚   â”œâ”€â”€ é”€å”®å‡ºåº“
â”‚   â”œâ”€â”€ è°ƒæ‹¨å‡ºåº“
â”‚   â”œâ”€â”€ æŠ¥æŸå‡ºåº“
â”‚   â””â”€â”€ å‘è´§è®°å½•
â”œâ”€â”€ ğŸ¯ æ‹£è´§ç®¡ç†
â”‚   â”œâ”€â”€ æ‹£è´§æ³¢æ¬¡
â”‚   â”œâ”€â”€ æ‹£è´§ä»»åŠ¡
â”‚   â”œâ”€â”€ æ‹£è´§ç»©æ•ˆ
â”‚   â””â”€â”€ è·¯å¾„ä¼˜åŒ–é…ç½®
â”œâ”€â”€ ğŸ” ç›˜ç‚¹ç®¡ç†
â”‚   â”œâ”€â”€ ç›˜ç‚¹è®¡åˆ’
â”‚   â”œâ”€â”€ ç›˜ç‚¹æ‰§è¡Œ
â”‚   â”œâ”€â”€ ç›˜ç‚¹ç»“æœ
â”‚   â””â”€â”€ åº“å­˜è°ƒæ•´
â”œâ”€â”€ ğŸ¢ ä»“åº“ç®¡ç†
â”‚   â”œâ”€â”€ ä»“åº“ä¿¡æ¯
â”‚   â”œâ”€â”€ åº“åŒºç®¡ç†
â”‚   â”œâ”€â”€ åº“ä½ç®¡ç†
â”‚   â””â”€â”€ å®¹é‡è§„åˆ’
â”œâ”€â”€ ğŸ å•†å“ç®¡ç†
â”‚   â”œâ”€â”€ å•†å“æ¡£æ¡ˆ
â”‚   â”œâ”€â”€ å•†å“åˆ†ç±»
â”‚   â”œâ”€â”€ å•†å“å¯¼å…¥
â”‚   â””â”€â”€ å•†å“æ ‡ç­¾æ‰“å°
â”œâ”€â”€ ğŸ”„ ç§»åº“ç®¡ç†
â”‚   â”œâ”€â”€ ç§»åº“å•ç®¡ç†
â”‚   â”œâ”€â”€ åº“ä½è°ƒæ•´
â”‚   â”œâ”€â”€ åº“åŒºè°ƒæ•´
â”‚   â””â”€â”€ ç§»åº“è®°å½•
â”œâ”€â”€ ğŸ‘¥ å¾€æ¥å•ä½
â”‚   â”œâ”€â”€ ä¾›åº”å•†ç®¡ç†
â”‚   â”œâ”€â”€ å®¢æˆ·ç®¡ç†
â”‚   â””â”€â”€ æ‰¿è¿å•†ç®¡ç†
â”œâ”€â”€ ğŸ“ˆ æŠ¥è¡¨ä¸­å¿ƒ
â”‚   â”œâ”€â”€ åº“å­˜æŠ¥è¡¨
â”‚   â”œâ”€â”€ å‡ºå…¥åº“ç»Ÿè®¡
â”‚   â”œâ”€â”€ å‘¨è½¬ç‡åˆ†æ
â”‚   â”œâ”€â”€ åº“é¾„åˆ†æ
â”‚   â”œâ”€â”€ ABCåˆ†ç±»
â”‚   â””â”€â”€ è‡ªå®šä¹‰æŠ¥è¡¨
â”œâ”€â”€ âš™ï¸ ç³»ç»Ÿç®¡ç†
â”‚   â”œâ”€â”€ ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ è§’è‰²ç®¡ç†
â”‚   â”œâ”€â”€ èœå•ç®¡ç†
â”‚   â”œâ”€â”€ éƒ¨é—¨ç®¡ç†
â”‚   â”œâ”€â”€ æ•°æ®å­—å…¸
â”‚   â”œâ”€â”€ ç³»ç»Ÿé…ç½®
â”‚   â””â”€â”€ æ“ä½œæ—¥å¿—
â””â”€â”€ ğŸ“± ç§»åŠ¨ç«¯(PDA)
    â”œâ”€â”€ æ”¶è´§ä¸Šæ¶
    â”œâ”€â”€ æ‹£è´§å‡ºåº“
    â”œâ”€â”€ åº“å­˜ç›˜ç‚¹
    â”œâ”€â”€ åº“å­˜ç§»åŠ¨
    â””â”€â”€ æ ‡ç­¾æ‰“å°
```

### 10.2 æ ¸å¿ƒåŠŸèƒ½é¡µé¢è¯¦ç»†è®¾è®¡

#### 10.2.1 åº“å­˜æŸ¥è¯¢é¡µé¢

**é¡µé¢è·¯å¾„**: `/inventory/list`

**åŠŸèƒ½è¯´æ˜**: æŸ¥è¯¢å’Œç®¡ç†æ‰€æœ‰åº“å­˜ä¿¡æ¯

**æ£€ç´¢æ¡ä»¶**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-------|---------|---------|------|
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | å¦ | æ”¯æŒå¤šé€‰ |
| å•†å“åç§° | æ–‡æœ¬è¾“å…¥ | å¦ | æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ |
| SKUç¼–ç  | æ–‡æœ¬è¾“å…¥ | å¦ | ç²¾ç¡®æŸ¥è¯¢ |
| å•†å“åˆ†ç±» | æ ‘å½¢é€‰æ‹© | å¦ | æ”¯æŒå¤šçº§åˆ†ç±» |
| åº“ä½ç¼–ç  | æ–‡æœ¬è¾“å…¥ | å¦ | æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ |
| æ‰¹æ¬¡å· | æ–‡æœ¬è¾“å…¥ | å¦ | ç²¾ç¡®æŸ¥è¯¢ |
| åº“å­˜çŠ¶æ€ | ä¸‹æ‹‰é€‰æ‹© | å¦ | æ­£å¸¸/å†»ç»“/å¾…æ£€/æŸå |
| åº“å­˜é¢„è­¦ | å¤é€‰æ¡† | å¦ | å‹¾é€‰æ˜¾ç¤ºä½äºå®‰å…¨åº“å­˜çš„å•†å“ |
| åº“é¾„èŒƒå›´ | æ—¥æœŸåŒºé—´ | å¦ | å…¥åº“æ—¥æœŸèŒƒå›´ |

**è¡¨æ ¼åˆ—**:

| åˆ—å | å®½åº¦ | æ˜¯å¦å›ºå®š | æ’åº | è¯´æ˜ |
|-----|------|---------|-----|------|
| åºå· | 60px | å·¦ | - | è‡ªå¢åºå· |
| ä»“åº“åç§° | 120px | - | âœ… | - |
| åº“åŒº | 100px | - | âœ… | - |
| åº“ä½ç¼–ç  | 120px | - | âœ… | å¯ç‚¹å‡»æŸ¥çœ‹åº“ä½è¯¦æƒ… |
| SKUç¼–ç  | 150px | - | âœ… | - |
| å•†å“åç§° | 200px | - | âœ… | æ‚¬æµ®æ˜¾ç¤ºå®Œæ•´åç§° |
| è§„æ ¼å‹å· | 150px | - | - | - |
| æ‰¹æ¬¡å· | 120px | - | - | - |
| æ€»åº“å­˜ | 100px | å³å¯¹é½ | âœ… | ä½äºå®‰å…¨åº“å­˜çº¢è‰²æ˜¾ç¤º |
| é”å®šæ•°é‡ | 100px | å³å¯¹é½ | âœ… | - |
| å¯ç”¨åº“å­˜ | 100px | å³å¯¹é½ | âœ… | Tagæ ‡ç­¾æ ·å¼ |
| è®¡é‡å•ä½ | 80px | - | - | - |
| åº“å­˜çŠ¶æ€ | 80px | - | âœ… | Tagæ ‡ç­¾æ ·å¼ |
| å…¥åº“æ—¥æœŸ | 150px | - | âœ… | - |
| åº“é¾„(å¤©) | 80px | å³å¯¹é½ | âœ… | è¶…è¿‡90å¤©é»„è‰²æç¤º |
| æ“ä½œ | 180px | å³ | - | è¯¦æƒ…/ç§»åº“/å†»ç»“/è°ƒæ•´ |

**æ“ä½œæŒ‰é’®**:

- **è¯¦æƒ…**: æŸ¥çœ‹åº“å­˜è¯¦ç»†ä¿¡æ¯(å«æµæ°´è®°å½•)
- **ç§»åº“**: è·³è½¬åˆ°ç§»åº“å•åˆ›å»ºé¡µé¢,è‡ªåŠ¨å¡«å……å•†å“ä¿¡æ¯
- **å†»ç»“**: å†»ç»“è¯¥åº“å­˜,å¼¹çª—è¾“å…¥å†»ç»“åŸå› 
- **è°ƒæ•´**: æ‰‹åŠ¨è°ƒæ•´åº“å­˜(éœ€æƒé™,è®°å½•æ“ä½œæ—¥å¿—)

**æ‰¹é‡æ“ä½œ**:

- æ‰¹é‡å¯¼å‡º(Excel)
- æ‰¹é‡å†»ç»“
- æ‰¹é‡æ‰“å°æ ‡ç­¾

**ç»Ÿè®¡ä¿¡æ¯**(é¡µé¢é¡¶éƒ¨å¡ç‰‡):

- æ€»åº“å­˜é‡
- å¯ç”¨åº“å­˜é‡
- é”å®šåº“å­˜é‡
- é¢„è­¦å•†å“æ•°

---

#### 10.2.2 å…¥åº“å•ç®¡ç†é¡µé¢

**é¡µé¢è·¯å¾„**: `/inbound/list`

**åŠŸèƒ½è¯´æ˜**: ç®¡ç†æ‰€æœ‰å…¥åº“å•æ®

**æ£€ç´¢æ¡ä»¶**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-------|---------|---------|------|
| å…¥åº“å•å· | æ–‡æœ¬è¾“å…¥ | å¦ | ç²¾ç¡®æŸ¥è¯¢ |
| å…¥åº“ç±»å‹ | ä¸‹æ‹‰é€‰æ‹© | å¦ | é‡‡è´­/é€€è´§/è°ƒæ‹¨/ç›˜ç›ˆ/ç”Ÿäº§/å…¶ä»– |
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | å¦ | - |
| ä¾›åº”å•† | ä¸‹æ‹‰é€‰æ‹© | å¦ | æ”¯æŒæœç´¢ |
| çŠ¶æ€ | ä¸‹æ‹‰é€‰æ‹© | å¦ | å¾…å®¡æ ¸/å¾…å…¥åº“/å…¥åº“ä¸­/å·²å®Œæˆ/å·²å–æ¶ˆ |
| åˆ›å»ºæ—¥æœŸ | æ—¥æœŸåŒºé—´ | å¦ | - |
| å…¥åº“æ—¥æœŸ | æ—¥æœŸåŒºé—´ | å¦ | - |
| åˆ›å»ºäºº | æ–‡æœ¬è¾“å…¥ | å¦ | - |

**è¡¨æ ¼åˆ—**:

| åˆ—å | å®½åº¦ | æ˜¯å¦å›ºå®š | æ’åº | è¯´æ˜ |
|-----|------|---------|-----|------|
| åºå· | 60px | å·¦ | - | - |
| å…¥åº“å•å· | 180px | å·¦ | - | ç‚¹å‡»è·³è½¬è¯¦æƒ…é¡µ |
| å…¥åº“ç±»å‹ | 100px | - | âœ… | Tagæ ‡ç­¾ |
| ä»“åº“åç§° | 120px | - | âœ… | - |
| ä¾›åº”å•† | 150px | - | - | - |
| æ¥æºå•å· | 150px | - | - | é‡‡è´­è®¢å•å·ç­‰ |
| å•†å“ç§ç±» | 80px | å³å¯¹é½ | âœ… | - |
| è®¡åˆ’æ•°é‡ | 100px | å³å¯¹é½ | âœ… | - |
| å®æ”¶æ•°é‡ | 100px | å³å¯¹é½ | âœ… | - |
| çŠ¶æ€ | 90px | - | âœ… | Tagæ ‡ç­¾ |
| åˆ›å»ºäºº | 100px | - | - | - |
| åˆ›å»ºæ—¶é—´ | 150px | - | âœ… | - |
| å®¡æ ¸äºº | 100px | - | - | - |
| å®¡æ ¸æ—¶é—´ | 150px | - | âœ… | - |
| æ“ä½œ | 200px | å³ | - | æŸ¥çœ‹/ç¼–è¾‘/å®¡æ ¸/å¼€å§‹å…¥åº“/å–æ¶ˆ |

**æ“ä½œæŒ‰é’®**:

- **æŸ¥çœ‹**: æŸ¥çœ‹å…¥åº“å•è¯¦æƒ…(åªè¯»)
- **ç¼–è¾‘**: ç¼–è¾‘å…¥åº“å•(ä»…å¾…å®¡æ ¸çŠ¶æ€å¯ç¼–è¾‘)
- **å®¡æ ¸**: å®¡æ ¸å…¥åº“å•(å¼¹çª—,é€šè¿‡/é©³å›)
- **å¼€å§‹å…¥åº“**: è¿›å…¥æ”¶è´§ä¸Šæ¶æµç¨‹
- **æ‰“å°**: æ‰“å°å…¥åº“å•
- **å–æ¶ˆ**: å–æ¶ˆå…¥åº“å•(éœ€è¾“å…¥åŸå› )

**æ–°å¢å…¥åº“å•è¡¨å•**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | æ ¡éªŒè§„åˆ™ |
|-------|---------|---------|---------|
| å…¥åº“ç±»å‹ | å•é€‰ | æ˜¯ | - |
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | æ˜¯ | - |
| ä¾›åº”å•† | ä¸‹æ‹‰é€‰æ‹© | å¦ | é‡‡è´­å…¥åº“æ—¶å¿…å¡« |
| æ¥æºå•å· | æ–‡æœ¬è¾“å…¥ | å¦ | - |
| é¢„è®¡åˆ°è´§æ—¶é—´ | æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ | å¦ | ä¸èƒ½æ—©äºå½“å‰æ—¶é—´ |
| å¤‡æ³¨ | å¤šè¡Œæ–‡æœ¬ | å¦ | æœ€å¤š500å­— |
| **å•†å“æ˜ç»†** | è¡¨æ ¼ç¼–è¾‘ | æ˜¯ | è‡³å°‘ä¸€æ¡æ˜ç»† |

**å•†å“æ˜ç»†è¡¨æ ¼åˆ—**:

| åˆ—å | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-----|---------|---------|------|
| SKUç¼–ç  | æœç´¢é€‰æ‹© | æ˜¯ | æœç´¢å•†å“,è‡ªåŠ¨å¸¦å‡ºå•†å“ä¿¡æ¯ |
| å•†å“åç§° | æ˜¾ç¤º | - | è‡ªåŠ¨å¸¦å‡º |
| è§„æ ¼ | æ˜¾ç¤º | - | è‡ªåŠ¨å¸¦å‡º |
| å•ä½ | æ˜¾ç¤º | - | è‡ªåŠ¨å¸¦å‡º |
| æ‰¹æ¬¡å· | æ–‡æœ¬è¾“å…¥ | å¦ | éœ€æ‰¹æ¬¡ç®¡ç†å•†å“å¿…å¡« |
| ç”Ÿäº§æ—¥æœŸ | æ—¥æœŸé€‰æ‹©å™¨ | å¦ | - |
| è¿‡æœŸæ—¥æœŸ | æ—¥æœŸé€‰æ‹©å™¨ | å¦ | è‡ªåŠ¨æ ¡éªŒæ˜¯å¦è¿‡æœŸ |
| è®¡åˆ’æ•°é‡ | æ•°å­—è¾“å…¥ | æ˜¯ | å¿…é¡»>0 |
| å¤‡æ³¨ | æ–‡æœ¬è¾“å…¥ | å¦ | - |
| æ“ä½œ | æŒ‰é’® | - | åˆ é™¤è¡Œ |

---

#### 10.2.3 å‡ºåº“å•ç®¡ç†é¡µé¢

**é¡µé¢è·¯å¾„**: `/outbound/list`

**åŠŸèƒ½è¯´æ˜**: ç®¡ç†æ‰€æœ‰å‡ºåº“å•æ®

**æ£€ç´¢æ¡ä»¶**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-------|---------|---------|------|
| å‡ºåº“å•å· | æ–‡æœ¬è¾“å…¥ | å¦ | ç²¾ç¡®æŸ¥è¯¢ |
| å‡ºåº“ç±»å‹ | ä¸‹æ‹‰é€‰æ‹© | å¦ | é”€å”®/è°ƒæ‹¨/æŠ¥æŸ/é€€è´§/ç›˜äº/å…¶ä»– |
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | å¦ | - |
| å®¢æˆ· | ä¸‹æ‹‰é€‰æ‹© | å¦ | æ”¯æŒæœç´¢ |
| ä¼˜å…ˆçº§ | ä¸‹æ‹‰é€‰æ‹© | å¦ | æ™®é€š/ç´§æ€¥/ç‰¹æ€¥ |
| çŠ¶æ€ | ä¸‹æ‹‰é€‰æ‹© | å¦ | å¾…å®¡æ ¸/å¾…å‡ºåº“/æ‹£è´§ä¸­/å¾…å¤æ ¸/å¾…å‘è´§/å·²å‘è´§/å·²å–æ¶ˆ |
| åˆ›å»ºæ—¥æœŸ | æ—¥æœŸåŒºé—´ | å¦ | - |
| æœŸæœ›å‘è´§æ—¶é—´ | æ—¥æœŸåŒºé—´ | å¦ | - |

**è¡¨æ ¼åˆ—**:

| åˆ—å | å®½åº¦ | æ˜¯å¦å›ºå®š | æ’åº | è¯´æ˜ |
|-----|------|---------|-----|------|
| åºå· | 60px | å·¦ | - | - |
| å‡ºåº“å•å· | 180px | å·¦ | - | ç‚¹å‡»è·³è½¬è¯¦æƒ…é¡µ |
| å‡ºåº“ç±»å‹ | 100px | - | âœ… | Tagæ ‡ç­¾ |
| ä»“åº“åç§° | 120px | - | âœ… | - |
| å®¢æˆ·åç§° | 150px | - | - | - |
| æ”¶è´§åœ°å€ | 200px | - | - | æ‚¬æµ®æ˜¾ç¤ºå®Œæ•´åœ°å€ |
| å•†å“ç§ç±» | 80px | å³å¯¹é½ | âœ… | - |
| è®¡åˆ’æ•°é‡ | 100px | å³å¯¹é½ | âœ… | - |
| å®å‘æ•°é‡ | 100px | å³å¯¹é½ | âœ… | - |
| ä¼˜å…ˆçº§ | 80px | - | âœ… | Tagæ ‡ç­¾,ç‰¹æ€¥çº¢è‰² |
| çŠ¶æ€ | 90px | - | âœ… | Tagæ ‡ç­¾ |
| æ‰¿è¿å•† | 100px | - | - | - |
| ç‰©æµå•å· | 150px | - | - | ç‚¹å‡»è·³è½¬ç‰©æµè¿½è¸ª |
| æœŸæœ›å‘è´§æ—¶é—´ | 150px | - | âœ… | è¶…æ—¶çº¢è‰²æ ‡æ³¨ |
| åˆ›å»ºæ—¶é—´ | 150px | - | âœ… | - |
| æ“ä½œ | 220px | å³ | - | æŸ¥çœ‹/ç¼–è¾‘/å®¡æ ¸/åˆ›å»ºæ³¢æ¬¡/å‘è´§/å–æ¶ˆ |

**çŠ¶æ€æµè½¬**:

```mermaid
stateDiagram-v2
    [*] --> å¾…å®¡æ ¸
    å¾…å®¡æ ¸ --> å¾…å‡ºåº“: å®¡æ ¸é€šè¿‡
    å¾…å®¡æ ¸ --> å·²å–æ¶ˆ: å®¡æ ¸é©³å›
    å¾…å‡ºåº“ --> æ‹£è´§ä¸­: åˆ›å»ºæ³¢æ¬¡
    æ‹£è´§ä¸­ --> å¾…å¤æ ¸: æ‹£è´§å®Œæˆ
    å¾…å¤æ ¸ --> å¾…å‘è´§: å¤æ ¸é€šè¿‡
    å¾…å¤æ ¸ --> æ‹£è´§ä¸­: å¤æ ¸ä¸é€šè¿‡
    å¾…å‘è´§ --> å·²å‘è´§: ç¡®è®¤å‘è´§
    å·²å‘è´§ --> [*]
    å·²å–æ¶ˆ --> [*]
```

---

#### 10.2.4 æ‹£è´§æ³¢æ¬¡ç®¡ç†é¡µé¢

**é¡µé¢è·¯å¾„**: `/picking/wave/list`

**åŠŸèƒ½è¯´æ˜**: ç®¡ç†æ‹£è´§æ³¢æ¬¡,æ™ºèƒ½ç”Ÿæˆå’Œåˆ†é…æ‹£è´§ä»»åŠ¡

**æ£€ç´¢æ¡ä»¶**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-------|---------|---------|------|
| æ³¢æ¬¡å· | æ–‡æœ¬è¾“å…¥ | å¦ | ç²¾ç¡®æŸ¥è¯¢ |
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | å¦ | - |
| æ³¢æ¬¡ç±»å‹ | ä¸‹æ‹‰é€‰æ‹© | å¦ | æ‰¹æ¬¡æ‹£è´§/åˆ†åŒºæ‹£è´§/å•å“æ‹£è´§ |
| æ‹£è´§å‘˜ | ä¸‹æ‹‰é€‰æ‹© | å¦ | - |
| çŠ¶æ€ | ä¸‹æ‹‰é€‰æ‹© | å¦ | å¾…åˆ†é…/å·²åˆ†é…/æ‹£è´§ä¸­/å·²å®Œæˆ/å·²å–æ¶ˆ |
| åˆ›å»ºæ—¥æœŸ | æ—¥æœŸåŒºé—´ | å¦ | - |

**è¡¨æ ¼åˆ—**:

| åˆ—å | å®½åº¦ | è¯´æ˜ |
|-----|------|------|
| æ³¢æ¬¡å· | 180px | ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… |
| æ³¢æ¬¡ç±»å‹ | 100px | Tagæ ‡ç­¾ |
| è®¢å•æ•°é‡ | 80px | - |
| å•†å“ç§ç±» | 80px | - |
| æ€»æ•°é‡ | 100px | - |
| ä¼˜å…ˆçº§ | 80px | Tagæ ‡ç­¾ |
| æ‹£è´§å‘˜ | 100px | - |
| é¢„è®¡è€—æ—¶ | 100px | åˆ†é’Ÿ |
| å®é™…è€—æ—¶ | 100px | åˆ†é’Ÿ,è¶…æ—¶çº¢è‰² |
| æ‹£è´§è¿›åº¦ | 120px | è¿›åº¦æ¡ |
| çŠ¶æ€ | 90px | Tagæ ‡ç­¾ |
| å¼€å§‹æ—¶é—´ | 150px | - |
| å®Œæˆæ—¶é—´ | 150px | - |
| æ“ä½œ | 180px | æŸ¥çœ‹/åˆ†é…/å¼€å§‹/å–æ¶ˆ |

**æ™ºèƒ½ç”Ÿæˆæ³¢æ¬¡é…ç½®**:

- æ³¢æ¬¡å¤§å°: 30-50å•/æ³¢æ¬¡
- æ—¶é—´çª—å£: 30åˆ†é’Ÿå†…è®¢å•èšåˆ
- èšç±»ç®—æ³•: æŒ‰åº“åŒºå’Œå•†å“ä½ç½®èšç±»
- ä¼˜å…ˆçº§è§„åˆ™: ç‰¹æ€¥è®¢å•ä¼˜å…ˆå¤„ç†

**æ³¢æ¬¡è¯¦æƒ…é¡µ**åŒ…å«:

1. æ³¢æ¬¡åŸºæœ¬ä¿¡æ¯
2. åŒ…å«çš„å‡ºåº“å•åˆ—è¡¨
3. æ‹£è´§è·¯å¾„å¯è§†åŒ–(åº“ä½åœ°å›¾)
4. æ‹£è´§ä»»åŠ¡æ˜ç»†
5. æ‹£è´§è¿›åº¦å®æ—¶ç›‘æ§

---

#### 10.2.5 ç›˜ç‚¹è®¡åˆ’ç®¡ç†é¡µé¢

**é¡µé¢è·¯å¾„**: `/stock-taking/plan/list`

**åŠŸèƒ½è¯´æ˜**: åˆ›å»ºå’Œç®¡ç†ç›˜ç‚¹è®¡åˆ’

**æ£€ç´¢æ¡ä»¶**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-------|---------|---------|------|
| è®¡åˆ’ç¼–å· | æ–‡æœ¬è¾“å…¥ | å¦ | - |
| è®¡åˆ’åç§° | æ–‡æœ¬è¾“å…¥ | å¦ | æ¨¡ç³ŠæŸ¥è¯¢ |
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | å¦ | - |
| ç›˜ç‚¹ç±»å‹ | ä¸‹æ‹‰é€‰æ‹© | å¦ | å…¨ç›˜/å¾ªç¯ç›˜/æŠ½ç›˜/åŠ¨æ€ç›˜ |
| çŠ¶æ€ | ä¸‹æ‹‰é€‰æ‹© | å¦ | å¾…å®¡æ ¸/å¾…æ‰§è¡Œ/æ‰§è¡Œä¸­/å·²å®Œæˆ/å·²å–æ¶ˆ |
| è®¡åˆ’æ—¶é—´ | æ—¥æœŸåŒºé—´ | å¦ | - |

**æ–°å¢ç›˜ç‚¹è®¡åˆ’è¡¨å•**:

| å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | è¯´æ˜ |
|-------|---------|---------|------|
| è®¡åˆ’åç§° | æ–‡æœ¬è¾“å…¥ | æ˜¯ | å¦‚:"2025å¹´ç¬¬ä¸€å­£åº¦å…¨ç›˜" |
| ä»“åº“ | ä¸‹æ‹‰é€‰æ‹© | æ˜¯ | - |
| ç›˜ç‚¹ç±»å‹ | å•é€‰ | æ˜¯ | å…¨ç›˜/å¾ªç¯ç›˜/æŠ½ç›˜/åŠ¨æ€ç›˜ |
| ç›˜ç‚¹èŒƒå›´ | åŠ¨æ€è¡¨å• | æ˜¯ | æ ¹æ®ç›˜ç‚¹ç±»å‹æ˜¾ç¤ºä¸åŒé…ç½® |
| è®¡åˆ’å¼€å§‹æ—¶é—´ | æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ | æ˜¯ | - |
| è®¡åˆ’ç»“æŸæ—¶é—´ | æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ | æ˜¯ | å¿…é¡»æ™šäºå¼€å§‹æ—¶é—´ |
| ç›˜ç‚¹äººå‘˜ | å¤šé€‰ | æ˜¯ | é€‰æ‹©å‚ä¸ç›˜ç‚¹çš„äººå‘˜ |
| å¤‡æ³¨ | å¤šè¡Œæ–‡æœ¬ | å¦ | - |

**ç›˜ç‚¹èŒƒå›´é…ç½®**:

- **å…¨ç›˜**: è‡ªåŠ¨åŒ…å«ä»“åº“å†…æ‰€æœ‰å•†å“
- **å¾ªç¯ç›˜**: é€‰æ‹©å•†å“åˆ†ç±»æˆ–ABCåˆ†ç±»
- **æŠ½ç›˜**: è¾“å…¥æŠ½æ ·æ¯”ä¾‹(å¦‚10%)å’Œéšæœºç§å­
- **åŠ¨æ€ç›˜**: é€‰æ‹©é›¶åº“å­˜æˆ–æŒ‡å®šå•†å“

**ç›˜ç‚¹æ‰§è¡Œæµç¨‹**:

1. å®¡æ ¸é€šè¿‡åç”Ÿæˆç›˜ç‚¹å•
2. ç›˜ç‚¹äººå‘˜PDAæ‰«æç›˜ç‚¹
3. æäº¤ç›˜ç‚¹ç»“æœ
4. å¤æ ¸å·®å¼‚æ•°æ®
5. ç”Ÿæˆç›˜ç›ˆç›˜äºå•
6. è°ƒæ•´åº“å­˜

---

### 10.3 ç§»åŠ¨ç«¯(PDA)åŠŸèƒ½è®¾è®¡

#### 10.3.1 æ”¶è´§ä¸Šæ¶

**æµç¨‹æ­¥éª¤**:

1. æ‰«æå…¥åº“å•å· â†’ æ˜¾ç¤ºå•†å“æ˜ç»†
2. é€ä¸ªæ‰«æå•†å“æ¡ç  â†’ è¾“å…¥å®æ”¶æ•°é‡
3. æ‰«æç›®æ ‡åº“ä½ â†’ ç¡®è®¤ä¸Šæ¶
4. æ‰“å°åº“ä½æ ‡ç­¾
5. å®Œæˆå…¥åº“

**é¡µé¢å…ƒç´ **:

- å¤§å·è¾“å…¥æ¡†(æ”¯æŒæ‰«ç æª)
- å•†å“å›¾ç‰‡æ˜¾ç¤º
- æ•°é‡è°ƒæ•´æŒ‰é’®(+/-)
- å¼‚å¸¸ä¸ŠæŠ¥æŒ‰é’®

#### 10.3.2 æ‹£è´§å‡ºåº“

**æµç¨‹æ­¥éª¤**:

1. ç™»å½• â†’ æŸ¥çœ‹å¾…æ‹£è´§ä»»åŠ¡åˆ—è¡¨
2. é€‰æ‹©ä»»åŠ¡ â†’ æ˜¾ç¤ºä¼˜åŒ–åçš„æ‹£è´§è·¯å¾„
3. æŒ‰é¡ºåºåˆ°è¾¾åº“ä½ â†’ æ‰«æåº“ä½ç 
4. æ‰«æå•†å“æ¡ç  â†’ è¾“å…¥æ‹£è´§æ•°é‡
5. æ‰«æé›†è´§å®¹å™¨ â†’ å®Œæˆæ‹£è´§
6. æäº¤å¤æ ¸

**ç‰¹è‰²åŠŸèƒ½**:

- è·¯å¾„å¯¼èˆª(ARç®­å¤´æŒ‡å¼•)
- è¯­éŸ³æ’­æŠ¥åº“ä½å’Œæ•°é‡
- æ‹£è´§è¿›åº¦å®æ—¶åŒæ­¥
- å¼‚å¸¸ä¸€é”®ä¸ŠæŠ¥

#### 10.3.3 åº“å­˜ç›˜ç‚¹

**æµç¨‹æ­¥éª¤**:

1. æ‰«æç›˜ç‚¹å•å· â†’ æ˜¾ç¤ºå¾…ç›˜ç‚¹åº“ä½åˆ—è¡¨
2. åˆ°è¾¾åº“ä½ â†’ æ‰«æåº“ä½ç 
3. é€ä¸ªæ‰«æå•†å“æ¡ç  â†’ è¾“å…¥å®ç›˜æ•°é‡
4. å¯¹æ¯”è´¦é¢æ•°é‡ â†’ æ ‡è®°å·®å¼‚
5. æ‹ç…§ä¸Šä¼ (å¼‚å¸¸æƒ…å†µ)
6. æäº¤ç›˜ç‚¹ç»“æœ

**æ™ºèƒ½æç¤º**:

- è´¦é¢æ•°é‡å®æ—¶å¯¹æ¯”
- å·®å¼‚è‡ªåŠ¨æ ‡çº¢
- é—æ¼æç¤º
- ç›˜ç‚¹è¿›åº¦æ˜¾ç¤º

---

## åä¸€ã€æ•°æ®åº“è®¾è®¡è¡¥å……(å…³è”å…³ç³»å›¾)

### 11.1 å®Œæ•´ERå›¾

```mermaid
erDiagram
    %% æ ¸å¿ƒå®ä½“å…³ç³»
    WAREHOUSE ||--o{ WAREHOUSE_AREA : "åŒ…å«"
    WAREHOUSE_AREA ||--o{ WAREHOUSE_LOCATION : "åŒ…å«"
    WAREHOUSE_LOCATION ||--o{ INVENTORY : "å­˜å‚¨"
    
    GOODS_CATEGORY ||--o{ GOODS : "åˆ†ç±»"
    GOODS ||--o{ INVENTORY : "åº“å­˜"
    GOODS ||--o{ INBOUND_DETAIL : "å…¥åº“æ˜ç»†"
    GOODS ||--o{ OUTBOUND_DETAIL : "å‡ºåº“æ˜ç»†"
    
    SUPPLIER ||--o{ INBOUND_ORDER : "ä¾›åº”"
    CUSTOMER ||--o{ OUTBOUND_ORDER : "è®¢è´­"
    
    WAREHOUSE ||--o{ INBOUND_ORDER : "å…¥åº“"
    WAREHOUSE ||--o{ OUTBOUND_ORDER : "å‡ºåº“"
    INBOUND_ORDER ||--o{ INBOUND_DETAIL : "æ˜ç»†"
    OUTBOUND_ORDER ||--o{ OUTBOUND_DETAIL : "æ˜ç»†"
    
    OUTBOUND_ORDER ||--o{ PICKING_WAVE_ORDER : "ç”Ÿæˆæ³¢æ¬¡"
    PICKING_WAVE ||--o{ PICKING_WAVE_ORDER : "å…³è”"
    PICKING_WAVE ||--o{ PICKING_TASK : "åŒ…å«ä»»åŠ¡"
    OUTBOUND_ORDER ||--o{ PICKING_TASK : "æ‹£è´§ä»»åŠ¡"
    
    WAREHOUSE ||--o{ STOCK_TAKING_PLAN : "ç›˜ç‚¹è®¡åˆ’"
    STOCK_TAKING_PLAN ||--o{ STOCK_TAKING : "ç›˜ç‚¹å•"
    
    WAREHOUSE ||--o{ STOCK_MOVE : "ç§»åº“"
    GOODS ||--o{ STOCK_MOVE : "ç§»åº“å•†å“"
    
    SYS_USER ||--o{ SYS_USER_ROLE : "ç”¨æˆ·è§’è‰²"
    SYS_ROLE ||--o{ SYS_USER_ROLE : "è§’è‰²ç”¨æˆ·"
    SYS_ROLE ||--o{ SYS_ROLE_MENU : "è§’è‰²èœå•"
    SYS_MENU ||--o{ SYS_ROLE_MENU : "èœå•è§’è‰²"
```

### 11.2 æ ¸å¿ƒè¡¨å…³è”å…³ç³»è¯´æ˜

| ä¸»è¡¨ | ä»è¡¨ | å…³è”å­—æ®µ | å…³ç³»ç±»å‹ | çº¦æŸ |
|-----|------|---------|---------|------|
| warehouse | warehouse_area | warehouse_id | 1:N | CASCADE |
| warehouse_area | warehouse_location | area_id | 1:N | CASCADE |
| warehouse_location | inventory | location_id | 1:N | RESTRICT |
| goods | inventory | goods_id | 1:N | RESTRICT |
| goods_category | goods | category_id | 1:N | SET NULL |
| supplier | inbound_order | supplier_id | 1:N | SET NULL |
| customer | outbound_order | customer_code | 1:N | SET NULL |
| inbound_order | inbound_detail | inbound_id | 1:N | CASCADE |
| outbound_order | outbound_detail | outbound_id | 1:N | CASCADE |
| picking_wave | picking_wave_order | wave_id | 1:N | CASCADE |
| picking_wave | picking_task | wave_id | 1:N | CASCADE |
| stock_taking_plan | stock_taking | plan_id | 1:N | CASCADE |

**çº¦æŸè¯´æ˜**:

- **CASCADE**: ä¸»è¡¨è®°å½•åˆ é™¤æ—¶,ä»è¡¨è®°å½•åŒæ­¥åˆ é™¤
- **RESTRICT**: å­˜åœ¨ä»è¡¨è®°å½•æ—¶,ä¸»è¡¨è®°å½•ä¸å¯åˆ é™¤
- **SET NULL**: ä¸»è¡¨è®°å½•åˆ é™¤æ—¶,ä»è¡¨å¤–é”®å­—æ®µè®¾ä¸ºNULL

---

## åäºŒã€åˆå§‹åŒ–æ•°æ®SQL

### 12.1 æ•°æ®å­—å…¸åˆå§‹åŒ–

```sql
-- æ¸…ç©ºå­—å…¸è¡¨
TRUNCATE TABLE sys_dict;

-- å…¥åº“ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('inbound_type', 'å…¥åº“ç±»å‹', 'PURCHASE', 'é‡‡è´­å…¥åº“', 1, 'success', 1),
('inbound_type', 'å…¥åº“ç±»å‹', 'RETURN', 'é€€è´§å…¥åº“', 2, 'warning', 1),
('inbound_type', 'å…¥åº“ç±»å‹', 'TRANSFER', 'è°ƒæ‹¨å…¥åº“', 3, 'info', 1),
('inbound_type', 'å…¥åº“ç±»å‹', 'PROFIT', 'ç›˜ç›ˆå…¥åº“', 4, 'success', 1),
('inbound_type', 'å…¥åº“ç±»å‹', 'PRODUCTION', 'ç”Ÿäº§å…¥åº“', 5, 'primary', 1),
('inbound_type', 'å…¥åº“ç±»å‹', 'OTHER', 'å…¶ä»–å…¥åº“', 6, 'default', 1);

-- å‡ºåº“ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('outbound_type', 'å‡ºåº“ç±»å‹', 'SALE', 'é”€å”®å‡ºåº“', 1, 'success', 1),
('outbound_type', 'å‡ºåº“ç±»å‹', 'TRANSFER', 'è°ƒæ‹¨å‡ºåº“', 2, 'info', 1),
('outbound_type', 'å‡ºåº“ç±»å‹', 'SCRAP', 'æŠ¥æŸå‡ºåº“', 3, 'danger', 1),
('outbound_type', 'å‡ºåº“ç±»å‹', 'RETURN', 'é€€è´§å‡ºåº“', 4, 'warning', 1),
('outbound_type', 'å‡ºåº“ç±»å‹', 'LOSS', 'ç›˜äºå‡ºåº“', 5, 'danger', 1),
('outbound_type', 'å‡ºåº“ç±»å‹', 'OTHER', 'å…¶ä»–å‡ºåº“', 6, 'default', 1);

-- å…¥åº“å•çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('inbound_status', 'å…¥åº“å•çŠ¶æ€', '1', 'å¾…å®¡æ ¸', 1, 'info', 1),
('inbound_status', 'å…¥åº“å•çŠ¶æ€', '2', 'å¾…å…¥åº“', 2, 'warning', 1),
('inbound_status', 'å…¥åº“å•çŠ¶æ€', '3', 'å…¥åº“ä¸­', 3, 'primary', 1),
('inbound_status', 'å…¥åº“å•çŠ¶æ€', '4', 'å·²å®Œæˆ', 4, 'success', 1),
('inbound_status', 'å…¥åº“å•çŠ¶æ€', '5', 'å·²å–æ¶ˆ', 5, 'danger', 1);

-- å‡ºåº“å•çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '1', 'å¾…å®¡æ ¸', 1, 'info', 1),
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '2', 'å¾…å‡ºåº“', 2, 'warning', 1),
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '3', 'æ‹£è´§ä¸­', 3, 'primary', 1),
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '4', 'å¾…å¤æ ¸', 4, 'primary', 1),
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '5', 'å¾…å‘è´§', 5, 'warning', 1),
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '6', 'å·²å‘è´§', 6, 'success', 1),
('outbound_status', 'å‡ºåº“å•çŠ¶æ€', '7', 'å·²å–æ¶ˆ', 7, 'danger', 1);

-- åº“å­˜çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('inventory_status', 'åº“å­˜çŠ¶æ€', '1', 'æ­£å¸¸', 1, 'success', 1),
('inventory_status', 'åº“å­˜çŠ¶æ€', '2', 'å†»ç»“', 2, 'danger', 1),
('inventory_status', 'åº“å­˜çŠ¶æ€', '3', 'å¾…æ£€', 3, 'warning', 1),
('inventory_status', 'åº“å­˜çŠ¶æ€', '4', 'æŸå', 4, 'info', 1);

-- ä¼˜å…ˆçº§å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('priority', 'ä¼˜å…ˆçº§', '1', 'æ™®é€š', 1, 'default', 1),
('priority', 'ä¼˜å…ˆçº§', '2', 'ç´§æ€¥', 2, 'warning', 1),
('priority', 'ä¼˜å…ˆçº§', '3', 'ç‰¹æ€¥', 3, 'danger', 1);

-- è®¡é‡å•ä½å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('unit', 'è®¡é‡å•ä½', 'PCS', 'ä¸ª/ä»¶', 1, 1),
('unit', 'è®¡é‡å•ä½', 'BOX', 'ç®±', 2, 1),
('unit', 'è®¡é‡å•ä½', 'CTN', 'çº¸ç®±', 3, 1),
('unit', 'è®¡é‡å•ä½', 'PLT', 'æ‰˜ç›˜', 4, 1),
('unit', 'è®¡é‡å•ä½', 'KG', 'åƒå…‹', 5, 1),
('unit', 'è®¡é‡å•ä½', 'METER', 'ç±³', 6, 1),
('unit', 'è®¡é‡å•ä½', 'LITER', 'å‡', 7, 1);

-- ä»“åº“ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('warehouse_type', 'ä»“åº“ç±»å‹', '1', 'æˆå“ä»“', 1, 1),
('warehouse_type', 'ä»“åº“ç±»å‹', '2', 'åŸæ–™ä»“', 2, 1),
('warehouse_type', 'ä»“åº“ç±»å‹', '3', 'åŠæˆå“ä»“', 3, 1);

-- åº“åŒºç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('warehouse_area_type', 'åº“åŒºç±»å‹', 'STORAGE', 'å­˜å‚¨åŒº', 1, 1),
('warehouse_area_type', 'åº“åŒºç±»å‹', 'PICKING', 'æ‹£è´§åŒº', 2, 1),
('warehouse_area_type', 'åº“åŒºç±»å‹', 'STAGING', 'æš‚å­˜åŒº', 3, 1),
('warehouse_area_type', 'åº“åŒºç±»å‹', 'RECEIVING', 'æ”¶è´§åŒº', 4, 1),
('warehouse_area_type', 'åº“åŒºç±»å‹', 'SHIPPING', 'å‘è´§åŒº', 5, 1);

-- åº“ä½ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('location_type', 'åº“ä½ç±»å‹', 'NORMAL', 'æ™®é€šåº“ä½', 1, 1),
('location_type', 'åº“ä½ç±»å‹', 'TEMP', 'ä¸´æ—¶åº“ä½', 2, 1),
('location_type', 'åº“ä½ç±»å‹', 'DEFECT', 'æ®‹æ¬¡å“åº“ä½', 3, 1),
('location_type', 'åº“ä½ç±»å‹', 'FROZEN', 'å†·å†»åº“ä½', 4, 1);

-- åº“ä½çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('location_status', 'åº“ä½çŠ¶æ€', '1', 'ç©ºé—²', 1, 'success', 1),
('location_status', 'åº“ä½çŠ¶æ€', '2', 'å ç”¨', 2, 'warning', 1),
('location_status', 'åº“ä½çŠ¶æ€', '3', 'é”å®š', 3, 'danger', 1),
('location_status', 'åº“ä½çŠ¶æ€', '0', 'ç¦ç”¨', 4, 'info', 1);

-- æ³¢æ¬¡ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('wave_type', 'æ³¢æ¬¡ç±»å‹', 'BATCH', 'æ‰¹æ¬¡æ‹£è´§', 1, 1),
('wave_type', 'æ³¢æ¬¡ç±»å‹', 'ZONE', 'åˆ†åŒºæ‹£è´§', 2, 1),
('wave_type', 'æ³¢æ¬¡ç±»å‹', 'SINGLE', 'å•å“æ‹£è´§', 3, 1);

-- æ³¢æ¬¡çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('wave_status', 'æ³¢æ¬¡çŠ¶æ€', '1', 'å¾…åˆ†é…', 1, 'info', 1),
('wave_status', 'æ³¢æ¬¡çŠ¶æ€', '2', 'å·²åˆ†é…', 2, 'warning', 1),
('wave_status', 'æ³¢æ¬¡çŠ¶æ€', '3', 'æ‹£è´§ä¸­', 3, 'primary', 1),
('wave_status', 'æ³¢æ¬¡çŠ¶æ€', '4', 'å·²å®Œæˆ', 4, 'success', 1),
('wave_status', 'æ³¢æ¬¡çŠ¶æ€', '5', 'å·²å–æ¶ˆ', 5, 'danger', 1);

-- ç›˜ç‚¹è®¡åˆ’çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('stock_taking_plan_status', 'ç›˜ç‚¹è®¡åˆ’çŠ¶æ€', '1', 'å¾…å®¡æ ¸', 1, 'info', 1),
('stock_taking_plan_status', 'ç›˜ç‚¹è®¡åˆ’çŠ¶æ€', '2', 'å¾…æ‰§è¡Œ', 2, 'warning', 1),
('stock_taking_plan_status', 'ç›˜ç‚¹è®¡åˆ’çŠ¶æ€', '3', 'æ‰§è¡Œä¸­', 3, 'primary', 1),
('stock_taking_plan_status', 'ç›˜ç‚¹è®¡åˆ’çŠ¶æ€', '4', 'å·²å®Œæˆ', 4, 'success', 1),
('stock_taking_plan_status', 'ç›˜ç‚¹è®¡åˆ’çŠ¶æ€', '5', 'å·²å–æ¶ˆ', 5, 'danger', 1);

-- ç›˜ç‚¹ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('stock_taking_type', 'ç›˜ç‚¹ç±»å‹', 'FULL', 'å…¨ç›˜', 1, 1),
('stock_taking_type', 'ç›˜ç‚¹ç±»å‹', 'CYCLE', 'å¾ªç¯ç›˜', 2, 1),
('stock_taking_type', 'ç›˜ç‚¹ç±»å‹', 'SPOT', 'æŠ½ç›˜', 3, 1),
('stock_taking_type', 'ç›˜ç‚¹ç±»å‹', 'DYNAMIC', 'åŠ¨æ€ç›˜', 4, 1);

-- ç›˜ç‚¹å•çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('stock_taking_status', 'ç›˜ç‚¹å•çŠ¶æ€', '1', 'å¾…ç›˜ç‚¹', 1, 'info', 1),
('stock_taking_status', 'ç›˜ç‚¹å•çŠ¶æ€', '2', 'å·²ç›˜ç‚¹', 2, 'warning', 1),
('stock_taking_status', 'ç›˜ç‚¹å•çŠ¶æ€', '3', 'å·²å¤æ ¸', 3, 'primary', 1),
('stock_taking_status', 'ç›˜ç‚¹å•çŠ¶æ€', '4', 'å·²è°ƒæ•´', 4, 'success', 1);

-- ç§»åº“ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('stock_move_type', 'ç§»åº“ç±»å‹', 'LOCATION', 'åº“ä½è°ƒæ•´', 1, 1),
('stock_move_type', 'ç§»åº“ç±»å‹', 'AREA', 'åº“åŒºè°ƒæ•´', 2, 1),
('stock_move_type', 'ç§»åº“ç±»å‹', 'WAREHOUSE', 'ä»“åº“è°ƒæ‹¨', 3, 1);

-- ç§»åº“å•çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('stock_move_status', 'ç§»åº“å•çŠ¶æ€', '1', 'å¾…æ‰§è¡Œ', 1, 'info', 1),
('stock_move_status', 'ç§»åº“å•çŠ¶æ€', '2', 'æ‰§è¡Œä¸­', 2, 'primary', 1),
('stock_move_status', 'ç§»åº“å•çŠ¶æ€', '3', 'å·²å®Œæˆ', 3, 'success', 1),
('stock_move_status', 'ç§»åº“å•çŠ¶æ€', '4', 'å·²å–æ¶ˆ', 4, 'danger', 1);

-- ä¾›åº”å•†ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('supplier_type', 'ä¾›åº”å•†ç±»å‹', 'NORMAL', 'æ™®é€šä¾›åº”å•†', 1, 1),
('supplier_type', 'ä¾›åº”å•†ç±»å‹', 'VIP', 'VIPä¾›åº”å•†', 2, 1),
('supplier_type', 'ä¾›åº”å•†ç±»å‹', 'STRATEGIC', 'æˆ˜ç•¥ä¾›åº”å•†', 3, 1);

-- å®¢æˆ·ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('customer_type', 'å®¢æˆ·ç±»å‹', 'RETAIL', 'é›¶å”®å®¢æˆ·', 1, 1),
('customer_type', 'å®¢æˆ·ç±»å‹', 'WHOLESALE', 'æ‰¹å‘å®¢æˆ·', 2, 1),
('customer_type', 'å®¢æˆ·ç±»å‹', 'ENTERPRISE', 'ä¼ä¸šå®¢æˆ·', 3, 1);

-- å®¢æˆ·ç­‰çº§å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('customer_level', 'å®¢æˆ·ç­‰çº§', 'VIP', 'VIPå®¢æˆ·', 1, 1),
('customer_level', 'å®¢æˆ·ç­‰çº§', 'GOLD', 'é‡‘ç‰Œå®¢æˆ·', 2, 1),
('customer_level', 'å®¢æˆ·ç­‰çº§', 'SILVER', 'é“¶ç‰Œå®¢æˆ·', 3, 1),
('customer_level', 'å®¢æˆ·ç­‰çº§', 'NORMAL', 'æ™®é€šå®¢æˆ·', 4, 1);

-- æ‰¿è¿å•†ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('carrier_type', 'æ‰¿è¿å•†ç±»å‹', 'EXPRESS', 'å¿«é€’', 1, 1),
('carrier_type', 'æ‰¿è¿å•†ç±»å‹', 'LOGISTICS', 'ç‰©æµ', 2, 1),
('carrier_type', 'æ‰¿è¿å•†ç±»å‹', 'SPECIAL', 'ä¸“çº¿', 3, 1);

-- å…¥åº“å•æ˜ç»†çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('inbound_detail_status', 'å…¥åº“å•æ˜ç»†çŠ¶æ€', '1', 'å¾…æ”¶è´§', 1, 'info', 1),
('inbound_detail_status', 'å…¥åº“å•æ˜ç»†çŠ¶æ€', '2', 'å·²æ”¶è´§', 2, 'warning', 1),
('inbound_detail_status', 'å…¥åº“å•æ˜ç»†çŠ¶æ€', '3', 'å·²ä¸Šæ¶', 3, 'success', 1);

-- å‡ºåº“å•æ˜ç»†çŠ¶æ€å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, css_class, status) VALUES
('outbound_detail_status', 'å‡ºåº“å•æ˜ç»†çŠ¶æ€', '1', 'å¾…æ‹£è´§', 1, 'info', 1),
('outbound_detail_status', 'å‡ºåº“å•æ˜ç»†çŠ¶æ€', '2', 'æ‹£è´§ä¸­', 2, 'primary', 1),
('outbound_detail_status', 'å‡ºåº“å•æ˜ç»†çŠ¶æ€', '3', 'å·²æ‹£è´§', 3, 'warning', 1),
('outbound_detail_status', 'å‡ºåº“å•æ˜ç»†çŠ¶æ€', '4', 'å·²å¤æ ¸', 4, 'warning', 1),
('outbound_detail_status', 'å‡ºåº“å•æ˜ç»†çŠ¶æ€', '5', 'å·²å‘è´§', 5, 'success', 1);

-- å¼‚å¸¸ç±»å‹å­—å…¸
INSERT INTO sys_dict (dict_code, dict_name, dict_value, dict_label, sort_order, status) VALUES
('exception_type', 'å¼‚å¸¸ç±»å‹', 'EMPTY', 'åº“ä½ç©ºç¼º', 1, 1),
('exception_type', 'å¼‚å¸¸ç±»å‹', 'SHORT', 'åº“å­˜ä¸è¶³', 2, 1),
('exception_type', 'å¼‚å¸¸ç±»å‹', 'DAMAGED', 'å•†å“æŸå', 3, 1),
('exception_type', 'å¼‚å¸¸ç±»å‹', 'EXPIRED', 'å•†å“è¿‡æœŸ', 4, 1),
('exception_type', 'å¼‚å¸¸ç±»å‹', 'WRONG', 'æ‹£é”™å•†å“', 5, 1);
```

### 12.2 ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–

```sql
-- æ’å…¥æµ‹è¯•ä»“åº“
INSERT INTO warehouse (warehouse_code, warehouse_name, warehouse_type, province, city, district, address, contact_person, contact_phone, total_area, status) VALUES
('WH001', 'åŒ—äº¬æ€»ä»“', 1, 'åŒ—äº¬å¸‚', 'æœé˜³åŒº', 'æœ›äº¬è¡—é“', 'æœ›äº¬SOHO T1åº§', 'å¼ ä¸‰', '13800138000', 50000.00, 1),
('WH002', 'ä¸Šæµ·åˆ†ä»“', 1, 'ä¸Šæµ·å¸‚', 'æµ¦ä¸œæ–°åŒº', 'å¼ æ±Ÿ', 'å¼ æ±Ÿé«˜ç§‘æŠ€å›­åŒº', 'æå››', '13900139000', 30000.00, 1);

-- æ’å…¥åº“åŒº
INSERT INTO warehouse_area (warehouse_id, area_code, area_name, area_type, floor, area_size, status) VALUES
(1, 'A01', 'AåŒºå­˜å‚¨åŒº', 'STORAGE', 1, 10000.00, 1),
(1, 'B01', 'BåŒºæ‹£è´§åŒº', 'PICKING', 1, 8000.00, 1),
(1, 'C01', 'CåŒºæš‚å­˜åŒº', 'STAGING', 1, 5000.00, 1);

-- æ’å…¥ç¤ºä¾‹åº“ä½
INSERT INTO warehouse_location (warehouse_id, area_id, location_code, location_type, row_no, column_no, layer_no, capacity, max_weight, status) VALUES
(1, 1, 'A01-01-01-01', 'NORMAL', 1, 1, 1, 1000.00, 500.00, 1),
(1, 1, 'A01-01-01-02', 'NORMAL', 1, 1, 2, 1000.00, 500.00, 1),
(1, 1, 'A01-01-02-01', 'NORMAL', 1, 2, 1, 1000.00, 500.00, 1);

-- æ’å…¥å•†å“åˆ†ç±»
INSERT INTO goods_category (category_code, category_name, parent_id, level, sort_order) VALUES
('ELEC', 'ç”µå­äº§å“', 0, 1, 1),
('DAILY', 'æ—¥ç”¨å“', 0, 1, 2),
('FOOD', 'é£Ÿå“', 0, 1, 3);

-- æ’å…¥ç¤ºä¾‹å•†å“
INSERT INTO goods (sku_code, goods_name, category_id, brand, unit, weight, need_batch, safety_stock, status) VALUES
('SKU001', 'iPhone 15 Pro Max 256GB é»‘è‰²', 1, 'Apple', 'PCS', 0.240, 1, 10, 1),
('SKU002', 'å°ç±³13 Ultra 16GB+1TB é»‘è‰²', 1, 'å°ç±³', 'PCS', 0.227, 1, 20, 1),
('SKU003', 'å¾—åŠ›(Deli)ç­¾å­—ç¬” 0.5mm é»‘è‰²', 2, 'å¾—åŠ›', 'BOX', 0.200, 0, 50, 1);

-- æ’å…¥ä¾›åº”å•†
INSERT INTO supplier (supplier_code, supplier_name, supplier_type, contact_person, contact_phone, province, city, address, credit_level, status) VALUES
('SUP001', 'è‹¹æœå®˜æ–¹ä¾›åº”å•†', 'VIP', 'ç‹äº”', '13700137000', 'åŒ—äº¬å¸‚', 'æµ·æ·€åŒº', 'ä¸­å…³æ‘è½¯ä»¶å›­', 'A', 1),
('SUP002', 'å°ç±³å®˜æ–¹ä¾›åº”å•†', 'VIP', 'èµµå…­', '13600136000', 'åŒ—äº¬å¸‚', 'æµ·æ·€åŒº', 'å°ç±³ç§‘æŠ€å›­', 'A', 1);

-- æ’å…¥å®¢æˆ·
INSERT INTO customer (customer_code, customer_name, customer_type, customer_level, contact_person, contact_phone, delivery_city, delivery_address, credit_limit, status) VALUES
('CUS001', 'äº¬ä¸œå•†åŸ', 'WHOLESALE', 'VIP', 'åˆ˜ä¸ƒ', '13500135000', 'åŒ—äº¬å¸‚', 'åŒ—äº¬å¸‚æœé˜³åŒºäº¬ä¸œæ€»éƒ¨', 1000000.00, 1),
('CUS002', 'å¤©çŒ«æ——èˆ°åº—', 'WHOLESALE', 'VIP', 'é™ˆå…«', '13400134000', 'æ­å·å¸‚', 'æµ™æ±Ÿçœæ­å·å¸‚æ»¨æ±ŸåŒºé˜¿é‡Œå·´å·´', 1000000.00, 1);
```

---

## åä¸‰ã€ä¸šåŠ¡æµç¨‹è¡¥å……

### 13.1 å®Œæ•´å…¥åº“ä¸šåŠ¡æµç¨‹

```mermaid
flowchart TD
    Start([é‡‡è´­è®¢å•ç”Ÿæˆ]) --> CreateInbound[åˆ›å»ºå…¥åº“å•]
    CreateInbound --> InputDetails[å½•å…¥å•†å“æ˜ç»†]
    InputDetails --> Submit[æäº¤å®¡æ ¸]
    
    Submit --> Audit{å®¡æ ¸}
    Audit -->|é©³å›| Modify[ä¿®æ”¹å…¥åº“å•]
    Modify --> Submit
    Audit -->|é€šè¿‡| WaitArrival[ç­‰å¾…åˆ°è´§]
    
    WaitArrival --> Arrival[è´§ç‰©åˆ°è¾¾]
    Arrival --> StartReceive[å¼€å§‹æ”¶è´§]
    StartReceive --> ScanGoods[æ‰«æå•†å“æ¡ç ]
    ScanGoods --> CheckQuality{è´¨æ£€}
    
    CheckQuality -->|ä¸åˆæ ¼| Reject[æ‹’æ”¶/é€€è´§]
    CheckQuality -->|åˆæ ¼| InputQty[å½•å…¥å®æ”¶æ•°é‡]
    InputQty --> AllocateLocation[åˆ†é…ä¸Šæ¶åº“ä½]
    AllocateLocation --> PutAway[ä¸Šæ¶]
    PutAway --> PrintLabel[æ‰“å°åº“ä½æ ‡ç­¾]
    PrintLabel --> UpdateInventory[æ›´æ–°åº“å­˜]
    
    UpdateInventory --> CheckComplete{æ˜ç»†æ˜¯å¦å…¨éƒ¨å®Œæˆ}
    CheckComplete -->|å¦| ScanGoods
    CheckComplete -->|æ˜¯| Complete[å…¥åº“å®Œæˆ]
    
    Complete --> GenerateLog[ç”Ÿæˆåº“å­˜æµæ°´]
    GenerateLog --> NotifyFinance[é€šçŸ¥è´¢åŠ¡]
    NotifyFinance --> End([ç»“æŸ])
    
    Reject --> End
    
    style Start fill:#e1f5fe
    style End fill:#c8e6c9
    style CheckQuality fill:#fff3e0
    style Audit fill:#fff3e0
```

### 13.2 å®Œæ•´å‡ºåº“ä¸šåŠ¡æµç¨‹

```mermaid
flowchart TD
    Start([é”€å”®è®¢å•ç”Ÿæˆ]) --> CreateOutbound[åˆ›å»ºå‡ºåº“å•]
    CreateOutbound --> Submit[æäº¤å®¡æ ¸]
    
    Submit --> Audit{å®¡æ ¸}
    Audit -->|é©³å›| Modify[ä¿®æ”¹å‡ºåº“å•]
    Modify --> Submit
    Audit -->|é€šè¿‡| LockInventory[é”å®šåº“å­˜]
    
    LockInventory --> CheckStock{åº“å­˜æ˜¯å¦å……è¶³}
    CheckStock -->|å¦| WaitStock[ç­‰å¾…è¡¥è´§]
    WaitStock --> CheckStock
    CheckStock -->|æ˜¯| GenerateWave[ç”Ÿæˆæ‹£è´§æ³¢æ¬¡]
    
    GenerateWave --> OptimizePath[ä¼˜åŒ–æ‹£è´§è·¯å¾„]
    OptimizePath --> AssignPicker[åˆ†é…æ‹£è´§å‘˜]
    AssignPicker --> StartPicking[å¼€å§‹æ‹£è´§]
    
    StartPicking --> ScanLocation[æ‰«æåº“ä½]
    ScanLocation --> ScanGoods[æ‰«æå•†å“]
    ScanGoods --> CheckMatch{å•†å“æ˜¯å¦åŒ¹é…}
    
    CheckMatch -->|å¦| HandleException[å¤„ç†å¼‚å¸¸]
    HandleException --> ReportException[ä¸ŠæŠ¥å¼‚å¸¸]
    ReportException --> ScanLocation
    
    CheckMatch -->|æ˜¯| InputQty[å½•å…¥æ‹£è´§æ•°é‡]
    InputQty --> NextTask{æ˜¯å¦è¿˜æœ‰ä»»åŠ¡}
    NextTask -->|æ˜¯| ScanLocation
    NextTask -->|å¦| SubmitPicking[æäº¤æ‹£è´§]
    
    SubmitPicking --> StartReview[å¼€å§‹å¤æ ¸]
    StartReview --> ReviewGoods[å¤æ ¸å•†å“å’Œæ•°é‡]
    ReviewGoods --> ReviewResult{å¤æ ¸ç»“æœ}
    
    ReviewResult -->|ä¸é€šè¿‡| ReturnPicking[é€€å›é‡æ‹£]
    ReturnPicking --> StartPicking
    ReviewResult -->|é€šè¿‡| Pack[æ‰“åŒ…]
    
    Pack --> PrintWaybill[æ‰“å°é¢å•]
    PrintWaybill --> ArrangeShipping[å®‰æ’å‘è´§]
    ArrangeShipping --> Ship[ç¡®è®¤å‘è´§]
    Ship --> DeductInventory[æ‰£å‡åº“å­˜]
    DeductInventory --> UpdateStatus[æ›´æ–°è®¢å•çŠ¶æ€]
    UpdateStatus --> NotifyCustomer[é€šçŸ¥å®¢æˆ·]
    NotifyCustomer --> End([å‡ºåº“å®Œæˆ])
    
    style Start fill:#e1f5fe
    style End fill:#c8e6c9
    style CheckStock fill:#fff3e0
    style CheckMatch fill:#fff3e0
    style ReviewResult fill:#fff3e0
```

### 13.3 ç›˜ç‚¹ä¸šåŠ¡æµç¨‹

```mermaid
flowchart TD
    Start([åˆ›å»ºç›˜ç‚¹è®¡åˆ’]) --> ConfigScope[é…ç½®ç›˜ç‚¹èŒƒå›´]
    ConfigScope --> Submit[æäº¤å®¡æ ¸]
    Submit --> Audit{å®¡æ ¸}
    
    Audit -->|é©³å›| Modify[ä¿®æ”¹è®¡åˆ’]
    Modify --> Submit
    Audit -->|é€šè¿‡| GenerateTasks[ç”Ÿæˆç›˜ç‚¹ä»»åŠ¡]
    
    GenerateTasks --> AssignUsers[åˆ†é…ç›˜ç‚¹äººå‘˜]
    AssignUsers --> StartTaking[å¼€å§‹ç›˜ç‚¹]
    
    StartTaking --> ScanLocation[æ‰«æåº“ä½]
    ScanLocation --> ScanGoods[æ‰«æå•†å“]
    ScanGoods --> InputActual[å½•å…¥å®ç›˜æ•°é‡]
    InputActual --> Compare{å¯¹æ¯”è´¦é¢æ•°é‡}
    
    Compare -->|æœ‰å·®å¼‚| MarkDiff[æ ‡è®°å·®å¼‚]
    Compare -->|æ— å·®å¼‚| NextLocation{ä¸‹ä¸€ä¸ªåº“ä½}
    MarkDiff --> TakePhoto[æ‹ç…§è®°å½•]
    TakePhoto --> NextLocation
    
    NextLocation -->|æ˜¯| ScanLocation
    NextLocation -->|å¦| SubmitResult[æäº¤ç›˜ç‚¹ç»“æœ]
    
    SubmitResult --> Review[å¤æ ¸å·®å¼‚]
    Review --> AnalyzeDiff{å·®å¼‚åˆ†æ}
    
    AnalyzeDiff --> InputReason[è¾“å…¥å·®å¼‚åŸå› ]
    InputReason --> GenerateAdjust[ç”Ÿæˆè°ƒæ•´å•]
    GenerateAdjust --> AuditAdjust{å®¡æ ¸è°ƒæ•´å•}
    
    AuditAdjust -->|é©³å›| Review
    AuditAdjust -->|é€šè¿‡| AdjustInventory[è°ƒæ•´åº“å­˜]
    AdjustInventory --> GenerateReport[ç”Ÿæˆç›˜ç‚¹æŠ¥å‘Š]
    GenerateReport --> End([ç›˜ç‚¹å®Œæˆ])
    
    style Start fill:#e1f5fe
    style End fill:#c8e6c9
    style Compare fill:#fff3e0
    style AnalyzeDiff fill:#fff3e0
```

---

## åå››ã€æŠ¥è¡¨è®¾è®¡

### 14.1 åº“å­˜æŠ¥è¡¨

**æŠ¥è¡¨åç§°**: åº“å­˜æ±‡æ€»è¡¨  
**æ›´æ–°é¢‘ç‡**: å®æ—¶  
**å¯¼å‡ºæ ¼å¼**: Excel/PDF

**æŠ¥è¡¨åˆ—**:

| åˆ—å | è¯´æ˜ | è®¡ç®—å…¬å¼ |
|-----|------|---------|
| ä»“åº“åç§° | - | - |
| å•†å“åˆ†ç±» | - | - |
| SKUç¼–ç  | - | - |
| å•†å“åç§° | - | - |
| æ€»åº“å­˜ | - | SUM(quantity) |
| é”å®šæ•°é‡ | - | SUM(lock_quantity) |
| å¯ç”¨åº“å­˜ | - | æ€»åº“å­˜ - é”å®šæ•°é‡ |
| å®‰å…¨åº“å­˜ | - | - |
| åº“å­˜çŠ¶æ€ | - | é¢„è­¦/æ­£å¸¸/å……è¶³ |
| åº“å­˜é‡‘é¢ | æŒ‰æˆæœ¬ä»·è®¡ç®— | æ€»åº“å­˜ Ã— æˆæœ¬ä»· |
| å ç”¨åº“ä½æ•° | - | COUNT(DISTINCT location_id) |
| å¹³å‡åº“é¾„ | å¤©æ•° | AVG(DATEDIFF(NOW(), inbound_date)) |

**ç­›é€‰æ¡ä»¶**:

- ä»“åº“(å¤šé€‰)
- å•†å“åˆ†ç±»(æ ‘å½¢)
- åº“å­˜çŠ¶æ€(æ­£å¸¸/é¢„è­¦/é›¶åº“å­˜)
- åº“é¾„èŒƒå›´

---

### 14.2 å‡ºå…¥åº“ç»Ÿè®¡æŠ¥è¡¨

**æŠ¥è¡¨åç§°**: å‡ºå…¥åº“æ—¥æŠ¥/æœˆæŠ¥  
**æ›´æ–°é¢‘ç‡**: æ¯æ—¥å‡Œæ™¨  
**å¯¼å‡ºæ ¼å¼**: Excel/PDF

**æŠ¥è¡¨åˆ—**:

| åˆ—å | è¯´æ˜ | è®¡ç®—å…¬å¼ |
|-----|------|---------|
| æ—¥æœŸ | - | - |
| ä»“åº“åç§° | - | - |
| å…¥åº“å•æ•° | - | COUNT(å…¥åº“å•) |
| å…¥åº“å•†å“ç§ç±» | - | COUNT(DISTINCT goods_id) |
| å…¥åº“æ€»æ•°é‡ | - | SUM(actual_quantity) |
| å‡ºåº“å•æ•° | - | COUNT(å‡ºåº“å•) |
| å‡ºåº“å•†å“ç§ç±» | - | COUNT(DISTINCT goods_id) |
| å‡ºåº“æ€»æ•°é‡ | - | SUM(actual_quantity) |
| å‡€å˜åŒ–é‡ | - | å…¥åº“ - å‡ºåº“ |
| å®Œæˆç‡ | ç™¾åˆ†æ¯” | å®Œæˆå•æ•° / æ€»å•æ•° Ã— 100% |

**å›¾è¡¨å±•ç¤º**:

- å‡ºå…¥åº“è¶‹åŠ¿æŠ˜çº¿å›¾
- å‡ºå…¥åº“ç±»å‹é¥¼å›¾
- TOP10å•†å“æŸ±çŠ¶å›¾

---

### 14.3 åº“å­˜å‘¨è½¬ç‡åˆ†æ

**æŠ¥è¡¨åç§°**: åº“å­˜å‘¨è½¬ç‡åˆ†æè¡¨  
**ç»Ÿè®¡å‘¨æœŸ**: æœˆåº¦  
**è®¡ç®—å…¬å¼**: å‘¨è½¬ç‡ = å‡ºåº“æ€»é¢ / å¹³å‡åº“å­˜é‡‘é¢

**æŠ¥è¡¨åˆ—**:

| åˆ—å | è¯´æ˜ | è®¡ç®—å…¬å¼ |
|-----|------|---------|
| å•†å“åˆ†ç±» | - | - |
| SKUç¼–ç  | - | - |
| å•†å“åç§° | - | - |
| æœŸåˆåº“å­˜ | ä»¶ | - |
| æœ¬æœŸå…¥åº“ | ä»¶ | - |
| æœ¬æœŸå‡ºåº“ | ä»¶ | - |
| æœŸæœ«åº“å­˜ | ä»¶ | - |
| å¹³å‡åº“å­˜ | ä»¶ | (æœŸåˆ + æœŸæœ«) / 2 |
| å‘¨è½¬ç‡ | æ¬¡ | æœ¬æœŸå‡ºåº“ / å¹³å‡åº“å­˜ |
| å‘¨è½¬å¤©æ•° | å¤© | 30 / å‘¨è½¬ç‡ |
| ABCåˆ†ç±» | - | æ ¹æ®å‘¨è½¬ç‡åˆ†ç±» |

**ABCåˆ†ç±»è§„åˆ™**:

- **Aç±»**: å‘¨è½¬ç‡ > 6æ¬¡/æœˆ (å¿«é€Ÿå‘¨è½¬)
- **Bç±»**: å‘¨è½¬ç‡ 3-6æ¬¡/æœˆ (æ­£å¸¸å‘¨è½¬)
- **Cç±»**: å‘¨è½¬ç‡ < 3æ¬¡/æœˆ (æ…¢é€Ÿå‘¨è½¬)

---

## åäº”ã€æŠ€æœ¯éš¾ç‚¹ä¸å¼€å‘æŒ‘æˆ˜

### 15.1 æ ¸å¿ƒæŠ€æœ¯éš¾ç‚¹

#### 15.1.1 é«˜å¹¶å‘åº“å­˜æ‰£å‡ä¸€è‡´æ€§é—®é¢˜

**é—®é¢˜èƒŒæ™¯**ï¼š
åœ¨ç”µå•†å¤§ä¿ƒç­‰é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤šä¸ªç”¨æˆ·åŒæ—¶è´­ä¹°åŒä¸€å•†å“ï¼Œç³»ç»Ÿéœ€è¦ä¿è¯ï¼š
- ä¸è¶…å–ï¼šåº“å­˜æ‰£å‡å‡†ç¡®æ— è¯¯
- é«˜æ€§èƒ½ï¼šç§’çº§å“åº”ç”¨æˆ·è¯·æ±‚  
- é«˜å¯ç”¨ï¼šæœåŠ¡ç¨³å®šä¸å®•æœº

**æ ¸å¿ƒæŒ‘æˆ˜**ï¼š
- **å¹¶å‘å®‰å…¨**ï¼šå¤šçº¿ç¨‹åŒæ—¶ä¿®æ”¹åº“å­˜æ•°æ®
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šæ•°æ®åº“é”ç«äº‰æ¿€çƒˆ
- **åˆ†å¸ƒå¼ä¸€è‡´æ€§**ï¼šå¤šæœåŠ¡èŠ‚ç‚¹æ•°æ®åŒæ­¥

**è§£å†³æ–¹æ¡ˆ - ä¸‰é‡ä¿éšœæœºåˆ¶**ï¼š

```java
/**
 * åº“å­˜æ‰£å‡ - åˆ†å¸ƒå¼é” + æ•°æ®åº“è¡Œé” + ä¹è§‚é”
 */
@Override
@Transactional(rollbackFor = Exception.class)
public boolean deductInventory(Long goodsId, BigDecimal quantity) {
    String lockKey = "inventory:lock:" + goodsId;
    RLock lock = redissonClient.getLock(lockKey);
    
    try {
        // 1. Redisåˆ†å¸ƒå¼é”ï¼ˆä¿è¯é›†ç¾¤ç¯å¢ƒä¸‹çš„äº’æ–¥ï¼‰
        boolean acquired = lock.tryLock(3, 10, TimeUnit.SECONDS);
        if (!acquired) {
            throw new BizException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        // 2. æ•°æ®åº“è¡Œé”ï¼ˆä¿è¯å•æœºç¯å¢ƒä¸‹çš„äº’æ–¥ï¼‰
        Inventory inventory = inventoryMapper.selectForUpdate(goodsId);
        
        // 3. ä¸šåŠ¡æ ¡éªŒ
        if (inventory.getAvailableQuantity().compareTo(quantity) < 0) {
            throw new BizException("åº“å­˜ä¸è¶³");
        }
        
        // 4. ä¹è§‚é”æ›´æ–°ï¼ˆå…œåº•æœºåˆ¶ï¼‰
        int updated = inventoryMapper.deductWithVersion(
            goodsId, quantity, inventory.getVersion()
        );
        
        if (updated == 0) {
            throw new BizException("åº“å­˜æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // 5. å¼‚æ­¥è®°å½•æµæ°´
        inventoryLogProducer.sendLog(inventory, quantity);
        
        // 6. æ¸…é™¤ç¼“å­˜
        redisTemplate.delete("inventory:" + goodsId);
        
        return true;
    } finally {
        if (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
```

**æŠ€æœ¯äº®ç‚¹**ï¼š
- **é”ç²’åº¦æ§åˆ¶**ï¼šæŒ‰å•†å“IDåŠ é”ï¼Œä¸åŒå•†å“å¹¶è¡Œå¤„ç†
- **è¶…æ—¶æœºåˆ¶**ï¼š3ç§’è·é”è¶…æ—¶ï¼Œé¿å…çº¿ç¨‹å †ç§¯
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¼‚æ­¥æ—¥å¿—è®°å½•ï¼Œç«‹å³æ¸…é™¤ç¼“å­˜
- **å®¹é”™è®¾è®¡**ï¼šå¤šé‡æ ¡éªŒï¼Œå…œåº•ä¿éšœ

**æ•ˆæœè¯„ä¼°**ï¼š
- å¹¶å‘å¤„ç†èƒ½åŠ›ï¼šæ”¯æŒ10000+QPS
- æ•°æ®å‡†ç¡®æ€§ï¼š100%é˜²è¶…å–
- å“åº”æ—¶é—´ï¼šP99 < 100ms

#### 15.1.2 æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•

**é—®é¢˜èƒŒæ™¯**ï¼š
ä¼ ç»Ÿä»“åº“æ‹£è´§æ•ˆç‡ä½ä¸‹çš„åŸå› ï¼š
- æ‹£è´§è·¯å¾„å†—ä½™ï¼Œé‡å¤è¡Œèµ°
- æ‹£è´§é¡ºåºéšæœºï¼Œç¼ºä¹è§„åˆ’
- äººå·¥ç»éªŒä¾èµ–ï¼Œéš¾ä»¥æ ‡å‡†åŒ–

**ç®—æ³•é€‰æ‹©å¯¹æ¯”**ï¼š

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ä¼˜åŒ–æ•ˆæœ | é€‚ç”¨è§„æ¨¡ | æ˜¯å¦é‡‡ç”¨ |
|------|-----------|---------|---------|---------|
| æš´åŠ›æšä¸¾ | O(n!) | 100%æœ€ä¼˜ | n < 10 | âŒ ä¸å®ç”¨ |
| åŠ¨æ€è§„åˆ’ | O(nÂ²Â·2â¿) | 100%æœ€ä¼˜ | n < 20 | âŒ æ€§èƒ½å·® |
| **è´ªå¿ƒç®—æ³•** | O(nÂ²) | 80-90%ä¼˜åŒ– | n < 1000 | âœ… é‡‡ç”¨ |
| é—ä¼ ç®—æ³• | O(nÂ·gÂ·p) | 85-95%ä¼˜åŒ– | n > 1000 | âšª å¤‡é€‰ |

**æ ¸å¿ƒç®—æ³•å®ç°**ï¼š

```java
/**
 * æ”¹è¿›çš„è´ªå¿ƒç®—æ³• + 2-optä¼˜åŒ–
 */
public List<Location> optimizePath(List<Location> locations) {
    List<Location> optimizedPath = new ArrayList<>();
    Set<Location> unvisited = new HashSet<>(locations);
    
    // 1. èµ·ç‚¹ï¼šé€‰æ‹©è·ç¦»åº“åŒºå…¥å£æœ€è¿‘çš„åº“ä½
    Location entrance = getWarehouseEntrance();
    Location current = findNearest(entrance, unvisited);
    optimizedPath.add(current);
    unvisited.remove(current);
    
    // 2. è´ªå¿ƒé€‰æ‹©ï¼šæ¯æ¬¡é€‰æ‹©æœ€è¿‘çš„æœªè®¿é—®åº“ä½
    while (!unvisited.isEmpty()) {
        Location nearest = findNearest(current, unvisited);
        optimizedPath.add(nearest);
        unvisited.remove(nearest);
        current = nearest;
    }
    
    // 3. 2-optä¼˜åŒ–ï¼šæ¶ˆé™¤äº¤å‰è·¯å¾„
    return eliminateCrossings(optimizedPath);
}

/**
 * æ›¼å“ˆé¡¿è·ç¦»è®¡ç®—ï¼ˆé€‚é…ä»“åº“ç›´è§’é€šé“ï¼‰
 */
private double calculateDistance(Location loc1, Location loc2) {
    int rowDiff = Math.abs(loc1.getRowNo() - loc2.getRowNo());
    int colDiff = Math.abs(loc1.getColumnNo() - loc2.getColumnNo());
    int layerDiff = Math.abs(loc1.getLayerNo() - loc2.getLayerNo());
    
    // å±‚é—´ç§»åŠ¨æˆæœ¬æ›´é«˜
    return rowDiff + colDiff + layerDiff * 2.0;
}
```

**ä¼˜åŒ–æ•ˆæœå¯¹æ¯”**ï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|-------|-------|---------|
| å¹³å‡æ‹£è´§è·¯å¾„ | 450ç±³ | 280ç±³ | â†“ 38% |
| å¹³å‡æ‹£è´§æ—¶é—´ | 25åˆ†é’Ÿ | 16åˆ†é’Ÿ | â†“ 36% |
| æ‹£è´§å‘˜æ—¥äº§èƒ½ | 180å• | 280å• | â†‘ 56% |
| è·¯å¾„äº¤å‰æ¬¡æ•° | 8æ¬¡ | 1æ¬¡ | â†“ 88% |

#### 15.1.3 æ™ºèƒ½æ³¢æ¬¡ç”Ÿæˆä¸ä»»åŠ¡è°ƒåº¦

**é—®é¢˜èƒŒæ™¯**ï¼š
å¦‚ä½•å°†æ•£ä¹±çš„è®¢å•æ™ºèƒ½èšåˆæˆæ‹£è´§æ³¢æ¬¡ï¼Œå¹¶åˆç†åˆ†é…ç»™æ‹£è´§å‘˜ï¼Ÿ

**æ ¸å¿ƒç®—æ³• - K-meansèšç±»å˜ç§**ï¼š

```java
/**
 * è®¢å•èšç±» - æŒ‰å•†å“ä½ç½®èšåˆç›¸ä¼¼åŒºåŸŸè®¢å•
 */
private Map<String, List<Order>> clusterOrders(List<Order> orders) {
    Map<String, List<Order>> clusters = new HashMap<>();
    
    for (Order order : orders) {
        // è®¡ç®—è®¢å•çš„"é‡å¿ƒä½ç½®"
        Location centerLocation = calculateCenterLocation(order);
        
        // åˆ†é…åˆ°æœ€è¿‘çš„åº“åŒº
        String zoneCode = locationService.getNearestZone(centerLocation);
        
        clusters.computeIfAbsent(zoneCode, k -> new ArrayList<>()).add(order);
    }
    
    return clusters;
}

/**
 * æ‹£è´§å‘˜è¯„åˆ†ç®—æ³• - ç»¼åˆè€ƒè™‘ä½ç½®ã€è´Ÿè½½ã€æŠ€èƒ½ã€æ•ˆç‡
 */
private double calculatePickerScore(Picker picker, PickingWave wave) {
    double score = 0;
    
    // 1. ä½ç½®å¾—åˆ†ï¼ˆ40%æƒé‡ï¼‰
    double distance = calculateDistance(picker.getCurrentLocation(), wave.getStartLocation());
    double locationScore = Math.max(0, 100 - distance);
    score += locationScore * 0.4;
    
    // 2. è´Ÿè½½å¾—åˆ†ï¼ˆ30%æƒé‡ï¼‰
    int currentTasks = picker.getCurrentTaskCount();
    double loadScore = Math.max(0, 100 - currentTasks * 10);
    score += loadScore * 0.3;
    
    // 3. æŠ€èƒ½å¾—åˆ†ï¼ˆ20%æƒé‡ï¼‰
    double skillScore = picker.getSkillLevel() * 20;
    score += skillScore * 0.2;
    
    // 4. æ•ˆç‡å¾—åˆ†ï¼ˆ10%æƒé‡ï¼‰
    double efficiencyScore = picker.getEfficiencyRate();
    score += efficiencyScore * 0.1;
    
    return score;
}
```

**æ•ˆæœæå‡**ï¼š
- æ‹£è´§æ•ˆç‡æå‡ï¼š60%
- äººå‘˜åˆ©ç”¨ç‡ï¼š95%
- è®¢å•å¤„ç†æ—¶æ•ˆï¼šæå‡35%

### 15.2 æ¶æ„è®¾è®¡æŒ‘æˆ˜

#### 15.2.1 å¾®æœåŠ¡æ‹†åˆ†ç­–ç•¥

**æ‹†åˆ†åŸåˆ™**ï¼š

1. **ä¸šåŠ¡èƒ½åŠ›è¾¹ç•Œ**ï¼šæ¯ä¸ªæœåŠ¡è´Ÿè´£å®Œæ•´çš„ä¸šåŠ¡åŸŸ
2. **æ•°æ®ç‹¬ç«‹æ€§**ï¼šé¿å…è·¨æœåŠ¡çš„æ•°æ®äº‹åŠ¡
3. **å›¢é˜Ÿç»„ç»‡ç»“æ„**ï¼šç¬¦åˆåº·å¨å®šå¾‹
4. **æŠ€æœ¯æ ˆå¼‚æ„**ï¼šä¸åŒæœåŠ¡å¯é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯

**æœåŠ¡åˆ’åˆ†ç»“æœ**ï¼š

```yaml
services:
  - name: warehouse-service
    responsibility: ä»“åº“ã€åº“åŒºã€åº“ä½ç®¡ç†
    database: warehouse_db
    
  - name: inventory-service  
    responsibility: åº“å­˜ç®¡ç†ã€åº“å­˜æµæ°´
    database: inventory_db
    
  - name: inbound-service
    responsibility:å…¥åº“å•ã€æ”¶è´§ä¸Šæ¶
    database: inbound_db
    
  - name: outbound-service
    responsibility: å‡ºåº“å•ã€è®¢å•å¤„ç†
    database: outbound_db
    
  - name: picking-service
    responsibility: æ‹£è´§æ³¢æ¬¡ã€ä»»åŠ¡è°ƒåº¦
    database: picking_db
    
  - name: report-service
    responsibility: æŠ¥è¡¨åˆ†æã€æ•°æ®ç»Ÿè®¡
    database: report_db
```

#### 15.2.2 åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†

**åœºæ™¯ï¼šå‡ºåº“æµç¨‹çš„åˆ†å¸ƒå¼äº‹åŠ¡**

æ¶‰åŠæœåŠ¡ï¼š
- åº“å­˜æœåŠ¡ï¼šæ‰£å‡åº“å­˜
- è®¢å•æœåŠ¡ï¼šæ›´æ–°çŠ¶æ€  
- ç‰©æµæœåŠ¡ï¼šåˆ›å»ºè¿å•
- è´¦åŠ¡æœåŠ¡ï¼šè®°å½•æˆæœ¬

**è§£å†³æ–¹æ¡ˆ - Sagaæ¨¡å¼**ï¼š

```java
/**
 * å‡ºåº“æµç¨‹ç¼–æ’
 */
@Component
public class OutboundSaga {
    
    @SagaOrchestrationStart
    public void processOutbound(OutboundOrder order) {
        // 1. é”å®šåº“å­˜
        sagaManager.choreography()
            .step("lockInventory")
            .invokeParticipant("inventory-service")
            .withCompensation("unlockInventory")
            
            // 2. æ›´æ–°è®¢å•çŠ¶æ€
            .step("updateOrderStatus") 
            .invokeParticipant("order-service")
            .withCompensation("revertOrderStatus")
            
            // 3. åˆ›å»ºè¿å•
            .step("createWaybill")
            .invokeParticipant("logistics-service")  
            .withCompensation("cancelWaybill")
            
            // 4. è®°å½•æˆæœ¬
            .step("recordCost")
            .invokeParticipant("finance-service")
            .withCompensation("reverseCost")
            
            .execute();
    }
}
```

### 15.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 15.3.1 å®Œæ•´ç¼“å­˜æ¶æ„è®¾è®¡

##### ç¼“å­˜æ¶æ„æ€»ä½“è®¾è®¡

```mermaid
graph TD
    Client[å®¢æˆ·ç«¯è¯·æ±‚] --> L1[L1: æœ¬åœ°ç¼“å­˜<br/>Caffeine]
    L1 -->|æœªå‘½ä¸­| L2[L2: åˆ†å¸ƒå¼ç¼“å­˜<br/>Redis Cluster]
    L2 -->|æœªå‘½ä¸­| L3[L3: æ•°æ®åº“<br/>MySQL]
    
    L3 --> L2_Write[å†™å…¥Redis]
    L2_Write --> L1_Write[å†™å…¥æœ¬åœ°ç¼“å­˜]
    L1_Write --> Client
    
    subgraph "ç¼“å­˜ç­–ç•¥"
        Hot[çƒ­ç‚¹æ•°æ®<br/>å•†å“ä¿¡æ¯ã€ä»“åº“ä¿¡æ¯]
        Warm[æ¸©æ•°æ®<br/>åº“å­˜æ•°æ®ã€ç”¨æˆ·ä¿¡æ¯] 
        Cold[å†·æ•°æ®<br/>å†å²è®¢å•ã€ç»Ÿè®¡æ•°æ®]
    end
    
    Hot --> L1
    Warm --> L2  
    Cold --> L3
```

##### L1: æœ¬åœ°ç¼“å­˜è®¾è®¡ï¼ˆCaffeineï¼‰

**é€‚ç”¨æ•°æ®ç‰¹å¾**ï¼š
- å‡ ä¹ä¸å˜çš„åŸºç¡€æ•°æ®ï¼ˆå•†å“ä¿¡æ¯ã€ä»“åº“ä¿¡æ¯ï¼‰
- è®¿é—®é¢‘ç‡æé«˜çš„çƒ­ç‚¹æ•°æ®
- æ•°æ®é‡ç›¸å¯¹è¾ƒå°ï¼ˆ< 1GBï¼‰

**é…ç½®ç­–ç•¥**ï¼š

```java
@Configuration
public class LocalCacheConfig {
    
    /**
     * å•†å“ä¿¡æ¯ç¼“å­˜é…ç½®
     */
    @Bean("goodsCache")
    public Cache<Long, Goods> goodsCache() {
        return Caffeine.newBuilder()
            // æœ€å¤§å®¹é‡ï¼š10ä¸‡ä¸ªå•†å“
            .maximumSize(100_000)
            // å†™å…¥åè¿‡æœŸæ—¶é—´ï¼š24å°æ—¶
            .expireAfterWrite(24, TimeUnit.HOURS)
            // è®¿é—®ååˆ·æ–°æ—¶é—´ï¼š2å°æ—¶  
            .refreshAfterWrite(2, TimeUnit.HOURS)
            // åˆå§‹å®¹é‡
            .initialCapacity(1000)
            // è®°å½•ç»Ÿè®¡ä¿¡æ¯
            .recordStats()
            // å¼‚æ­¥åŠ è½½å™¨
            .buildAsync(new CacheLoader<Long, Goods>() {
                @Override
                public Goods load(Long goodsId) {
                    return goodsService.getFromRedis(goodsId);
                }
            });
    }
    
    /**
     * ä»“åº“ä¿¡æ¯ç¼“å­˜é…ç½®
     */
    @Bean("warehouseCache")
    public Cache<Long, Warehouse> warehouseCache() {
        return Caffeine.newBuilder()
            .maximumSize(1000)
            // ä»“åº“ä¿¡æ¯åŸºæœ¬ä¸å˜ï¼Œè¿‡æœŸæ—¶é—´è®¾é•¿ä¸€ç‚¹
            .expireAfterWrite(7, TimeUnit.DAYS)
            .refreshAfterWrite(1, TimeUnit.DAYS)
            .recordStats()
            .build();
    }
    
    /**
     * åº“ä½ä¿¡æ¯ç¼“å­˜é…ç½® 
     */
    @Bean("locationCache")
    public Cache<String, Location> locationCache() {
        return Caffeine.newBuilder()
            .maximumSize(50000)  // 5ä¸‡ä¸ªåº“ä½
            .expireAfterWrite(12, TimeUnit.HOURS)
            .refreshAfterWrite(1, TimeUnit.HOURS)
            .recordStats()
            .build();
    }
}
```

**ç¼“å­˜æœåŠ¡å®ç°**ï¼š

```java
@Service
@Slf4j
public class LocalCacheService {
    
    @Autowired
    @Qualifier("goodsCache")
    private Cache<Long, Goods> goodsCache;
    
    @Autowired 
    @Qualifier("warehouseCache")
    private Cache<Long, Warehouse> warehouseCache;
    
    /**
     * è·å–å•†å“ä¿¡æ¯ï¼ˆæ”¯æŒæ‰¹é‡è·å–ï¼‰
     */
    public Map<Long, Goods> getGoods(Set<Long> goodsIds) {
        Map<Long, CompletableFuture<Goods>> futures = goodsCache.getAll(goodsIds);
        
        Map<Long, Goods> result = new HashMap<>();
        futures.forEach((id, future) -> {
            try {
                result.put(id, future.get(100, TimeUnit.MILLISECONDS));
            } catch (Exception e) {
                log.warn("è·å–å•†å“ä¿¡æ¯è¶…æ—¶ï¼ŒgoodsId: {}", id, e);
                // é™çº§åˆ°L2ç¼“å­˜
                Goods goods = redisService.getGoods(id);
                if (goods != null) {
                    result.put(id, goods);
                    // å¼‚æ­¥æ›´æ–°L1ç¼“å­˜
                    goodsCache.put(id, CompletableFuture.completedFuture(goods));
                }
            }
        });
        
        return result;
    }
    
    /**
     * ç¼“å­˜é¢„çƒ­
     */
    @PostConstruct
    public void warmup() {
        log.info("å¼€å§‹ç¼“å­˜é¢„çƒ­...");
        
        // é¢„çƒ­çƒ­é—¨å•†å“
        List<Long> hotGoodsIds = goodsService.getHotGoodsIds(1000);
        goodsCache.getAll(new HashSet<>(hotGoodsIds));
        
        // é¢„çƒ­æ‰€æœ‰ä»“åº“ä¿¡æ¯
        List<Warehouse> warehouses = warehouseService.getAllWarehouses();
        warehouses.forEach(w -> warehouseCache.put(w.getId(), w));
        
        log.info("ç¼“å­˜é¢„çƒ­å®Œæˆ");
    }
}
```

##### L2: åˆ†å¸ƒå¼ç¼“å­˜è®¾è®¡ï¼ˆRedis Clusterï¼‰

**é›†ç¾¤æ¶æ„**ï¼š

```yaml
# Redis Cluster é…ç½®
redis:
  cluster:
    nodes:
      - 192.168.1.10:7000  # ä¸»èŠ‚ç‚¹1
      - 192.168.1.10:7001  # ä¸»èŠ‚ç‚¹1ä»èŠ‚ç‚¹
      - 192.168.1.11:7000  # ä¸»èŠ‚ç‚¹2  
      - 192.168.1.11:7001  # ä¸»èŠ‚ç‚¹2ä»èŠ‚ç‚¹
      - 192.168.1.12:7000  # ä¸»èŠ‚ç‚¹3
      - 192.168.1.12:7001  # ä¸»èŠ‚ç‚¹3ä»èŠ‚ç‚¹
    max-redirects: 3
    timeout: 3000ms
    pool:
      max-active: 100
      max-idle: 20
      min-idle: 5
      max-wait: 3000ms
```

**ç¼“å­˜åˆ†å±‚è®¾è®¡**ï¼š

```java
@Service
@Slf4j  
public class RedisCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private StringRedisTemplate stringRedisTemplate;
    
    /**
     * åº“å­˜ç¼“å­˜ - çƒ­æ•°æ®ï¼ŒçŸ­TTL
     */
    public void setInventory(Long goodsId, Inventory inventory) {
        String key = CacheKey.INVENTORY + goodsId;
        redisTemplate.opsForValue().set(key, inventory, 10, TimeUnit.MINUTES);
        
        // è®¾ç½®åº“å­˜æ•°é‡çš„å•ç‹¬ç¼“å­˜ï¼Œç”¨äºå¿«é€Ÿæ£€æŸ¥
        String qtyKey = CacheKey.INVENTORY_QTY + goodsId;  
        stringRedisTemplate.opsForValue().set(qtyKey, 
            inventory.getAvailableQuantity().toString(), 5, TimeUnit.MINUTES);
    }
    
    /**
     * å•†å“ä¿¡æ¯ç¼“å­˜ - æ¸©æ•°æ®ï¼Œé•¿TTL
     */
    public void setGoods(Long goodsId, Goods goods) {
        String key = CacheKey.GOODS + goodsId;
        redisTemplate.opsForValue().set(key, goods, 24, TimeUnit.HOURS);
    }
    
    /**
     * åˆ†å¸ƒå¼é”ç¼“å­˜
     */
    public boolean tryLock(String lockKey, String value, long expireTime) {
        Boolean result = stringRedisTemplate.opsForValue()
            .setIfAbsent(lockKey, value, expireTime, TimeUnit.SECONDS);
        return Boolean.TRUE.equals(result);
    }
    
    /**
     * æ‰¹é‡æ“ä½œ - ä½¿ç”¨Pipelineæå‡æ€§èƒ½
     */
    public Map<Long, Inventory> batchGetInventory(Set<Long> goodsIds) {
        List<String> keys = goodsIds.stream()
            .map(id -> CacheKey.INVENTORY + id)
            .collect(Collectors.toList());
            
        // ä½¿ç”¨Pipelineæ‰¹é‡è·å–
        List<Object> results = redisTemplate.executePipelined(
            (RedisCallback<Object>) connection -> {
                keys.forEach(key -> connection.get(key.getBytes()));
                return null;
            }
        );
        
        Map<Long, Inventory> inventoryMap = new HashMap<>();
        Iterator<Long> idIter = goodsIds.iterator();
        
        for (Object result : results) {
            Long goodsId = idIter.next();
            if (result != null) {
                inventoryMap.put(goodsId, (Inventory) result);
            }
        }
        
        return inventoryMap;
    }
    
    /**
     * å¸ƒéš†è¿‡æ»¤å™¨ - é˜²æ­¢ç¼“å­˜ç©¿é€
     */
    @Autowired
    private RedisTemplate<String, Object> bloomRedisTemplate;
    
    public boolean bloomContains(String key, String value) {
        // ä½¿ç”¨å¤šä¸ªhashå‡½æ•°
        int hash1 = Math.abs(value.hashCode() % 1000000);
        int hash2 = Math.abs((value.hashCode() * 31) % 1000000);
        int hash3 = Math.abs((value.hashCode() * 37) % 1000000);
        
        return bloomRedisTemplate.opsForValue().getBit(key, hash1) &&
               bloomRedisTemplate.opsForValue().getBit(key, hash2) &&
               bloomRedisTemplate.opsForValue().getBit(key, hash3);
    }
    
    public void bloomAdd(String key, String value) {
        int hash1 = Math.abs(value.hashCode() % 1000000);
        int hash2 = Math.abs((value.hashCode() * 31) % 1000000);  
        int hash3 = Math.abs((value.hashCode() * 37) % 1000000);
        
        bloomRedisTemplate.opsForValue().setBit(key, hash1, true);
        bloomRedisTemplate.opsForValue().setBit(key, hash2, true);
        bloomRedisTemplate.opsForValue().setBit(key, hash3, true);
    }
}
```

**ç¼“å­˜Keyè®¾è®¡è§„èŒƒ**ï¼š

```java
public class CacheKey {
    // ä¸šåŠ¡ç¼“å­˜Key
    public static final String INVENTORY = "wms:inventory:";           // åº“å­˜ä¿¡æ¯  
    public static final String INVENTORY_QTY = "wms:inventory:qty:";   // åº“å­˜æ•°é‡
    public static final String GOODS = "wms:goods:";                   // å•†å“ä¿¡æ¯
    public static final String WAREHOUSE = "wms:warehouse:";           // ä»“åº“ä¿¡æ¯
    public static final String LOCATION = "wms:location:";             // åº“ä½ä¿¡æ¯
    public static final String ORDER = "wms:order:";                  // è®¢å•ä¿¡æ¯
    
    // é”Key  
    public static final String LOCK_INVENTORY = "wms:lock:inventory:"; // åº“å­˜é”
    public static final String LOCK_ORDER = "wms:lock:order:";        // è®¢å•é”
    
    // å¸ƒéš†è¿‡æ»¤å™¨Key
    public static final String BLOOM_GOODS = "wms:bloom:goods";        // å•†å“å­˜åœ¨æ€§
    public static final String BLOOM_ORDER = "wms:bloom:order";        // è®¢å•å­˜åœ¨æ€§
    
    // è®¡æ•°å™¨Key
    public static final String COUNTER_REQUEST = "wms:counter:request:"; // è¯·æ±‚è®¡æ•°
    public static final String COUNTER_ERROR = "wms:counter:error:";     // é”™è¯¯è®¡æ•°
}
```

##### ç¼“å­˜æ›´æ–°ç­–ç•¥

**1. Cache Asideæ¨¡å¼ï¼ˆä¸»è¦ä½¿ç”¨ï¼‰**ï¼š

```java
@Service
public class InventoryCacheService {
    
    /**
     * æŸ¥è¯¢åº“å­˜ï¼ˆCache Asideæ¨¡å¼ï¼‰
     */
    public Inventory getInventory(Long goodsId) {
        // 1. å…ˆæŸ¥L1ç¼“å­˜
        Inventory inventory = localCacheService.getInventory(goodsId);
        if (inventory != null) {
            return inventory;
        }
        
        // 2. å†æŸ¥L2ç¼“å­˜  
        inventory = redisCacheService.getInventory(goodsId);
        if (inventory != null) {
            // å¼‚æ­¥æ›´æ–°L1ç¼“å­˜
            localCacheService.setInventoryAsync(goodsId, inventory);
            return inventory;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        inventory = inventoryMapper.selectByGoodsId(goodsId);
        if (inventory != null) {
            // å¼‚æ­¥æ›´æ–°ç¼“å­˜
            CompletableFuture.runAsync(() -> {
                redisCacheService.setInventory(goodsId, inventory);
                localCacheService.setInventory(goodsId, inventory);
            });
        }
        
        return inventory;
    }
    
    /**
     * æ›´æ–°åº“å­˜ï¼ˆCache Asideæ¨¡å¼ï¼‰
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean updateInventory(Long goodsId, BigDecimal quantity) {
        // 1. å…ˆæ›´æ–°æ•°æ®åº“
        boolean updated = inventoryMapper.updateQuantity(goodsId, quantity) > 0;
        
        if (updated) {
            // 2. åˆ é™¤ç¼“å­˜ï¼Œè®©ä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡æ–°åŠ è½½
            redisCacheService.deleteInventory(goodsId);
            localCacheService.deleteInventory(goodsId);
            
            // 3. å‘é€ç¼“å­˜æ›´æ–°äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
            eventPublisher.publishEvent(new InventoryUpdatedEvent(goodsId));
        }
        
        return updated;
    }
}
```

**2. Write Throughæ¨¡å¼ï¼ˆå®æ—¶æ€§è¦æ±‚é«˜ï¼‰**ï¼š

```java
/**
 * åº“å­˜æ‰£å‡ - Write Throughæ¨¡å¼
 * ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„å¼ºä¸€è‡´æ€§
 */
@Transactional(rollbackFor = Exception.class)  
public boolean deductInventory(Long goodsId, BigDecimal quantity) {
    RLock lock = redissonClient.getLock("inventory:lock:" + goodsId);
    
    try {
        if (lock.tryLock(3, 10, TimeUnit.SECONDS)) {
            // 1. æŸ¥è¯¢æœ€æ–°åº“å­˜
            Inventory inventory = inventoryMapper.selectForUpdate(goodsId);
            
            // 2. æ£€æŸ¥åº“å­˜å……è¶³æ€§
            if (inventory.getAvailableQuantity().compareTo(quantity) < 0) {
                throw new BizException("åº“å­˜ä¸è¶³");
            }
            
            // 3. åŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜
            inventory.setQuantity(inventory.getQuantity().subtract(quantity));
            inventory.setVersion(inventory.getVersion() + 1);
            
            int updated = inventoryMapper.updateWithVersion(inventory);
            if (updated > 0) {
                // åŒæ­¥æ›´æ–°ç¼“å­˜
                redisCacheService.setInventory(goodsId, inventory);
                localCacheService.setInventory(goodsId, inventory);
                
                return true;
            }
        }
    } finally {
        if (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
    
    return false;
}
```

**3. Write Behindæ¨¡å¼ï¼ˆæ‰¹é‡æ›´æ–°ï¼‰**ï¼š

```java
/**
 * åº“å­˜æµæ°´å¼‚æ­¥æ‰¹é‡å†™å…¥
 */
@Component
public class InventoryLogWriteBehind {
    
    private final Queue<InventoryLog> writeQueue = new LinkedBlockingQueue<>(10000);
    
    @Scheduled(fixedDelay = 5000) // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡
    public void batchWrite() {
        List<InventoryLog> logs = new ArrayList<>();
        
        // æ‰¹é‡å–å‡ºå¾…å†™å…¥æ•°æ®
        while (!writeQueue.isEmpty() && logs.size() < 1000) {
            InventoryLog log = writeQueue.poll();
            if (log != null) {
                logs.add(log);
            }
        }
        
        if (!logs.isEmpty()) {
            try {
                // æ‰¹é‡æ’å…¥æ•°æ®åº“
                inventoryLogMapper.batchInsert(logs);
                log.info("æ‰¹é‡å†™å…¥åº“å­˜æµæ°´ {} æ¡", logs.size());
            } catch (Exception e) {
                log.error("æ‰¹é‡å†™å…¥åº“å­˜æµæ°´å¤±è´¥", e);
                // é‡æ–°æ”¾å›é˜Ÿåˆ—
                logs.forEach(writeQueue::offer);
            }
        }
    }
    
    public void addLog(InventoryLog inventoryLog) {
        if (!writeQueue.offer(inventoryLog)) {
            log.warn("å†™å…¥é˜Ÿåˆ—å·²æ»¡ï¼ŒåŒæ­¥å†™å…¥æ•°æ®åº“");
            inventoryLogMapper.insert(inventoryLog);
        }
    }
}
```

##### ç¼“å­˜ç›‘æ§ä¸è¿ç»´

```java
@Component  
public class CacheMonitor {
    
    @Autowired
    @Qualifier("goodsCache")
    private Cache<Long, Goods> goodsCache;
    
    /**
     * ç¼“å­˜ç»Ÿè®¡æŒ‡æ ‡
     */
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡
    public void collectCacheStats() {
        CacheStats stats = goodsCache.stats();
        
        // è®°å½•å…³é”®æŒ‡æ ‡
        log.info("å•†å“ç¼“å­˜ç»Ÿè®¡ - å‘½ä¸­ç‡: {}, åŠ è½½æ¬¡æ•°: {}, é©±é€æ¬¡æ•°: {}, å¹³å‡åŠ è½½æ—¶é—´: {}ms",
            String.format("%.2f%%", stats.hitRate() * 100),
            stats.loadCount(),
            stats.evictionCount(), 
            String.format("%.2f", stats.averageLoadPenalty() / 1_000_000.0)
        );
        
        // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
        metricsService.recordCacheHitRate("goods_cache", stats.hitRate());
        metricsService.recordCacheLoadTime("goods_cache", stats.averageLoadPenalty());
    }
    
    /**
     * ç¼“å­˜å¥åº·æ£€æŸ¥
     */
    @EventListener
    public void onCacheLoadException(CacheLoadExceptionEvent event) {
        log.error("ç¼“å­˜åŠ è½½å¼‚å¸¸: key={}, cause={}", event.getKey(), event.getCause());
        
        // å‘é€å‘Šè­¦
        alertService.sendAlert("ç¼“å­˜åŠ è½½å¼‚å¸¸", 
            "Key: " + event.getKey() + ", Error: " + event.getCause().getMessage());
    }
}
```

#### 15.3.2 å®Œæ•´åˆ†åº“åˆ†è¡¨è®¾è®¡

##### åˆ†åº“åˆ†è¡¨æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        App1[WMSåº”ç”¨å®ä¾‹1]
        App2[WMSåº”ç”¨å®ä¾‹2]  
        App3[WMSåº”ç”¨å®ä¾‹3]
    end
    
    subgraph "åˆ†ç‰‡ä¸­é—´ä»¶"
        ShardingSphere[ShardingSphere-Proxy]
    end
    
    subgraph "ä¸»åº“é›†ç¾¤"
        subgraph "DB1: wms_db_001"
            M1[Master]
            S1[Slave1]
            S2[Slave2]
        end
        
        subgraph "DB2: wms_db_002"  
            M2[Master]
            S3[Slave3]
            S4[Slave4]
        end
        
        subgraph "DB3: wms_db_003"
            M3[Master] 
            S5[Slave5]
            S6[Slave6]
        end
    end
    
    App1 --> ShardingSphere
    App2 --> ShardingSphere
    App3 --> ShardingSphere
    
    ShardingSphere --> M1
    ShardingSphere --> M2
    ShardingSphere --> M3
    
    M1 --> S1
    M1 --> S2
    M2 --> S3
    M2 --> S4
    M3 --> S5
    M3 --> S6
```

##### åˆ†ç‰‡ç­–ç•¥è®¾è®¡

**1. åº“å­˜ç›¸å…³è¡¨ - æŒ‰ä»“åº“IDåˆ†ç‰‡**

```yaml
# ShardingSphereé…ç½®
dataSources:
  wms_db_001:
    url: jdbc:mysql://192.168.1.10:3306/wms_db_001
    username: wms_user
    password: wms_password
    
  wms_db_002:
    url: jdbc:mysql://192.168.1.11:3306/wms_db_002
    username: wms_user  
    password: wms_password
    
  wms_db_003:
    url: jdbc:mysql://192.168.1.12:3306/wms_db_003
    username: wms_user
    password: wms_password

shardingRule:
  tables:
    # åº“å­˜è¡¨åˆ†ç‰‡è§„åˆ™
    inventory:
      actualDataNodes: wms_db_00$->{1..3}.inventory_00$->{1..9}
      databaseStrategy:
        standard:
          shardingColumn: warehouse_id
          shardingAlgorithmName: warehouse_database_inline
      tableStrategy:
        standard:
          shardingColumn: goods_id  
          shardingAlgorithmName: goods_table_inline
          
    # åº“å­˜æµæ°´è¡¨åˆ†ç‰‡è§„åˆ™        
    inventory_log:
      actualDataNodes: wms_db_00$->{1..3}.inventory_log_$->{202501..202612}
      databaseStrategy:
        standard:
          shardingColumn: warehouse_id
          shardingAlgorithmName: warehouse_database_inline
      tableStrategy:
        standard:
          shardingColumn: create_time
          shardingAlgorithmName: log_table_time

shardingAlgorithms:
  # ä»“åº“ç»´åº¦åˆ†åº“ç®—æ³•
  warehouse_database_inline:
    type: INLINE
    props:
      algorithm-expression: wms_db_00$->{(warehouse_id % 3) + 1}
      
  # å•†å“ç»´åº¦åˆ†è¡¨ç®—æ³•  
  goods_table_inline:
    type: INLINE
    props:
      algorithm-expression: inventory_00$->{(goods_id % 9) + 1}
      
  # æ—¶é—´ç»´åº¦åˆ†è¡¨ç®—æ³•
  log_table_time:
    type: INLINE
    props:
      algorithm-expression: inventory_log_$->{create_time.format("yyyyMM")}
```

**2. è®¢å•ç›¸å…³è¡¨ - æŒ‰å®¢æˆ·IDåˆ†ç‰‡**

```sql
-- å‡ºåº“å•è¡¨åˆ†ç‰‡DDL
-- åˆ†åº“ï¼šæŒ‰customer_codeçš„hashå€¼åˆ†å¸ƒåˆ°3ä¸ªæ•°æ®åº“
-- åˆ†è¡¨ï¼šæŒ‰è®¢å•åˆ›å»ºæ—¶é—´æŒ‰æœˆåˆ†è¡¨

-- DB1: wms_db_001
CREATE TABLE outbound_order_202501 (
    id BIGINT(20) NOT NULL AUTO_INCREMENT,
    outbound_no VARCHAR(50) NOT NULL,
    warehouse_id BIGINT(20) NOT NULL,
    customer_code VARCHAR(50),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    -- å…¶ä»–å­—æ®µ...
    PRIMARY KEY (id),
    UNIQUE KEY uk_outbound_no (outbound_no),
    KEY idx_customer_time (customer_code, create_time),
    KEY idx_warehouse_status (warehouse_id, status)
) ENGINE=InnoDB PARTITION BY HASH(id % 8) PARTITIONS 8;

CREATE TABLE outbound_order_202502 (
    -- åŒä¸Šç»“æ„
) ENGINE=InnoDB PARTITION BY HASH(id % 8) PARTITIONS 8;

-- ç»§ç»­åˆ›å»ºå…¶ä»–æœˆä»½çš„åˆ†è¡¨...
```

**3. å®Œæ•´åˆ†ç‰‡è¡¨ç»“æ„**

```sql
-- ================================
-- åº“å­˜è¡¨åˆ†ç‰‡ (æŒ‰ä»“åº“IDåˆ†åº“ï¼ŒæŒ‰å•†å“IDåˆ†è¡¨)
-- ================================

-- wms_db_001.inventory_001 (ä»“åº“ID=1,4,7... å•†å“IDæœ«ä½=1,4,7)
CREATE TABLE inventory_001 (
    id BIGINT(20) NOT NULL AUTO_INCREMENT,
    warehouse_id BIGINT(20) NOT NULL COMMENT 'åˆ†åº“å­—æ®µ',
    goods_id BIGINT(20) NOT NULL COMMENT 'åˆ†è¡¨å­—æ®µ', 
    location_id BIGINT(20),
    batch_no VARCHAR(50),
    quantity DECIMAL(10,2) DEFAULT 0,
    lock_quantity DECIMAL(10,2) DEFAULT 0,
    available_quantity DECIMAL(10,2) GENERATED ALWAYS AS (quantity - lock_quantity),
    version INT DEFAULT 1 COMMENT 'ä¹è§‚é”ç‰ˆæœ¬å·',
    status TINYINT(4) DEFAULT 1,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    UNIQUE KEY uk_warehouse_goods_location (warehouse_id, goods_id, location_id),
    KEY idx_goods_warehouse (goods_id, warehouse_id),
    KEY idx_location_status (location_id, status),
    KEY idx_quantity (available_quantity),
    KEY idx_update_time (update_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜è¡¨åˆ†ç‰‡001';

-- wms_db_001.inventory_002 (ä»“åº“ID=1,4,7... å•†å“IDæœ«ä½=2,5,8) 
CREATE TABLE inventory_002 (
    -- åŒä¸Šç»“æ„
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜è¡¨åˆ†ç‰‡002';

-- ç»§ç»­åˆ›å»ºinventory_003åˆ°inventory_009...

-- ================================
-- åº“å­˜æµæ°´è¡¨åˆ†ç‰‡ (æŒ‰ä»“åº“IDåˆ†åº“ï¼ŒæŒ‰æ—¶é—´åˆ†è¡¨)  
-- ================================

-- wms_db_001.inventory_log_202501 (ä»“åº“ID=1,4,7... 2025å¹´1æœˆ)
CREATE TABLE inventory_log_202501 (
    id BIGINT(20) NOT NULL AUTO_INCREMENT,
    warehouse_id BIGINT(20) NOT NULL COMMENT 'åˆ†åº“å­—æ®µ',
    goods_id BIGINT(20) NOT NULL,
    location_id BIGINT(20),
    batch_no VARCHAR(50),
    operation_type VARCHAR(20) NOT NULL,
    quantity_before DECIMAL(10,2),
    quantity_change DECIMAL(10,2) NOT NULL,
    quantity_after DECIMAL(10,2),
    business_type VARCHAR(50),
    business_no VARCHAR(50),
    operator VARCHAR(50),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ†è¡¨å­—æ®µ',
    PRIMARY KEY (id),
    KEY idx_warehouse_goods_time (warehouse_id, goods_id, create_time),
    KEY idx_business (business_type, business_no),
    KEY idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜æµæ°´202501';

-- ================================  
-- å‡ºåº“å•è¡¨åˆ†ç‰‡ (æŒ‰å®¢æˆ·ç¼–ç åˆ†åº“ï¼ŒæŒ‰æ—¶é—´åˆ†è¡¨)
-- ================================

-- wms_db_001.outbound_order_202501 (å®¢æˆ·ç¼–ç hash=1,4,7... 2025å¹´1æœˆ)
CREATE TABLE outbound_order_202501 (
    id BIGINT(20) NOT NULL AUTO_INCREMENT,
    outbound_no VARCHAR(50) NOT NULL,
    warehouse_id BIGINT(20) NOT NULL,
    customer_code VARCHAR(50) COMMENT 'åˆ†åº“å­—æ®µ',
    customer_name VARCHAR(100),
    total_quantity DECIMAL(10,2) DEFAULT 0,
    status TINYINT(4) DEFAULT 1,
    priority TINYINT(4) DEFAULT 1,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ†è¡¨å­—æ®µ',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    UNIQUE KEY uk_outbound_no (outbound_no),
    KEY idx_customer_time (customer_code, create_time),
    KEY idx_warehouse_status (warehouse_id, status),
    KEY idx_status_priority_time (status, priority, create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‡ºåº“å•202501'
PARTITION BY HASH(id % 4) PARTITIONS 4;
```

##### åˆ†ç‰‡ä¸­é—´ä»¶é…ç½®

**ShardingSphere-JDBCé…ç½®**ï¼š

```java
@Configuration
public class ShardingDataSourceConfig {
    
    /**
     * é…ç½®åˆ†ç‰‡æ•°æ®æº
     */
    @Bean
    @Primary
    public DataSource shardingDataSource() throws SQLException {
        
        // é…ç½®çœŸå®æ•°æ®æº
        Map<String, DataSource> dataSourceMap = createDataSourceMap();
        
        // é…ç½®åˆ†ç‰‡è§„åˆ™
        ShardingRuleConfiguration shardingRuleConfig = createShardingRuleConfig();
        
        // é…ç½®å±æ€§
        Properties properties = new Properties();
        properties.setProperty("sql.show", "true");
        properties.setProperty("executor.size", "20");
        
        return ShardingDataSourceFactory.createDataSource(
            dataSourceMap, shardingRuleConfig, properties
        );
    }
    
    /**
     * åˆ›å»ºæ•°æ®æºæ˜ å°„
     */
    private Map<String, DataSource> createDataSourceMap() {
        Map<String, DataSource> dataSourceMap = new HashMap<>();
        
        // é…ç½®3ä¸ªåˆ†åº“æ•°æ®æº
        for (int i = 1; i <= 3; i++) {
            HikariDataSource dataSource = new HikariDataSource();
            dataSource.setJdbcUrl("jdbc:mysql://192.168.1." + (9 + i) + ":3306/wms_db_00" + i);
            dataSource.setUsername("wms_user");
            dataSource.setPassword("wms_password");
            dataSource.setMaximumPoolSize(20);
            dataSource.setMinimumIdle(5);
            dataSource.setConnectionTimeout(30000);
            
            dataSourceMap.put("wms_db_00" + i, dataSource);
        }
        
        return dataSourceMap;
    }
    
    /**
     * åˆ›å»ºåˆ†ç‰‡è§„åˆ™é…ç½®
     */
    private ShardingRuleConfiguration createShardingRuleConfig() {
        ShardingRuleConfiguration shardingRuleConfig = new ShardingRuleConfiguration();
        
        // åº“å­˜è¡¨åˆ†ç‰‡è§„åˆ™
        shardingRuleConfig.getTableRuleConfigs().add(createInventoryTableRule());
        
        // åº“å­˜æµæ°´è¡¨åˆ†ç‰‡è§„åˆ™  
        shardingRuleConfig.getTableRuleConfigs().add(createInventoryLogTableRule());
        
        // å‡ºåº“å•è¡¨åˆ†ç‰‡è§„åˆ™
        shardingRuleConfig.getTableRuleConfigs().add(createOutboundOrderTableRule());
        
        // é…ç½®åˆ†åº“ç­–ç•¥
        shardingRuleConfig.setDefaultDatabaseShardingStrategyConfig(
            new InlineShardingStrategyConfiguration("warehouse_id", 
                "wms_db_00$->{(warehouse_id % 3) + 1}")
        );
        
        return shardingRuleConfig;
    }
    
    /**
     * åº“å­˜è¡¨åˆ†ç‰‡è§„åˆ™
     */
    private TableRuleConfiguration createInventoryTableRule() {
        TableRuleConfiguration config = new TableRuleConfiguration();
        config.setLogicTable("inventory");
        config.setActualDataNodes("wms_db_00$->{1..3}.inventory_00$->{1..9}");
        
        // åˆ†åº“ç­–ç•¥ï¼šæŒ‰ä»“åº“ID
        config.setDatabaseShardingStrategyConfig(
            new InlineShardingStrategyConfiguration("warehouse_id",
                "wms_db_00$->{(warehouse_id % 3) + 1}")
        );
        
        // åˆ†è¡¨ç­–ç•¥ï¼šæŒ‰å•†å“ID  
        config.setTableShardingStrategyConfig(
            new InlineShardingStrategyConfiguration("goods_id",
                "inventory_00$->{(goods_id % 9) + 1}")
        );
        
        return config;
    }
    
    /**
     * è‡ªå®šä¹‰åˆ†ç‰‡ç®—æ³•
     */
    @Component
    public static class CustomShardingAlgorithm implements PreciseShardingAlgorithm<Date> {
        
        @Override
        public String doSharding(Collection<String> availableTargetNames, 
                                PreciseShardingValue<Date> shardingValue) {
            // æŒ‰æœˆåˆ†è¡¨
            String monthSuffix = new SimpleDateFormat("yyyyMM").format(shardingValue.getValue());
            
            for (String tableName : availableTargetNames) {
                if (tableName.endsWith(monthSuffix)) {
                    return tableName;
                }
            }
            
            throw new IllegalArgumentException("æœªæ‰¾åˆ°åŒ¹é…çš„åˆ†è¡¨: " + monthSuffix);
        }
    }
}
```

##### åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–

**1. å¸¦åˆ†ç‰‡é”®æŸ¥è¯¢ï¼ˆæœ€ä¼˜ï¼‰**ï¼š

```java
@Service
public class InventoryShardingService {
    
    /**
     * å•åˆ†ç‰‡æŸ¥è¯¢ - æ€§èƒ½æœ€ä¼˜
     * SQLåªä¼šè·¯ç”±åˆ°ä¸€ä¸ªåˆ†ç‰‡æ‰§è¡Œ
     */
    public Inventory getInventory(Long warehouseId, Long goodsId) {
        return inventoryMapper.selectByWarehouseAndGoods(warehouseId, goodsId);
    }
    
    /**
     * æ‰¹é‡æŸ¥è¯¢åŒä¸€åˆ†ç‰‡æ•°æ®
     */
    public List<Inventory> getInventoryByWarehouse(Long warehouseId, List<Long> goodsIds) {
        return inventoryMapper.selectByWarehouseAndGoodsList(warehouseId, goodsIds);
    }
    
    /**
     * èŒƒå›´æŸ¥è¯¢ï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰
     */
    public List<Inventory> getInventoryByQuantityRange(Long warehouseId, 
                                                      BigDecimal minQty, BigDecimal maxQty) {
        // å¸¦ä¸Šåˆ†åº“é”®ï¼Œé¿å…è·¨åº“æŸ¥è¯¢
        return inventoryMapper.selectByWarehouseAndQuantityRange(warehouseId, minQty, maxQty);
    }
}
```

**2. è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–**ï¼š

```java
/**
 * è·¨åˆ†ç‰‡èšåˆæŸ¥è¯¢ä¼˜åŒ–
 */
@Service
public class CrossShardQueryService {
    
    @Autowired
    private List<DataSource> shardDataSources;
    
    /**
     * å¹¶è¡Œè·¨åˆ†ç‰‡æŸ¥è¯¢
     */
    public Map<Long, BigDecimal> getTotalInventoryByGoods(Set<Long> goodsIds) {
        
        Map<Long, BigDecimal> result = new ConcurrentHashMap<>();
        
        // å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰åˆ†ç‰‡
        List<CompletableFuture<Void>> futures = shardDataSources.stream()
            .map(dataSource -> CompletableFuture.runAsync(() -> {
                try (Connection conn = dataSource.getConnection()) {
                    // åœ¨æ¯ä¸ªåˆ†ç‰‡ä¸Šæ‰§è¡ŒèšåˆæŸ¥è¯¢
                    String sql = "SELECT goods_id, SUM(quantity) as total_qty FROM inventory " +
                                "WHERE goods_id IN (" + 
                                goodsIds.stream().map(String::valueOf).collect(Collectors.joining(",")) + 
                                ") GROUP BY goods_id";
                                
                    try (PreparedStatement ps = conn.prepareStatement(sql);
                         ResultSet rs = ps.executeQuery()) {
                        
                        while (rs.next()) {
                            Long goodsId = rs.getLong("goods_id");  
                            BigDecimal qty = rs.getBigDecimal("total_qty");
                            
                            result.merge(goodsId, qty, BigDecimal::add);
                        }
                    }
                } catch (SQLException e) {
                    log.error("è·¨åˆ†ç‰‡æŸ¥è¯¢å¤±è´¥", e);
                }
            }))
            .collect(Collectors.toList());
        
        // ç­‰å¾…æ‰€æœ‰æŸ¥è¯¢å®Œæˆ
        CompletableFuture.allOf(futures.toArray(new CompletableFuture[0])).join();
        
        return result;
    }
}
```

##### åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†

```java
/**
 * è·¨åˆ†ç‰‡äº‹åŠ¡å¤„ç†
 */
@Service
public class CrossShardTransactionService {
    
    @Autowired
    private DataSourceTransactionManager transactionManager;
    
    /**
     * æ‰‹åŠ¨ç®¡ç†è·¨åˆ†ç‰‡äº‹åŠ¡
     */
    public boolean transferInventory(Long fromWarehouseId, Long toWarehouseId, 
                                   Long goodsId, BigDecimal quantity) {
        
        // åˆ¤æ–­æ˜¯å¦è·¨åˆ†ç‰‡
        boolean crossShard = (fromWarehouseId % 3) != (toWarehouseId % 3);
        
        if (!crossShard) {
            // åŒåˆ†ç‰‡äº‹åŠ¡ï¼Œä½¿ç”¨æœ¬åœ°äº‹åŠ¡
            return transferWithinShard(fromWarehouseId, toWarehouseId, goodsId, quantity);
        } else {
            // è·¨åˆ†ç‰‡äº‹åŠ¡ï¼Œä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡
            return transferAcrossShards(fromWarehouseId, toWarehouseId, goodsId, quantity);
        }
    }
    
    @Transactional(rollbackFor = Exception.class)
    private boolean transferWithinShard(Long fromWarehouseId, Long toWarehouseId,
                                      Long goodsId, BigDecimal quantity) {
        // åŒä¸€åˆ†ç‰‡å†…çš„è½¬ç§»ï¼Œä½¿ç”¨æœ¬åœ°äº‹åŠ¡
        boolean deducted = inventoryService.deductInventory(fromWarehouseId, goodsId, quantity);
        if (deducted) {
            return inventoryService.addInventory(toWarehouseId, goodsId, quantity);
        }
        return false;
    }
    
    private boolean transferAcrossShards(Long fromWarehouseId, Long toWarehouseId,
                                       Long goodsId, BigDecimal quantity) {
        // è·¨åˆ†ç‰‡è½¬ç§»ï¼Œä½¿ç”¨Sagaæ¨¡å¼
        TransferSaga saga = TransferSaga.builder()
            .fromWarehouseId(fromWarehouseId)
            .toWarehouseId(toWarehouseId)
            .goodsId(goodsId)
            .quantity(quantity)
            .build();
            
        return sagaManager.execute(saga);
    }
}
```

##### åˆ†ç‰‡è¿ç»´å·¥å…·

```java
/**
 * åˆ†ç‰‡è¿ç»´å·¥å…·
 */
@Component
public class ShardingMaintenanceService {
    
    /**
     * æ•°æ®è¿ç§» - æ‰©å®¹æ—¶ä½¿ç”¨
     */
    public void migrateData(String sourceTable, String targetTable, 
                           Date startDate, Date endDate) {
        log.info("å¼€å§‹æ•°æ®è¿ç§»: {} -> {}, æ—¶é—´èŒƒå›´: {} - {}", 
                sourceTable, targetTable, startDate, endDate);
        
        String sql = "INSERT INTO " + targetTable + 
                    " SELECT * FROM " + sourceTable + 
                    " WHERE create_time BETWEEN ? AND ?";
                    
        try (Connection conn = dataSource.getConnection();
             PreparedStatement ps = conn.prepareStatement(sql)) {
            
            ps.setTimestamp(1, new Timestamp(startDate.getTime()));
            ps.setTimestamp(2, new Timestamp(endDate.getTime()));
            
            int rows = ps.executeUpdate();
            log.info("æ•°æ®è¿ç§»å®Œæˆï¼Œè¿ç§»è®°å½•æ•°: {}", rows);
            
        } catch (SQLException e) {
            log.error("æ•°æ®è¿ç§»å¤±è´¥", e);
            throw new RuntimeException("æ•°æ®è¿ç§»å¤±è´¥", e);
        }
    }
    
    /**
     * åˆ†ç‰‡æ•°æ®ç»Ÿè®¡
     */
    public Map<String, Long> getShardStatistics() {
        Map<String, Long> stats = new HashMap<>();
        
        // ç»Ÿè®¡æ¯ä¸ªåˆ†ç‰‡çš„æ•°æ®é‡
        for (String tableName : Arrays.asList("inventory", "inventory_log", "outbound_order")) {
            for (int i = 1; i <= 3; i++) {
                String dbName = "wms_db_00" + i;
                Long count = getTableRowCount(dbName, tableName);
                stats.put(dbName + "." + tableName, count);
            }
        }
        
        return stats;
    }
    
    /**
     * åˆ†ç‰‡å¥åº·æ£€æŸ¥
     */
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void healthCheck() {
        for (int i = 1; i <= 3; i++) {
            String dbName = "wms_db_00" + i;
            
            try {
                DataSource ds = getDataSourceByName(dbName);
                try (Connection conn = ds.getConnection()) {
                    // æ‰§è¡Œç®€å•æŸ¥è¯¢éªŒè¯è¿é€šæ€§
                    conn.createStatement().execute("SELECT 1");
                    log.debug("åˆ†ç‰‡å¥åº·æ£€æŸ¥é€šè¿‡: {}", dbName);
                }
            } catch (SQLException e) {
                log.error("åˆ†ç‰‡å¥åº·æ£€æŸ¥å¤±è´¥: {}", dbName, e);
                // å‘é€å‘Šè­¦
                alertService.sendAlert("åˆ†ç‰‡å¼‚å¸¸", "åˆ†ç‰‡ " + dbName + " è¿æ¥å¤±è´¥");
            }
        }
    }
}
```

---

## åå…­ã€é¢è¯•å‡†å¤‡æŒ‡å—

### 16.1 å®Œæ•´é¢è¯•å›ç­”å®ä¾‹

#### 16.1.1 é«˜å¹¶å‘åº“å­˜æ‰£å‡é—®é¢˜

**é¢è¯•å®˜**ï¼š"ä½ ä»¬é¡¹ç›®é‡åˆ°è¿‡ä»€ä¹ˆæŠ€æœ¯éš¾ç‚¹ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"æˆ‘ä»¬åœ¨å¼€å‘WMSä»“åº“ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªå…¸å‹çš„ç”µå•†é«˜å¹¶å‘åœºæ™¯é—®é¢˜ã€‚åœ¨åŒ11è¿™ç§å¤§ä¿ƒæœŸé—´ï¼Œå¯èƒ½æœ‰æ•°åƒä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•è´­ä¹°åŒä¸€ä¸ªçƒ­é—¨å•†å“ï¼Œå¦‚æœå¤„ç†ä¸å½“å°±ä¼šå‡ºç°è¶…å–ç°è±¡ï¼Œæ¯”å¦‚åº“å­˜åªæœ‰100ä»¶ï¼Œä½†æ˜¯å–å‡ºäº†120ä»¶ã€‚

è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚ä¸»è¦åŸå› åŒ…æ‹¬ï¼šé¦–å…ˆæ˜¯å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œå¤šä¸ªæœåŠ¡å®ä¾‹åŒæ—¶è¯»å–åº“å­˜éƒ½æ˜¯100ï¼Œç„¶åå„è‡ªå‡1ï¼Œæœ€ç»ˆåº“å­˜å˜æˆ99è€Œä¸æ˜¯98ï¼›å…¶æ¬¡æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œä¼ ç»Ÿçš„æ•°æ®åº“é”åœ¨é«˜å¹¶å‘æ—¶ä¼šæˆä¸ºç“¶é¢ˆï¼›ç¬¬ä¸‰æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§ï¼Œå¾®æœåŠ¡æ¶æ„ä¸‹å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚

æˆ‘ä»¬æœ€ç»ˆé‡‡ç”¨äº†ä¸‰é‡ä¿éšœæœºåˆ¶æ¥è§£å†³ï¼š

ç¬¬ä¸€å±‚æ˜¯Redisåˆ†å¸ƒå¼é”ï¼Œä½¿ç”¨Redissonå®ç°ï¼ŒæŒ‰å•†å“IDä½œä¸ºé”çš„keyï¼Œæ¯”å¦‚'inventory:lock:å•†å“ID'ï¼Œè¿™æ ·ä¸åŒå•†å“å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œç›¸åŒå•†å“ä¸²è¡Œå¤„ç†ã€‚æˆ‘ä»¬è®¾ç½®3ç§’çš„è·é”è¶…æ—¶å’Œ10ç§’çš„é”å®šæ—¶é•¿ã€‚

ç¬¬äºŒå±‚æ˜¯æ•°æ®åº“è¡Œé”ï¼Œä½¿ç”¨SELECT FOR UPDATEæ¥é”å®šåº“å­˜è®°å½•ï¼Œä¿è¯åœ¨å•ä¸ªæ•°æ®åº“å®ä¾‹å†…çš„å¹¶å‘å®‰å…¨ã€‚

ç¬¬ä¸‰å±‚æ˜¯ä¹è§‚é”ï¼Œåœ¨åº“å­˜è¡¨å¢åŠ versionå­—æ®µï¼Œæ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦å˜åŒ–ï¼Œä½œä¸ºå…œåº•æœºåˆ¶ã€‚

å…·ä½“çš„ä»£ç å®ç°æ˜¯è¿™æ ·çš„ï¼šå…ˆå°è¯•è·å–åˆ†å¸ƒå¼é”ï¼Œè·å–æˆåŠŸåæŸ¥è¯¢åº“å­˜å¹¶åŠ è¡Œé”ï¼Œæ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³ï¼Œç„¶åç”¨ä¹è§‚é”æ–¹å¼æ›´æ–°åº“å­˜ï¼Œæœ€åå¼‚æ­¥è®°å½•åº“å­˜æµæ°´ï¼Œå¹¶æ¸…é™¤Redisç¼“å­˜ã€‚

è¿™å¥—æ–¹æ¡ˆä¸Šçº¿åï¼Œæˆ‘ä»¬çš„å‹æµ‹æ•°æ®æ˜¾ç¤ºï¼šå¹¶å‘å¤„ç†èƒ½åŠ›è¾¾åˆ°10000+QPSï¼Œå®Œå…¨æœç»äº†è¶…å–ç°è±¡ï¼ŒP99å“åº”æ—¶é—´æ§åˆ¶åœ¨100msä»¥å†…ã€‚åœ¨å»å¹´åŒ11æœŸé—´ï¼Œç³»ç»Ÿå¤„ç†äº†è¶…è¿‡500ä¸‡ç¬”è®¢å•ï¼Œæ²¡æœ‰å‡ºç°ä»»ä½•åº“å­˜å¼‚å¸¸ã€‚"

#### 16.1.2 æ‹£è´§è·¯å¾„ä¼˜åŒ–é—®é¢˜

**é¢è¯•å®˜**ï¼š"è¿˜æœ‰å…¶ä»–æŠ€æœ¯éš¾ç‚¹å—ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"å¦ä¸€ä¸ªæ¯”è¾ƒæœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜æ˜¯æ‹£è´§è·¯å¾„ä¼˜åŒ–ã€‚ä¼ ç»Ÿä»“åº“çš„æ‹£è´§å‘˜å¾€å¾€æ˜¯æ‹¿ç€çº¸è´¨æ‹£è´§å•ï¼ŒæŒ‰ç…§ç›´è§‰æˆ–ç»éªŒæ¥è§„åˆ’è·¯å¾„ï¼Œè¿™æ ·æ•ˆç‡å¾ˆä½ã€‚æˆ‘ä»¬ä»“åº“æœ‰3000å¤šä¸ªåº“ä½ï¼Œä¸€ä¸ªæ‹£è´§ä»»åŠ¡å¯èƒ½æ¶‰åŠ30-50ä¸ªåº“ä½ï¼Œå¦‚ä½•ä¸ºæ‹£è´§å‘˜è§„åˆ’æœ€çŸ­è·¯å¾„æ˜¯ä¸ªå…¸å‹çš„ç®—æ³•é—®é¢˜ã€‚

ä»ç®—æ³•è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯æ—…è¡Œå•†é—®é¢˜TSPçš„å˜ç§ã€‚å¦‚æœç”¨æš´åŠ›æšä¸¾ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n!)ï¼Œ30ä¸ªåº“ä½å°±éœ€è¦è®¡ç®—30çš„é˜¶ä¹˜ç§å¯èƒ½ï¼Œå®Œå…¨ä¸ç°å®ã€‚åŠ¨æ€è§„åˆ’è™½ç„¶èƒ½å¾—åˆ°æœ€ä¼˜è§£ï¼Œä½†æ—¶é—´å¤æ‚åº¦æ˜¯O(nÂ²Ã—2â¿)ï¼Œå¯¹äºå®æ—¶æ‹£è´§ä»»åŠ¡æ¥è¯´å¤ªæ…¢äº†ã€‚

æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº†æ”¹è¿›çš„è´ªå¿ƒç®—æ³•ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼šä»åº“åŒºå…¥å£å¼€å§‹ï¼Œæ¯æ¬¡éƒ½é€‰æ‹©è·ç¦»å½“å‰ä½ç½®æœ€è¿‘ä¸”è¿˜æ²¡è®¿é—®è¿‡çš„åº“ä½ã€‚ä½†ä»“åº“ä¸æ˜¯å¼€é˜”åœ°å¸¦ï¼Œè€Œæ˜¯æœ‰é€šé“é™åˆ¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨æ›¼å“ˆé¡¿è·ç¦»è€Œä¸æ˜¯æ¬§å¼è·ç¦»æ¥è®¡ç®—ï¼Œå…¬å¼æ˜¯æ¨ªå‘è·ç¦»+çºµå‘è·ç¦»+å±‚é—´è·ç¦»Ã—2ï¼Œå±‚é—´è·ç¦»æƒé‡æ›´é«˜æ˜¯å› ä¸ºä¸Šä¸‹æ¥¼æ¢¯æ¯”æ°´å¹³ç§»åŠ¨æ›´è´¹æ—¶ã€‚

ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œæˆ‘ä»¬è¿˜åŠ å…¥äº†2-optç®—æ³•æ¥æ¶ˆé™¤è·¯å¾„äº¤å‰ã€‚å°±æ˜¯æ£€æŸ¥è·¯å¾„ä¸­æ˜¯å¦æœ‰äº¤å‰ç‚¹ï¼Œå¦‚æœæŠŠä¸¤æ¡è¾¹æ¢ä¸€ä¸‹èƒ½è®©æ€»è·ç¦»æ›´çŸ­ï¼Œå°±æ‰§è¡Œè¿™ä¸ªäº¤æ¢ã€‚

è¿™å¥—ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nÂ²)ï¼Œå¯¹äº50ä¸ªåº“ä½çš„è®¡ç®—æ—¶é—´åœ¨10æ¯«ç§’ä»¥å†…ï¼Œå®Œå…¨æ»¡è¶³å®æ—¶æ€§è¦æ±‚ã€‚

ä¸Šçº¿åçš„æ•ˆæœéå¸¸æ˜æ˜¾ï¼šå¹³å‡æ‹£è´§è·¯å¾„ä»450ç±³ç¼©çŸ­åˆ°280ç±³ï¼Œä¸‹é™äº†38%ï¼›æ‹£è´§æ—¶é—´ä»25åˆ†é’Ÿå‡å°‘åˆ°16åˆ†é’Ÿï¼›æ‹£è´§å‘˜çš„æ—¥äº§èƒ½ä»180å•æå‡åˆ°280å•ï¼Œæ•´æ•´æé«˜äº†56%ã€‚æˆ‘ä»¬è¿˜åšäº†A/Bæµ‹è¯•ï¼Œä½¿ç”¨ä¼˜åŒ–ç®—æ³•çš„æ‹£è´§å‘˜æ¯”ä¸ä½¿ç”¨çš„æ•ˆç‡å¹³å‡é«˜å‡ºä¸€å€ä»¥ä¸Šã€‚"

#### 16.1.3 å¾®æœåŠ¡æ¶æ„è®¾è®¡é—®é¢˜

**é¢è¯•å®˜**ï¼š"ä¸ºä»€ä¹ˆè¦ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ€ä¹ˆè§£å†³æœåŠ¡é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"æˆ‘ä»¬é€‰æ‹©å¾®æœåŠ¡æ¶æ„ä¸»è¦åŸºäºä¸‰ä¸ªè€ƒè™‘ï¼š

é¦–å…ˆæ˜¯ä¸šåŠ¡å¤æ‚åº¦ã€‚WMSç³»ç»Ÿæ¶‰åŠå…¥åº“ã€å‡ºåº“ã€æ‹£è´§ã€ç›˜ç‚¹ç­‰å¤šä¸ªä¸šåŠ¡åŸŸï¼Œæ¯ä¸ªåŸŸçš„é€»è¾‘éƒ½å¾ˆå¤æ‚ï¼Œå¦‚æœåšæˆå•ä½“åº”ç”¨ï¼Œä»£ç è€¦åˆä¸¥é‡ï¼Œç»´æŠ¤å›°éš¾ã€‚æ‹†åˆ†æˆå¾®æœåŠ¡åï¼Œæ¯ä¸ªæœåŠ¡ä¸“æ³¨è‡ªå·±çš„ä¸šåŠ¡é¢†åŸŸï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚

å…¶æ¬¡æ˜¯å›¢é˜Ÿåä½œã€‚æˆ‘ä»¬æœ‰6ä¸ªå¼€å‘äººå‘˜ï¼ŒæŒ‰ä¸šåŠ¡åŸŸåˆ†æˆ3ä¸ªå°ç»„ï¼Œæ¯ç»„è´Ÿè´£2ä¸ªæœåŠ¡ã€‚å¾®æœåŠ¡è®©å„ç»„å¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ï¼Œå¤§å¤§æé«˜äº†å¹¶è¡Œå¼€å‘æ•ˆç‡ã€‚

ç¬¬ä¸‰æ˜¯æŠ€æœ¯é€‰å‹çµæ´»æ€§ã€‚æ¯”å¦‚æŠ¥è¡¨æœåŠ¡éœ€è¦å¤æ‚çš„æ•°æ®åˆ†æï¼Œæˆ‘ä»¬ç”¨äº†ElasticSearchï¼›æ‹£è´§æœåŠ¡éœ€è¦åœ°ç†ä½ç½®è®¡ç®—ï¼Œæˆ‘ä»¬é›†æˆäº†ä¸“é—¨çš„ç®—æ³•åº“ã€‚å•ä½“åº”ç”¨å¾ˆéš¾åšåˆ°è¿™ç§æŠ€æœ¯å¼‚æ„ã€‚

å…³äºæ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†åˆ†é˜¶æ®µçš„ç­–ç•¥ï¼š

å¯¹äºå¼ºä¸€è‡´æ€§è¦æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚åº“å­˜æ‰£å‡ï¼Œæˆ‘ä»¬ç”¨åˆ†å¸ƒå¼é”æ¥ä¿è¯ã€‚

å¯¹äºæœ€ç»ˆä¸€è‡´æ€§å¯ä»¥æ¥å—çš„åœºæ™¯ï¼Œæ¯”å¦‚å‡ºåº“æµç¨‹ï¼Œæˆ‘ä»¬ç”¨Sagaæ¨¡å¼ã€‚æ•´ä¸ªæµç¨‹æ¶‰åŠ4ä¸ªæ­¥éª¤ï¼šé”å®šåº“å­˜ã€æ›´æ–°è®¢å•çŠ¶æ€ã€åˆ›å»ºè¿å•ã€è®°å½•æˆæœ¬ã€‚æ¯ä¸ªæ­¥éª¤éƒ½å®šä¹‰äº†è¡¥å¿æ“ä½œï¼Œå¦‚æœæŸä¸€æ­¥å¤±è´¥ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œå‰é¢æ‰€æœ‰æ­¥éª¤çš„è¡¥å¿æ“ä½œæ¥å›æ»šã€‚

æ¯”å¦‚é”å®šåº“å­˜æˆåŠŸäº†ï¼Œä½†åˆ›å»ºè¿å•å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ‰§è¡Œè§£é”åº“å­˜å’Œæ¢å¤è®¢å•çŠ¶æ€çš„è¡¥å¿æ“ä½œã€‚

æˆ‘ä»¬è¿˜å¤§é‡ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°å¼‚æ­¥è§£è€¦ã€‚æ¯”å¦‚åº“å­˜å˜æ›´åï¼Œä¼šå‘MQæ¶ˆæ¯é€šçŸ¥æŠ¥è¡¨æœåŠ¡æ›´æ–°ç»Ÿè®¡æ•°æ®ï¼Œé€šçŸ¥é¢„è­¦æœåŠ¡æ£€æŸ¥å®‰å…¨åº“å­˜ç­‰ã€‚è¿™æ ·æ—¢ä¿è¯äº†æ•°æ®æœ€ç»ˆä¸€è‡´ï¼Œåˆé¿å…äº†åŒæ­¥è°ƒç”¨çš„æ€§èƒ½é—®é¢˜ã€‚

æ•´ä¸ªæ¶æ„ä¸Šçº¿ä¸€å¹´å¤šï¼Œç³»ç»Ÿå¯ç”¨æ€§è¾¾åˆ°99.9%ä»¥ä¸Šï¼Œå•ä¸ªæœåŠ¡çš„æ•…éšœä¸ä¼šå½±å“æ•´ä½“ä¸šåŠ¡ï¼Œæ‰©å®¹ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚"

### 16.2 é‡ç‚¹å‡†å¤‡è¯é¢˜

#### 16.2.1 æ€§èƒ½ä¼˜åŒ–é—®é¢˜

**é¢è¯•å®˜**ï¼š"ç³»ç»Ÿçš„æ€§èƒ½æ€ä¹ˆæ ·ï¼Ÿä½ ä»¬æ˜¯æ€ä¹ˆåšæ€§èƒ½ä¼˜åŒ–çš„ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"æˆ‘ä»¬çš„WMSç³»ç»Ÿæ‰¿è½½ç€æ¯å¤©å‡ åä¸‡ç¬”ä¸šåŠ¡æ“ä½œï¼Œæ€§èƒ½è¦æ±‚å¾ˆé«˜ã€‚æˆ‘ä¸»è¦ä»å››ä¸ªæ–¹é¢åšäº†ä¼˜åŒ–ï¼š

**ç¼“å­˜ä¼˜åŒ–**ï¼šæˆ‘ä»¬è®¾è®¡äº†ä¸‰çº§ç¼“å­˜æ¶æ„ã€‚L1æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œç”¨Caffeineå®ç°ï¼Œä¸»è¦ç¼“å­˜å•†å“åŸºç¡€ä¿¡æ¯è¿™ç§å‡ ä¹ä¸å˜çš„æ•°æ®ï¼›L2æ˜¯Redisåˆ†å¸ƒå¼ç¼“å­˜ï¼Œç¼“å­˜åº“å­˜æ•°æ®è¿™ç§ä¼šå˜ä½†ä¸æ˜¯å®æ—¶å˜åŒ–çš„æ•°æ®ï¼›L3æ˜¯æ•°æ®åº“ç¼“å­˜ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯çƒ­ç‚¹æ•°æ®å¯ä»¥å°±è¿‘è·å–ï¼Œå¤§å¤§å‡å°‘ç½‘ç»œå¼€é”€ã€‚

**æ•°æ®åº“ä¼˜åŒ–**ï¼šé¦–å…ˆæ˜¯åˆ†åº“åˆ†è¡¨ï¼Œåº“å­˜è¡¨æŒ‰ä»“åº“IDåˆ†ç‰‡ï¼Œåº“å­˜æµæ°´è¡¨æŒ‰æ—¶é—´åˆ†ç‰‡ã€‚å…¶æ¬¡æ˜¯ç´¢å¼•ä¼˜åŒ–ï¼Œæ¯”å¦‚åº“å­˜æŸ¥è¯¢ç»å¸¸æŒ‰å•†å“IDå’Œåº“ä½IDæŸ¥ï¼Œæˆ‘ä»¬å»ºäº†è”åˆç´¢å¼•ã€‚è¿˜æœ‰å°±æ˜¯è¯»å†™åˆ†ç¦»ï¼ŒæŠ¥è¡¨æŸ¥è¯¢èµ°ä»åº“ï¼Œä¸šåŠ¡æ“ä½œèµ°ä¸»åº“ã€‚

**å¼‚æ­¥å¤„ç†**ï¼šåƒåº“å­˜æµæ°´è®°å½•ã€æŠ¥è¡¨ç»Ÿè®¡æ›´æ–°è¿™äº›ä¸å½±å“ä¸»æµç¨‹çš„æ“ä½œï¼Œæˆ‘ä»¬éƒ½æ”¹æˆäº†å¼‚æ­¥å¤„ç†ã€‚ä½¿ç”¨RocketMQæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ—¢æé«˜äº†å“åº”é€Ÿåº¦ï¼Œä¹Ÿæé«˜äº†ç³»ç»Ÿçš„è§£è€¦æ€§ã€‚

**è¿æ¥æ± ä¼˜åŒ–**ï¼šæ•°æ®åº“è¿æ¥æ± ã€Redisè¿æ¥æ± éƒ½åšäº†ç²¾ç»†åŒ–é…ç½®ã€‚æ•°æ®åº“è¿æ¥æ± æˆ‘ä»¬è®¾ç½®äº†20ä¸ªæ ¸å¿ƒè¿æ¥ï¼Œæœ€å¤§50ä¸ªè¿æ¥ï¼Œæ ¹æ®ä¸šåŠ¡é«˜å³°æœŸçš„å¹¶å‘é‡è®¡ç®—å‡ºæ¥çš„ã€‚

ä¼˜åŒ–åçš„æ•ˆæœå¾ˆæ˜æ˜¾ï¼šåº“å­˜æŸ¥è¯¢æ¥å£çš„P99å“åº”æ—¶é—´ä»300msé™åˆ°50msï¼Œåº“å­˜æ‰£å‡æ¥å£æ”¯æŒ10000+QPSï¼Œæ•´ä½“ç³»ç»Ÿååé‡æå‡äº†3å€ã€‚åœ¨å»å¹´åŒ11å‹æµ‹ä¸­ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†100ä¸‡å¹¶å‘ç”¨æˆ·ï¼Œç³»ç»Ÿè¡¨ç°éå¸¸ç¨³å®šã€‚"

#### 16.2.2 å¼‚å¸¸å¤„ç†ä¸ç›‘æ§

**é¢è¯•å®˜**ï¼š"ç³»ç»Ÿå‡ºç°å¼‚å¸¸æ€ä¹ˆå¤„ç†ï¼Ÿä½ ä»¬çš„ç›‘æ§æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"å¼‚å¸¸å¤„ç†æˆ‘ä»¬åˆ†ä¸ºä¸šåŠ¡å¼‚å¸¸å’ŒæŠ€æœ¯å¼‚å¸¸ä¸¤ç±»ï¼š

**ä¸šåŠ¡å¼‚å¸¸å¤„ç†**ï¼šæ¯”å¦‚æ‹£è´§æ—¶å‘ç°åº“ä½ç©ºç¼ºï¼Œæˆ‘ä»¬è®¾è®¡äº†è‡ªåŠ¨æ¢å¤æœºåˆ¶ã€‚ç³»ç»Ÿä¼šå…ˆæŸ¥æ‰¾åŒæ‰¹æ¬¡çš„å…¶ä»–åº“ä½ï¼Œå¦‚æœæ‰¾åˆ°å°±è‡ªåŠ¨åˆ‡æ¢è¿‡å»ï¼›å¦‚æœæ‰¾ä¸åˆ°å°±è½¬äººå·¥å¤„ç†ï¼ŒåŒæ—¶è§¦å‘ç´§æ€¥ç›˜ç‚¹ä»»åŠ¡ã€‚è¿™æ ·æ—¢ä¿è¯äº†ä¸šåŠ¡è¿ç»­æ€§ï¼Œä¹ŸåŠæ—¶å‘ç°äº†æ•°æ®é—®é¢˜ã€‚

**æŠ€æœ¯å¼‚å¸¸å¤„ç†**ï¼šæˆ‘ä»¬ç”¨äº†ç†”æ–­é™çº§æœºåˆ¶ã€‚æ¯”å¦‚æŠ¥è¡¨æœåŠ¡å¦‚æœå“åº”è¶…æ—¶ï¼Œä¼šè‡ªåŠ¨ç†”æ–­ï¼Œè¿”å›ç¼“å­˜æ•°æ®æˆ–è€…é»˜è®¤æ•°æ®ï¼Œä¸ä¼šå½±å“æ ¸å¿ƒä¸šåŠ¡ã€‚ç”¨çš„æ˜¯Sentinelç»„ä»¶ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçš„ç†”æ–­ç­–ç•¥ã€‚

**ç›‘æ§ä½“ç³»**ï¼šæˆ‘ä»¬å»ºç«‹äº†ä¸‰å±‚ç›‘æ§ã€‚

ç¬¬ä¸€å±‚æ˜¯åŸºç¡€ç›‘æ§ï¼Œç”¨Prometheusæ”¶é›†CPUã€å†…å­˜ã€ç½‘ç»œç­‰æŒ‡æ ‡ï¼ŒGrafanaåšå¯è§†åŒ–å±•ç¤ºã€‚

ç¬¬äºŒå±‚æ˜¯åº”ç”¨ç›‘æ§ï¼Œç”¨SkyWalkingåšAPMï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªæ¥å£çš„è°ƒç”¨é“¾è·¯ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€‚ç‰¹åˆ«æ˜¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªè¯·æ±‚å¯èƒ½ç»è¿‡å¤šä¸ªæœåŠ¡ï¼ŒSkyWalkingèƒ½å®Œæ•´è¿˜åŸæ•´ä¸ªè°ƒç”¨è·¯å¾„ã€‚

ç¬¬ä¸‰å±‚æ˜¯ä¸šåŠ¡ç›‘æ§ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€äº›ä¸šåŠ¡æŒ‡æ ‡ï¼Œæ¯”å¦‚åº“å­˜å‡†ç¡®ç‡ã€æ‹£è´§æ•ˆç‡ã€è®¢å•å¤„ç†æ—¶æ•ˆç­‰ï¼Œè¿™äº›æŒ‡æ ‡ç›´æ¥åæ˜ ç³»ç»Ÿçš„ä¸šåŠ¡å¥åº·åº¦ã€‚

**å‘Šè­¦æœºåˆ¶**ï¼šè®¾ç½®äº†å¤šçº§å‘Šè­¦ï¼ŒP0çº§åˆ«æ˜¯å½±å“æ ¸å¿ƒä¸šåŠ¡çš„ï¼Œä¼šç«‹å³ç”µè¯é€šçŸ¥ï¼›P1çº§åˆ«æ˜¯æ€§èƒ½é—®é¢˜ï¼Œä¼šå‘çŸ­ä¿¡ï¼›P2çº§åˆ«æ˜¯ä¸€èˆ¬å¼‚å¸¸ï¼Œä¼šå‘é’‰é’‰æ¶ˆæ¯ã€‚æˆ‘ä»¬è¿˜å»ºç«‹äº†å€¼ç­åˆ¶åº¦ï¼Œç¡®ä¿24å°æ—¶æœ‰äººå“åº”ã€‚

å»å¹´ä¸€å¹´ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå¯ç”¨æ€§è¾¾åˆ°99.95%ï¼Œå¹³å‡æ•…éšœæ¢å¤æ—¶é—´MTTRæ§åˆ¶åœ¨15åˆ†é’Ÿä»¥å†…ã€‚"

#### 16.2.3 æ•°æ®ä¸€è‡´æ€§ä¿éšœ

**é¢è¯•å®˜**ï¼š"åˆ†å¸ƒå¼ç³»ç»Ÿæ€ä¹ˆä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"æ•°æ®ä¸€è‡´æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒæŒ‘æˆ˜ï¼Œæˆ‘ä»¬æ ¹æ®ä¸åŒåœºæ™¯é‡‡ç”¨äº†ä¸åŒç­–ç•¥ï¼š

**å¼ºä¸€è‡´æ€§åœºæ™¯**ï¼šæ¯”å¦‚åº“å­˜æ‰£å‡ï¼Œæˆ‘ä»¬ç”¨åˆ†å¸ƒå¼é”+æ•°æ®åº“äº‹åŠ¡æ¥ä¿è¯ã€‚å…·ä½“æµç¨‹æ˜¯å…ˆè·å–Redisåˆ†å¸ƒå¼é”ï¼Œç„¶ååœ¨æ•°æ®åº“äº‹åŠ¡å†…å®Œæˆåº“å­˜æ£€æŸ¥å’Œæ‰£å‡ï¼Œæœ€åé‡Šæ”¾é”ã€‚è¿™æ ·å¯ä»¥ä¿è¯ä»»ä½•æ—¶åˆ»åº“å­˜æ•°æ®éƒ½æ˜¯å‡†ç¡®çš„ã€‚

**æœ€ç»ˆä¸€è‡´æ€§åœºæ™¯**ï¼šæ¯”å¦‚å‡ºåº“æµç¨‹ï¼Œæ¶‰åŠåº“å­˜æœåŠ¡ã€è®¢å•æœåŠ¡ã€ç‰©æµæœåŠ¡ã€è´¢åŠ¡æœåŠ¡å››ä¸ªç³»ç»Ÿã€‚æˆ‘ä»¬ç”¨Sagaæ¨¡å¼æ¥å¤„ç†ï¼Œå®šä¹‰äº†å››ä¸ªæ­¥éª¤å’Œå¯¹åº”çš„è¡¥å¿æ“ä½œã€‚å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¡¥å¿æ“ä½œå›æ»šå‰é¢çš„æ­¥éª¤ã€‚

**å¼‚æ­¥ä¸€è‡´æ€§åœºæ™¯**ï¼šæ¯”å¦‚æŠ¥è¡¨ç»Ÿè®¡ï¼Œä¸è¦æ±‚å®æ—¶å‡†ç¡®ï¼Œæˆ‘ä»¬ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ã€‚åº“å­˜å‘ç”Ÿå˜åŒ–æ—¶å‘é€MQæ¶ˆæ¯ï¼ŒæŠ¥è¡¨æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯åæ›´æ–°ç»Ÿè®¡æ•°æ®ã€‚å³ä½¿æ¶ˆæ¯å»¶è¿Ÿæˆ–é‡å¤ï¼Œæœ€ç»ˆæ•°æ®éƒ½ä¼šæ˜¯ä¸€è‡´çš„ã€‚

**å¹‚ç­‰æ€§ä¿éšœ**ï¼šæ‰€æœ‰çš„å†™æ“ä½œéƒ½è®¾è®¡æˆå¹‚ç­‰çš„ï¼Œæ¯”å¦‚åº“å­˜æ‰£å‡æ“ä½œï¼Œæˆ‘ä»¬ä¼šè®°å½•æ“ä½œæµæ°´å·ï¼ŒåŒä¸€ä¸ªæµæ°´å·çš„æ“ä½œåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚è¿™æ ·å³ä½¿ç½‘ç»œé‡è¯•ä¹Ÿä¸ä¼šé€ æˆæ•°æ®é”™è¯¯ã€‚

**æ•°æ®å¯¹è´¦æœºåˆ¶**ï¼šæˆ‘ä»¬æ¯å¤©å‡Œæ™¨ä¼šåšå…¨é‡æ•°æ®å¯¹è´¦ï¼Œæ¯”è¾ƒç³»ç»Ÿåº“å­˜å’Œå®é™…ç›˜ç‚¹æ•°æ®ï¼Œå‘ç°å·®å¼‚ä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚è¿˜ä¼šå®šæœŸåšä¸šåŠ¡æ•°æ®çš„äº¤å‰éªŒè¯ï¼Œæ¯”å¦‚åº“å­˜å˜æ›´æ€»é‡åº”è¯¥ç­‰äºå…¥åº“æ€»é‡å‡å»å‡ºåº“æ€»é‡ã€‚

é€šè¿‡è¿™å¥—æœºåˆ¶ï¼Œæˆ‘ä»¬çš„æ•°æ®å‡†ç¡®ç‡è¾¾åˆ°99.9%ä»¥ä¸Šï¼Œå³ä½¿åœ¨ç½‘ç»œå¼‚å¸¸æˆ–æœåŠ¡æ•…éšœçš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„é—®é¢˜ã€‚"

### 16.3 é¡¹ç›®æ ¸å¿ƒä»·å€¼ä¸æˆæœ

**é¢è¯•å®˜**ï¼š"è¿™ä¸ªé¡¹ç›®æœ€ç»ˆå¸¦æ¥äº†ä»€ä¹ˆä»·å€¼ï¼Ÿ"

**å®Œæ•´å›ç­”**ï¼š

"æˆ‘ä»¬çš„WMSç³»ç»Ÿä¸Šçº¿åï¼Œç»™å…¬å¸å¸¦æ¥äº†æ˜¾è‘—çš„ä¸šåŠ¡ä»·å€¼ï¼š

**è¿è¥æ•ˆç‡æå‡**ï¼š
- æ‹£è´§æ•ˆç‡æé«˜56%ï¼ŒåŸæ¥æ‹£è´§å‘˜ä¸€å¤©å¤„ç†180å•ï¼Œç°åœ¨èƒ½å¤„ç†280å•
- åº“å­˜å‡†ç¡®ç‡è¾¾åˆ°99.9%ï¼ŒåŸºæœ¬æ¶ˆé™¤äº†äººå·¥ç›˜ç‚¹çš„å·¥ä½œé‡
- è®¢å•å¤„ç†æ—¶æ•ˆæå‡35%ï¼Œå®¢æˆ·æ»¡æ„åº¦æ˜æ˜¾æ”¹å–„

**æˆæœ¬èŠ‚çº¦**ï¼š
- äººå‘˜æˆæœ¬é™ä½30%ï¼ŒåŸæ¥éœ€è¦20ä¸ªæ‹£è´§å‘˜ï¼Œç°åœ¨12ä¸ªå°±å¤Ÿäº†
- åº“å­˜å‘¨è½¬ç‡æå‡40%ï¼Œå‡å°‘äº†èµ„é‡‘å ç”¨
- é”™è¯¯ç‡ä¸‹é™90%ï¼Œå¤§å¹…å‡å°‘äº†é€€è´§å’Œèµ”å¿æˆæœ¬

**ä¸šåŠ¡æ”¯æ’‘èƒ½åŠ›**ï¼š
- ç³»ç»Ÿæ”¯æŒ10000+QPSå¹¶å‘ï¼Œä¸ºä¸šåŠ¡å¿«é€Ÿå¢é•¿æä¾›äº†æŠ€æœ¯ä¿éšœ
- å¾®æœåŠ¡æ¶æ„è®©æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æå‡50%
- å®Œå–„çš„ç›‘æ§ä½“ç³»è®©ç³»ç»Ÿå¯ç”¨æ€§è¾¾åˆ°99.95%

**æŠ€æœ¯æ²‰æ·€**ï¼š
- ç§¯ç´¯äº†åˆ†å¸ƒå¼é«˜å¹¶å‘çš„å®æˆ˜ç»éªŒ
- å½¢æˆäº†ä¸€å¥—å®Œæ•´çš„WMSè§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å¤åˆ¶åˆ°å…¶ä»–ä»“åº“
- åŸ¹å…»äº†å›¢é˜Ÿçš„æŠ€æœ¯èƒ½åŠ›ï¼Œä¸ºåç»­é¡¹ç›®å¥ å®šäº†åŸºç¡€"

### 16.4 æ·±åº¦æŠ€æœ¯è¿½é—®åº”å¯¹

#### Q: "ä¸ºä»€ä¹ˆé€‰æ‹©è´ªå¿ƒç®—æ³•è€Œä¸æ˜¯æ›´ç²¾ç¡®çš„ç®—æ³•ï¼Ÿ"
**å®Œæ•´å›ç­”**ï¼š

"è¿™æ˜¯ä¸€ä¸ªå·¥ç¨‹å®è·µä¸­çš„ç»å…¸æƒè¡¡é—®é¢˜ã€‚ç†è®ºä¸Šï¼ŒåŠ¨æ€è§„åˆ’æˆ–è€…é—ä¼ ç®—æ³•ç¡®å®èƒ½æ‰¾åˆ°æ›´ä¼˜è§£ï¼Œä½†åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸‹ï¼š

é¦–å…ˆæ˜¯å®æ—¶æ€§è¦æ±‚ï¼Œæ‹£è´§å‘˜æ‰«ææ³¢æ¬¡äºŒç»´ç åï¼Œéœ€è¦åœ¨1ç§’å†…çœ‹åˆ°æ‹£è´§è·¯å¾„ï¼Œç”¨æˆ·ä½“éªŒä¸èƒ½å¦¥åã€‚åŠ¨æ€è§„åˆ’çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nÂ²Ã—2â¿)ï¼Œ50ä¸ªåº“ä½éœ€è¦è®¡ç®—å‡ åç§’ï¼Œå®Œå…¨ä¸å¯æ¥å—ã€‚

å…¶æ¬¡æ˜¯ä¼˜åŒ–æ•ˆæœçš„è¾¹é™…é€’å‡ã€‚æˆ‘ä»¬åšè¿‡æµ‹è¯•ï¼Œè´ªå¿ƒç®—æ³•èƒ½è·å¾—ç†è®ºæœ€ä¼˜è§£çš„80-90%æ•ˆæœï¼Œè€Œä»90%æå‡åˆ°95%éœ€è¦ä»˜å‡º10å€çš„è®¡ç®—ä»£ä»·ï¼Œä»95%æå‡åˆ°100%å¯èƒ½éœ€è¦100å€çš„è®¡ç®—ä»£ä»·ï¼Œè¿™åœ¨å•†ä¸šä¸Šæ˜¯ä¸åˆ’ç®—çš„ã€‚

ç¬¬ä¸‰æ˜¯ç®—æ³•çš„å¯ç»´æŠ¤æ€§ã€‚è´ªå¿ƒç®—æ³•é€»è¾‘æ¸…æ™°ï¼Œå›¢é˜Ÿæˆå‘˜éƒ½èƒ½ç†è§£å’Œç»´æŠ¤ã€‚å¤æ‚ç®—æ³•è™½ç„¶æ•ˆæœå¥½ï¼Œä½†å¦‚æœåªæœ‰æˆ‘ä¸€ä¸ªäººæ‡‚ï¼Œé£é™©å¤ªå¤§ã€‚

æœ€åï¼Œæˆ‘ä»¬è¿˜åŠ äº†2-optä¼˜åŒ–ä½œä¸ºè¡¥å……ï¼Œè¿™æ ·æ—¢ä¿è¯äº†å®æ—¶æ€§ï¼Œåˆåœ¨å¯æ¥å—çš„è®¡ç®—æˆæœ¬ä¸‹è¿›ä¸€æ­¥æå‡äº†æ•ˆæœã€‚å®é™…è¿è¡Œæ•°æ®è¡¨æ˜ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯æ­£ç¡®çš„ã€‚"

#### Q: "å¾®æœåŠ¡çš„æ•°æ®åº“è®¾è®¡æœ‰ä»€ä¹ˆå‘ï¼Ÿ"
**å®Œæ•´å›ç­”**ï¼š

"ç¡®å®è¸©è¿‡å‡ ä¸ªå‘ï¼Œåˆ†äº«ä¸€ä¸‹ç»éªŒï¼š

**ç¬¬ä¸€ä¸ªå‘æ˜¯å¤–é”®å…³è”**ã€‚åˆšå¼€å§‹æˆ‘ä»¬æƒ³ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨ä¸åŒæœåŠ¡çš„è¡¨ä¹‹é—´è¿˜ä¿ç•™äº†å¤–é”®çº¦æŸï¼Œç»“æœå‘ç°éƒ¨ç½²å’Œç»´æŠ¤æå…¶å›°éš¾ã€‚åæ¥å½»åº•å»æ‰äº†è·¨æœåŠ¡çš„å¤–é”®ï¼Œæ”¹ç”¨ä¸šåŠ¡å±‚é¢çš„å…³è”æ£€æŸ¥ã€‚

**ç¬¬äºŒä¸ªå‘æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡æ»¥ç”¨**ã€‚ä¸€å¼€å§‹ä»€ä¹ˆæ“ä½œéƒ½æƒ³ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§ï¼Œç»“æœç³»ç»Ÿæ€§èƒ½å¾ˆå·®ï¼Œè¿˜ç»å¸¸å‡ºç°æ­»é”ã€‚åæ¥æˆ‘ä»¬é‡æ–°æ¢³ç†äº†ä¸šåŠ¡åœºæ™¯ï¼Œå¤§éƒ¨åˆ†æ”¹æˆäº†æœ€ç»ˆä¸€è‡´æ€§ï¼Œåªåœ¨æ ¸å¿ƒåœºæ™¯ä¿ç•™å¼ºä¸€è‡´æ€§ã€‚

**ç¬¬ä¸‰ä¸ªå‘æ˜¯æ•°æ®å†—ä½™è®¾è®¡ä¸å½“**ã€‚æ¯”å¦‚è®¢å•è¡¨é‡Œå†—ä½™äº†å•†å“åç§°ï¼Œä½†å•†å“æ”¹ååè®¢å•é‡Œè¿˜æ˜¯è€åå­—ï¼Œé€ æˆäº†æ•°æ®æ··ä¹±ã€‚åæ¥æˆ‘ä»¬å»ºç«‹äº†æ˜ç¡®çš„å†—ä½™æ•°æ®ç®¡ç†è§„èŒƒï¼Œå“ªäº›å­—æ®µå¯ä»¥å†—ä½™ï¼Œä»€ä¹ˆæ—¶å€™åŒæ­¥æ›´æ–°ï¼Œéƒ½æœ‰æ˜ç¡®å®šä¹‰ã€‚

**ç¬¬å››ä¸ªå‘æ˜¯IDç”Ÿæˆç­–ç•¥**ã€‚ä¸åŒæœåŠ¡ç”¨ä¸åŒçš„IDç”Ÿæˆå™¨ï¼Œæœ‰çš„ç”¨è‡ªå¢IDï¼Œæœ‰çš„ç”¨UUIDï¼Œæœ‰çš„ç”¨é›ªèŠ±ç®—æ³•ï¼Œç»“æœåœ¨åšæ•°æ®å…³è”æ—¶å„ç§é—®é¢˜ã€‚åæ¥ç»Ÿä¸€ç”¨é›ªèŠ±ç®—æ³•ï¼Œæ—¢ä¿è¯äº†å…¨å±€å”¯ä¸€ï¼Œåˆä¿æŒäº†è¶‹åŠ¿é€’å¢ã€‚

è¿™äº›å‘è®©æˆ‘ä»¬æ·±åˆ»ç†è§£äº†'å¾®æœåŠ¡ä¸æ˜¯é“¶å¼¹'è¿™å¥è¯ï¼ŒæŠ€æœ¯é€‰å‹ä¸€å®šè¦ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯ã€‚"

#### Q: "å¦‚æœè®©ä½ é‡æ–°è®¾è®¡è¿™ä¸ªç³»ç»Ÿï¼Œä½ ä¼šæ€ä¹ˆæ”¹è¿›ï¼Ÿ"
**å®Œæ•´å›ç­”**ï¼š

"ç»è¿‡ä¸€å¹´å¤šçš„è¿è¡Œï¼Œæˆ‘ç¡®å®å‘ç°äº†ä¸€äº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼š

**æ¶æ„å±‚é¢**ï¼šæˆ‘ä¼šè€ƒè™‘å¼•å…¥äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚ç°åœ¨æˆ‘ä»¬çš„æœåŠ¡é—´è°ƒç”¨è¿˜æ˜¯æ¯”è¾ƒç´§è€¦åˆï¼Œå¦‚æœç”¨äº‹ä»¶é©±åŠ¨ï¼Œå„ä¸ªæœåŠ¡åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä¸šåŠ¡é¢†åŸŸäº‹ä»¶ï¼Œç³»ç»Ÿä¼šæ›´åŠ æ¾è€¦åˆã€‚

**æ•°æ®å±‚é¢**ï¼šæˆ‘ä¼šå¼•å…¥CQRSæ¨¡å¼ï¼Œè¯»å†™åˆ†ç¦»åšå¾—æ›´å½»åº•ã€‚ç°åœ¨æŠ¥è¡¨æŸ¥è¯¢è¿˜æ˜¯ä¼šå¯¹ä¸šåŠ¡æ•°æ®åº“é€ æˆä¸€å®šå‹åŠ›ï¼Œå¦‚æœæœ‰ä¸“é—¨çš„æŸ¥è¯¢æ•°æ®åº“ï¼Œæ€§èƒ½ä¼šæ›´å¥½ã€‚

**ç®—æ³•å±‚é¢**ï¼šæˆ‘ä¼šå°è¯•å¼•å…¥æœºå™¨å­¦ä¹ ã€‚æ¯”å¦‚åº“å­˜é¢„æµ‹ï¼Œç°åœ¨è¿˜æ˜¯åŸºäºç®€å•çš„ç»Ÿè®¡è§„åˆ™ï¼Œå¦‚æœç”¨æœºå™¨å­¦ä¹ åˆ†æå†å²æ•°æ®ï¼Œé¢„æµ‹ä¼šæ›´å‡†ç¡®ã€‚æ‹£è´§è·¯å¾„ä¹Ÿå¯ä»¥ç”¨å¼ºåŒ–å­¦ä¹ æ¥ä¼˜åŒ–ã€‚

**è¿ç»´å±‚é¢**ï¼šæˆ‘ä¼šåŠ å¼ºè‡ªåŠ¨åŒ–è¿ç»´ã€‚ç°åœ¨è¿˜æœ‰ä¸€äº›äººå·¥æ“ä½œï¼Œæ¯”å¦‚å®¹é‡æ‰©å±•ã€æ•…éšœæ¢å¤ç­‰ï¼Œå¦‚æœèƒ½å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œç³»ç»Ÿçš„å¯é æ€§ä¼šæ›´é«˜ã€‚

**ä¸šåŠ¡å±‚é¢**ï¼šæˆ‘ä¼šè€ƒè™‘åŠ å…¥æ›´å¤šçš„æ™ºèƒ½åŒ–åŠŸèƒ½ï¼Œæ¯”å¦‚æ™ºèƒ½è¡¥è´§å»ºè®®ã€å¼‚å¸¸é¢„è­¦ã€è‡ªåŠ¨åŒ–ç›˜ç‚¹ç­‰ï¼Œè®©ç³»ç»Ÿä»å•çº¯çš„ç®¡ç†å·¥å…·å˜æˆæ™ºèƒ½å†³ç­–åŠ©æ‰‹ã€‚

å½“ç„¶ï¼Œè¿™äº›æ”¹è¿›éƒ½éœ€è¦è€ƒè™‘æŠ•å…¥äº§å‡ºæ¯”ï¼Œä¸æ˜¯æ‰€æœ‰çš„æŠ€æœ¯éƒ½é€‚åˆç°åœ¨å°±ä¸Šã€‚æŠ€æœ¯æœåŠ¡äºä¸šåŠ¡ï¼Œè¿™æ˜¯æˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­æœ€å¤§çš„æ”¶è·ã€‚"

---

---

**æ–‡æ¡£å®Œæˆ** âœ…

*æœ¬æ–‡æ¡£å…¨é¢ä»‹ç»äº†WMSä»“åº“ç®¡ç†ç³»ç»Ÿçš„è®¾è®¡æ–¹æ¡ˆã€æŠ€æœ¯éš¾ç‚¹å’Œé¢è¯•å‡†å¤‡ç­–ç•¥ï¼Œä¸ºå¼€å‘å’Œæ±‚èŒæä¾›å®Œæ•´çš„å‚è€ƒæŒ‡å—ã€‚*






