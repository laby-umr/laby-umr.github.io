---
sidebar_position: 1
title: WMS ä»“åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡
description: åŸºäº Spring Cloud çš„æ™ºèƒ½ä»“åº“ç®¡ç†ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ
tags: [WMS, ä»“åº“ç®¡ç†, Spring Cloud, å¾®æœåŠ¡, ç³»ç»Ÿè®¾è®¡]
---

# WMS ä»“åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹

WMSï¼ˆWarehouse Management Systemï¼‰ä»“åº“ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº Spring Cloud å¾®æœåŠ¡æ¶æ„çš„æ™ºèƒ½ä»“å‚¨ç®¡ç†å¹³å°ï¼Œæ—¨åœ¨é€šè¿‡æ•°å­—åŒ–æ‰‹æ®µæå‡ä»“åº“è¿è¥æ•ˆç‡ï¼Œå®ç°åº“å­˜å®æ—¶å¯è§†åŒ–ã€å‡ºå…¥åº“è‡ªåŠ¨åŒ–ã€æ™ºèƒ½æ‹£è´§è°ƒåº¦ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | è¯´æ˜ | é¢„æœŸæ•ˆæœ |
|--------|------|----------|
| ğŸ¯ **æå‡æ•ˆç‡** | è‡ªåŠ¨åŒ–æ‹£è´§è·¯å¾„ä¼˜åŒ– | æ‹£è´§æ•ˆç‡æå‡ 40% |
| ğŸ“Š **å®æ—¶å¯è§†** | åº“å­˜å®æ—¶ç›‘æ§å’Œé¢„è­¦ | åº“å­˜å‡†ç¡®ç‡è¾¾ 99.5% |
| ğŸ”„ **é™ä½æˆæœ¬** | å‡å°‘äººå·¥ç›˜ç‚¹å’Œé”™è¯¯ | è¿è¥æˆæœ¬é™ä½ 30% |
| ğŸ“ˆ **æ•°æ®åˆ†æ** | æ™ºèƒ½æŠ¥è¡¨å’Œå†³ç­–æ”¯æŒ | å†³ç­–æ•ˆç‡æå‡ 50% |
| ğŸš€ **å¿«é€Ÿå“åº”** | è®¢å•è‡ªåŠ¨åˆ†é…å’Œå¤„ç† | å‡ºåº“æ—¶æ•ˆæå‡ 35% |

### 1.3 åº”ç”¨åœºæ™¯

#### ğŸ“¦ ç”µå•†ä»“å‚¨
- é«˜é¢‘å‡ºå…¥åº“æ“ä½œ
- å¤šSKUå•†å“ç®¡ç†
- è®¢å•å¿«é€Ÿå±¥çº¦
- åº“å­˜å‘¨è½¬ä¼˜åŒ–

#### ğŸ­ åˆ¶é€ ä¸šä»“åº“
- åŸææ–™ç®¡ç†
- æˆå“/åŠæˆå“å­˜å‚¨
- ç”Ÿäº§çº¿é…é€
- å‘†æ»åº“å­˜é¢„è­¦

#### ğŸª é›¶å”®é…é€ä¸­å¿ƒ
- å¤šé—¨åº—é…è´§
- è¡¥è´§è®¡åˆ’ç®¡ç†
- é€€è´§å¤„ç†
- åº“å­˜è°ƒæ‹¨

### 1.4 æŠ€æœ¯æ¶æ„

#### æ¶æ„è®¾è®¡æ€æƒ³

**ä¸ºä»€ä¹ˆé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Ÿ**

1. **ä¸šåŠ¡è§£è€¦**ï¼šä»“å‚¨ä¸šåŠ¡å¤æ‚åº¦é«˜ï¼Œå…¥åº“ã€å‡ºåº“ã€æ‹£è´§ç­‰æ¨¡å—ç‹¬ç«‹æ€§å¼ºï¼Œå¾®æœåŠ¡åŒ–ä¾¿äºå›¢é˜Ÿåä½œå’Œç‹¬ç«‹æ¼”è¿›
2. **å¼¹æ€§æ‰©å±•**ï¼šåº“å­˜æŸ¥è¯¢ã€æ‹£è´§ä»»åŠ¡ç­‰é«˜å¹¶å‘åœºæ™¯å¯ç‹¬ç«‹æ‰©å±•ï¼Œé¿å…èµ„æºæµªè´¹
3. **æ•…éšœéš”ç¦»**ï¼šæŸä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿï¼Œæé«˜å¯ç”¨æ€§
4. **æŠ€æœ¯å¼‚æ„**ï¼šæŠ¥è¡¨æœåŠ¡å¯ä½¿ç”¨ElasticSearchï¼Œæ—¥å¿—æœåŠ¡å¯ç”¨MongoDBï¼Œå„å–æ‰€é•¿

```mermaid
graph TB
    subgraph Client["ğŸ’» å®¢æˆ·ç«¯å±‚"]
        Web["Web ç®¡ç†ç«¯<br/>(Vue3 + Element Plus)"]
        Mobile["ç§»åŠ¨ PDA ç«¯<br/>(UniApp)"]
        WMS_Screen["ä»“åº“å¤§å±<br/>(DataV)"]
    end

    subgraph Gateway["ğŸŒ ç½‘å…³å±‚"]
        SpringGW["Spring Cloud Gateway<br/>â€¢ è·¯ç”±è½¬å‘<br/>â€¢ è®¤è¯é‰´æƒ<br/>â€¢ é™æµç†”æ–­"]
    end

    subgraph Business["âš™ï¸ ä¸šåŠ¡æœåŠ¡å±‚"]
        Inventory["åº“å­˜æœåŠ¡<br/>inventory-service"]
        Inbound["å…¥åº“æœåŠ¡<br/>inbound-service"]
        Outbound["å‡ºåº“æœåŠ¡<br/>outbound-service"]
        Picking["æ‹£è´§æœåŠ¡<br/>picking-service"]
        Warehouse["ä»“åº“æœåŠ¡<br/>warehouse-service"]
        Report["æŠ¥è¡¨æœåŠ¡<br/>report-service"]
    end

    subgraph Infrastructure["ğŸ”§ åŸºç¡€è®¾æ–½å±‚"]
        subgraph Registry["æ³¨å†Œä¸­å¿ƒ"]
            Nacos["Nacos<br/>æœåŠ¡æ³¨å†Œä¸å‘ç°"]
        end
        
        subgraph Config["é…ç½®ä¸­å¿ƒ"]
            NacosConfig["Nacos Config<br/>é…ç½®ç®¡ç†"]
        end
        
        subgraph Message["æ¶ˆæ¯é˜Ÿåˆ—"]
            RocketMQ["RocketMQ<br/>å¼‚æ­¥æ¶ˆæ¯"]
        end
    end

    subgraph Data["ğŸ’¾ æ•°æ®å±‚"]
        MySQL["MySQL<br/>ä¸šåŠ¡æ•°æ®"]
        Redis["Redis<br/>ç¼“å­˜ + åˆ†å¸ƒå¼é”"]
        MongoDB["MongoDB<br/>æ“ä½œæ—¥å¿—"]
        MinIO["MinIO<br/>æ–‡ä»¶å­˜å‚¨"]
    end

    %% è¿æ¥å…³ç³»
    Web --> SpringGW
    Mobile --> SpringGW
    WMS_Screen --> SpringGW
    
    SpringGW --> Inventory
    SpringGW --> Inbound
    SpringGW --> Outbound
    SpringGW --> Picking
    SpringGW --> Warehouse
    SpringGW --> Report
    
    Inventory --> Nacos
    Inbound --> Nacos
    Outbound --> Nacos
    Picking --> Nacos
    Warehouse --> Nacos
    Report --> Nacos
    
    Inventory --> NacosConfig
    Inbound --> RocketMQ
    Outbound --> RocketMQ
    Picking --> RocketMQ
    
    Inventory --> MySQL
    Inventory --> Redis
    Inbound --> MySQL
    Outbound --> MySQL
    Picking --> MongoDB
    Report --> MinIO

    %% æ ·å¼å®šä¹‰
    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gatewayStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef serviceStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef infraStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef dataStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class Web,Mobile,WMS_Screen clientStyle
    class SpringGW gatewayStyle
    class Inventory,Inbound,Outbound,Picking,Warehouse,Report serviceStyle
    class Nacos,NacosConfig,RocketMQ infraStyle
    class MySQL,Redis,MongoDB,MinIO dataStyle
```

#### æ ¸å¿ƒç»„ä»¶é€‰å‹è¯´æ˜

| ç»„ä»¶ç±»å‹ | æŠ€æœ¯é€‰å‹ | é€‰å‹ç†ç”± | æ›¿ä»£æ–¹æ¡ˆ |
|---------|---------|---------|---------|
| **æœåŠ¡æ³¨å†Œ** | Nacos | å›½äº§åŒ–ã€é…ç½®ä¸­å¿ƒé›†æˆã€ç¤¾åŒºæ´»è·ƒ | Consul, Eureka |
| **ç½‘å…³** | Spring Cloud Gateway | å¼‚æ­¥éé˜»å¡ã€æ€§èƒ½ä¼˜ç§€ã€Springç”Ÿæ€ | Zuul 2.0, Kong |
| **è´Ÿè½½å‡è¡¡** | Spring Cloud LoadBalancer | è½»é‡çº§ã€å¯å®šåˆ¶ | Ribbon(å·²åœæ›´) |
| **æœåŠ¡è°ƒç”¨** | OpenFeign + OkHttp | å£°æ˜å¼ã€å¯è¯»æ€§å¼ºã€æ”¯æŒHTTP/2 | Dubbo, gRPC |
| **ç†”æ–­é™æµ** | Sentinel | å®æ—¶ç›‘æ§ã€è§„åˆ™ä¸°å¯Œã€å›½äº§åŒ– | Hystrix(åœæ›´), Resilience4j |
| **é“¾è·¯è¿½è¸ª** | SkyWalking | APMå…¨æ ˆã€å›½äº§ã€æ— ä¾µå…¥ | Zipkin, Jaeger |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RocketMQ | é¡ºåºæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ã€é«˜åå | Kafka, RabbitMQ |
| **æ•°æ®åº“** | MySQL 8.0 | ACIDä¿è¯ã€æˆç†Ÿç¨³å®šã€ç”Ÿæ€å®Œå–„ | PostgreSQL, TiDB |
| **ç¼“å­˜** | Redis 7.0 | é«˜æ€§èƒ½ã€æ•°æ®ç»“æ„ä¸°å¯Œã€åˆ†å¸ƒå¼é” | Memcached, Hazelcast |
| **æœç´¢å¼•æ“** | ElasticSearch | å…¨æ–‡æ£€ç´¢ã€æ—¥å¿—åˆ†æã€å®æ—¶èšåˆ | Solr, OpenSearch |
| **å¯¹è±¡å­˜å‚¨** | MinIO | å…¼å®¹S3ã€éƒ¨ç½²ç®€å•ã€ç§æœ‰åŒ– | FastDFS, OSS |
| **å®šæ—¶ä»»åŠ¡** | XXL-Job | åˆ†å¸ƒå¼ã€å¯è§†åŒ–ã€å¤±è´¥é‡è¯• | Quartz, Elastic-Job |

### 1.5 æŠ€æœ¯æ ˆ

#### åç«¯æŠ€æœ¯æ ˆ

```xml
<properties>
    <!-- Spring å…¨å®¶æ¡¶ -->
    <spring-boot.version>3.1.5</spring-boot.version>
    <spring-cloud.version>2022.0.4</spring-cloud.version>
    <spring-cloud-alibaba.version>2022.0.0.0</spring-cloud-alibaba.version>
    
    <!-- æ•°æ®åº“ -->
    <mybatis-plus.version>3.5.4.1</mybatis-plus.version>
    <mysql.version>8.0.33</mysql.version>
    <redis.version>3.1.5</redis.version>
    
    <!-- æ¶ˆæ¯é˜Ÿåˆ— -->
    <rocketmq.version>2.2.3</rocketmq.version>
    
    <!-- å·¥å…·ç±» -->
    <hutool.version>5.8.22</hutool.version>
    <lombok.version>1.18.30</lombok.version>
    <mapstruct.version>1.5.5.Final</mapstruct.version>
</properties>
```

#### å‰ç«¯æŠ€æœ¯æ ˆ

```json
{
  "dependencies": {
    "vue": "^3.3.4",
    "vue-router": "^4.2.5",
    "pinia": "^2.1.7",
    "element-plus": "^2.4.2",
    "axios": "^1.6.0",
    "echarts": "^5.4.3",
    "vxe-table": "^4.5.0"
  }
}
```

---

## äºŒã€æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 2.1 åŠŸèƒ½æ¶æ„å›¾

```mermaid
graph LR
    subgraph Core["ğŸ¯ æ ¸å¿ƒä¸šåŠ¡"]
        InventoryMgmt["åº“å­˜ç®¡ç†<br/>â€¢ å®æ—¶åº“å­˜<br/>â€¢ æ‰¹æ¬¡ç®¡ç†<br/>â€¢ åºåˆ—å·è¿½è¸ª"]
        InboundMgmt["å…¥åº“ç®¡ç†<br/>â€¢ é‡‡è´­å…¥åº“<br/>â€¢ é€€è´§å…¥åº“<br/>â€¢ è°ƒæ‹¨å…¥åº“"]
        OutboundMgmt["å‡ºåº“ç®¡ç†<br/>â€¢ é”€å”®å‡ºåº“<br/>â€¢ è°ƒæ‹¨å‡ºåº“<br/>â€¢ æŠ¥æŸå‡ºåº“"]
        PickingMgmt["æ‹£è´§ç®¡ç†<br/>â€¢ æ³¢æ¬¡æ‹£è´§<br/>â€¢ è·¯å¾„ä¼˜åŒ–<br/>â€¢ ä»»åŠ¡åˆ†é…"]
    end

    subgraph Support["ğŸ”§ æ”¯æ’‘åŠŸèƒ½"]
        WarehouseMgmt["ä»“åº“ç®¡ç†<br/>â€¢ åº“åŒºåˆ’åˆ†<br/>â€¢ åº“ä½ç®¡ç†<br/>â€¢ å®¹é‡è§„åˆ’"]
        GoodsMgmt["å•†å“ç®¡ç†<br/>â€¢ SKU ä¿¡æ¯<br/>â€¢ è®¡é‡å•ä½<br/>â€¢ å•†å“åˆ†ç±»"]
        StockCount["ç›˜ç‚¹ç®¡ç†<br/>â€¢ å…¨ç›˜<br/>â€¢ æŠ½ç›˜<br/>â€¢ åŠ¨æ€ç›˜ç‚¹"]
        ReportMgmt["æŠ¥è¡¨åˆ†æ<br/>â€¢ åº“å­˜æŠ¥è¡¨<br/>â€¢ å‡ºå…¥åº“ç»Ÿè®¡<br/>â€¢ å‘¨è½¬åˆ†æ"]
    end

    Core --> Support

    classDef coreStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef supportStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    
    class InventoryMgmt,InboundMgmt,OutboundMgmt,PickingMgmt coreStyle
    class WarehouseMgmt,GoodsMgmt,StockCount,ReportMgmt supportStyle
```

### 2.2 åº“å­˜ç®¡ç†

#### 2.2.1 æ ¸å¿ƒèƒ½åŠ›

| åŠŸèƒ½ | è¯´æ˜ | å…³é”®æŒ‡æ ‡ | å®ç°éš¾ç‚¹ |
|------|------|----------|---------|
| **å®æ—¶åº“å­˜** | åº“å­˜æ•°æ®å®æ—¶æ›´æ–° | å»¶è¿Ÿ < 100ms | é«˜å¹¶å‘ä¸‹çš„æ•°æ®ä¸€è‡´æ€§ |
| **æ‰¹æ¬¡ç®¡ç†** | ç”Ÿäº§æ‰¹æ¬¡è¿½æº¯ | æ‰¹æ¬¡å‡†ç¡®ç‡ 100% | å…ˆè¿›å…ˆå‡º(FIFO)ç­–ç•¥ |
| **åº“é¾„åˆ†æ** | åº“å­˜å‘¨è½¬åˆ†æ | é¢„è­¦å‡†ç¡®ç‡ 95% | å¤§æ•°æ®é‡ç»Ÿè®¡æ€§èƒ½ |
| **å®‰å…¨åº“å­˜** | åº“å­˜ä¸Šä¸‹é™é¢„è­¦ | ç¼ºè´§ç‡ < 1% | åŠ¨æ€é˜ˆå€¼è®¡ç®— |
| **åº“å­˜é”å®š** | è®¢å•åº“å­˜é¢„å  | å¹¶å‘æ”¯æŒ 10000+ | åˆ†å¸ƒå¼é”+ä¹è§‚é” |

#### 2.2.2 åº“å­˜çŠ¶æ€æµè½¬

```mermaid
stateDiagram-v2
    [*] --> å¯ç”¨åº“å­˜
    å¯ç”¨åº“å­˜ --> é”å®šåº“å­˜: ä¸‹å•é”å®š
    é”å®šåº“å­˜ --> å¯ç”¨åº“å­˜: è®¢å•å–æ¶ˆ
    é”å®šåº“å­˜ --> æ‹£è´§ä¸­: å¼€å§‹æ‹£è´§
    æ‹£è´§ä¸­ --> å·²å‡ºåº“: å‡ºåº“å®Œæˆ
    å·²å‡ºåº“ --> [*]
    
    å¯ç”¨åº“å­˜ --> å†»ç»“åº“å­˜: è´¨é‡é—®é¢˜
    å†»ç»“åº“å­˜ --> å¯ç”¨åº“å­˜: é—®é¢˜è§£å†³
    å†»ç»“åº“å­˜ --> æŠ¥æŸåº“å­˜: æ— æ³•ä½¿ç”¨
    æŠ¥æŸåº“å­˜ --> [*]
```

**çŠ¶æ€è¯´æ˜ï¼š**
- **å¯ç”¨åº“å­˜**ï¼šæ­£å¸¸å¯é”€å”®/å¯ç”¨çŠ¶æ€
- **é”å®šåº“å­˜**ï¼šå·²åˆ†é…ç»™è®¢å•ä½†æœªå‡ºåº“ï¼ˆè®¢å•å–æ¶ˆåè‡ªåŠ¨é‡Šæ”¾ï¼‰
- **æ‹£è´§ä¸­**ï¼šæ­£åœ¨æ‰§è¡Œæ‹£è´§ä»»åŠ¡
- **å†»ç»“åº“å­˜**ï¼šè´¨æ£€ä¸åˆæ ¼ã€ä¸´æœŸå•†å“ç­‰
- **æŠ¥æŸåº“å­˜**ï¼šå·²æŸåéœ€æŠ¥æŸå¤„ç†

#### 2.2.3 åº“å­˜æ‰£å‡ç­–ç•¥

**ä¸ºä»€ä¹ˆé‡‡ç”¨"ä¸‹å•é”å®š + å‡ºåº“æ‰£å‡"æ¨¡å¼ï¼Ÿ**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **ä¸‹å•ç›´æ¥æ‰£å‡** | å®ç°ç®€å• | è®¢å•å–æ¶ˆéœ€å›æ»šã€åº“å­˜å ç”¨ç‡ä½ | ä½é€€æ¬¾ç‡ä¸šåŠ¡ |
| **ä¸‹å•é”å®š+å‡ºåº“æ‰£å‡** âœ… | åº“å­˜åˆ©ç”¨ç‡é«˜ã€æ”¯æŒè¶…å–æ§åˆ¶ | å®ç°å¤æ‚ã€éœ€é”å®šæœºåˆ¶ | é«˜å¹¶å‘ç”µå•†åœºæ™¯ |
| **é¢„æ‰£+å¼‚æ­¥ç¡®è®¤** | æ€§èƒ½å¥½ | æœ€ç»ˆä¸€è‡´æ€§ã€è¡¥å¿é€»è¾‘å¤æ‚ | ç§’æ€åœºæ™¯ |

**æˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆ2çš„ç†ç”±ï¼š**
1. **æé«˜åº“å­˜åˆ©ç”¨ç‡**ï¼šè®¢å•æ”¯ä»˜å‰åº“å­˜ä»å¯é”€å”®ï¼ˆè®¾ç½®é”å®šæ—¶æ•ˆï¼‰
2. **é˜²æ­¢è¶…å–**ï¼šé€šè¿‡Redisåˆ†å¸ƒå¼é”ä¿è¯åŸå­æ€§
3. **æ”¯æŒçµæ´»ç­–ç•¥**ï¼šå¯é…ç½®é”å®šæ—¶é•¿ã€è‡ªåŠ¨é‡Šæ”¾è§„åˆ™

#### 2.2.4 å¹¶å‘åº“å­˜æ‰£å‡æ–¹æ¡ˆ

**æ ¸å¿ƒæŒ‘æˆ˜ï¼š** é«˜å¹¶å‘åœºæ™¯ä¸‹å¦‚ä½•ä¿è¯åº“å­˜æ‰£å‡çš„å‡†ç¡®æ€§å’Œæ€§èƒ½ï¼Ÿ

```java
/**
 * åº“å­˜æ‰£å‡ - ä¸‰é‡ä¿éšœæœºåˆ¶
 * 1. Redisåˆ†å¸ƒå¼é”ï¼šä¿è¯åŒä¸€å•†å“åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œ
 * 2. æ•°æ®åº“è¡Œé”(FOR UPDATE)ï¼šä¿è¯æ•°æ®åº“å±‚é¢çš„å¹¶å‘å®‰å…¨
 * 3. ä¹è§‚é”(ç‰ˆæœ¬å·)ï¼šä½œä¸ºå…œåº•æœºåˆ¶
 */
@Override
@Transactional(rollbackFor = Exception.class)
public boolean deductInventory(Long goodsId, BigDecimal quantity) {
    // åˆ†å¸ƒå¼é”Key
    String lockKey = "inventory:lock:" + goodsId;
    RLock lock = redissonClient.getLock(lockKey);
    
    try {
        // 1. å°è¯•è·å–åˆ†å¸ƒå¼é”ï¼ˆç­‰å¾…3ç§’ï¼Œé”å®š10ç§’ï¼‰
        boolean acquired = lock.tryLock(3, 10, TimeUnit.SECONDS);
        if (!acquired) {
            throw new BizException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        // 2. æŸ¥è¯¢åº“å­˜ï¼ˆè¡Œé”ï¼‰
        Inventory inventory = inventoryMapper.selectForUpdate(goodsId);
        
        // 3. æ£€æŸ¥åº“å­˜å……è¶³æ€§
        if (inventory.getAvailableQuantity().compareTo(quantity) < 0) {
            throw new BizException("åº“å­˜ä¸è¶³");
        }
        
        // 4. æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ï¼‰
        int updated = inventoryMapper.deductWithVersion(
            goodsId, quantity, inventory.getVersion()
        );
        
        if (updated == 0) {
            throw new BizException("åº“å­˜æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // 5. è®°å½•åº“å­˜æµæ°´ï¼ˆå¼‚æ­¥ï¼‰
        inventoryLogProducer.sendLog(inventory, quantity);
        
        // 6. æ¸…é™¤ç¼“å­˜
        redisTemplate.delete("inventory:" + goodsId);
        
        return true;
        
    } finally {
        // é‡Šæ”¾é”
        if (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
```

**æ€§èƒ½ä¼˜åŒ–ç‚¹ï¼š**
- é”ç²’åº¦ï¼šæŒ‰å•†å“IDåŠ é”ï¼Œä¸åŒå•†å“å¹¶è¡Œå¤„ç†
- é”ç­‰å¾…ï¼š3ç§’è¶…æ—¶å¿«é€Ÿå¤±è´¥ï¼Œé¿å…çº¿ç¨‹å †ç§¯
- å¼‚æ­¥æ—¥å¿—ï¼šåº“å­˜æµæ°´å¼‚æ­¥è®°å½•ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- ç¼“å­˜åˆ é™¤ï¼šæ‰£å‡åç«‹å³åˆ é™¤ç¼“å­˜ï¼Œä¿è¯ä¸‹æ¬¡æŸ¥è¯¢æœ€æ–°æ•°æ®

#### 2.2.5 åº“å­˜é¢„è­¦æœºåˆ¶

**è®¾è®¡æ€è·¯ï¼š** å¤šç»´åº¦ã€æ™ºèƒ½åŒ–çš„åº“å­˜é¢„è­¦ä½“ç³»

```mermaid
graph LR
    A[åº“å­˜æ•°æ®] --> B{é¢„è­¦è§„åˆ™å¼•æ“}
    B --> C[å®‰å…¨åº“å­˜é¢„è­¦]
    B --> D[åº“é¾„é¢„è­¦]
    B --> E[æ»é”€é¢„è­¦]
    B --> F[åº“ä½åˆ©ç”¨ç‡é¢„è­¦]
    
    C --> G[å®æ—¶å‘Šè­¦]
    D --> G
    E --> G
    F --> G
    
    G --> H[é’‰é’‰/ä¼å¾®]
    G --> I[çŸ­ä¿¡]
    G --> J[ç«™å†…æ¶ˆæ¯]
    
    style A fill:#e1f5fe
    style B fill:#fff3e0
    style G fill:#ffcdd2
```

**é¢„è­¦è§„åˆ™é…ç½®ï¼š**

| é¢„è­¦ç±»å‹ | è§¦å‘æ¡ä»¶ | é¢„è­¦çº§åˆ« | å¤„ç†å»ºè®® |
|---------|---------|---------|---------|
| å®‰å…¨åº“å­˜ | å¯ç”¨åº“å­˜ < å®‰å…¨åº“å­˜ | âš ï¸ è­¦å‘Š | åŠæ—¶è¡¥è´§ |
| ç¼ºè´§ | å¯ç”¨åº“å­˜ = 0 | ğŸ”´ ä¸¥é‡ | ç´§æ€¥é‡‡è´­ |
| åº“é¾„è¶…æœŸ | å…¥åº“å¤©æ•° > 90å¤© | âš ï¸ è­¦å‘Š | ä¿ƒé”€æ¸…ä»“ |
| ä¸´æœŸå•†å“ | è·ç¦»è¿‡æœŸ < 30å¤© | ğŸ”´ ä¸¥é‡ | åŠ é€Ÿé”€å”® |
| æ»é”€ | 30å¤©é”€é‡ = 0 | âš ï¸ è­¦å‘Š | è°ƒæ•´ç­–ç•¥ |
| åº“ä½å æ»¡ | åº“ä½åˆ©ç”¨ç‡ > 95% | âš ï¸ è­¦å‘Š | æ‰©å®¹/æ¸…ç† |

```java
/**
 * åº“å­˜é¢„è­¦å®šæ—¶ä»»åŠ¡
 * æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡å…¨é‡æ‰«æ
 */
@Scheduled(cron = "0 0 * * * ?")
public void checkInventoryAlert() {
    // 1. å®‰å…¨åº“å­˜é¢„è­¦
    List<Inventory> lowStock = inventoryMapper.selectBelowSafetyStock();
    lowStock.forEach(inv -> {
        AlertMessage alert = AlertMessage.builder()
            .type("SAFETY_STOCK")
            .level("WARNING")
            .goodsName(inv.getGoodsName())
            .currentQty(inv.getAvailableQuantity())
            .safetyQty(inv.getSafetyStock())
            .suggestion("å»ºè®®è¡¥è´§æ•°é‡ï¼š" + (inv.getSafetyStock().multiply(new BigDecimal("1.5"))))
            .build();
        alertService.send(alert);
    });
    
    // 2. åº“é¾„é¢„è­¦ï¼ˆè¶…è¿‡90å¤©ï¼‰
    LocalDateTime deadline = LocalDateTime.now().minusDays(90);
    List<Inventory> aged = inventoryMapper.selectByInboundDateBefore(deadline);
    // ... å‘é€é¢„è­¦
    
    // 3. ä¸´æœŸå•†å“é¢„è­¦ï¼ˆ30å¤©å†…è¿‡æœŸï¼‰
    LocalDate expireDeadline = LocalDate.now().plusDays(30);
    List<Inventory> nearExpire = inventoryMapper.selectByExpireDateBefore(expireDeadline);
    // ... å‘é€é¢„è­¦
}
```

#### 2.2.6 åº“å­˜å¿«ç…§ä¸å¯¹è´¦

**ä¸ºä»€ä¹ˆéœ€è¦åº“å­˜å¿«ç…§ï¼Ÿ**
- æ•°æ®è¿½æº¯ï¼šå‡ºç°åº“å­˜å·®å¼‚æ—¶å¿«é€Ÿå®šä½é—®é¢˜æ—¶é—´ç‚¹
- æŠ¥è¡¨ç»Ÿè®¡ï¼šæœˆæœ«/å¹´æœ«åº“å­˜æŠ¥è¡¨ç”Ÿæˆ
- å®¡è®¡åˆè§„ï¼šæ»¡è¶³è´¢åŠ¡å®¡è®¡è¦æ±‚

```java
/**
 * åº“å­˜å¿«ç…§ - æ¯æ—¥å‡Œæ™¨è‡ªåŠ¨ç”Ÿæˆ
 */
@Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹
public void createDailySnapshot() {
    String snapshotDate = LocalDate.now().toString();
    
    // 1. æŸ¥è¯¢æ‰€æœ‰åº“å­˜
    List<Inventory> inventories = inventoryMapper.selectAll();
    
    // 2. æ‰¹é‡æ’å…¥å¿«ç…§è¡¨
    List<InventorySnapshot> snapshots = inventories.stream()
        .map(inv -> InventorySnapshot.builder()
            .snapshotDate(snapshotDate)
            .warehouseId(inv.getWarehouseId())
            .goodsId(inv.getGoodsId())
            .quantity(inv.getQuantity())
            .lockQuantity(inv.getLockQuantity())
            .build())
        .collect(Collectors.toList());
    
    snapshotMapper.batchInsert(snapshots);
    
    // 3. è§¦å‘åº“å­˜å¯¹è´¦ä»»åŠ¡
    reconciliationService.reconcile(snapshotDate);
}

/**
 * åº“å­˜å¯¹è´¦ - ç³»ç»Ÿåº“å­˜ vs å®é™…ç›˜ç‚¹
 */
public ReconciliationResult reconcile(String date) {
    // 1. è·å–ç³»ç»Ÿåº“å­˜å¿«ç…§
    List<InventorySnapshot> systemStock = snapshotMapper.selectByDate(date);
    
    // 2. è·å–å®é™…ç›˜ç‚¹æ•°æ®
    List<StockTaking> actualStock = stockTakingMapper.selectByDate(date);
    
    // 3. å¯¹æ¯”å·®å¼‚
    List<InventoryDiff> diffs = compareInventory(systemStock, actualStock);
    
    // 4. ç”Ÿæˆå¯¹è´¦æŠ¥å‘Š
    return ReconciliationResult.builder()
        .date(date)
        .totalItems(systemStock.size())
        .diffItems(diffs.size())
        .diffRate(diffs.size() * 100.0 / systemStock.size())
        .details(diffs)
        .build();
}
```

### 2.3 å…¥åº“ç®¡ç†

#### å…¥åº“æµç¨‹

```mermaid
flowchart TD
    Start([å…¥åº“å•åˆ›å»º]) --> Review{å®¡æ ¸}
    Review -->|é€šè¿‡| Plan[åˆ¶å®šå…¥åº“è®¡åˆ’]
    Review -->|é©³å›| End1([ç»“æŸ])
    
    Plan --> Assign[åˆ†é…åº“ä½]
    Assign --> Receive[å®ç‰©éªŒæ”¶]
    
    Receive --> Quality{è´¨æ£€}
    Quality -->|åˆæ ¼| PutAway[ä¸Šæ¶]
    Quality -->|ä¸åˆæ ¼| Return[é€€å›ä¾›åº”å•†]
    
    PutAway --> UpdateInv[æ›´æ–°åº“å­˜]
    UpdateInv --> Complete([å…¥åº“å®Œæˆ])
    
    Return --> End2([é€€è´§ç»“æŸ])
    
    style Start fill:#e8f5e9
    style Complete fill:#c8e6c9
    style End1 fill:#ffcdd2
    style End2 fill:#ffcdd2
```

#### å…¥åº“ç±»å‹

- **é‡‡è´­å…¥åº“**ï¼šä¾›åº”å•†é‡‡è´­åˆ°è´§
- **é€€è´§å…¥åº“**ï¼šå®¢æˆ·é€€è´§å…¥åº“
- **è°ƒæ‹¨å…¥åº“**ï¼šå…¶ä»–ä»“åº“è°ƒå…¥
- **ç›˜ç›ˆå…¥åº“**ï¼šç›˜ç‚¹å‘ç°å¤šä½™åº“å­˜
- **ç”Ÿäº§å…¥åº“**ï¼šç”Ÿäº§å®Œå·¥å…¥åº“

### 2.4 å‡ºåº“ç®¡ç†

#### å‡ºåº“æµç¨‹

```mermaid
flowchart TD
    Order([å‡ºåº“è®¢å•]) --> Audit{è®¢å•å®¡æ ¸}
    Audit -->|é€šè¿‡| Allocate[åº“å­˜åˆ†é…]
    Audit -->|é©³å›| Cancel1([è®¢å•å–æ¶ˆ])
    
    Allocate --> CheckStock{åº“å­˜å……è¶³?}
    CheckStock -->|æ˜¯| CreateWave[åˆ›å»ºæ³¢æ¬¡]
    CheckStock -->|å¦| Wait[ç­‰å¾…è¡¥è´§]
    
    Wait --> CheckStock
    
    CreateWave --> AssignPicker[åˆ†é…æ‹£è´§å‘˜]
    AssignPicker --> Picking[æ‰§è¡Œæ‹£è´§]
    
    Picking --> Review{å¤æ ¸}
    Review -->|é€šè¿‡| Pack[æ‰“åŒ…]
    Review -->|å¼‚å¸¸| Repick[é‡æ–°æ‹£è´§]
    
    Repick --> Picking
    
    Pack --> Ship[å‘è´§]
    Ship --> UpdateInv[æ›´æ–°åº“å­˜]
    UpdateInv --> Complete([å‡ºåº“å®Œæˆ])
    
    style Order fill:#e8f5e9
    style Complete fill:#c8e6c9
    style Cancel1 fill:#ffcdd2
```

### 2.5 æ‹£è´§ç®¡ç†

#### 2.5.1 æ‹£è´§ç­–ç•¥å¯¹æ¯”

```mermaid
graph TB
    subgraph PickStrategy["ğŸ¯ æ‹£è´§ç­–ç•¥"]
        Single["å•å“æ‹£è´§<br/>Pick by Item<br/>é€‚ç”¨ï¼šå°‘é‡è®¢å•"]
        Batch["æ‰¹æ¬¡æ‹£è´§<br/>Pick by Batch<br/>é€‚ç”¨ï¼šå¤šè®¢å•åŒå“"]
        Zone["åˆ†åŒºæ‹£è´§<br/>Pick by Zone<br/>é€‚ç”¨ï¼šå¤§å‹ä»“åº“"]
        Wave["æ³¢æ¬¡æ‹£è´§<br/>Pick by Wave<br/>é€‚ç”¨ï¼šé«˜å¹¶å‘"]
    end
    
    subgraph Optimization["âš¡ è·¯å¾„ä¼˜åŒ–"]
        ShortestPath["æœ€çŸ­è·¯å¾„ç®—æ³•"]
        TimeWindow["æ—¶é—´çª—å£è°ƒåº¦"]
        LoadBalance["è´Ÿè½½å‡è¡¡"]
    end
    
    PickStrategy --> Optimization
    
    classDef strategyStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef optStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    
    class Single,Batch,Zone,Wave strategyStyle
    class ShortestPath,TimeWindow,LoadBalance optStyle
```

**ç­–ç•¥è¯¦ç»†å¯¹æ¯”ï¼š**

| ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ•ˆç‡æå‡ |
|------|---------|------|------|---------|
| **å•å“æ‹£è´§** | B2Bå¤§å•ã€ç‰¹æ®Šå•†å“ | å‡†ç¡®ç‡é«˜ã€æµç¨‹ç®€å• | æ•ˆç‡ä½ã€é‡å¤è·¯å¾„ | åŸºå‡† |
| **æ‰¹æ¬¡æ‹£è´§** âœ… | ç”µå•†å¤šå•ã€ç›¸åŒSKU | å‡å°‘è¡Œèµ°è·¯å¾„ã€æå‡æ•ˆç‡ | éœ€äºŒæ¬¡åˆ†æ‹£ | æå‡30% |
| **åˆ†åŒºæ‹£è´§** | å¤§å‹ä»“åº“ã€å¤šåº“åŒº | å¹¶è¡Œä½œä¸šã€é™ä½æ‹¥å µ | éœ€äº¤æ¥åŒºã€åè°ƒå¤æ‚ | æå‡50% |
| **æ³¢æ¬¡æ‹£è´§** âœ… | é«˜å¹¶å‘è®¢å•ã€å¤§ä¿ƒåœºæ™¯ | æœ€å¤§åŒ–æ•ˆç‡ã€æ™ºèƒ½è°ƒåº¦ | ç³»ç»Ÿå¤æ‚åº¦é«˜ | æå‡60% |

**æˆ‘ä»¬é‡‡ç”¨"æ³¢æ¬¡æ‹£è´§+æ‰¹æ¬¡æ‹£è´§"ç»„åˆç­–ç•¥çš„åŸå› ï¼š**

1. **è®¢å•èšåˆ**ï¼šå°†æ—¶é—´çª—å£å†…çš„è®¢å•èšåˆæˆæ³¢æ¬¡ï¼Œä¸€æ¬¡æ€§å¤„ç†
2. **è·¯å¾„ä¼˜åŒ–**ï¼šæ³¢æ¬¡å†…ç»Ÿä¸€è§„åˆ’æ‹£è´§è·¯å¾„ï¼Œå‡å°‘é‡å¤è¡Œèµ°
3. **äººå‘˜å‡è¡¡**ï¼šæ ¹æ®æ‹£è´§å‘˜ä½ç½®å’Œå·¥ä½œé‡æ™ºèƒ½åˆ†é…ä»»åŠ¡
4. **çµæ´»è°ƒæ•´**ï¼šæ”¯æŒç´§æ€¥è®¢å•æ’å…¥ã€ä¼˜å…ˆçº§è°ƒæ•´

#### 2.5.2 æ³¢æ¬¡ç”Ÿæˆç®—æ³•

**æ ¸å¿ƒç›®æ ‡ï¼š** åœ¨æ»¡è¶³æ—¶æ•ˆè¦æ±‚çš„å‰æä¸‹ï¼Œæœ€å¤§åŒ–æ‹£è´§æ•ˆç‡

```java
/**
 * æ³¢æ¬¡ç”Ÿæˆç­–ç•¥
 * è€ƒè™‘å› ç´ ï¼šè®¢å•ä¼˜å…ˆçº§ã€å•†å“ä½ç½®ã€æ‹£è´§å‘˜çŠ¶æ€ã€æˆªå•æ—¶é—´
 */
@Service
public class WaveGenerationService {
    
    /**
     * æ™ºèƒ½ç”Ÿæˆæ³¢æ¬¡
     * @param orders å¾…å¤„ç†è®¢å•åˆ—è¡¨
     * @return æ³¢æ¬¡åˆ—è¡¨
     */
    public List<PickingWave> generateWaves(List<Order> orders) {
        List<PickingWave> waves = new ArrayList<>();
        
        // 1. è®¢å•é¢„å¤„ç†ï¼šæŒ‰ä¼˜å…ˆçº§ã€æˆªå•æ—¶é—´æ’åº
        orders.sort(Comparator
            .comparing(Order::getPriority).reversed()
            .thenComparing(Order::getDeadline));
        
        // 2. è®¢å•èšç±»ï¼šç›¸åŒåº“åŒºã€ç›¸ä¼¼è·¯å¾„çš„è®¢å•åˆ†ä¸ºä¸€ç»„
        Map<String, List<Order>> clusters = clusterOrders(orders);
        
        // 3. ç”Ÿæˆæ³¢æ¬¡ï¼šæ¯ä¸ªèšç±»ç”Ÿæˆä¸€ä¸ªæ³¢æ¬¡
        for (Map.Entry<String, List<Order>> entry : clusters.entrySet()) {
            List<Order> clusterOrders = entry.getValue();
            
            // æ³¢æ¬¡å¤§å°æ§åˆ¶ï¼š30-50å•/æ³¢æ¬¡ï¼ˆæ ¹æ®ä»“åº“è§„æ¨¡è°ƒæ•´ï¼‰
            int waveSize = 40;
            for (int i = 0; i < clusterOrders.size(); i += waveSize) {
                List<Order> waveOrders = clusterOrders.subList(
                    i, Math.min(i + waveSize, clusterOrders.size())
                );
                
                PickingWave wave = PickingWave.builder()
                    .waveNo(generateWaveNo())
                    .orders(waveOrders)
                    .priority(calculateWavePriority(waveOrders))
                    .estimatedTime(estimatePickingTime(waveOrders))
                    .status(WaveStatus.PENDING)
                    .build();
                
                waves.add(wave);
            }
        }
        
        return waves;
    }
    
    /**
     * è®¢å•èšç±»ç®—æ³•ï¼ˆK-meanså˜ç§ï¼‰
     * æ ¹æ®å•†å“ä½ç½®ä¿¡æ¯ï¼Œå°†è®¢å•èšç±»åˆ°ç›¸ä¼¼åŒºåŸŸ
     */
    private Map<String, List<Order>> clusterOrders(List<Order> orders) {
        Map<String, List<Order>> clusters = new HashMap<>();
        
        for (Order order : orders) {
            // è®¡ç®—è®¢å•çš„"é‡å¿ƒä½ç½®"ï¼ˆæ‰€æœ‰å•†å“ä½ç½®çš„å¹³å‡å€¼ï¼‰
            Location centerLocation = calculateCenterLocation(order);
            
            // åˆ†é…åˆ°æœ€è¿‘çš„åº“åŒº
            String zoneCode = locationService.getNearestZone(centerLocation);
            
            clusters.computeIfAbsent(zoneCode, k -> new ArrayList<>()).add(order);
        }
        
        return clusters;
    }
    
    /**
     * ä¼°ç®—æ‹£è´§æ—¶é—´
     * å…¬å¼ï¼šåŸºç¡€æ—¶é—´ + å•†å“æ•°é‡Ã—å•å“æ—¶é—´ + è¡Œèµ°è·ç¦»Ã—ç§»åŠ¨æ—¶é—´
     */
    private int estimatePickingTime(List<Order> orders) {
        int baseTime = 60; // åŸºç¡€å‡†å¤‡æ—¶é—´ï¼š60ç§’
        int itemTime = 10; // æ¯ä¸ªå•†å“æ‹£é€‰æ—¶é—´ï¼š10ç§’
        int moveSpeed = 1; // ç§»åŠ¨é€Ÿåº¦ï¼š1ç±³/ç§’
        
        // ç»Ÿè®¡å•†å“æ€»æ•°
        int totalItems = orders.stream()
            .mapToInt(order -> order.getItems().size())
            .sum();
        
        // è®¡ç®—æ‹£è´§è·¯å¾„æ€»é•¿åº¦
        double totalDistance = calculatePathDistance(orders);
        
        return baseTime + (totalItems * itemTime) + (int)(totalDistance / moveSpeed);
    }
}
```

#### 2.5.3 æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•

**é—®é¢˜æœ¬è´¨ï¼š** æ—…è¡Œå•†é—®é¢˜(TSP)çš„å˜ç§ - è®¿é—®æ‰€æœ‰åº“ä½å¹¶å›åˆ°èµ·ç‚¹ï¼Œè·¯å¾„æœ€çŸ­

**ç®—æ³•é€‰æ‹©ï¼š**

| ç®—æ³• | æ—¶é—´å¤æ‚åº¦ | ä¼˜åŒ–æ•ˆæœ | é€‚ç”¨è§„æ¨¡ | æ˜¯å¦é‡‡ç”¨ |
|------|-----------|---------|---------|---------|
| æš´åŠ›æšä¸¾ | O(n!) | 100%æœ€ä¼˜ | n < 10 | âŒ ä¸å®ç”¨ |
| åŠ¨æ€è§„åˆ’ | O(nÂ²Â·2â¿) | 100%æœ€ä¼˜ | n < 20 | âŒ æ€§èƒ½å·® |
| **è´ªå¿ƒç®—æ³•** | O(nÂ²) | 80-90%ä¼˜åŒ– | n < 1000 | âœ… é‡‡ç”¨ |
| é—ä¼ ç®—æ³• | O(nÂ·gÂ·p) | 85-95%ä¼˜åŒ– | n > 1000 | âšª å¤‡é€‰ |

**æˆ‘ä»¬é‡‡ç”¨è´ªå¿ƒç®—æ³•çš„åŸå› ï¼š**
- å®æ—¶æ€§è¦æ±‚ï¼šæ‹£è´§ä»»åŠ¡éœ€è¦ç§’çº§å“åº”ï¼Œä¸èƒ½ç­‰å¾…é•¿æ—¶é—´è®¡ç®—
- æ•ˆæœè¶³å¤Ÿï¼š80-90%çš„ä¼˜åŒ–æ•ˆæœå·²èƒ½æ˜¾è‘—æå‡æ•ˆç‡
- å®ç°ç®€å•ï¼šä¾¿äºç»´æŠ¤å’Œè°ƒæ•´

```java
/**
 * æ‹£è´§è·¯å¾„ä¼˜åŒ– - æ”¹è¿›çš„è´ªå¿ƒç®—æ³•
 * ä»åº“åŒºå…¥å£å¼€å§‹ï¼Œæ¯æ¬¡é€‰æ‹©è·ç¦»å½“å‰ä½ç½®æœ€è¿‘ä¸”æœªè®¿é—®çš„åº“ä½
 */
@Service
public class PickingPathOptimizer {
    
    /**
     * ä¼˜åŒ–æ‹£è´§è·¯å¾„
     * @param locations éœ€è¦è®¿é—®çš„åº“ä½åˆ—è¡¨
     * @return ä¼˜åŒ–åçš„åº“ä½é¡ºåº
     */
    public List<Location> optimizePath(List<Location> locations) {
        if (locations.size() <= 1) {
            return locations;
        }
        
        List<Location> optimizedPath = new ArrayList<>();
        Set<Location> unvisited = new HashSet<>(locations);
        
        // 1. èµ·ç‚¹ï¼šé€‰æ‹©è·ç¦»åº“åŒºå…¥å£æœ€è¿‘çš„åº“ä½
        Location entrance = getWarehouseEntrance();
        Location current = findNearest(entrance, unvisited);
        optimizedPath.add(current);
        unvisited.remove(current);
        
        // 2. è´ªå¿ƒé€‰æ‹©ï¼šæ¯æ¬¡é€‰æ‹©æœ€è¿‘çš„æœªè®¿é—®åº“ä½
        while (!unvisited.isEmpty()) {
            Location nearest = findNearest(current, unvisited);
            optimizedPath.add(nearest);
            unvisited.remove(nearest);
            current = nearest;
        }
        
        // 3. è·¯å¾„å¾®è°ƒï¼šæ£€æµ‹å¹¶æ¶ˆé™¤äº¤å‰è·¯å¾„ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
        optimizedPath = eliminateCrossings(optimizedPath);
        
        return optimizedPath;
    }
    
    /**
     * è®¡ç®—ä¸¤ä¸ªåº“ä½ä¹‹é—´çš„æ›¼å“ˆé¡¿è·ç¦»
     * ä»“åº“é€šé“ä¸ºç›´è§’ç»“æ„ï¼Œä¸èƒ½æ–œç©¿ï¼Œå› æ­¤ä½¿ç”¨æ›¼å“ˆé¡¿è·ç¦»è€Œéæ¬§å¼è·ç¦»
     */
    private double calculateDistance(Location loc1, Location loc2) {
        // æ¨ªå‘è·ç¦»
        int rowDiff = Math.abs(loc1.getRowNo() - loc2.getRowNo());
        // çºµå‘è·ç¦»  
        int colDiff = Math.abs(loc1.getColumnNo() - loc2.getColumnNo());
        // å±‚é—´è·ç¦»ï¼ˆçˆ¬æ¥¼æ¢¯æˆæœ¬æ›´é«˜ï¼‰
        int layerDiff = Math.abs(loc1.getLayerNo() - loc2.getLayerNo());
        
        // åŠ æƒè®¡ç®—ï¼šå±‚é—´ç§»åŠ¨æˆæœ¬æ˜¯æ°´å¹³ç§»åŠ¨çš„2å€
        return rowDiff + colDiff + layerDiff * 2.0;
    }
    
    /**
     * æŸ¥æ‰¾è·ç¦»ç›®æ ‡ä½ç½®æœ€è¿‘çš„åº“ä½
     */
    private Location findNearest(Location target, Set<Location> candidates) {
        return candidates.stream()
            .min(Comparator.comparingDouble(loc -> calculateDistance(target, loc)))
            .orElseThrow(() -> new BizException("æ²¡æœ‰å¯ç”¨çš„å€™é€‰åº“ä½"));
    }
    
    /**
     * æ¶ˆé™¤äº¤å‰è·¯å¾„ï¼ˆ2-optä¼˜åŒ–ï¼‰
     * æ£€æµ‹è·¯å¾„ä¸­çš„äº¤å‰ç‚¹ï¼Œå¹¶è¿›è¡Œå±€éƒ¨è°ƒæ•´
     */
    private List<Location> eliminateCrossings(List<Location> path) {
        boolean improved = true;
        List<Location> optimized = new ArrayList<>(path);
        
        // è¿­ä»£ä¼˜åŒ–ï¼Œç›´åˆ°æ²¡æœ‰æ”¹è¿›
        while (improved) {
            improved = false;
            
            // æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„è¾¹äº¤æ¢
            for (int i = 0; i < optimized.size() - 2; i++) {
                for (int j = i + 2; j < optimized.size() - 1; j++) {
                    // è®¡ç®—å½“å‰è·ç¦»
                    double currentDist = 
                        calculateDistance(optimized.get(i), optimized.get(i+1)) +
                        calculateDistance(optimized.get(j), optimized.get(j+1));
                    
                    // è®¡ç®—äº¤æ¢åçš„è·ç¦»
                    double newDist = 
                        calculateDistance(optimized.get(i), optimized.get(j)) +
                        calculateDistance(optimized.get(i+1), optimized.get(j+1));
                    
                    // å¦‚æœäº¤æ¢åæ›´çŸ­ï¼Œåˆ™æ‰§è¡Œäº¤æ¢
                    if (newDist < currentDist) {
                        // åè½¬ i+1 åˆ° j ä¹‹é—´çš„è·¯å¾„
                        Collections.reverse(
                            optimized.subList(i + 1, j + 1)
                        );
                        improved = true;
                    }
                }
            }
        }
        
        return optimized;
    }
}
```

**ä¼˜åŒ–æ•ˆæœå¯¹æ¯”ï¼š**

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|-------|-------|---------|
| å¹³å‡æ‹£è´§è·¯å¾„ | 450ç±³ | 280ç±³ | â†“ 38% |
| å¹³å‡æ‹£è´§æ—¶é—´ | 25åˆ†é’Ÿ | 16åˆ†é’Ÿ | â†“ 36% |
| æ‹£è´§å‘˜æ—¥äº§èƒ½ | 180å• | 280å• | â†‘ 56% |
| è·¯å¾„äº¤å‰æ¬¡æ•° | 8æ¬¡ | 1æ¬¡ | â†“ 88% |

#### 2.5.4 æ‹£è´§ä»»åŠ¡åˆ†é…ç­–ç•¥

**ç›®æ ‡ï¼š** å®ç°æ‹£è´§å‘˜å·¥ä½œè´Ÿè½½å‡è¡¡ï¼Œæé«˜æ•´ä½“æ•ˆç‡

```java
/**
 * æ‹£è´§ä»»åŠ¡åˆ†é… - ç»¼åˆè¯„åˆ†ç®—æ³•
 * è€ƒè™‘å› ç´ ï¼šæ‹£è´§å‘˜å½“å‰ä½ç½®ã€å·¥ä½œè´Ÿè½½ã€æŠ€èƒ½ç­‰çº§ã€ä»»åŠ¡ä¼˜å…ˆçº§
 */
@Service
public class TaskAssignmentService {
    
    /**
     * ä¸ºæ³¢æ¬¡åˆ†é…æœ€åˆé€‚çš„æ‹£è´§å‘˜
     */
    public Picker assignPicker(PickingWave wave) {
        // 1. è·å–æ‰€æœ‰ç©ºé—²æˆ–å³å°†ç©ºé—²çš„æ‹£è´§å‘˜
        List<Picker> availablePickers = pickerService.getAvailablePickers();
        
        if (availablePickers.isEmpty()) {
            throw new BizException("æš‚æ— å¯ç”¨æ‹£è´§å‘˜");
        }
        
        // 2. è®¡ç®—æ¯ä¸ªæ‹£è´§å‘˜çš„ç»¼åˆè¯„åˆ†
        Picker bestPicker = availablePickers.stream()
            .max(Comparator.comparingDouble(picker -> 
                calculatePickerScore(picker, wave)))
            .orElseThrow();
        
        // 3. åˆ†é…ä»»åŠ¡
        wave.setPickerId(bestPicker.getId());
        wave.setStatus(WaveStatus.ASSIGNED);
        waveMapper.updateById(wave);
        
        // 4. é€šçŸ¥æ‹£è´§å‘˜ï¼ˆæ¨é€åˆ°PDAï¼‰
        pdaService.pushTask(bestPicker.getId(), wave);
        
        return bestPicker;
    }
    
    /**
     * æ‹£è´§å‘˜è¯„åˆ†ç®—æ³•
     * è¯„åˆ†è¶Šé«˜ï¼Œè¶Šé€‚åˆæ‰§è¡Œè¯¥ä»»åŠ¡
     */
    private double calculatePickerScore(Picker picker, PickingWave wave) {
        double score = 0;
        
        // 1. ä½ç½®å¾—åˆ†ï¼ˆ40%æƒé‡ï¼‰ï¼šæ‹£è´§å‘˜è·ç¦»ä»»åŠ¡èµ·ç‚¹è¶Šè¿‘ï¼Œå¾—åˆ†è¶Šé«˜
        Location waveStartLocation = wave.getStartLocation();
        double distance = calculateDistance(picker.getCurrentLocation(), waveStartLocation);
        double locationScore = Math.max(0, 100 - distance); // è·ç¦»æ¯å¢åŠ 1ç±³å‡1åˆ†
        score += locationScore * 0.4;
        
        // 2. è´Ÿè½½å¾—åˆ†ï¼ˆ30%æƒé‡ï¼‰ï¼šå½“å‰å·¥ä½œé‡è¶Šå°‘ï¼Œå¾—åˆ†è¶Šé«˜
        int currentTasks = picker.getCurrentTaskCount();
        double loadScore = Math.max(0, 100 - currentTasks * 10); // æ¯ä¸ªä»»åŠ¡å‡10åˆ†
        score += loadScore * 0.3;
        
        // 3. æŠ€èƒ½å¾—åˆ†ï¼ˆ20%æƒé‡ï¼‰ï¼šæŠ€èƒ½ç­‰çº§è¶Šé«˜ï¼Œå¾—åˆ†è¶Šé«˜
        double skillScore = picker.getSkillLevel() * 20; // 1-5çº§ï¼Œæ¯çº§20åˆ†
        score += skillScore * 0.2;
        
        // 4. æ•ˆç‡å¾—åˆ†ï¼ˆ10%æƒé‡ï¼‰ï¼šå†å²æ•ˆç‡è¶Šé«˜ï¼Œå¾—åˆ†è¶Šé«˜
        double efficiencyScore = picker.getEfficiencyRate(); // 0-100
        score += efficiencyScore * 0.1;
        
        return score;
    }
}
```

#### 2.5.5 æ‹£è´§å¼‚å¸¸å¤„ç†

**å¸¸è§å¼‚å¸¸åœºæ™¯åŠå¤„ç†æ–¹æ¡ˆï¼š**

| å¼‚å¸¸ç±»å‹ | è§¦å‘æ¡ä»¶ | å¤„ç†æ–¹æ¡ˆ | æ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥ |
|---------|---------|---------|---------------|
| åº“å­˜ä¸è¶³ | å®é™…åº“å­˜ < å¾…æ‹£æ•°é‡ | è‡ªåŠ¨å‡å•æˆ–è½¬é‡‡è´­ | âš ï¸ éœ€ç¡®è®¤ |
| å•†å“ç ´æŸ | è´¨æ£€å‘ç°é—®é¢˜ | æ ‡è®°æ®‹æ¬¡ã€å¯»æ‰¾æ›¿ä»£åº“ä½ | âœ… éœ€ä»‹å…¥ |
| åº“ä½ç©ºç¼º | æ‰«æåº“ä½æ— è´§ | è§¦å‘ç›˜ç‚¹ä»»åŠ¡ã€æŸ¥æ‰¾å…¶ä»–æ‰¹æ¬¡ | âœ… éœ€ä»‹å…¥ |
| æ‹£è´§è¶…æ—¶ | æ‰§è¡Œæ—¶é—´ > é¢„ä¼°æ—¶é—´Ã—1.5 | å‘é€æé†’ã€è§¦å‘ååŠ©è¯·æ±‚ | âš ï¸ è§†æƒ…å†µ |
| æ‹£é”™å•†å“ | å¤æ ¸å‘ç°SKUä¸ç¬¦ | å›é€€é‡æ‹£ã€è®°å½•é”™è¯¯ç‡ | âŒ è‡ªåŠ¨å¤„ç† |

```java
/**
 * æ‹£è´§å¼‚å¸¸å¤„ç†æœåŠ¡
 */
@Service
public class PickingExceptionHandler {
    
    /**
     * å¤„ç†åº“ä½ç©ºç¼ºå¼‚å¸¸
     * ç­–ç•¥ï¼šè‡ªåŠ¨å¯»æ‰¾æ›¿ä»£åº“ä½ -> å¤±è´¥åˆ™è½¬äººå·¥å¤„ç†
     */
    @Transactional(rollbackFor = Exception.class)
    public void handleEmptyLocation(PickingTask task, Location emptyLocation) {
        // 1. è®°å½•å¼‚å¸¸
        PickingException exception = PickingException.builder()
            .taskId(task.getId())
            .type(ExceptionType.EMPTY_LOCATION)
            .locationId(emptyLocation.getId())
            .build();
        exceptionMapper.insert(exception);
        
        // 2. è§¦å‘ç›˜ç‚¹ä»»åŠ¡ï¼ˆå¼‚æ­¥ï¼‰
        stockTakingService.createUrgentTask(emptyLocation);
        
        // 3. æŸ¥æ‰¾æ›¿ä»£åº“ä½
        List<Location> alternativeLocations = inventoryService
            .findAlternativeLocations(task.getGoodsId(), task.getBatchNo());
        
        if (!alternativeLocations.isEmpty()) {
            // æœ‰æ›¿ä»£åº“ä½ï¼Œè‡ªåŠ¨åˆ‡æ¢
            Location alternative = alternativeLocations.get(0);
            task.setLocationId(alternative.getId());
            task.setStatus(TaskStatus.RETRY);
            taskMapper.updateById(task);
            
            // æ¨é€æ–°åº“ä½ç»™æ‹£è´§å‘˜
            pdaService.pushLocationChange(task.getPickerId(), alternative);
        } else {
            // æ— æ›¿ä»£åº“ä½ï¼Œè½¬äººå·¥å¤„ç†
            task.setStatus(TaskStatus.EXCEPTION);
            taskMapper.updateById(task);
            
            // é€šçŸ¥ä»“åº“ä¸»ç®¡
            alertService.notifyManager(
                "æ‹£è´§å¼‚å¸¸ï¼šå•†å“æ— æ›¿ä»£åº“ä½",
                task.getGoodsName()
            );
        }
    }
}
```

---

## ä¸‰ã€æ•°æ®åº“è®¾è®¡

### 3.1 æ ¸å¿ƒè¡¨ç»“æ„

```mermaid
erDiagram
    WAREHOUSE ||--o{ WAREHOUSE_AREA : contains
    WAREHOUSE_AREA ||--o{ WAREHOUSE_LOCATION : contains
    WAREHOUSE_LOCATION ||--o{ INVENTORY : stores
    
    GOODS ||--o{ INVENTORY : has
    GOODS ||--o{ INBOUND_DETAIL : contains
    GOODS ||--o{ OUTBOUND_DETAIL : contains
    
    INBOUND_ORDER ||--o{ INBOUND_DETAIL : has
    OUTBOUND_ORDER ||--o{ OUTBOUND_DETAIL : has
    
    OUTBOUND_ORDER ||--o{ PICKING_TASK : generates
    PICKING_TASK ||--o{ PICKING_DETAIL : contains
    
    WAREHOUSE {
        bigint id PK
        string warehouse_code UK
        string warehouse_name
        string address
        int status
    }
    
    WAREHOUSE_AREA {
        bigint id PK
        bigint warehouse_id FK
        string area_code UK
        string area_name
        string area_type
    }
    
    WAREHOUSE_LOCATION {
        bigint id PK
        bigint area_id FK
        string location_code UK
        decimal capacity
        int status
    }
    
    GOODS {
        bigint id PK
        string sku_code UK
        string goods_name
        string category
        string unit
    }
    
    INVENTORY {
        bigint id PK
        bigint location_id FK
        bigint goods_id FK
        string batch_no
        decimal quantity
        int lock_quantity
    }
```

### 3.2 å®Œæ•´å»ºè¡¨è¯­å¥

```sql
-- ================================
-- WMS ä»“åº“ç®¡ç†ç³»ç»Ÿæ•°æ®åº“
-- ================================

CREATE DATABASE IF NOT EXISTS `wms` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `wms`;

-- ================================
-- 1. ä»“åº“åŸºç¡€è¡¨
-- ================================

-- ä»“åº“è¡¨
CREATE TABLE `warehouse` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_code` VARCHAR(50) NOT NULL COMMENT 'ä»“åº“ç¼–ç ',
    `warehouse_name` VARCHAR(100) NOT NULL COMMENT 'ä»“åº“åç§°',
    `warehouse_type` TINYINT(4) DEFAULT 1 COMMENT 'ä»“åº“ç±»å‹:1-æˆå“ä»“,2-åŸæ–™ä»“,3-åŠæˆå“ä»“',
    `province` VARCHAR(50) DEFAULT NULL COMMENT 'çœä»½',
    `city` VARCHAR(50) DEFAULT NULL COMMENT 'åŸå¸‚',
    `district` VARCHAR(50) DEFAULT NULL COMMENT 'åŒºå¿',
    `address` VARCHAR(200) DEFAULT NULL COMMENT 'è¯¦ç»†åœ°å€',
    `contact_person` VARCHAR(50) DEFAULT NULL COMMENT 'è”ç³»äºº',
    `contact_phone` VARCHAR(20) DEFAULT NULL COMMENT 'è”ç³»ç”µè¯',
    `total_area` DECIMAL(10,2) DEFAULT NULL COMMENT 'æ€»é¢ç§¯(å¹³æ–¹ç±³)',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_warehouse_code` (`warehouse_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä»“åº“è¡¨';

-- åº“åŒºè¡¨
CREATE TABLE `warehouse_area` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `area_code` VARCHAR(50) NOT NULL COMMENT 'åº“åŒºç¼–ç ',
    `area_name` VARCHAR(100) NOT NULL COMMENT 'åº“åŒºåç§°',
    `area_type` VARCHAR(20) DEFAULT NULL COMMENT 'åº“åŒºç±»å‹:STORAGE-å­˜å‚¨åŒº,PICKING-æ‹£è´§åŒº,STAGING-æš‚å­˜åŒº',
    `floor` INT(11) DEFAULT 1 COMMENT 'æ¥¼å±‚',
    `area_size` DECIMAL(10,2) DEFAULT NULL COMMENT 'é¢ç§¯',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_area_code` (`warehouse_id`, `area_code`),
    KEY `idx_warehouse` (`warehouse_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“åŒºè¡¨';

-- åº“ä½è¡¨
CREATE TABLE `warehouse_location` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `area_id` BIGINT(20) NOT NULL COMMENT 'åº“åŒºID',
    `location_code` VARCHAR(50) NOT NULL COMMENT 'åº“ä½ç¼–ç ',
    `location_type` VARCHAR(20) DEFAULT 'NORMAL' COMMENT 'åº“ä½ç±»å‹:NORMAL-æ™®é€š,TEMP-ä¸´æ—¶,DEFECT-æ®‹æ¬¡å“',
    `row_no` INT(11) DEFAULT NULL COMMENT 'æ’å·',
    `column_no` INT(11) DEFAULT NULL COMMENT 'åˆ—å·',
    `layer_no` INT(11) DEFAULT NULL COMMENT 'å±‚å·',
    `capacity` DECIMAL(10,2) DEFAULT NULL COMMENT 'å®¹é‡',
    `max_weight` DECIMAL(10,2) DEFAULT NULL COMMENT 'æœ€å¤§æ‰¿é‡(KG)',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-ç©ºé—²,2-å ç”¨,3-é”å®š,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_location_code` (`warehouse_id`, `location_code`),
    KEY `idx_area` (`area_id`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“ä½è¡¨';

-- ================================
-- 2. å•†å“ç®¡ç†è¡¨
-- ================================

-- å•†å“åˆ†ç±»è¡¨
CREATE TABLE `goods_category` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `category_code` VARCHAR(50) NOT NULL COMMENT 'åˆ†ç±»ç¼–ç ',
    `category_name` VARCHAR(100) NOT NULL COMMENT 'åˆ†ç±»åç§°',
    `parent_id` BIGINT(20) DEFAULT 0 COMMENT 'çˆ¶åˆ†ç±»ID',
    `level` INT(11) DEFAULT 1 COMMENT 'å±‚çº§',
    `sort_order` INT(11) DEFAULT 0 COMMENT 'æ’åº',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_category_code` (`category_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“åˆ†ç±»è¡¨';

-- å•†å“ä¿¡æ¯è¡¨
CREATE TABLE `goods` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `category_id` BIGINT(20) DEFAULT NULL COMMENT 'åˆ†ç±»ID',
    `brand` VARCHAR(100) DEFAULT NULL COMMENT 'å“ç‰Œ',
    `model` VARCHAR(100) DEFAULT NULL COMMENT 'å‹å·',
    `barcode` VARCHAR(50) DEFAULT NULL COMMENT 'æ¡å½¢ç ',
    `unit` VARCHAR(20) DEFAULT 'PCS' COMMENT 'è®¡é‡å•ä½',
    `spec` VARCHAR(200) DEFAULT NULL COMMENT 'è§„æ ¼',
    `weight` DECIMAL(10,3) DEFAULT NULL COMMENT 'é‡é‡(KG)',
    `volume` DECIMAL(10,3) DEFAULT NULL COMMENT 'ä½“ç§¯(ç«‹æ–¹ç±³)',
    `shelf_life` INT(11) DEFAULT NULL COMMENT 'ä¿è´¨æœŸ(å¤©)',
    `storage_temp_min` DECIMAL(5,2) DEFAULT NULL COMMENT 'æœ€ä½å­˜å‚¨æ¸©åº¦',
    `storage_temp_max` DECIMAL(5,2) DEFAULT NULL COMMENT 'æœ€é«˜å­˜å‚¨æ¸©åº¦',
    `need_batch` TINYINT(4) DEFAULT 0 COMMENT 'æ˜¯å¦æ‰¹æ¬¡ç®¡ç†:1-æ˜¯,0-å¦',
    `need_serial` TINYINT(4) DEFAULT 0 COMMENT 'æ˜¯å¦åºåˆ—å·ç®¡ç†:1-æ˜¯,0-å¦',
    `safety_stock` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®‰å…¨åº“å­˜',
    `max_stock` DECIMAL(10,2) DEFAULT NULL COMMENT 'æœ€å¤§åº“å­˜',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¯ç”¨,0-ç¦ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_sku_code` (`sku_code`),
    KEY `idx_category` (`category_id`),
    KEY `idx_barcode` (`barcode`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å“ä¿¡æ¯è¡¨';

-- ================================
-- 3. åº“å­˜ç®¡ç†è¡¨
-- ================================

-- åº“å­˜è¡¨
CREATE TABLE `inventory` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'åº“ä½ID',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `serial_no` VARCHAR(50) DEFAULT NULL COMMENT 'åºåˆ—å·',
    `quantity` DECIMAL(10,2) NOT NULL DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
    `lock_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'é”å®šæ•°é‡',
    `available_quantity` DECIMAL(10,2) GENERATED ALWAYS AS (`quantity` - `lock_quantity`) VIRTUAL COMMENT 'å¯ç”¨æ•°é‡',
    `production_date` DATE DEFAULT NULL COMMENT 'ç”Ÿäº§æ—¥æœŸ',
    `expire_date` DATE DEFAULT NULL COMMENT 'è¿‡æœŸæ—¥æœŸ',
    `inbound_date` DATETIME DEFAULT NULL COMMENT 'å…¥åº“æ—¥æœŸ',
    `supplier_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¾›åº”å•†ID',
    `supplier_name` VARCHAR(100) DEFAULT NULL COMMENT 'ä¾›åº”å•†åç§°',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-æ­£å¸¸,2-å†»ç»“,3-å¾…æ£€,4-æŸå',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_inventory` (`warehouse_id`, `location_id`, `goods_id`, `batch_no`, `serial_no`),
    KEY `idx_goods` (`goods_id`),
    KEY `idx_location` (`location_id`),
    KEY `idx_batch` (`batch_no`),
    KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜è¡¨';

-- åº“å­˜æµæ°´è¡¨
CREATE TABLE `inventory_log` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'åº“ä½ID',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `operation_type` VARCHAR(20) NOT NULL COMMENT 'æ“ä½œç±»å‹:INBOUND-å…¥åº“,OUTBOUND-å‡ºåº“,MOVE-ç§»åº“,LOCK-é”å®š,UNLOCK-è§£é”',
    `quantity_before` DECIMAL(10,2) DEFAULT NULL COMMENT 'æ“ä½œå‰æ•°é‡',
    `quantity_change` DECIMAL(10,2) NOT NULL COMMENT 'å˜åŒ–æ•°é‡',
    `quantity_after` DECIMAL(10,2) DEFAULT NULL COMMENT 'æ“ä½œåæ•°é‡',
    `business_type` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    `business_no` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸šåŠ¡å•å·',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_warehouse_goods` (`warehouse_id`, `goods_id`),
    KEY `idx_business` (`business_type`, `business_no`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åº“å­˜æµæ°´è¡¨';

-- ================================
-- 4. å…¥åº“ç®¡ç†è¡¨
-- ================================

-- å…¥åº“å•è¡¨
CREATE TABLE `inbound_order` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `inbound_no` VARCHAR(50) NOT NULL COMMENT 'å…¥åº“å•å·',
    `warehouse_id` BIGINT(20) NOT NULL COMMENT 'ä»“åº“ID',
    `inbound_type` VARCHAR(20) NOT NULL COMMENT 'å…¥åº“ç±»å‹:PURCHASE-é‡‡è´­,RETURN-é€€è´§,TRANSFER-è°ƒæ‹¨,OTHER-å…¶ä»–',
    `source_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ¥æºå•å·',
    `supplier_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¾›åº”å•†ID',
    `supplier_name` VARCHAR(100) DEFAULT NULL COMMENT 'ä¾›åº”å•†åç§°',
    `expect_time` DATETIME DEFAULT NULL COMMENT 'é¢„è®¡åˆ°è´§æ—¶é—´',
    `actual_time` DATETIME DEFAULT NULL COMMENT 'å®é™…åˆ°è´§æ—¶é—´',
    `total_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'æ€»æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®æ”¶æ•°é‡',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…å®¡æ ¸,2-å¾…å…¥åº“,3-å…¥åº“ä¸­,4-å·²å®Œæˆ,5-å·²å–æ¶ˆ',
    `audit_user` VARCHAR(50) DEFAULT NULL COMMENT 'å®¡æ ¸äºº',
    `audit_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ ¸æ—¶é—´',
    `operator` VARCHAR(50) DEFAULT NULL COMMENT 'æ“ä½œäºº',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_inbound_no` (`inbound_no`),
    KEY `idx_warehouse` (`warehouse_id`),
    KEY `idx_status` (`status`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å…¥åº“å•è¡¨';

-- å…¥åº“å•æ˜ç»†è¡¨
CREATE TABLE `inbound_detail` (
    `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `inbound_id` BIGINT(20) NOT NULL COMMENT 'å…¥åº“å•ID',
    `inbound_no` VARCHAR(50) NOT NULL COMMENT 'å…¥åº“å•å·',
    `goods_id` BIGINT(20) NOT NULL COMMENT 'å•†å“ID',
    `sku_code` VARCHAR(50) NOT NULL COMMENT 'SKUç¼–ç ',
    `goods_name` VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    `batch_no` VARCHAR(50) DEFAULT NULL COMMENT 'æ‰¹æ¬¡å·',
    `production_date` DATE DEFAULT NULL COMMENT 'ç”Ÿäº§æ—¥æœŸ',
    `expire_date` DATE DEFAULT NULL COMMENT 'è¿‡æœŸæ—¥æœŸ',
    `plan_quantity` DECIMAL(10,2) NOT NULL COMMENT 'è®¡åˆ’æ•°é‡',
    `actual_quantity` DECIMAL(10,2) DEFAULT 0 COMMENT 'å®æ”¶æ•°é‡',
    `location_id` BIGINT(20) DEFAULT NULL COMMENT 'ä¸Šæ¶åº“ä½ID',
    `location_code` VARCHAR(50) DEFAULT NULL COMMENT 'ä¸Šæ¶åº“ä½ç¼–ç ',
    `status` TINYINT(4) DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…æ”¶è´§,2-å·²æ”¶è´§,3-å·²ä¸Šæ¶',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_inbound` (`inbound_id`),
    KEY `idx_goods` (`goods_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å…¥åº“å•æ˜ç»†è¡¨';

---

## å››ã€æ ¸å¿ƒä¸šåŠ¡å®ç°

### 4.1 åº“å­˜æœåŠ¡å®ç°

#### å®ä½“ç±»å®šä¹‰

```java
package com.wms.inventory.entity;

import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalDateTime;

/**
 * åº“å­˜å®ä½“
 */
@Data
@TableName("inventory")
public class Inventory {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    /**
     * ä»“åº“ID
     */
    private Long warehouseId;
    
    /**
     * åº“ä½ID
     */
    private Long locationId;
    
    /**
     * å•†å“ID
     */
    private Long goodsId;
    
    /**
     * æ‰¹æ¬¡å·
     */
    private String batchNo;
    
    /**
     * åºåˆ—å·
     */
    private String serialNo;
    
    /**
     * åº“å­˜æ•°é‡
     */
    private BigDecimal quantity;
    
    /**
     * é”å®šæ•°é‡
     */
    private BigDecimal lockQuantity;
    
    /**
     * å¯ç”¨æ•°é‡ï¼ˆè™šæ‹Ÿåˆ—ï¼Œè‡ªåŠ¨è®¡ç®—ï¼‰
     */
    private BigDecimal availableQuantity;
    
    /**
     * ç”Ÿäº§æ—¥æœŸ
     */
    private LocalDate productionDate;
    
    /**
     * è¿‡æœŸæ—¥æœŸ
     */
    private LocalDate expireDate;
    
    /**
     * å…¥åº“æ—¥æœŸ
     */
    private LocalDateTime inboundDate;
    
    /**
     * ä¾›åº”å•†ID
     */
    private Long supplierId;
    
    /**
     * ä¾›åº”å•†åç§°
     */
    private String supplierName;
    
    /**
     * çŠ¶æ€:1-æ­£å¸¸,2-å†»ç»“,3-å¾…æ£€,4-æŸå
     */
    private Integer status;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
}
```

#### åº“å­˜æœåŠ¡æ¥å£

```java
package com.wms.inventory.service;

import com.wms.inventory.dto.InventoryLockDTO;
import com.wms.inventory.dto.InventoryQueryDTO;
import com.wms.inventory.vo.InventoryVO;
import java.math.BigDecimal;
import java.util.List;

/**
 * åº“å­˜æœåŠ¡æ¥å£
 */
public interface InventoryService {
    
    /**
     * æŸ¥è¯¢åº“å­˜
     */
    List<InventoryVO> queryInventory(InventoryQueryDTO queryDTO);
    
    /**
     * é”å®šåº“å­˜
     */
    boolean lockInventory(InventoryLockDTO lockDTO);
    
    /**
     * è§£é”åº“å­˜
     */
    boolean unlockInventory(InventoryLockDTO lockDTO);
    
    /**
     * æ‰£å‡åº“å­˜
     */
    boolean deductInventory(Long warehouseId, Long goodsId, String batchNo, BigDecimal quantity);
    
    /**
     * å¢åŠ åº“å­˜
     */
    boolean addInventory(Long warehouseId, Long locationId, Long goodsId, String batchNo, BigDecimal quantity);
    
    /**
     * è·å–å¯ç”¨åº“å­˜æ•°é‡
     */
    BigDecimal getAvailableQuantity(Long warehouseId, Long goodsId, String batchNo);
    
    /**
     * åº“å­˜é¢„è­¦æ£€æŸ¥
     */
    List<InventoryVO> checkInventoryAlert();
}
```

#### åº“å­˜æœåŠ¡å®ç°ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

```java
package com.wms.inventory.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.wms.inventory.entity.Inventory;
import com.wms.inventory.entity.InventoryLog;
import com.wms.inventory.mapper.InventoryMapper;
import com.wms.inventory.mapper.InventoryLogMapper;
import com.wms.inventory.service.InventoryService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.concurrent.TimeUnit;

/**
 * åº“å­˜æœåŠ¡å®ç°
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class InventoryServiceImpl implements InventoryService {
    
    private final InventoryMapper inventoryMapper;
    private final InventoryLogMapper inventoryLogMapper;
    private final RedisTemplate<String, Object> redisTemplate;
    
    private static final String LOCK_KEY_PREFIX = "inventory:lock:";
    private static final String CACHE_KEY_PREFIX = "inventory:cache:";
    
    /**
     * é”å®šåº“å­˜ï¼ˆæ”¯æŒåˆ†å¸ƒå¼é”ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean lockInventory(InventoryLockDTO lockDTO) {
        String lockKey = LOCK_KEY_PREFIX + lockDTO.getWarehouseId() + ":" + lockDTO.getGoodsId();
        
        try {
            // è·å–åˆ†å¸ƒå¼é”
            Boolean acquired = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, "LOCKED", 10, TimeUnit.SECONDS);
            
            if (Boolean.FALSE.equals(acquired)) {
                log.warn("è·å–åº“å­˜é”å¤±è´¥: {}", lockKey);
                return false;
            }
            
            // æŸ¥è¯¢å¯ç”¨åº“å­˜
            Inventory inventory = getInventoryForUpdate(
                lockDTO.getWarehouseId(), 
                lockDTO.getGoodsId(), 
                lockDTO.getBatchNo()
            );
            
            if (inventory == null) {
                log.error("åº“å­˜ä¸å­˜åœ¨: warehouseId={}, goodsId={}", 
                    lockDTO.getWarehouseId(), lockDTO.getGoodsId());
                return false;
            }
            
            // æ£€æŸ¥å¯ç”¨åº“å­˜æ˜¯å¦å……è¶³
            BigDecimal available = inventory.getQuantity().subtract(inventory.getLockQuantity());
            if (available.compareTo(lockDTO.getQuantity()) < 0) {
                log.warn("åº“å­˜ä¸è¶³: å¯ç”¨={}, éœ€è¦={}", available, lockDTO.getQuantity());
                return false;
            }
            
            // æ›´æ–°é”å®šæ•°é‡
            inventory.setLockQuantity(inventory.getLockQuantity().add(lockDTO.getQuantity()));
            inventoryMapper.updateById(inventory);
            
            // è®°å½•åº“å­˜æµæ°´
            saveInventoryLog(inventory, "LOCK", lockDTO.getQuantity(), 
                lockDTO.getBusinessType(), lockDTO.getBusinessNo());
            
            // æ¸…é™¤ç¼“å­˜
            clearInventoryCache(lockDTO.getWarehouseId(), lockDTO.getGoodsId());
            
            log.info("åº“å­˜é”å®šæˆåŠŸ: {}", lockDTO);
            return true;
            
        } finally {
            // é‡Šæ”¾åˆ†å¸ƒå¼é”
            redisTemplate.delete(lockKey);
        }
    }
    
    /**
     * æ‰£å‡åº“å­˜ï¼ˆå‡ºåº“æ—¶è°ƒç”¨ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean deductInventory(Long warehouseId, Long goodsId, String batchNo, BigDecimal quantity) {
        String lockKey = LOCK_KEY_PREFIX + warehouseId + ":" + goodsId;
        
        try {
            Boolean acquired = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, "LOCKED", 10, TimeUnit.SECONDS);
            
            if (Boolean.FALSE.equals(acquired)) {
                return false;
            }
            
            Inventory inventory = getInventoryForUpdate(warehouseId, goodsId, batchNo);
            
            if (inventory == null) {
                log.error("æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸å­˜åœ¨");
                return false;
            }
            
            // æ‰£å‡åº“å­˜æ•°é‡å’Œé”å®šæ•°é‡
            BigDecimal newQuantity = inventory.getQuantity().subtract(quantity);
            BigDecimal newLockQuantity = inventory.getLockQuantity().subtract(quantity);
            
            if (newQuantity.compareTo(BigDecimal.ZERO) < 0) {
                log.error("æ‰£å‡å¤±è´¥ï¼Œåº“å­˜ä¸è¶³");
                return false;
            }
            
            inventory.setQuantity(newQuantity);
            inventory.setLockQuantity(newLockQuantity.max(BigDecimal.ZERO));
            inventoryMapper.updateById(inventory);
            
            // è®°å½•æµæ°´
            saveInventoryLog(inventory, "OUTBOUND", quantity.negate(), "OUTBOUND", null);
            
            clearInventoryCache(warehouseId, goodsId);
            
            return true;
            
        } finally {
            redisTemplate.delete(lockKey);
        }
    }
    
    /**
     * å¢åŠ åº“å­˜ï¼ˆå…¥åº“æ—¶è°ƒç”¨ï¼‰
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public boolean addInventory(Long warehouseId, Long locationId, Long goodsId, 
                                String batchNo, BigDecimal quantity) {
        
        // æŸ¥è¯¢æ˜¯å¦å·²æœ‰åº“å­˜è®°å½•
        LambdaQueryWrapper<Inventory> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(Inventory::getWarehouseId, warehouseId)
               .eq(Inventory::getLocationId, locationId)
               .eq(Inventory::getGoodsId, goodsId)
               .eq(batchNo != null, Inventory::getBatchNo, batchNo);
        
        Inventory inventory = inventoryMapper.selectOne(wrapper);
        
        if (inventory != null) {
            // å·²å­˜åœ¨ï¼Œç´¯åŠ æ•°é‡
            inventory.setQuantity(inventory.getQuantity().add(quantity));
            inventoryMapper.updateById(inventory);
        } else {
            // æ–°å¢åº“å­˜è®°å½•
            inventory = new Inventory();
            inventory.setWarehouseId(warehouseId);
            inventory.setLocationId(locationId);
            inventory.setGoodsId(goodsId);
            inventory.setBatchNo(batchNo);
            inventory.setQuantity(quantity);
            inventory.setLockQuantity(BigDecimal.ZERO);
            inventory.setStatus(1);
            inventory.setInboundDate(LocalDateTime.now());
            inventoryMapper.insert(inventory);
        }
        
        // è®°å½•æµæ°´
        saveInventoryLog(inventory, "INBOUND", quantity, "INBOUND", null);
        
        clearInventoryCache(warehouseId, goodsId);
        
        return true;
    }
    
    /**
     * æŸ¥è¯¢åº“å­˜ï¼ˆå¸¦è¡Œé”ï¼‰
     */
    private Inventory getInventoryForUpdate(Long warehouseId, Long goodsId, String batchNo) {
        LambdaQueryWrapper<Inventory> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(Inventory::getWarehouseId, warehouseId)
               .eq(Inventory::getGoodsId, goodsId)
               .eq(batchNo != null, Inventory::getBatchNo, batchNo)
               .eq(Inventory::getStatus, 1)
               .last("FOR UPDATE");
        
        return inventoryMapper.selectOne(wrapper);
    }
    
    /**
     * ä¿å­˜åº“å­˜æµæ°´
     */
    private void saveInventoryLog(Inventory inventory, String operationType, 
                                  BigDecimal quantityChange, String businessType, String businessNo) {
        InventoryLog log = new InventoryLog();
        log.setWarehouseId(inventory.getWarehouseId());
        log.setGoodsId(inventory.getGoodsId());
        log.setLocationId(inventory.getLocationId());
        log.setBatchNo(inventory.getBatchNo());
        log.setOperationType(operationType);
        log.setQuantityBefore(inventory.getQuantity().subtract(quantityChange));
        log.setQuantityChange(quantityChange);
        log.setQuantityAfter(inventory.getQuantity());
        log.setBusinessType(businessType);
        log.setBusinessNo(businessNo);
        
        inventoryLogMapper.insert(log);
    }
    
    /**
     * æ¸…é™¤åº“å­˜ç¼“å­˜
     */
    private void clearInventoryCache(Long warehouseId, Long goodsId) {
        String cacheKey = CACHE_KEY_PREFIX + warehouseId + ":" + goodsId;
        redisTemplate.delete(cacheKey);
    }
}
```

### 4.2 å‡ºåº“æœåŠ¡å®ç°

#### å‡ºåº“è®¢å•å®ä½“

```java
package com.wms.outbound.entity;

import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;
import java.math.BigDecimal;
import java.time.LocalDateTime;

@Data
@TableName("outbound_order")
public class OutboundOrder {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String outboundNo;
    private Long warehouseId;
    private String outboundType; // SALE-é”€å”®, TRANSFER-è°ƒæ‹¨, SCRAP-æŠ¥æŸ
    private String customerCode;
    private String customerName;
    private String deliveryAddress;
    private String contactPhone;
    private LocalDateTime expectTime;
    private LocalDateTime actualTime;
    private BigDecimal totalQuantity;
    private BigDecimal actualQuantity;
    private Integer priority; // ä¼˜å…ˆçº§: 1-æ™®é€š, 2-ç´§æ€¥, 3-ç‰¹æ€¥
    private Integer status; // 1-å¾…å®¡æ ¸, 2-å¾…å‡ºåº“, 3-æ‹£è´§ä¸­, 4-å·²å®Œæˆ, 5-å·²å–æ¶ˆ
    private String auditUser;
    private LocalDateTime auditTime;
    private String operator;
    private String remark;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
}
```

#### å‡ºåº“æœåŠ¡å®ç°

```java
package com.wms.outbound.service.impl;

import com.wms.outbound.entity.OutboundOrder;
import com.wms.outbound.entity.OutboundDetail;
import com.wms.outbound.mapper.OutboundOrderMapper;
import com.wms.inventory.service.InventoryService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

/**
 * å‡ºåº“æœåŠ¡å®ç°
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class OutboundServiceImpl {
    
    private final OutboundOrderMapper outboundOrderMapper;
    private final InventoryService inventoryService;
    private final PickingService pickingService;
    
    /**
     * åˆ›å»ºå‡ºåº“å•
     */
    @Transactional(rollbackFor = Exception.class)
    public Long createOutboundOrder(OutboundOrderDTO dto) {
        // 1. åˆ›å»ºå‡ºåº“å•
        OutboundOrder order = new OutboundOrder();
        order.setOutboundNo(generateOutboundNo());
        order.setWarehouseId(dto.getWarehouseId());
        order.setOutboundType(dto.getOutboundType());
        order.setCustomerCode(dto.getCustomerCode());
        order.setCustomerName(dto.getCustomerName());
        order.setStatus(1); // å¾…å®¡æ ¸
        outboundOrderMapper.insert(order);
        
        // 2. åˆ›å»ºå‡ºåº“æ˜ç»†
        dto.getDetails().forEach(detail -> {
            OutboundDetail outboundDetail = new OutboundDetail();
            outboundDetail.setOutboundId(order.getId());
            outboundDetail.setGoodsId(detail.getGoodsId());
            outboundDetail.setPlanQuantity(detail.getQuantity());
            // ... ä¿å­˜æ˜ç»†
        });
        
        return order.getId();
    }
    
    /**
     * å®¡æ ¸å‡ºåº“å•
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean auditOutboundOrder(Long orderId, boolean approved) {
        OutboundOrder order = outboundOrderMapper.selectById(orderId);
        
        if (approved) {
            // å®¡æ ¸é€šè¿‡ï¼Œé”å®šåº“å­˜
            boolean locked = lockInventoryForOrder(order);
            if (!locked) {
                throw new BizException("åº“å­˜ä¸è¶³ï¼Œå®¡æ ¸å¤±è´¥");
            }
            order.setStatus(2); // å¾…å‡ºåº“
        } else {
            order.setStatus(5); // å·²å–æ¶ˆ
        }
        
        order.setAuditTime(LocalDateTime.now());
        outboundOrderMapper.updateById(order);
        
        return true;
    }
    
    /**
     * åˆ›å»ºæ‹£è´§ä»»åŠ¡
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean createPickingTask(Long orderId) {
        OutboundOrder order = outboundOrderMapper.selectById(orderId);
        
        if (order.getStatus() != 2) {
            throw new BizException("è®¢å•çŠ¶æ€ä¸æ­£ç¡®");
        }
        
        // åˆ›å»ºæ‹£è´§ä»»åŠ¡
        pickingService.createPickingTask(order);
        
        order.setStatus(3); // æ‹£è´§ä¸­
        outboundOrderMapper.updateById(order);
        
        return true;
    }
    
    /**
     * å‡ºåº“å®Œæˆ
     */
    @Transactional(rollbackFor = Exception.class)
    public boolean completeOutbound(Long orderId) {
        OutboundOrder order = outboundOrderMapper.selectById(orderId);
        
        // æ‰£å‡åº“å­˜
        boolean deducted = deductInventoryForOrder(order);
        if (!deducted) {
            throw new BizException("åº“å­˜æ‰£å‡å¤±è´¥");
        }
        
        order.setStatus(4); // å·²å®Œæˆ
        order.setActualTime(LocalDateTime.now());
        outboundOrderMapper.updateById(order);
        
        return true;
    }
    
    /**
     * ä¸ºè®¢å•é”å®šåº“å­˜
     */
    private boolean lockInventoryForOrder(OutboundOrder order) {
        // æŸ¥è¯¢å‡ºåº“æ˜ç»†ï¼Œé€ä¸ªé”å®šåº“å­˜
        // ... å®ç°é€»è¾‘
        return true;
    }
    
    /**
     * ä¸ºè®¢å•æ‰£å‡åº“å­˜
     */
    private boolean deductInventoryForOrder(OutboundOrder order) {
        // æŸ¥è¯¢å‡ºåº“æ˜ç»†ï¼Œé€ä¸ªæ‰£å‡åº“å­˜
        // ... å®ç°é€»è¾‘
        return true;
    }
    
    /**
     * ç”Ÿæˆå‡ºåº“å•å·
     */
    private String generateOutboundNo() {
        return "OUT" + System.currentTimeMillis();
    }
}
```

### 4.3 æ‹£è´§æœåŠ¡å®ç°

#### æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•

```java
package com.wms.picking.service;

import lombok.Data;
import java.util.*;

/**
 * æ‹£è´§è·¯å¾„ä¼˜åŒ–æœåŠ¡
 */
@Service
public class PickingPathOptimizer {
    
    /**
     * ä½¿ç”¨è´ªå¿ƒç®—æ³•ä¼˜åŒ–æ‹£è´§è·¯å¾„
     */
    public List<PickingLocation> optimizePath(List<PickingLocation> locations) {
        if (locations.size() <= 1) {
            return locations;
        }
        
        List<PickingLocation> optimized = new ArrayList<>();
        Set<PickingLocation> unvisited = new HashSet<>(locations);
        
        // ä»èµ·ç‚¹ï¼ˆåº“åŒºå…¥å£ï¼‰å¼€å§‹
        PickingLocation current = findNearestToEntrance(unvisited);
        optimized.add(current);
        unvisited.remove(current);
        
        // è´ªå¿ƒç®—æ³•ï¼šæ¯æ¬¡é€‰æ‹©è·ç¦»å½“å‰ä½ç½®æœ€è¿‘çš„ç‚¹
        while (!unvisited.isEmpty()) {
            PickingLocation nearest = findNearest(current, unvisited);
            optimized.add(nearest);
            unvisited.remove(nearest);
            current = nearest;
        }
        
        return optimized;
    }
    
    /**
     * è®¡ç®—ä¸¤ä¸ªåº“ä½ä¹‹é—´çš„è·ç¦»
     */
    private double calculateDistance(PickingLocation loc1, PickingLocation loc2) {
        // æ›¼å“ˆé¡¿è·ç¦»
        int rowDiff = Math.abs(loc1.getRowNo() - loc2.getRowNo());
        int colDiff = Math.abs(loc1.getColumnNo() - loc2.getColumnNo());
        int layerDiff = Math.abs(loc1.getLayerNo() - loc2.getLayerNo());
        
        return rowDiff + colDiff + layerDiff * 2; // å±‚é—´ç§»åŠ¨æˆæœ¬æ›´é«˜
    }
    
    /**
     * æ‰¾åˆ°è·ç¦»å½“å‰ä½ç½®æœ€è¿‘çš„åº“ä½
     */
    private PickingLocation findNearest(PickingLocation current, Set<PickingLocation> candidates) {
        return candidates.stream()
            .min(Comparator.comparingDouble(loc -> calculateDistance(current, loc)))
            .orElseThrow();
    }
    
    /**
     * æ‰¾åˆ°è·ç¦»å…¥å£æœ€è¿‘çš„åº“ä½
     */
    private PickingLocation findNearestToEntrance(Set<PickingLocation> locations) {
        PickingLocation entrance = new PickingLocation(0, 0, 0);
        return findNearest(entrance, locations);
    }
}

@Data
class PickingLocation {
    private Long locationId;
    private String locationCode;
    private Integer rowNo;
    private Integer columnNo;
    private Integer layerNo;
    
    public PickingLocation(int row, int col, int layer) {
        this.rowNo = row;
        this.columnNo = col;
        this.layerNo = layer;
    }
}
```

---

## äº”ã€å‰ç«¯å®ç°

### 5.1 åº“å­˜ç®¡ç†é¡µé¢

```vue
<template>
  <div class="inventory-container">
    <!-- æœç´¢åŒºåŸŸ -->
    <el-card class="search-card">
      <el-form :inline="true" :model="searchForm">
        <el-form-item label="å•†å“åç§°">
          <el-input v-model="searchForm.goodsName" placeholder="è¯·è¾“å…¥å•†å“åç§°" clearable />
        </el-form-item>
        <el-form-item label="SKUç¼–ç ">
          <el-input v-model="searchForm.skuCode" placeholder="è¯·è¾“å…¥SKUç¼–ç " clearable />
        </el-form-item>
        <el-form-item label="ä»“åº“">
          <el-select v-model="searchForm.warehouseId" placeholder="è¯·é€‰æ‹©ä»“åº“" clearable>
            <el-option
              v-for="item in warehouseList"
              :key="item.id"
              :label="item.warehouseName"
              :value="item.id"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="åº“å­˜çŠ¶æ€">
          <el-select v-model="searchForm.status" placeholder="è¯·é€‰æ‹©çŠ¶æ€" clearable>
            <el-option label="æ­£å¸¸" :value="1" />
            <el-option label="å†»ç»“" :value="2" />
            <el-option label="å¾…æ£€" :value="3" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch" icon="Search">æŸ¥è¯¢</el-button>
          <el-button @click="handleReset" icon="Refresh">é‡ç½®</el-button>
          <el-button type="success" @click="handleExport" icon="Download">å¯¼å‡º</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- åº“å­˜é¢„è­¦æç¤º -->
    <el-alert
      v-if="alertCount > 0"
      title="åº“å­˜é¢„è­¦"
      type="warning"
      :description="`å½“å‰æœ‰ ${alertCount} ä¸ªå•†å“åº“å­˜ä¸è¶³ï¼Œè¯·åŠæ—¶è¡¥è´§`"
      show-icon
      :closable="false"
      :style="{ margin: '20px 0' }"
    />

    <!-- æ•°æ®è¡¨æ ¼ -->
    <el-card class="table-card">
      <vxe-table
        ref="tableRef"
        :data="tableData"
        :loading="loading"
        border
        stripe
        height="600"
        :row-config="{ isHover: true }"
      >
        <vxe-column type="seq" title="åºå·" width="60" />
        <vxe-column field="warehouseName" title="ä»“åº“" width="120" />
        <vxe-column field="locationCode" title="åº“ä½" width="100" />
        <vxe-column field="skuCode" title="SKUç¼–ç " width="150" />
        <vxe-column field="goodsName" title="å•†å“åç§°" min-width="200" />
        <vxe-column field="batchNo" title="æ‰¹æ¬¡å·" width="120" />
        <vxe-column field="quantity" title="æ€»åº“å­˜" width="100" align="right">
          <template #default="{ row }">
            <span :class="{ 'text-danger': row.quantity < row.safetyStock }">
              {{ row.quantity }}
            </span>
          </template>
        </vxe-column>
        <vxe-column field="lockQuantity" title="é”å®šæ•°é‡" width="100" align="right" />
        <vxe-column field="availableQuantity" title="å¯ç”¨åº“å­˜" width="100" align="right">
          <template #default="{ row }">
            <el-tag :type="getStockTagType(row)">
              {{ row.availableQuantity }}
            </el-tag>
          </template>
        </vxe-column>
        <vxe-column field="status" title="çŠ¶æ€" width="80">
          <template #default="{ row }">
            <el-tag :type="getStatusType(row.status)">
              {{ getStatusText(row.status) }}
            </el-tag>
          </template>
        </vxe-column>
        <vxe-column field="inboundDate" title="å…¥åº“æ—¥æœŸ" width="150" />
        <vxe-column title="æ“ä½œ" width="200" fixed="right">
          <template #default="{ row }">
            <el-button link type="primary" @click="handleView(row)">è¯¦æƒ…</el-button>
            <el-button link type="warning" @click="handleMove(row)">ç§»åº“</el-button>
            <el-button link type="danger" @click="handleFreeze(row)">å†»ç»“</el-button>
          </template>
        </vxe-column>
      </vxe-table>

      <!-- åˆ†é¡µ -->
      <el-pagination
        v-model:current-page="pagination.page"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSearch"
        @current-change="handleSearch"
      />
    </el-card>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { getInventoryList, freezeInventory } from '@/api/inventory'

// æœç´¢è¡¨å•
const searchForm = reactive({
  goodsName: '',
  skuCode: '',
  warehouseId: null,
  status: null
})

// è¡¨æ ¼æ•°æ®
const tableData = ref([])
const loading = ref(false)
const alertCount = ref(0)

// åˆ†é¡µ
const pagination = reactive({
  page: 1,
  size: 20,
  total: 0
})

// æŸ¥è¯¢æ•°æ®
const handleSearch = async () => {
  loading.value = true
  try {
    const params = {
      ...searchForm,
      page: pagination.page,
      size: pagination.size
    }
    const { data } = await getInventoryList(params)
    tableData.value = data.records
    pagination.total = data.total
    alertCount.value = data.alertCount || 0
  } catch (error) {
    ElMessage.error('æŸ¥è¯¢å¤±è´¥')
  } finally {
    loading.value = false
  }
}

// é‡ç½®
const handleReset = () => {
  Object.assign(searchForm, {
    goodsName: '',
    skuCode: '',
    warehouseId: null,
    status: null
  })
  handleSearch()
}

// åº“å­˜æ ‡ç­¾ç±»å‹
const getStockTagType = (row) => {
  if (row.availableQuantity <= 0) return 'danger'
  if (row.availableQuantity < row.safetyStock) return 'warning'
  return 'success'
}

// çŠ¶æ€ç±»å‹
const getStatusType = (status) => {
  const map = { 1: 'success', 2: 'danger', 3: 'warning', 4: 'info' }
  return map[status] || ''
}

const getStatusText = (status) => {
  const map = { 1: 'æ­£å¸¸', 2: 'å†»ç»“', 3: 'å¾…æ£€', 4: 'æŸå' }
  return map[status] || ''
}

// å†»ç»“åº“å­˜
const handleFreeze = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦å†»ç»“è¯¥åº“å­˜å—ï¼Ÿ', 'æç¤º', {
      type: 'warning'
    })
    await freezeInventory(row.id)
    ElMessage.success('å†»ç»“æˆåŠŸ')
    handleSearch()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('æ“ä½œå¤±è´¥')
    }
  }
}

onMounted(() => {
  handleSearch()
})
</script>

<style scoped>
.inventory-container {
  padding: 20px;
}

.search-card {
  margin-bottom: 20px;
}

.text-danger {
  color: #f56c6c;
  font-weight: bold;
}
</style>
```

### 5.2 å…¥åº“ç®¡ç†é¡µé¢ï¼ˆæµç¨‹å›¾ï¼‰

```mermaid
flowchart LR
    Start[åˆ›å»ºå…¥åº“å•] --> Upload[ä¸Šä¼ å•æ®]
    Upload --> Review[å®¡æ ¸]
    Review -->|é€šè¿‡| Receive[æ”¶è´§]
    Review -->|é©³å›| End1[ç»“æŸ]
    Receive --> Quality[è´¨æ£€]
    Quality -->|åˆæ ¼| PutAway[ä¸Šæ¶]
    Quality -->|ä¸åˆæ ¼| Return[é€€å›]
    PutAway --> Complete[å®Œæˆ]
    
    style Start fill:#e8f5e9
    style Complete fill:#c8e6c9
    style End1 fill:#ffcdd2
```

### 5.3 ä»“åº“å¤§å±ç›‘æ§

```vue
<template>
  <div class="warehouse-screen">
    <div class="screen-header">
      <h1>ğŸ¢ æ™ºèƒ½ä»“åº“ç›‘æ§å¤§å±</h1>
      <div class="datetime">{{ currentTime }}</div>
    </div>

    <div class="screen-content">
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-row">
        <div class="stat-card" v-for="stat in stats" :key="stat.label">
          <div class="stat-icon" :style="{ background: stat.color }">
            {{ stat.icon }}
          </div>
          <div class="stat-content">
            <div class="stat-value">{{ stat.value }}</div>
            <div class="stat-label">{{ stat.label }}</div>
          </div>
        </div>
      </div>

      <!-- å›¾è¡¨åŒºåŸŸ -->
      <div class="charts-row">
        <div class="chart-container">
          <h3>ğŸ“Š å‡ºå…¥åº“è¶‹åŠ¿</h3>
          <div ref="trendChart" class="chart"></div>
        </div>
        <div class="chart-container">
          <h3>ğŸ¥§ åº“å­˜åˆ†å¸ƒ</h3>
          <div ref="pieChart" class="chart"></div>
        </div>
        <div class="chart-container">
          <h3>ğŸ“ˆ åº“ä½åˆ©ç”¨ç‡</h3>
          <div ref="barChart" class="chart"></div>
        </div>
      </div>

      <!-- å®æ—¶ä»»åŠ¡ -->
      <div class="tasks-row">
        <div class="task-list">
          <h3>ğŸ¯ æ‹£è´§ä»»åŠ¡</h3>
          <el-scrollbar height="300px">
            <div v-for="task in pickingTasks" :key="task.id" class="task-item">
              <div class="task-info">
                <span class="task-no">{{ task.taskNo }}</span>
                <el-tag :type="getTaskTagType(task.status)">
                  {{ task.statusText }}
                </el-tag>
              </div>
              <el-progress :percentage="task.progress" />
            </div>
          </el-scrollbar>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted, onUnmounted } from 'vue'
import * as echarts from 'echarts'
import dayjs from 'dayjs'

const currentTime = ref(dayjs().format('YYYY-MM-DD HH:mm:ss'))

// ç»Ÿè®¡æ•°æ®
const stats = ref([
  { label: 'æ€»åº“å­˜', value: '12,345', icon: 'ğŸ“¦', color: '#409EFF' },
  { label: 'ä»Šæ—¥å…¥åº“', value: '856', icon: 'ğŸ“¥', color: '#67C23A' },
  { label: 'ä»Šæ—¥å‡ºåº“', value: '1,032', icon: 'ğŸ“¤', color: '#E6A23C' },
  { label: 'é¢„è­¦å•†å“', value: '23', icon: 'âš ï¸', color: '#F56C6C' }
])

// ECharts å›¾è¡¨åˆå§‹åŒ–
const trendChart = ref(null)
const pieChart = ref(null)
const barChart = ref(null)

const initCharts = () => {
  // è¶‹åŠ¿å›¾
  const trend = echarts.init(trendChart.value)
  trend.setOption({
    tooltip: { trigger: 'axis' },
    legend: { data: ['å…¥åº“', 'å‡ºåº“'] },
    xAxis: { type: 'category', data: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'] },
    yAxis: { type: 'value' },
    series: [
      { name: 'å…¥åº“', type: 'line', data: [820, 932, 901, 934, 1290, 1330, 1320], smooth: true },
      { name: 'å‡ºåº“', type: 'line', data: [680, 732, 701, 734, 1090, 1130, 1120], smooth: true }
    ]
  })

  // é¥¼å›¾
  const pie = echarts.init(pieChart.value)
  pie.setOption({
    tooltip: { trigger: 'item' },
    series: [{
      type: 'pie',
      radius: '60%',
      data: [
        { value: 4500, name: 'ç”µå­äº§å“' },
        { value: 3200, name: 'æ—¥ç”¨å“' },
        { value: 2800, name: 'é£Ÿå“' },
        { value: 1845, name: 'å…¶ä»–' }
      ]
    }]
  })

  // æŸ±çŠ¶å›¾
  const bar = echarts.init(barChart.value)
  bar.setOption({
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'category', data: ['AåŒº', 'BåŒº', 'CåŒº', 'DåŒº', 'EåŒº'] },
    yAxis: { type: 'value', max: 100 },
    series: [{
      type: 'bar',
      data: [85, 92, 78, 88, 95],
      itemStyle: { color: '#409EFF' }
    }]
  })
}

onMounted(() => {
  initCharts()
  // å®šæ—¶åˆ·æ–°æ—¶é—´
  const timer = setInterval(() => {
    currentTime.value = dayjs().format('YYYY-MM-DD HH:mm:ss')
  }, 1000)
  
  onUnmounted(() => clearInterval(timer))
})
</script>

<style scoped>
.warehouse-screen {
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
  color: #fff;
  padding: 20px;
  overflow: hidden;
}

.screen-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  display: flex;
  align-items: center;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 20px;
}

.stat-icon {
  font-size: 48px;
  width: 80px;
  height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  margin-right: 20px;
}

.stat-value {
  font-size: 32px;
  font-weight: bold;
}

.charts-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.chart-container {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  padding: 20px;
}

.chart {
  height: 300px;
}
</style>
```

---

## å…­ã€éƒ¨ç½²æ–¹æ¡ˆ

### 6.1 å¾®æœåŠ¡æ¶æ„éƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  # Nacos æ³¨å†Œä¸­å¿ƒ
  nacos:
    image: nacos/nacos-server:v2.2.3
    container_name: wms-nacos
    environment:
      - MODE=standalone
      - SPRING_DATASOURCE_PLATFORM=mysql
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_DB_NAME=nacos
      - MYSQL_SERVICE_USER=root
      - MYSQL_SERVICE_PASSWORD=123456
    ports:
      - "8848:8848"
      - "9848:9848"
    networks:
      - wms-network
    depends_on:
      - mysql

  # MySQL æ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: wms-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=123456
      - MYSQL_DATABASE=wms
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ./init-sql:/docker-entrypoint-initdb.d
    networks:
      - wms-network

  # Redis ç¼“å­˜
  redis:
    image: redis:7.0-alpine
    container_name: wms-redis
    command: redis-server --requirepass 123456
    ports:
      - "6379:6379"
    networks:
      - wms-network

  # RocketMQ NameServer
  rocketmq-nameserver:
    image: apache/rocketmq:5.1.0
    container_name: wms-rocketmq-nameserver
    command: sh mqnamesrv
    ports:
      - "9876:9876"
    networks:
      - wms-network

  # RocketMQ Broker
  rocketmq-broker:
    image: apache/rocketmq:5.1.0
    container_name: wms-rocketmq-broker
    command: sh mqbroker -n rocketmq-nameserver:9876
    ports:
      - "10909:10909"
      - "10911:10911"
    environment:
      - NAMESRV_ADDR=rocketmq-nameserver:9876
    depends_on:
      - rocketmq-nameserver
    networks:
      - wms-network

  # API ç½‘å…³
  gateway:
    image: wms/gateway:latest
    container_name: wms-gateway
    ports:
      - "8080:8080"
    environment:
      - NACOS_SERVER=nacos:8848
      - REDIS_HOST=redis
    depends_on:
      - nacos
      - redis
    networks:
      - wms-network

  # åº“å­˜æœåŠ¡
  inventory-service:
    image: wms/inventory-service:latest
    container_name: wms-inventory-service
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - nacos
      - mysql
      - redis
    networks:
      - wms-network
    deploy:
      replicas: 2

  # å…¥åº“æœåŠ¡
  inbound-service:
    image: wms/inbound-service:latest
    container_name: wms-inbound-service
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - ROCKETMQ_NAMESRV=rocketmq-nameserver:9876
    depends_on:
      - nacos
      - mysql
      - rocketmq-nameserver
    networks:
      - wms-network

  # å‡ºåº“æœåŠ¡
  outbound-service:
    image: wms/outbound-service:latest
    container_name: wms-outbound-service
    environment:
      - NACOS_SERVER=nacos:8848
      - MYSQL_HOST=mysql
      - ROCKETMQ_NAMESRV=rocketmq-nameserver:9876
    depends_on:
      - nacos
      - mysql
      - rocketmq-nameserver
    networks:
      - wms-network

networks:
  wms-network:
    driver: bridge

volumes:
  mysql-data:
```

### 6.2 Kubernetes éƒ¨ç½²é…ç½®

```yaml
# k8s-deployment.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: inventory-service
  namespace: wms
spec:
  replicas: 3
  selector:
    matchLabels:
      app: inventory-service
  template:
    metadata:
      labels:
        app: inventory-service
    spec:
      containers:
      - name: inventory-service
        image: wms/inventory-service:v1.0.0
        ports:
        - containerPort: 8081
        env:
        - name: NACOS_SERVER
          value: "nacos.wms.svc.cluster.local:8848"
        - name: MYSQL_HOST
          value: "mysql.wms.svc.cluster.local"
        - name: REDIS_HOST
          value: "redis.wms.svc.cluster.local"
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8081
          initialDelaySeconds: 60
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8081
          initialDelaySeconds: 30
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: inventory-service
  namespace: wms
spec:
  selector:
    app: inventory-service
  ports:
  - protocol: TCP
    port: 8081
    targetPort: 8081
  type: ClusterIP
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: inventory-service-hpa
  namespace: wms
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: inventory-service
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

### 6.3 ç›‘æ§é…ç½®ï¼ˆPrometheus + Grafanaï¼‰

```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Spring Boot Actuator ç›‘æ§
  - job_name: 'wms-services'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets:
        - 'inventory-service:8081'
        - 'inbound-service:8082'
        - 'outbound-service:8083'
        - 'picking-service:8084'
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '([^:]+)(:[0-9]+)?'
        replacement: '${1}'

  # MySQL ç›‘æ§
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-exporter:9104']

  # Redis ç›‘æ§
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
```

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 æ•°æ®åº“ä¼˜åŒ–

#### 7.1.1 åˆ†åº“åˆ†è¡¨ç­–ç•¥

**ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨ï¼Ÿ**

| é—®é¢˜ | æ•°æ®é‡é˜ˆå€¼ | å½±å“ | è§£å†³æ–¹æ¡ˆ |
|------|-----------|------|---------|
| å•è¡¨æ•°æ®è¿‡å¤§ | > 500ä¸‡è¡Œ | æŸ¥è¯¢æ…¢ã€ç´¢å¼•å¤±æ•ˆ | åˆ†è¡¨ |
| å¹¶å‘å†™å…¥ç“¶é¢ˆ | > 5000 TPS | é”ç­‰å¾…ã€æ€§èƒ½ä¸‹é™ | åˆ†åº“ |
| å†å²æ•°æ®å†—ä½™ | å¢é•¿æ— é™åˆ¶ | ç£ç›˜å ç”¨ã€å¤‡ä»½æ…¢ | å½’æ¡£ |

**æˆ‘ä»¬çš„åˆ†è¡¨ç­–ç•¥ï¼š**

```java
/**
 * åº“å­˜æµæ°´è¡¨åˆ†è¡¨ç­–ç•¥
 * æŒ‰æœˆä»½åˆ†è¡¨: inventory_log_202401, inventory_log_202402 ...
 * 
 * é€‰æ‹©æœˆä»½åˆ†è¡¨çš„åŸå› ï¼š
 * 1. æµæ°´æ•°æ®æŒ‰æ—¶é—´æŸ¥è¯¢å±…å¤šï¼Œæœˆä»½åˆ†è¡¨æŸ¥è¯¢æ•ˆç‡é«˜
 * 2. æ¯æœˆæ•°æ®é‡å¯æ§ï¼ˆçº¦100-200ä¸‡æ¡ï¼‰
 * 3. ä¾¿äºå†å²æ•°æ®å½’æ¡£ï¼ˆè¶…è¿‡12ä¸ªæœˆè‡ªåŠ¨å½’æ¡£åˆ°å†·å­˜å‚¨ï¼‰
 */
@Component
public class InventoryLogShardingAlgorithm implements StandardShardingAlgorithm<LocalDateTime> {
    
    @Override
    public String doSharding(Collection<String> availableTargetNames, 
                            PreciseShardingValue<LocalDateTime> shardingValue) {
        LocalDateTime createTime = shardingValue.getValue();
        String suffix = createTime.format(DateTimeFormatter.ofPattern("yyyyMM"));
        return "inventory_log_" + suffix;
    }
    
    @Override
    public Collection<String> doSharding(Collection<String> availableTargetNames,
                                        RangeShardingValue<LocalDateTime> shardingValue) {
        // èŒƒå›´æŸ¥è¯¢ï¼šè·¨æœˆæŸ¥è¯¢æ—¶è·¯ç”±åˆ°å¤šä¸ªåˆ†è¡¨
        LocalDateTime start = shardingValue.getValueRange().lowerEndpoint();
        LocalDateTime end = shardingValue.getValueRange().upperEndpoint();
        
        Set<String> tables = new HashSet<>();
        YearMonth startMonth = YearMonth.from(start);
        YearMonth endMonth = YearMonth.from(end);
        
        while (!startMonth.isAfter(endMonth)) {
            String tableName = "inventory_log_" + startMonth.format(DateTimeFormatter.ofPattern("yyyyMM"));
            tables.add(tableName);
            startMonth = startMonth.plusMonths(1);
        }
        
        return tables;
    }
}
```

**é…ç½®ç¤ºä¾‹ï¼š**

```yaml
# ShardingSphere é…ç½®
spring:
  shardingsphere:
    rules:
      sharding:
        tables:
          # åº“å­˜æµæ°´è¡¨åˆ†è¡¨é…ç½®
          inventory_log:
            actual-data-nodes: ds0.inventory_log_$->{202401..202412}
            table-strategy:
              standard:
                sharding-column: create_time
                sharding-algorithm-name: inventory-log-sharding
        sharding-algorithms:
          inventory-log-sharding:
            type: CLASS_BASED
            props:
              strategy: STANDARD
              algorithm-class-name: com.wms.config.InventoryLogShardingAlgorithm
```

#### 7.1.2 ç´¢å¼•ä¼˜åŒ–

**ç´¢å¼•è®¾è®¡åŸåˆ™ï¼š**

1. **è¦†ç›–ç´¢å¼•ä¼˜å…ˆ**ï¼šæŸ¥è¯¢å­—æ®µå…¨éƒ¨åœ¨ç´¢å¼•ä¸­ï¼Œé¿å…å›è¡¨
2. **æœ€å·¦å‰ç¼€åŒ¹é…**ï¼šç»„åˆç´¢å¼•æŒ‰æŸ¥è¯¢é¢‘ç‡æ’åˆ—
3. **é¿å…è¿‡åº¦ç´¢å¼•**ï¼šæ¯ä¸ªç´¢å¼•éƒ½æœ‰ç»´æŠ¤æˆæœ¬
4. **å®šæœŸåˆ†æç´¢å¼•**ï¼šåˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•

```sql
-- ========================================
-- æ ¸å¿ƒç´¢å¼•è®¾è®¡
-- ========================================

-- 1. åº“å­˜è¡¨ç»„åˆç´¢å¼•ï¼ˆè¦†ç›–å¸¸ç”¨æŸ¥è¯¢ï¼‰
-- æŸ¥è¯¢åœºæ™¯ï¼šæŒ‰ä»“åº“ã€å•†å“ã€æ‰¹æ¬¡æŸ¥è¯¢åº“å­˜
CREATE INDEX idx_warehouse_goods_batch 
ON inventory(warehouse_id, goods_id, batch_no, quantity, lock_quantity);

-- 2. åº“å­˜è¡¨çŠ¶æ€ç´¢å¼•
-- æŸ¥è¯¢åœºæ™¯ï¼šæŸ¥è¯¢å¼‚å¸¸åº“å­˜ã€å†»ç»“åº“å­˜
CREATE INDEX idx_status_goods 
ON inventory(status, goods_id) WHERE status != 1;

-- 3. å‡ºåº“å•çŠ¶æ€ + åˆ›å»ºæ—¶é—´ç´¢å¼•
-- æŸ¥è¯¢åœºæ™¯ï¼šæŸ¥è¯¢å¾…å¤„ç†è®¢å•ã€ä»Šæ—¥è®¢å•
CREATE INDEX idx_status_create_time 
ON outbound_order(status, create_time DESC)
WHERE status IN (1, 2, 3); -- åªç´¢å¼•æœªå®ŒæˆçŠ¶æ€

-- 4. æ‹£è´§ä»»åŠ¡åˆ†é…ç´¢å¼•
-- æŸ¥è¯¢åœºæ™¯ï¼šæŸ¥æ‰¾å¯åˆ†é…ä»»åŠ¡
CREATE INDEX idx_warehouse_status_priority 
ON picking_task(warehouse_id, status, priority DESC, create_time)
WHERE status = 1; -- åªç´¢å¼•å¾…åˆ†é…çŠ¶æ€

-- 5. åº“å­˜æµæ°´æ—¶é—´èŒƒå›´æŸ¥è¯¢
-- æŸ¥è¯¢åœºæ™¯ï¼šç»Ÿè®¡æŸæ®µæ—¶é—´çš„å‡ºå…¥åº“è®°å½•
CREATE INDEX idx_create_time_operation 
ON inventory_log(create_time, operation_type, quantity_change);

-- 6. å•†å“åç§°å…¨æ–‡ç´¢å¼•ï¼ˆç”¨äºæœç´¢ï¼‰
CREATE FULLTEXT INDEX idx_goods_name_fulltext 
ON goods(goods_name, brand, model);

-- ========================================
-- ç´¢å¼•ç›‘æ§ä¸ä¼˜åŒ–
-- ========================================

-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•
SELECT 
    t.table_schema,
    t.table_name,
    s.index_name,
    s.rows_read,
    s.rows_inserted
FROM information_schema.tables t
LEFT JOIN performance_schema.table_io_waits_summary_by_index_usage s 
    ON t.table_name = s.object_name
WHERE t.table_schema = 'wms'
    AND s.index_name IS NOT NULL
    AND s.index_name != 'PRIMARY'
    AND s.rows_read = 0
ORDER BY t.table_name;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨é¢‘ç‡
SELECT 
    object_name AS table_name,
    index_name,
    count_star AS queries,
    sum_timer_wait / 1000000000000 AS total_latency_sec,
    avg_timer_wait / 1000000000 AS avg_latency_ms
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'wms'
ORDER BY sum_timer_wait DESC
LIMIT 20;
```

**ç´¢å¼•ä¼˜åŒ–æ•ˆæœï¼š**

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-------|-------|-------|------|
| åº“å­˜æŸ¥è¯¢å“åº”æ—¶é—´ | 450ms | 35ms | â†“ 92% |
| è®¢å•åˆ—è¡¨æŸ¥è¯¢ | 1.2s | 180ms | â†“ 85% |
| æ‹£è´§ä»»åŠ¡åˆ†é… | 680ms | 45ms | â†“ 93% |
| ç´¢å¼•æ•°é‡ | 28ä¸ª | 18ä¸ª | â†“ 36% |

#### 7.1.3 SQLä¼˜åŒ–å®è·µ

**æ…¢æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹ï¼š**

```sql
-- âŒ ä¼˜åŒ–å‰ï¼šæŸ¥è¯¢æŸå•†å“çš„å¯ç”¨åº“å­˜æ€»é‡
-- é—®é¢˜ï¼šå…¨è¡¨æ‰«æï¼Œæœªä½¿ç”¨ç´¢å¼•
SELECT SUM(quantity - lock_quantity) AS available_qty
FROM inventory
WHERE goods_id = 12345
  AND status = 1;

-- æ‰§è¡Œæ—¶é—´ï¼š850msï¼ˆæ‰«æ50ä¸‡è¡Œï¼‰

-- âœ… ä¼˜åŒ–åï¼šæ·»åŠ ç´¢å¼• + ä½¿ç”¨è¦†ç›–ç´¢å¼•
CREATE INDEX idx_goods_status_qty 
ON inventory(goods_id, status, quantity, lock_quantity);

-- æ‰§è¡Œæ—¶é—´ï¼š15msï¼ˆåªæ‰«æç›¸å…³è¡Œï¼‰


-- âŒ ä¼˜åŒ–å‰ï¼šåˆ†é¡µæŸ¥è¯¢è®¢å•åˆ—è¡¨ï¼ˆåç§»é‡å¤§æ—¶æ€§èƒ½å·®ï¼‰
SELECT * FROM outbound_order
WHERE status = 2
ORDER BY create_time DESC
LIMIT 10000, 20;

-- æ‰§è¡Œæ—¶é—´ï¼š2.3sï¼ˆéœ€è¦è·³è¿‡10000æ¡è®°å½•ï¼‰

-- âœ… ä¼˜åŒ–åï¼šä½¿ç”¨å»¶è¿Ÿå…³è” + å­æŸ¥è¯¢ä¼˜åŒ–
SELECT o.* FROM outbound_order o
INNER JOIN (
    SELECT id FROM outbound_order
    WHERE status = 2
    ORDER BY create_time DESC
    LIMIT 10000, 20
) AS t ON o.id = t.id;

-- æ‰§è¡Œæ—¶é—´ï¼š180msï¼ˆå­æŸ¥è¯¢åªæŸ¥IDï¼Œå‡å°‘æ•°æ®ä¼ è¾“ï¼‰


-- âŒ ä¼˜åŒ–å‰ï¼šç»Ÿè®¡æ¯ä¸ªå•†å“çš„åº“å­˜åˆ†å¸ƒï¼ˆN+1æŸ¥è¯¢ï¼‰
-- Javaä»£ç ä¸­å¾ªç¯æŸ¥è¯¢ï¼Œäº§ç”Ÿå¤§é‡SQL
for (Goods goods : goodsList) {
    List<Inventory> invs = inventoryMapper.selectByGoodsId(goods.getId());
    // ... å¤„ç†
}

-- æ‰§è¡Œæ—¶é—´ï¼š1000 * 50ms = 50ç§’

-- âœ… ä¼˜åŒ–åï¼šæ‰¹é‡æŸ¥è¯¢ + JOIN
SELECT g.id, g.goods_name, i.warehouse_id, SUM(i.quantity) AS total_qty
FROM goods g
LEFT JOIN inventory i ON g.id = i.goods_id
WHERE g.id IN (1, 2, 3, ..., 1000)
  AND i.status = 1
GROUP BY g.id, i.warehouse_id;

-- æ‰§è¡Œæ—¶é—´ï¼š350ms
```

### 7.2 ç¼“å­˜ç­–ç•¥

```java
/**
 * å¤šçº§ç¼“å­˜ç­–ç•¥
 */
@Service
public class InventoryCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private final Cache<String, InventoryVO> localCache = CacheBuilder.newBuilder()
        .maximumSize(10000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    /**
     * æŸ¥è¯¢åº“å­˜ï¼ˆå¤šçº§ç¼“å­˜ï¼‰
     */
    public InventoryVO getInventory(Long warehouseId, Long goodsId) {
        String key = "inv:" + warehouseId + ":" + goodsId;
        
        // 1. æŸ¥è¯¢æœ¬åœ°ç¼“å­˜
        InventoryVO cached = localCache.getIfPresent(key);
        if (cached != null) {
            return cached;
        }
        
        // 2. æŸ¥è¯¢ Redis
        cached = (InventoryVO) redisTemplate.opsForValue().get(key);
        if (cached != null) {
            localCache.put(key, cached);
            return cached;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        InventoryVO inventory = inventoryMapper.selectByWarehouseAndGoods(warehouseId, goodsId);
        
        // 4. å†™å…¥ç¼“å­˜
        if (inventory != null) {
            redisTemplate.opsForValue().set(key, inventory, 10, TimeUnit.MINUTES);
            localCache.put(key, inventory);
        }
        
        return inventory;
    }
}
```

### 7.3 æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†

```java
/**
 * å‡ºåº“æ¶ˆæ¯ç”Ÿäº§è€…
 */
@Service
public class OutboundMessageProducer {
    
    @Autowired
    private RocketMQTemplate rocketMQTemplate;
    
    /**
     * å‘é€å‡ºåº“å®Œæˆæ¶ˆæ¯
     */
    public void sendOutboundCompletedMessage(Long orderId) {
        OutboundCompletedEvent event = new OutboundCompletedEvent();
        event.setOrderId(orderId);
        event.setTimestamp(LocalDateTime.now());
        
        // å¼‚æ­¥å‘é€
        rocketMQTemplate.asyncSend("OUTBOUND_COMPLETED_TOPIC", event, new SendCallback() {
            @Override
            public void onSuccess(SendResult sendResult) {
                log.info("å‡ºåº“æ¶ˆæ¯å‘é€æˆåŠŸ: orderId={}", orderId);
            }
            
            @Override
            public void onException(Throwable throwable) {
                log.error("å‡ºåº“æ¶ˆæ¯å‘é€å¤±è´¥: orderId={}", orderId, throwable);
                // é‡è¯•æˆ–è®°å½•è¡¥å¿ä»»åŠ¡
            }
        });
    }
}

/**
 * åº“å­˜æ‰£å‡æ¶ˆè´¹è€…
 */
@Service
@RocketMQMessageListener(
    topic = "OUTBOUND_COMPLETED_TOPIC",
    consumerGroup = "inventory-consumer-group"
)
public class InventoryDeductConsumer implements RocketMQListener<OutboundCompletedEvent> {
    
    @Autowired
    private InventoryService inventoryService;
    
    @Override
    public void onMessage(OutboundCompletedEvent event) {
        try {
            // æ‰£å‡åº“å­˜
            inventoryService.deductInventoryForOrder(event.getOrderId());
            log.info("åº“å­˜æ‰£å‡å®Œæˆ: orderId={}", event.getOrderId());
        } catch (Exception e) {
            log.error("åº“å­˜æ‰£å‡å¤±è´¥: orderId={}", event.getOrderId(), e);
            throw new RuntimeException("åº“å­˜æ‰£å‡å¤±è´¥ï¼Œè§¦å‘é‡è¯•", e);
        }
    }
}
```

---

## å…«ã€æ€»ç»“ä¸å±•æœ›

### 8.1 ç³»ç»Ÿç‰¹ç‚¹

| ç‰¹ç‚¹ | è¯´æ˜ |
|------|------|
| âš¡ **é«˜æ€§èƒ½** | Redis ç¼“å­˜ + æ•°æ®åº“ä¼˜åŒ–ï¼Œæ”¯æŒ 10000+ TPS |
| ğŸ”’ **é«˜å¯é ** | åˆ†å¸ƒå¼é” + äº‹åŠ¡ä¿è¯ï¼Œåº“å­˜å‡†ç¡®ç‡ 99.9% |
| ğŸ“ˆ **å¯æ‰©å±•** | å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒæ°´å¹³æ‰©å±• |
| ğŸ¯ **æ™ºèƒ½åŒ–** | æ‹£è´§è·¯å¾„ä¼˜åŒ–ï¼Œæ•ˆç‡æå‡ 40% |
| ğŸ“Š **å¯è§†åŒ–** | å®æ—¶ç›‘æ§å¤§å±ï¼Œæ•°æ®ä¸€ç›®äº†ç„¶ |

### 8.2 æœªæ¥è§„åˆ’

#### ğŸ¤– AI æ™ºèƒ½åŒ–
- åº“å­˜éœ€æ±‚é¢„æµ‹
- æ™ºèƒ½è¡¥è´§å»ºè®®
- å¼‚å¸¸æ£€æµ‹å‘Šè­¦

#### ğŸ“± ç§»åŠ¨åŒ–
- PDA æ‰‹æŒç»ˆç«¯
- è¯­éŸ³æ‹£è´§
- AR è¾…åŠ©æ‹£è´§

#### ğŸŒ IoT ç‰©è”ç½‘
- RFID è‡ªåŠ¨è¯†åˆ«
- æ¸©æ¹¿åº¦ç›‘æ§
- è‡ªåŠ¨åŒ–ç«‹ä½“åº“

#### ğŸ”— åŒºå—é“¾è¿½æº¯
- å•†å“æº¯æº
- é˜²ä¼ªéªŒè¯
- ä¾›åº”é“¾ååŒ

---

## é™„å½•

### A. å¸¸è§é—®é¢˜

**Q1: å¦‚ä½•å¤„ç†åº“å­˜å¹¶å‘é—®é¢˜ï¼Ÿ**

A: ä½¿ç”¨ Redis åˆ†å¸ƒå¼é” + æ•°æ®åº“è¡Œé”ï¼ˆFOR UPDATEï¼‰åŒé‡ä¿è¯ã€‚

**Q2: æ‹£è´§è·¯å¾„ä¼˜åŒ–ç®—æ³•å¤æ‚åº¦å¦‚ä½•ï¼Ÿ**

A: è´ªå¿ƒç®—æ³•æ—¶é—´å¤æ‚åº¦ O(nÂ²)ï¼Œé€‚ç”¨äºä¸­å°è§„æ¨¡ï¼ˆ< 1000 ä¸ªåº“ä½ï¼‰ã€‚

**Q3: å¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ**

A: é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSeataï¼‰+ æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—è¡¥å¿ï¼‰ã€‚

### B. å‚è€ƒèµ„æ–™

- [Spring Cloud å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-cloud)
- [MyBatis-Plus å®˜æ–¹æ–‡æ¡£](https://baomidou.com/)
- [RocketMQ å®˜æ–¹æ–‡æ¡£](https://rocketmq.apache.org/)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/zh-cn/)

---

:::info[ğŸ“„ æ–‡æ¡£ä¿¡æ¯]
**ğŸ‰ WMS ä»“åº“ç®¡ç†ç³»ç»Ÿè®¾è®¡æ–‡æ¡£**

- **ç‰ˆæœ¬**: v1.0.0
- **æ›´æ–°æ—¶é—´**: 2025-10-16
- **ä½œè€…**: ç³»ç»Ÿæ¶æ„å›¢é˜Ÿ
- **æ ‡ç­¾**: WMS, ä»“åº“ç®¡ç†, Spring Cloud, å¾®æœåŠ¡æ¶æ„
:::

---

**æ–‡æ¡£å®Œæˆ** âœ…






