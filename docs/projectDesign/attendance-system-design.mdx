---
sidebar_position: 2
title: è€ƒå‹¤ç®¡ç†ç³»ç»Ÿè®¾è®¡
description: å¯¹æ ‡ä¼ä¸šå¾®ä¿¡/é’‰é’‰çš„æ™ºèƒ½è€ƒå‹¤ç®¡ç†ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ
tags: [è€ƒå‹¤ç³»ç»Ÿ, å®¡æ‰¹æµç¨‹, Spring Boot, ä¼ä¸šç®¡ç†, ç³»ç»Ÿè®¾è®¡]
---

# è€ƒå‹¤ç®¡ç†ç³»ç»Ÿè®¾è®¡

:::tip ğŸ“Œ é‡è¦è¯´æ˜ï¼šå¯¹æ ‡ä¼ä¸šå¾®ä¿¡/é’‰é’‰è€ƒå‹¤æ ‡å‡†
æœ¬ç³»ç»Ÿå‚è€ƒ**ä¼ä¸šå¾®ä¿¡**å’Œ**é’‰é’‰**çš„è€ƒå‹¤ç®¡ç†æ ‡å‡†ï¼Œå®ç°ä¼ä¸šçº§è€ƒå‹¤ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

**ç³»ç»Ÿæ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… **æ ‡å‡†åŒ–æµç¨‹**ï¼šå¯¹æ ‡ä¸»æµå¹³å°çš„å®¡æ‰¹æµç¨‹å’Œè§„åˆ™
- âœ… **æ™ºèƒ½ç»Ÿè®¡**ï¼šè‡ªåŠ¨åŒ–è€ƒå‹¤ç»Ÿè®¡å’Œæœˆåº¦æ±‡æ€»
- âœ… **å¤šç«¯æ”¯æŒ**ï¼šWebç«¯ + ç§»åŠ¨ç«¯ï¼ˆé¢„ç•™æ¥å£ï¼‰
- âœ… **çµæ´»é…ç½®**ï¼šè€ƒå‹¤è§„åˆ™ã€èŠ‚å‡æ—¥ã€å®¡æ‰¹æµç¨‹å¯é…ç½®
- âœ… **å®Œå–„æŠ¥è¡¨**ï¼šä¸ªäºº/éƒ¨é—¨/å¼‚å¸¸å¤šç»´åº¦æŠ¥è¡¨

**æŠ€æœ¯æ ˆ**ï¼š
- åç«¯ï¼šSpring Boot 2.7.x + MyBatis-Plus 3.5.x + Spring Security + JWT
- å‰ç«¯ï¼šVue 3 + Element Plus + TypeScript + Pinia
- æ•°æ®åº“ï¼šMySQL 8.0 + Redis 6.0
- å®šæ—¶ä»»åŠ¡ï¼šQuartz 2.3.x
- å·¥å…·åº“ï¼šHutoolã€Lombokã€MapStruct

**è¡¥å¡è§„åˆ™è¯´æ˜**ï¼ˆå‚è€ƒé’‰é’‰/ä¼ä¸šå¾®ä¿¡ï¼‰ï¼š
- æ¯æœˆæœ€å¤šè¡¥å¡3æ¬¡ï¼ˆå¯é…ç½®2-5æ¬¡ï¼‰
- åªèƒ½è¡¥æœ€è¿‘7å¤©å†…çš„æ‰“å¡
- è¡¥å¡æ¬¡æ•°æŒ‰æœˆç»Ÿè®¡ï¼Œæ¯æœˆ1å·é‡ç½®
:::

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

éšç€ä¼ä¸šä¿¡æ¯åŒ–å»ºè®¾çš„æ·±å…¥ï¼Œä¼ ç»Ÿçš„äººå·¥è€ƒå‹¤æ–¹å¼å·²æ— æ³•æ»¡è¶³ç°ä»£ä¼ä¸šç®¡ç†éœ€æ±‚ã€‚æœ¬ç³»ç»Ÿæ—¨åœ¨æä¾›ä¸€å¥—å®Œæ•´çš„ã€è‡ªåŠ¨åŒ–çš„è€ƒå‹¤ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œ**å¯¹æ ‡ä¼ä¸šå¾®ä¿¡å’Œé’‰é’‰çš„è€ƒå‹¤æ ‡å‡†**ï¼Œå®ç°è€ƒå‹¤æ‰“å¡ã€è¯·å‡å‡ºå·®ã€å®¡æ‰¹æµè½¬ã€ç»Ÿè®¡æŠ¥è¡¨ç­‰å…¨æµç¨‹ç®¡ç†ã€‚

### 1.2 è®¾è®¡ç›®æ ‡

#### ä¸šåŠ¡ç›®æ ‡
- âœ… **æ™ºèƒ½åŒ–**ï¼šè‡ªåŠ¨è®¡ç®—è€ƒå‹¤ç»Ÿè®¡ï¼Œæ™ºèƒ½è¯†åˆ«å¼‚å¸¸
- âœ… **æ ‡å‡†åŒ–**ï¼šå¯¹æ ‡ä¼ä¸šå¾®ä¿¡/é’‰é’‰å®¡æ‰¹æµç¨‹æ ‡å‡†
- âœ… **å¯è§†åŒ–**ï¼šç›´è§‚çš„æ—¥å†è§†å›¾å’Œå›¾è¡¨å±•ç¤º
- âœ… **ç§»åŠ¨åŒ–**ï¼šæ”¯æŒå¤šç«¯æ‰“å¡ï¼ˆé¢„ç•™æ¥å£ï¼‰

#### æŠ€æœ¯ç›®æ ‡
- âœ… **é«˜æ€§èƒ½**ï¼šæ”¯æŒåƒäººçº§å¹¶å‘æ‰“å¡
- âœ… **é«˜å¯ç”¨**ï¼š7Ã—24å°æ—¶ç¨³å®šè¿è¡Œ
- âœ… **æ˜“æ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- âœ… **æ˜“ç»´æŠ¤**ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£

### 1.3 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æ ¸å¿ƒåŠŸèƒ½ | ç”¨æˆ·è§’è‰² |
|---------|---------|---------|
| è€ƒå‹¤æ‰“å¡ | ä¸Šä¸‹ç­æ‰“å¡ã€ä½ç½®è®°å½•ã€å¼‚å¸¸æ ‡è®° | å…¨å‘˜ |
| è¯·å‡ç®¡ç† | è¯·å‡ç”³è¯·ã€å®¡æ‰¹æµè½¬ã€è‡ªåŠ¨æ‰£é™¤è€ƒå‹¤ | å…¨å‘˜ã€å®¡æ‰¹äºº |
| å‡ºå·®ç®¡ç† | å‡ºå·®ç”³è¯·ã€å®¡æ‰¹æµè½¬ã€å‡ºå·®æœŸé—´å…æ‰“å¡ | å…¨å‘˜ã€å®¡æ‰¹äºº |
| è¡¥å¡ç®¡ç† | è¡¥å¡ç”³è¯·ã€å®¡æ‰¹åè‡ªåŠ¨æ›´æ–°æ‰“å¡è®°å½• | å…¨å‘˜ã€å®¡æ‰¹äºº |
| è€ƒå‹¤ç»Ÿè®¡ | æ—¥/æœˆç»Ÿè®¡ã€è‡ªåŠ¨è®¡ç®—å·¥ä½œæ—¶é•¿ | å…¨å‘˜ |
| è€ƒå‹¤æŠ¥è¡¨ | ä¸ªäººæŠ¥è¡¨ã€éƒ¨é—¨æŠ¥è¡¨ã€å¼‚å¸¸æŠ¥è¡¨ | ç®¡ç†å‘˜ã€éƒ¨é—¨ä¸»ç®¡ |
| è§„åˆ™é…ç½® | è€ƒå‹¤è§„åˆ™ã€å·¥ä½œæ—¶é—´ã€èŠ‚å‡æ—¥é…ç½® | ç®¡ç†å‘˜ |

### 1.4 ç”¨æˆ·è§’è‰²

```mermaid
graph TD
    A[ç³»ç»Ÿç®¡ç†å‘˜] --> B[è€ƒå‹¤è§„åˆ™é…ç½®]
    A --> C[èŠ‚å‡æ—¥ç®¡ç†]
    A --> D[æŸ¥çœ‹æ‰€æœ‰æŠ¥è¡¨]
    
    E[éƒ¨é—¨ä¸»ç®¡] --> F[æŸ¥çœ‹éƒ¨é—¨æŠ¥è¡¨]
    E --> G[å®¡æ‰¹è¯·å‡/å‡ºå·®/è¡¥å¡]
    
    H[æ™®é€šå‘˜å·¥] --> I[è€ƒå‹¤æ‰“å¡]
    H --> J[è¯·å‡/å‡ºå·®/è¡¥å¡ç”³è¯·]
    H --> K[æŸ¥çœ‹ä¸ªäººè€ƒå‹¤]
```

### 1.5 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | è¯´æ˜ | é¢„æœŸæ•ˆæœ |
|--------|------|----------|
| ğŸ¯ **æå‡æ•ˆç‡** | è‡ªåŠ¨åŒ–è€ƒå‹¤ç»Ÿè®¡ï¼Œå‡å°‘HRå·¥ä½œé‡ | äººåŠ›æˆæœ¬é™ä½ 50% |
| ğŸ“Š **æ•°æ®å‡†ç¡®** | å®æ—¶æ‰“å¡è®°å½•ï¼Œé¿å…äººå·¥é”™è¯¯ | æ•°æ®å‡†ç¡®ç‡è¾¾ 99.9% |
| ğŸ”„ **æµç¨‹è§„èŒƒ** | æ ‡å‡†åŒ–å®¡æ‰¹æµç¨‹ï¼Œé€æ˜å¯è¿½æº¯ | å®¡æ‰¹æ•ˆç‡æå‡ 60% |
| ğŸ“ˆ **å†³ç­–æ”¯æŒ** | å¤šç»´åº¦æŠ¥è¡¨ï¼Œè¾…åŠ©ç®¡ç†å†³ç­– | å†³ç­–æ•ˆç‡æå‡ 40% |

---

## äºŒã€ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ€»ä½“æ¶æ„

```mermaid
graph TD
    subgraph FE["ğŸ’» å‰ç«¯å±•ç¤ºå±‚"]
        UI1["è€ƒå‹¤æ‰“å¡<br/>ğŸ“± æ‰“å¡è®°å½•"]
        UI2["å®¡æ‰¹ç®¡ç†<br/>ğŸ“‹ è¯·å‡/å‡ºå·®/è¡¥å¡"]
        UI3["ç»Ÿè®¡æŠ¥è¡¨<br/>ğŸ“Š æ•°æ®åˆ†æ"]
        UI4["è§„åˆ™é…ç½®<br/>âš™ï¸ ç³»ç»Ÿè®¾ç½®"]
    end
    
    subgraph BE["âš™ï¸ ä¸šåŠ¡é€»è¾‘å±‚ (Spring Boot)"]
        direction TB
        subgraph CTL["Controller å±‚"]
            C1["AttendanceController<br/>è€ƒå‹¤æ§åˆ¶å™¨"]
            C2["ApprovalController<br/>å®¡æ‰¹æ§åˆ¶å™¨"]
            C3["ReportController<br/>æŠ¥è¡¨æ§åˆ¶å™¨"]
        end
        
        subgraph SVC["Service å±‚"]
            S1["AttendanceService<br/>è€ƒå‹¤ä¸šåŠ¡"]
            S2["ApprovalService<br/>å®¡æ‰¹ä¸šåŠ¡"]
            S3["StatisticsService<br/>ç»Ÿè®¡ä¸šåŠ¡"]
        end
        
        subgraph CVT["Converter å±‚"]
            CV["MapStruct å¯¹è±¡è½¬æ¢<br/>Entity â†” DTO â†” VO"]
        end
    end
    
    subgraph DATA["ğŸ’¾ æ•°æ®æŒä¹…å±‚ (MySQL)"]
        DB1[("ğŸ“ æ‰“å¡è®°å½•è¡¨<br/>attendance_record")]
        DB2[("ğŸ“‹ å®¡æ‰¹è¡¨<br/>leave/trip/makeup")]
        DB3[("ğŸ“Š ç»Ÿè®¡è¡¨<br/>statistics/summary")]
        DB4[("âš™ï¸ é…ç½®è¡¨<br/>rule/holiday")]
    end
    
    subgraph JOB["â° å®šæ—¶ä»»åŠ¡å±‚ (Quartz)"]
        J1["æ¯æ—¥0ç‚¹<br/>è€ƒå‹¤ç»Ÿè®¡"]
        J2["æ¯æœˆ1å·<br/>æœˆåº¦æ±‡æ€»"]
        J3["å®šæœŸæ¸…ç†<br/>å†å²æ•°æ®"]
    end
    
    UI1 -->|HTTP/JSON| C1
    UI2 -->|HTTP/JSON| C2
    UI3 -->|HTTP/JSON| C3
    UI4 -->|HTTP/JSON| C1
    
    C1 --> S1
    C2 --> S2
    C3 --> S3
    
    S1 & S2 & S3 --> CV
    
    CV -->|MyBatis-Plus| DB1
    CV -->|MyBatis-Plus| DB2
    CV -->|MyBatis-Plus| DB3
    CV -->|MyBatis-Plus| DB4
    
    J1 -.è§¦å‘.-> S3
    J2 -.è§¦å‘.-> S3
    J3 -.è§¦å‘.-> S1
    
    classDef frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef controller fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef service fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef converter fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef database fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef job fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class UI1,UI2,UI3,UI4 frontend
    class C1,C2,C3 controller
    class S1,S2,S3 service
    class CV converter
    class DB1,DB2,DB3,DB4 database
    class J1,J2,J3 job
```

### 2.2 æŠ€æœ¯é€‰å‹

#### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Spring Boot | 2.7.x | åº”ç”¨æ¡†æ¶ |
| Spring Security | 5.7.x | å®‰å…¨è®¤è¯ |
| MyBatis-Plus | 3.5.x | ORMæ¡†æ¶ |
| MySQL | 8.0+ | å…³ç³»æ•°æ®åº“ |
| Redis | 6.0+ | ç¼“å­˜/åˆ†å¸ƒå¼é” |
| Quartz | 2.3.x | å®šæ—¶ä»»åŠ¡ |
| MapStruct | 1.5.5 | å¯¹è±¡æ˜ å°„ |
| JWT | - | Tokenè®¤è¯ |
| Druid | 1.2.x | æ•°æ®åº“è¿æ¥æ±  |

#### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vue.js | 3.x | å‰ç«¯æ¡†æ¶ |
| Element Plus | 2.x | UIç»„ä»¶åº“ |
| Axios | 1.x | HTTPå®¢æˆ·ç«¯ |
| Pinia | 2.x | çŠ¶æ€ç®¡ç† |
| Vue Router | 4.x | è·¯ç”±ç®¡ç† |
| ECharts | 5.x | å›¾è¡¨å±•ç¤º |

### 2.3 åˆ†å±‚æ¶æ„è®¾è®¡

#### è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰
- **èŒè´£**ï¼šç”¨æˆ·äº¤äº’ã€æ•°æ®å±•ç¤ºã€è¡¨å•éªŒè¯
- **ç»„ä»¶**ï¼šVueç»„ä»¶ã€Element Plus
- **ç‰¹ç‚¹**ï¼šå“åº”å¼è®¾è®¡ã€å‰åç«¯åˆ†ç¦»

#### ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰
- **èŒè´£**ï¼šä¸šåŠ¡è§„åˆ™ã€æµç¨‹æ§åˆ¶ã€æ•°æ®æ ¡éªŒ
- **ç»„ä»¶**ï¼šServiceæœåŠ¡ã€ä¸šåŠ¡é€»è¾‘å¤„ç†
- **ç‰¹ç‚¹**ï¼šäº‹åŠ¡ç®¡ç†ã€å¼‚å¸¸å¤„ç†

#### æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰
- **èŒè´£**ï¼šæ•°æ®CRUDã€SQLæ‰§è¡Œ
- **ç»„ä»¶**ï¼šMapperæ¥å£ã€MyBatis XML
- **ç‰¹ç‚¹**ï¼šSQLä¼˜åŒ–ã€è¿æ¥æ± ç®¡ç†

#### æ•°æ®è½¬æ¢å±‚ï¼ˆConverter Layerï¼‰
- **èŒè´£**ï¼šå¯¹è±¡è½¬æ¢ã€æ•°æ®æ˜ å°„
- **ç»„ä»¶**ï¼šMapStructæ¥å£
- **ç‰¹ç‚¹**ï¼šç¼–è¯‘æ—¶ç”Ÿæˆã€é«˜æ€§èƒ½

### 2.4 æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **åˆ†å±‚è§£è€¦**ï¼šä¸¥æ ¼æŒ‰ç…§MVCæ¨¡å¼åˆ†å±‚ï¼Œé™ä½è€¦åˆåº¦
2. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç±»/æ–¹æ³•åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
3. **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
4. **ä¾èµ–å€’ç½®**ï¼šé¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œéå…·ä½“å®ç°
5. **é‡Œæ°æ›¿æ¢**ï¼šå­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»
6. **æœ€å°‘çŸ¥è¯†**ï¼šç±»ä¹‹é—´å‡å°‘ä¾èµ–å…³ç³»

---

## ä¸‰ã€åŠŸèƒ½æ¨¡å—è®¾è®¡

### 3.1 è€ƒå‹¤æ‰“å¡æ¨¡å—

#### åŠŸèƒ½æè¿°
å‘˜å·¥é€šè¿‡ç³»ç»Ÿè¿›è¡Œä¸Šä¸‹ç­æ‰“å¡ï¼Œç³»ç»Ÿè‡ªåŠ¨è®°å½•æ‰“å¡æ—¶é—´ã€åœ°ç‚¹ã€æ–¹å¼ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ­£å¸¸ã€‚

#### ä¸šåŠ¡è§„åˆ™

```mermaid
graph TD
    ROOT["ğŸ“‹ æ‰“å¡è§„åˆ™é…ç½®"]
    
    ROOT --> TIME["â° æ—¶é—´è§„åˆ™"]
    ROOT --> LOC["ğŸ“ åœ°ç‚¹è§„åˆ™"]
    ROOT --> ERR["âš ï¸ å¼‚å¸¸è§„åˆ™"]
    
    TIME --> T1["ä¸Šåˆä¸Šç­<br/>08:30 - 12:00"]
    TIME --> T2["ä¸‹åˆä¸‹ç­<br/>13:30 - 18:00"]
    TIME --> T3["è¿Ÿåˆ°åˆ¤å®š<br/>æ™šäº 08:30"]
    TIME --> T4["æ—©é€€åˆ¤å®š<br/>æ—©äº 18:00"]
    
    LOC --> L1["ğŸ“± GPSå®šä½<br/>ç§»åŠ¨ç«¯æ‰“å¡"]
    LOC --> L2["ğŸ“¶ WiFiå®šä½<br/>å…¬å¸ç½‘ç»œ"]
    LOC --> L3["ğŸŒ IPç™½åå•<br/>åŠå…¬ç½‘ç»œ"]
    
    ERR --> E1["âŒ æœªæ‰“å¡<br/>ç¼ºå°‘è®°å½•"]
    ERR --> E2["â±ï¸ è¿Ÿåˆ°/æ—©é€€<br/>è¶…æ—¶æ‰“å¡"]
    ERR --> E3["ğŸ”„ é‡å¤æ‰“å¡<br/>å–ç¬¬ä¸€æ¬¡"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef categoryStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef timeStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef locStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef errStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class ROOT rootStyle
    class TIME,LOC,ERR categoryStyle
    class T1,T2,T3,T4 timeStyle
    class L1,L2,L3 locStyle
    class E1,E2,E3 errStyle
```

#### æµç¨‹è®¾è®¡

```mermaid
sequenceDiagram
    participant å‘˜å·¥
    participant å‰ç«¯
    participant åç«¯
    participant æ•°æ®åº“
    
    å‘˜å·¥->>å‰ç«¯: ç‚¹å‡»æ‰“å¡æŒ‰é’®
    å‰ç«¯->>å‰ç«¯: è·å–å½“å‰ä½ç½®
    å‰ç«¯->>åç«¯: æäº¤æ‰“å¡è¯·æ±‚(æ—¶é—´/ä½ç½®/ç±»å‹)
    åç«¯->>åç«¯: éªŒè¯ç”¨æˆ·èº«ä»½
    åç«¯->>åç«¯: æ ¡éªŒæ‰“å¡è§„åˆ™
    åç«¯->>æ•°æ®åº“: ä¿å­˜æ‰“å¡è®°å½•
    åç«¯->>åç«¯: å®æ—¶è®¡ç®—è€ƒå‹¤ç»Ÿè®¡
    åç«¯->>å‰ç«¯: è¿”å›æ‰“å¡ç»“æœ
    å‰ç«¯->>å‘˜å·¥: æ˜¾ç¤ºæ‰“å¡æˆåŠŸ/å¼‚å¸¸ä¿¡æ¯
```

#### æ•°æ®æµå‘

```
å‘˜å·¥æ‰“å¡ â†’ æ‰“å¡è®°å½•è¡¨ â†’ å®æ—¶ç»Ÿè®¡ â†’ è€ƒå‹¤ç»Ÿè®¡è¡¨ â†’ æœˆåº¦æ±‡æ€»
```

### 3.2 è¯·å‡ç®¡ç†æ¨¡å—

#### åŠŸèƒ½æè¿°
å‘˜å·¥æäº¤è¯·å‡ç”³è¯·ï¼Œå®¡æ‰¹äººå®¡æ‰¹ï¼Œå®¡æ‰¹é€šè¿‡åè‡ªåŠ¨è®¡ç®—è€ƒå‹¤ç»Ÿè®¡ï¼Œæ‰£é™¤ç›¸åº”è€ƒå‹¤å¤©æ•°ã€‚

#### è¯·å‡ç±»å‹

| ç±»å‹ | ä»£ç  | æ‰£é™¤è€ƒå‹¤ | éœ€è¦è¯æ˜ |
|------|------|---------|---------|
| äº‹å‡ | 1 | æ˜¯ | å¦ |
| ç—…å‡ | 2 | æ˜¯ | å»ºè®®æä¾›ç—…å‡æ¡ |
| å¹´å‡ | 3 | å¦ | å¦ |
| è°ƒä¼‘ | 4 | å¦ | å¦ |
| å©šå‡ | 5 | å¦ | éœ€è¦ç»“å©šè¯ |
| äº§å‡ | 6 | å¦ | éœ€è¦åŒ»é™¢è¯æ˜ |
| ä¸§å‡ | 7 | å¦ | éœ€è¦ç›¸å…³è¯æ˜ |

#### å®¡æ‰¹æµç¨‹

```mermaid
stateDiagram-v2
    [*] --> å¾…å®¡æ‰¹: æäº¤ç”³è¯·
    å¾…å®¡æ‰¹ --> å·²é€šè¿‡: å®¡æ‰¹é€šè¿‡
    å¾…å®¡æ‰¹ --> å·²æ‹’ç»: å®¡æ‰¹æ‹’ç»
    å¾…å®¡æ‰¹ --> å·²æ’¤é”€: å‘˜å·¥æ’¤å›
    
    å·²é€šè¿‡ --> è€ƒå‹¤æ‰£é™¤: è‡ªåŠ¨å¤„ç†
    å·²æ‹’ç» --> [*]
    å·²æ’¤é”€ --> [*]
    è€ƒå‹¤æ‰£é™¤ --> [*]
```

#### ä¸šåŠ¡è§„åˆ™

1. **çŠ¶æ€æµè½¬**
   - åªæœ‰"å¾…å®¡æ‰¹"çŠ¶æ€æ‰èƒ½å®¡æ‰¹æˆ–æ’¤å›
   - å®¡æ‰¹åä¸å¯ä¿®æ”¹
   - æ’¤å›åä¸å¯æ¢å¤

2. **æƒé™æ§åˆ¶**
   - åªæœ‰ç”³è¯·äººæœ¬äººå¯ä»¥æ’¤å›
   - åªæœ‰æŒ‡å®šå®¡æ‰¹äººå¯ä»¥å®¡æ‰¹
   - ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”³è¯·

3. **è€ƒå‹¤å½±å“**
   - å®¡æ‰¹é€šè¿‡åæ¬¡æ—¥è‡ªåŠ¨æ ¡å‡†è€ƒå‹¤
   - è¯·å‡æœŸé—´ä¸è®¡å…¥è¿Ÿåˆ°/æ—©é€€
   - æ‰£é™¤ç›¸åº”çš„åº”å‡ºå‹¤å¤©æ•°

### 3.3 å‡ºå·®ç®¡ç†æ¨¡å—

#### åŠŸèƒ½æè¿°
å‘˜å·¥æäº¤å‡ºå·®ç”³è¯·ï¼Œå®¡æ‰¹é€šè¿‡åå‡ºå·®æœŸé—´å…æ‰“å¡ï¼Œä¸å½±å“è€ƒå‹¤ç»Ÿè®¡ã€‚

#### ä¸šåŠ¡è§„åˆ™

```mermaid
graph TD
    ROOT["âœˆï¸ å‡ºå·®ç®¡ç†è§„åˆ™"]
    
    ROOT --> APP["ğŸ“ ç”³è¯·è§„åˆ™"]
    ROOT --> APR["âœ… å®¡æ‰¹è§„åˆ™"]
    ROOT --> ATT["ğŸ“Š è€ƒå‹¤è§„åˆ™"]
    
    APP --> A1["æå‰ç”³è¯·<br/>éœ€å¡«å†™å‡ºå·®ä¿¡æ¯"]
    APP --> A2["å‡ºå·®ä¿¡æ¯<br/>åœ°ç‚¹/äº‹ç”±/æ—¶é—´"]
    APP --> A3["è¯æ˜ææ–™<br/>å¯é€‰ä¸Šä¼ "]
    
    APR --> P1["éƒ¨é—¨ä¸»ç®¡<br/>ä¸€çº§å®¡æ‰¹"]
    APR --> P2["æ€»ç»ç†å®¡æ‰¹<br/>è·¨çœå‡ºå·®å¿…éœ€"]
    APR --> P3["å®¡æ‰¹ç”Ÿæ•ˆ<br/>é€šè¿‡åè‡ªåŠ¨ç”Ÿæ•ˆ"]
    
    ATT --> T1["å…æ‰“å¡<br/>å‡ºå·®æœŸé—´"]
    ATT --> T2["ä¸è®¡å¼‚å¸¸<br/>è¿Ÿåˆ°/æ—©é€€"]
    ATT --> T3["è®¡å…¥å‡ºå‹¤<br/>å®é™…å·¥ä½œå¤©æ•°"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef categoryStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef appStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef aprStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef attStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class ROOT rootStyle
    class APP,APR,ATT categoryStyle
    class A1,A2,A3 appStyle
    class P1,P2,P3 aprStyle
    class T1,T2,T3 attStyle
```

### 3.4 è¡¥å¡ç®¡ç†æ¨¡å—

#### åŠŸèƒ½æè¿°
å‘˜å·¥å› ç‰¹æ®ŠåŸå› å¿˜è®°æ‰“å¡ï¼Œå¯æäº¤è¡¥å¡ç”³è¯·ï¼Œå®¡æ‰¹é€šè¿‡åè‡ªåŠ¨åˆ›å»ºæ‰“å¡è®°å½•ã€‚

#### æ ¸å¿ƒæµç¨‹

```mermaid
sequenceDiagram
    participant å‘˜å·¥
    participant å®¡æ‰¹ç³»ç»Ÿ
    participant è€ƒå‹¤ç³»ç»Ÿ
    participant æ•°æ®åº“
    
    å‘˜å·¥->>å®¡æ‰¹ç³»ç»Ÿ: æäº¤è¡¥å¡ç”³è¯·
    Note over å‘˜å·¥: è¡¥å¡æ—¥æœŸ/æ—¶é—´/ç±»å‹/åŸå› 
    
    å®¡æ‰¹ç³»ç»Ÿ->>å®¡æ‰¹ç³»ç»Ÿ: å®¡æ‰¹æµè½¬
    
    alt å®¡æ‰¹é€šè¿‡
        å®¡æ‰¹ç³»ç»Ÿ->>è€ƒå‹¤ç³»ç»Ÿ: è§¦å‘è¡¥å¡å¤„ç†
        è€ƒå‹¤ç³»ç»Ÿ->>æ•°æ®åº“: åˆ›å»ºæ‰“å¡è®°å½•
        è€ƒå‹¤ç³»ç»Ÿ->>è€ƒå‹¤ç³»ç»Ÿ: é‡ç®—å½“æ—¥è€ƒå‹¤
        è€ƒå‹¤ç³»ç»Ÿ->>å®¡æ‰¹ç³»ç»Ÿ: è¿”å›å¤„ç†ç»“æœ
        å®¡æ‰¹ç³»ç»Ÿ->>å‘˜å·¥: é€šçŸ¥è¡¥å¡æˆåŠŸ
    else å®¡æ‰¹æ‹’ç»
        å®¡æ‰¹ç³»ç»Ÿ->>å‘˜å·¥: é€šçŸ¥å®¡æ‰¹æ‹’ç»
    end
```

#### ä¸šåŠ¡è§„åˆ™

1. **è¡¥å¡é™åˆ¶ï¼ˆå‚è€ƒé’‰é’‰/ä¼ä¸šå¾®ä¿¡æ ‡å‡†ï¼‰**
   - **è¡¥å¡æ¬¡æ•°**ï¼šæ¯æœˆæœ€å¤šè¡¥å¡3æ¬¡ï¼ˆå¯é…ç½®ä¸º2-5æ¬¡ï¼‰
   - **è¡¥å¡æ—¶æ•ˆ**ï¼šåªèƒ½è¡¥æœ€è¿‘7å¤©å†…çš„æ‰“å¡
   - **è¡¥å¡ç±»å‹**ï¼šå¯ä»¥è¡¥ä¸Šç­å¡æˆ–ä¸‹ç­å¡
   - **è¡¥å¡åœºæ™¯**ï¼š
     - âœ… å¿˜è®°æ‰“å¡ï¼ˆç¼ºå¡ï¼‰
     - âœ… æ‰“å¡å¤±è´¥ï¼ˆç³»ç»Ÿæ•…éšœï¼‰
     - âœ… ä½ç½®å¼‚å¸¸æ‰“å¡ï¼ˆéœ€è¦ä¿®æ­£ï¼‰
     - âŒ å·²æœ‰æ­£å¸¸æ‰“å¡è®°å½•ï¼Œä¸èƒ½é‡å¤è¡¥å¡
   - **æ¬¡æ•°ç»Ÿè®¡**ï¼šè¡¥å¡æ¬¡æ•°æŒ‰æœˆç»Ÿè®¡ï¼Œæ¯æœˆ1å·é‡ç½®

2. **è¡¥å¡æ ¡éªŒè§„åˆ™**
   ```java
   // è¡¥å¡å‰ç½®æ ¡éªŒ
   1. æ£€æŸ¥å½“æœˆå·²è¡¥å¡æ¬¡æ•° < 3æ¬¡ï¼ˆæˆ–é…ç½®å€¼ï¼‰
   2. æ£€æŸ¥è¡¥å¡æ—¥æœŸåœ¨æœ€è¿‘7å¤©å†…
   3. æ£€æŸ¥è¯¥æ—¶æ®µæ˜¯å¦å·²æœ‰æ­£å¸¸æ‰“å¡è®°å½•
   4. æ£€æŸ¥æ˜¯å¦åœ¨å·¥ä½œæ—¥ï¼ˆèŠ‚å‡æ—¥ä¸å…è®¸è¡¥å¡ï¼‰
   5. æ£€æŸ¥æ˜¯å¦æœ‰è¯·å‡/å‡ºå·®è®°å½•ï¼ˆæœ‰åˆ™ä¸èƒ½è¡¥å¡ï¼‰
   ```

3. **å®¡æ‰¹åå¤„ç†**
   - âœ… è‡ªåŠ¨åˆ›å»ºæ‰“å¡è®°å½•
   - âœ… æ ‡è®°æ‰“å¡æ¥æºä¸º"è¡¥å¡"
   - âœ… ç´¯åŠ å½“æœˆè¡¥å¡æ¬¡æ•°
   - âœ… é‡æ–°è®¡ç®—å½“æ—¥è€ƒå‹¤ç»Ÿè®¡
   - âœ… æ›´æ–°æœˆåº¦æ±‡æ€»æ•°æ®

### 3.5 è€ƒå‹¤ç»Ÿè®¡æ¨¡å—

#### åŠŸèƒ½æè¿°
è‡ªåŠ¨ç»Ÿè®¡å‘˜å·¥æ¯æ—¥ã€æ¯æœˆè€ƒå‹¤æ•°æ®ï¼ŒåŒ…æ‹¬å‡ºå‹¤å¤©æ•°ã€è¿Ÿåˆ°æ¬¡æ•°ã€å·¥ä½œæ—¶é•¿ç­‰ã€‚

#### ç»Ÿè®¡ç»´åº¦

```mermaid
graph TD
    ROOT["ğŸ“Š è€ƒå‹¤ç»Ÿè®¡ä½“ç³»"]
    
    ROOT --> DIM1["ğŸ“… æ—¶é—´ç»´åº¦"]
    ROOT --> DIM2["ğŸ‘¥ äººå‘˜ç»´åº¦"]
    ROOT --> DIM3["ğŸ“ˆ æŒ‡æ ‡ç»´åº¦"]
    
    DIM1 --> T1["ğŸ“† æ—¥ç»Ÿè®¡<br/>æ¯æ—¥è€ƒå‹¤æ˜ç»†"]
    DIM1 --> T2["ğŸ“… å‘¨ç»Ÿè®¡<br/>æœ¬å‘¨å‡ºå‹¤æƒ…å†µ"]
    DIM1 --> T3["ğŸ“Š æœˆç»Ÿè®¡<br/>æœˆåº¦è€ƒå‹¤æ±‡æ€»"]
    
    DIM2 --> P1["ğŸ‘¤ ä¸ªäººç»Ÿè®¡<br/>ä¸ªäººè€ƒå‹¤è®°å½•"]
    DIM2 --> P2["ğŸ‘¥ éƒ¨é—¨ç»Ÿè®¡<br/>éƒ¨é—¨è€ƒå‹¤æ±‡æ€»"]
    DIM2 --> P3["ğŸ¢ å…¬å¸ç»Ÿè®¡<br/>å…¨å…¬å¸è€ƒå‹¤"]
    
    DIM3 --> I1["âœ… å‡ºå‹¤æŒ‡æ ‡<br/>åº”å‡ºå‹¤/å®é™…/ç‡"]
    DIM3 --> I2["âš ï¸ å¼‚å¸¸æŒ‡æ ‡<br/>è¿Ÿåˆ°/æ—©é€€/ç¼ºå¡"]
    DIM3 --> I3["â±ï¸ å·¥æ—¶æŒ‡æ ‡<br/>å·¥ä½œ/åŠ ç­æ—¶é•¿"]
    DIM3 --> I4["ğŸ“ è¯·å‡æŒ‡æ ‡<br/>è¯·å‡/å‡ºå·®å¤©æ•°"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef dimStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef timeStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef personStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef indexStyle fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px
    
    class ROOT rootStyle
    class DIM1,DIM2,DIM3 dimStyle
    class T1,T2,T3 timeStyle
    class P1,P2,P3 personStyle
    class I1,I2,I3,I4 indexStyle
```

#### è®¡ç®—è§„åˆ™

**åº”å‡ºå‹¤å¤©æ•°è®¡ç®—**ï¼š
```
åº”å‡ºå‹¤å¤©æ•° = å½“æœˆæ€»å¤©æ•° - å‘¨æœ«å¤©æ•° - æ³•å®šèŠ‚å‡æ—¥å¤©æ•° + è°ƒä¼‘è¡¥ç­å¤©æ•°
```

**å®é™…å‡ºå‹¤å¤©æ•°è®¡ç®—**ï¼š
```
å®é™…å‡ºå‹¤å¤©æ•° = æ­£å¸¸æ‰“å¡å¤©æ•° + å‡ºå·®å¤©æ•° + å¹´å‡å¤©æ•° + å…¶ä»–ä¸æ‰£é™¤è€ƒå‹¤çš„å‡æœŸ
```

**å‡ºå‹¤ç‡è®¡ç®—**ï¼š
```
å‡ºå‹¤ç‡ = (å®é™…å‡ºå‹¤å¤©æ•° / åº”å‡ºå‹¤å¤©æ•°) Ã— 100%
```

**å·¥ä½œæ—¶é•¿è®¡ç®—**ï¼š
```
æ—¥å·¥ä½œæ—¶é•¿ = ä¸‹åˆæ‰“å¡æ—¶é—´ - ä¸Šåˆæ‰“å¡æ—¶é—´ - åˆä¼‘æ—¶é—´
æœˆå·¥ä½œæ—¶é•¿ = âˆ‘ æ—¥å·¥ä½œæ—¶é•¿
```

#### å®šæ—¶ä»»åŠ¡è®¾è®¡

| ä»»åŠ¡åç§° | æ‰§è¡Œæ—¶é—´ | æ‰§è¡Œå†…å®¹ |
|---------|---------|---------|
| æ¯æ—¥ç»Ÿè®¡ä»»åŠ¡ | æ¯å¤© 01:00 | ç»Ÿè®¡æ˜¨æ—¥æ‰€æœ‰å‘˜å·¥è€ƒå‹¤æ•°æ® |
| æ¯æœˆæ±‡æ€»ä»»åŠ¡ | æ¯æœˆ1å· 01:00 | ç”Ÿæˆä¸Šæœˆè€ƒå‹¤æœˆæŠ¥ |
| æ•°æ®æ¸…ç†ä»»åŠ¡ | æ¯æœˆ1å· 02:00 | æ¸…ç†6ä¸ªæœˆå‰çš„è¯¦ç»†æ•°æ® |

#### ç»Ÿè®¡SQLå®ç°

**1. æ¯æ—¥è€ƒå‹¤ç»Ÿè®¡SQL**

```sql
-- ç»Ÿè®¡æŸä¸€å¤©çš„è€ƒå‹¤æ•°æ®ï¼ˆæ’å…¥æˆ–æ›´æ–°ç»Ÿè®¡è¡¨ï¼‰
INSERT INTO attendance_statistics (
    user_id, 
    stat_date, 
    am_in_time, 
    pm_out_time,
    is_late,
    late_minutes,
    is_early,
    early_minutes,
    is_absence,
    absence_times,
    work_hours,
    status
)
SELECT 
    u.user_id,
    DATE('2025-01-28') AS stat_date,
    
    -- ä¸Šåˆä¸Šç­æ—¶é—´ï¼ˆå–å½“å¤©æœ€æ—©çš„ä¸Šç­æ‰“å¡ï¼‰
    MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) AS am_in_time,
    
    -- ä¸‹åˆä¸‹ç­æ—¶é—´ï¼ˆå–å½“å¤©æœ€æ™šçš„ä¸‹ç­æ‰“å¡ï¼‰
    MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) AS pm_out_time,
    
    -- æ˜¯å¦è¿Ÿåˆ°ï¼ˆä¸Šç­æ—¶é—´æ™šäº8:30ï¼‰
    CASE 
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) > DATE_ADD(DATE('2025-01-28'), INTERVAL 8*60+30 MINUTE)
        THEN '1' 
        ELSE '0' 
    END AS is_late,
    
    -- è¿Ÿåˆ°åˆ†é’Ÿæ•°
    CASE 
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) > DATE_ADD(DATE('2025-01-28'), INTERVAL 8*60+30 MINUTE)
        THEN TIMESTAMPDIFF(MINUTE, DATE_ADD(DATE('2025-01-28'), INTERVAL 8*60+30 MINUTE), 
                          MIN(CASE WHEN r.check_type = '1' THEN r.check_time END))
        ELSE 0 
    END AS late_minutes,
    
    -- æ˜¯å¦æ—©é€€ï¼ˆä¸‹ç­æ—¶é—´æ—©äº18:00ï¼‰
    CASE 
        WHEN MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) < DATE_ADD(DATE('2025-01-28'), INTERVAL 18*60 MINUTE)
        THEN '1' 
        ELSE '0' 
    END AS is_early,
    
    -- æ—©é€€åˆ†é’Ÿæ•°
    CASE 
        WHEN MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) < DATE_ADD(DATE('2025-01-28'), INTERVAL 18*60 MINUTE)
        THEN TIMESTAMPDIFF(MINUTE, MAX(CASE WHEN r.check_type = '2' THEN r.check_time END),
                          DATE_ADD(DATE('2025-01-28'), INTERVAL 18*60 MINUTE))
        ELSE 0 
    END AS early_minutes,
    
    -- æ˜¯å¦ç¼ºå¡ï¼ˆä¸Šç­æˆ–ä¸‹ç­æ‰“å¡ç¼ºå¤±ï¼‰
    CASE 
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) IS NULL 
          OR MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) IS NULL
        THEN '1' 
        ELSE '0' 
    END AS is_absence,
    
    -- ç¼ºå¡æ¬¡æ•°
    CASE 
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) IS NULL THEN 1 ELSE 0 
    END + 
    CASE 
        WHEN MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) IS NULL THEN 1 ELSE 0 
    END AS absence_times,
    
    -- å·¥ä½œæ—¶é•¿ï¼ˆä¸‹ç­-ä¸Šç­-åˆä¼‘1.5å°æ—¶ï¼‰
    CASE 
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) IS NOT NULL 
         AND MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) IS NOT NULL
        THEN ROUND(
            TIMESTAMPDIFF(MINUTE, 
                MIN(CASE WHEN r.check_type = '1' THEN r.check_time END),
                MAX(CASE WHEN r.check_type = '2' THEN r.check_time END)
            ) / 60.0 - 1.5, 2
        )
        ELSE 0 
    END AS work_hours,
    
    -- çŠ¶æ€åˆ¤æ–­
    CASE 
        -- ä¼˜å…ˆåˆ¤æ–­è¯·å‡
        WHEN EXISTS (
            SELECT 1 FROM attendance_leave l 
            WHERE l.user_id = u.user_id 
              AND l.status = '1'
              AND DATE('2025-01-28') BETWEEN DATE(l.start_time) AND DATE(l.end_time)
        ) THEN 'è¯·å‡'
        
        -- åˆ¤æ–­å‡ºå·®
        WHEN EXISTS (
            SELECT 1 FROM attendance_trip t 
            WHERE t.user_id = u.user_id 
              AND t.status = '1'
              AND DATE('2025-01-28') BETWEEN DATE(t.start_time) AND DATE(t.end_time)
        ) THEN 'å‡ºå·®'
        
        -- åˆ¤æ–­ç¼ºå¡
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) IS NULL 
          OR MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) IS NULL
        THEN 'ç¼ºå¡'
        
        -- åˆ¤æ–­è¿Ÿåˆ°
        WHEN MIN(CASE WHEN r.check_type = '1' THEN r.check_time END) > DATE_ADD(DATE('2025-01-28'), INTERVAL 8*60+30 MINUTE)
        THEN 'è¿Ÿåˆ°'
        
        -- åˆ¤æ–­æ—©é€€
        WHEN MAX(CASE WHEN r.check_type = '2' THEN r.check_time END) < DATE_ADD(DATE('2025-01-28'), INTERVAL 18*60 MINUTE)
        THEN 'æ—©é€€'
        
        ELSE 'æ­£å¸¸'
    END AS status
    
FROM sys_user u
LEFT JOIN attendance_record r ON u.user_id = r.user_id 
    AND DATE(r.check_time) = DATE('2025-01-28')
WHERE u.status = '0'  -- åªç»Ÿè®¡åœ¨èŒå‘˜å·¥
GROUP BY u.user_id
ON DUPLICATE KEY UPDATE
    am_in_time = VALUES(am_in_time),
    pm_out_time = VALUES(pm_out_time),
    is_late = VALUES(is_late),
    late_minutes = VALUES(late_minutes),
    is_early = VALUES(is_early),
    early_minutes = VALUES(early_minutes),
    is_absence = VALUES(is_absence),
    absence_times = VALUES(absence_times),
    work_hours = VALUES(work_hours),
    status = VALUES(status);
```

**2. æœˆåº¦è€ƒå‹¤æ±‡æ€»SQL**

```sql
-- ç”ŸæˆæŸæœˆçš„è€ƒå‹¤æ±‡æ€»æŠ¥è¡¨
INSERT INTO attendance_monthly_summary (
    user_id,
    year_month,
    work_days,
    actual_days,
    late_times,
    early_times,
    absence_times,
    leave_days,
    trip_days,
    work_hours,
    attendance_rate
)
SELECT 
    u.user_id,
    '2025-01' AS year_month,
    
    -- åº”å‡ºå‹¤å¤©æ•° = å½“æœˆå¤©æ•° - å‘¨æœ«å¤©æ•° - èŠ‚å‡æ—¥å¤©æ•° + è¡¥ç­å¤©æ•°
    (
        DAY(LAST_DAY('2025-01-01'))  -- å½“æœˆæ€»å¤©æ•°
        - (
            -- å‘¨æœ«å¤©æ•°
            SELECT COUNT(*) 
            FROM (
                SELECT DATE_ADD('2025-01-01', INTERVAL seq DAY) AS d
                FROM (
                    SELECT a.N + b.N * 10 AS seq
                    FROM 
                        (SELECT 0 AS N UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
                         UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) a,
                        (SELECT 0 AS N UNION SELECT 1 UNION SELECT 2 UNION SELECT 3) b
                ) nums
                WHERE DATE_ADD('2025-01-01', INTERVAL seq DAY) <= LAST_DAY('2025-01-01')
            ) dates
            WHERE DAYOFWEEK(d) IN (1, 7)  -- å‘¨æ—¥=1, å‘¨å…­=7
        )
        - (
            -- æ³•å®šèŠ‚å‡æ—¥å¤©æ•°ï¼ˆæ’é™¤è¡¥ç­æ—¥ï¼‰
            SELECT COUNT(*) 
            FROM attendance_holiday 
            WHERE holiday_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
              AND holiday_type = '0'
        )
        + (
            -- è¡¥ç­å¤©æ•°
            SELECT COUNT(*) 
            FROM attendance_holiday 
            WHERE holiday_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
              AND holiday_type = '1'
        )
    ) AS work_days,
    
    -- å®é™…å‡ºå‹¤å¤©æ•°ï¼ˆæ­£å¸¸+è¿Ÿåˆ°+æ—©é€€ï¼‰
    COALESCE((
        SELECT COUNT(*) 
        FROM attendance_statistics s
        WHERE s.user_id = u.user_id
          AND s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
          AND s.status IN ('æ­£å¸¸', 'è¿Ÿåˆ°', 'æ—©é€€')
    ), 0) AS actual_days,
    
    -- è¿Ÿåˆ°æ¬¡æ•°
    COALESCE((
        SELECT COUNT(*) 
        FROM attendance_statistics s
        WHERE s.user_id = u.user_id
          AND s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
          AND s.is_late = '1'
    ), 0) AS late_times,
    
    -- æ—©é€€æ¬¡æ•°
    COALESCE((
        SELECT COUNT(*) 
        FROM attendance_statistics s
        WHERE s.user_id = u.user_id
          AND s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
          AND s.is_early = '1'
    ), 0) AS early_times,
    
    -- ç¼ºå¡æ¬¡æ•°
    COALESCE((
        SELECT SUM(s.absence_times) 
        FROM attendance_statistics s
        WHERE s.user_id = u.user_id
          AND s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
    ), 0) AS absence_times,
    
    -- è¯·å‡å¤©æ•°
    COALESCE((
        SELECT SUM(l.leave_days) 
        FROM attendance_leave l
        WHERE l.user_id = u.user_id
          AND l.status = '1'
          AND (
              (DATE(l.start_time) BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01'))
              OR (DATE(l.end_time) BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01'))
              OR (DATE(l.start_time) <= '2025-01-01' AND DATE(l.end_time) >= LAST_DAY('2025-01-01'))
          )
    ), 0) AS leave_days,
    
    -- å‡ºå·®å¤©æ•°
    COALESCE((
        SELECT SUM(t.trip_days) 
        FROM attendance_trip t
        WHERE t.user_id = u.user_id
          AND t.status = '1'
          AND (
              (DATE(t.start_time) BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01'))
              OR (DATE(t.end_time) BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01'))
              OR (DATE(t.start_time) <= '2025-01-01' AND DATE(t.end_time) >= LAST_DAY('2025-01-01'))
          )
    ), 0) AS trip_days,
    
    -- å·¥ä½œæ—¶é•¿
    COALESCE((
        SELECT SUM(s.work_hours) 
        FROM attendance_statistics s
        WHERE s.user_id = u.user_id
          AND s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
    ), 0) AS work_hours,
    
    -- å‡ºå‹¤ç‡ï¼ˆå®é™…å‡ºå‹¤/åº”å‡ºå‹¤*100ï¼‰
    ROUND(
        COALESCE((
            SELECT COUNT(*) 
            FROM attendance_statistics s
            WHERE s.user_id = u.user_id
              AND s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
              AND s.status IN ('æ­£å¸¸', 'è¿Ÿåˆ°', 'æ—©é€€')
        ), 0) * 100.0 / 
        GREATEST((
            DAY(LAST_DAY('2025-01-01'))
            - (SELECT COUNT(*) FROM (
                SELECT DATE_ADD('2025-01-01', INTERVAL seq DAY) AS d
                FROM (
                    SELECT a.N + b.N * 10 AS seq
                    FROM 
                        (SELECT 0 AS N UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
                         UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) a,
                        (SELECT 0 AS N UNION SELECT 1 UNION SELECT 2 UNION SELECT 3) b
                ) nums
                WHERE DATE_ADD('2025-01-01', INTERVAL seq DAY) <= LAST_DAY('2025-01-01')
            ) dates WHERE DAYOFWEEK(d) IN (1, 7))
            - COALESCE((SELECT COUNT(*) FROM attendance_holiday 
                WHERE holiday_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
                  AND holiday_type = '0'), 0)
            + COALESCE((SELECT COUNT(*) FROM attendance_holiday 
                WHERE holiday_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
                  AND holiday_type = '1'), 0)
        ), 1),
        2
    ) AS attendance_rate
    
FROM sys_user u
WHERE u.status = '0'  -- åªç»Ÿè®¡åœ¨èŒå‘˜å·¥
ON DUPLICATE KEY UPDATE
    work_days = VALUES(work_days),
    actual_days = VALUES(actual_days),
    late_times = VALUES(late_times),
    early_times = VALUES(early_times),
    absence_times = VALUES(absence_times),
    leave_days = VALUES(leave_days),
    trip_days = VALUES(trip_days),
    work_hours = VALUES(work_hours),
    attendance_rate = VALUES(attendance_rate);
```

**3. æŸ¥è¯¢ä¸ªäººæœˆåº¦ç»Ÿè®¡**

```sql
-- æŸ¥è¯¢æŸç”¨æˆ·æŸæœˆçš„è€ƒå‹¤ç»Ÿè®¡
SELECT 
    user_id,
    year_month,
    work_days AS 'åº”å‡ºå‹¤å¤©æ•°',
    actual_days AS 'å®é™…å‡ºå‹¤å¤©æ•°',
    late_times AS 'è¿Ÿåˆ°æ¬¡æ•°',
    early_times AS 'æ—©é€€æ¬¡æ•°',
    absence_times AS 'ç¼ºå¡æ¬¡æ•°',
    leave_days AS 'è¯·å‡å¤©æ•°',
    trip_days AS 'å‡ºå·®å¤©æ•°',
    work_hours AS 'å·¥ä½œæ—¶é•¿(å°æ—¶)',
    attendance_rate AS 'å‡ºå‹¤ç‡(%)'
FROM attendance_monthly_summary
WHERE user_id = 1
  AND year_month = '2025-01';
```

**4. æŸ¥è¯¢éƒ¨é—¨è€ƒå‹¤æŠ¥è¡¨**

```sql
-- æŸ¥è¯¢æŸéƒ¨é—¨æŸæœˆçš„è€ƒå‹¤æ±‡æ€»
SELECT 
    u.user_id,
    u.user_name,
    u.nick_name,
    d.dept_name,
    s.work_days AS 'åº”å‡ºå‹¤',
    s.actual_days AS 'å®é™…å‡ºå‹¤',
    s.attendance_rate AS 'å‡ºå‹¤ç‡(%)',
    s.late_times AS 'è¿Ÿåˆ°',
    s.early_times AS 'æ—©é€€',
    s.absence_times AS 'ç¼ºå¡',
    s.leave_days AS 'è¯·å‡',
    s.work_hours AS 'å·¥æ—¶'
FROM attendance_monthly_summary s
INNER JOIN sys_user u ON s.user_id = u.user_id
INNER JOIN sys_dept d ON u.dept_id = d.dept_id
WHERE d.dept_id = 1
  AND s.year_month = '2025-01'
ORDER BY s.attendance_rate DESC;
```

**5. æŸ¥è¯¢å¼‚å¸¸è€ƒå‹¤æ˜ç»†**

```sql
-- æŸ¥è¯¢æŸæœˆè¿Ÿåˆ°æ˜ç»†
SELECT 
    u.user_id,
    u.user_name,
    u.nick_name,
    d.dept_name,
    s.stat_date AS 'æ—¥æœŸ',
    s.am_in_time AS 'ä¸Šç­æ‰“å¡æ—¶é—´',
    s.late_minutes AS 'è¿Ÿåˆ°åˆ†é’Ÿæ•°',
    s.remark AS 'å¤‡æ³¨'
FROM attendance_statistics s
INNER JOIN sys_user u ON s.user_id = u.user_id
INNER JOIN sys_dept d ON u.dept_id = d.dept_id
WHERE s.stat_date BETWEEN '2025-01-01' AND LAST_DAY('2025-01-01')
  AND s.is_late = '1'
ORDER BY s.stat_date DESC, s.late_minutes DESC;
```

### 3.6 è€ƒå‹¤æŠ¥è¡¨æ¨¡å—

#### åŠŸèƒ½æè¿°
æä¾›å¤šç»´åº¦çš„è€ƒå‹¤æŠ¥è¡¨ï¼Œæ”¯æŒå¯¼å‡ºExcelï¼Œæ–¹ä¾¿ç®¡ç†å±‚å†³ç­–ã€‚

#### æŠ¥è¡¨ç±»å‹

```mermaid
graph TD
    ROOT["ğŸ“Š è€ƒå‹¤æŠ¥è¡¨ä½“ç³»"]
    
    ROOT --> RPT1["ğŸ‘¤ ä¸ªäººæŠ¥è¡¨"]
    ROOT --> RPT2["ğŸ‘¥ éƒ¨é—¨æŠ¥è¡¨"]
    ROOT --> RPT3["âš ï¸ å¼‚å¸¸æŠ¥è¡¨"]
    ROOT --> RPT4["ğŸ“ˆ æ±‡æ€»æŠ¥è¡¨"]
    
    RPT1 --> R1["æœˆåº¦æ˜ç»†<br/>è€ƒå‹¤è¯¦æƒ…"]
    RPT1 --> R2["å¹´åº¦æ±‡æ€»<br/>å…¨å¹´ç»Ÿè®¡"]
    RPT1 --> R3["æ‰“å¡è®°å½•<br/>å†å²æŸ¥è¯¢"]
    
    RPT2 --> D1["æœˆåº¦ç»Ÿè®¡<br/>éƒ¨é—¨æ±‡æ€»"]
    RPT2 --> D2["å‡ºå‹¤æ’å<br/>éƒ¨é—¨å¯¹æ¯”"]
    RPT2 --> D3["å¼‚å¸¸åˆ†æ<br/>é—®é¢˜å®šä½"]
    
    RPT3 --> E1["è¿Ÿåˆ°æ—©é€€<br/>æ˜ç»†åˆ—è¡¨"]
    RPT3 --> E2["ç¼ºå¡ç»Ÿè®¡<br/>äººå‘˜æ±‡æ€»"]
    RPT3 --> E3["è¶‹åŠ¿åˆ†æ<br/>å¼‚å¸¸èµ°åŠ¿"]
    
    RPT4 --> S1["å…¬å¸æœˆæŠ¥<br/>æ•´ä½“æ•°æ®"]
    RPT4 --> S2["è¯·å‡åˆ†æ<br/>ç±»å‹ç»Ÿè®¡"]
    RPT4 --> S3["å‡ºå‹¤è¶‹åŠ¿<br/>å›¾è¡¨å±•ç¤º"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef categoryStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef personalStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef deptStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef errorStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef summaryStyle fill:#ffe0b2,stroke:#ef6c00,stroke-width:2px
    
    class ROOT rootStyle
    class RPT1,RPT2,RPT3,RPT4 categoryStyle
    class R1,R2,R3 personalStyle
    class D1,D2,D3 deptStyle
    class E1,E2,E3 errorStyle
    class S1,S2,S3 summaryStyle
```

#### æ•°æ®å±•ç¤º

1. **è¡¨æ ¼å±•ç¤º**ï¼šè¯¦ç»†çš„æ•°æ®åˆ—è¡¨
2. **å›¾è¡¨å±•ç¤º**ï¼šæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾
3. **æ—¥å†å±•ç¤º**ï¼šç›´è§‚çš„æ—¥å†è§†å›¾
4. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒExcelå¯¼å‡º

### 3.7 è§„åˆ™é…ç½®æ¨¡å—

#### åŠŸèƒ½æè¿°
ç³»ç»Ÿç®¡ç†å‘˜é…ç½®è€ƒå‹¤è§„åˆ™ã€å·¥ä½œæ—¶é—´ã€èŠ‚å‡æ—¥ç­‰åŸºç¡€æ•°æ®ã€‚

#### é…ç½®é¡¹

```mermaid
graph TD
    ROOT["âš™ï¸ ç³»ç»Ÿé…ç½®ä¸­å¿ƒ"]
    
    ROOT --> CFG1["ğŸ“‹ è€ƒå‹¤è§„åˆ™"]
    ROOT --> CFG2["ğŸ“… èŠ‚å‡æ—¥ç®¡ç†"]
    ROOT --> CFG3["âœ… å®¡æ‰¹é…ç½®"]
    
    CFG1 --> R1["â° ä¸Šä¸‹ç­æ—¶é—´<br/>æ‰“å¡æ—¶æ®µè®¾ç½®"]
    CFG1 --> R2["â±ï¸ é˜ˆå€¼è®¾ç½®<br/>è¿Ÿåˆ°/æ—©é€€åˆ¤å®š"]
    CFG1 --> R3["ğŸ“± æ‰“å¡æ–¹å¼<br/>GPS/WiFi/IP"]
    CFG1 --> R4["âš ï¸ å¼‚å¸¸è§„åˆ™<br/>åˆ¤å®šæ ‡å‡†"]
    
    CFG2 --> H1["ğŸŠ æ³•å®šèŠ‚å‡æ—¥<br/>å›½å®¶è§„å®š"]
    CFG2 --> H2["ğŸ”„ è°ƒä¼‘è¡¥ç­<br/>å·¥ä½œæ—¥è°ƒæ•´"]
    CFG2 --> H3["ğŸ‰ å…¬å¸å‡æœŸ<br/>ç‰¹æ®Šå‡æ—¥"]
    
    CFG3 --> A1["ğŸ”„ å®¡æ‰¹æµç¨‹<br/>æµç¨‹å®šä¹‰"]
    CFG3 --> A2["ğŸ‘¤ å®¡æ‰¹äºº<br/>æƒé™åˆ†é…"]
    CFG3 --> A3["ğŸ” å®¡æ‰¹æƒé™<br/>è§’è‰²è®¾ç½®"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef categoryStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef ruleStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef holidayStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef approvalStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class ROOT rootStyle
    class CFG1,CFG2,CFG3 categoryStyle
    class R1,R2,R3,R4 ruleStyle
    class H1,H2,H3 holidayStyle
    class A1,A2,A3 approvalStyle
```

---

## å››ã€ä¸šåŠ¡æµç¨‹è®¾è®¡

### 4.1 è€ƒå‹¤æ‰“å¡å®Œæ•´æµç¨‹

```mermaid
flowchart TD
    A[å‘˜å·¥æ‰“å¼€è€ƒå‹¤é¡µé¢] --> B{é€‰æ‹©æ‰“å¡ç±»å‹}
    B -->|ä¸Šç­æ‰“å¡| C[è·å–å½“å‰æ—¶é—´å’Œä½ç½®]
    B -->|ä¸‹ç­æ‰“å¡| C
    
    C --> D{éªŒè¯æ‰“å¡è§„åˆ™}
    
    D -->|æ—¶é—´åˆæ³•| E{ä½ç½®åˆæ³•?}
    D -->|æ—¶é—´å¼‚å¸¸| F[æ ‡è®°è¿Ÿåˆ°/æ—©é€€]
    
    E -->|ä½ç½®åˆæ³•| G[ä¿å­˜æ‰“å¡è®°å½•]
    E -->|ä½ç½®å¼‚å¸¸| H[æç¤ºä½ç½®å¼‚å¸¸]
    
    F --> G
    H --> I{æ˜¯å¦å¼ºåˆ¶æ‰“å¡?}
    I -->|æ˜¯| G
    I -->|å¦| J[æ‰“å¡å¤±è´¥]
    
    G --> K[å®æ—¶æ›´æ–°è€ƒå‹¤ç»Ÿè®¡]
    K --> L{æ˜¯å¦æœ‰å¼‚å¸¸?}
    
    L -->|æœ‰| M[æ¨é€å¼‚å¸¸é€šçŸ¥]
    L -->|æ— | N[æ‰“å¡æˆåŠŸ]
    
    M --> N
    J --> O[ç»“æŸ]
    N --> O
```

### 4.2 è¯·å‡å®¡æ‰¹å®Œæ•´æµç¨‹

```mermaid
flowchart TD
    A[å‘˜å·¥å‘èµ·è¯·å‡ç”³è¯·] --> B[å¡«å†™è¯·å‡ä¿¡æ¯]
    B --> C[é€‰æ‹©è¯·å‡ç±»å‹]
    C --> D{éœ€è¦è¯æ˜ææ–™?}
    
    D -->|éœ€è¦| E[ä¸Šä¼ è¯æ˜ææ–™]
    D -->|ä¸éœ€è¦| F[æäº¤ç”³è¯·]
    E --> F
    
    F --> G[ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å®¡æ‰¹äºº]
    G --> H[è¿›å…¥å¾…å®¡æ‰¹çŠ¶æ€]
    
    H --> I{å‘˜å·¥æ˜¯å¦æ’¤å›?}
    I -->|æ˜¯| J[å˜æ›´ä¸ºå·²æ’¤é”€]
    I -->|å¦| K[å®¡æ‰¹äººæ”¶åˆ°é€šçŸ¥]
    
    K --> L{å®¡æ‰¹äººæ“ä½œ}
    
    L -->|é€šè¿‡| M[å˜æ›´ä¸ºå·²é€šè¿‡]
    L -->|æ‹’ç»| N[å˜æ›´ä¸ºå·²æ‹’ç»]
    
    M --> O[è§¦å‘è€ƒå‹¤é‡ç®—]
    O --> P[æ‰£é™¤è¯·å‡å¤©æ•°]
    P --> Q[æ›´æ–°æœˆåº¦ç»Ÿè®¡]
    Q --> R[é€šçŸ¥ç”³è¯·äºº]
    
    N --> R
    J --> R
    R --> S[æµç¨‹ç»“æŸ]
```

### 4.3 è¡¥å¡å®¡æ‰¹ä¸è€ƒå‹¤æ›´æ–°æµç¨‹

```mermaid
flowchart TD
    A[å‘˜å·¥å‘ç°æ¼æ‰“å¡] --> B[æŸ¥çœ‹å½“æ—¥è€ƒå‹¤è®°å½•]
    B --> C{æ˜¯å¦å¯ä»¥è¡¥å¡?}
    
    C -->|å¦| D[æŸ¥çœ‹åŸå› è¯´æ˜]
    C -->|æ˜¯| E[å‘èµ·è¡¥å¡ç”³è¯·]
    
    E --> F[å¡«å†™è¡¥å¡ä¿¡æ¯]
    F --> G[è¡¥å¡æ—¥æœŸ/æ—¶é—´/ç±»å‹]
    G --> H[å¡«å†™è¡¥å¡åŸå› ]
    H --> I[æäº¤å®¡æ‰¹]
    
    I --> J[å®¡æ‰¹äººå®¡æ ¸]
    J --> K{å®¡æ‰¹ç»“æœ}
    
    K -->|é€šè¿‡| L[åˆ›å»ºæ‰“å¡è®°å½•]
    K -->|æ‹’ç»| M[é€šçŸ¥æ‹’ç»åŸå› ]
    
    L --> N[æ ‡è®°æ¥æºä¸ºè¡¥å¡]
    N --> O[é‡æ–°è®¡ç®—å½“æ—¥è€ƒå‹¤]
    O --> P{å½“æ—¥çŠ¶æ€}
    
    P -->|ç¼ºå¡| Q[æ›´æ–°ä¸ºæ­£å¸¸]
    P -->|è¿Ÿåˆ°| R[ä¿æŒè¿Ÿåˆ°çŠ¶æ€]
    P -->|æ—©é€€| S[ä¿æŒæ—©é€€çŠ¶æ€]
    
    Q --> T[æ›´æ–°æœˆåº¦ç»Ÿè®¡]
    R --> T
    S --> T
    T --> U[é€šçŸ¥è¡¥å¡æˆåŠŸ]
    
    M --> V[è¡¥å¡å¤±è´¥]
    U --> W[æµç¨‹ç»“æŸ]
    V --> W
    D --> W
```

### 4.4 æœˆåº¦è€ƒå‹¤ç»Ÿè®¡æµç¨‹

```mermaid
flowchart TD
    A[æœˆåˆå‡Œæ™¨1ç‚¹è§¦å‘] --> B[è·å–ä¸Šæœˆæ‰€æœ‰å‘˜å·¥]
    B --> C[å¾ªç¯å¤„ç†æ¯ä¸ªå‘˜å·¥]
    
    C --> D[è®¡ç®—åº”å‡ºå‹¤å¤©æ•°]
    D --> E[æŸ¥è¯¢æ³•å®šèŠ‚å‡æ—¥]
    E --> F[è®¡ç®—å‘¨æœ«å¤©æ•°]
    F --> G[è®¡ç®—è°ƒä¼‘è¡¥ç­å¤©æ•°]
    G --> H[åº”å‡ºå‹¤ = æ€»å¤©æ•° - å‘¨æœ« - èŠ‚å‡æ—¥ + è¡¥ç­]
    
    H --> I[ç»Ÿè®¡å®é™…å‡ºå‹¤æƒ…å†µ]
    I --> J[æŸ¥è¯¢æ—¥ç»Ÿè®¡è¡¨]
    J --> K[ç´¯è®¡æ­£å¸¸å‡ºå‹¤å¤©æ•°]
    K --> L[ç´¯è®¡è¿Ÿåˆ°æ¬¡æ•°]
    L --> M[ç´¯è®¡æ—©é€€æ¬¡æ•°]
    M --> N[ç´¯è®¡ç¼ºå¡æ¬¡æ•°]
    N --> O[ç´¯è®¡å·¥ä½œæ—¶é•¿]
    
    O --> P[æŸ¥è¯¢è¯·å‡è®°å½•]
    P --> Q[ç´¯è®¡è¯·å‡å¤©æ•°]
    Q --> R[æŸ¥è¯¢å‡ºå·®è®°å½•]
    R --> S[ç´¯è®¡å‡ºå·®å¤©æ•°]
    
    S --> T[è®¡ç®—å‡ºå‹¤ç‡]
    T --> U[å‡ºå‹¤ç‡ = å®é™…å‡ºå‹¤ / åº”å‡ºå‹¤ Ã— 100%]
    
    U --> V[ç”Ÿæˆæœˆåº¦æ±‡æ€»è®°å½•]
    V --> W{æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå‘˜å·¥?}
    
    W -->|æ˜¯| C
    W -->|å¦| X[ç”Ÿæˆéƒ¨é—¨æ±‡æ€»]
    X --> Y[ç”Ÿæˆå…¬å¸æ±‡æ€»]
    Y --> Z[ç»Ÿè®¡å®Œæˆ,å‘é€é€šçŸ¥]
    Z --> AA[æµç¨‹ç»“æŸ]
```

### 4.5 å¼‚å¸¸è€ƒå‹¤å¤„ç†æµç¨‹

```mermaid
flowchart TD
    A[ç³»ç»Ÿæ£€æµ‹åˆ°å¼‚å¸¸] --> B{å¼‚å¸¸ç±»å‹}
    
    B -->|æœªæ‰“å¡| C[æ ‡è®°ç¼ºå¡]
    B -->|è¿Ÿåˆ°| D[è®°å½•è¿Ÿåˆ°æ—¶é•¿]
    B -->|æ—©é€€| E[è®°å½•æ—©é€€æ—¶é•¿]
    B -->|ä½ç½®å¼‚å¸¸| F[æ ‡è®°å¼‚å¸¸æ‰“å¡]
    
    C --> G[æ›´æ–°è€ƒå‹¤ç»Ÿè®¡]
    D --> G
    E --> G
    F --> G
    
    G --> H[æ¨é€é€šçŸ¥ç»™å‘˜å·¥]
    H --> I{å‘˜å·¥æ˜¯å¦ç”³è¯‰?}
    
    I -->|è¡¥å¡ç”³è¯·| J[è¿›å…¥è¡¥å¡æµç¨‹]
    I -->|è¯·å‡ç”³è¯·| K[è¿›å…¥è¯·å‡æµç¨‹]
    I -->|ä¸ç”³è¯‰| L[ä¿æŒå¼‚å¸¸çŠ¶æ€]
    
    J --> M[å®¡æ‰¹æµè½¬]
    K --> M
    
    M --> N{å®¡æ‰¹ç»“æœ}
    N -->|é€šè¿‡| O[ä¿®æ­£è€ƒå‹¤è®°å½•]
    N -->|æ‹’ç»| P[ç»´æŒåŸçŠ¶æ€]
    
    O --> Q[æµç¨‹ç»“æŸ]
    P --> Q
    L --> Q
```

---

## äº”ã€æ•°æ®åº“è®¾è®¡

### 5.1 æ•°æ®åº“æ¶æ„

```mermaid
graph TD
    ROOT[("ğŸ’¾ è€ƒå‹¤æ•°æ®åº“<br/>attendance_db")]
    
    ROOT --> CORE["ğŸ“Š æ ¸å¿ƒä¸šåŠ¡è¡¨"]
    ROOT --> APPROVAL["ğŸ“ å®¡æ‰¹ä¸šåŠ¡è¡¨"]
    ROOT --> CONFIG["âš™ï¸ é…ç½®æ•°æ®è¡¨"]
    
    CORE --> T1[("attendance_record<br/>ğŸ“± æ‰“å¡è®°å½•")]
    CORE --> T2[("attendance_statistics<br/>ğŸ“Š æ—¥ç»Ÿè®¡")]
    CORE --> T3[("attendance_monthly_summary<br/>ğŸ“ˆ æœˆæ±‡æ€»")]
    CORE --> T4[("attendance_rule<br/>âš™ï¸ è§„åˆ™é…ç½®")]
    
    APPROVAL --> A1[("attendance_leave<br/>ğŸ–ï¸ è¯·å‡è®°å½•")]
    APPROVAL --> A2[("attendance_trip<br/>âœˆï¸ å‡ºå·®è®°å½•")]
    APPROVAL --> A3[("attendance_makeup<br/>ğŸ”„ è¡¥å¡ç”³è¯·")]
    
    CONFIG --> C1[("attendance_holiday<br/>ğŸ“… èŠ‚å‡æ—¥é…ç½®")]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef categoryStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef coreStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef approvalStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef configStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class ROOT rootStyle
    class CORE,APPROVAL,CONFIG categoryStyle
    class T1,T2,T3,T4 coreStyle
    class A1,A2,A3 approvalStyle
    class C1 configStyle
```

### 5.2 æ ¸å¿ƒè¡¨è®¾è®¡

#### 5.2.1 æ‰“å¡è®°å½•è¡¨ (attendance_record)

**è¡¨è¯´æ˜**ï¼šè®°å½•å‘˜å·¥æ¯æ¬¡æ‰“å¡çš„è¯¦ç»†ä¿¡æ¯

```sql
CREATE TABLE `attendance_record` (
  `record_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `check_time` DATETIME NOT NULL COMMENT 'æ‰“å¡æ—¶é—´',
  `check_type` VARCHAR(10) NOT NULL COMMENT 'æ‰“å¡ç±»å‹(1ä¸Šç­2ä¸‹ç­)',
  `check_source` VARCHAR(20) NOT NULL COMMENT 'æ‰“å¡æ¥æº(ç§»åŠ¨ç«¯/PCç«¯/è¡¥å¡)',
  `location` VARCHAR(200) DEFAULT NULL COMMENT 'æ‰“å¡ä½ç½®',
  `latitude` DECIMAL(10,7) DEFAULT NULL COMMENT 'çº¬åº¦',
  `longitude` DECIMAL(10,7) DEFAULT NULL COMMENT 'ç»åº¦',
  `is_normal` CHAR(1) NOT NULL DEFAULT '1' COMMENT 'æ˜¯å¦æ­£å¸¸(0å¦1æ˜¯)',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`record_id`),
  KEY `idx_user_time` (`user_id`, `check_time`),
  KEY `idx_check_time` (`check_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ‰“å¡è®°å½•è¡¨';
```

#### 5.2.2 è€ƒå‹¤ç»Ÿè®¡è¡¨ (attendance_statistics)

**è¡¨è¯´æ˜**ï¼šæ¯æ—¥è€ƒå‹¤ç»Ÿè®¡æ•°æ®ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢

```sql
CREATE TABLE `attendance_statistics` (
  `stat_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `stat_date` DATE NOT NULL COMMENT 'ç»Ÿè®¡æ—¥æœŸ',
  `am_in_time` DATETIME DEFAULT NULL COMMENT 'ä¸Šåˆä¸Šç­æ—¶é—´',
  `am_out_time` DATETIME DEFAULT NULL COMMENT 'ä¸Šåˆä¸‹ç­æ—¶é—´',
  `pm_in_time` DATETIME DEFAULT NULL COMMENT 'ä¸‹åˆä¸Šç­æ—¶é—´',
  `pm_out_time` DATETIME DEFAULT NULL COMMENT 'ä¸‹åˆä¸‹ç­æ—¶é—´',
  `is_late` CHAR(1) NOT NULL DEFAULT '0' COMMENT 'æ˜¯å¦è¿Ÿåˆ°(0å¦1æ˜¯)',
  `late_minutes` INT DEFAULT NULL COMMENT 'è¿Ÿåˆ°åˆ†é’Ÿæ•°',
  `is_early` CHAR(1) NOT NULL DEFAULT '0' COMMENT 'æ˜¯å¦æ—©é€€(0å¦1æ˜¯)',
  `early_minutes` INT DEFAULT NULL COMMENT 'æ—©é€€åˆ†é’Ÿæ•°',
  `is_absence` CHAR(1) NOT NULL DEFAULT '0' COMMENT 'æ˜¯å¦ç¼ºå¡(0å¦1æ˜¯)',
  `absence_times` INT DEFAULT 0 COMMENT 'ç¼ºå¡æ¬¡æ•°',
  `work_hours` DECIMAL(5,2) DEFAULT NULL COMMENT 'å·¥ä½œæ—¶é•¿(å°æ—¶)',
  `status` VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€(æ­£å¸¸/è¿Ÿåˆ°/æ—©é€€/ç¼ºå¡/è¯·å‡/å‡ºå·®)',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`stat_id`),
  UNIQUE KEY `uk_user_date` (`user_id`, `stat_date`),
  KEY `idx_stat_date` (`stat_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤ç»Ÿè®¡è¡¨';
```

#### 5.2.3 æœˆåº¦æ±‡æ€»è¡¨ (attendance_monthly_summary)

**è¡¨è¯´æ˜**ï¼šæ¯æœˆè€ƒå‹¤æ±‡æ€»æ•°æ®

```sql
CREATE TABLE `attendance_monthly_summary` (
  `summary_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `year_month` VARCHAR(7) NOT NULL COMMENT 'å¹´æœˆ(YYYY-MM)',
  `work_days` INT NOT NULL COMMENT 'åº”å‡ºå‹¤å¤©æ•°',
  `actual_days` INT NOT NULL COMMENT 'å®é™…å‡ºå‹¤å¤©æ•°',
  `late_times` INT NOT NULL DEFAULT 0 COMMENT 'è¿Ÿåˆ°æ¬¡æ•°',
  `early_times` INT NOT NULL DEFAULT 0 COMMENT 'æ—©é€€æ¬¡æ•°',
  `absence_times` INT NOT NULL DEFAULT 0 COMMENT 'ç¼ºå¡æ¬¡æ•°',
  `leave_days` DECIMAL(5,1) DEFAULT 0 COMMENT 'è¯·å‡å¤©æ•°',
  `trip_days` DECIMAL(5,1) DEFAULT 0 COMMENT 'å‡ºå·®å¤©æ•°',
  `work_hours` DECIMAL(8,2) DEFAULT NULL COMMENT 'å·¥ä½œæ—¶é•¿(å°æ—¶)',
  `attendance_rate` DECIMAL(5,2) DEFAULT NULL COMMENT 'å‡ºå‹¤ç‡(%)',
  PRIMARY KEY (`summary_id`),
  UNIQUE KEY `uk_user_month` (`user_id`, `year_month`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æœˆåº¦æ±‡æ€»è¡¨';
```

#### 5.2.4 è¯·å‡è®°å½•è¡¨ (attendance_leave)

**è¡¨è¯´æ˜**ï¼šå‘˜å·¥è¯·å‡ç”³è¯·è®°å½•

```sql
CREATE TABLE `attendance_leave` (
  `leave_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `leave_type` VARCHAR(10) NOT NULL COMMENT 'è¯·å‡ç±»å‹(1äº‹å‡2ç—…å‡3å¹´å‡4è°ƒä¼‘5å©šå‡6äº§å‡7ä¸§å‡)',
  `start_time` DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `end_time` DATETIME NOT NULL COMMENT 'ç»“æŸæ—¶é—´',
  `leave_days` DECIMAL(5,1) NOT NULL COMMENT 'è¯·å‡å¤©æ•°',
  `reason` VARCHAR(500) NOT NULL COMMENT 'è¯·å‡åŸå› ',
  `proof_url` VARCHAR(500) DEFAULT NULL COMMENT 'è¯æ˜ææ–™URL',
  `status` CHAR(1) NOT NULL DEFAULT '0' COMMENT 'å®¡æ‰¹çŠ¶æ€(0å¾…å®¡æ‰¹1é€šè¿‡2æ‹’ç»3æ’¤é”€)',
  `approver_id` BIGINT DEFAULT NULL COMMENT 'å®¡æ‰¹äººID',
  `approve_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
  `approve_remark` VARCHAR(500) DEFAULT NULL COMMENT 'å®¡æ‰¹å¤‡æ³¨',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`leave_id`),
  KEY `idx_user_status` (`user_id`, `status`),
  KEY `idx_start_time` (`start_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¯·å‡è®°å½•è¡¨';
```

#### 5.2.5 å‡ºå·®è®°å½•è¡¨ (attendance_trip)

**è¡¨è¯´æ˜**ï¼šå‘˜å·¥å‡ºå·®ç”³è¯·è®°å½•

```sql
CREATE TABLE `attendance_trip` (
  `trip_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `destination` VARCHAR(200) NOT NULL COMMENT 'å‡ºå·®åœ°ç‚¹',
  `start_time` DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
  `end_time` DATETIME NOT NULL COMMENT 'ç»“æŸæ—¶é—´',
  `trip_days` DECIMAL(5,1) NOT NULL COMMENT 'å‡ºå·®å¤©æ•°',
  `reason` VARCHAR(500) NOT NULL COMMENT 'å‡ºå·®äº‹ç”±',
  `proof_url` VARCHAR(500) DEFAULT NULL COMMENT 'è¯æ˜ææ–™URL',
  `status` CHAR(1) NOT NULL DEFAULT '0' COMMENT 'å®¡æ‰¹çŠ¶æ€(0å¾…å®¡æ‰¹1é€šè¿‡2æ‹’ç»3æ’¤é”€)',
  `approver_id` BIGINT DEFAULT NULL COMMENT 'å®¡æ‰¹äººID',
  `approve_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
  `approve_remark` VARCHAR(500) DEFAULT NULL COMMENT 'å®¡æ‰¹å¤‡æ³¨',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`trip_id`),
  KEY `idx_user_status` (`user_id`, `status`),
  KEY `idx_start_time` (`start_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å‡ºå·®è®°å½•è¡¨';
```

#### 5.2.6 è¡¥å¡ç”³è¯·è¡¨ (attendance_makeup)

**è¡¨è¯´æ˜**ï¼šå‘˜å·¥è¡¥å¡ç”³è¯·è®°å½•

```sql
CREATE TABLE `attendance_makeup` (
  `makeup_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
  `makeup_date` DATE NOT NULL COMMENT 'è¡¥å¡æ—¥æœŸ',
  `makeup_time` TIME NOT NULL COMMENT 'è¡¥å¡æ—¶é—´',
  `check_type` VARCHAR(10) NOT NULL COMMENT 'æ‰“å¡ç±»å‹(1ä¸Šç­2ä¸‹ç­)',
  `reason` VARCHAR(500) NOT NULL COMMENT 'è¡¥å¡åŸå› ',
  `status` CHAR(1) NOT NULL DEFAULT '0' COMMENT 'å®¡æ‰¹çŠ¶æ€(0å¾…å®¡æ‰¹1é€šè¿‡2æ‹’ç»3æ’¤é”€)',
  `approver_id` BIGINT DEFAULT NULL COMMENT 'å®¡æ‰¹äººID',
  `approve_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ‰¹æ—¶é—´',
  `approve_remark` VARCHAR(500) DEFAULT NULL COMMENT 'å®¡æ‰¹å¤‡æ³¨',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`makeup_id`),
  KEY `idx_user_status` (`user_id`, `status`),
  KEY `idx_makeup_date` (`makeup_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¡¥å¡ç”³è¯·è¡¨';
```

#### 5.2.7 èŠ‚å‡æ—¥é…ç½®è¡¨ (attendance_holiday)

**è¡¨è¯´æ˜**ï¼šæ³•å®šèŠ‚å‡æ—¥å’Œè°ƒä¼‘è¡¥ç­æ—¥é…ç½®

```sql
CREATE TABLE `attendance_holiday` (
  `holiday_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `holiday_date` DATE NOT NULL COMMENT 'æ—¥æœŸ',
  `holiday_type` CHAR(1) NOT NULL COMMENT 'ç±»å‹(0èŠ‚å‡æ—¥1è¡¥ç­æ—¥)',
  `holiday_name` VARCHAR(100) NOT NULL COMMENT 'èŠ‚å‡æ—¥åç§°',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`holiday_id`),
  UNIQUE KEY `uk_date` (`holiday_date`),
  KEY `idx_type` (`holiday_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='èŠ‚å‡æ—¥é…ç½®è¡¨';
```

#### 5.2.8 è€ƒå‹¤è§„åˆ™è¡¨ (attendance_rule)

**è¡¨è¯´æ˜**ï¼šè€ƒå‹¤è§„åˆ™é…ç½®

```sql
CREATE TABLE `attendance_rule` (
  `rule_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `rule_name` VARCHAR(100) NOT NULL COMMENT 'è§„åˆ™åç§°',
  `am_start_time` TIME NOT NULL COMMENT 'ä¸Šåˆä¸Šç­æ—¶é—´',
  `am_end_time` TIME NOT NULL COMMENT 'ä¸Šåˆä¸‹ç­æ—¶é—´',
  `pm_start_time` TIME NOT NULL COMMENT 'ä¸‹åˆä¸Šç­æ—¶é—´',
  `pm_end_time` TIME NOT NULL COMMENT 'ä¸‹åˆä¸‹ç­æ—¶é—´',
  `late_threshold` INT DEFAULT 0 COMMENT 'è¿Ÿåˆ°é˜ˆå€¼(åˆ†é’Ÿ)',
  `early_threshold` INT DEFAULT 0 COMMENT 'æ—©é€€é˜ˆå€¼(åˆ†é’Ÿ)',
  `is_location_check` CHAR(1) DEFAULT '1' COMMENT 'æ˜¯å¦ä½ç½®æ ¡éªŒ(0å¦1æ˜¯)',
  `location_range` INT DEFAULT 500 COMMENT 'ä½ç½®èŒƒå›´(ç±³)',
  `is_default` CHAR(1) DEFAULT '0' COMMENT 'æ˜¯å¦é»˜è®¤è§„åˆ™(0å¦1æ˜¯)',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`rule_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è€ƒå‹¤è§„åˆ™è¡¨';
```

### 5.3 æ•°æ®å…³ç³»å›¾ï¼ˆERå›¾ï¼‰

```mermaid
erDiagram
    sys_user ||--o{ attendance_record : "æ‰“å¡"
    sys_user ||--o{ attendance_statistics : "ç»Ÿè®¡"
    sys_user ||--o{ attendance_monthly_summary : "æ±‡æ€»"
    sys_user ||--o{ attendance_leave : "ç”³è¯·"
    sys_user ||--o{ attendance_trip : "ç”³è¯·"
    sys_user ||--o{ attendance_makeup : "ç”³è¯·"
    sys_user ||--o{ attendance_leave : "å®¡æ‰¹"
    sys_user ||--o{ attendance_trip : "å®¡æ‰¹"
    sys_user ||--o{ attendance_makeup : "å®¡æ‰¹"
    
    attendance_record ||--|| attendance_statistics : "ç”Ÿæˆ"
    attendance_statistics }o--|| attendance_monthly_summary : "æ±‡æ€»"
    
    sys_user {
        bigint user_id PK "ç”¨æˆ·ID"
        varchar user_name "ç”¨æˆ·å"
        varchar nick_name "æ˜µç§°"
        bigint dept_id FK "éƒ¨é—¨ID"
        char status "çŠ¶æ€"
    }
    
    attendance_record {
        bigint record_id PK "è®°å½•ID"
        bigint user_id FK "ç”¨æˆ·ID"
        datetime check_time "æ‰“å¡æ—¶é—´"
        varchar check_type "æ‰“å¡ç±»å‹"
        varchar check_source "æ‰“å¡æ¥æº"
        varchar location "ä½ç½®"
        decimal latitude "çº¬åº¦"
        decimal longitude "ç»åº¦"
        char is_normal "æ˜¯å¦æ­£å¸¸"
    }
    
    attendance_statistics {
        bigint stat_id PK "ç»Ÿè®¡ID"
        bigint user_id FK "ç”¨æˆ·ID"
        date stat_date UK "ç»Ÿè®¡æ—¥æœŸ"
        datetime am_in_time "ä¸Šåˆä¸Šç­"
        datetime pm_out_time "ä¸‹åˆä¸‹ç­"
        char is_late "æ˜¯å¦è¿Ÿåˆ°"
        int late_minutes "è¿Ÿåˆ°åˆ†é’Ÿ"
        char is_early "æ˜¯å¦æ—©é€€"
        int early_minutes "æ—©é€€åˆ†é’Ÿ"
        char is_absence "æ˜¯å¦ç¼ºå¡"
        decimal work_hours "å·¥ä½œæ—¶é•¿"
        varchar status "çŠ¶æ€"
    }
    
    attendance_monthly_summary {
        bigint summary_id PK "æ±‡æ€»ID"
        bigint user_id FK "ç”¨æˆ·ID"
        varchar year_month UK "å¹´æœˆ"
        int work_days "åº”å‡ºå‹¤"
        int actual_days "å®é™…å‡ºå‹¤"
        int late_times "è¿Ÿåˆ°æ¬¡æ•°"
        int early_times "æ—©é€€æ¬¡æ•°"
        int absence_times "ç¼ºå¡æ¬¡æ•°"
        decimal leave_days "è¯·å‡å¤©æ•°"
        decimal trip_days "å‡ºå·®å¤©æ•°"
        decimal work_hours "å·¥ä½œæ—¶é•¿"
        decimal attendance_rate "å‡ºå‹¤ç‡"
    }
    
    attendance_leave {
        bigint leave_id PK "è¯·å‡ID"
        bigint user_id FK "ç”³è¯·äºº"
        varchar leave_type "è¯·å‡ç±»å‹"
        datetime start_time "å¼€å§‹æ—¶é—´"
        datetime end_time "ç»“æŸæ—¶é—´"
        decimal leave_days "è¯·å‡å¤©æ•°"
        varchar reason "è¯·å‡åŸå› "
        char status "å®¡æ‰¹çŠ¶æ€"
        bigint approver_id FK "å®¡æ‰¹äºº"
        datetime approve_time "å®¡æ‰¹æ—¶é—´"
    }
    
    attendance_trip {
        bigint trip_id PK "å‡ºå·®ID"
        bigint user_id FK "ç”³è¯·äºº"
        varchar destination "å‡ºå·®åœ°ç‚¹"
        datetime start_time "å¼€å§‹æ—¶é—´"
        datetime end_time "ç»“æŸæ—¶é—´"
        decimal trip_days "å‡ºå·®å¤©æ•°"
        varchar reason "å‡ºå·®äº‹ç”±"
        char status "å®¡æ‰¹çŠ¶æ€"
        bigint approver_id FK "å®¡æ‰¹äºº"
    }
    
    attendance_makeup {
        bigint makeup_id PK "è¡¥å¡ID"
        bigint user_id FK "ç”³è¯·äºº"
        date makeup_date "è¡¥å¡æ—¥æœŸ"
        time makeup_time "è¡¥å¡æ—¶é—´"
        varchar check_type "æ‰“å¡ç±»å‹"
        varchar reason "è¡¥å¡åŸå› "
        char status "å®¡æ‰¹çŠ¶æ€"
        bigint approver_id FK "å®¡æ‰¹äºº"
    }
    
    attendance_holiday {
        bigint holiday_id PK "èŠ‚å‡æ—¥ID"
        date holiday_date UK "æ—¥æœŸ"
        char holiday_type "ç±»å‹"
        varchar holiday_name "åç§°"
    }
    
    attendance_rule {
        bigint rule_id PK "è§„åˆ™ID"
        varchar rule_name "è§„åˆ™åç§°"
        time am_start_time "ä¸Šåˆä¸Šç­"
        time am_end_time "ä¸Šåˆä¸‹ç­"
        time pm_start_time "ä¸‹åˆä¸Šç­"
        time pm_end_time "ä¸‹åˆä¸‹ç­"
        int late_threshold "è¿Ÿåˆ°é˜ˆå€¼"
        int early_threshold "æ—©é€€é˜ˆå€¼"
        char is_default "æ˜¯å¦é»˜è®¤"
    }
```

**å…³ç³»è¯´æ˜**ï¼š

| å…³ç³» | è¯´æ˜ | ç±»å‹ |
|-----|------|------|
| sys_user â†’ attendance_record | ä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡æ‰“å¡è®°å½• | 1:N |
| sys_user â†’ attendance_statistics | ä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡æ—¥ç»Ÿè®¡ | 1:N |
| sys_user â†’ attendance_monthly_summary | ä¸€ä¸ªç”¨æˆ·æœ‰å¤šæ¡æœˆæ±‡æ€» | 1:N |
| sys_user â†’ attendance_leave/trip/makeup | ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªç”³è¯· | 1:N |
| sys_user(å®¡æ‰¹äºº) â†’ attendance_leave/trip/makeup | ä¸€ä¸ªå®¡æ‰¹äººå¯ä»¥å®¡æ‰¹å¤šä¸ªç”³è¯· | 1:N |
| attendance_record â†’ attendance_statistics | å¤šæ¡æ‰“å¡è®°å½•ç”Ÿæˆä¸€æ¡æ—¥ç»Ÿè®¡ | N:1 |
| attendance_statistics â†’ attendance_monthly_summary | å¤šæ¡æ—¥ç»Ÿè®¡æ±‡æ€»ä¸ºä¸€æ¡æœˆæ±‡æ€» | N:1 |

### 5.4 æ•°æ®å­—å…¸

#### æ‰“å¡ç±»å‹ (check_type)
| ä»£ç  | åç§° | è¯´æ˜ |
|------|------|------|
| 1 | ä¸Šç­æ‰“å¡ | ä¸Šåˆä¸Šç­ã€ä¸‹åˆä¸Šç­ |
| 2 | ä¸‹ç­æ‰“å¡ | ä¸Šåˆä¸‹ç­ã€ä¸‹åˆä¸‹ç­ |

#### æ‰“å¡æ¥æº (check_source)
| ä»£ç  | åç§° | è¯´æ˜ |
|------|------|------|
| ç§»åŠ¨ç«¯ | æ‰‹æœºAPP | ç§»åŠ¨è®¾å¤‡æ‰“å¡ |
| PCç«¯ | ç”µè„‘ç½‘é¡µ | ç”µè„‘ç½‘é¡µæ‰“å¡ |
| è¡¥å¡ | è¡¥å¡å®¡æ‰¹ | è¡¥å¡å®¡æ‰¹é€šè¿‡ååˆ›å»º |

#### è€ƒå‹¤çŠ¶æ€ (status)
| ä»£ç  | åç§° | è¯´æ˜ |
|------|------|------|
| æ­£å¸¸ | æ­£å¸¸å‡ºå‹¤ | æŒ‰æ—¶æ‰“å¡ï¼Œæ— å¼‚å¸¸ |
| è¿Ÿåˆ° | è¿Ÿåˆ° | ä¸Šç­æ‰“å¡è¶…æ—¶ |
| æ—©é€€ | æ—©é€€ | ä¸‹ç­æ‰“å¡æå‰ |
| ç¼ºå¡ | ç¼ºå¡ | ç¼ºå°‘æ‰“å¡è®°å½• |
| è¯·å‡ | è¯·å‡ | å½“å¤©æœ‰è¯·å‡ |
| å‡ºå·® | å‡ºå·® | å½“å¤©åœ¨å‡ºå·® |

#### å®¡æ‰¹çŠ¶æ€ (status)
| ä»£ç  | åç§° | è¯´æ˜ |
|------|------|------|
| 0 | å¾…å®¡æ‰¹ | å·²æäº¤ï¼Œç­‰å¾…å®¡æ‰¹ |
| 1 | å·²é€šè¿‡ | å®¡æ‰¹é€šè¿‡ |
| 2 | å·²æ‹’ç» | å®¡æ‰¹æ‹’ç» |
| 3 | å·²æ’¤é”€ | ç”³è¯·äººæ’¤å› |

#### è¯·å‡ç±»å‹ (leave_type)
| ä»£ç  | åç§° | æ‰£é™¤è€ƒå‹¤ |
|------|------|---------|
| 1 | äº‹å‡ | æ˜¯ |
| 2 | ç—…å‡ | æ˜¯ |
| 3 | å¹´å‡ | å¦ |
| 4 | è°ƒä¼‘ | å¦ |
| 5 | å©šå‡ | å¦ |
| 6 | äº§å‡ | å¦ |
| 7 | ä¸§å‡ | å¦ |

---

## å…­ã€æ¥å£è®¾è®¡

### 6.1 æ¥å£è§„èŒƒ

#### è¯·æ±‚è§„èŒƒ
```
åŸºç¡€URL: http://domain/api
è®¤è¯æ–¹å¼: JWT Token (Header: Authorization: Bearer {token})
è¯·æ±‚æ ¼å¼: application/json
å­—ç¬¦ç¼–ç : UTF-8
```

#### å“åº”è§„èŒƒ
```json
{
  "code": 200,           // çŠ¶æ€ç ï¼š200æˆåŠŸï¼Œå…¶ä»–å¤±è´¥
  "msg": "æ“ä½œæˆåŠŸ",      // æç¤ºä¿¡æ¯
  "data": {}            // å“åº”æ•°æ®
}
```

#### çŠ¶æ€ç å®šä¹‰
| çŠ¶æ€ç  | è¯´æ˜ | åœºæ™¯ |
|-------|------|------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸ |
| 400 | å‚æ•°é”™è¯¯ | è¯·æ±‚å‚æ•°ä¸åˆæ³• |
| 401 | æœªè®¤è¯ | æœªç™»å½•æˆ–Tokenè¿‡æœŸ |
| 403 | æ— æƒé™ | æ²¡æœ‰æ“ä½œæƒé™ |
| 404 | ä¸å­˜åœ¨ | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | ç³»ç»Ÿå†…éƒ¨é”™è¯¯ |

### 6.2 æ ¸å¿ƒæ¥å£åˆ—è¡¨

#### 6.2.1 è€ƒå‹¤æ‰“å¡æ¥å£

**1. æ‰“å¡æ¥å£**

```http
POST /attendance/record/checkIn
Content-Type: application/json
Authorization: Bearer {token}
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "checkType": "1",           // æ‰“å¡ç±»å‹ï¼š1ä¸Šç­ 2ä¸‹ç­
  "checkSource": "ç§»åŠ¨ç«¯",     // æ‰“å¡æ¥æº
  "location": "æ·±åœ³å¸‚å—å±±åŒº...", // æ‰“å¡ä½ç½®
  "latitude": 22.5431,        // çº¬åº¦
  "longitude": 113.9520       // ç»åº¦
}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æ‰“å¡æˆåŠŸ",
  "data": {
    "recordId": 12345,
    "checkTime": "2025-01-28 09:00:00",
    "isNormal": "1",          // æ˜¯å¦æ­£å¸¸
    "lateMinutes": 0,         // è¿Ÿåˆ°åˆ†é’Ÿæ•°
    "status": "æ­£å¸¸"           // è€ƒå‹¤çŠ¶æ€
  }
}
```

**2. æŸ¥è¯¢æ‰“å¡è®°å½•**

```http
GET /attendance/record/list?date=2025-01-28
Authorization: Bearer {token}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "recordId": 12345,
        "checkTime": "2025-01-28 09:00:00",
        "checkType": "1",
        "checkSource": "ç§»åŠ¨ç«¯",
        "isNormal": "1"
      }
    ],
    "total": 2
  }
}
```

#### 6.2.2 è¯·å‡ç®¡ç†æ¥å£

**1. æäº¤è¯·å‡ç”³è¯·**

```http
POST /attendance/leave
Content-Type: application/json
Authorization: Bearer {token}
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "leaveType": "1",              // è¯·å‡ç±»å‹
  "startTime": "2025-01-29 09:00:00",
  "endTime": "2025-01-30 18:00:00",
  "leaveDays": 2,                // è¯·å‡å¤©æ•°
  "reason": "å®¶ä¸­æœ‰äº‹",           // è¯·å‡åŸå› 
  "proofUrl": ""                 // è¯æ˜ææ–™URL
}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æäº¤æˆåŠŸ",
  "data": {
    "leaveId": 1001,
    "status": "0"                 // å¾…å®¡æ‰¹
  }
}
```

**2. æ’¤å›è¯·å‡ç”³è¯·**

```http
PUT /attendance/leave/cancel/{leaveId}
Authorization: Bearer {token}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æ’¤å›æˆåŠŸ"
}
```

#### 6.2.3 å®¡æ‰¹ç®¡ç†æ¥å£

**1. æŸ¥è¯¢å¾…å®¡æ‰¹åˆ—è¡¨**

```http
GET /attendance/approve/pending
Authorization: Bearer {token}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "id": 1001,
        "type": "leave",           // ç±»å‹ï¼šleave/trip/makeup
        "typeName": "è¯·å‡ç”³è¯·",
        "userName": "zhangsan",
        "nickName": "å¼ ä¸‰",
        "deptName": "æŠ€æœ¯éƒ¨",
        "content": "äº‹å‡ï¼Œ2å¤©",     // ç”³è¯·å†…å®¹
        "reason": "å®¶ä¸­æœ‰äº‹",
        "createTime": "2025-01-28 09:00:00",
        "status": "0"
      }
    ],
    "total": 5,
    "leaveCount": 2,              // è¯·å‡ç”³è¯·æ•°
    "tripCount": 1,               // å‡ºå·®ç”³è¯·æ•°
    "makeupCount": 2              // è¡¥å¡ç”³è¯·æ•°
  }
}
```

**2. å®¡æ‰¹ç”³è¯·**

```http
PUT /attendance/approve/{type}/{id}/{status}
Content-Type: application/json
Authorization: Bearer {token}
```

**å‚æ•°è¯´æ˜**ï¼š
- `type`: leave/trip/makeupï¼ˆç”³è¯·ç±»å‹ï¼‰
- `id`: ç”³è¯·ID
- `status`: 1é€šè¿‡ / 2æ‹’ç»

**è¯·æ±‚ä½“**ï¼š
```json
{
  "remark": "åŒæ„"               // å®¡æ‰¹å¤‡æ³¨
}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "å®¡æ‰¹æˆåŠŸ"
}
```

#### 6.2.4 è€ƒå‹¤ç»Ÿè®¡æ¥å£

**1. æŸ¥è¯¢ä¸ªäººæœˆåº¦ç»Ÿè®¡**

```http
GET /attendance/statistics/month?month=2025-01
Authorization: Bearer {token}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "workDays": 22,              // åº”å‡ºå‹¤å¤©æ•°
    "actualDays": 20,            // å®é™…å‡ºå‹¤å¤©æ•°
    "lateTimes": 2,              // è¿Ÿåˆ°æ¬¡æ•°
    "earlyTimes": 0,             // æ—©é€€æ¬¡æ•°
    "absenceTimes": 0,           // ç¼ºå¡æ¬¡æ•°
    "leaveDays": 2,              // è¯·å‡å¤©æ•°
    "tripDays": 0,               // å‡ºå·®å¤©æ•°
    "workHours": 160,            // å·¥ä½œæ—¶é•¿
    "attendanceRate": 90.91      // å‡ºå‹¤ç‡
  }
}
```

**2. æŸ¥è¯¢ä¸ªäººæ—¥ç»Ÿè®¡åˆ—è¡¨**

```http
GET /attendance/statistics/list?month=2025-01
Authorization: Bearer {token}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "statDate": "2025-01-01",
        "amInTime": "2025-01-01 08:55:00",
        "pmOutTime": "2025-01-01 18:05:00",
        "isLate": "0",
        "isEarly": "0",
        "workHours": 8.5,
        "status": "æ­£å¸¸"
      }
    ],
    "total": 30
  }
}
```

#### 6.2.5 æŠ¥è¡¨æ¥å£

**1. éƒ¨é—¨è€ƒå‹¤æŠ¥è¡¨**

```http
GET /attendance/report/department?month=2025-01&deptId=1
Authorization: Bearer {token}
```

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "userId": 1,
        "userName": "zhangsan",
        "nickName": "å¼ ä¸‰",
        "deptName": "æŠ€æœ¯éƒ¨",
        "workDays": 22,
        "actualDays": 20,
        "attendanceRate": 90.91,
        "lateTimes": 2,
        "leaveDays": 2
      }
    ],
    "total": 10
  }
}
```

**2. å¼‚å¸¸è€ƒå‹¤æŠ¥è¡¨**

```http
GET /attendance/report/abnormal?month=2025-01&type=late
Authorization: Bearer {token}
```

**å‚æ•°è¯´æ˜**ï¼š
- `type`: late(è¿Ÿåˆ°) / early(æ—©é€€) / absence(ç¼ºå¡)

**å“åº”æ•°æ®**ï¼š
```json
{
  "code": 200,
  "msg": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "userId": 1,
        "userName": "zhangsan",
        "nickName": "å¼ ä¸‰",
        "statDate": "2025-01-28",
        "amInTime": "2025-01-28 09:05:00",
        "lateMinutes": 5,
        "reason": "å µè½¦"
      }
    ],
    "total": 15
  }
}
```

### 6.3 æ¥å£æƒé™è®¾è®¡

| æ¥å£è·¯å¾„ | æƒé™æ ‡è¯† | è§’è‰²è¦æ±‚ |
|---------|---------|---------|
| /attendance/record/checkIn | attendance:record:add | å…¨å‘˜ |
| /attendance/leave | attendance:leave:add | å…¨å‘˜ |
| /attendance/approve/pending | attendance:approve:list | å®¡æ‰¹äºº |
| /attendance/approve/* | attendance:approve:edit | å®¡æ‰¹äºº |
| /attendance/report/department | attendance:report:dept | éƒ¨é—¨ä¸»ç®¡ |
| /attendance/rule | attendance:rule:edit | ç®¡ç†å‘˜ |

---

## ä¸ƒã€å®‰å…¨è®¾è®¡

### 7.1 è®¤è¯ä¸æˆæƒ

#### è®¤è¯æœºåˆ¶
```
é‡‡ç”¨JWT (JSON Web Token) è®¤è¯æœºåˆ¶ï¼š

1. ç”¨æˆ·ç™»å½•
   â†“
2. éªŒè¯ç”¨æˆ·åå¯†ç 
   â†“
3. ç”ŸæˆJWT Token (æœ‰æ•ˆæœŸ2å°æ—¶)
   â†“
4. è¿”å›Tokenç»™å®¢æˆ·ç«¯
   â†“
5. å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚æºå¸¦Token
   â†“
6. æœåŠ¡å™¨éªŒè¯Tokenæœ‰æ•ˆæ€§
   â†“
7. è§£æTokenè·å–ç”¨æˆ·ä¿¡æ¯
   â†“
8. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
```

#### Tokenç»“æ„
```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "userId": 1,
    "userName": "zhangsan",
    "roles": ["user", "dept_manager"],
    "exp": 1706428800          // è¿‡æœŸæ—¶é—´æˆ³
  },
  "signature": "..."
}
```

#### æƒé™æ§åˆ¶

**åŸºäºRBAC (Role-Based Access Control) æ¨¡å‹**ï¼š

```mermaid
graph TD
    ROOT["ğŸ” RBACæƒé™æ¨¡å‹"]
    
    ROOT --> ROLE1["ğŸ‘‘ ç³»ç»Ÿç®¡ç†å‘˜<br/>admin"]
    ROOT --> ROLE2["ğŸ‘¨â€ğŸ’¼ éƒ¨é—¨ä¸»ç®¡<br/>dept_manager"]
    ROOT --> ROLE3["ğŸ‘¤ æ™®é€šå‘˜å·¥<br/>user"]
    
    ROLE1 --> P1["âœ… æ‰€æœ‰æƒé™"]
    ROLE1 --> P2["âš™ï¸ ç³»ç»Ÿé…ç½®"]
    ROLE1 --> P3["ğŸ“Š æŸ¥çœ‹æ‰€æœ‰æ•°æ®"]
    
    ROLE2 --> M1["ğŸ“‹ éƒ¨é—¨æŠ¥è¡¨"]
    ROLE2 --> M2["âœ… å®¡æ‰¹ç”³è¯·"]
    ROLE2 --> M3["ğŸ“¥ å¯¼å‡ºæ•°æ®"]
    
    ROLE3 --> U1["ğŸ“± è€ƒå‹¤æ‰“å¡"]
    ROLE3 --> U2["ğŸ“ æäº¤ç”³è¯·"]
    ROLE3 --> U3["ğŸ‘ï¸ æŸ¥çœ‹ä¸ªäºº"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef adminStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef managerStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef userStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef permStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    
    class ROOT rootStyle
    class ROLE1 adminStyle
    class ROLE2 managerStyle
    class ROLE3 userStyle
    class P1,P2,P3,M1,M2,M3,U1,U2,U3 permStyle
```

### 7.2 æ•°æ®å®‰å…¨

#### æ•æ„Ÿæ•°æ®åŠ å¯†
- **å¯†ç åŠ å¯†**ï¼šBCryptç®—æ³•ï¼Œä¸å¯é€†åŠ å¯†
- **é€šä¿¡åŠ å¯†**ï¼šHTTPS/TLS 1.2+
- **æ•°æ®åº“åŠ å¯†**ï¼šæ•æ„Ÿå­—æ®µAES-256åŠ å¯†

#### SQLæ³¨å…¥é˜²æŠ¤
- ä½¿ç”¨MyBatisé¢„ç¼–è¯‘è¯­å¥
- å‚æ•°åŒ–æŸ¥è¯¢
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤

#### XSSé˜²æŠ¤
- å‰ç«¯è¾“å…¥è¿‡æ»¤
- åç«¯è¾“å‡ºç¼–ç 
- CSP (Content Security Policy)

### 7.3 æ¥å£å®‰å…¨

#### æ¥å£é™æµ

```mermaid
graph TD
    ROOT["ğŸ”’ æ¥å£é™æµç­–ç•¥<br/>ä»¤ç‰Œæ¡¶ç®—æ³•"]
    
    ROOT --> L1["ğŸŒ IPé™æµ<br/>100æ¬¡/åˆ†é’Ÿ"]
    ROOT --> L2["ğŸ‘¤ ç”¨æˆ·é™æµ<br/>50æ¬¡/åˆ†é’Ÿ"]
    ROOT --> L3["ğŸ”‘ æ¥å£é™æµ<br/>å…³é”®æ¥å£ç‹¬ç«‹"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef limitStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    
    class ROOT rootStyle
    class L1,L2,L3 limitStyle
```

#### é˜²é‡æ”¾æ”»å‡»
- è¯·æ±‚ç­¾åéªŒè¯
- æ—¶é—´æˆ³éªŒè¯ï¼ˆ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
- Nonceéšæœºæ•°éªŒè¯

#### æ“ä½œæ—¥å¿—

```mermaid
graph TD
    ROOT["ğŸ“ æ“ä½œæ—¥å¿—"]
    
    ROOT --> F1["ğŸ‘¤ æ“ä½œäºº<br/>userId, userName"]
    ROOT --> F2["â° æ“ä½œæ—¶é—´<br/>timestamp"]
    ROOT --> F3["ğŸ”§ æ“ä½œç±»å‹<br/>CRUD+å®¡æ‰¹"]
    ROOT --> F4["ğŸ“„ æ“ä½œå†…å®¹<br/>è¯¦ç»†æè¿°"]
    ROOT --> F5["ğŸŒ IPåœ°å€<br/>clientIp"]
    ROOT --> F6["âœ… æ“ä½œç»“æœ<br/>æˆåŠŸ/å¤±è´¥"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef fieldStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    
    class ROOT rootStyle
    class F1,F2,F3,F4,F5,F6 fieldStyle
```

---

## å…«ã€æ€§èƒ½è®¾è®¡

### 8.1 æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| æ‰“å¡å“åº”æ—¶é—´ | < 500ms | 99%è¯·æ±‚ |
| æŸ¥è¯¢å“åº”æ—¶é—´ | < 1s | æ™®é€šæŸ¥è¯¢ |
| æŠ¥è¡¨ç”Ÿæˆæ—¶é—´ | < 3s | æœˆåº¦æŠ¥è¡¨ |
| å¹¶å‘æ‰“å¡ | 1000äºº/åˆ†é’Ÿ | é«˜å³°æœŸ |
| ç³»ç»Ÿå¯ç”¨æ€§ | 99.9% | å¹´åº¦ç»Ÿè®¡ |

### 8.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### æ•°æ®åº“ä¼˜åŒ–

```mermaid
graph TD
    ROOT["ğŸ’¾ æ•°æ®åº“ä¼˜åŒ–"]
    
    ROOT --> OPT1["ğŸ“‡ ç´¢å¼•ä¼˜åŒ–"]
    ROOT --> OPT2["ğŸ” SQLä¼˜åŒ–"]
    ROOT --> OPT3["ğŸ”— è¿æ¥æ± "]
    ROOT --> OPT4["ğŸ“Š è¯»å†™åˆ†ç¦»"]
    
    OPT1 --> I1["è”åˆç´¢å¼•<br/>user_id+stat_date"]
    OPT1 --> I2["è¦†ç›–ç´¢å¼•<br/>å¸¸ç”¨å­—æ®µ"]
    OPT1 --> I3["é¿å…å…¨è¡¨æ‰«æ"]
    
    OPT2 --> S1["æ‰¹é‡æ“ä½œ<br/>å‡å°‘N+1"]
    OPT2 --> S2["åˆ†é¡µæŸ¥è¯¢<br/>LIMITä¼˜åŒ–"]
    OPT2 --> S3["é¢„ç¼–è¯‘è¯­å¥<br/>é˜²æ³¨å…¥"]
    
    OPT3 --> P1["æœ€å°: 10"]
    OPT3 --> P2["æœ€å¤§: 100"]
    OPT3 --> P3["è¶…æ—¶: 30s"]
    
    OPT4 --> R1["ä¸»åº“å†™"]
    OPT4 --> R2["ä»åº“è¯»"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef categoryStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef detailStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    
    class ROOT rootStyle
    class OPT1,OPT2,OPT3,OPT4 categoryStyle
    class I1,I2,I3,S1,S2,S3,P1,P2,P3,R1,R2 detailStyle
```

#### ç¼“å­˜ç­–ç•¥

```mermaid
graph TD
    ROOT["ğŸš€ å¤šçº§ç¼“å­˜"]
    
    ROOT --> L1["L1: MyBatis<br/>æœ¬åœ°ç¼“å­˜"]
    ROOT --> L2["L2: Redis<br/>åˆ†å¸ƒå¼ç¼“å­˜"]
    ROOT --> UPDATE["ğŸ”„ æ›´æ–°ç­–ç•¥"]
    
    L2 --> C1["è€ƒå‹¤è§„åˆ™<br/>24å°æ—¶"]
    L2 --> C2["èŠ‚å‡æ—¥<br/>7å¤©"]
    L2 --> C3["ç”¨æˆ·ä¿¡æ¯<br/>1å°æ—¶"]
    L2 --> C4["ç»Ÿè®¡æ•°æ®<br/>5åˆ†é’Ÿ"]
    
    UPDATE --> U1["ä¸»åŠ¨æ›´æ–°<br/>æ•°æ®å˜æ›´"]
    UPDATE --> U2["å®šæ—¶æ›´æ–°<br/>å‡Œæ™¨åˆ·æ–°"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef levelStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    classDef cacheStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:1px
    classDef updateStyle fill:#ffebee,stroke:#c62828,stroke-width:1px
    
    class ROOT rootStyle
    class L1,L2,UPDATE levelStyle
    class C1,C2,C3,C4 cacheStyle
    class U1,U2 updateStyle
```

#### å¼‚æ­¥å¤„ç†

```mermaid
graph TD
    ROOT["âš¡ å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—"]
    
    ROOT --> TASK1["ğŸ“Š è€ƒå‹¤ç»Ÿè®¡<br/>å®æ—¶è®¡ç®—"]
    ROOT --> TASK2["ğŸ“„ æŠ¥è¡¨ç”Ÿæˆ<br/>åå°ä»»åŠ¡"]
    ROOT --> TASK3["ğŸ“§ æ¶ˆæ¯é€šçŸ¥<br/>å¼‚æ­¥å‘é€"]
    ROOT --> TASK4["ğŸ“¥ æ•°æ®å¯¼å‡º<br/>å¼‚æ­¥ç”Ÿæˆ"]
    
    classDef rootStyle fill:#e1f5ff,stroke:#1976d2,stroke-width:3px
    classDef taskStyle fill:#fff4e6,stroke:#f57c00,stroke-width:2px
    
    class ROOT rootStyle
    class TASK1,TASK2,TASK3,TASK4 taskStyle
```

### 8.3 ç›‘æ§å‘Šè­¦

#### ç›‘æ§æŒ‡æ ‡
- **ç³»ç»ŸæŒ‡æ ‡**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
- **åº”ç”¨æŒ‡æ ‡**ï¼šQPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
- **ä¸šåŠ¡æŒ‡æ ‡**ï¼šæ‰“å¡äººæ•°ã€å®¡æ‰¹æ•°é‡ã€å¼‚å¸¸ç‡

#### å‘Šè­¦è§„åˆ™
- CPUä½¿ç”¨ç‡ > 80%
- å†…å­˜ä½¿ç”¨ç‡ > 85%
- æ¥å£å“åº”æ—¶é—´ > 3s
- é”™è¯¯ç‡ > 1%
- æ•°æ®åº“è¿æ¥æ•° > 90

---

## ä¹ã€éƒ¨ç½²æ–¹æ¡ˆ

### 9.1 éƒ¨ç½²æ¶æ„

```mermaid
graph TB
    subgraph è´Ÿè½½å±‚
        LB[Nginx è´Ÿè½½å‡è¡¡<br/>IP: 192.168.1.10]
    end
    
    subgraph åº”ç”¨å±‚
        APP1[åº”ç”¨æœåŠ¡å™¨1<br/>Spring Boot<br/>4æ ¸8G]
        APP2[åº”ç”¨æœåŠ¡å™¨2<br/>Spring Boot<br/>4æ ¸8G]
        APP3[åº”ç”¨æœåŠ¡å™¨3<br/>Spring Boot<br/>4æ ¸8G]
    end
    
    subgraph æ•°æ®å±‚
        MASTER[(MySQL ä¸»åº“<br/>å†™æ“ä½œ<br/>8æ ¸16G)]
        SLAVE1[(MySQL ä»åº“1<br/>è¯»æ“ä½œ<br/>8æ ¸16G)]
        SLAVE2[(MySQL ä»åº“2<br/>è¯»æ“ä½œ<br/>8æ ¸16G)]
    end
    
    subgraph ç¼“å­˜å±‚
        REDIS1[Redis èŠ‚ç‚¹1<br/>4æ ¸8G]
        REDIS2[Redis èŠ‚ç‚¹2<br/>4æ ¸8G]
        REDIS3[Redis èŠ‚ç‚¹3<br/>4æ ¸8G]
    end
    
    LB --> APP1
    LB --> APP2
    LB --> APP3
    
    APP1 --> MASTER
    APP2 --> MASTER
    APP3 --> MASTER
    
    APP1 --> SLAVE1
    APP2 --> SLAVE1
    APP3 --> SLAVE2
    
    MASTER -.ä¸»ä»å¤åˆ¶.-> SLAVE1
    MASTER -.ä¸»ä»å¤åˆ¶.-> SLAVE2
    
    APP1 --> REDIS1
    APP2 --> REDIS2
    APP3 --> REDIS3
    
    REDIS1 -.é›†ç¾¤åŒæ­¥.-> REDIS2
    REDIS2 -.é›†ç¾¤åŒæ­¥.-> REDIS3
    REDIS3 -.é›†ç¾¤åŒæ­¥.-> REDIS1
    
    style LB fill:#e1f5ff
    style APP1 fill:#fff4e6
    style APP2 fill:#fff4e6
    style APP3 fill:#fff4e6
    style MASTER fill:#ffebee
    style SLAVE1 fill:#f3e5f5
    style SLAVE2 fill:#f3e5f5
    style REDIS1 fill:#e8f5e9
    style REDIS2 fill:#e8f5e9
    style REDIS3 fill:#e8f5e9
```

### 9.2 ç¯å¢ƒé…ç½®

#### ç”Ÿäº§ç¯å¢ƒ
- **åº”ç”¨æœåŠ¡å™¨**ï¼š3å°ï¼Œ4æ ¸8G
- **æ•°æ®åº“æœåŠ¡å™¨**ï¼š1ä¸»2ä»ï¼Œ8æ ¸16G
- **RedisæœåŠ¡å™¨**ï¼š3èŠ‚ç‚¹é›†ç¾¤ï¼Œ4æ ¸8G
- **è´Ÿè½½å‡è¡¡**ï¼šNginxï¼Œ2æ ¸4G

#### å¼€å‘ç¯å¢ƒ
- **ä¸€ä½“åŒ–æœåŠ¡å™¨**ï¼š1å°ï¼Œ4æ ¸8G
- **åŒ…å«**ï¼šåº”ç”¨ã€æ•°æ®åº“ã€Redis

### 9.3 éƒ¨ç½²æµç¨‹

```mermaid
flowchart TD
    A[ä»£ç æäº¤] --> B[è‡ªåŠ¨æ„å»º]
    B --> C[å•å…ƒæµ‹è¯•]
    C --> D{æµ‹è¯•é€šè¿‡?}
    D -->|å¦| E[ä¿®å¤é—®é¢˜]
    E --> A
    D -->|æ˜¯| F[æ‰“åŒ…éƒ¨ç½²åŒ…]
    F --> G[ä¸Šä¼ åˆ°æœåŠ¡å™¨]
    G --> H[å¤‡ä»½æ—§ç‰ˆæœ¬]
    H --> I[åœæ­¢åº”ç”¨]
    I --> J[éƒ¨ç½²æ–°ç‰ˆæœ¬]
    J --> K[å¯åŠ¨åº”ç”¨]
    K --> L[å¥åº·æ£€æŸ¥]
    L --> M{æ£€æŸ¥é€šè¿‡?}
    M -->|å¦| N[å›æ»šç‰ˆæœ¬]
    N --> O[é€šçŸ¥ç›¸å…³äººå‘˜]
    M -->|æ˜¯| P[éƒ¨ç½²æˆåŠŸ]
```

### 9.4 å¤‡ä»½ç­–ç•¥

#### æ•°æ®å¤‡ä»½
- **å…¨é‡å¤‡ä»½**ï¼šæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹
- **å¢é‡å¤‡ä»½**ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹
- **ä¿ç•™ç­–ç•¥**ï¼šä¿ç•™æœ€è¿‘30å¤©æ•°æ®

#### æ—¥å¿—å¤‡ä»½
- **åº”ç”¨æ—¥å¿—**ï¼šæ¯å¤©å½’æ¡£ï¼Œä¿ç•™30å¤©
- **æ“ä½œæ—¥å¿—**ï¼šæ¯å‘¨å½’æ¡£ï¼Œä¿ç•™90å¤©
- **å¼‚å¸¸æ—¥å¿—**ï¼šå®æ—¶å‘Šè­¦ï¼Œä¿ç•™180å¤©

---

## åã€å¼€å‘è®¡åˆ’

### 10.1 å¼€å‘å‘¨æœŸ

**æ€»å‘¨æœŸ**ï¼š8å‘¨ï¼ˆ2ä¸ªæœˆï¼‰

### 10.2 è¿­ä»£è®¡åˆ’

| è¿­ä»£ | æ—¶é—´ | ç›®æ ‡ | äº¤ä»˜ç‰© |
|-----|------|------|--------|
| Sprint 1 | Week 1-2 | è€ƒå‹¤æ‰“å¡ + åŸºç¡€é…ç½® | æ‰“å¡åŠŸèƒ½ã€è§„åˆ™é…ç½® |
| Sprint 2 | Week 3-4 | å®¡æ‰¹æµç¨‹ï¼ˆè¯·å‡/å‡ºå·®/è¡¥å¡ï¼‰ | å®¡æ‰¹ç®¡ç†ã€æµç¨‹æµè½¬ |
| Sprint 3 | Week 5-6 | ç»Ÿè®¡æŠ¥è¡¨ + å®šæ—¶ä»»åŠ¡ | è€ƒå‹¤ç»Ÿè®¡ã€æŠ¥è¡¨å±•ç¤º |
| Sprint 4 | Week 7-8 | æµ‹è¯•ä¼˜åŒ– + ä¸Šçº¿éƒ¨ç½² | æµ‹è¯•æŠ¥å‘Šã€éƒ¨ç½²æ–‡æ¡£ |

### 10.3 å›¢é˜Ÿé…ç½®

| è§’è‰² | äººæ•° | ä¸»è¦èŒè´£ |
|-----|------|---------|
| **åç«¯å¼€å‘** | 2 | ä¸šåŠ¡é€»è¾‘ã€æ¥å£å¼€å‘ |
| **å‰ç«¯å¼€å‘** | 1 | é¡µé¢å¼€å‘ã€ç»„ä»¶å°è£… |
| **æµ‹è¯•å·¥ç¨‹å¸ˆ** | 1 | æµ‹è¯•ç”¨ä¾‹ã€åŠŸèƒ½æµ‹è¯• |

### 10.4 é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | æ—¶é—´èŠ‚ç‚¹ | éªŒæ”¶æ ‡å‡† |
|-------|---------|---------|
| **M1: æ ¸å¿ƒåŠŸèƒ½** | Week 4 | æ‰“å¡ã€å®¡æ‰¹åŠŸèƒ½å®Œæˆ |
| **M2: ç»Ÿè®¡æŠ¥è¡¨** | Week 6 | ç»Ÿè®¡ã€æŠ¥è¡¨åŠŸèƒ½å®Œæˆ |
| **M3: ç³»ç»Ÿå¯ç”¨** | Week 7 | æµ‹è¯•é€šè¿‡ï¼Œæ€§èƒ½è¾¾æ ‡ |
| **M4: æ­£å¼ä¸Šçº¿** | Week 8 | ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆ |

---

## åä¸€ã€é™„å½•

### 11.1 æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|------|------|------|
| è€ƒå‹¤ | Attendance | å‘˜å·¥ä¸Šä¸‹ç­æ‰“å¡åŠç›¸å…³ç®¡ç† |
| æ‰“å¡ | Check-in | è®°å½•å‘˜å·¥ä¸Šä¸‹ç­æ—¶é—´ |
| åº”å‡ºå‹¤å¤©æ•° | Work Days | æ’é™¤å‘¨æœ«èŠ‚å‡æ—¥åçš„å·¥ä½œæ—¥å¤©æ•° |
| å®é™…å‡ºå‹¤å¤©æ•° | Actual Days | å®é™…åˆ°å²—çš„å¤©æ•° |
| å‡ºå‹¤ç‡ | Attendance Rate | å®é™…å‡ºå‹¤/åº”å‡ºå‹¤çš„æ¯”ç‡ |
| ç¼ºå¡ | Absence | æ¼æ‰“å¡ |
| è¡¥å¡ | Makeup | è¡¥å……æ¼æ‰“çš„å¡ |

### 11.2 å‚è€ƒæ–‡æ¡£

- ä¼ä¸šå¾®ä¿¡è€ƒå‹¤æ–‡æ¡£ï¼šhttps://work.weixin.qq.com/help?doc_id=13726
- é’‰é’‰è€ƒå‹¤æ–‡æ¡£ï¼šhttps://open.dingtalk.com/document/orgapp/attendance-overview
- Spring Bootå®˜æ–¹æ–‡æ¡£ï¼šhttps://spring.io/projects/spring-boot
- MyBatiså®˜æ–¹æ–‡æ¡£ï¼šhttps://mybatis.org/mybatis-3/
- Element Pluså®˜æ–¹æ–‡æ¡£ï¼šhttps://element-plus.org/

### 11.3 æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|---------|
| V1.0 | 2025-01-28 | åˆå§‹ç‰ˆæœ¬ï¼Œå®ŒæˆåŸºç¡€åŠŸèƒ½è®¾è®¡ |

---

<div style={{textAlign: 'center', marginTop: '3rem', paddingTop: '2rem', borderTop: '2px solid #e0e0e0', color: '#666'}}>
  <p><strong>æ–‡æ¡£ä¿¡æ¯</strong></p>
  <table style={{margin: '0 auto', maxWidth: '600px'}}>
    <tbody>
      <tr>
        <td style={{textAlign: 'right', paddingRight: '1rem'}}><strong>æ–‡æ¡£ç¼–åˆ¶ï¼š</strong></td>
        <td style={{textAlign: 'left'}}>ç³»ç»Ÿæ¶æ„å¸ˆ</td>
      </tr>
      <tr>
        <td style={{textAlign: 'right', paddingRight: '1rem'}}><strong>å®¡æ ¸äººå‘˜ï¼š</strong></td>
        <td style={{textAlign: 'left'}}>æŠ€æœ¯æ€»ç›‘</td>
      </tr>
      <tr>
        <td style={{textAlign: 'right', paddingRight: '1rem'}}><strong>æ–‡æ¡£ç‰ˆæœ¬ï¼š</strong></td>
        <td style={{textAlign: 'left'}}>V1.0</td>
      </tr>
      <tr>
        <td style={{textAlign: 'right', paddingRight: '1rem'}}><strong>åˆ›å»ºæ—¥æœŸï¼š</strong></td>
        <td style={{textAlign: 'left'}}>2025å¹´1æœˆ28æ—¥</td>
      </tr>
      <tr>
        <td style={{textAlign: 'right', paddingRight: '1rem'}}><strong>æœ€åæ›´æ–°ï¼š</strong></td>
        <td style={{textAlign: 'left'}}>2025å¹´11æœˆ10æ—¥</td>
      </tr>
    </tbody>
  </table>
  <p style={{marginTop: '1.5rem', fontSize: '0.9rem', color: '#999'}}>
    Â© 2025 è€ƒå‹¤ç®¡ç†ç³»ç»Ÿ | åŸºäºè‹¥ä¾Pro-Miniæ¶æ„ | ä¿ç•™æ‰€æœ‰æƒåˆ©
  </p>
</div>

---

