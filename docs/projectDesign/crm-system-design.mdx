---
sidebar_position: 2
title: CRM å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿè®¾è®¡
description: åŸºäº Spring Cloud çš„æ™ºèƒ½å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿå®Œæ•´è®¾è®¡æ–¹æ¡ˆ
tags: [CRM, å®¢æˆ·ç®¡ç†, Spring Cloud, å¾®æœåŠ¡, ç³»ç»Ÿè®¾è®¡]
---

# CRM å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿè®¾è®¡

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹

CRMï¼ˆCustomer Relationship Managementï¼‰å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¼ä¸šç®¡ç†ç³»ç»Ÿï¼Œå¸®åŠ©ä¼ä¸šç®¡ç†å®¢æˆ·ä¿¡æ¯ã€é”€å”®æœºä¼šã€è¥é”€æ´»åŠ¨ã€å®¢æˆ·æœåŠ¡ç­‰ï¼Œæå‡å®¢æˆ·æ»¡æ„åº¦å’Œä¼ä¸šé”€å”®ä¸šç»©ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | è¯´æ˜ | é¢„æœŸæ•ˆæœ |
|--------|------|----------|
| ğŸ¯ **å®¢æˆ·æ´å¯Ÿ** | 360åº¦å®¢æˆ·ç”»åƒåˆ†æ | å®¢æˆ·è½¬åŒ–ç‡æå‡ 35% |
| ğŸ“Š **é”€å”®ææ•ˆ** | é”€å”®æ¼æ–—è‡ªåŠ¨åŒ–ç®¡ç† | é”€å”®æ•ˆç‡æå‡ 40% |
| ğŸ”„ **è¥é”€è‡ªåŠ¨åŒ–** | æ™ºèƒ½è¥é”€æ´»åŠ¨ç®¡ç† | è¥é”€ ROI æå‡ 50% |
| ğŸ“ˆ **æ•°æ®é©±åŠ¨** | å®æ—¶æ•°æ®åˆ†æå†³ç­– | å†³ç­–æ•ˆç‡æå‡ 45% |
| ğŸš€ **æœåŠ¡å‡çº§** | æ™ºèƒ½å·¥å•ç³»ç»Ÿ | å®¢æˆ·æ»¡æ„åº¦æå‡ 30% |

### 1.3 ä¸šåŠ¡éœ€æ±‚

#### æ ¸å¿ƒåŠŸèƒ½
- **å®¢æˆ·ç®¡ç†**ï¼šå®¢æˆ·ä¿¡æ¯ã€è”ç³»äººã€å®¢æˆ·æ ‡ç­¾ã€å®¢æˆ·åˆ†çº§
- **é”€å”®ç®¡ç†**ï¼šå•†æœºç®¡ç†ã€é”€å”®æ¼æ–—ã€æŠ¥ä»·å•ã€åˆåŒç®¡ç†
- **è¥é”€ç®¡ç†**ï¼šè¥é”€æ´»åŠ¨ã€è¥é”€è‡ªåŠ¨åŒ–ã€è¥é”€çº¿ç´¢
- **æœåŠ¡ç®¡ç†**ï¼šå·¥å•ç®¡ç†ã€å®¢æˆ·æŠ•è¯‰ã€å”®åæœåŠ¡
- **æ•°æ®åˆ†æ**ï¼šé”€å”®æŠ¥è¡¨ã€å®¢æˆ·åˆ†æã€ä¸šç»©ç»Ÿè®¡
- **åä½œç®¡ç†**ï¼šä»»åŠ¡ç®¡ç†ã€æ—¥ç¨‹å®‰æ’ã€å›¢é˜Ÿåä½œ

#### éåŠŸèƒ½éœ€æ±‚
- **é«˜å¯ç”¨æ€§**ï¼šç³»ç»Ÿå¯ç”¨æ€§ 99.9%
- **æ•°æ®å®‰å…¨**ï¼šå®¢æˆ·æ•°æ®åŠ å¯†å­˜å‚¨ï¼Œæƒé™ä¸¥æ ¼æ§åˆ¶
- **æ˜“ç”¨æ€§**ï¼šç•Œé¢å‹å¥½ï¼Œæ“ä½œç®€å•
- **ç§»åŠ¨ç«¯æ”¯æŒ**ï¼šæ”¯æŒç§»åŠ¨ç«¯ APP

---

## äºŒã€ç³»ç»Ÿæ¶æ„

### 2.1 æŠ€æœ¯æ¶æ„

```mermaid
graph TB
    subgraph Client["ğŸ’» å®¢æˆ·ç«¯å±‚"]
        Web["Web ç®¡ç†ç«¯<br/>(React + Ant Design)"]
        Mobile["ç§»åŠ¨ç«¯<br/>(React Native)"]
        MiniApp["å°ç¨‹åº<br/>(UniApp)"]
    end

    subgraph Gateway["ğŸŒ ç½‘å…³å±‚"]
        SpringGW["Spring Cloud Gateway<br/>â€¢ JWT è®¤è¯<br/>â€¢ é™æµç†”æ–­<br/>â€¢ è·¯ç”±è½¬å‘"]
    end

    subgraph Business["âš™ï¸ ä¸šåŠ¡æœåŠ¡å±‚"]
        Customer["å®¢æˆ·æœåŠ¡<br/>customer-service"]
        Sales["é”€å”®æœåŠ¡<br/>sales-service"]
        Marketing["è¥é”€æœåŠ¡<br/>marketing-service"]
        Service["æœåŠ¡å·¥å•<br/>service-service"]
        Analytics["æ•°æ®åˆ†æ<br/>analytics-service"]
    end

    subgraph Infrastructure["ğŸ”§ åŸºç¡€è®¾æ–½å±‚"]
        subgraph Registry["æ³¨å†Œä¸­å¿ƒ"]
            Nacos["Nacos<br/>æœåŠ¡æ³¨å†Œä¸å‘ç°"]
        end
        
        subgraph Message["æ¶ˆæ¯é˜Ÿåˆ—"]
            RabbitMQ["RabbitMQ<br/>å¼‚æ­¥æ¶ˆæ¯"]
        end
        
        subgraph Search["æœç´¢å¼•æ“"]
            ES["Elasticsearch<br/>å…¨æ–‡æ£€ç´¢"]
        end
    end

    subgraph Data["ğŸ’¾ æ•°æ®å±‚"]
        MySQL["MySQL<br/>ä¸šåŠ¡æ•°æ®"]
        PostgreSQL["PostgreSQL<br/>ä¸»æ•°æ®"]
        Redis["Redis<br/>ç¼“å­˜"]
        ClickHouse["ClickHouse<br/>æ•°æ®åˆ†æ"]
        MinIO["MinIO<br/>æ–‡ä»¶å­˜å‚¨"]
    end

    %% è¿æ¥å…³ç³»
    Web --> SpringGW
    Mobile --> SpringGW
    MiniApp --> SpringGW
    
    SpringGW --> Customer
    SpringGW --> Sales
    SpringGW --> Marketing
    SpringGW --> Service
    SpringGW --> Analytics
    
    Customer --> Nacos
    Sales --> Nacos
    Marketing --> Nacos
    Service --> Nacos
    Analytics --> Nacos
    
    Customer --> RabbitMQ
    Sales --> RabbitMQ
    Marketing --> RabbitMQ
    
    Customer --> ES
    Sales --> ES
    
    Customer --> MySQL
    Sales --> MySQL
    Marketing --> MySQL
    Service --> MySQL
    
    Customer --> Redis
    Analytics --> ClickHouse
    Service --> MinIO

    %% æ ·å¼å®šä¹‰
    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gatewayStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef serviceStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef infraStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef dataStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class Web,Mobile,MiniApp clientStyle
    class SpringGW gatewayStyle
    class Customer,Sales,Marketing,Service,Analytics serviceStyle
    class Nacos,RabbitMQ,ES infraStyle
    class MySQL,PostgreSQL,Redis,ClickHouse,MinIO dataStyle
```

### 2.2 é”€å”®æ¼æ–—æµç¨‹

```mermaid
flowchart TD
    Start([é”€å”®çº¿ç´¢]) --> Qualify{çº¿ç´¢è¯„åˆ†}
    Qualify -->|é«˜è´¨é‡| Lead[çº¿ç´¢è·Ÿè¿›]
    Qualify -->|ä½è´¨é‡| Nurture[çº¿ç´¢åŸ¹è‚²]
    
    Nurture --> Lead
    
    Lead --> Convert{è½¬åŒ–è¯„ä¼°}
    Convert -->|æˆåŠŸ| Opportunity[åˆ›å»ºå•†æœº]
    Convert -->|å¤±è´¥| End1([æ ‡è®°æ— æ•ˆ])
    
    Opportunity --> Stage1[åˆæ­¥æ¥è§¦]
    Stage1 --> Stage2[éœ€æ±‚åˆ†æ]
    Stage2 --> Stage3[æ–¹æ¡ˆæŠ¥ä»·]
    Stage3 --> Stage4[å•†åŠ¡è°ˆåˆ¤]
    Stage4 --> Decision{æˆäº¤?}
    
    Decision -->|æ˜¯| Win[èµ¢å•]
    Decision -->|å¦| Lose[è¾“å•]
    
    Win --> Customer[è½¬ä¸ºå®¢æˆ·]
    Customer --> Order[ç”Ÿæˆè®¢å•]
    Order --> Service[å”®åæœåŠ¡]
    
    Lose --> Analysis[å¤±è´¥åˆ†æ]
    Analysis --> End2([å½’æ¡£])
    
    style Start fill:#e8f5e9
    style Customer fill:#c8e6c9
    style Order fill:#a5d6a7
    style Win fill:#4caf50,color:#fff
    style Lose fill:#f44336,color:#fff
```

### 2.3 å¾®æœåŠ¡åˆ’åˆ†

#### 1. å®¢æˆ·æœåŠ¡ (crm-customer-service)
```java
- å®¢æˆ·ç®¡ç† (Customer)
- è”ç³»äººç®¡ç† (Contact)
- å®¢æˆ·æ ‡ç­¾ (CustomerTag)
- å®¢æˆ·è·Ÿè¿›è®°å½• (FollowUp)
- å®¢æˆ·åˆ†çº§ (CustomerLevel)
```

#### 2. é”€å”®æœåŠ¡ (crm-sales-service)
```java
- å•†æœºç®¡ç† (Opportunity)
- é”€å”®çº¿ç´¢ (Lead)
- æŠ¥ä»·å•ç®¡ç† (Quotation)
- åˆåŒç®¡ç† (Contract)
- è®¢å•ç®¡ç† (Order)
```

#### 3. è¥é”€æœåŠ¡ (crm-marketing-service)
```java
- è¥é”€æ´»åŠ¨ (Campaign)
- è¥é”€è‡ªåŠ¨åŒ– (Marketing Automation)
- é‚®ä»¶è¥é”€ (Email Marketing)
- çŸ­ä¿¡è¥é”€ (SMS Marketing)
- è¥é”€æ•ˆæœåˆ†æ (Marketing Analytics)
```

#### 4. æœåŠ¡å·¥å• (crm-service-service)
```java
- å·¥å•ç®¡ç† (Ticket)
- å®¢æˆ·æŠ•è¯‰ (Complaint)
- å”®åæœåŠ¡ (After-sales Service)
- çŸ¥è¯†åº“ (Knowledge Base)
```

#### 5. æ•°æ®åˆ†ææœåŠ¡ (crm-analytics-service)
```java
- é”€å”®æŠ¥è¡¨ (Sales Report)
- å®¢æˆ·åˆ†æ (Customer Analytics)
- ä¸šç»©ç»Ÿè®¡ (Performance Statistics)
- æ¼æ–—åˆ†æ (Funnel Analysis)
```

## æ•°æ®æ¨¡å‹è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. å®¢æˆ·è¡¨ (customer)
```sql
CREATE TABLE customer (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_no VARCHAR(50) NOT NULL UNIQUE COMMENT 'å®¢æˆ·ç¼–å·',
    customer_name VARCHAR(200) NOT NULL COMMENT 'å®¢æˆ·åç§°',
    customer_type TINYINT NOT NULL COMMENT 'å®¢æˆ·ç±»å‹:1-ä¼ä¸š,2-ä¸ªäºº',
    industry VARCHAR(50) COMMENT 'æ‰€å±è¡Œä¸š',
    level TINYINT DEFAULT 1 COMMENT 'å®¢æˆ·ç­‰çº§:1-Aç±»,2-Bç±»,3-Cç±»',
    source TINYINT COMMENT 'å®¢æˆ·æ¥æº:1-çº¿ä¸Š,2-çº¿ä¸‹,3-è½¬ä»‹ç»,4-å…¶ä»–',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1-æ½œåœ¨å®¢æˆ·,2-æ„å‘å®¢æˆ·,3-æˆäº¤å®¢æˆ·,4-æµå¤±å®¢æˆ·',
    province VARCHAR(50) COMMENT 'çœä»½',
    city VARCHAR(50) COMMENT 'åŸå¸‚',
    address VARCHAR(200) COMMENT 'è¯¦ç»†åœ°å€',
    phone VARCHAR(20) COMMENT 'ç”µè¯',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    website VARCHAR(200) COMMENT 'ç½‘ç«™',
    company_size VARCHAR(20) COMMENT 'å…¬å¸è§„æ¨¡',
    annual_revenue DECIMAL(15,2) COMMENT 'å¹´è¥æ”¶',
    owner_user_id BIGINT COMMENT 'è´Ÿè´£äººID',
    create_user_id BIGINT COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_customer_no (customer_no),
    INDEX idx_owner (owner_user_id),
    INDEX idx_status (status),
    INDEX idx_level (level)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å®¢æˆ·è¡¨';
```

#### 2. è”ç³»äººè¡¨ (contact)
```sql
CREATE TABLE contact (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    customer_id BIGINT NOT NULL COMMENT 'å®¢æˆ·ID',
    contact_name VARCHAR(100) NOT NULL COMMENT 'è”ç³»äººå§“å',
    gender TINYINT COMMENT 'æ€§åˆ«:1-ç”·,2-å¥³',
    position VARCHAR(50) COMMENT 'èŒä½',
    department VARCHAR(50) COMMENT 'éƒ¨é—¨',
    mobile VARCHAR(20) COMMENT 'æ‰‹æœº',
    phone VARCHAR(20) COMMENT 'ç”µè¯',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    wechat VARCHAR(50) COMMENT 'å¾®ä¿¡',
    qq VARCHAR(20) COMMENT 'QQ',
    is_primary TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ä¸»è”ç³»äºº:0-å¦,1-æ˜¯',
    birthday DATE COMMENT 'ç”Ÿæ—¥',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_customer (customer_id),
    INDEX idx_mobile (mobile)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è”ç³»äººè¡¨';
```

#### 3. å•†æœºè¡¨ (opportunity)
```sql
CREATE TABLE opportunity (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    opportunity_no VARCHAR(50) NOT NULL UNIQUE COMMENT 'å•†æœºç¼–å·',
    opportunity_name VARCHAR(200) NOT NULL COMMENT 'å•†æœºåç§°',
    customer_id BIGINT NOT NULL COMMENT 'å®¢æˆ·ID',
    contact_id BIGINT COMMENT 'è”ç³»äººID',
    amount DECIMAL(15,2) COMMENT 'é¢„è®¡é‡‘é¢',
    stage TINYINT NOT NULL DEFAULT 1 COMMENT 'é˜¶æ®µ:1-åˆæ­¥æ¥è§¦,2-éœ€æ±‚åˆ†æ,3-æ–¹æ¡ˆæŠ¥ä»·,4-è°ˆåˆ¤,5-æˆäº¤,6-å¤±è´¥',
    probability INT DEFAULT 0 COMMENT 'èµ¢å•æ¦‚ç‡(%)',
    expected_close_date DATE COMMENT 'é¢„è®¡æˆäº¤æ—¥æœŸ',
    actual_close_date DATE COMMENT 'å®é™…æˆäº¤æ—¥æœŸ',
    source TINYINT COMMENT 'å•†æœºæ¥æº:1-çº¿ä¸Š,2-çº¿ä¸‹,3-è½¬ä»‹ç»,4-å…¶ä»–',
    competitor VARCHAR(200) COMMENT 'ç«äº‰å¯¹æ‰‹',
    priority TINYINT DEFAULT 0 COMMENT 'ä¼˜å…ˆçº§:0-æ™®é€š,1-é‡è¦,2-ç´§æ€¥',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1-è¿›è¡Œä¸­,2-å·²æˆäº¤,3-å·²å¤±è´¥',
    owner_user_id BIGINT NOT NULL COMMENT 'è´Ÿè´£äººID',
    lose_reason VARCHAR(500) COMMENT 'å¤±è´¥åŸå› ',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    create_user_id BIGINT COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_opportunity_no (opportunity_no),
    INDEX idx_customer (customer_id),
    INDEX idx_owner (owner_user_id),
    INDEX idx_stage (stage),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†æœºè¡¨';
```

#### 4. é”€å”®çº¿ç´¢è¡¨ (lead)
```sql
CREATE TABLE lead (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    lead_no VARCHAR(50) NOT NULL UNIQUE COMMENT 'çº¿ç´¢ç¼–å·',
    company_name VARCHAR(200) COMMENT 'å…¬å¸åç§°',
    contact_name VARCHAR(100) NOT NULL COMMENT 'è”ç³»äºº',
    mobile VARCHAR(20) COMMENT 'æ‰‹æœº',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    province VARCHAR(50) COMMENT 'çœä»½',
    city VARCHAR(50) COMMENT 'åŸå¸‚',
    industry VARCHAR(50) COMMENT 'è¡Œä¸š',
    source TINYINT COMMENT 'æ¥æº:1-ç½‘ç«™,2-å¹¿å‘Š,3-æ´»åŠ¨,4-è½¬ä»‹ç»,5-å…¶ä»–',
    campaign_id BIGINT COMMENT 'è¥é”€æ´»åŠ¨ID',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1-æœªå¤„ç†,2-è·Ÿè¿›ä¸­,3-å·²è½¬åŒ–,4-æ— æ•ˆ',
    score INT DEFAULT 0 COMMENT 'çº¿ç´¢è¯„åˆ†',
    owner_user_id BIGINT COMMENT 'è´Ÿè´£äººID',
    converted_customer_id BIGINT COMMENT 'è½¬åŒ–å®¢æˆ·ID',
    converted_time DATETIME COMMENT 'è½¬åŒ–æ—¶é—´',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_lead_no (lead_no),
    INDEX idx_mobile (mobile),
    INDEX idx_status (status),
    INDEX idx_owner (owner_user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é”€å”®çº¿ç´¢è¡¨';
```

#### 5. è·Ÿè¿›è®°å½•è¡¨ (follow_up)
```sql
CREATE TABLE follow_up (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    related_type TINYINT NOT NULL COMMENT 'å…³è”ç±»å‹:1-å®¢æˆ·,2-å•†æœº,3-çº¿ç´¢',
    related_id BIGINT NOT NULL COMMENT 'å…³è”ID',
    follow_up_type TINYINT NOT NULL COMMENT 'è·Ÿè¿›æ–¹å¼:1-ç”µè¯,2-é‚®ä»¶,3-æ‹œè®¿,4-ä¼šè®®,5-å…¶ä»–',
    follow_up_time DATETIME NOT NULL COMMENT 'è·Ÿè¿›æ—¶é—´',
    content TEXT NOT NULL COMMENT 'è·Ÿè¿›å†…å®¹',
    next_follow_up_time DATETIME COMMENT 'ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´',
    attachment_url VARCHAR(500) COMMENT 'é™„ä»¶URL',
    create_user_id BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_related (related_type, related_id),
    INDEX idx_create_user (create_user_id),
    INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è·Ÿè¿›è®°å½•è¡¨';
```

#### 6. åˆåŒè¡¨ (contract)
```sql
CREATE TABLE contract (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    contract_no VARCHAR(50) NOT NULL UNIQUE COMMENT 'åˆåŒç¼–å·',
    contract_name VARCHAR(200) NOT NULL COMMENT 'åˆåŒåç§°',
    customer_id BIGINT NOT NULL COMMENT 'å®¢æˆ·ID',
    opportunity_id BIGINT COMMENT 'å•†æœºID',
    contract_type TINYINT NOT NULL COMMENT 'åˆåŒç±»å‹:1-é”€å”®åˆåŒ,2-æœåŠ¡åˆåŒ,3-å…¶ä»–',
    amount DECIMAL(15,2) NOT NULL COMMENT 'åˆåŒé‡‘é¢',
    start_date DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
    sign_date DATE COMMENT 'ç­¾è®¢æ—¥æœŸ',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1-è‰ç¨¿,2-å¾…å®¡æ‰¹,3-å®¡æ‰¹ä¸­,4-å·²ç”Ÿæ•ˆ,5-å·²ç»ˆæ­¢',
    owner_user_id BIGINT NOT NULL COMMENT 'è´Ÿè´£äººID',
    contract_file_url VARCHAR(500) COMMENT 'åˆåŒæ–‡ä»¶URL',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    create_user_id BIGINT COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_contract_no (contract_no),
    INDEX idx_customer (customer_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åˆåŒè¡¨';
```

#### 7. è¥é”€æ´»åŠ¨è¡¨ (campaign)
```sql
CREATE TABLE campaign (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    campaign_no VARCHAR(50) NOT NULL UNIQUE COMMENT 'æ´»åŠ¨ç¼–å·',
    campaign_name VARCHAR(200) NOT NULL COMMENT 'æ´»åŠ¨åç§°',
    campaign_type TINYINT NOT NULL COMMENT 'æ´»åŠ¨ç±»å‹:1-çº¿ä¸Šæ´»åŠ¨,2-çº¿ä¸‹æ´»åŠ¨,3-é‚®ä»¶è¥é”€,4-çŸ­ä¿¡è¥é”€',
    channel VARCHAR(50) COMMENT 'è¥é”€æ¸ é“',
    budget DECIMAL(15,2) COMMENT 'é¢„ç®—',
    actual_cost DECIMAL(15,2) COMMENT 'å®é™…èŠ±è´¹',
    start_time DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    end_time DATETIME NOT NULL COMMENT 'ç»“æŸæ—¶é—´',
    target_audience VARCHAR(500) COMMENT 'ç›®æ ‡å—ä¼—',
    target_count INT COMMENT 'ç›®æ ‡äººæ•°',
    actual_count INT DEFAULT 0 COMMENT 'å®é™…è§¦è¾¾äººæ•°',
    lead_count INT DEFAULT 0 COMMENT 'äº§ç”Ÿçº¿ç´¢æ•°',
    conversion_count INT DEFAULT 0 COMMENT 'è½¬åŒ–æ•°',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1-è®¡åˆ’ä¸­,2-è¿›è¡Œä¸­,3-å·²ç»“æŸ,4-å·²å–æ¶ˆ',
    owner_user_id BIGINT NOT NULL COMMENT 'è´Ÿè´£äººID',
    description TEXT COMMENT 'æ´»åŠ¨æè¿°',
    create_user_id BIGINT COMMENT 'åˆ›å»ºäººID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_campaign_no (campaign_no),
    INDEX idx_status (status),
    INDEX idx_time (start_time, end_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è¥é”€æ´»åŠ¨è¡¨';
```

#### 8. å·¥å•è¡¨ (ticket)
```sql
CREATE TABLE ticket (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    ticket_no VARCHAR(50) NOT NULL UNIQUE COMMENT 'å·¥å•ç¼–å·',
    title VARCHAR(200) NOT NULL COMMENT 'æ ‡é¢˜',
    customer_id BIGINT NOT NULL COMMENT 'å®¢æˆ·ID',
    contact_id BIGINT COMMENT 'è”ç³»äººID',
    ticket_type TINYINT NOT NULL COMMENT 'å·¥å•ç±»å‹:1-å’¨è¯¢,2-æŠ•è¯‰,3-å”®å,4-å…¶ä»–',
    priority TINYINT DEFAULT 0 COMMENT 'ä¼˜å…ˆçº§:0-æ™®é€š,1-é‡è¦,2-ç´§æ€¥',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1-å¾…å¤„ç†,2-å¤„ç†ä¸­,3-å¾…å›å¤,4-å·²è§£å†³,5-å·²å…³é—­',
    channel TINYINT COMMENT 'æ¸ é“:1-ç”µè¯,2-é‚®ä»¶,3-åœ¨çº¿å®¢æœ,4-å…¶ä»–',
    description TEXT COMMENT 'é—®é¢˜æè¿°',
    solution TEXT COMMENT 'è§£å†³æ–¹æ¡ˆ',
    assign_user_id BIGINT COMMENT 'å¤„ç†äººID',
    create_user_id BIGINT COMMENT 'åˆ›å»ºäººID',
    close_time DATETIME COMMENT 'å…³é—­æ—¶é—´',
    satisfaction TINYINT COMMENT 'æ»¡æ„åº¦:1-5åˆ†',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_ticket_no (ticket_no),
    INDEX idx_customer (customer_id),
    INDEX idx_status (status),
    INDEX idx_assign_user (assign_user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å·¥å•è¡¨';
```

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 1. é”€å”®çº¿ç´¢è½¬åŒ–æµç¨‹

```
çº¿ç´¢è·å– â†’ çº¿ç´¢è¯„åˆ† â†’ çº¿ç´¢åˆ†é… â†’ è·Ÿè¿› â†’ çº¿ç´¢è½¬åŒ– â†’ åˆ›å»ºå®¢æˆ·/å•†æœº
   â†“          â†“          â†“        â†“        â†“
(æœªå¤„ç†)   (è¯„åˆ†å®Œæˆ)   (è·Ÿè¿›ä¸­)  (æŒç»­è·Ÿè¿›) (å·²è½¬åŒ–)
```

**å…³é”®æ­¥éª¤**ï¼š
1. è·å–çº¿ç´¢ï¼ˆç½‘ç«™è¡¨å•ã€è¥é”€æ´»åŠ¨ã€å¹¿å‘Šç­‰ï¼‰
2. çº¿ç´¢è¯„åˆ†ï¼ˆæ ¹æ®è¡Œä¸šã€èŒä½ã€å…¬å¸è§„æ¨¡ç­‰æ‰“åˆ†ï¼‰
3. çº¿ç´¢åˆ†é…ï¼ˆè‡ªåŠ¨/æ‰‹åŠ¨åˆ†é…ç»™é”€å”®äººå‘˜ï¼‰
4. é”€å”®è·Ÿè¿›ï¼ˆç”µè¯ã€é‚®ä»¶ã€æ‹œè®¿ç­‰ï¼‰
5. çº¿ç´¢è½¬åŒ–ï¼ˆåˆ›å»ºå®¢æˆ·å’Œå•†æœºï¼‰

### 2. é”€å”®å•†æœºç®¡ç†æµç¨‹

```
åˆ›å»ºå•†æœº â†’ éœ€æ±‚åˆ†æ â†’ æ–¹æ¡ˆæŠ¥ä»· â†’ è°ˆåˆ¤ç­¾çº¦ â†’ æˆäº¤/å¤±è´¥
   â†“         â†“          â†“         â†“         â†“
(åˆæ­¥æ¥è§¦) (éœ€æ±‚åˆ†æ)  (æ–¹æ¡ˆæŠ¥ä»·)  (è°ˆåˆ¤)   (ç»“æŸ)
```

**å…³é”®æ­¥éª¤**ï¼š
1. åˆ›å»ºå•†æœºï¼ˆä»çº¿ç´¢è½¬åŒ–æˆ–ç›´æ¥åˆ›å»ºï¼‰
2. éœ€æ±‚åˆ†æï¼ˆäº†è§£å®¢æˆ·éœ€æ±‚ï¼Œè¯„ä¼°å•†æœºä»·å€¼ï¼‰
3. æ–¹æ¡ˆæŠ¥ä»·ï¼ˆåˆ¶å®šè§£å†³æ–¹æ¡ˆï¼Œæä¾›æŠ¥ä»·ï¼‰
4. è°ˆåˆ¤ç­¾çº¦ï¼ˆå•†åŠ¡è°ˆåˆ¤ï¼Œç­¾è®¢åˆåŒï¼‰
5. æˆäº¤æˆ–å¤±è´¥ï¼ˆè®°å½•ç»“æœå’ŒåŸå› ï¼‰

### 3. å®¢æˆ·æœåŠ¡å·¥å•æµç¨‹

```
åˆ›å»ºå·¥å• â†’ å·¥å•åˆ†é… â†’ å¤„ç†ä¸­ â†’ å¾…å›å¤ â†’ å·²è§£å†³ â†’ å…³é—­ â†’ æ»¡æ„åº¦è¯„ä»·
   â†“         â†“         â†“        â†“        â†“       â†“
(å¾…å¤„ç†)   (å·²åˆ†é…)   (å¤„ç†ä¸­)  (å¾…å›å¤) (å·²è§£å†³) (å·²å…³é—­)
```

## æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. å®¢æˆ·æœç´¢ï¼ˆElasticsearchï¼‰

ä½¿ç”¨ **Elasticsearch** å®ç°å®¢æˆ·å…¨æ–‡æœç´¢ï¼š

```java
@Service
public class CustomerSearchService {
    
    @Autowired
    private ElasticsearchRestTemplate elasticsearchTemplate;
    
    /**
     * æœç´¢å®¢æˆ·
     */
    public PageResult<CustomerVO> searchCustomers(String keyword, int pageNum, int pageSize) {
        // æ„å»ºæœç´¢æ¡ä»¶
        NativeSearchQueryBuilder queryBuilder = new NativeSearchQueryBuilder();
        
        // å¤šå­—æ®µæœç´¢
        BoolQueryBuilder boolQuery = QueryBuilders.boolQuery();
        boolQuery.should(QueryBuilders.matchQuery("customerName", keyword))
                 .should(QueryBuilders.matchQuery("phone", keyword))
                 .should(QueryBuilders.matchQuery("email", keyword))
                 .should(QueryBuilders.matchQuery("address", keyword));
        
        queryBuilder.withQuery(boolQuery);
        queryBuilder.withPageable(PageRequest.of(pageNum - 1, pageSize));
        
        // æ‰§è¡Œæœç´¢
        SearchHits<CustomerDocument> searchHits = elasticsearchTemplate.search(
            queryBuilder.build(), 
            CustomerDocument.class
        );
        
        // è½¬æ¢ç»“æœ
        List<CustomerVO> customers = searchHits.stream()
            .map(hit -> convertToVO(hit.getContent()))
            .collect(Collectors.toList());
        
        return new PageResult<>(customers, searchHits.getTotalHits(), pageNum, pageSize);
    }
}
```

### 2. çº¿ç´¢è¯„åˆ†ç³»ç»Ÿ

ä½¿ç”¨ **è§„åˆ™å¼•æ“** å®ç°çº¿ç´¢è‡ªåŠ¨è¯„åˆ†ï¼š

```java
@Service
public class LeadScoringService {
    
    /**
     * è®¡ç®—çº¿ç´¢è¯„åˆ†
     */
    public int calculateLeadScore(Lead lead) {
        int score = 0;
        
        // è¡Œä¸šè¯„åˆ†
        score += getIndustryScore(lead.getIndustry());
        
        // å…¬å¸è§„æ¨¡è¯„åˆ†
        score += getCompanySizeScore(lead.getCompanySize());
        
        // èŒä½è¯„åˆ†
        score += getPositionScore(lead.getPosition());
        
        // æ¥æºè¯„åˆ†
        score += getSourceScore(lead.getSource());
        
        // è¡Œä¸ºè¯„åˆ†ï¼ˆè®¿é—®é¡µé¢ã€ä¸‹è½½èµ„æ–™ç­‰ï¼‰
        score += getBehaviorScore(lead.getId());
        
        return Math.min(score, 100); // æœ€é«˜100åˆ†
    }
    
    /**
     * è¡Œä¸šè¯„åˆ†
     */
    private int getIndustryScore(String industry) {
        // æ ¹æ®ç›®æ ‡è¡Œä¸šæ‰“åˆ†
        Map<String, Integer> industryScores = Map.of(
            "äº’è”ç½‘", 30,
            "é‡‘è", 25,
            "åˆ¶é€ ä¸š", 20,
            "å…¶ä»–", 10
        );
        return industryScores.getOrDefault(industry, 10);
    }
    
    /**
     * å…¬å¸è§„æ¨¡è¯„åˆ†
     */
    private int getCompanySizeScore(String companySize) {
        Map<String, Integer> sizeScores = Map.of(
            "1000äººä»¥ä¸Š", 30,
            "500-1000äºº", 25,
            "100-500äºº", 20,
            "100äººä»¥ä¸‹", 10
        );
        return sizeScores.getOrDefault(companySize, 10);
    }
}
```

### 3. é”€å”®æ¼æ–—åˆ†æ

```java
@Service
public class SalesFunnelService {
    
    @Autowired
    private OpportunityMapper opportunityMapper;
    
    /**
     * è·å–é”€å”®æ¼æ–—æ•°æ®
     */
    public SalesFunnelVO getSalesFunnel(Long userId, LocalDate startDate, LocalDate endDate) {
        // æŸ¥è¯¢å„é˜¶æ®µçš„å•†æœºæ•°é‡å’Œé‡‘é¢
        List<OpportunityStageStats> stageStats = opportunityMapper.countByStage(
            userId, startDate, endDate
        );
        
        SalesFunnelVO funnel = new SalesFunnelVO();
        
        for (OpportunityStageStats stats : stageStats) {
            switch (stats.getStage()) {
                case 1: // åˆæ­¥æ¥è§¦
                    funnel.setInitialContactCount(stats.getCount());
                    funnel.setInitialContactAmount(stats.getAmount());
                    break;
                case 2: // éœ€æ±‚åˆ†æ
                    funnel.setNeedsAnalysisCount(stats.getCount());
                    funnel.setNeedsAnalysisAmount(stats.getAmount());
                    break;
                case 3: // æ–¹æ¡ˆæŠ¥ä»·
                    funnel.setProposalCount(stats.getCount());
                    funnel.setProposalAmount(stats.getAmount());
                    break;
                case 4: // è°ˆåˆ¤
                    funnel.setNegotiationCount(stats.getCount());
                    funnel.setNegotiationAmount(stats.getAmount());
                    break;
                case 5: // æˆäº¤
                    funnel.setWonCount(stats.getCount());
                    funnel.setWonAmount(stats.getAmount());
                    break;
            }
        }
        
        // è®¡ç®—è½¬åŒ–ç‡
        funnel.calculateConversionRates();
        
        return funnel;
    }
}
```

### 4. è¥é”€è‡ªåŠ¨åŒ–

ä½¿ç”¨ **å®šæ—¶ä»»åŠ¡ + æ¶ˆæ¯é˜Ÿåˆ—** å®ç°è¥é”€è‡ªåŠ¨åŒ–ï¼š

```java
@Component
public class MarketingAutomationTask {
    
    @Autowired
    private LeadService leadService;
    
    @Autowired
    private EmailService emailService;
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    /**
     * è‡ªåŠ¨è·Ÿè¿›æœªå¤„ç†çš„çº¿ç´¢
     */
    @Scheduled(cron = "0 0 9 * * ?") // æ¯å¤©9ç‚¹æ‰§è¡Œ
    public void autoFollowUpLeads() {
        // æŸ¥è¯¢æœªå¤„ç†çš„çº¿ç´¢ï¼ˆåˆ›å»ºæ—¶é—´è¶…è¿‡24å°æ—¶ï¼‰
        LocalDateTime yesterday = LocalDateTime.now().minusDays(1);
        List<Lead> unprocessedLeads = leadService.findUnprocessedLeads(yesterday);
        
        for (Lead lead : unprocessedLeads) {
            // å‘é€æé†’é‚®ä»¶ç»™è´Ÿè´£äºº
            rabbitTemplate.convertAndSend(
                "crm.marketing.exchange",
                "lead.follow.up.reminder",
                new LeadFollowUpEvent(lead.getId(), lead.getOwnerUserId())
            );
        }
    }
    
    /**
     * è‡ªåŠ¨å‘é€ç”Ÿæ—¥ç¥ç¦
     */
    @Scheduled(cron = "0 0 8 * * ?") // æ¯å¤©8ç‚¹æ‰§è¡Œ
    public void sendBirthdayGreetings() {
        // æŸ¥è¯¢ä»Šå¤©ç”Ÿæ—¥çš„è”ç³»äºº
        List<Contact> birthdayContacts = leadService.findBirthdayContacts(LocalDate.now());
        
        for (Contact contact : birthdayContacts) {
            // å‘é€ç”Ÿæ—¥ç¥ç¦é‚®ä»¶
            emailService.sendBirthdayEmail(contact);
        }
    }
}
```

### 5. å®¢æˆ·æ ‡ç­¾ç³»ç»Ÿ

```java
@Service
public class CustomerTagService {
    
    @Autowired
    private CustomerMapper customerMapper;
    
    @Autowired
    private CustomerTagMapper customerTagMapper;
    
    /**
     * è‡ªåŠ¨æ‰“æ ‡ç­¾
     */
    @Transactional
    public void autoTagCustomer(Long customerId) {
        Customer customer = customerMapper.selectById(customerId);
        
        List<String> tags = new ArrayList<>();
        
        // æ ¹æ®è¡Œä¸šæ‰“æ ‡ç­¾
        if ("äº’è”ç½‘".equals(customer.getIndustry())) {
            tags.add("äº’è”ç½‘è¡Œä¸š");
        }
        
        // æ ¹æ®å®¢æˆ·ç­‰çº§æ‰“æ ‡ç­¾
        if (customer.getLevel() == 1) {
            tags.add("é‡ç‚¹å®¢æˆ·");
        }
        
        // æ ¹æ®æˆäº¤é‡‘é¢æ‰“æ ‡ç­¾
        BigDecimal totalAmount = customerMapper.getTotalOrderAmount(customerId);
        if (totalAmount.compareTo(new BigDecimal("100000")) > 0) {
            tags.add("å¤§å®¢æˆ·");
        }
        
        // æ ¹æ®è´­ä¹°é¢‘ç‡æ‰“æ ‡ç­¾
        int orderCount = customerMapper.getOrderCount(customerId);
        if (orderCount > 10) {
            tags.add("è€å®¢æˆ·");
        }
        
        // ä¿å­˜æ ‡ç­¾
        for (String tagName : tags) {
            customerTagMapper.addTag(customerId, tagName);
        }
    }
}
```

### 6. æƒé™æ§åˆ¶ï¼ˆæ•°æ®æƒé™ï¼‰

```java
@Service
public class CustomerPermissionService {
    
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®å®¢æˆ·
     */
    public boolean hasPermission(Long userId, Long customerId) {
        Customer customer = customerMapper.selectById(customerId);
        
        if (customer == null) {
            return false;
        }
        
        // è´Ÿè´£äººæœ‰æƒé™
        if (customer.getOwnerUserId().equals(userId)) {
            return true;
        }
        
        // ç®¡ç†å‘˜æœ‰æƒé™
        if (isAdmin(userId)) {
            return true;
        }
        
        // åŒéƒ¨é—¨æœ‰æƒé™ï¼ˆæ ¹æ®é…ç½®ï¼‰
        if (isSameDepartment(userId, customer.getOwnerUserId())) {
            return true;
        }
        
        return false;
    }
}
```

## API æ¥å£è®¾è®¡

### 1. å®¢æˆ·æ¥å£

```java
@RestController
@RequestMapping("/api/crm/customer")
public class CustomerController {
    
    @Autowired
    private CustomerService customerService;
    
    /**
     * åˆ›å»ºå®¢æˆ·
     */
    @PostMapping("")
    public Result<Long> createCustomer(@RequestBody @Valid CustomerDTO dto) {
        Long customerId = customerService.createCustomer(dto);
        return Result.success(customerId);
    }
    
    /**
     * å®¢æˆ·åˆ—è¡¨
     */
    @GetMapping("")
    public Result<PageResult<CustomerVO>> listCustomers(
            @RequestParam(required = false) String keyword,
            @RequestParam(required = false) Integer level,
            @RequestParam(required = false) Integer status,
            @RequestParam(defaultValue = "1") Integer pageNum,
            @RequestParam(defaultValue = "20") Integer pageSize) {
        
        PageResult<CustomerVO> result = customerService.listCustomers(
            keyword, level, status, pageNum, pageSize
        );
        return Result.success(result);
    }
    
    /**
     * å®¢æˆ·è¯¦æƒ…
     */
    @GetMapping("/{customerId}")
    public Result<CustomerDetailVO> getCustomerDetail(@PathVariable Long customerId) {
        CustomerDetailVO vo = customerService.getCustomerDetail(customerId);
        return Result.success(vo);
    }
    
    /**
     * æ·»åŠ è·Ÿè¿›è®°å½•
     */
    @PostMapping("/{customerId}/follow-up")
    public Result<Void> addFollowUp(
            @PathVariable Long customerId,
            @RequestBody @Valid FollowUpDTO dto) {
        
        customerService.addFollowUp(customerId, dto);
        return Result.success();
    }
}
```

### 2. å•†æœºæ¥å£

```java
@RestController
@RequestMapping("/api/crm/opportunity")
public class OpportunityController {
    
    @Autowired
    private OpportunityService opportunityService;
    
    /**
     * åˆ›å»ºå•†æœº
     */
    @PostMapping("")
    public Result<Long> createOpportunity(@RequestBody @Valid OpportunityDTO dto) {
        Long opportunityId = opportunityService.createOpportunity(dto);
        return Result.success(opportunityId);
    }
    
    /**
     * æ›´æ–°å•†æœºé˜¶æ®µ
     */
    @PutMapping("/{opportunityId}/stage")
    public Result<Void> updateStage(
            @PathVariable Long opportunityId,
            @RequestParam Integer stage) {
        
        opportunityService.updateStage(opportunityId, stage);
        return Result.success();
    }
    
    /**
     * å•†æœºæˆäº¤
     */
    @PostMapping("/{opportunityId}/win")
    public Result<Void> winOpportunity(
            @PathVariable Long opportunityId,
            @RequestBody @Valid WinOpportunityDTO dto) {
        
        opportunityService.winOpportunity(opportunityId, dto);
        return Result.success();
    }
    
    /**
     * å•†æœºå¤±è´¥
     */
    @PostMapping("/{opportunityId}/lose")
    public Result<Void> loseOpportunity(
            @PathVariable Long opportunityId,
            @RequestParam String loseReason) {
        
        opportunityService.loseOpportunity(opportunityId, loseReason);
        return Result.success();
    }
    
    /**
     * é”€å”®æ¼æ–—
     */
    @GetMapping("/funnel")
    public Result<SalesFunnelVO> getSalesFunnel(
            @RequestParam(required = false) Long userId,
            @RequestParam(required = false) @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate startDate,
            @RequestParam(required = false) @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate endDate) {
        
        SalesFunnelVO vo = opportunityService.getSalesFunnel(userId, startDate, endDate);
        return Result.success(vo);
    }
}
```

### 3. é”€å”®çº¿ç´¢æ¥å£

```java
@RestController
@RequestMapping("/api/crm/lead")
public class LeadController {
    
    @Autowired
    private LeadService leadService;
    
    /**
     * åˆ›å»ºçº¿ç´¢
     */
    @PostMapping("")
    public Result<Long> createLead(@RequestBody @Valid LeadDTO dto) {
        Long leadId = leadService.createLead(dto);
        return Result.success(leadId);
    }
    
    /**
     * çº¿ç´¢è½¬åŒ–
     */
    @PostMapping("/{leadId}/convert")
    public Result<ConvertResultVO> convertLead(
            @PathVariable Long leadId,
            @RequestBody @Valid LeadConvertDTO dto) {
        
        ConvertResultVO result = leadService.convertLead(leadId, dto);
        return Result.success(result);
    }
    
    /**
     * æ‰¹é‡åˆ†é…çº¿ç´¢
     */
    @PostMapping("/batch-assign")
    public Result<Void> batchAssignLeads(
            @RequestBody @Valid BatchAssignDTO dto) {
        
        leadService.batchAssignLeads(dto.getLeadIds(), dto.getUserId());
        return Result.success();
    }
}
```

### 4. æ•°æ®åˆ†ææ¥å£

```java
@RestController
@RequestMapping("/api/crm/analytics")
public class AnalyticsController {
    
    @Autowired
    private AnalyticsService analyticsService;
    
    /**
     * é”€å”®æŠ¥è¡¨
     */
    @GetMapping("/sales-report")
    public Result<SalesReportVO> getSalesReport(
            @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate startDate,
            @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate endDate,
            @RequestParam(required = false) Long userId) {
        
        SalesReportVO report = analyticsService.getSalesReport(startDate, endDate, userId);
        return Result.success(report);
    }
    
    /**
     * å®¢æˆ·åˆ†æ
     */
    @GetMapping("/customer-analytics")
    public Result<CustomerAnalyticsVO> getCustomerAnalytics() {
        CustomerAnalyticsVO analytics = analyticsService.getCustomerAnalytics();
        return Result.success(analytics);
    }
    
    /**
     * é”€å”®ä¸šç»©æ’è¡Œ
     */
    @GetMapping("/sales-ranking")
    public Result<List<SalesRankingVO>> getSalesRanking(
            @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate startDate,
            @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate endDate) {
        
        List<SalesRankingVO> ranking = analyticsService.getSalesRanking(startDate, endDate);
        return Result.success(ranking);
    }
}
```

## æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

### 1. æ•°æ®åº“ä¼˜åŒ–
- åˆç†å»ºç«‹ç´¢å¼•ï¼ˆå®¢æˆ·ç¼–å·ã€è´Ÿè´£äººã€çŠ¶æ€ç­‰ï¼‰
- ä½¿ç”¨è¯»å†™åˆ†ç¦»
- å¯¹å†å²æ•°æ®è¿›è¡Œåˆ†åŒº
- å®šæœŸå½’æ¡£å†å²æ•°æ®

### 2. ç¼“å­˜ä¼˜åŒ–
- ç¼“å­˜å®¢æˆ·åŸºç¡€ä¿¡æ¯
- ç¼“å­˜ç”¨æˆ·æƒé™æ•°æ®
- ç¼“å­˜ç»Ÿè®¡æ•°æ®ï¼ˆçŸ­æ—¶ç¼“å­˜ï¼‰

### 3. æœç´¢ä¼˜åŒ–
- ä½¿ç”¨ Elasticsearch å®ç°å…¨æ–‡æœç´¢
- å¼‚æ­¥æ›´æ–°æœç´¢ç´¢å¼•

### 4. å¤§æ•°æ®åˆ†æ
- ä½¿ç”¨ ClickHouse å­˜å‚¨åˆ†ææ•°æ®
- å®šæ—¶åŒæ­¥æ•°æ®åˆ° ClickHouse
- å¤æ‚æŠ¥è¡¨æŸ¥è¯¢èµ° ClickHouse

## æ‰©å±•åŠŸèƒ½

### 1. AI æ™ºèƒ½æ¨è
- æ™ºèƒ½çº¿ç´¢åˆ†é…ï¼ˆæ ¹æ®é”€å”®ç‰¹é•¿ã€å†å²æˆäº¤ç‡ç­‰ï¼‰
- æ™ºèƒ½å•†æœºé¢„æµ‹ï¼ˆé¢„æµ‹æˆäº¤æ¦‚ç‡ï¼‰
- æ™ºèƒ½å®¢æˆ·ç”»åƒ

### 2. ç§»åŠ¨ç«¯æ”¯æŒ
- ç§»åŠ¨ç«¯ APPï¼ˆReact Native / Flutterï¼‰
- å¤–å‹¤ç­¾åˆ°
- ç§»åŠ¨å®¡æ‰¹

### 3. é›†æˆç¬¬ä¸‰æ–¹ç³»ç»Ÿ
- é‚®ä»¶ç³»ç»Ÿé›†æˆï¼ˆå‘é€/æ¥æ”¶é‚®ä»¶ï¼‰
- çŸ­ä¿¡å¹³å°é›†æˆ
- ä¼ä¸šå¾®ä¿¡/é’‰é’‰é›†æˆ
- è´¢åŠ¡ç³»ç»Ÿé›†æˆ

### 4. é«˜çº§åˆ†æ
- å®¢æˆ·æµå¤±é¢„è­¦
- RFM å®¢æˆ·åˆ†æ
- å®¢æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼åˆ†æ
- é”€å”®é¢„æµ‹

## æ€»ç»“

CRM ç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºï¼š
1. **ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒ**ï¼šæ‰€æœ‰åŠŸèƒ½å›´ç»•å®¢æˆ·å±•å¼€
2. **é”€å”®æµç¨‹è§„èŒƒåŒ–**ï¼šé€šè¿‡ç³»ç»Ÿè§„èŒƒé”€å”®æµç¨‹ï¼Œæé«˜é”€å”®æ•ˆç‡
3. **æ•°æ®é©±åŠ¨å†³ç­–**ï¼šé€šè¿‡æ•°æ®åˆ†æä¸ºå†³ç­–æä¾›æ”¯æŒ
4. **è¥é”€è‡ªåŠ¨åŒ–**ï¼šæé«˜è¥é”€æ•ˆç‡ï¼Œé™ä½è¥é”€æˆæœ¬
5. **å®¢æˆ·æ»¡æ„åº¦æå‡**ï¼šé€šè¿‡ä¼˜è´¨æœåŠ¡æå‡å®¢æˆ·æ»¡æ„åº¦

æœ¬è®¾è®¡æ–¹æ¡ˆåŸºäº Spring Cloud å¾®æœåŠ¡æ¶æ„ï¼Œé‡‡ç”¨ä¸»æµæŠ€æœ¯æ ˆï¼Œå¯æ»¡è¶³ä¸­å¤§å‹ä¼ä¸šçš„å®¢æˆ·å…³ç³»ç®¡ç†éœ€æ±‚ã€‚

