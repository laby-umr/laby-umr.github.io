---
sidebar_position: 3
title: ç»“æ„å‹æ¨¡å¼è¯¦è§£
description: æ·±å…¥ç†è§£é€‚é…å™¨ã€æ¡¥æ¥ã€ç»„åˆã€è£…é¥°å™¨ã€å¤–è§‚ã€äº«å…ƒã€ä»£ç†ç­‰ç»“æ„å‹æ¨¡å¼
authors: [Laby]
tags: [è®¾è®¡æ¨¡å¼, ç»“æ„å‹æ¨¡å¼, é€‚é…å™¨, æ¡¥æ¥, ç»„åˆ, è£…é¥°å™¨, å¤–è§‚, äº«å…ƒ, ä»£ç†]
last_update:
  date: 2025-08-07
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# ç»“æ„å‹æ¨¡å¼è¯¦è§£

ç»“æ„å‹æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œé€šè¿‡ç»„åˆæœºåˆ¶æ¥åˆ›å»ºæ›´å¤æ‚çš„ç»“æ„ã€‚æœ¬ç« å°†æ·±å…¥æ¢è®¨ä¸ƒç§ç»“æ„å‹æ¨¡å¼çš„åŸç†ã€å®ç°æ–¹å¼å’Œå®é™…åº”ç”¨ã€‚

:::tip æ ¸å¿ƒä»·å€¼
**ç»“æ„å‹æ¨¡å¼ = çµæ´»ç»„åˆ + èŒè´£åˆ†ç¦» + æ¥å£è½¬æ¢**
- ğŸ§© **çµæ´»ç»„åˆ**ï¼šå°†å¯¹è±¡ç»„åˆæˆæ›´å¤æ‚çš„ç»“æ„ï¼Œè€Œæ— éœ€æ”¹å˜å…¶æ¥å£
- ğŸ”„ **æ¥å£é€‚é…**ï¼šä½¿ä¸å…¼å®¹çš„æ¥å£èƒ½å¤ŸååŒå·¥ä½œ
- ğŸ“¦ **å°è£…å˜åŒ–**ï¼šå°†ç³»ç»Ÿä¸­æ˜“å˜éƒ¨åˆ†ä¸ç¨³å®šéƒ¨åˆ†éš”ç¦»
- ğŸšª **ç®€åŒ–æ¥å£**ï¼šä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•ç»Ÿä¸€çš„è®¿é—®æ¥å£
:::

## ç»“æ„å‹æ¨¡å¼æ¦‚è§ˆ

```mermaid
graph TD
    A[ç»“æ„å‹æ¨¡å¼] --> B[é€‚é…å™¨æ¨¡å¼]
    A --> C[æ¡¥æ¥æ¨¡å¼]
    A --> D[ç»„åˆæ¨¡å¼]
    A --> E[è£…é¥°å™¨æ¨¡å¼]
    A --> F[å¤–è§‚æ¨¡å¼]
    A --> G[äº«å…ƒæ¨¡å¼]
    A --> H[ä»£ç†æ¨¡å¼]
    
    B --> B1[æ¥å£è½¬æ¢]
    C --> C1[åˆ†ç¦»æŠ½è±¡ä¸å®ç°]
    D --> D1[æ ‘å½¢ç»“æ„ç»„åˆ]
    E --> E1[åŠ¨æ€æ‰©å±•åŠŸèƒ½]
    F --> F1[ç®€åŒ–å­ç³»ç»Ÿæ¥å£]
    G --> G1[å…±äº«ç»†ç²’åº¦å¯¹è±¡]
    H --> H1[æ§åˆ¶å¯¹è±¡è®¿é—®]
    
    style A fill:#f9f9f9,stroke:#333,stroke-width:2px
    style B fill:#e6f7ff,stroke:#1890ff
    style C fill:#e6f7ff,stroke:#1890ff
    style D fill:#e6f7ff,stroke:#1890ff
    style E fill:#e6f7ff,stroke:#1890ff
    style F fill:#e6f7ff,stroke:#1890ff
    style G fill:#e6f7ff,stroke:#1890ff
    style H fill:#e6f7ff,stroke:#1890ff
```

| æ¨¡å¼ | æ ¸å¿ƒæ„å›¾ | å…³é”®ç‰¹ç‚¹ | å…¸å‹åº”ç”¨ |
|------|---------|---------|---------|
| **é€‚é…å™¨æ¨¡å¼** | æ¥å£è½¬æ¢ | ä½¿ä¸å…¼å®¹æ¥å£ååŒå·¥ä½œ | ç¬¬ä¸‰æ–¹åº“é›†æˆã€æ—§ç³»ç»Ÿå…¼å®¹ |
| **æ¡¥æ¥æ¨¡å¼** | åˆ†ç¦»æŠ½è±¡ä¸å®ç° | æŠ½è±¡ä¸å®ç°ç‹¬ç«‹å˜åŒ– | UIæ¸²æŸ“ã€é©±åŠ¨ç¨‹åº |
| **ç»„åˆæ¨¡å¼** | éƒ¨åˆ†-æ•´ä½“ç»“æ„ | ç»Ÿä¸€å¤„ç†å•ä¸ªå’Œç»„åˆå¯¹è±¡ | æ–‡ä»¶ç³»ç»Ÿã€èœå•ç³»ç»Ÿ |
| **è£…é¥°å™¨æ¨¡å¼** | åŠ¨æ€æ‰©å±•åŠŸèƒ½ | è¿è¡Œæ—¶æ·»åŠ èŒè´£ | I/Oæµã€UIç»„ä»¶æ‰©å±• |
| **å¤–è§‚æ¨¡å¼** | ç®€åŒ–æ¥å£ | ç»Ÿä¸€è®¿é—®å¤æ‚å­ç³»ç»Ÿ | APIç½‘å…³ã€åº“å°è£… |
| **äº«å…ƒæ¨¡å¼** | å…±äº«ç»†ç²’åº¦å¯¹è±¡ | å‡å°‘å†…å­˜ä½¿ç”¨ | å­—ç¬¦æ¸²æŸ“ã€ç¼“å­˜æ±  |
| **ä»£ç†æ¨¡å¼** | æ§åˆ¶å¯¹è±¡è®¿é—® | ä¸ºå¯¹è±¡æä¾›æ›¿ä»£å“ | è¿œç¨‹ä»£ç†ã€æƒé™æ§åˆ¶ |

## 1. é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰

### 1.1 æ¨¡å¼å®šä¹‰

é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿åŸæœ¬ä¸å…¼å®¹çš„ç±»å¯ä»¥ååŒå·¥ä½œã€‚å®ƒå……å½“äº†ä¸¤ä¸ªä¸åŒæ¥å£ä¹‹é—´çš„æ¡¥æ¢ï¼Œå°±åƒç°å®ä¸–ç•Œä¸­çš„ç”µæºé€‚é…å™¨ä¸€æ ·ã€‚

```mermaid
graph LR
    A[å®¢æˆ·ç«¯] -->|ä½¿ç”¨| B[Target<br>ç›®æ ‡æ¥å£]
    C[Adapter<br>é€‚é…å™¨] -->|å®ç°| B
    C -->|ä¾èµ–| D[Adaptee<br>è¢«é€‚é…è€…]
    
    style B fill:#f9f9f9,stroke:#333,stroke-width:2px
    style C fill:#e6f7ff,stroke:#1890ff
    style D fill:#f6ffed,stroke:#52c41a
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **æ¥å£ä¸å…¼å®¹**ï¼šéœ€è¦é›†æˆä¸å…¼å®¹çš„æ¥å£æ—¶
- **å¤ç”¨ç°æœ‰ç±»**ï¼šå¸Œæœ›å¤ç”¨ç°æœ‰ç±»ï¼Œä½†å…¶æ¥å£ä¸ç³»ç»Ÿä¸åŒ¹é…
- **ä¸­é—´å±‚é€‚é…**ï¼šåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´æ„å»ºä¸­é—´å±‚
- **ç¬¬ä¸‰æ–¹åº“é›†æˆ**ï¼šé›†æˆç¬¬ä¸‰æ–¹åº“æˆ–æ—§ç³»ç»Ÿæ—¶

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **å…¼å®¹æ€§**ï¼šä½¿åŸæœ¬ä¸å…¼å®¹çš„ç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œ
- **å¤ç”¨æ€§**ï¼šå¯ä»¥å¤ç”¨ç°æœ‰çš„ç±»ï¼Œæ— éœ€ä¿®æ”¹å…¶ä»£ç 
- **çµæ´»æ€§**ï¼šå…è®¸åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹æ‰©å±•åŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šä¸ä¿®æ”¹åŸæœ‰ä»£ç å³å¯é›†æˆæ–°åŠŸèƒ½

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **å¤æ‚æ€§å¢åŠ **ï¼šå¼•å…¥æ–°çš„ç±»å’Œé—´æ¥å±‚
- **æ•ˆç‡é—®é¢˜**ï¼šå¯èƒ½ä¼šå¼•å…¥ä¸€å®šçš„æ€§èƒ½å¼€é”€
- **è¿‡åº¦ä½¿ç”¨**ï¼šè¿‡åº¦ä½¿ç”¨ä¼šå¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç†è§£å’Œç»´æŠ¤
- **è°ƒè¯•å›°éš¾**ï¼šæ·»åŠ çš„ä¸­é—´å±‚å¯èƒ½å¢åŠ è°ƒè¯•éš¾åº¦

</TabItem>
</Tabs>

### 1.2 å®ç°æ–¹å¼

#### ç±»é€‚é…å™¨æ¨¡å¼

ç±»é€‚é…å™¨æ¨¡å¼é€šè¿‡ç»§æ‰¿æ¥å®ç°ï¼Œé€‚é…å™¨åŒæ—¶ç»§æ‰¿è¢«é€‚é…è€…å¹¶å®ç°ç›®æ ‡æ¥å£ã€‚

```java title="ç±»é€‚é…å™¨æ¨¡å¼"
// ç›®æ ‡æ¥å£
public interface Target {
    void request();
}

// è¢«é€‚é…çš„ç±»
public class Adaptee {
    public void specificRequest() {
        System.out.println("è¢«é€‚é…ç±»çš„ç‰¹æ®Šè¯·æ±‚");
    }
}

// ç±»é€‚é…å™¨
public class ClassAdapter extends Adaptee implements Target {
    @Override
    public void request() {
        // è°ƒç”¨è¢«é€‚é…ç±»çš„æ–¹æ³•
        specificRequest();
    }
}
```

ç±»é€‚é…å™¨ä½¿ç”¨äº†Javaçš„ç»§æ‰¿æœºåˆ¶ï¼Œæ‰€ä»¥åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¦†ç›–è¢«é€‚é…ç±»çš„æ–¹æ³•ï¼Œç¼ºç‚¹æ˜¯å®ƒä¸Javaçš„å•ç»§æ‰¿æœºåˆ¶å†²çªï¼Œé™åˆ¶äº†é€‚é…å™¨çš„çµæ´»æ€§ã€‚

#### å¯¹è±¡é€‚é…å™¨æ¨¡å¼

å¯¹è±¡é€‚é…å™¨æ¨¡å¼é€šè¿‡ç»„åˆæ¥å®ç°ï¼Œé€‚é…å™¨åŒ…å«ä¸€ä¸ªè¢«é€‚é…è€…çš„å®ä¾‹ã€‚

```java title="å¯¹è±¡é€‚é…å™¨æ¨¡å¼"
// å¯¹è±¡é€‚é…å™¨
public class ObjectAdapter implements Target {
    private Adaptee adaptee;
    
    public ObjectAdapter(Adaptee adaptee) {
        this.adaptee = adaptee;
    }
    
    @Override
    public void request() {
        adaptee.specificRequest();
    }
}
```

å¯¹è±¡é€‚é…å™¨ä½¿ç”¨äº†å¯¹è±¡ç»„åˆçš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªå¯¹è±¡åŒ…è£…åœ¨é€‚é…å™¨ä¸­ã€‚è¿™ç§æ–¹å¼æ›´åŠ çµæ´»ï¼Œç¬¦åˆ"ç»„åˆä¼˜äºç»§æ‰¿"çš„åŸåˆ™ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå®é™…å¼€å‘ä¸­ã€‚

### 1.3 é€‚é…å™¨æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | ç±»é€‚é…å™¨ | å¯¹è±¡é€‚é…å™¨ |
|------|---------|-----------|
| **å®ç°æ–¹å¼** | ç»§æ‰¿ | ç»„åˆ |
| **çµæ´»æ€§** | è¾ƒä½ | è¾ƒé«˜ |
| **é€‚ç”¨åœºæ™¯** | é€‚é…å°‘é‡æ¥å£ | é€‚ç”¨å¤šä¸ªè¢«é€‚é…è€… |
| **æ˜¯å¦èƒ½è¦†ç›–è¢«é€‚é…è€…æ–¹æ³•** | å¯ä»¥ | ä¸å¯ä»¥ |
| **æ˜¯å¦èƒ½å¯¹è¢«é€‚é…è€…å­ç±»é€‚é…** | ä¸èƒ½ | å¯ä»¥ |
| **ä»£ç å¤æ‚åº¦** | è¾ƒç®€å• | é€‚ä¸­ |
| **ç¬¦åˆåŸåˆ™** | è¿èƒŒ"ç»„åˆä¼˜äºç»§æ‰¿" | ç¬¦åˆ"ç»„åˆä¼˜äºç»§æ‰¿" |

### 1.4 åº”ç”¨åœºæ™¯

<Tabs>
<TabItem value="payment" label="æ”¯ä»˜ç³»ç»Ÿé€‚é…">

```java title="æ”¯ä»˜ç³»ç»Ÿé€‚é…"
// ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£é€‚é…
public interface PaymentProcessor {
    void processPayment(double amount);
    boolean isPaymentSuccessful();
}

// ç¬¬ä¸‰æ–¹æ”¯ä»˜åº“
public class ThirdPartyPayment {
    public void pay(double amount) {
        System.out.println("ç¬¬ä¸‰æ–¹æ”¯ä»˜å¤„ç†: " + amount);
    }
    
    public boolean getPaymentStatus() {
        return true;
    }
}

// æ”¯ä»˜é€‚é…å™¨
public class PaymentAdapter implements PaymentProcessor {
    private ThirdPartyPayment thirdPartyPayment;
    
    public PaymentAdapter(ThirdPartyPayment thirdPartyPayment) {
        this.thirdPartyPayment = thirdPartyPayment;
    }
    
    @Override
    public void processPayment(double amount) {
        thirdPartyPayment.pay(amount);
    }
    
    @Override
    public boolean isPaymentSuccessful() {
        return thirdPartyPayment.getPaymentStatus();
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class PaymentService {
    public void processPayment(PaymentProcessor processor, double amount) {
        processor.processPayment(amount);
        if (processor.isPaymentSuccessful()) {
            System.out.println("æ”¯ä»˜æˆåŠŸ");
        } else {
            System.out.println("æ”¯ä»˜å¤±è´¥");
        }
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPaymentAdapteré€‚é…å™¨å°†ç¬¬ä¸‰æ–¹æ”¯ä»˜åº“çš„æ¥å£è½¬æ¢ä¸ºç³»ç»Ÿå†…éƒ¨ç»Ÿä¸€çš„PaymentProcessoræ¥å£ï¼Œä½¿å¾—ç³»ç»Ÿå¯ä»¥æ— ç¼é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜åŠŸèƒ½ã€‚

</TabItem>
<TabItem value="legacy" label="æ—§ç³»ç»Ÿé›†æˆ">

```java title="æ—§ç³»ç»Ÿé›†æˆ"
// æ–°ç³»ç»Ÿæ¥å£
public interface NewUserService {
    User getUserById(Long id);
    List<User> getAllUsers();
    void saveUser(User user);
    void deleteUser(Long id);
}

// æ—§ç³»ç»Ÿç±»
public class LegacyUserSystem {
    public UserData findUserById(int userId) {
        System.out.println("æ—§ç³»ç»ŸæŸ¥æ‰¾ç”¨æˆ·: " + userId);
        return new UserData(userId, "user" + userId);
    }
    
    public UserData[] getAllUserData() {
        System.out.println("æ—§ç³»ç»Ÿè·å–æ‰€æœ‰ç”¨æˆ·");
        return new UserData[] { 
            new UserData(1, "user1"), 
            new UserData(2, "user2") 
        };
    }
    
    public void updateUserData(UserData userData) {
        System.out.println("æ—§ç³»ç»Ÿæ›´æ–°ç”¨æˆ·: " + userData.getId());
    }
    
    public void removeUser(int userId) {
        System.out.println("æ—§ç³»ç»Ÿåˆ é™¤ç”¨æˆ·: " + userId);
    }
}

// ç”¨æˆ·æ•°æ®ç±»
public class UserData {
    private int id;
    private String name;
    
    public UserData(int id, String name) {
        this.id = id;
        this.name = name;
    }
    
    public int getId() { return id; }
    public String getName() { return name; }
}

// æ–°ç³»ç»Ÿç”¨æˆ·ç±»
public class User {
    private Long id;
    private String username;
    
    // æ„é€ å‡½æ•°ã€getterå’Œsetter
}

// é€‚é…å™¨
public class LegacyUserSystemAdapter implements NewUserService {
    private LegacyUserSystem legacySystem;
    
    public LegacyUserSystemAdapter(LegacyUserSystem legacySystem) {
        this.legacySystem = legacySystem;
    }
    
    @Override
    public User getUserById(Long id) {
        UserData userData = legacySystem.findUserById(id.intValue());
        return convertToUser(userData);
    }
    
    @Override
    public List<User> getAllUsers() {
        UserData[] userDataArray = legacySystem.getAllUserData();
        List<User> users = new ArrayList<>();
        for (UserData userData : userDataArray) {
            users.add(convertToUser(userData));
        }
        return users;
    }
    
    @Override
    public void saveUser(User user) {
        legacySystem.updateUserData(convertToUserData(user));
    }
    
    @Override
    public void deleteUser(Long id) {
        legacySystem.removeUser(id.intValue());
    }
    
    private User convertToUser(UserData userData) {
        User user = new User();
        user.setId((long)userData.getId());
        user.setUsername(userData.getName());
        return user;
    }
    
    private UserData convertToUserData(User user) {
        return new UserData(user.getId().intValue(), user.getUsername());
    }
}
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡é€‚é…å™¨æ¨¡å¼é›†æˆæ—§ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå°†æ—§æ¥å£è½¬æ¢ä¸ºæ–°ç³»ç»Ÿæ‰€æœŸæœ›çš„æ¥å£æ ¼å¼ï¼Œå¹¶å¤„ç†æ•°æ®è½¬æ¢ã€‚

</TabItem>
<TabItem value="java-collections" label="Javaé›†åˆæ¡†æ¶">

```java title="Javaé›†åˆæ¡†æ¶ä¸­çš„é€‚é…å™¨"
import java.util.*;

public class CollectionAdapterExample {
    public static void main(String[] args) {
        // Arrays.asList() æ˜¯ä¸€ä¸ªé€‚é…å™¨ï¼Œå°†æ•°ç»„è½¬æ¢ä¸ºListæ¥å£
        String[] strArray = {"A", "B", "C"};
        List<String> stringList = Arrays.asList(strArray);
        
        // Collections.enumeration() å°†Listé€‚é…ä¸ºEnumeration
        Enumeration<String> enumeration = Collections.enumeration(stringList);
        
        // Collections.list() å°†Enumerationé€‚é…å›List
        List<String> newList = Collections.list(enumeration);
        
        // è¾“å‡ºç»“æœ
        System.out.println("Original Array: " + Arrays.toString(strArray));
        System.out.println("Adapted List: " + stringList);
        System.out.println("Converted back List: " + newList);
        
        // å±•ç¤ºå¦‚ä½•ä½¿ç”¨é€‚é…å™¨è¿›è¡Œè¿­ä»£
        while (enumeration.hasMoreElements()) {
            System.out.println("Element: " + enumeration.nextElement());
        }
    }
}
```

Javaé›†åˆæ¡†æ¶ä¸­åŒ…å«å¤šä¸ªé€‚é…å™¨å®ç°ï¼Œå¦‚Arrays.asList()å°†æ•°ç»„é€‚é…ä¸ºListæ¥å£ï¼ŒCollections.enumeration()å°†Collectioné€‚é…ä¸ºEnumerationæ¥å£ç­‰ã€‚è¿™äº›é€‚é…å™¨ä½¿å¾—ä¸åŒç±»å‹çš„é›†åˆèƒ½å¤ŸååŒå·¥ä½œã€‚

</TabItem>
</Tabs>

### 1.5 é€‚é…å™¨æ¨¡å¼ä¸å…¶ä»–æ¨¡å¼çš„åŒºåˆ«

| æ¨¡å¼ | ä¸»è¦ç›®çš„ | åº”ç”¨æƒ…æ™¯ | ç»“æ„ç‰¹ç‚¹ |
|------|---------|---------|---------|
| **é€‚é…å™¨æ¨¡å¼** | æ¥å£è½¬æ¢ | ä½¿ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œ | åŒ…è£…ä¸€ä¸ªç±»ï¼Œè½¬æ¢å…¶æ¥å£ |
| **è£…é¥°å™¨æ¨¡å¼** | å¢åŠ åŠŸèƒ½ | åŠ¨æ€æ·»åŠ èŒè´£ | åŒ…è£…ä¸€ä¸ªç±»ï¼Œå¢åŠ å…¶è¡Œä¸º |
| **å¤–è§‚æ¨¡å¼** | ç®€åŒ–æ¥å£ | æä¾›å­ç³»ç»Ÿçš„ç®€åŒ–æ¥å£ | ä¸ºå¤šä¸ªç±»æä¾›ä¸€ä¸ªç»Ÿä¸€æ¥å£ |
| **ä»£ç†æ¨¡å¼** | æ§åˆ¶è®¿é—® | æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—® | åŒ…è£…ä¸€ä¸ªç±»ï¼Œæ§åˆ¶å¯¹å®ƒçš„è®¿é—® |

:::tip é€‚é…å™¨æ¨¡å¼æœ€ä½³å®è·µ
1. **å¯¹è±¡é€‚é…å™¨ä¼˜å…ˆ**ï¼šä¼˜å…ˆä½¿ç”¨å¯¹è±¡é€‚é…å™¨ï¼Œå®ƒæ›´åŠ çµæ´»ä¸”ç¬¦åˆ"ç»„åˆä¼˜äºç»§æ‰¿"åŸåˆ™
2. **èŒè´£æ¸…æ™°**ï¼šé€‚é…å™¨åªè´Ÿè´£æ¥å£è½¬æ¢ï¼Œä¸åº”æ·»åŠ é¢å¤–ä¸šåŠ¡é€»è¾‘
3. **è€ƒè™‘åŒå‘é€‚é…**ï¼šå¿…è¦æ—¶å®ç°åŒå‘é€‚é…ï¼Œå…è®¸å®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„æ¥å£
4. **é€‚åº¦ä½¿ç”¨**ï¼šé¿å…è¿‡åº¦ä½¿ç”¨é€‚é…å™¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç†è§£
5. **å¼‚å¸¸å¤„ç†**ï¼šé€‚é…å™¨ä¸­è¦å¤„ç†å¯èƒ½çš„å¼‚å¸¸è½¬æ¢
:::

## 2. æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰

### 2.1 æ¨¡å¼å®šä¹‰

æ¡¥æ¥æ¨¡å¼å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚å®ƒé€šè¿‡ç»„åˆä¼˜äºç»§æ‰¿çš„è®¾è®¡åŸåˆ™ï¼Œè§£å†³äº†å¤šå±‚ç»§æ‰¿å¸¦æ¥çš„ç±»çˆ†ç‚¸é—®é¢˜ï¼Œå¹¶æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚

```mermaid
graph TD
    A[æŠ½è±¡å±‚<br>Abstraction] -->|å¼•ç”¨| B[å®ç°å±‚<br>Implementor]
    A --> C[ç²¾ç¡®æŠ½è±¡<br>RefinedAbstraction]
    B --> D[å…·ä½“å®ç°A<br>ConcreteImplementorA]
    B --> E[å…·ä½“å®ç°B<br>ConcreteImplementorB]
    
    style A fill:#f9f9f9,stroke:#333,stroke-width:2px
    style B fill:#f9f9f9,stroke:#333,stroke-width:2px
    style C fill:#e6f7ff,stroke:#1890ff
    style D fill:#f6ffed,stroke:#52c41a
    style E fill:#f6ffed,stroke:#52c41a
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **å¤šç»´åº¦å˜åŒ–**ï¼šå½“ä¸€ä¸ªç±»æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦æ—¶
- **é¿å…ç»§æ‰¿çˆ†ç‚¸**ï¼šéœ€è¦é¿å…ç”±äºå¤šå±‚ç»§æ‰¿å¯¼è‡´çš„å­ç±»æ•°é‡å‰§å¢
- **è¿è¡Œæ—¶åˆ‡æ¢å®ç°**ï¼šéœ€è¦åœ¨è¿è¡Œæ—¶åˆ‡æ¢ä¸åŒå®ç°
- **è·¨å¹³å°åº”ç”¨**ï¼šéœ€è¦å®ç°è·¨å¹³å°åº”ç”¨ï¼Œå¦‚é©±åŠ¨ç¨‹åºã€å›¾å½¢æ¸²æŸ“ç­‰

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **åˆ†ç¦»æŠ½è±¡ä¸å®ç°**ï¼šæŠ½è±¡å’Œå®ç°å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼Œä¸ä¼šäº’ç›¸å½±å“
- **æé«˜å¯æ‰©å±•æ€§**ï¼šå¯ä»¥ç‹¬ç«‹æ‰©å±•æŠ½è±¡å±‚å’Œå®ç°å±‚
- **éšè—å®ç°ç»†èŠ‚**ï¼šå®¢æˆ·ç«¯åªéœ€å…³å¿ƒæŠ½è±¡å±‚æ¥å£
- **é¿å…ç±»çˆ†ç‚¸**ï¼šç»„åˆæ›¿ä»£ç»§æ‰¿ï¼Œå‡å°‘ç±»çš„æ•°é‡

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **å¢åŠ å¤æ‚åº¦**ï¼šå¼•å…¥é¢å¤–çš„æŠ½è±¡å±‚å’Œé—´æ¥è°ƒç”¨
- **è®¾è®¡éš¾åº¦**ï¼šéœ€è¦æ­£ç¡®è¯†åˆ«å‡ºä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦
- **åˆå§‹æˆæœ¬é«˜**ï¼šç›¸æ¯”äºå•ä¸€ç±»å±‚æ¬¡ç»“æ„ï¼Œåˆå§‹è®¾è®¡æˆæœ¬æ›´é«˜
- **è°ƒè¯•å›°éš¾**ï¼šç»„åˆå…³ç³»æ¯”ç»§æ‰¿å…³ç³»æ›´éš¾ä»¥ç†è§£å’Œè°ƒè¯•

</TabItem>
</Tabs>

### 2.2 æ¡¥æ¥æ¨¡å¼ç»“æ„

```java title="æ¡¥æ¥æ¨¡å¼"
// å®ç°è€…æ¥å£
public interface Implementor {
    void operationImpl();
}

// å…·ä½“å®ç°è€…A
public class ConcreteImplementorA implements Implementor {
    @Override
    public void operationImpl() {
        System.out.println("å…·ä½“å®ç°è€…Açš„æ“ä½œ");
    }
}

// å…·ä½“å®ç°è€…B
public class ConcreteImplementorB implements Implementor {
    @Override
    public void operationImpl() {
        System.out.println("å…·ä½“å®ç°è€…Bçš„æ“ä½œ");
    }
}

// æŠ½è±¡ç±»
public abstract class Abstraction {
    protected Implementor implementor;
    
    public Abstraction(Implementor implementor) {
        this.implementor = implementor;
    }
    
    public abstract void operation();
}

// ç²¾ç¡®æŠ½è±¡ç±»
public class RefinedAbstraction extends Abstraction {
    public RefinedAbstraction(Implementor implementor) {
        super(implementor);
    }
    
    @Override
    public void operation() {
        System.out.println("ç²¾ç¡®æŠ½è±¡ç±»çš„æ“ä½œ");
        implementor.operationImpl();
    }
}
```

### 2.3 åº”ç”¨åœºæ™¯

<Tabs>
<TabItem value="renderer" label="å›¾å½¢æ¸²æŸ“ç³»ç»Ÿ">

```java title="å›¾å½¢æ¸²æŸ“ç³»ç»Ÿ"
// æ¸²æŸ“å™¨æ¥å£ - å®ç°éƒ¨åˆ†
public interface Renderer {
    void renderCircle(double x, double y, double radius);
    void renderRectangle(double x, double y, double width, double height);
}

// çŸ¢é‡æ¸²æŸ“å™¨ - å…·ä½“å®ç°
public class VectorRenderer implements Renderer {
    @Override
    public void renderCircle(double x, double y, double radius) {
        System.out.println("çŸ¢é‡æ¸²æŸ“åœ†å½¢: (" + x + ", " + y + "), åŠå¾„: " + radius);
    }
    
    @Override
    public void renderRectangle(double x, double y, double width, double height) {
        System.out.println("çŸ¢é‡æ¸²æŸ“çŸ©å½¢: (" + x + ", " + y + "), å°ºå¯¸: " + width + "x" + height);
    }
}

// å…‰æ …æ¸²æŸ“å™¨ - å…·ä½“å®ç°
public class RasterRenderer implements Renderer {
    @Override
    public void renderCircle(double x, double y, double radius) {
        System.out.println("å…‰æ …æ¸²æŸ“åœ†å½¢: (" + x + ", " + y + "), åŠå¾„: " + radius);
    }
    
    @Override
    public void renderRectangle(double x, double y, double width, double height) {
        System.out.println("å…‰æ …æ¸²æŸ“çŸ©å½¢: (" + x + ", " + y + "), å°ºå¯¸: " + width + "x" + height);
    }
}

// å½¢çŠ¶ç±» - æŠ½è±¡éƒ¨åˆ†
public abstract class Shape {
    protected Renderer renderer;
    
    public Shape(Renderer renderer) {
        this.renderer = renderer;
    }
    
    public abstract void draw();
    public abstract void resize(double scale);
}

// åœ†å½¢ - ç²¾ç¡®æŠ½è±¡
public class Circle extends Shape {
    private double x, y, radius;
    
    public Circle(Renderer renderer, double x, double y, double radius) {
        super(renderer);
        this.x = x;
        this.y = y;
        this.radius = radius;
    }
    
    @Override
    public void draw() {
        renderer.renderCircle(x, y, radius);
    }
    
    @Override
    public void resize(double scale) {
        radius *= scale;
    }
}

// çŸ©å½¢ - ç²¾ç¡®æŠ½è±¡
public class Rectangle extends Shape {
    private double x, y, width, height;
    
    public Rectangle(Renderer renderer, double x, double y, double width, double height) {
        super(renderer);
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
    }
    
    @Override
    public void draw() {
        renderer.renderRectangle(x, y, width, height);
    }
    
    @Override
    public void resize(double scale) {
        width *= scale;
        height *= scale;
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class BridgePatternDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä¸åŒçš„æ¸²æŸ“å™¨
        Renderer vectorRenderer = new VectorRenderer();
        Renderer rasterRenderer = new RasterRenderer();
        
        // ä½¿ç”¨çŸ¢é‡æ¸²æŸ“å™¨åˆ›å»ºå½¢çŠ¶
        Shape circle1 = new Circle(vectorRenderer, 10, 10, 5);
        Shape rectangle1 = new Rectangle(vectorRenderer, 20, 20, 15, 10);
        
        // ä½¿ç”¨å…‰æ …æ¸²æŸ“å™¨åˆ›å»ºå½¢çŠ¶
        Shape circle2 = new Circle(rasterRenderer, 10, 10, 5);
        Shape rectangle2 = new Rectangle(rasterRenderer, 20, 20, 15, 10);
        
        // ç»˜åˆ¶å½¢çŠ¶
        circle1.draw();      // ä½¿ç”¨çŸ¢é‡æ¸²æŸ“å™¨ç»˜åˆ¶åœ†å½¢
        rectangle1.draw();   // ä½¿ç”¨çŸ¢é‡æ¸²æŸ“å™¨ç»˜åˆ¶çŸ©å½¢
        circle2.draw();      // ä½¿ç”¨å…‰æ …æ¸²æŸ“å™¨ç»˜åˆ¶åœ†å½¢
        rectangle2.draw();   // ä½¿ç”¨å…‰æ …æ¸²æŸ“å™¨ç»˜åˆ¶çŸ©å½¢
        
        // è°ƒæ•´å¤§å°å¹¶å†æ¬¡ç»˜åˆ¶
        circle1.resize(2);
        circle1.draw();
    }
}
```

è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼š
1. å½¢çŠ¶ï¼ˆåœ†å½¢ã€çŸ©å½¢ï¼‰- æŠ½è±¡éƒ¨åˆ†
2. æ¸²æŸ“æ–¹å¼ï¼ˆçŸ¢é‡ã€å…‰æ …ï¼‰- å®ç°éƒ¨åˆ†

é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„ç»„åˆè¿™ä¸¤ä¸ªç»´åº¦è€Œä¸éœ€è¦ä¸ºæ¯ä¸ªç»„åˆåˆ›å»ºä¸€ä¸ªç±»ã€‚

</TabItem>
<TabItem value="devices" label="è¿œç¨‹æ§åˆ¶è®¾å¤‡">

```java title="è¿œç¨‹æ§åˆ¶è®¾å¤‡"
// è®¾å¤‡æ¥å£ - å®ç°éƒ¨åˆ†
public interface Device {
    boolean isEnabled();
    void enable();
    void disable();
    int getVolume();
    void setVolume(int volume);
    int getChannel();
    void setChannel(int channel);
}

// ç”µè§† - å…·ä½“å®ç°
public class TV implements Device {
    private boolean on = false;
    private int volume = 30;
    private int channel = 1;
    
    @Override
    public boolean isEnabled() {
        return on;
    }
    
    @Override
    public void enable() {
        on = true;
        System.out.println("ç”µè§†å·²æ‰“å¼€");
    }
    
    @Override
    public void disable() {
        on = false;
        System.out.println("ç”µè§†å·²å…³é—­");
    }
    
    @Override
    public int getVolume() {
        return volume;
    }
    
    @Override
    public void setVolume(int volume) {
        this.volume = Math.min(Math.max(volume, 0), 100);
        System.out.println("ç”µè§†éŸ³é‡è®¾ç½®ä¸º: " + this.volume);
    }
    
    @Override
    public int getChannel() {
        return channel;
    }
    
    @Override
    public void setChannel(int channel) {
        this.channel = channel;
        System.out.println("ç”µè§†é¢‘é“åˆ‡æ¢è‡³: " + this.channel);
    }
}

// æ”¶éŸ³æœº - å…·ä½“å®ç°
public class Radio implements Device {
    private boolean on = false;
    private int volume = 20;
    private int channel = 88;
    
    @Override
    public boolean isEnabled() {
        return on;
    }
    
    @Override
    public void enable() {
        on = true;
        System.out.println("æ”¶éŸ³æœºå·²æ‰“å¼€");
    }
    
    @Override
    public void disable() {
        on = false;
        System.out.println("æ”¶éŸ³æœºå·²å…³é—­");
    }
    
    @Override
    public int getVolume() {
        return volume;
    }
    
    @Override
    public void setVolume(int volume) {
        this.volume = Math.min(Math.max(volume, 0), 100);
        System.out.println("æ”¶éŸ³æœºéŸ³é‡è®¾ç½®ä¸º: " + this.volume);
    }
    
    @Override
    public int getChannel() {
        return channel;
    }
    
    @Override
    public void setChannel(int channel) {
        this.channel = channel;
        System.out.println("æ”¶éŸ³æœºè°ƒé¢‘è‡³: " + this.channel);
    }
}

// è¿œç¨‹æ§åˆ¶ - æŠ½è±¡éƒ¨åˆ†
public abstract class RemoteControl {
    protected Device device;
    
    public RemoteControl(Device device) {
        this.device = device;
    }
    
    public void togglePower() {
        if (device.isEnabled()) {
            device.disable();
        } else {
            device.enable();
        }
    }
    
    public void volumeUp() {
        device.setVolume(device.getVolume() + 10);
    }
    
    public void volumeDown() {
        device.setVolume(device.getVolume() - 10);
    }
    
    public void channelUp() {
        device.setChannel(device.getChannel() + 1);
    }
    
    public void channelDown() {
        device.setChannel(device.getChannel() - 1);
    }
}

// é«˜çº§è¿œç¨‹æ§åˆ¶ - ç²¾ç¡®æŠ½è±¡
public class AdvancedRemoteControl extends RemoteControl {
    public AdvancedRemoteControl(Device device) {
        super(device);
    }
    
    public void mute() {
        device.setVolume(0);
        System.out.println("å·²é™éŸ³");
    }
    
    public void setChannel(int channel) {
        device.setChannel(channel);
        System.out.println("ç›´æ¥åˆ‡æ¢è‡³é¢‘é“: " + channel);
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class RemoteControlDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè®¾å¤‡
        Device tv = new TV();
        Device radio = new Radio();
        
        // åˆ›å»ºæ ‡å‡†é¥æ§å™¨
        RemoteControl tvRemote = new RemoteControl(tv);
        tvRemote.togglePower();   // æ‰“å¼€ç”µè§†
        tvRemote.volumeUp();      // å¢åŠ éŸ³é‡
        tvRemote.channelUp();     // åˆ‡æ¢é¢‘é“
        
        // åˆ›å»ºé«˜çº§é¥æ§å™¨
        AdvancedRemoteControl radioAdvancedRemote = new AdvancedRemoteControl(radio);
        radioAdvancedRemote.togglePower();   // æ‰“å¼€æ”¶éŸ³æœº
        radioAdvancedRemote.setChannel(104); // ç›´æ¥è®¾ç½®é¢‘é“
        radioAdvancedRemote.mute();          // é™éŸ³
    }
}
```

è¿™ä¸ªä¾‹å­å±•ç¤ºäº†æ¡¥æ¥æ¨¡å¼å¦‚ä½•å°†è¿œç¨‹æ§åˆ¶ï¼ˆæŠ½è±¡éƒ¨åˆ†ï¼‰ä¸è®¾å¤‡ï¼ˆå®ç°éƒ¨åˆ†ï¼‰åˆ†ç¦»ï¼Œå…è®¸å®ƒä»¬ç‹¬ç«‹å˜åŒ–ã€‚æˆ‘ä»¬å¯ä»¥æœ‰ä¸åŒç±»å‹çš„é¥æ§å™¨å’Œä¸åŒç±»å‹çš„è®¾å¤‡ï¼Œå¹¶ä¸”å¯ä»¥è‡ªç”±ç»„åˆå®ƒä»¬ã€‚

</TabItem>
</Tabs>

### 2.4 æ¡¥æ¥æ¨¡å¼ä¸å…¶ä»–æ¨¡å¼æ¯”è¾ƒ

| æ¨¡å¼ | æ¡¥æ¥æ¨¡å¼ | é€‚é…å™¨æ¨¡å¼ | ç­–ç•¥æ¨¡å¼ | ç»„åˆæ¨¡å¼ |
|------|---------|-----------|---------|---------|
| **ç›®çš„** | åˆ†ç¦»æŠ½è±¡ä¸å®ç° | è½¬æ¢æ¥å£ | å°è£…ç®—æ³• | ç»„ç»‡å¯¹è±¡å±‚æ¬¡ç»“æ„ |
| **å…³æ³¨ç‚¹** | å¤„ç†å¤šç»´åº¦å˜åŒ– | ä½¿ä¸å…¼å®¹æ¥å£å…¼å®¹ | æä¾›å¯æ›¿æ¢ç®—æ³• | éƒ¨åˆ†-æ•´ä½“å…³ç³» |
| **è®¾è®¡æ—¶æœº** | è®¾è®¡å‰æœŸ | è®¾è®¡åæœŸ/é›†æˆæœŸ | è®¾è®¡ä¸­æœŸ | è®¾è®¡ä¸­æœŸ |
| **ç±»æ•°é‡** | ä¸­ç­‰ | å°‘ | ä¸­ç­‰ | å°‘ |
| **å¤æ‚åº¦** | ä¸­é«˜ | ä½ | ä¸­ | ä¸­ |

### 2.5 å®ç°è¦ç‚¹

#### ç±»å±‚æ¬¡ç»“æ„

æ¡¥æ¥æ¨¡å¼åˆ›å»ºäº†ä¸¤ä¸ªç‹¬ç«‹çš„ç±»å±‚æ¬¡ç»“æ„ï¼š
1. **æŠ½è±¡å±‚**: AbstractionåŠå…¶å­ç±»
2. **å®ç°å±‚**: ImplementoråŠå…¶å®ç°ç±»

```mermaid
graph BT
    A[Abstraction] --> B[Client]
    C[RefinedAbstraction] --> A
    D[Implementor] --> A
    E[ConcreteImplementorA] --> D
    F[ConcreteImplementorB] --> D
    
    style A fill:#f9f9f9,stroke:#333,stroke-width:2px
    style D fill:#f9f9f9,stroke:#333,stroke-width:2px
```

#### è®¾è®¡æ­¥éª¤

1. è¯†åˆ«ç³»ç»Ÿä¸­çš„ç‹¬ç«‹å˜åŒ–ç»´åº¦
2. åˆ†ç¦»æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†
3. åˆ›å»ºæŠ½è±¡ç±»åŠå…¶æ´¾ç”Ÿç±»
4. åˆ›å»ºå®ç°æ¥å£åŠå…¶å®ç°ç±»
5. åœ¨æŠ½è±¡ç±»ä¸­ç»´æŠ¤å¯¹å®ç°æ¥å£çš„å¼•ç”¨

:::tip æ¡¥æ¥æ¨¡å¼æœ€ä½³å®è·µ
1. **å°½æ—©è®¾è®¡**ï¼šåœ¨ç³»ç»Ÿè®¾è®¡åˆæœŸå°±åº”è€ƒè™‘ä½¿ç”¨æ¡¥æ¥æ¨¡å¼
2. **æ˜ç¡®åˆ†ç¦»**ï¼šç¡®ä¿æŠ½è±¡å’Œå®ç°çœŸæ­£ç‹¬ç«‹ä¸”å¯ä»¥å•ç‹¬æ‰©å±•
3. **æ³¨æ„ç²’åº¦**ï¼šå®ç°æ¥å£åº”è¯¥è¶³å¤ŸæŠ½è±¡ï¼Œä»¥å…è®¸ä¸åŒçš„å…·ä½“å®ç°
4. **è€ƒè™‘ä¾èµ–æ³¨å…¥**ï¼šç»“åˆä¾èµ–æ³¨å…¥æ¡†æ¶å®ç°æ¡¥æ¥æ¨¡å¼
5. **å¤„ç†å¼‚å¸¸æƒ…å†µ**ï¼šè®¾è®¡å®ç°ç±»æ—¶è€ƒè™‘å¯èƒ½çš„å¼‚å¸¸å’Œè¾¹ç•Œæƒ…å†µ
:::

## 3. ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰

### 3.1 æ¨¡å¼å®šä¹‰

ç»„åˆæ¨¡å¼å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯ç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡ç»„åˆï¼Œè€Œæ— éœ€å…³å¿ƒå…¶å†…éƒ¨å¤æ‚ç»“æ„ã€‚

```mermaid
graph TD
    A[å®¢æˆ·ç«¯] -->|ä½¿ç”¨| B[Component<br>ç»„ä»¶]
    B -->|ç»§æ‰¿| C[Leaf<br>å¶å­èŠ‚ç‚¹]
    B -->|ç»§æ‰¿| D[Composite<br>ç»„åˆèŠ‚ç‚¹]
    D -->|åŒ…å«| B
    
    style B fill:#f9f9f9,stroke:#333,stroke-width:2px
    style C fill:#f6ffed,stroke:#52c41a
    style D fill:#e6f7ff,stroke:#1890ff
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **è¡¨ç¤ºéƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„**ï¼šéœ€è¦è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„
- **ç»Ÿä¸€å¤„ç†**ï¼šå¸Œæœ›å®¢æˆ·ç«¯å¿½ç•¥å¤åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„å·®å¼‚
- **æ ‘å½¢ç»“æ„**ï¼šéœ€è¦å¤„ç†æ ‘å½¢ç»“æ„ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€èœå•ç³»ç»Ÿç­‰
- **é€’å½’ç»„åˆ**ï¼šéœ€è¦é€’å½’ç»„åˆå¯¹è±¡ä»¥å½¢æˆæ›´å¤æ‚çš„ç»“æ„

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **ç®€åŒ–å®¢æˆ·ç«¯ä»£ç **ï¼šå®¢æˆ·ç«¯å¯ä»¥ä¸€è‡´åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡
- **æ–¹ä¾¿æ·»åŠ æ–°ç»„ä»¶**ï¼šå¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ æ–°ç±»å‹çš„ç»„ä»¶è€Œä¸å½±å“å·²æœ‰ä»£ç 
- **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šç³»ç»Ÿæ›´æ˜“äºæ‰©å±•ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- **çµæ´»ç»„åˆ**ï¼šå¯ä»¥çµæ´»åœ°ç»„åˆå¯¹è±¡ï¼Œå½¢æˆæ›´å¤æ‚çš„æ ‘å½¢ç»“æ„

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **é™åˆ¶ç»„ä»¶ç±»å‹**ï¼šå¾ˆéš¾é™åˆ¶ç»„åˆä¸­çš„ç»„ä»¶ç±»å‹
- **è®¾è®¡è¿‡äºä¸€èˆ¬åŒ–**ï¼šä¸ºäº†ç»Ÿä¸€æ¥å£ï¼Œå¯èƒ½ä¼šè®©è®¾è®¡å˜å¾—è¿‡äºä¸€èˆ¬åŒ–
- **æ€§èƒ½è€ƒé‡**ï¼šå¯¹ç»„ä»¶çš„éå†æ“ä½œå¯èƒ½ä¼šå½±å“æ€§èƒ½
- **éš¾ä»¥ç¡®ä¿å®‰å…¨æ€§**ï¼šåœ¨é€æ˜æ€§å’Œå®‰å…¨æ€§ä¹‹é—´éœ€è¦åšå‡ºæƒè¡¡

</TabItem>
</Tabs>

### 3.2 ç»„åˆæ¨¡å¼ç»“æ„

```java title="ç»„åˆæ¨¡å¼"
// æŠ½è±¡ç»„ä»¶
public abstract class Component {
    protected String name;
    
    public Component(String name) {
        this.name = name;
    }
    
    public abstract void add(Component component);
    public abstract void remove(Component component);
    public abstract void display(int depth);
    public abstract void operation();
}

// å¶å­èŠ‚ç‚¹
public class Leaf extends Component {
    public Leaf(String name) {
        super(name);
    }
    
    @Override
    public void add(Component component) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸èƒ½æ·»åŠ å­èŠ‚ç‚¹");
    }
    
    @Override
    public void remove(Component component) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸èƒ½åˆ é™¤å­èŠ‚ç‚¹");
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "- " + name);
    }
    
    @Override
    public void operation() {
        System.out.println("å¶å­èŠ‚ç‚¹æ“ä½œ: " + name);
    }
}

// å¤åˆèŠ‚ç‚¹
public class Composite extends Component {
    private List<Component> children = new ArrayList<>();
    
    public Composite(String name) {
        super(name);
    }
    
    @Override
    public void add(Component component) {
        children.add(component);
    }
    
    @Override
    public void remove(Component component) {
        children.remove(component);
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "+ " + name);
        
        for (Component child : children) {
            child.display(depth + 1);
        }
    }
    
    @Override
    public void operation() {
        System.out.println("å¤åˆèŠ‚ç‚¹æ“ä½œ: " + name);
        for (Component child : children) {
            child.operation();
        }
    }
}
```

### 3.3 ç»„åˆæ¨¡å¼å˜ä½“

#### é€æ˜ç»„åˆæ¨¡å¼

é€æ˜ç»„åˆæ¨¡å¼åœ¨æŠ½è±¡ç»„ä»¶ä¸­å®šä¹‰æ‰€æœ‰ç®¡ç†å­ç»„ä»¶çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹ï¼Œè¿™ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€å¯¹å¾…æ‰€æœ‰ç»„ä»¶ï¼Œä½†å¶å­èŠ‚ç‚¹å¿…é¡»å®ç°ä¸€äº›å¹¶ä¸é€‚ç”¨çš„æ–¹æ³•ã€‚

```java title="é€æ˜ç»„åˆæ¨¡å¼"
public abstract class Component {
    protected String name;
    
    public Component(String name) {
        this.name = name;
    }
    
    // æ‰€æœ‰å­ç±»éƒ½å¿…é¡»å®ç°è¿™äº›æ–¹æ³•
    public abstract void add(Component component);
    public abstract void remove(Component component);
    public abstract Component getChild(int index);
    public abstract void display(int depth);
    public abstract void operation();
}
```

#### å®‰å…¨ç»„åˆæ¨¡å¼

å®‰å…¨ç»„åˆæ¨¡å¼åªåœ¨æŠ½è±¡ç»„ä»¶ä¸­å®šä¹‰å…±åŒæ“ä½œï¼Œè€Œå°†ç®¡ç†å­ç»„ä»¶çš„æ–¹æ³•æ”¾åœ¨ç»„åˆèŠ‚ç‚¹ç±»ä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…å¶å­èŠ‚ç‚¹å®ç°ä¸å¿…è¦çš„æ–¹æ³•ï¼Œä½†å®¢æˆ·ç«¯éœ€è¦åŒºåˆ†å¶å­å’Œç»„åˆèŠ‚ç‚¹ã€‚

```java title="å®‰å…¨ç»„åˆæ¨¡å¼"
public abstract class Component {
    protected String name;
    
    public Component(String name) {
        this.name = name;
    }
    
    // æ‰€æœ‰ç»„ä»¶å…±æœ‰çš„æ–¹æ³•
    public abstract void display(int depth);
    public abstract void operation();
    
    // å¶å­èŠ‚ç‚¹ä¸éœ€è¦å®ç°è¿™äº›æ–¹æ³•
}

public class Composite extends Component {
    private List<Component> children = new ArrayList<>();
    
    // ç»„åˆèŠ‚ç‚¹ç‰¹æœ‰çš„æ–¹æ³•
    public void add(Component component) {
        children.add(component);
    }
    
    public void remove(Component component) {
        children.remove(component);
    }
    
    public Component getChild(int index) {
        return children.get(index);
    }
    
    // å…¶ä»–å®ç°...
}
```

### 3.4 åº”ç”¨åœºæ™¯

<Tabs>
<TabItem value="file-system" label="æ–‡ä»¶ç³»ç»Ÿ">

```java title="æ–‡ä»¶ç³»ç»Ÿ"
// æ–‡ä»¶ç³»ç»Ÿé¡¹æŠ½è±¡
public abstract class FileSystemItem {
    protected String name;
    protected long size;
    
    public FileSystemItem(String name, long size) {
        this.name = name;
        this.size = size;
    }
    
    public String getName() {
        return name;
    }
    
    public abstract void display(int depth);
    public abstract long getSize();
    public abstract void add(FileSystemItem item);
    public abstract void remove(FileSystemItem item);
    public abstract List<FileSystemItem> getChildren();
}

// æ–‡ä»¶
public class File extends FileSystemItem {
    public File(String name, long size) {
        super(name, size);
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "ğŸ“„ " + name + " (" + formatSize(size) + ")");
    }
    
    @Override
    public long getSize() {
        return size;
    }
    
    @Override
    public void add(FileSystemItem item) {
        throw new UnsupportedOperationException("æ–‡ä»¶ä¸èƒ½æ·»åŠ å­é¡¹");
    }
    
    @Override
    public void remove(FileSystemItem item) {
        throw new UnsupportedOperationException("æ–‡ä»¶ä¸èƒ½åˆ é™¤å­é¡¹");
    }
    
    @Override
    public List<FileSystemItem> getChildren() {
        return Collections.emptyList();
    }
    
    private String formatSize(long size) {
        if (size < 1024) {
            return size + " bytes";
        } else if (size < 1024 * 1024) {
            return String.format("%.2f KB", size / 1024.0);
        } else if (size < 1024 * 1024 * 1024) {
            return String.format("%.2f MB", size / (1024.0 * 1024));
        } else {
            return String.format("%.2f GB", size / (1024.0 * 1024 * 1024));
        }
    }
}

// ç›®å½•
public class Directory extends FileSystemItem {
    private List<FileSystemItem> children = new ArrayList<>();
    
    public Directory(String name) {
        super(name, 0);
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "ğŸ“ " + name + " (" + formatSize(getSize()) + ")");
        
        for (FileSystemItem child : children) {
            child.display(depth + 1);
        }
    }
    
    @Override
    public long getSize() {
        long totalSize = 0;
        for (FileSystemItem child : children) {
            totalSize += child.getSize();
        }
        return totalSize;
    }
    
    @Override
    public void add(FileSystemItem item) {
        children.add(item);
    }
    
    @Override
    public void remove(FileSystemItem item) {
        children.remove(item);
    }
    
    @Override
    public List<FileSystemItem> getChildren() {
        return new ArrayList<>(children);
    }
    
    private String formatSize(long size) {
        if (size < 1024) {
            return size + " bytes";
        } else if (size < 1024 * 1024) {
            return String.format("%.2f KB", size / 1024.0);
        } else if (size < 1024 * 1024 * 1024) {
            return String.format("%.2f MB", size / (1024.0 * 1024));
        } else {
            return String.format("%.2f GB", size / (1024.0 * 1024 * 1024));
        }
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class FileSystemDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæ ¹ç›®å½•
        Directory root = new Directory("root");
        
        // åˆ›å»ºå­ç›®å½•å’Œæ–‡ä»¶
        Directory docs = new Directory("documents");
        Directory pics = new Directory("pictures");
        
        File readme = new File("README.txt", 2048);
        File config = new File("config.xml", 1024);
        
        // æ·»åŠ åˆ°æ ¹ç›®å½•
        root.add(docs);
        root.add(pics);
        root.add(readme);
        root.add(config);
        
        // æ·»åŠ å­ç›®å½•å†…å®¹
        docs.add(new File("document1.docx", 5120));
        docs.add(new File("document2.docx", 7168));
        
        Directory vacationPics = new Directory("vacation");
        pics.add(vacationPics);
        pics.add(new File("photo1.jpg", 2048));
        
        vacationPics.add(new File("vacation1.jpg", 4096));
        vacationPics.add(new File("vacation2.jpg", 3072));
        
        // æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç»“æ„
        root.display(0);
        
        // è®¡ç®—æ€»å¤§å°
        System.out.println("\næ€»å¤§å°: " + formatSize(root.getSize()));
    }
    
    private static String formatSize(long size) {
        if (size < 1024) {
            return size + " bytes";
        } else if (size < 1024 * 1024) {
            return String.format("%.2f KB", size / 1024.0);
        } else if (size < 1024 * 1024 * 1024) {
            return String.format("%.2f MB", size / (1024.0 * 1024));
        } else {
            return String.format("%.2f GB", size / (1024.0 * 1024 * 1024));
        }
    }
}
```

è¿™ä¸ªç¤ºä¾‹æ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…å«ç›®å½•å’Œæ–‡ä»¶ã€‚ç›®å½•å¯ä»¥åŒ…å«å…¶ä»–ç›®å½•å’Œæ–‡ä»¶ï¼Œè€Œæ–‡ä»¶æ˜¯å¶å­èŠ‚ç‚¹ã€‚é€šè¿‡ç»„åˆæ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä»£ç å¯ä»¥ç»Ÿä¸€å¤„ç†æ–‡ä»¶å’Œç›®å½•ã€‚

</TabItem>
<TabItem value="menu-system" label="èœå•ç³»ç»Ÿ">

```java title="èœå•ç³»ç»Ÿ"
// èœå•ç»„ä»¶
public abstract class MenuComponent {
    protected String name;
    protected String description;
    
    public MenuComponent(String name, String description) {
        this.name = name;
        this.description = description;
    }
    
    public String getName() {
        return name;
    }
    
    public String getDescription() {
        return description;
    }
    
    public abstract void add(MenuComponent menuComponent);
    public abstract void remove(MenuComponent menuComponent);
    public abstract MenuComponent getChild(int i);
    public abstract void print(int depth);
    public abstract boolean isVegetarian();
    public abstract double getPrice();
}

// èœå•é¡¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
public class MenuItem extends MenuComponent {
    private boolean vegetarian;
    private double price;
    
    public MenuItem(String name, String description, boolean vegetarian, double price) {
        super(name, description);
        this.vegetarian = vegetarian;
        this.price = price;
    }
    
    @Override
    public void add(MenuComponent menuComponent) {
        throw new UnsupportedOperationException("èœå•é¡¹ä¸æ”¯æŒæ·»åŠ å­èœå•");
    }
    
    @Override
    public void remove(MenuComponent menuComponent) {
        throw new UnsupportedOperationException("èœå•é¡¹ä¸æ”¯æŒåˆ é™¤å­èœå•");
    }
    
    @Override
    public MenuComponent getChild(int i) {
        throw new UnsupportedOperationException("èœå•é¡¹æ²¡æœ‰å­èœå•");
    }
    
    @Override
    public void print(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.print(prefix + "ğŸ½ï¸ " + getName());
        if (isVegetarian()) {
            System.out.print("(V)");
        }
        System.out.println(", " + getPrice() + "Â¥ -- " + getDescription());
    }
    
    @Override
    public boolean isVegetarian() {
        return vegetarian;
    }
    
    @Override
    public double getPrice() {
        return price;
    }
}

// èœå•ï¼ˆç»„åˆèŠ‚ç‚¹ï¼‰
public class Menu extends MenuComponent {
    private List<MenuComponent> menuComponents = new ArrayList<>();
    
    public Menu(String name, String description) {
        super(name, description);
    }
    
    @Override
    public void add(MenuComponent menuComponent) {
        menuComponents.add(menuComponent);
    }
    
    @Override
    public void remove(MenuComponent menuComponent) {
        menuComponents.remove(menuComponent);
    }
    
    @Override
    public MenuComponent getChild(int i) {
        return menuComponents.get(i);
    }
    
    @Override
    public void print(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "ğŸ“– " + getName() + " -- " + getDescription());
        System.out.println(prefix + "--------------------------------");
        
        for (MenuComponent menuComponent : menuComponents) {
            menuComponent.print(depth + 1);
        }
    }
    
    @Override
    public boolean isVegetarian() {
        // å¦‚æœæ‰€æœ‰å­é¡¹éƒ½æ˜¯ç´ é£Ÿï¼Œåˆ™èœå•ä¸ºç´ é£Ÿ
        return menuComponents.stream().allMatch(MenuComponent::isVegetarian);
    }
    
    @Override
    public double getPrice() {
        // è®¡ç®—èœå•æ€»ä»·æ ¼
        return menuComponents.stream()
                .mapToDouble(MenuComponent::getPrice)
                .sum();
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class MenuSystemDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä¸»èœå•
        MenuComponent mainMenu = new Menu("ä¸»èœå•", "é¤å…ä¸»èœå•");
        
        // åˆ›å»ºå­èœå•
        MenuComponent breakfastMenu = new Menu("æ—©é¤èœå•", "æ—©é¤é€‰é¡¹");
        MenuComponent lunchMenu = new Menu("åˆé¤èœå•", "åˆé¤é€‰é¡¹");
        MenuComponent dinnerMenu = new Menu("æ™šé¤èœå•", "æ™šé¤é€‰é¡¹");
        MenuComponent dessertMenu = new Menu("ç”œç‚¹èœå•", "ç”œç‚¹é€‰é¡¹");
        
        // æ·»åŠ å­èœå•åˆ°ä¸»èœå•
        mainMenu.add(breakfastMenu);
        mainMenu.add(lunchMenu);
        mainMenu.add(dinnerMenu);
        
        // æ·»åŠ èœå•é¡¹åˆ°æ—©é¤èœå•
        breakfastMenu.add(new MenuItem("ç…é¥¼", "é¦™è„†å¯å£çš„ç…é¥¼", true, 10.0));
        breakfastMenu.add(new MenuItem("åŸ¹æ ¹è›‹é¥¼", "åŸ¹æ ¹å’Œé¸¡è›‹åšæˆçš„é¥¼", false, 15.0));
        breakfastMenu.add(new MenuItem("æ°´æœæ²™æ‹‰", "æ–°é²œæ°´æœæ²™æ‹‰", true, 12.0));
        
        // æ·»åŠ èœå•é¡¹åˆ°åˆé¤èœå•
        lunchMenu.add(new MenuItem("ç´ é£Ÿæ±‰å ¡", "å…¨éº¦é¢åŒ…æ­é…ç´ é£Ÿæ±‰å ¡", true, 20.0));
        lunchMenu.add(new MenuItem("ç‰›è‚‰æ±‰å ¡", "ç‰›è‚‰æ±‰å ¡é…èŠå£«å’Œç”Ÿèœ", false, 25.0));
        lunchMenu.add(new MenuItem("è–¯æ¡", "è„†çš®è–¯æ¡", true, 8.0));
        
        // æ·»åŠ èœå•é¡¹åˆ°æ™šé¤èœå•
        dinnerMenu.add(new MenuItem("æ„å¤§åˆ©é¢", "æ„å¤§åˆ©é¢é…ç•ªèŒ„é…±", true, 22.0));
        dinnerMenu.add(new MenuItem("ç‰›æ’", "ç¾å‘³çš„ç‰›æ’", false, 40.0));
        dinnerMenu.add(new MenuItem("æµ·é²œé¥­", "æ–°é²œçš„æµ·é²œé¥­", false, 35.0));
        
        // æ·»åŠ ç”œç‚¹èœå•åˆ°æ™šé¤èœå•
        dinnerMenu.add(dessertMenu);
        
        // æ·»åŠ èœå•é¡¹åˆ°ç”œç‚¹èœå•
        dessertMenu.add(new MenuItem("ææ‹‰ç±³è‹", "ç»å…¸æ„å¤§åˆ©ç”œç‚¹", true, 15.0));
        dessertMenu.add(new MenuItem("èŠå£«è›‹ç³•", "çº½çº¦é£æ ¼èŠå£«è›‹ç³•", true, 18.0));
        
        // æ‰“å°æ•´ä¸ªèœå•
        mainMenu.print(0);
        
        // è®¡ç®—æ€»ä»·
        System.out.println("\nå…¨éƒ¨èœå•æ€»ä»·: " + mainMenu.getPrice() + "Â¥");
        
        // æ‰“å°ä»…ç´ é£Ÿèœå•
        System.out.println("\nç´ é£Ÿèœå•:");
        printVegetarianMenu(mainMenu, 0);
    }
    
    private static void printVegetarianMenu(MenuComponent menuComponent, int depth) {
        if (menuComponent.isVegetarian()) {
            menuComponent.print(depth);
        } else if (!(menuComponent instanceof MenuItem)) {
            // å¦‚æœæ˜¯èœå•ï¼Œé€’å½’æ£€æŸ¥å­é¡¹
            for (int i = 0; i < menuComponent.getChild(i) != null; i++) {
                try {
                    MenuComponent child = menuComponent.getChild(i);
                    printVegetarianMenu(child, depth + 1);
                } catch (IndexOutOfBoundsException e) {
                    break;
                }
            }
        }
    }
}
```

æ­¤ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªé¤å…èœå•ç³»ç»Ÿï¼Œä½¿ç”¨ç»„åˆæ¨¡å¼æ¥è¡¨ç¤ºèœå•å’Œèœå•é¡¹ã€‚èœå•å¯ä»¥åŒ…å«å­èœå•å’Œèœå•é¡¹ï¼Œè€Œèœå•é¡¹æ˜¯å¶å­èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯å¯ä»¥é€’å½’åœ°éå†æ•´ä¸ªèœå•ç»“æ„ã€‚

</TabItem>
<TabItem value="organization" label="ç»„ç»‡æ¶æ„">

```java title="ç»„ç»‡æ¶æ„"
// ç»„ç»‡ç»„ä»¶
public abstract class OrganizationComponent {
    protected String name;
    protected String description;
    
    public OrganizationComponent(String name, String description) {
        this.name = name;
        this.description = description;
    }
    
    public String getName() {
        return name;
    }
    
    public String getDescription() {
        return description;
    }
    
    public abstract void add(OrganizationComponent component);
    public abstract void remove(OrganizationComponent component);
    public abstract void display(int depth);
    public abstract int getEmployeeCount();
}

// å‘˜å·¥ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
public class Employee extends OrganizationComponent {
    private String position;
    private double salary;
    
    public Employee(String name, String position, double salary) {
        super(name, "å‘˜å·¥: " + position);
        this.position = position;
        this.salary = salary;
    }
    
    public String getPosition() {
        return position;
    }
    
    public double getSalary() {
        return salary;
    }
    
    @Override
    public void add(OrganizationComponent component) {
        throw new UnsupportedOperationException("å‘˜å·¥æ— æ³•æ·»åŠ ä¸‹å±");
    }
    
    @Override
    public void remove(OrganizationComponent component) {
        throw new UnsupportedOperationException("å‘˜å·¥æ— æ³•ç§»é™¤ä¸‹å±");
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "ğŸ‘¤ " + getName() + " - " + getPosition() + " (è–ªèµ„: " + salary + ")");
    }
    
    @Override
    public int getEmployeeCount() {
        return 1;
    }
}

// éƒ¨é—¨ï¼ˆç»„åˆèŠ‚ç‚¹ï¼‰
public class Department extends OrganizationComponent {
    private List<OrganizationComponent> subordinates = new ArrayList<>();
    
    public Department(String name, String description) {
        super(name, description);
    }
    
    @Override
    public void add(OrganizationComponent component) {
        subordinates.add(component);
    }
    
    @Override
    public void remove(OrganizationComponent component) {
        subordinates.remove(component);
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "ğŸ¢ " + getName() + " - " + getDescription() + 
                          " (å‘˜å·¥æ•°: " + getEmployeeCount() + ")");
        
        for (OrganizationComponent component : subordinates) {
            component.display(depth + 1);
        }
    }
    
    @Override
    public int getEmployeeCount() {
        return subordinates.stream()
                .mapToInt(OrganizationComponent::getEmployeeCount)
                .sum();
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class OrganizationDemo {
    public static void main(String[] args) {
        // åˆ›å»ºç»„ç»‡æ¶æ„
        OrganizationComponent company = new Department("ç§‘æŠ€å…¬å¸", "ä¸€å®¶åˆ›æ–°ç§‘æŠ€å…¬å¸");
        
        // åˆ›å»ºéƒ¨é—¨
        OrganizationComponent rd = new Department("ç ”å‘éƒ¨", "è´Ÿè´£äº§å“å¼€å‘");
        OrganizationComponent marketing = new Department("å¸‚åœºéƒ¨", "è´Ÿè´£å¸‚åœºè¥é”€");
        OrganizationComponent finance = new Department("è´¢åŠ¡éƒ¨", "è´Ÿè´£è´¢åŠ¡ç®¡ç†");
        
        // æ·»åŠ éƒ¨é—¨åˆ°å…¬å¸
        company.add(rd);
        company.add(marketing);
        company.add(finance);
        
        // åˆ›å»ºç ”å‘å­éƒ¨é—¨
        OrganizationComponent frontend = new Department("å‰ç«¯ç»„", "è´Ÿè´£å‰ç«¯å¼€å‘");
        OrganizationComponent backend = new Department("åç«¯ç»„", "è´Ÿè´£åç«¯å¼€å‘");
        
        // æ·»åŠ ç ”å‘å­éƒ¨é—¨
        rd.add(frontend);
        rd.add(backend);
        
        // æ·»åŠ å‘˜å·¥åˆ°å‰ç«¯ç»„
        frontend.add(new Employee("å¼ ä¸‰", "é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ", 20000));
        frontend.add(new Employee("æå››", "å‰ç«¯å·¥ç¨‹å¸ˆ", 15000));
        frontend.add(new Employee("ç‹äº”", "åˆçº§å‰ç«¯å·¥ç¨‹å¸ˆ", 10000));
        
        // æ·»åŠ å‘˜å·¥åˆ°åç«¯ç»„
        backend.add(new Employee("èµµå…­", "é«˜çº§åç«¯å·¥ç¨‹å¸ˆ", 22000));
        backend.add(new Employee("é’±ä¸ƒ", "åç«¯å·¥ç¨‹å¸ˆ", 16000));
        
        // æ·»åŠ å‘˜å·¥åˆ°å¸‚åœºéƒ¨
        marketing.add(new Employee("å­™å…«", "å¸‚åœºæ€»ç›‘", 25000));
        marketing.add(new Employee("å‘¨ä¹", "å¸‚åœºä¸“å‘˜", 12000));
        
        // æ·»åŠ å‘˜å·¥åˆ°è´¢åŠ¡éƒ¨
        finance.add(new Employee("å´å", "è´¢åŠ¡æ€»ç›‘", 24000));
        finance.add(new Employee("éƒ‘åä¸€", "ä¼šè®¡", 14000));
        
        // æ˜¾ç¤ºæ•´ä¸ªç»„ç»‡æ¶æ„
        company.display(0);
        
        // æ˜¾ç¤ºç ”å‘éƒ¨æ¶æ„
        System.out.println("\nç ”å‘éƒ¨æ¶æ„:");
        rd.display(0);
        
        // æ˜¾ç¤ºå‘˜å·¥æ€»æ•°
        System.out.println("\nå…¬å¸æ€»å‘˜å·¥æ•°: " + company.getEmployeeCount());
        System.out.println("ç ”å‘éƒ¨å‘˜å·¥æ•°: " + rd.getEmployeeCount());
    }
}
```

è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªç»„ç»‡æ¶æ„ç³»ç»Ÿï¼Œä½¿ç”¨ç»„åˆæ¨¡å¼æ¥è¡¨ç¤ºå…¬å¸çš„éƒ¨é—¨å±‚çº§ç»“æ„ã€‚éƒ¨é—¨å¯ä»¥åŒ…å«å­éƒ¨é—¨å’Œå‘˜å·¥ï¼Œè€Œå‘˜å·¥æ˜¯å¶å­èŠ‚ç‚¹ã€‚é€šè¿‡ç»„åˆæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è®¡ç®—ä»»ä½•çº§åˆ«çš„å‘˜å·¥æ•°é‡ã€‚

</TabItem>
</Tabs>

### 3.5 ç»„åˆæ¨¡å¼çš„å®ç°è€ƒé‡

#### å®‰å…¨æ€§ä¸é€æ˜æ€§çš„æƒè¡¡

åœ¨ç»„åˆæ¨¡å¼å®ç°ä¸­ï¼Œéœ€è¦æƒè¡¡å®‰å…¨æ€§å’Œé€æ˜æ€§ï¼š

1. **é€æ˜æ€§**ï¼šæŠ½è±¡ç»„ä»¶ä¸­å®šä¹‰æ‰€æœ‰æ“ä½œï¼Œä½¿å®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç†
   - ä¼˜ç‚¹ï¼šå®¢æˆ·ç«¯ä»£ç ç®€å•ï¼Œä¸éœ€è¦åŒºåˆ†å¶å­å’Œç»„åˆèŠ‚ç‚¹
   - ç¼ºç‚¹ï¼šå¶å­èŠ‚ç‚¹å¿…é¡»å®ç°ä¸é€‚ç”¨çš„æ–¹æ³•ï¼Œè¿åæ¥å£éš”ç¦»åŸåˆ™

2. **å®‰å…¨æ€§**ï¼šæŠ½è±¡ç»„ä»¶åªå®šä¹‰å…±åŒæ“ä½œï¼Œç®¡ç†å­ç»„ä»¶çš„æ–¹æ³•åªåœ¨ç»„åˆèŠ‚ç‚¹ä¸­å®šä¹‰
   - ä¼˜ç‚¹ï¼šå¶å­èŠ‚ç‚¹ä¸éœ€è¦å®ç°ä¸é€‚ç”¨çš„æ–¹æ³•
   - ç¼ºç‚¹ï¼šå®¢æˆ·ç«¯éœ€è¦åŒºåˆ†å¶å­å’Œç»„åˆèŠ‚ç‚¹ï¼Œå¢åŠ ç±»å‹æ£€æŸ¥

#### åº”å¯¹å¸¸è§æŒ‘æˆ˜

1. **ç»„ä»¶æ’åº**ï¼šä¸ºäº†æ”¯æŒç»„ä»¶æ’åºï¼Œå¯ä»¥åœ¨Componentä¸­æ·»åŠ getOrder()å’ŒsetOrder()æ–¹æ³•
2. **è®¿é—®çˆ¶ç»„ä»¶**ï¼šåœ¨éœ€è¦å‘ä¸Šéå†çš„åœºæ™¯ä¸­ï¼Œå¯ä»¥åœ¨Componentä¸­æ·»åŠ å¯¹çˆ¶ç»„ä»¶çš„å¼•ç”¨
3. **ç¼“å­˜ä¼˜åŒ–**ï¼šä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥ç¼“å­˜ç»„åˆèŠ‚ç‚¹çš„è®¡ç®—ç»“æœï¼Œå¦‚å¤§å°ã€è®¡æ•°ç­‰

```java title="å¸¦ç¼“å­˜çš„ç»„åˆæ¨¡å¼"
public class CachingComposite extends Component {
    private List<Component> children = new ArrayList<>();
    private long cachedSize = -1;
    private boolean dirty = true;
    
    @Override
    public long getSize() {
        if (dirty) {
            cachedSize = calculateSize();
            dirty = false;
        }
        return cachedSize;
    }
    
    private long calculateSize() {
        return children.stream().mapToLong(Component::getSize).sum();
    }
    
    @Override
    public void add(Component component) {
        children.add(component);
        dirty = true;
    }
    
    @Override
    public void remove(Component component) {
        children.remove(component);
        dirty = true;
    }
}
```

:::tip ç»„åˆæ¨¡å¼æœ€ä½³å®è·µ
1. **å†³å®šå®‰å…¨æ€§ä¸é€æ˜æ€§**ï¼šæ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œé€‰æ‹©é€æ˜æ€§æˆ–å®‰å…¨æ€§å®ç°
2. **ç»„ä»¶æ’åº**ï¼šéœ€è¦æ’åºæ—¶ï¼Œæ·»åŠ æ’åºç›¸å…³æ–¹æ³•å’Œå±æ€§
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯¹é¢‘ç¹è®¿é—®çš„å±æ€§ä½¿ç”¨ç¼“å­˜ç­–ç•¥
4. **è®¿é—®æ§åˆ¶**ï¼šè€ƒè™‘æ˜¯å¦éœ€è¦çˆ¶èŠ‚ç‚¹å¼•ç”¨ï¼Œä»¥åŠè®¿é—®æ§åˆ¶ç­–ç•¥
5. **è¿­ä»£å™¨å®ç°**ï¼šæä¾›éå†ç»„åˆç»“æ„çš„è¿­ä»£å™¨ï¼Œç®€åŒ–å®¢æˆ·ç«¯ä»£ç 
:::

## 4. è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰

### 4.1 æ¨¡å¼å®šä¹‰

è£…é¥°å™¨æ¨¡å¼åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ é¢å¤–çš„èŒè´£ï¼Œæ˜¯ç»§æ‰¿çš„ä¸€ç§çµæ´»æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒé€šè¿‡ç»„åˆè€Œéç»§æ‰¿æ¥æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œåœ¨ä¸ä¿®æ”¹åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ä¸ºå…¶æ·»åŠ æ–°çš„è¡Œä¸ºã€‚

```mermaid
graph TD
    A[Component<br>ç»„ä»¶æ¥å£] <-- å®ç° --> B[ConcreteComponent<br>å…·ä½“ç»„ä»¶]
    A <-- å®ç° --> C[Decorator<br>æŠ½è±¡è£…é¥°å™¨]
    C <-- ç»§æ‰¿ --> D[ConcreteDecoratorA<br>å…·ä½“è£…é¥°å™¨A]
    C <-- ç»§æ‰¿ --> E[ConcreteDecoratorB<br>å…·ä½“è£…é¥°å™¨B]
    C -->|è£…é¥°| A
    
    style A fill:#f9f9f9,stroke:#333,stroke-width:2px
    style B fill:#f6ffed,stroke:#52c41a
    style C fill:#f9f9f9,stroke:#333,stroke-width:2px
    style D fill:#e6f7ff,stroke:#1890ff
    style E fill:#e6f7ff,stroke:#1890ff
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **åŠ¨æ€æ‰©å±•åŠŸèƒ½**ï¼šåœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ èŒè´£
- **é¿å…å­ç±»çˆ†ç‚¸**ï¼šå½“ä½¿ç”¨ç»§æ‰¿ä¼šå¯¼è‡´å­ç±»æ•°é‡å‰§å¢æ—¶
- **è¿è¡Œæ—¶é…ç½®**ï¼šéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ç»„åˆå¤šç§è¡Œä¸º
- **è´£ä»»é“¾æ„å»º**ï¼šéœ€è¦æ„å»ºå¤šå±‚æ¬¡çš„è´£ä»»é“¾

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **çµæ´»æ€§å¼º**ï¼šæ¯”ç»§æ‰¿æ›´åŠ çµæ´»ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤èŒè´£
- **éµå¾ªå¼€é—­åŸåˆ™**ï¼šæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç å³å¯æ‰©å±•åŠŸèƒ½
- **å±‚æ¬¡ç»“æ„æ¸…æ™°**ï¼šæ¯ä¸ªè£…é¥°å™¨ä¸“æ³¨äºå•ä¸€èŒè´£
- **è¿è¡Œæ—¶ç»„åˆ**ï¼šæ”¯æŒåœ¨è¿è¡Œæ—¶ç»„åˆå¤šç§è¡Œä¸º

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **å°å¯¹è±¡æ•°é‡å¤š**ï¼šä¼šåˆ›å»ºå¾ˆå¤šå°å¯¹è±¡ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- **è°ƒè¯•å›°éš¾**ï¼šå¤šå±‚è£…é¥°ä½¿å¾—è°ƒè¯•å˜å¾—å¤æ‚
- **è¿‡åº¦ä½¿ç”¨**ï¼šå¯èƒ½å¯¼è‡´ç³»ç»Ÿéš¾ä»¥ç†è§£å’Œç»´æŠ¤
- **å¤æ‚é…ç½®**ï¼šç»„åˆè£…é¥°å™¨çš„é¡ºåºå¯èƒ½ä¼šå½±å“æœ€ç»ˆè¡Œä¸º

</TabItem>
</Tabs>

### 4.2 è£…é¥°å™¨æ¨¡å¼ç»“æ„

```java title="è£…é¥°å™¨æ¨¡å¼ç»“æ„"
// ç»„ä»¶æ¥å£
public interface Component {
    void operation();
}

// å…·ä½“ç»„ä»¶
public class ConcreteComponent implements Component {
    @Override
    public void operation() {
        System.out.println("å…·ä½“ç»„ä»¶çš„æ“ä½œ");
    }
}

// æŠ½è±¡è£…é¥°å™¨
public abstract class Decorator implements Component {
    protected Component component;
    
    public Decorator(Component component) {
        this.component = component;
    }
    
    @Override
    public void operation() {
        component.operation();
    }
}

// å…·ä½“è£…é¥°å™¨A
public class ConcreteDecoratorA extends Decorator {
    public ConcreteDecoratorA(Component component) {
        super(component);
    }
    
    @Override
    public void operation() {
        super.operation();
        addedBehavior();
    }
    
    private void addedBehavior() {
        System.out.println("è£…é¥°å™¨Aæ·»åŠ çš„è¡Œä¸º");
    }
}

// å…·ä½“è£…é¥°å™¨B
public class ConcreteDecoratorB extends Decorator {
    public ConcreteDecoratorB(Component component) {
        super(component);
    }
    
    @Override
    public void operation() {
        System.out.println("è£…é¥°å™¨Bçš„å‰ç½®å¤„ç†");
        super.operation();
        System.out.println("è£…é¥°å™¨Bçš„åç½®å¤„ç†");
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class DecoratorPatternDemo {
    public static void main(String[] args) {
        // åˆ›å»ºå…·ä½“ç»„ä»¶
        Component component = new ConcreteComponent();
        
        // ç”¨è£…é¥°å™¨Aè£…é¥°
        Component decoratedA = new ConcreteDecoratorA(component);
        decoratedA.operation();
        
        System.out.println("\n==================\n");
        
        // ç”¨è£…é¥°å™¨Bè£…é¥°
        Component decoratedB = new ConcreteDecoratorB(component);
        decoratedB.operation();
        
        System.out.println("\n==================\n");
        
        // å¤šå±‚è£…é¥°ï¼šå…ˆç”¨Aè£…é¥°ï¼Œå†ç”¨Bè£…é¥°
        Component decoratedBA = new ConcreteDecoratorB(
            new ConcreteDecoratorA(component)
        );
        decoratedBA.operation();
    }
}
```

### 4.3 åº”ç”¨åœºæ™¯

<Tabs>
<TabItem value="io-streams" label="IOæµè£…é¥°å™¨">

```java title="Java IOæµè£…é¥°å™¨"
// åŸºç¡€è¾“å…¥æµæ¥å£
public interface DataSource {
    String read();
    void write(String data);
}

// å…·ä½“ç»„ä»¶ï¼šæ–‡ä»¶æ•°æ®æº
public class FileDataSource implements DataSource {
    private String filename;
    
    public FileDataSource(String filename) {
        this.filename = filename;
    }
    
    @Override
    public String read() {
        System.out.println("ä»æ–‡ä»¶è¯»å–æ•°æ®: " + filename);
        return "æ–‡ä»¶å†…å®¹";
    }
    
    @Override
    public void write(String data) {
        System.out.println("å‘æ–‡ä»¶å†™å…¥æ•°æ®: " + filename);
        System.out.println("å†…å®¹: " + data);
    }
}

// æŠ½è±¡è£…é¥°å™¨
public abstract class DataSourceDecorator implements DataSource {
    protected DataSource wrappee;
    
    public DataSourceDecorator(DataSource source) {
        this.wrappee = source;
    }
    
    @Override
    public String read() {
        return wrappee.read();
    }
    
    @Override
    public void write(String data) {
        wrappee.write(data);
    }
}

// åŠ å¯†è£…é¥°å™¨
public class EncryptionDecorator extends DataSourceDecorator {
    public EncryptionDecorator(DataSource source) {
        super(source);
    }
    
    @Override
    public String read() {
        String data = super.read();
        return decrypt(data);
    }
    
    @Override
    public void write(String data) {
        super.write(encrypt(data));
    }
    
    private String encrypt(String data) {
        // ç®€å•çš„åŠ å¯†å®ç°ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„ç®—æ³•ï¼‰
        System.out.println("åº”ç”¨åŠ å¯†");
        StringBuilder result = new StringBuilder();
        for (char c : data.toCharArray()) {
            result.append((char) (c + 1)); // ç®€å•ä½ç§»åŠ å¯†
        }
        return result.toString();
    }
    
    private String decrypt(String data) {
        // è§£å¯†å®ç°
        System.out.println("åº”ç”¨è§£å¯†");
        StringBuilder result = new StringBuilder();
        for (char c : data.toCharArray()) {
            result.append((char) (c - 1));
        }
        return result.toString();
    }
}

// å‹ç¼©è£…é¥°å™¨
public class CompressionDecorator extends DataSourceDecorator {
    public CompressionDecorator(DataSource source) {
        super(source);
    }
    
    @Override
    public String read() {
        String data = super.read();
        return decompress(data);
    }
    
    @Override
    public void write(String data) {
        super.write(compress(data));
    }
    
    private String compress(String data) {
        // ç®€å•çš„å‹ç¼©å®ç°ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨çœŸå®çš„å‹ç¼©ç®—æ³•ï¼‰
        System.out.println("åº”ç”¨å‹ç¼©");
        return data.replaceAll("\\s+", ""); // ç®€å•åœ°åˆ é™¤æ‰€æœ‰ç©ºç™½å­—ç¬¦
    }
    
    private String decompress(String data) {
        // è§£å‹ç¼©å®ç°
        System.out.println("åº”ç”¨è§£å‹ç¼©");
        return data; // ç®€åŒ–ç¤ºä¾‹
    }
}

// ç¼“å†²è£…é¥°å™¨
public class BufferedDecorator extends DataSourceDecorator {
    private StringBuilder buffer = new StringBuilder();
    
    public BufferedDecorator(DataSource source) {
        super(source);
    }
    
    @Override
    public String read() {
        System.out.println("ä»ç¼“å†²åŒºè¯»å–");
        if (buffer.length() == 0) {
            buffer.append(super.read());
        }
        return buffer.toString();
    }
    
    @Override
    public void write(String data) {
        System.out.println("ä½¿ç”¨ç¼“å†²å†™å…¥");
        buffer.append(data);
        if (buffer.length() >= 1024) { // å‡è®¾ç¼“å†²åŒºå¤§å°ä¸º1024
            flush();
        }
    }
    
    public void flush() {
        System.out.println("åˆ·æ–°ç¼“å†²åŒº");
        super.write(buffer.toString());
        buffer.setLength(0);
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class IODecoratorDemo {
    public static void main(String[] args) {
        // åŸºç¡€æ•°æ®æº
        DataSource source = new FileDataSource("data.txt");
        
        // ç”¨åŠ å¯†è£…é¥°
        DataSource encrypted = new EncryptionDecorator(source);
        encrypted.write("è¿™æ˜¯åŠ å¯†çš„æ•°æ®");
        System.out.println(encrypted.read());
        
        System.out.println("\n==================\n");
        
        // å¤šå±‚è£…é¥°ï¼šå‹ç¼© + åŠ å¯†
        DataSource compressedEncrypted = new CompressionDecorator(
            new EncryptionDecorator(source)
        );
        compressedEncrypted.write("è¿™æ˜¯å‹ç¼©å¹¶åŠ å¯†çš„æ•°æ®");
        System.out.println(compressedEncrypted.read());
        
        System.out.println("\n==================\n");
        
        // å¤šå±‚è£…é¥°ï¼šç¼“å†² + å‹ç¼© + åŠ å¯†
        DataSource bufferedCompressedEncrypted = new BufferedDecorator(
            new CompressionDecorator(
                new EncryptionDecorator(source)
            )
        );
        bufferedCompressedEncrypted.write("è¿™æ˜¯ç¼“å†²ã€å‹ç¼©å¹¶åŠ å¯†çš„æ•°æ®");
        System.out.println(bufferedCompressedEncrypted.read());
        
        // åˆ·æ–°ç¼“å†²åŒº
        ((BufferedDecorator)bufferedCompressedEncrypted).flush();
    }
}
```

Javaçš„I/Oæµåº“æ˜¯è£…é¥°å™¨æ¨¡å¼çš„ç»å…¸åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„æµè£…é¥°å™¨æ¥åˆ›å»ºå…·æœ‰å¤šç§åŠŸèƒ½çš„æµï¼š
```java
// åˆ›å»ºä¸€ä¸ªå¸¦ç¼“å†²ã€å‹ç¼©å’ŒåŠ å¯†åŠŸèƒ½çš„æ–‡ä»¶è¾“å…¥æµ
InputStream input = new BufferedInputStream(
    new GZIPInputStream(
        new CipherInputStream(
            new FileInputStream("data.gz"), 
            getCipher()
        )
    )
);
```

</TabItem>
<TabItem value="ui-components" label="UIç»„ä»¶è£…é¥°å™¨">

```java title="UIç»„ä»¶è£…é¥°å™¨"
// åŸºç¡€UIç»„ä»¶æ¥å£
public interface UIComponent {
    void draw();
    String getDescription();
}

// å…·ä½“UIç»„ä»¶
public class TextField implements UIComponent {
    @Override
    public void draw() {
        System.out.println("ç»˜åˆ¶æ–‡æœ¬æ¡†");
    }
    
    @Override
    public String getDescription() {
        return "æ–‡æœ¬æ¡†";
    }
}

public class Button implements UIComponent {
    @Override
    public void draw() {
        System.out.println("ç»˜åˆ¶æŒ‰é’®");
    }
    
    @Override
    public String getDescription() {
        return "æŒ‰é’®";
    }
}

// UIè£…é¥°å™¨æŠ½è±¡ç±»
public abstract class UIDecorator implements UIComponent {
    protected UIComponent component;
    
    public UIDecorator(UIComponent component) {
        this.component = component;
    }
    
    @Override
    public void draw() {
        component.draw();
    }
    
    @Override
    public String getDescription() {
        return component.getDescription();
    }
}

// è¾¹æ¡†è£…é¥°å™¨
public class BorderDecorator extends UIDecorator {
    private int borderWidth;
    private String borderColor;
    
    public BorderDecorator(UIComponent component, int borderWidth, String borderColor) {
        super(component);
        this.borderWidth = borderWidth;
        this.borderColor = borderColor;
    }
    
    @Override
    public void draw() {
        super.draw();
        System.out.println("æ·»åŠ è¾¹æ¡†: å®½åº¦=" + borderWidth + ", é¢œè‰²=" + borderColor);
    }
    
    @Override
    public String getDescription() {
        return super.getDescription() + " å¸¦" + borderColor + "è¾¹æ¡†";
    }
}

// æ»šåŠ¨æ¡è£…é¥°å™¨
public class ScrollBarDecorator extends UIDecorator {
    private String orientation;
    
    public ScrollBarDecorator(UIComponent component, String orientation) {
        super(component);
        this.orientation = orientation;
    }
    
    @Override
    public void draw() {
        super.draw();
        System.out.println("æ·»åŠ " + orientation + "æ»šåŠ¨æ¡");
    }
    
    @Override
    public String getDescription() {
        return super.getDescription() + " å¸¦" + orientation + "æ»šåŠ¨æ¡";
    }
}

// å·¥å…·æç¤ºè£…é¥°å™¨
public class TooltipDecorator extends UIDecorator {
    private String tooltipText;
    
    public TooltipDecorator(UIComponent component, String tooltipText) {
        super(component);
        this.tooltipText = tooltipText;
    }
    
    @Override
    public void draw() {
        super.draw();
        System.out.println("æ·»åŠ å·¥å…·æç¤º: " + tooltipText);
    }
    
    @Override
    public String getDescription() {
        return super.getDescription() + " å¸¦å·¥å…·æç¤º";
    }
    
    public void showTooltip() {
        System.out.println("æ˜¾ç¤ºå·¥å…·æç¤º: " + tooltipText);
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class UIDecoratorDemo {
    public static void main(String[] args) {
        // åˆ›å»ºåŸºç¡€ç»„ä»¶
        UIComponent textField = new TextField();
        UIComponent button = new Button();
        
        System.out.println("åŸºç¡€ç»„ä»¶:");
        System.out.println("ç»„ä»¶æè¿°: " + textField.getDescription());
        textField.draw();
        System.out.println();
        
        // æ·»åŠ è¾¹æ¡†è£…é¥°
        UIComponent borderedTextField = new BorderDecorator(textField, 2, "è“è‰²");
        System.out.println("è£…é¥°åçš„ç»„ä»¶:");
        System.out.println("ç»„ä»¶æè¿°: " + borderedTextField.getDescription());
        borderedTextField.draw();
        System.out.println();
        
        // å¤šå±‚è£…é¥°ï¼šè¾¹æ¡† + æ»šåŠ¨æ¡
        UIComponent scrollableBorderedTextField = new ScrollBarDecorator(
            new BorderDecorator(textField, 2, "è“è‰²"),
            "å‚ç›´"
        );
        System.out.println("å¤šå±‚è£…é¥°çš„ç»„ä»¶:");
        System.out.println("ç»„ä»¶æè¿°: " + scrollableBorderedTextField.getDescription());
        scrollableBorderedTextField.draw();
        System.out.println();
        
        // å¤šå±‚è£…é¥°ï¼šè¾¹æ¡† + å·¥å…·æç¤º + æŒ‰é’®
        UIComponent decoratedButton = new TooltipDecorator(
            new BorderDecorator(button, 1, "çº¢è‰²"),
            "ç‚¹å‡»æäº¤è¡¨å•"
        );
        System.out.println("è£…é¥°åçš„æŒ‰é’®:");
        System.out.println("ç»„ä»¶æè¿°: " + decoratedButton.getDescription());
        decoratedButton.draw();
        
        // ä½¿ç”¨ç‰¹å®šè£…é¥°å™¨çš„æ–¹æ³•
        if (decoratedButton instanceof TooltipDecorator) {
            ((TooltipDecorator) decoratedButton).showTooltip();
        }
    }
}
```

</TabItem>
<TabItem value="coffee-shop" label="å’–å•¡åº—ç‚¹å•ç³»ç»Ÿ">

```java title="å’–å•¡åº—ç‚¹å•ç³»ç»Ÿ"
// åŸºç¡€é¥®æ–™æ¥å£
public interface Beverage {
    String getDescription();
    double cost();
}

// å…·ä½“é¥®æ–™ç±»
public class Espresso implements Beverage {
    @Override
    public String getDescription() {
        return "æµ“ç¼©å’–å•¡";
    }
    
    @Override
    public double cost() {
        return 15.0;
    }
}

public class HouseBlend implements Beverage {
    @Override
    public String getDescription() {
        return "ç»¼åˆå’–å•¡";
    }
    
    @Override
    public double cost() {
        return 12.0;
    }
}

public class DarkRoast implements Beverage {
    @Override
    public String getDescription() {
        return "æ·±åº¦çƒ˜ç„™å’–å•¡";
    }
    
    @Override
    public double cost() {
        return 13.0;
    }
}

// è°ƒæ–™è£…é¥°å™¨æŠ½è±¡ç±»
public abstract class CondimentDecorator implements Beverage {
    protected Beverage beverage;
    
    public CondimentDecorator(Beverage beverage) {
        this.beverage = beverage;
    }
    
    @Override
    public String getDescription() {
        return beverage.getDescription();
    }
}

// ç‰›å¥¶è£…é¥°å™¨
public class Milk extends CondimentDecorator {
    public Milk(Beverage beverage) {
        super(beverage);
    }
    
    @Override
    public String getDescription() {
        return beverage.getDescription() + ", ç‰›å¥¶";
    }
    
    @Override
    public double cost() {
        return beverage.cost() + 2.0;
    }
}

// æ‘©å¡è£…é¥°å™¨
public class Mocha extends CondimentDecorator {
    public Mocha(Beverage beverage) {
        super(beverage);
    }
    
    @Override
    public String getDescription() {
        return beverage.getDescription() + ", æ‘©å¡";
    }
    
    @Override
    public double cost() {
        return beverage.cost() + 3.0;
    }
}

// å¥¶æ³¡è£…é¥°å™¨
public class Whip extends CondimentDecorator {
    public Whip(Beverage beverage) {
        super(beverage);
    }
    
    @Override
    public String getDescription() {
        return beverage.getDescription() + ", å¥¶æ³¡";
    }
    
    @Override
    public double cost() {
        return beverage.cost() + 1.5;
    }
}

// å¤§è±†å¥¶è£…é¥°å™¨
public class Soy extends CondimentDecorator {
    public Soy(Beverage beverage) {
        super(beverage);
    }
    
    @Override
    public String getDescription() {
        return beverage.getDescription() + ", å¤§è±†å¥¶";
    }
    
    @Override
    public double cost() {
        return beverage.cost() + 1.5;
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class CoffeeShopDemo {
    public static void main(String[] args) {
        // ç‚¹ä¸€æ¯æµ“ç¼©å’–å•¡
        Beverage beverage1 = new Espresso();
        System.out.println(beverage1.getDescription() + " Â¥" + beverage1.cost());
        
        // ç‚¹ä¸€æ¯æ·±åº¦çƒ˜ç„™å’–å•¡ï¼ŒåŠ åŒå€æ‘©å¡å’Œå¥¶æ³¡
        Beverage beverage2 = new DarkRoast();
        beverage2 = new Mocha(beverage2);  // åŠ æ‘©å¡
        beverage2 = new Mocha(beverage2);  // å†åŠ ä¸€ä»½æ‘©å¡
        beverage2 = new Whip(beverage2);   // åŠ å¥¶æ³¡
        System.out.println(beverage2.getDescription() + " Â¥" + beverage2.cost());
        
        // ç‚¹ä¸€æ¯ç»¼åˆå’–å•¡ï¼ŒåŠ å¤§è±†å¥¶ã€æ‘©å¡å’Œå¥¶æ³¡
        Beverage beverage3 = new HouseBlend();
        beverage3 = new Soy(beverage3);    // åŠ å¤§è±†å¥¶
        beverage3 = new Mocha(beverage3);  // åŠ æ‘©å¡
        beverage3 = new Whip(beverage3);   // åŠ å¥¶æ³¡
        System.out.println(beverage3.getDescription() + " Â¥" + beverage3.cost());
    }
}
```

</TabItem>
</Tabs>

### 4.4 è£…é¥°å™¨æ¨¡å¼ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | è£…é¥°å™¨æ¨¡å¼ | ä»£ç†æ¨¡å¼ | ç»„åˆæ¨¡å¼ | ç­–ç•¥æ¨¡å¼ |
|------|-----------|---------|---------|---------|
| **ç›®çš„** | åŠ¨æ€æ·»åŠ åŠŸèƒ½ | æ§åˆ¶å¯¹è±¡è®¿é—® | ç»„ç»‡æ ‘å½¢ç»“æ„ | å°è£…å¯æ›¿æ¢ç®—æ³• |
| **å…³ç³»ç±»å‹** | åŒ…è£…å…³ç³» | ä»£è¡¨å…³ç³» | åŒ…å«å…³ç³» | ç»„åˆå…³ç³» |
| **é€æ˜æ€§** | å¯¹å®¢æˆ·ç«¯é€æ˜ | å¯¹å®¢æˆ·ç«¯é€æ˜ | å¯¹å®¢æˆ·ç«¯é€æ˜ | éœ€è¦æ˜¾å¼é€‰æ‹© |
| **è¿è¡Œæ—¶å˜åŒ–** | å¯åŠ¨æ€æ·»åŠ èŒè´£ | é€šå¸¸å›ºå®š | å¯åŠ¨æ€ç»„åˆ | å¯åŠ¨æ€æ›¿æ¢ |
| **æ¥å£å¢å¼º** | å¯å¢å¼ºæ¥å£ | é€šå¸¸ç›¸åŒæ¥å£ | ç»Ÿä¸€æ¥å£ | å®Œå…¨æ›¿æ¢å®ç° |

### 4.5 è£…é¥°å™¨æ¨¡å¼å®ç°è¦ç‚¹

#### é€æ˜æ€§ä¸éé€æ˜æ€§è£…é¥°å™¨

1. **é€æ˜æ€§è£…é¥°å™¨**ï¼šè£…é¥°å™¨å®Œå…¨å®ç°ç»„ä»¶æ¥å£ï¼Œå¯¹å®¢æˆ·ç«¯é€æ˜
   ```java
   // é€æ˜è£…é¥°å™¨ç¤ºä¾‹
   Component component = new ConcreteComponent();
   component = new ConcreteDecoratorA(component);
   component = new ConcreteDecoratorB(component);
   component.operation(); // å®¢æˆ·ç«¯ä»…ä½¿ç”¨Componentæ¥å£
   ```

2. **éé€æ˜æ€§è£…é¥°å™¨**ï¼šè£…é¥°å™¨æ·»åŠ äº†åŸç»„ä»¶æ²¡æœ‰çš„æ–°æ–¹æ³•
   ```java
   // éé€æ˜è£…é¥°å™¨ç¤ºä¾‹
   public class LoggingDecorator extends Decorator {
       public LoggingDecorator(Component component) {
           super(component);
       }
       
       @Override
       public void operation() {
           super.operation();
       }
       
       // æ–°å¢æ–¹æ³•
       public void enableLogging() {
           System.out.println("å¯ç”¨æ—¥å¿—è®°å½•");
       }
   }
   
   // å®¢æˆ·ç«¯éœ€è¦çŸ¥é“å…·ä½“è£…é¥°å™¨ç±»å‹
   LoggingDecorator decorator = new LoggingDecorator(new ConcreteComponent());
   decorator.operation();
   decorator.enableLogging(); // è°ƒç”¨è£…é¥°å™¨ç‰¹æœ‰æ–¹æ³•
   ```

#### è£…é¥°é¡ºåºå½±å“

è£…é¥°å™¨çš„åº”ç”¨é¡ºåºå¯èƒ½ä¼šå½±å“æœ€ç»ˆç»“æœï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¾èµ–æ‰§è¡Œé¡ºåºçš„æ“ä½œã€‚

```java
// é¡ºåº1ï¼šå…ˆå‹ç¼©ååŠ å¯†
DataSource compressedEncrypted = new EncryptionDecorator(new CompressionDecorator(source));

// é¡ºåº2ï¼šå…ˆåŠ å¯†åå‹ç¼©
DataSource encryptedCompressed = new CompressionDecorator(new EncryptionDecorator(source));
```

:::tip è£…é¥°å™¨æ¨¡å¼æœ€ä½³å®è·µ
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªè£…é¥°å™¨åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼Œä¿æŒç®€å•æ˜ç¡®
2. **åŸºç±»ç¨³å®š**ï¼šç¡®ä¿ç»„ä»¶æ¥å£ç¨³å®šï¼Œé¿å…é¢‘ç¹å˜åŒ–
3. **æ³¨æ„æ€§èƒ½**ï¼šè£…é¥°å™¨åµŒå¥—å±‚æ¬¡è¿‡å¤šå¯èƒ½å½±å“æ€§èƒ½
4. **é¡ºåºæ•æ„Ÿæ€§**ï¼šæ³¨æ„è£…é¥°å™¨çš„åº”ç”¨é¡ºåºå¯¹ç»“æœçš„å½±å“
5. **é¿å…è¿‡åº¦è£…é¥°**ï¼šè¿‡å¤šçš„è£…é¥°å±‚ä¼šä½¿ç³»ç»Ÿéš¾ä»¥ç†è§£å’Œè°ƒè¯•
:::

## 5. å¤–è§‚æ¨¡å¼ï¼ˆFacadeï¼‰

### 5.1 æ¨¡å¼å®šä¹‰

å¤–è§‚æ¨¡å¼ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„é«˜å±‚æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä½¿å¾—å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è®¿é—®ï¼Œé™ä½äº†å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„è€¦åˆåº¦ã€‚

```mermaid
graph TD
    A[å®¢æˆ·ç«¯] -->|ä½¿ç”¨| B[å¤–è§‚<br>Facade]
    B -->|è°ƒç”¨| C[å­ç³»ç»ŸA]
    B -->|è°ƒç”¨| D[å­ç³»ç»ŸB]
    B -->|è°ƒç”¨| E[å­ç³»ç»ŸC]
    
    style B fill:#e6f7ff,stroke:#1890ff
    style C fill:#f6ffed,stroke:#52c41a
    style D fill:#f6ffed,stroke:#52c41a
    style E fill:#f6ffed,stroke:#52c41a
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **å¤æ‚å­ç³»ç»Ÿ**ï¼šå½“éœ€è¦ç®€åŒ–å¤æ‚å­ç³»ç»Ÿçš„è®¿é—®æ—¶
- **åˆ†å±‚ç³»ç»Ÿ**ï¼šåœ¨åˆ†å±‚ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨å¤–è§‚å®šä¹‰æ¯å±‚çš„å…¥å£ç‚¹
- **å­ç³»ç»Ÿç‹¬ç«‹**ï¼šå°†å®¢æˆ·ç«¯ä»£ç ä¸å­ç³»ç»Ÿç»„ä»¶è§£è€¦
- **ç»Ÿä¸€æ¥å£**ï¼šä¸ºå­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•çš„ç»Ÿä¸€æ¥å£

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **ç®€åŒ–æ¥å£**ï¼šä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•çš„æ¥å£
- **é™ä½è€¦åˆåº¦**ï¼šå‡å°‘å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿç»„ä»¶çš„ç›´æ¥ä¾èµ–
- **éšè—å®ç°**ï¼šéšè—å­ç³»ç»Ÿçš„å®ç°ç»†èŠ‚
- **æé«˜å®‰å…¨æ€§**ï¼šé€šè¿‡å¤–è§‚æ§åˆ¶å¯¹å­ç³»ç»Ÿçš„è®¿é—®

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **ä¸Šå¸å¯¹è±¡**ï¼šå¯èƒ½ä¼šå˜æˆä¸Šå¸å¯¹è±¡ï¼Œæ‰¿æ‹…è¿‡å¤šè´£ä»»
- **æ€§èƒ½å¼€é”€**ï¼šå¼•å…¥é¢å¤–çš„é—´æ¥å±‚ï¼Œå¯èƒ½å¢åŠ æ€§èƒ½å¼€é”€
- **é€‚åº”æ€§å·®**ï¼šä¸€æ—¦å®šä¹‰ï¼Œä¸æ˜“é€‚åº”å­ç³»ç»Ÿçš„å˜åŒ–
- **æŠ½è±¡ç¨‹åº¦**ï¼šä¸ºæä¾›ç®€å•æ¥å£å¯èƒ½æŸå¤±ä¸€äº›çµæ´»æ€§

</TabItem>
</Tabs>

### 5.2 å¤–è§‚æ¨¡å¼ç»“æ„

```java title="å¤–è§‚æ¨¡å¼ç»“æ„"
// å­ç³»ç»ŸA
public class SubsystemA {
    public void operationA() {
        System.out.println("å­ç³»ç»ŸAçš„æ“ä½œ");
    }
}

// å­ç³»ç»ŸB
public class SubsystemB {
    public void operationB() {
        System.out.println("å­ç³»ç»ŸBçš„æ“ä½œ");
    }
}

// å­ç³»ç»ŸC
public class SubsystemC {
    public void operationC() {
        System.out.println("å­ç³»ç»ŸCçš„æ“ä½œ");
    }
}

// å¤–è§‚ç±»
public class Facade {
    private SubsystemA subsystemA;
    private SubsystemB subsystemB;
    private SubsystemC subsystemC;
    
    public Facade() {
        this.subsystemA = new SubsystemA();
        this.subsystemB = new SubsystemB();
        this.subsystemC = new SubsystemC();
    }
    
    // æä¾›ç®€åŒ–çš„æ¥å£
    public void operation() {
        System.out.println("=== å¤–è§‚å¼€å§‹ç»„åˆæ“ä½œ ===");
        subsystemA.operationA();
        subsystemB.operationB();
        subsystemC.operationC();
        System.out.println("=== å¤–è§‚ç»“æŸç»„åˆæ“ä½œ ===");
    }
    
    // æä¾›ç‰¹å®šçš„æ“ä½œç»„åˆ
    public void operationAB() {
        System.out.println("=== å¤–è§‚å¼€å§‹ABæ“ä½œ ===");
        subsystemA.operationA();
        subsystemB.operationB();
        System.out.println("=== å¤–è§‚ç»“æŸABæ“ä½œ ===");
    }
    
    // æä¾›å¦ä¸€ç§æ“ä½œç»„åˆ
    public void operationBC() {
        System.out.println("=== å¤–è§‚å¼€å§‹BCæ“ä½œ ===");
        subsystemB.operationB();
        subsystemC.operationC();
        System.out.println("=== å¤–è§‚ç»“æŸBCæ“ä½œ ===");
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class FacadePatternDemo {
    public static void main(String[] args) {
        // ä½¿ç”¨å¤–è§‚
        Facade facade = new Facade();
        facade.operation();
        
        System.out.println("\næ‰§è¡Œç‰¹å®šç»„åˆæ“ä½œï¼š");
        facade.operationAB();
        facade.operationBC();
        
        // ä¸ä½¿ç”¨å¤–è§‚ï¼ˆç›´æ¥ä¸å­ç³»ç»Ÿäº¤äº’ï¼‰
        System.out.println("\nä¸ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼š");
        SubsystemA subsystemA = new SubsystemA();
        SubsystemB subsystemB = new SubsystemB();
        SubsystemC subsystemC = new SubsystemC();
        
        subsystemA.operationA();
        subsystemB.operationB();
        subsystemC.operationC();
    }
}
```

### 5.3 å¤–è§‚æ¨¡å¼å˜ä½“

#### å¤šå±‚å¤–è§‚

åœ¨å¤§å‹ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦å¤šä¸ªå¤–è§‚ç±»å½¢æˆå±‚æ¬¡ç»“æ„ï¼Œæ¯ä¸ªå¤–è§‚è´Ÿè´£ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†ã€‚

```java title="å¤šå±‚å¤–è§‚"
// ç¬¬ä¸€å±‚å¤–è§‚
public class FirstLevelFacade {
    private SubsystemA subsystemA;
    private SubsystemB subsystemB;
    
    public FirstLevelFacade() {
        this.subsystemA = new SubsystemA();
        this.subsystemB = new SubsystemB();
    }
    
    public void operation() {
        subsystemA.operationA();
        subsystemB.operationB();
    }
}

// ç¬¬äºŒå±‚å¤–è§‚
public class SecondLevelFacade {
    private FirstLevelFacade firstLevelFacade;
    private SubsystemC subsystemC;
    
    public SecondLevelFacade() {
        this.firstLevelFacade = new FirstLevelFacade();
        this.subsystemC = new SubsystemC();
    }
    
    public void operation() {
        firstLevelFacade.operation();
        subsystemC.operationC();
    }
}
```

#### å­ç³»ç»Ÿå¤–è§‚

æ¯ä¸ªå­ç³»ç»Ÿå¯ä»¥æœ‰è‡ªå·±çš„å¤–è§‚ç±»ï¼Œä»¥ç®€åŒ–å¯¹è¯¥å­ç³»ç»Ÿçš„è®¿é—®ã€‚

```java title="å­ç³»ç»Ÿå¤–è§‚"
// æ•°æ®åº“å­ç³»ç»Ÿå¤–è§‚
public class DatabaseFacade {
    private Connection connection;
    private Statement statement;
    private ResultSet resultSet;
    
    public List<String> executeQuery(String query) {
        List<String> results = new ArrayList<>();
        try {
            // ç®€åŒ–æ•°æ®åº“æ“ä½œ
            connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/db", "user", "password");
            statement = connection.createStatement();
            resultSet = statement.executeQuery(query);
            
            while (resultSet.next()) {
                results.add(resultSet.getString(1));
            }
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            // å…³é—­èµ„æº
            close();
        }
        return results;
    }
    
    private void close() {
        try {
            if (resultSet != null) resultSet.close();
            if (statement != null) statement.close();
            if (connection != null) connection.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
```

### 5.4 åº”ç”¨åœºæ™¯

<Tabs>
<TabItem value="home-theater" label="å®¶åº­å½±é™¢ç³»ç»Ÿ">

```java title="å®¶åº­å½±é™¢å¤–è§‚"
// å®¶åº­å½±é™¢ç»„ä»¶
public class Amplifier {
    public void on() {
        System.out.println("æ”¾å¤§å™¨å·²å¼€å¯");
    }
    
    public void setVolume(int level) {
        System.out.println("è®¾ç½®éŸ³é‡ä¸º " + level);
    }
    
    public void off() {
        System.out.println("æ”¾å¤§å™¨å·²å…³é—­");
    }
}

public class DvdPlayer {
    public void on() {
        System.out.println("DVDæ’­æ”¾å™¨å·²å¼€å¯");
    }
    
    public void play(String movie) {
        System.out.println("æ’­æ”¾ç”µå½±ï¼š" + movie);
    }
    
    public void stop() {
        System.out.println("DVDæ’­æ”¾åœæ­¢");
    }
    
    public void eject() {
        System.out.println("DVDå¼¹å‡º");
    }
    
    public void off() {
        System.out.println("DVDæ’­æ”¾å™¨å·²å…³é—­");
    }
}

public class Projector {
    public void on() {
        System.out.println("æŠ•å½±ä»ªå·²å¼€å¯");
    }
    
    public void wideScreenMode() {
        System.out.println("æŠ•å½±ä»ªè®¾ç½®ä¸ºå®½å±æ¨¡å¼");
    }
    
    public void off() {
        System.out.println("æŠ•å½±ä»ªå·²å…³é—­");
    }
}

public class TheaterLights {
    public void dim(int level) {
        System.out.println("å°†ç¯å…‰è°ƒæš—è‡³ " + level + "%");
    }
    
    public void on() {
        System.out.println("ç¯å…‰å·²å¼€å¯");
    }
}

public class Screen {
    public void down() {
        System.out.println("å±å¹•é™ä¸‹");
    }
    
    public void up() {
        System.out.println("å±å¹•å‡èµ·");
    }
}

public class PopcornPopper {
    public void on() {
        System.out.println("çˆ†ç±³èŠ±æœºå·²å¼€å¯");
    }
    
    public void pop() {
        System.out.println("çˆ†ç±³èŠ±æœºå¼€å§‹åˆ¶ä½œçˆ†ç±³èŠ±");
    }
    
    public void off() {
        System.out.println("çˆ†ç±³èŠ±æœºå·²å…³é—­");
    }
}

// å®¶åº­å½±é™¢å¤–è§‚
public class HomeTheaterFacade {
    private Amplifier amplifier;
    private DvdPlayer dvdPlayer;
    private Projector projector;
    private TheaterLights lights;
    private Screen screen;
    private PopcornPopper popper;
    
    public HomeTheaterFacade(
            Amplifier amplifier,
            DvdPlayer dvdPlayer,
            Projector projector,
            TheaterLights lights,
            Screen screen,
            PopcornPopper popper) {
        this.amplifier = amplifier;
        this.dvdPlayer = dvdPlayer;
        this.projector = projector;
        this.lights = lights;
        this.screen = screen;
        this.popper = popper;
    }
    
    public void watchMovie(String movie) {
        System.out.println("=== å‡†å¤‡è§‚çœ‹ç”µå½± ===");
        popper.on();
        popper.pop();
        lights.dim(10);
        screen.down();
        projector.on();
        projector.wideScreenMode();
        amplifier.on();
        amplifier.setVolume(5);
        dvdPlayer.on();
        dvdPlayer.play(movie);
        System.out.println("=== å¼€å§‹è§‚çœ‹ç”µå½±ï¼š" + movie + " ===");
    }
    
    public void endMovie() {
        System.out.println("=== ç»“æŸè§‚çœ‹ç”µå½± ===");
        popper.off();
        lights.on();
        screen.up();
        projector.off();
        amplifier.off();
        dvdPlayer.stop();
        dvdPlayer.eject();
        dvdPlayer.off();
        System.out.println("=== å®¶åº­å½±é™¢ç³»ç»Ÿå·²å…³é—­ ===");
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class HomeTheaterDemo {
    public static void main(String[] args) {
        // åˆ›å»ºç»„ä»¶
        Amplifier amplifier = new Amplifier();
        DvdPlayer dvdPlayer = new DvdPlayer();
        Projector projector = new Projector();
        TheaterLights lights = new TheaterLights();
        Screen screen = new Screen();
        PopcornPopper popper = new PopcornPopper();
        
        // åˆ›å»ºå¤–è§‚
        HomeTheaterFacade homeTheater = new HomeTheaterFacade(
            amplifier, dvdPlayer, projector, lights, screen, popper);
        
        // ä½¿ç”¨å¤–è§‚ç®€åŒ–æ“ä½œ
        homeTheater.watchMovie("ã€Šå¤ä»‡è€…è”ç›Ÿã€‹");
        
        System.out.println("\nç”µå½±æ’­æ”¾ä¸­...\n");
        
        homeTheater.endMovie();
    }
}
```

</TabItem>
<TabItem value="compiler" label="ç¼–è¯‘å™¨å¤–è§‚">

```java title="ç¼–è¯‘å™¨å¤–è§‚"
// ç¼–è¯‘å™¨å­ç³»ç»Ÿ
public class Scanner {
    public void scan(String sourceCode) {
        System.out.println("è¯æ³•åˆ†æï¼šæ‰«ææºä»£ç ");
    }
    
    public List<String> getTokens() {
        List<String> tokens = new ArrayList<>();
        // æ·»åŠ ä¸€äº›ç¤ºä¾‹token
        tokens.add("int");
        tokens.add("main");
        tokens.add("(");
        tokens.add(")");
        return tokens;
    }
}

public class Parser {
    public void parse(List<String> tokens) {
        System.out.println("è¯­æ³•åˆ†æï¼šè§£ætokenåˆ—è¡¨");
        System.out.println("æ„å»ºè¯­æ³•æ ‘");
    }
    
    public Object getSyntaxTree() {
        return new Object(); // ç®€åŒ–çš„è¯­æ³•æ ‘
    }
}

public class SemanticAnalyzer {
    public void analyze(Object syntaxTree) {
        System.out.println("è¯­ä¹‰åˆ†æï¼šæ£€æŸ¥ç±»å‹å’Œä½œç”¨åŸŸ");
    }
    
    public Object getAnnotatedTree() {
        return new Object(); // ç®€åŒ–çš„å¸¦æ³¨é‡Šè¯­æ³•æ ‘
    }
}

public class CodeGenerator {
    public void generate(Object annotatedTree) {
        System.out.println("ä»£ç ç”Ÿæˆï¼šç”Ÿæˆç›®æ ‡ä»£ç ");
    }
    
    public String getObjectCode() {
        return "010101..."; // ç®€åŒ–çš„æœºå™¨ç 
    }
}

public class Optimizer {
    public void optimize(Object annotatedTree) {
        System.out.println("ä¼˜åŒ–ï¼šæ‰§è¡Œä»£ç ä¼˜åŒ–");
    }
    
    public Object getOptimizedTree() {
        return new Object(); // ç®€åŒ–çš„ä¼˜åŒ–åè¯­æ³•æ ‘
    }
}

// ç¼–è¯‘å™¨å¤–è§‚
public class CompilerFacade {
    private Scanner scanner;
    private Parser parser;
    private SemanticAnalyzer semanticAnalyzer;
    private Optimizer optimizer;
    private CodeGenerator codeGenerator;
    
    public CompilerFacade() {
        this.scanner = new Scanner();
        this.parser = new Parser();
        this.semanticAnalyzer = new SemanticAnalyzer();
        this.optimizer = new Optimizer();
        this.codeGenerator = new CodeGenerator();
    }
    
    public String compile(String sourceCode) {
        System.out.println("=== å¼€å§‹ç¼–è¯‘è¿‡ç¨‹ ===");
        
        // 1. è¯æ³•åˆ†æ
        scanner.scan(sourceCode);
        List<String> tokens = scanner.getTokens();
        
        // 2. è¯­æ³•åˆ†æ
        parser.parse(tokens);
        Object syntaxTree = parser.getSyntaxTree();
        
        // 3. è¯­ä¹‰åˆ†æ
        semanticAnalyzer.analyze(syntaxTree);
        Object annotatedTree = semanticAnalyzer.getAnnotatedTree();
        
        // 4. ä¼˜åŒ–
        optimizer.optimize(annotatedTree);
        Object optimizedTree = optimizer.getOptimizedTree();
        
        // 5. ä»£ç ç”Ÿæˆ
        codeGenerator.generate(optimizedTree);
        String objectCode = codeGenerator.getObjectCode();
        
        System.out.println("=== ç¼–è¯‘è¿‡ç¨‹å®Œæˆ ===");
        return objectCode;
    }
    
    // åªæ‰§è¡Œå‰ç«¯ç¼–è¯‘ï¼ˆè¯æ³•ã€è¯­æ³•ã€è¯­ä¹‰åˆ†æï¼‰
    public Object frontEndCompile(String sourceCode) {
        System.out.println("=== å¼€å§‹å‰ç«¯ç¼–è¯‘ ===");
        
        scanner.scan(sourceCode);
        List<String> tokens = scanner.getTokens();
        
        parser.parse(tokens);
        Object syntaxTree = parser.getSyntaxTree();
        
        semanticAnalyzer.analyze(syntaxTree);
        Object annotatedTree = semanticAnalyzer.getAnnotatedTree();
        
        System.out.println("=== å‰ç«¯ç¼–è¯‘å®Œæˆ ===");
        return annotatedTree;
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class CompilerDemo {
    public static void main(String[] args) {
        CompilerFacade compiler = new CompilerFacade();
        
        String sourceCode = "int main() { return 0; }";
        
        // ä½¿ç”¨å¤–è§‚è¿›è¡Œå®Œæ•´ç¼–è¯‘
        String objectCode = compiler.compile(sourceCode);
        System.out.println("ç”Ÿæˆçš„ç›®æ ‡ä»£ç ï¼š" + objectCode);
        
        // ä½¿ç”¨å¤–è§‚åªè¿›è¡Œå‰ç«¯ç¼–è¯‘
        Object ast = compiler.frontEndCompile(sourceCode);
        System.out.println("ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ï¼š" + ast);
    }
}
```

</TabItem>
<TabItem value="api-gateway" label="APIç½‘å…³">

```java title="APIç½‘å…³å¤–è§‚"
// å¾®æœåŠ¡ç»„ä»¶
public class AuthService {
    public boolean authenticate(String token) {
        System.out.println("è®¤è¯æœåŠ¡ï¼šéªŒè¯token");
        return token != null && !token.isEmpty();
    }
    
    public String getUserId(String token) {
        return "user123";
    }
}

public class UserService {
    public String getUserInfo(String userId) {
        System.out.println("ç”¨æˆ·æœåŠ¡ï¼šè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·ID = " + userId);
        return "{'id':'" + userId + "','name':'å¼ ä¸‰','email':'zhangsan@example.com'}";
    }
}

public class ProductService {
    public String getProducts() {
        System.out.println("äº§å“æœåŠ¡ï¼šè·å–äº§å“åˆ—è¡¨");
        return "[{'id':'p1','name':'ç¬”è®°æœ¬ç”µè„‘'},{'id':'p2','name':'æ™ºèƒ½æ‰‹æœº'}]";
    }
    
    public String getProductDetails(String productId) {
        System.out.println("äº§å“æœåŠ¡ï¼šè·å–äº§å“è¯¦æƒ…ï¼Œäº§å“ID = " + productId);
        return "{'id':'" + productId + "','name':'ç¬”è®°æœ¬ç”µè„‘','price':5999,'stock':100}";
    }
}

public class OrderService {
    public String createOrder(String userId, String productId) {
        System.out.println("è®¢å•æœåŠ¡ï¼šåˆ›å»ºè®¢å•ï¼Œç”¨æˆ·ID = " + userId + ", äº§å“ID = " + productId);
        return "{'orderId':'o12345','userId':'" + userId + "','productId':'" + productId + "','status':'created'}";
    }
    
    public String getOrderHistory(String userId) {
        System.out.println("è®¢å•æœåŠ¡ï¼šè·å–è®¢å•å†å²ï¼Œç”¨æˆ·ID = " + userId);
        return "[{'orderId':'o12345','productId':'p1','date':'2023-01-01'},{'orderId':'o12346','productId':'p2','date':'2023-02-01'}]";
    }
}

// APIç½‘å…³å¤–è§‚
public class APIGateway {
    private AuthService authService;
    private UserService userService;
    private ProductService productService;
    private OrderService orderService;
    
    public APIGateway() {
        this.authService = new AuthService();
        this.userService = new UserService();
        this.productService = new ProductService();
        this.orderService = new OrderService();
    }
    
    // ç»Ÿä¸€çš„APIå…¥å£ç‚¹
    public String handleRequest(String path, String method, String token, Map<String, String> params) {
        System.out.println("APIç½‘å…³ï¼šæ¥æ”¶è¯·æ±‚ " + method + " " + path);
        
        // èº«ä»½éªŒè¯ï¼ˆé™¤äº†äº§å“åˆ—è¡¨å¤–çš„æ‰€æœ‰è¯·æ±‚ï¼‰
        if (!path.equals("/products") && !authService.authenticate(token)) {
            return "{'error':'unauthorized','message':'èº«ä»½éªŒè¯å¤±è´¥'}";
        }
        
        // è·¯ç”±è¯·æ±‚åˆ°ç›¸åº”çš„æœåŠ¡
        switch (path) {
            case "/user":
                String userId = authService.getUserId(token);
                return userService.getUserInfo(userId);
                
            case "/products":
                return productService.getProducts();
                
            case "/product":
                String productId = params.get("id");
                if (productId == null) {
                    return "{'error':'bad_request','message':'ç¼ºå°‘äº§å“ID'}";
                }
                return productService.getProductDetails(productId);
                
            case "/orders":
                userId = authService.getUserId(token);
                return orderService.getOrderHistory(userId);
                
            case "/order/create":
                if (method.equals("POST")) {
                    userId = authService.getUserId(token);
                    productId = params.get("productId");
                    if (productId == null) {
                        return "{'error':'bad_request','message':'ç¼ºå°‘äº§å“ID'}";
                    }
                    return orderService.createOrder(userId, productId);
                } else {
                    return "{'error':'method_not_allowed','message':'ä¸æ”¯æŒçš„HTTPæ–¹æ³•'}";
                }
                
            default:
                return "{'error':'not_found','message':'èµ„æºä¸å­˜åœ¨'}";
        }
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class APIGatewayDemo {
    public static void main(String[] args) {
        APIGateway gateway = new APIGateway();
        
        // æ¨¡æ‹Ÿè¯·æ±‚
        String token = "valid_token";
        Map<String, String> params = new HashMap<>();
        
        // 1. è·å–äº§å“åˆ—è¡¨ï¼ˆæ— éœ€è®¤è¯ï¼‰
        String productsResponse = gateway.handleRequest("/products", "GET", null, params);
        System.out.println("äº§å“åˆ—è¡¨å“åº”ï¼š" + productsResponse);
        
        // 2. è·å–äº§å“è¯¦æƒ…
        params.put("id", "p1");
        String productResponse = gateway.handleRequest("/product", "GET", token, params);
        System.out.println("äº§å“è¯¦æƒ…å“åº”ï¼š" + productResponse);
        
        // 3. è·å–ç”¨æˆ·ä¿¡æ¯
        String userResponse = gateway.handleRequest("/user", "GET", token, new HashMap<>());
        System.out.println("ç”¨æˆ·ä¿¡æ¯å“åº”ï¼š" + userResponse);
        
        // 4. åˆ›å»ºè®¢å•
        params.clear();
        params.put("productId", "p1");
        String orderResponse = gateway.handleRequest("/order/create", "POST", token, params);
        System.out.println("åˆ›å»ºè®¢å•å“åº”ï¼š" + orderResponse);
        
        // 5. è·å–è®¢å•å†å²
        String ordersResponse = gateway.handleRequest("/orders", "GET", token, new HashMap<>());
        System.out.println("è®¢å•å†å²å“åº”ï¼š" + ordersResponse);
        
        // 6. æ— æ•ˆè¯·æ±‚
        String invalidResponse = gateway.handleRequest("/invalid", "GET", token, new HashMap<>());
        System.out.println("æ— æ•ˆè¯·æ±‚å“åº”ï¼š" + invalidResponse);
    }
}
```

</TabItem>
</Tabs>

### 5.5 å¤–è§‚æ¨¡å¼ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»

| æ¨¡å¼ | å¤–è§‚æ¨¡å¼ | é€‚é…å™¨æ¨¡å¼ | ä¸­ä»‹è€…æ¨¡å¼ | ä»£ç†æ¨¡å¼ |
|------|---------|----------|-----------|---------|
| **ç›®çš„** | ç®€åŒ–æ¥å£ | è½¬æ¢æ¥å£ | è§£è€¦å¯¹è±¡ | æ§åˆ¶è®¿é—® |
| **é€‚ç”¨èŒƒå›´** | å¤šä¸ªå¯¹è±¡ | å•ä¸ªå¯¹è±¡ | å¤šä¸ªå¯¹è±¡ | å•ä¸ªå¯¹è±¡ |
| **äº¤äº’æ–¹å¼** | å•å‘è°ƒç”¨ | é€‚é…è°ƒç”¨ | åè°ƒé€šä¿¡ | é€æ˜ä»£ç† |
| **ä¾§é‡ç‚¹** | ç®€åŒ–å¤æ‚æ€§ | è§£å†³ä¸å…¼å®¹ | å‡å°‘è€¦åˆ | å¢åŠ æ§åˆ¶ |
| **æ—¶æœº** | å­ç³»ç»Ÿè®¾è®¡åæœŸ | å·²æœ‰æ¥å£ä¸å…¼å®¹æ—¶ | ç³»ç»Ÿè®¾è®¡åˆæœŸ | æ‰©å±•ç°æœ‰å¯¹è±¡ |

:::tip å¤–è§‚æ¨¡å¼æœ€ä½³å®è·µ
1. **æ¥å£è®¾è®¡**ï¼šå¤–è§‚åº”æä¾›ç®€å•ã€ç›´è§‚çš„æ¥å£ï¼Œéšè—å­ç³»ç»Ÿå¤æ‚æ€§
2. **å­ç³»ç»Ÿç‹¬ç«‹**ï¼šä¿æŒå­ç³»ç»Ÿç‹¬ç«‹ï¼Œä¸è¦è®©å¤–è§‚æˆä¸ºå®ƒä»¬çš„å”¯ä¸€å…¥å£
3. **å¤šå±‚å¤–è§‚**ï¼šåœ¨å¤§å‹ç³»ç»Ÿä¸­ï¼Œè€ƒè™‘ä½¿ç”¨å¤šå±‚å¤–è§‚åˆ†è§£å¤æ‚æ€§
4. **é¿å…ä¸Šå¸å¯¹è±¡**ï¼šä¸è¦è®©å¤–è§‚æ‰¿æ‹…è¿‡å¤šè´£ä»»ï¼Œä¿æŒå•ä¸€èŒè´£
5. **ç»„åˆä½¿ç”¨**ï¼šå¤–è§‚å¯ä»¥ä¸å…¶ä»–æ¨¡å¼ç»„åˆä½¿ç”¨ï¼Œå¦‚é€‚é…å™¨å’Œç­–ç•¥æ¨¡å¼
:::

## 6. äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰

### 6.1 æ¨¡å¼å®šä¹‰

äº«å…ƒæ¨¡å¼è¿ç”¨å…±äº«æŠ€æœ¯æ¥é«˜æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡ã€‚å®ƒé€šè¿‡å…±äº«ç›¸åŒçŠ¶æ€çš„å¯¹è±¡å®ä¾‹ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—å¹¶æé«˜æ€§èƒ½ï¼Œå°¤å…¶åœ¨éœ€è¦åˆ›å»ºå¤§é‡ç›¸ä¼¼å¯¹è±¡çš„ç³»ç»Ÿä¸­éå¸¸æœ‰ç”¨ã€‚

```mermaid
graph TD
    A[å®¢æˆ·ç«¯] -->|ä½¿ç”¨| B[FlyweightFactory<br>äº«å…ƒå·¥å‚]
    B -->|åˆ›å»º/è·å–| C[ConcreteFlyweight1<br>å…·ä½“äº«å…ƒ1]
    B -->|åˆ›å»º/è·å–| D[ConcreteFlyweight2<br>å…·ä½“äº«å…ƒ2]
    A -->|ä¼ é€’å¤–éƒ¨çŠ¶æ€| C
    A -->|ä¼ é€’å¤–éƒ¨çŠ¶æ€| D
    
    style B fill:#e6f7ff,stroke:#1890ff
    style C fill:#f6ffed,stroke:#52c41a
    style D fill:#f6ffed,stroke:#52c41a
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **å¤§é‡ç›¸ä¼¼å¯¹è±¡**ï¼šç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸ä¼¼çš„å¯¹è±¡ï¼Œé€ æˆå†…å­˜å¼€é”€
- **å¤–éƒ¨çŠ¶æ€åˆ†ç¦»**ï¼šå¯¹è±¡çš„çŠ¶æ€å¯ä»¥åˆ†ä¸ºå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€
- **å¯¹è±¡æ ‡è¯†ä¸é‡è¦**ï¼šå¯¹è±¡çš„æ ‡è¯†å¯¹å®¢æˆ·ç«¯ä¸é‡è¦
- **å¸¸é‡æ± **ï¼šéœ€è¦ç¼“å­˜å’Œé‡ç”¨å¯¹è±¡å®ä¾‹ï¼Œå¦‚å­—ç¬¦ä¸²å¸¸é‡æ± 

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **å‡å°‘å†…å­˜æ¶ˆè€—**ï¼šå…±äº«å¯¹è±¡å‡å°‘å¯¹è±¡å®ä¾‹æ•°é‡
- **é™ä½åˆ›å»ºæˆæœ¬**ï¼šé¿å…é‡å¤åˆ›å»ºç›¸åŒå¯¹è±¡
- **æé«˜åº”ç”¨æ€§èƒ½**ï¼šå‡å°‘å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶å‹åŠ›
- **é™ä½ç³»ç»Ÿå¤æ‚åº¦**ï¼šå°†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€åˆ†ç¦»

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **å¤æ‚æ€§å¢åŠ **ï¼šéœ€è¦åŒºåˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€
- **çº¿ç¨‹å®‰å…¨**ï¼šå…±äº«å¯¹è±¡å¯èƒ½å¼•å‘çº¿ç¨‹å®‰å…¨é—®é¢˜
- **ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šåœ¨ä¸åŒä¸Šä¸‹æ–‡é—´åˆ‡æ¢å…±äº«å¯¹è±¡å¯èƒ½å¸¦æ¥å¼€é”€
- **è°ƒè¯•å›°éš¾**ï¼šå…±äº«å¯¹è±¡ä½¿å¾—ç³»ç»Ÿè¡Œä¸ºéš¾ä»¥ç†è§£å’Œè°ƒè¯•

</TabItem>
</Tabs>

### 6.2 äº«å…ƒæ¨¡å¼ç»“æ„

```java title="äº«å…ƒæ¨¡å¼ç»“æ„"
// äº«å…ƒæ¥å£
public interface Flyweight {
    void operation(String extrinsicState);
}

// å…·ä½“äº«å…ƒ
public class ConcreteFlyweight implements Flyweight {
    private final String intrinsicState; // å†…éƒ¨çŠ¶æ€ï¼Œä¸ä¼šæ”¹å˜ä¸”å¯å…±äº«
    
    public ConcreteFlyweight(String intrinsicState) {
        this.intrinsicState = intrinsicState;
        System.out.println("åˆ›å»ºå…·ä½“äº«å…ƒ: " + intrinsicState);
    }
    
    @Override
    public void operation(String extrinsicState) {
        System.out.println("å…·ä½“äº«å…ƒ [" + intrinsicState + "] æ‰§è¡Œæ“ä½œï¼Œå¤–éƒ¨çŠ¶æ€: " + extrinsicState);
    }
}

// ä¸å…±äº«çš„å…·ä½“äº«å…ƒ
public class UnsharedConcreteFlyweight implements Flyweight {
    private final String allState; // æ‰€æœ‰çŠ¶æ€ï¼Œä¸å…±äº«
    
    public UnsharedConcreteFlyweight(String allState) {
        this.allState = allState;
        System.out.println("åˆ›å»ºä¸å…±äº«çš„å…·ä½“äº«å…ƒ: " + allState);
    }
    
    @Override
    public void operation(String extrinsicState) {
        System.out.println("ä¸å…±äº«çš„å…·ä½“äº«å…ƒ [" + allState + "] æ‰§è¡Œæ“ä½œï¼Œå¤–éƒ¨çŠ¶æ€: " + extrinsicState);
    }
}

// äº«å…ƒå·¥å‚
public class FlyweightFactory {
    private final Map<String, Flyweight> flyweights = new HashMap<>();
    
    // è·å–äº«å…ƒå¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨åˆ™å…±äº«ï¼Œå¦åˆ™åˆ›å»ºæ–°çš„
    public Flyweight getFlyweight(String key) {
        return flyweights.computeIfAbsent(key, ConcreteFlyweight::new);
        }
    
    // è·å–ä¸å…±äº«çš„äº«å…ƒå¯¹è±¡
    public Flyweight getUnsharedFlyweight(String key) {
        return new UnsharedConcreteFlyweight(key);
    }
    
    // è·å–äº«å…ƒå¯¹è±¡æ•°é‡
    public int getFlyweightCount() {
        return flyweights.size();
    }
    
    // è·å–æ‰€æœ‰äº«å…ƒå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€
    public List<String> getFlyweightKeys() {
        return new ArrayList<>(flyweights.keySet());
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class FlyweightPatternDemo {
    public static void main(String[] args) {
        FlyweightFactory factory = new FlyweightFactory();
        
        // è·å–å…±äº«çš„äº«å…ƒå¯¹è±¡
        Flyweight fw1 = factory.getFlyweight("A");
        fw1.operation("First call");
        
        Flyweight fw2 = factory.getFlyweight("B");
        fw2.operation("Second call");
        
        Flyweight fw3 = factory.getFlyweight("A"); // é‡ç”¨å·²å­˜åœ¨çš„å¯¹è±¡
        fw3.operation("Third call");
        
        // è·å–ä¸å…±äº«çš„äº«å…ƒå¯¹è±¡
        Flyweight unsharedFw = factory.getUnsharedFlyweight("X");
        unsharedFw.operation("Unshared call");
        
        // æ˜¾ç¤ºå…±äº«å¯¹è±¡çš„æ•°é‡
        System.out.println("å…±äº«çš„äº«å…ƒå¯¹è±¡æ•°é‡: " + factory.getFlyweightCount());
        System.out.println("å…±äº«çš„äº«å…ƒå¯¹è±¡é”®: " + factory.getFlyweightKeys());
    }
}
```

### 6.3 å†…éƒ¨çŠ¶æ€ä¸å¤–éƒ¨çŠ¶æ€

äº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå°†å¯¹è±¡çš„çŠ¶æ€åˆ†ä¸ºå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ï¼š

1. **å†…éƒ¨çŠ¶æ€ï¼ˆIntrinsic Stateï¼‰**
   - å­˜å‚¨åœ¨äº«å…ƒå¯¹è±¡å†…éƒ¨
   - å¯ä»¥è¢«å¤šä¸ªå¯¹è±¡å…±äº«
   - ç‹¬ç«‹äºå¯¹è±¡çš„ä½¿ç”¨åœºæ™¯
   - é€šå¸¸æ˜¯ä¸å¯å˜çš„

2. **å¤–éƒ¨çŠ¶æ€ï¼ˆExtrinsic Stateï¼‰**
   - ä¸å­˜å‚¨åœ¨äº«å…ƒå¯¹è±¡å†…éƒ¨
   - ç”±å®¢æˆ·ç«¯ä»£ç æä¾›
   - æ ¹æ®ä½¿ç”¨åœºæ™¯è€Œå˜åŒ–
   - ä¸å¯å…±äº«

```java title="å†…éƒ¨ä¸å¤–éƒ¨çŠ¶æ€ç¤ºä¾‹"
// å¸¦æœ‰æ¸…æ™°åˆ†ç¦»çš„å†…éƒ¨å’Œå¤–éƒ¨çŠ¶æ€çš„äº«å…ƒ
public class CharacterFlyweight {
    // å†…éƒ¨çŠ¶æ€ - ä¸å¯å˜ä¸”å¯å…±äº«
    private final char character;
    private final String fontFamily;
    private final int fontSize;
    
    public CharacterFlyweight(char character, String fontFamily, int fontSize) {
        this.character = character;
        this.fontFamily = fontFamily;
        this.fontSize = fontSize;
    }
    
    // ä½¿ç”¨å¤–éƒ¨çŠ¶æ€æ¸²æŸ“å­—ç¬¦
    public void render(int x, int y, String color) {
        System.out.printf("æ¸²æŸ“å­—ç¬¦ '%c' åœ¨ä½ç½®(%d, %d)ï¼Œä½¿ç”¨å­—ä½“ %sï¼Œå¤§å° %dï¼Œé¢œè‰² %s%n",
                character, x, y, fontFamily, fontSize, color);
    }
    
    // é‡å†™equalså’ŒhashCodeæ–¹æ³•ï¼Œç”¨äºåœ¨Mapä¸­æ­£ç¡®åœ°è¯†åˆ«ç›¸åŒçš„äº«å…ƒ
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        CharacterFlyweight that = (CharacterFlyweight) o;
        return character == that.character &&
               fontSize == that.fontSize &&
               Objects.equals(fontFamily, that.fontFamily);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(character, fontFamily, fontSize);
    }
}
```

### 6.4 åº”ç”¨åœºæ™¯

<Tabs>
<TabItem value="text-editor" label="æ–‡æœ¬ç¼–è¾‘å™¨">

```java title="æ–‡æœ¬ç¼–è¾‘å™¨äº«å…ƒ"
// å­—ç¬¦äº«å…ƒ
public class CharacterFlyweight {
    private final char symbol;
    private final String fontName;
    private final int fontSize;
    
    public CharacterFlyweight(char symbol, String fontName, int fontSize) {
        this.symbol = symbol;
        this.fontName = fontName;
        this.fontSize = fontSize;
    }
    
    public void display(int x, int y, String color) {
        System.out.printf("æ˜¾ç¤ºå­—ç¬¦ '%c' åœ¨ä½ç½®(%d, %d)ï¼Œä½¿ç”¨å­—ä½“ %sï¼Œå¤§å° %dï¼Œé¢œè‰² %s%n",
                symbol, x, y, fontName, fontSize, color);
    }
}

// å­—ç¬¦äº«å…ƒå·¥å‚
public class CharacterFlyweightFactory {
    private final Map<String, CharacterFlyweight> characters = new HashMap<>();
    
    public CharacterFlyweight getCharacter(char symbol, String fontName, int fontSize) {
        String key = String.format("%c-%s-%d", symbol, fontName, fontSize);
        
        return characters.computeIfAbsent(key, k -> 
            new CharacterFlyweight(symbol, fontName, fontSize)
        );
    }
    
    public int getCharacterCount() {
        return characters.size();
    }
}

// æ–‡æœ¬æ–‡æ¡£ç±»ï¼Œä½¿ç”¨äº«å…ƒæ¨¡å¼
public class TextDocument {
    private final CharacterFlyweightFactory factory;
    private final List<Character> characters = new ArrayList<>();
    private final List<Integer> xCoords = new ArrayList<>();
    private final List<Integer> yCoords = new ArrayList<>();
    private final List<String> colors = new ArrayList<>();
    
    public TextDocument(CharacterFlyweightFactory factory) {
        this.factory = factory;
    }
    
    // æ·»åŠ å­—ç¬¦åˆ°æ–‡æ¡£
    public void addCharacter(char symbol, int x, int y, String fontName, int fontSize, String color) {
        CharacterFlyweight characterFlyweight = factory.getCharacter(symbol, fontName, fontSize);
        
        // å­˜å‚¨å¤–éƒ¨çŠ¶æ€
        characters.add(symbol);
        xCoords.add(x);
        yCoords.add(y);
        colors.add(color);
    }
    
    // æ¸²æŸ“æ•´ä¸ªæ–‡æ¡£
    public void render() {
        System.out.println("æ¸²æŸ“æ–‡æ¡£...");
        for (int i = 0; i < characters.size(); i++) {
            char symbol = characters.get(i);
            int x = xCoords.get(i);
            int y = yCoords.get(i);
            String color = colors.get(i);
            
            // è·å–å¯¹åº”çš„äº«å…ƒå¯¹è±¡
            CharacterFlyweight characterFlyweight = factory.getCharacter(symbol, "Arial", 12);
            characterFlyweight.display(x, y, color);
        }
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class TextEditorDemo {
    public static void main(String[] args) {
        CharacterFlyweightFactory factory = new CharacterFlyweightFactory();
        TextDocument document = new TextDocument(factory);
        
        // æ·»åŠ æ–‡æœ¬åˆ°æ–‡æ¡£ï¼Œæ¯ä¸ªå­—ç¬¦æœ‰è‡ªå·±çš„ä½ç½®å’Œé¢œè‰²ï¼ˆå¤–éƒ¨çŠ¶æ€ï¼‰
        String text = "Hello, World!";
        int x = 10;
        int y = 20;
        
        for (int i = 0; i < text.length(); i++) {
            char c = text.charAt(i);
            String color = (i % 2 == 0) ? "black" : "blue"; // äº¤æ›¿é¢œè‰²
            document.addCharacter(c, x, y, "Arial", 12, color);
            x += 10; // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä½ç½®
        }
        
        // å†æ¬¡æ·»åŠ ç›¸åŒæ–‡æœ¬ï¼Œä½†ä½ç½®å’Œé¢œè‰²ä¸åŒ
        x = 10;
        y = 40;
        
        for (int i = 0; i < text.length(); i++) {
            char c = text.charAt(i);
            String color = (i % 2 == 0) ? "red" : "green"; // äº¤æ›¿é¢œè‰²
            document.addCharacter(c, x, y, "Arial", 12, color);
            x += 10; // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªä½ç½®
        }
        
        // æ¸²æŸ“æ–‡æ¡£
        document.render();
        
        // æ˜¾ç¤ºäº«å…ƒå¯¹è±¡æ•°é‡
        System.out.println("\nå…±åˆ›å»ºäº† " + factory.getCharacterCount() + " ä¸ªäº«å…ƒå¯¹è±¡");
        // è™½ç„¶æœ‰26ä¸ªå­—ç¬¦è¢«æ¸²æŸ“ï¼Œä½†åªåˆ›å»ºäº†ä¸åŒå­—ç¬¦çš„äº«å…ƒå¯¹è±¡
    }
}
```

</TabItem>
<TabItem value="game-objects" label="æ¸¸æˆç²’å­ç³»ç»Ÿ">

```java title="æ¸¸æˆç²’å­ç³»ç»Ÿäº«å…ƒ"
// ç²’å­ç±»å‹ - å†…éƒ¨çŠ¶æ€
public class ParticleType {
    private final String texture;      // ç²’å­çº¹ç†
    private final int animationFrames; // åŠ¨ç”»å¸§æ•°
    private final boolean collidable;  // æ˜¯å¦å¯ç¢°æ’
    
    public ParticleType(String texture, int animationFrames, boolean collidable) {
        this.texture = texture;
        this.animationFrames = animationFrames;
        this.collidable = collidable;
        System.out.println("åˆ›å»ºæ–°çš„ç²’å­ç±»å‹: " + texture);
    }
    
    public void render(float x, float y, float scale, float rotation, String color) {
        System.out.printf("æ¸²æŸ“ç²’å­ï¼šçº¹ç†=%s, ä½ç½®=(%.1f, %.1f), ç¼©æ”¾=%.1f, æ—‹è½¬=%.1f, é¢œè‰²=%s%n",
                texture, x, y, scale, rotation, color);
    }
    
    public boolean isCollidable() {
        return collidable;
    }
}

// ç²’å­ç±»å‹å·¥å‚
public class ParticleTypeFactory {
    private final Map<String, ParticleType> particleTypes = new HashMap<>();
    
    public ParticleType getParticleType(String texture, int animationFrames, boolean collidable) {
        String key = String.format("%s-%d-%b", texture, animationFrames, collidable);
        
        return particleTypes.computeIfAbsent(key, k -> 
            new ParticleType(texture, animationFrames, collidable)
        );
    }
    
    public int getParticleTypeCount() {
        return particleTypes.size();
    }
}

// ç²’å­ - åŒ…å«å†…éƒ¨çŠ¶æ€å¼•ç”¨å’Œå¤–éƒ¨çŠ¶æ€
public class Particle {
    // å¼•ç”¨åˆ°å…±äº«çš„ç²’å­ç±»å‹ï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰
    private final ParticleType type;
    
    // å¤–éƒ¨çŠ¶æ€ - æ¯ä¸ªç²’å­å®ä¾‹ç‰¹æœ‰çš„
    private float x;
    private float y;
    private float scale;
    private float rotation;
    private String color;
    private float velocityX;
    private float velocityY;
    
    public Particle(ParticleType type, float x, float y) {
        this.type = type;
        this.x = x;
        this.y = y;
        this.scale = 1.0f;
        this.rotation = 0.0f;
        this.color = "white";
        this.velocityX = 0.0f;
        this.velocityY = 0.0f;
    }
    
    // è®¾ç½®é€Ÿåº¦
    public void setVelocity(float vx, float vy) {
        this.velocityX = vx;
        this.velocityY = vy;
    }
    
    // è®¾ç½®é¢œè‰²
    public void setColor(String color) {
        this.color = color;
    }
    
    // æ›´æ–°ç²’å­çŠ¶æ€
    public void update(float deltaTime) {
        x += velocityX * deltaTime;
        y += velocityY * deltaTime;
        rotation += 0.1f * deltaTime; // ç®€å•çš„æ—‹è½¬
    }
    
    // æ¸²æŸ“ç²’å­
    public void render() {
        type.render(x, y, scale, rotation, color);
    }
    
    // æ£€æŸ¥æ˜¯å¦å¯ç¢°æ’
    public boolean isCollidable() {
        return type.isCollidable();
    }
}

// ç²’å­ç³»ç»Ÿ
public class ParticleSystem {
    private final ParticleTypeFactory typeFactory;
    private final List<Particle> activeParticles = new ArrayList<>();
    private final Random random = new Random();
    
    public ParticleSystem() {
        this.typeFactory = new ParticleTypeFactory();
    }
    
    // åˆ›å»ºçˆ†ç‚¸æ•ˆæœ
    public void createExplosion(float x, float y, int particleCount) {
        System.out.println("åˆ›å»ºçˆ†ç‚¸æ•ˆæœï¼Œä½ç½®: (" + x + ", " + y + ")");
        ParticleType fireType = typeFactory.getParticleType("fire", 8, false);
        ParticleType smokeType = typeFactory.getParticleType("smoke", 5, false);
        
        // åˆ›å»ºç«ç„°ç²’å­
        for (int i = 0; i < particleCount / 2; i++) {
            float offsetX = random.nextFloat() * 10 - 5;
            float offsetY = random.nextFloat() * 10 - 5;
            
            Particle particle = new Particle(fireType, x + offsetX, y + offsetY);
            particle.setVelocity(
                (random.nextFloat() - 0.5f) * 20,
                (random.nextFloat() - 0.5f) * 20
            );
            particle.setColor("orange");
            activeParticles.add(particle);
        }
        
        // åˆ›å»ºçƒŸé›¾ç²’å­
        for (int i = 0; i < particleCount / 2; i++) {
            float offsetX = random.nextFloat() * 15 - 7.5f;
            float offsetY = random.nextFloat() * 15 - 7.5f;
            
            Particle particle = new Particle(smokeType, x + offsetX, y + offsetY);
            particle.setVelocity(
                (random.nextFloat() - 0.5f) * 10,
                (random.nextFloat() - 0.3f) * 15 - 5 // çƒŸé›¾ä¸»è¦å‘ä¸Šç§»åŠ¨
            );
            particle.setColor("gray");
            activeParticles.add(particle);
        }
    }
    
    // åˆ›å»ºé›¨æ»´æ•ˆæœ
    public void createRainEffect(int width, int height, int particleCount) {
        System.out.println("åˆ›å»ºé›¨æ»´æ•ˆæœ");
        ParticleType rainType = typeFactory.getParticleType("rain", 1, false);
        
        for (int i = 0; i < particleCount; i++) {
            float x = random.nextFloat() * width;
            float y = random.nextFloat() * height;
            
            Particle particle = new Particle(rainType, x, y);
            particle.setVelocity(0, 30 + random.nextFloat() * 20); // é›¨æ»´å‘ä¸‹ç§»åŠ¨
            particle.setColor("blue");
            activeParticles.add(particle);
        }
    }
    
    // æ›´æ–°æ‰€æœ‰ç²’å­
    public void update(float deltaTime) {
        Iterator<Particle> iterator = activeParticles.iterator();
        while (iterator.hasNext()) {
            Particle particle = iterator.next();
            particle.update(deltaTime);
            
            // ç®€å•çš„ç”Ÿå‘½å‘¨æœŸç®¡ç† - å¦‚æœç²’å­ç§»å‡ºå±å¹•åˆ™ç§»é™¤
            if (particle.getX() < -100 || particle.getX() > 800 || 
                particle.getY() < -100 || particle.getY() > 600) {
                iterator.remove();
            }
        }
    }
    
    // æ¸²æŸ“æ‰€æœ‰ç²’å­
    public void render() {
        for (Particle particle : activeParticles) {
            particle.render();
        }
    }
    
    // è·å–æ´»è·ƒç²’å­æ•°é‡
    public int getActiveParticleCount() {
        return activeParticles.size();
    }
    
    // è·å–ç²’å­ç±»å‹æ•°é‡
    public int getParticleTypeCount() {
        return typeFactory.getParticleTypeCount();
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class GameDemo {
    public static void main(String[] args) {
        ParticleSystem particleSystem = new ParticleSystem();
        
        // åˆ›å»ºå¤šä¸ªçˆ†ç‚¸æ•ˆæœ
        particleSystem.createExplosion(100, 100, 50);
        particleSystem.createExplosion(400, 300, 30);
        particleSystem.createExplosion(200, 400, 40);
        
        // åˆ›å»ºé›¨æ»´æ•ˆæœ
        particleSystem.createRainEffect(800, 600, 100);
        
        // æ¨¡æ‹Ÿæ¸¸æˆå¾ªç¯
        System.out.println("\nå¼€å§‹æ¸¸æˆå¾ªç¯...");
        float deltaTime = 0.016f; // çº¦60å¸§æ¯ç§’
        
        for (int frame = 0; frame < 3; frame++) {
            System.out.println("\n=== å¸§ " + frame + " ===");
            particleSystem.update(deltaTime);
            particleSystem.render();
            
            System.out.println("æ´»è·ƒç²’å­æ•°: " + particleSystem.getActiveParticleCount());
            System.out.println("ç²’å­ç±»å‹æ•°: " + particleSystem.getParticleTypeCount());
        }
        
        System.out.println("\né€šè¿‡äº«å…ƒæ¨¡å¼ï¼Œæˆ‘ä»¬åªåˆ›å»ºäº† " + particleSystem.getParticleTypeCount() + 
                         " ç§ç²’å­ç±»å‹ï¼Œä½†æ¸²æŸ“äº† " + particleSystem.getActiveParticleCount() + " ä¸ªç²’å­å®ä¾‹ã€‚");
    }
}
```

</TabItem>
<TabItem value="connection-pool" label="æ•°æ®åº“è¿æ¥æ± ">

```java title="æ•°æ®åº“è¿æ¥æ± äº«å…ƒ"
// æ•°æ®åº“è¿æ¥æ¥å£
public interface DatabaseConnection {
    void executeQuery(String query);
    void close();
    boolean isOpen();
}

// å…·ä½“æ•°æ®åº“è¿æ¥
public class ConcreteDatabaseConnection implements DatabaseConnection {
    private final String connectionString;
    private boolean isOpen;
    private final int connectionId;
    
    public ConcreteDatabaseConnection(String connectionString, int connectionId) {
        this.connectionString = connectionString;
        this.connectionId = connectionId;
        this.isOpen = false;
        System.out.println("åˆ›å»ºæ–°çš„æ•°æ®åº“è¿æ¥ #" + connectionId + " åˆ° " + connectionString);
    }
    
    public void open() {
        if (!isOpen) {
            isOpen = true;
            System.out.println("æ‰“å¼€æ•°æ®åº“è¿æ¥ #" + connectionId);
        }
    }
    
    @Override
    public void executeQuery(String query) {
        if (!isOpen) {
            open();
        }
        System.out.println("è¿æ¥ #" + connectionId + " æ‰§è¡ŒæŸ¥è¯¢: " + query);
    }
    
    @Override
    public void close() {
        if (isOpen) {
            isOpen = false;
            System.out.println("å…³é—­æ•°æ®åº“è¿æ¥ #" + connectionId);
        }
    }
    
    @Override
    public boolean isOpen() {
        return isOpen;
    }
}

// æ•°æ®åº“è¿æ¥æ± 
public class DatabaseConnectionPool {
    private final String connectionString;
    private final List<DatabaseConnection> availableConnections;
    private final List<DatabaseConnection> usedConnections;
    private final int maxConnections;
    private int nextConnectionId = 1;
    
    public DatabaseConnectionPool(String connectionString, int initialPoolSize, int maxConnections) {
        this.connectionString = connectionString;
        this.maxConnections = maxConnections;
        this.availableConnections = new ArrayList<>();
        this.usedConnections = new ArrayList<>();
        
        // åˆå§‹åŒ–è¿æ¥æ± 
        for (int i = 0; i < initialPoolSize; i++) {
            availableConnections.add(createConnection());
        }
    }
    
    // åˆ›å»ºæ–°è¿æ¥
    private DatabaseConnection createConnection() {
        return new ConcreteDatabaseConnection(connectionString, nextConnectionId++);
    }
    
    // è·å–è¿æ¥
    public synchronized DatabaseConnection getConnection() {
        DatabaseConnection connection;
        
        if (availableConnections.isEmpty()) {
            // å¦‚æœæ²¡æœ‰å¯ç”¨è¿æ¥ï¼Œå¹¶ä¸”æœªè¾¾åˆ°æœ€å¤§è¿æ¥æ•°ï¼Œåˆ™åˆ›å»ºæ–°è¿æ¥
            if (usedConnections.size() < maxConnections) {
                connection = createConnection();
            } else {
                // å¦‚æœå·²è¾¾åˆ°æœ€å¤§è¿æ¥æ•°ï¼Œåˆ™ç­‰å¾…
                System.out.println("è¾¾åˆ°æœ€å¤§è¿æ¥æ•°ï¼Œç­‰å¾…è¿æ¥é‡Šæ”¾...");
                try {
                    wait(1000); // ç­‰å¾…1ç§’
                    return getConnection(); // é€’å½’è°ƒç”¨
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("è·å–è¿æ¥è¢«ä¸­æ–­", e);
                }
            }
        } else {
            // ä½¿ç”¨æ± ä¸­çš„å¯ç”¨è¿æ¥
            connection = availableConnections.remove(availableConnections.size() - 1);
        }
        
        usedConnections.add(connection);
        return connection;
    }
    
    // é‡Šæ”¾è¿æ¥
    public synchronized void releaseConnection(DatabaseConnection connection) {
        if (usedConnections.remove(connection)) {
            availableConnections.add(connection);
            notifyAll(); // é€šçŸ¥ç­‰å¾…è¿æ¥çš„çº¿ç¨‹
            System.out.println("è¿æ¥è¿”å›åˆ°æ± ä¸­");
        }
    }
    
    // è·å–è¿æ¥æ± ç»Ÿè®¡ä¿¡æ¯
    public synchronized String getStatistics() {
        return String.format("è¿æ¥æ± ç»Ÿè®¡: å¯ç”¨è¿æ¥=%d, å·²ç”¨è¿æ¥=%d, æ€»è¿æ¥=%d, æœ€å¤§è¿æ¥æ•°=%d",
                availableConnections.size(), usedConnections.size(),
                availableConnections.size() + usedConnections.size(), maxConnections);
    }
    
    // å…³é—­æ‰€æœ‰è¿æ¥
    public synchronized void closeAll() {
        for (DatabaseConnection connection : availableConnections) {
            connection.close();
        }
        availableConnections.clear();
        
        for (DatabaseConnection connection : usedConnections) {
            connection.close();
        }
        usedConnections.clear();
        
        System.out.println("æ‰€æœ‰è¿æ¥å·²å…³é—­");
    }
}

// å®¢æˆ·ç«¯ä»£ç 
public class ConnectionPoolDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè¿æ¥æ± ï¼Œåˆå§‹å¤§å°ä¸º3ï¼Œæœ€å¤§è¿æ¥æ•°ä¸º5
        DatabaseConnectionPool pool = new DatabaseConnectionPool(
            "jdbc:mysql://localhost:3306/mydb", 3, 5);
        
        System.out.println(pool.getStatistics());
        
        // æ¨¡æ‹Ÿå¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨è¿æ¥
        System.out.println("\n--- å®¢æˆ·ç«¯1è·å–è¿æ¥ ---");
        DatabaseConnection conn1 = pool.getConnection();
        conn1.executeQuery("SELECT * FROM users WHERE id = 1");
        System.out.println(pool.getStatistics());
        
        System.out.println("\n--- å®¢æˆ·ç«¯2è·å–è¿æ¥ ---");
        DatabaseConnection conn2 = pool.getConnection();
        conn2.executeQuery("SELECT * FROM products WHERE category = 'Electronics'");
        System.out.println(pool.getStatistics());
        
        System.out.println("\n--- å®¢æˆ·ç«¯3è·å–è¿æ¥ ---");
        DatabaseConnection conn3 = pool.getConnection();
        conn3.executeQuery("SELECT * FROM orders WHERE date > '2023-01-01'");
        System.out.println(pool.getStatistics());
        
        System.out.println("\n--- å®¢æˆ·ç«¯1é‡Šæ”¾è¿æ¥ ---");
        pool.releaseConnection(conn1);
        System.out.println(pool.getStatistics());
        
        System.out.println("\n--- å®¢æˆ·ç«¯4è·å–è¿æ¥ ---");
        DatabaseConnection conn4 = pool.getConnection();
        conn4.executeQuery("SELECT * FROM customers WHERE country = 'China'");
        System.out.println(pool.getStatistics());
        
        System.out.println("\n--- å®¢æˆ·ç«¯5è·å–è¿æ¥ ---");
        DatabaseConnection conn5 = pool.getConnection();
        conn5.executeQuery("INSERT INTO logs (message) VALUES ('System check')");
        System.out.println(pool.getStatistics());
        
        // é‡Šæ”¾æ‰€æœ‰è¿æ¥
        System.out.println("\n--- é‡Šæ”¾æ‰€æœ‰è¿æ¥ ---");
        pool.releaseConnection(conn2);
        pool.releaseConnection(conn3);
        pool.releaseConnection(conn4);
        pool.releaseConnection(conn5);
        System.out.println(pool.getStatistics());
        
        // å…³é—­è¿æ¥æ± 
        System.out.println("\n--- å…³é—­è¿æ¥æ±  ---");
        pool.closeAll();
    }
}
```

</TabItem>
</Tabs>

### 6.5 äº«å…ƒæ¨¡å¼ä¸å…¶ä»–æ¨¡å¼æ¯”è¾ƒ

| ç‰¹æ€§ | äº«å…ƒæ¨¡å¼ | å•ä¾‹æ¨¡å¼ | å¯¹è±¡æ± æ¨¡å¼ |
|------|---------|---------|-----------|
| **ç›®çš„** | å…±äº«ç»†ç²’åº¦å¯¹è±¡ | ä¿è¯å”¯ä¸€å®ä¾‹ | é‡ç”¨å¯¹è±¡å®ä¾‹ |
| **å…±äº«çº§åˆ«** | å¤šä¸ªç›¸ä¼¼å¯¹è±¡ | å•ä¸€å¯¹è±¡ | åŒç±»å‹å¯¹è±¡é›†åˆ |
| **çŠ¶æ€å¤„ç†** | å†…å¤–çŠ¶æ€åˆ†ç¦» | å†…éƒ¨çŠ¶æ€ | é‡ç½®å†…éƒ¨çŠ¶æ€ |
| **åˆ›å»ºæ—¶æœº** | é¦–æ¬¡è¯·æ±‚æ—¶ | åŠ è½½æˆ–é¦–æ¬¡è¯·æ±‚ | æ± åˆå§‹åŒ–æ—¶ |
| **é€‚ç”¨åœºæ™¯** | å¤§é‡ç›¸ä¼¼å¯¹è±¡ | å…¨å±€å”¯ä¸€èµ„æº | åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡ |

:::tip äº«å…ƒæ¨¡å¼æœ€ä½³å®è·µ
1. **æ˜ç¡®åŒºåˆ†çŠ¶æ€**ï¼šæ¸…æ™°åˆ’åˆ†å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€
2. **ä¸å¯å˜å†…éƒ¨çŠ¶æ€**ï¼šäº«å…ƒå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€åº”è¯¥æ˜¯ä¸å¯å˜çš„
3. **é«˜æ•ˆé”®ç”Ÿæˆ**ï¼šä¸ºäº«å…ƒå·¥å‚è®¾è®¡é«˜æ•ˆçš„å¯¹è±¡æŸ¥æ‰¾æœºåˆ¶
4. **æ‡’åŠ è½½åˆ›å»º**ï¼šæŒ‰éœ€åˆ›å»ºäº«å…ƒå¯¹è±¡ï¼Œé¿å…é¢„å…ˆåˆ›å»ºæ‰€æœ‰å¯èƒ½çš„å¯¹è±¡
5. **çº¿ç¨‹å®‰å…¨**ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ç¡®ä¿äº«å…ƒå·¥å‚çš„çº¿ç¨‹å®‰å…¨
:::

## 7. ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰

### 7.1 æ¨¡å¼å®šä¹‰

ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†æ¨¡å¼åˆ›å»ºä¸€ä¸ªä»£è¡¨å¦ä¸€ä¸ªå¯¹è±¡çš„æ›¿ä»£å¯¹è±¡ï¼Œä»¥æ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®ï¼Œè¿™ç§æ§åˆ¶å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´æ’å…¥å…¶ä»–é€»è¾‘ã€‚

```mermaid
graph LR
    A[å®¢æˆ·ç«¯] -->|è°ƒç”¨| B[Proxy<br>ä»£ç†]
    B -->|è½¬å‘è¯·æ±‚| C[RealSubject<br>çœŸå®ä¸»é¢˜]
    B -->|æ§åˆ¶è®¿é—®| D[é¢å¤–é€»è¾‘]
    
    style B fill:#e6f7ff,stroke:#1890ff
    style C fill:#f6ffed,stroke:#52c41a
    style D fill:#fff7e6,stroke:#fa8c16
```

<Tabs>
<TabItem value="when-to-use" label="é€‚ç”¨åœºæ™¯">

- **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šå½“ç›®æ ‡å¯¹è±¡çš„åˆ›å»ºå¼€é”€å¾ˆå¤§æ—¶ï¼Œæ¨è¿Ÿåˆ°çœŸæ­£éœ€è¦æ—¶æ‰åˆ›å»º
- **è®¿é—®æ§åˆ¶**ï¼šæ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®æƒé™
- **é™„åŠ åŠŸèƒ½**ï¼šæ·»åŠ é¢å¤–æ“ä½œï¼Œå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§
- **è¿œç¨‹ä»£ç†**ï¼šä¸ºè¿œç¨‹å¯¹è±¡æä¾›æœ¬åœ°ä»£è¡¨
- **æ™ºèƒ½å¼•ç”¨**ï¼šåœ¨è®¿é—®å¯¹è±¡æ—¶æ‰§è¡Œé¢å¤–æ“ä½œï¼Œå¦‚å¼•ç”¨è®¡æ•°

</TabItem>
<TabItem value="benefits" label="ä¼˜ç‚¹">

- **æ§åˆ¶è®¿é—®**ï¼šå¯ä»¥æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®
- **å¼€é—­åŸåˆ™**ï¼šä¸ä¿®æ”¹ç›®æ ‡ç±»çš„æƒ…å†µä¸‹æ‰©å±•åŠŸèƒ½
- **å»¶è¿ŸåŠ è½½**ï¼šæŒ‰éœ€åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡
- **å®‰å…¨æ€§**ï¼šé€šè¿‡ä»£ç†é™åˆ¶å¯¹æ•æ„Ÿå¯¹è±¡çš„è®¿é—®
- **è¿œç¨‹äº¤äº’**ï¼šå¯ä»¥éšè—åº•å±‚ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§

</TabItem>
<TabItem value="drawbacks" label="ç¼ºç‚¹">

- **æ€§èƒ½å¼€é”€**ï¼šä»£ç†å±‚ä¼šå¸¦æ¥é¢å¤–çš„é—´æ¥è°ƒç”¨
- **å¤æ‚æ€§å¢åŠ **ï¼šå¼•å…¥é¢å¤–çš„ç±»å’Œé—´æ¥å±‚
- **å®ç°å›°éš¾**ï¼šæŸäº›ä»£ç†æ¨¡å¼ï¼ˆå¦‚è¿œç¨‹ä»£ç†ï¼‰å®ç°å¤æ‚
- **æ¥å£åŒæ­¥**ï¼šä»£ç†å’Œå®é™…å¯¹è±¡éœ€ä¿æŒæ¥å£ä¸€è‡´
- **å“åº”å»¶è¿Ÿ**ï¼šå¯èƒ½å¯¼è‡´æ“ä½œå»¶è¿Ÿ

</TabItem>
</Tabs>

### 7.2 ä»£ç†æ¨¡å¼åˆ†ç±»

#### é™æ€ä»£ç†

é™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šäº†ä»£ç†ä¸çœŸå®ä¸»é¢˜çš„å…³ç³»ï¼Œé€šè¿‡ç»„åˆå®ç°ã€‚

```java title="é™æ€ä»£ç†æ¨¡å¼"
// æŠ½è±¡ä¸»é¢˜
public interface Subject {
    void request();
}

// çœŸå®ä¸»é¢˜
public class RealSubject implements Subject {
    @Override
    public void request() {
        System.out.println("çœŸå®ä¸»é¢˜å¤„ç†è¯·æ±‚");
    }
}

// ä»£ç†ç±»
public class Proxy implements Subject {
    private RealSubject realSubject;
    
    public Proxy() {
        // å¯ä»¥å»¶è¿Ÿåˆå§‹åŒ–
    }
    
    @Override
    public void request() {
        // å‰ç½®å¤„ç†
        System.out.println("ä»£ç†å‰ç½®å¤„ç†");
        
        // æ‡’åŠ è½½
        if (realSubject == null) {
            realSubject = new RealSubject();
    }
    
        // è°ƒç”¨çœŸå®ä¸»é¢˜
        realSubject.request();
        
        // åç½®å¤„ç†
        System.out.println("ä»£ç†åç½®å¤„ç†");
    }
}

// å®¢æˆ·ç«¯
public class Client {
    public static void main(String[] args) {
        Subject proxy = new Proxy();
        proxy.request();
    }
}
```

#### åŠ¨æ€ä»£ç†

åŠ¨æ€ä»£ç†åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†ç±»ï¼ŒJavaä¸­å¸¸ç”¨çš„æœ‰JDKåŠ¨æ€ä»£ç†å’ŒCGLIBã€‚

```java title="JDKåŠ¨æ€ä»£ç†"
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

// JDKåŠ¨æ€ä»£ç†å¤„ç†å™¨
public class DynamicProxyHandler implements InvocationHandler {
    private Object target;
    
    public DynamicProxyHandler(Object target) {
        this.target = target;
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // å‰ç½®å¤„ç†
        System.out.println("åŠ¨æ€ä»£ç†å‰ç½®å¤„ç†: " + method.getName());
        
        // è°ƒç”¨ç›®æ ‡æ–¹æ³•
        Object result = method.invoke(target, args);
        
        // åç½®å¤„ç†
        System.out.println("åŠ¨æ€ä»£ç†åç½®å¤„ç†: " + method.getName());
        
        return result;
    }
    
    // åˆ›å»ºä»£ç†å¯¹è±¡
    public static Object createProxy(Object target) {
        return Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            new DynamicProxyHandler(target)
        );
    }
}

// å®¢æˆ·ç«¯
public class DynamicProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºçœŸå®ä¸»é¢˜
        Subject realSubject = new RealSubject();
        
        // åˆ›å»ºåŠ¨æ€ä»£ç†
        Subject proxy = (Subject) DynamicProxyHandler.createProxy(realSubject);
        
        // é€šè¿‡ä»£ç†è°ƒç”¨æ–¹æ³•
        proxy.request();
        
        // å¦‚æœSubjectæ¥å£æœ‰å¤šä¸ªæ–¹æ³•ï¼Œéƒ½ä¼šè¢«ä»£ç†
        // ä¾‹å¦‚ï¼šproxy.anotherMethod();
    }
}
```

#### CGLIBä»£ç†

CGLIBä»£ç†é€šè¿‡ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»å®ç°ä»£ç†ï¼Œå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚

```java title="CGLIBä»£ç†"
import net.sf.cglib.proxy.Enhancer;
import net.sf.cglib.proxy.MethodInterceptor;
import net.sf.cglib.proxy.MethodProxy;

// CGLIBæ–¹æ³•æ‹¦æˆªå™¨
public class CglibProxy implements MethodInterceptor {
    
    // åˆ›å»ºä»£ç†å¯¹è±¡
    public static Object createProxy(Class<?> targetClass) {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(targetClass);
        enhancer.setCallback(new CglibProxy());
        return enhancer.create();
    }
    
    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        // å‰ç½®å¤„ç†
        System.out.println("CGLIBä»£ç†å‰ç½®å¤„ç†: " + method.getName());
        
        // è°ƒç”¨ç›®æ ‡æ–¹æ³•
        Object result = proxy.invokeSuper(obj, args);
        
        // åç½®å¤„ç†
        System.out.println("CGLIBä»£ç†åç½®å¤„ç†: " + method.getName());
        
        return result;
    }
}

// ä¸éœ€è¦å®ç°æ¥å£çš„ç›®æ ‡ç±»
public class TargetObject {
    public void request() {
        System.out.println("ç›®æ ‡å¯¹è±¡å¤„ç†è¯·æ±‚");
    }
}

// å®¢æˆ·ç«¯
public class CglibProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä»£ç†
        TargetObject proxy = (TargetObject) CglibProxy.createProxy(TargetObject.class);
        
        // é€šè¿‡ä»£ç†è°ƒç”¨æ–¹æ³•
        proxy.request();
    }
}
```

### 7.3 ä»£ç†æ¨¡å¼çš„ç±»å‹

<Tabs>
<TabItem value="virtual-proxy" label="è™šæ‹Ÿä»£ç†">

è™šæ‹Ÿä»£ç†å»¶è¿Ÿåˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡ï¼Œç›´åˆ°çœŸæ­£éœ€è¦å®ƒæ—¶æ‰åˆ›å»ºã€‚

```java title="å›¾ç‰‡åŠ è½½è™šæ‹Ÿä»£ç†"
// å›¾ç‰‡æ¥å£
public interface Image {
    void display();
}

// çœŸå®å›¾ç‰‡ - ä»£ä»·æ˜‚è´µçš„å¯¹è±¡
public class RealImage implements Image {
    private String filename;
    
    public RealImage(String filename) {
        this.filename = filename;
        loadFromDisk();  // å¼€é”€å¤§çš„æ“ä½œ
    }
    
    private void loadFromDisk() {
        System.out.println("ä»ç£ç›˜åŠ è½½å›¾ç‰‡: " + filename);
        // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    
    @Override
    public void display() {
        System.out.println("æ˜¾ç¤ºå›¾ç‰‡: " + filename);
    }
}

// è™šæ‹Ÿä»£ç†
public class ProxyImage implements Image {
    private String filename;
    private RealImage realImage;
    
    public ProxyImage(String filename) {
        this.filename = filename;
    }
    
    @Override
    public void display() {
        if (realImage == null) {
            System.out.println("é¦–æ¬¡è®¿é—®ï¼Œåˆå§‹åŒ–RealImage");
            realImage = new RealImage(filename);
        }
        realImage.display();
    }
}

// å®¢æˆ·ç«¯
public class VirtualProxyDemo {
    public static void main(String[] args) {
        // ä½¿ç”¨ä»£ç†åˆ›å»ºå›¾ç‰‡
        System.out.println("åˆ›å»ºä»£ç†å¯¹è±¡...");
        Image image = new ProxyImage("sample.jpg");
        
        // å›¾ç‰‡æœªåŠ è½½
        System.out.println("ä»£ç†åˆ›å»ºå®Œæˆï¼Œä½†RealImageå°šæœªåŠ è½½");
        
        // é¦–æ¬¡æ˜¾ç¤ºå›¾ç‰‡æ—¶ï¼Œä»£ç†ä¼šåŠ è½½RealImage
        System.out.println("ç¬¬ä¸€æ¬¡è°ƒç”¨display()...");
        image.display();
        
        // ç¬¬äºŒæ¬¡æ˜¾ç¤ºå›¾ç‰‡æ—¶ï¼Œä¸ä¼šé‡æ–°åŠ è½½
        System.out.println("\nç¬¬äºŒæ¬¡è°ƒç”¨display()...");
        image.display();
    }
}
```

</TabItem>
<TabItem value="protection-proxy" label="ä¿æŠ¤ä»£ç†">

ä¿æŠ¤ä»£ç†æ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®ï¼Œé€šå¸¸ç”¨äºæƒé™æ§åˆ¶ã€‚

```java title="ç”¨æˆ·æœåŠ¡ä¿æŠ¤ä»£ç†"
// ç”¨æˆ·å®ä½“
public class User {
    private String id;
    private String name;
    private String role;
    
    public User(String id, String name, String role) {
        this.id = id;
        this.name = name;
        this.role = role;
    }
    
    public String getId() { return id; }
    public String getName() { return name; }
    public String getRole() { return role; }
    
    @Override
    public String toString() {
        return "User{id='" + id + "', name='" + name + "', role='" + role + "'}";
    }
}

// ç”¨æˆ·æœåŠ¡æ¥å£
public interface UserService {
    User getUser(String id);
    void updateUser(User user);
    void deleteUser(String id);
}

// çœŸå®ç”¨æˆ·æœåŠ¡
public class UserServiceImpl implements UserService {
    private Map<String, User> users = new HashMap<>();
    
    public UserServiceImpl() {
        // åˆå§‹åŒ–ä¸€äº›ç”¨æˆ·
        users.put("1", new User("1", "ç®¡ç†å‘˜", "admin"));
        users.put("2", new User("2", "æ™®é€šç”¨æˆ·", "user"));
        users.put("3", new User("3", "è®¿å®¢", "guest"));
    }
    
    @Override
    public User getUser(String id) {
        System.out.println("è·å–ç”¨æˆ·ä¿¡æ¯: " + id);
        return users.get(id);
    }
    
    @Override
    public void updateUser(User user) {
        System.out.println("æ›´æ–°ç”¨æˆ·: " + user);
        users.put(user.getId(), user);
    }
    
    @Override
    public void deleteUser(String id) {
        System.out.println("åˆ é™¤ç”¨æˆ·: " + id);
        users.remove(id);
    }
}

// ä¿æŠ¤ä»£ç†
public class UserServiceProxy implements UserService {
    private UserService userService;
    private User currentUser;
    
    public UserServiceProxy(UserService userService, User currentUser) {
        this.userService = userService;
        this.currentUser = currentUser;
    }
    
    @Override
    public User getUser(String id) {
        // æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è·å–ç”¨æˆ·ä¿¡æ¯
        return userService.getUser(id);
    }
    
    @Override
    public void updateUser(User user) {
        // åªæœ‰ç®¡ç†å‘˜æˆ–ç”¨æˆ·æœ¬äººå¯ä»¥æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        if ("admin".equals(currentUser.getRole()) || currentUser.getId().equals(user.getId())) {
            userService.updateUser(user);
        } else {
            throw new SecurityException("æ— æƒé™æ›´æ–°ç”¨æˆ·: " + user.getId());
        }
    }
    
    @Override
    public void deleteUser(String id) {
        // åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ç”¨æˆ·
        if ("admin".equals(currentUser.getRole())) {
            userService.deleteUser(id);
        } else {
            throw new SecurityException("æ— æƒé™åˆ é™¤ç”¨æˆ·: " + id);
        }
    }
}

// å®¢æˆ·ç«¯
public class ProtectionProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºçœŸå®æœåŠ¡
        UserService realService = new UserServiceImpl();
        
        // ä»¥ç®¡ç†å‘˜èº«ä»½åˆ›å»ºä»£ç†
        User adminUser = new User("1", "ç®¡ç†å‘˜", "admin");
        UserService adminProxy = new UserServiceProxy(realService, adminUser);
        
        // ä»¥æ™®é€šç”¨æˆ·èº«ä»½åˆ›å»ºä»£ç†
        User normalUser = new User("2", "æ™®é€šç”¨æˆ·", "user");
        UserService userProxy = new UserServiceProxy(realService, normalUser);
        
        // ç®¡ç†å‘˜æ“ä½œ
        System.out.println("=== ç®¡ç†å‘˜æ“ä½œ ===");
        System.out.println("è·å–ç”¨æˆ·: " + adminProxy.getUser("3"));
        adminProxy.updateUser(new User("3", "è®¿å®¢æ›´æ–°", "guest"));
        adminProxy.deleteUser("3");
        
        try {
            // æ™®é€šç”¨æˆ·æ“ä½œ
            System.out.println("\n=== æ™®é€šç”¨æˆ·æ“ä½œ ===");
            System.out.println("è·å–ç”¨æˆ·: " + userProxy.getUser("1"));
            
            // æ›´æ–°è‡ªå·±çš„ä¿¡æ¯ï¼ˆå…è®¸ï¼‰
            userProxy.updateUser(new User("2", "æ™®é€šç”¨æˆ·æ›´æ–°", "user"));
            
            // å°è¯•æ›´æ–°ä»–äººä¿¡æ¯ï¼ˆä¸å…è®¸ï¼‰
            userProxy.updateUser(new User("1", "å°è¯•æ›´æ–°ç®¡ç†å‘˜", "admin"));
        } catch (SecurityException e) {
            System.out.println("æƒé™é”™è¯¯: " + e.getMessage());
        }
        
        try {
            // å°è¯•åˆ é™¤ç”¨æˆ·ï¼ˆä¸å…è®¸ï¼‰
            userProxy.deleteUser("1");
        } catch (SecurityException e) {
            System.out.println("æƒé™é”™è¯¯: " + e.getMessage());
        }
    }
}
```

</TabItem>
<TabItem value="remote-proxy" label="è¿œç¨‹ä»£ç†">

è¿œç¨‹ä»£ç†ä¸ºè¿œç¨‹å¯¹è±¡æä¾›æœ¬åœ°ä»£è¡¨ï¼Œéšè—ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§ã€‚

```java title="è¿œç¨‹ä»£ç†ç¤ºä¾‹"
// å‡è®¾è¿™æ˜¯è¿œç¨‹æ¥å£
public interface RemoteService {
    String getData(String param);
    void processData(String data);
}

// è¿œç¨‹æœåŠ¡å®ç°ï¼ˆæ¨¡æ‹Ÿï¼‰
public class RemoteServiceImpl implements RemoteService {
    @Override
    public String getData(String param) {
        return "è¿œç¨‹æ•°æ®: " + param;
    }
    
    @Override
    public void processData(String data) {
        System.out.println("è¿œç¨‹å¤„ç†æ•°æ®: " + data);
    }
}

// è¿œç¨‹ä»£ç†
public class RemoteServiceProxy implements RemoteService {
    private String serviceUrl;
    
    public RemoteServiceProxy(String serviceUrl) {
        this.serviceUrl = serviceUrl;
    }
    
    @Override
    public String getData(String param) {
        System.out.println("å‘é€è¿œç¨‹è¯·æ±‚åˆ°: " + serviceUrl + "/getData");
        
        // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ‰§è¡ŒHTTPè¯·æ±‚
        // è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œç›´æ¥åˆ›å»ºè¿œç¨‹æœåŠ¡çš„å®ä¾‹
        RemoteService remoteService = new RemoteServiceImpl();
        String result = remoteService.getData(param);
        
        System.out.println("æ¥æ”¶è¿œç¨‹å“åº”");
        return result;
    }
    
    @Override
    public void processData(String data) {
        System.out.println("å‘é€è¿œç¨‹è¯·æ±‚åˆ°: " + serviceUrl + "/processData");
        
        // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ‰§è¡ŒHTTPè¯·æ±‚
        RemoteService remoteService = new RemoteServiceImpl();
        remoteService.processData(data);
        
        System.out.println("è¿œç¨‹è°ƒç”¨å®Œæˆ");
    }
}

// å®¢æˆ·ç«¯
public class RemoteProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè¿œç¨‹æœåŠ¡ä»£ç†
        RemoteService service = new RemoteServiceProxy("http://example.com/api");
        
        // è·å–è¿œç¨‹æ•°æ®
        String data = service.getData("test");
        System.out.println("è·å–çš„æ•°æ®: " + data);
        
        // å¤„ç†æ•°æ®
        service.processData("å¤„ç†æµ‹è¯•æ•°æ®");
    }
}
```

</TabItem>
<TabItem value="logging-proxy" label="æ—¥å¿—ä»£ç†">

æ—¥å¿—ä»£ç†æ·»åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œè€Œä¸ä¿®æ”¹åŸå§‹å¯¹è±¡ã€‚

```java title="æ—¥å¿—ä»£ç†"
// æ—¥å¿—ä»£ç†ä½¿ç”¨JDKåŠ¨æ€ä»£ç†å®ç°
public class LoggingProxyHandler implements InvocationHandler {
    private Object target;
    private Logger logger;
    
    public LoggingProxyHandler(Object target) {
        this.target = target;
        this.logger = Logger.getLogger(target.getClass().getName());
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // è®°å½•æ–¹æ³•è°ƒç”¨
        logger.info("è°ƒç”¨æ–¹æ³•: " + method.getName());
        
        // è®°å½•å‚æ•°
        if (args != null) {
            for (int i = 0; i < args.length; i++) {
                logger.info("å‚æ•° " + (i + 1) + ": " + args[i]);
            }
        }
        
        try {
            // è°ƒç”¨ç›®æ ‡æ–¹æ³•
            long startTime = System.currentTimeMillis();
            Object result = method.invoke(target, args);
            long endTime = System.currentTimeMillis();
            
            // è®°å½•è¿”å›å€¼å’Œæ‰§è¡Œæ—¶é—´
            logger.info("æ–¹æ³• " + method.getName() + " è¿”å›: " + result);
            logger.info("æ‰§è¡Œæ—¶é—´: " + (endTime - startTime) + "ms");
            
            return result;
        } catch (Exception e) {
            // è®°å½•å¼‚å¸¸
            logger.severe("æ–¹æ³• " + method.getName() + " æŠ›å‡ºå¼‚å¸¸: " + e.getCause());
            throw e.getCause();
        }
    }
    
    // åˆ›å»ºä»£ç†
    public static <T> T createProxy(T target, Class<?>... interfaces) {
        return (T) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            interfaces,
            new LoggingProxyHandler(target)
        );
    }
}

// ä¸šåŠ¡æœåŠ¡
public interface OrderService {
    Order createOrder(String productId, int quantity);
    boolean cancelOrder(String orderId);
}

// ä¸šåŠ¡æœåŠ¡å®ç°
public class OrderServiceImpl implements OrderService {
    @Override
    public Order createOrder(String productId, int quantity) {
        // æ¨¡æ‹Ÿåˆ›å»ºè®¢å•
        Order order = new Order("ORD-" + System.currentTimeMillis(), productId, quantity);
        System.out.println("åˆ›å»ºè®¢å•: " + order);
        return order;
    }
    
    @Override
    public boolean cancelOrder(String orderId) {
        // æ¨¡æ‹Ÿå–æ¶ˆè®¢å•
        System.out.println("å–æ¶ˆè®¢å•: " + orderId);
        return true;
    }
}

// è®¢å•å®ä½“
public class Order {
    private String orderId;
    private String productId;
    private int quantity;
    
    public Order(String orderId, String productId, int quantity) {
        this.orderId = orderId;
        this.productId = productId;
        this.quantity = quantity;
    }
    
    @Override
    public String toString() {
        return "Order{orderId='" + orderId + "', productId='" + productId + "', quantity=" + quantity + "}";
    }
}

// å®¢æˆ·ç«¯
public class LoggingProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºçœŸå®æœåŠ¡
        OrderService orderService = new OrderServiceImpl();
        
        // åˆ›å»ºæ—¥å¿—ä»£ç†
        OrderService proxiedService = LoggingProxyHandler.createProxy(orderService, OrderService.class);
        
        // é€šè¿‡ä»£ç†è°ƒç”¨æœåŠ¡
        Order order = proxiedService.createOrder("PROD-1", 5);
        
        // å–æ¶ˆè®¢å•
        boolean cancelled = proxiedService.cancelOrder(order.getOrderId());
    }
}
```

</TabItem>
</Tabs>

### 7.4 ä»£ç†æ¨¡å¼ä¸AOP

ä»£ç†æ¨¡å¼æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„åŸºç¡€ï¼ŒSpring AOPå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ã€‚

```java title="ç®€åŒ–çš„AOPæ¡†æ¶"
// åˆ‡é¢æ¥å£
public interface Aspect {
    void before(Method method, Object[] args);
    void after(Method method, Object result);
    void afterThrowing(Method method, Exception e);
}

// æ—¥å¿—åˆ‡é¢
public class LoggingAspect implements Aspect {
    @Override
    public void before(Method method, Object[] args) {
        System.out.println("è°ƒç”¨å‰ - æ–¹æ³•: " + method.getName());
    }
    
    @Override
    public void after(Method method, Object result) {
        System.out.println("è°ƒç”¨å - æ–¹æ³•: " + method.getName() + ", ç»“æœ: " + result);
    }
    
    @Override
    public void afterThrowing(Method method, Exception e) {
        System.out.println("å¼‚å¸¸å‘ç”Ÿ - æ–¹æ³•: " + method.getName() + ", å¼‚å¸¸: " + e.getMessage());
    }
}

// AOPä»£ç†å¤„ç†å™¨
public class AopProxyHandler implements InvocationHandler {
    private Object target;
    private List<Aspect> aspects;
    
    public AopProxyHandler(Object target) {
        this.target = target;
        this.aspects = new ArrayList<>();
    }
    
    public void addAspect(Aspect aspect) {
        aspects.add(aspect);
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // è°ƒç”¨æ‰€æœ‰åˆ‡é¢çš„beforeæ–¹æ³•
        for (Aspect aspect : aspects) {
            aspect.before(method, args);
        }
        
        try {
            // è°ƒç”¨ç›®æ ‡æ–¹æ³•
            Object result = method.invoke(target, args);
            
            // è°ƒç”¨æ‰€æœ‰åˆ‡é¢çš„afteræ–¹æ³•
            for (Aspect aspect : aspects) {
                aspect.after(method, result);
            }
            
            return result;
        } catch (InvocationTargetException e) {
            // è°ƒç”¨æ‰€æœ‰åˆ‡é¢çš„afterThrowingæ–¹æ³•
            for (Aspect aspect : aspects) {
                aspect.afterThrowing(method, (Exception)e.getCause());
            }
            throw e.getCause();
        }
    }
    
    // åˆ›å»ºAOPä»£ç†
    public static <T> T createProxy(T target, Class<?>... interfaces) {
        AopProxyHandler handler = new AopProxyHandler(target);
        return (T) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            interfaces,
            handler
        );
    }
}

// ç®€å•AOPæ¡†æ¶æ¼”ç¤º
public class SimpleAopDemo {
    public static void main(String[] args) {
        // åˆ›å»ºçœŸå®æœåŠ¡
        OrderService orderService = new OrderServiceImpl();
        
        // åˆ›å»ºAOPä»£ç†å¤„ç†å™¨
        AopProxyHandler handler = new AopProxyHandler(orderService);
        
        // æ·»åŠ æ—¥å¿—åˆ‡é¢
        handler.addAspect(new LoggingAspect());
        
        // åˆ›å»ºä»£ç†
        OrderService proxiedService = (OrderService) Proxy.newProxyInstance(
            orderService.getClass().getClassLoader(),
            new Class<?>[]{OrderService.class},
            handler
        );
        
        // é€šè¿‡ä»£ç†è°ƒç”¨æœåŠ¡
        Order order = proxiedService.createOrder("PROD-1", 5);
        
        System.out.println();
        
        // å–æ¶ˆè®¢å•
        boolean cancelled = proxiedService.cancelOrder(order.getOrderId());
    }
}
```

### 7.5 ä»£ç†æ¨¡å¼ä¸å…¶ä»–æ¨¡å¼æ¯”è¾ƒ

| ç‰¹æ€§ | ä»£ç†æ¨¡å¼ | è£…é¥°å™¨æ¨¡å¼ | é€‚é…å™¨æ¨¡å¼ | å¤–è§‚æ¨¡å¼ |
|------|---------|-----------|----------|---------|
| **ç›®çš„** | æ§åˆ¶è®¿é—® | åŠ¨æ€æ·»åŠ èŒè´£ | æ¥å£è½¬æ¢ | ç®€åŒ–æ¥å£ |
| **å®ç°æ–¹å¼** | ç»„åˆæˆ–ç»§æ‰¿ | ç»„åˆ | ç»„åˆæˆ–ç»§æ‰¿ | ç»„åˆ |
| **å…³ç³»ç±»å‹** | ä¸€å¯¹ä¸€ | ä¸€å¯¹ä¸€ | ä¸€å¯¹ä¸€ | ä¸€å¯¹å¤š |
| **é€æ˜åº¦** | å¯é€æ˜ï¼Œå¯ä¸é€æ˜ | é€æ˜ | ä¸é€æ˜ | ä¸é€æ˜ |
| **åˆ›å»ºæ—¶æœº** | ç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶ | è¿è¡Œæ—¶ | ç¼–è¯‘æ—¶ | ç¼–è¯‘æ—¶ |
| **åŠŸèƒ½æ‰©å±•** | è®¿é—®æ§åˆ¶ | åŠŸèƒ½æ‰©å±• | æ¥å£é€‚é… | æ¥å£ç®€åŒ– |

:::tip ä»£ç†æ¨¡å¼æœ€ä½³å®è·µ
1. **é€‰æ‹©åˆé€‚çš„ä»£ç†ç±»å‹**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©é™æ€ä»£ç†ã€JDKåŠ¨æ€ä»£ç†æˆ–CGLIB
2. **éµå¾ªæ¥å£è®¾è®¡**ï¼šç¡®ä¿ä»£ç†å’ŒçœŸå®ä¸»é¢˜å®ç°ç›¸åŒçš„æ¥å£
3. **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šä»£ç†è´Ÿè´£æ§åˆ¶è®¿é—®ï¼ŒçœŸå®ä¸»é¢˜è´Ÿè´£ä¸šåŠ¡é€»è¾‘
4. **æ€§èƒ½è€ƒè™‘**ï¼šåŠ¨æ€ä»£ç†å¯èƒ½å¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œåœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯è°¨æ…ä½¿ç”¨
5. **ç»„åˆä½¿ç”¨**ï¼šå¯ä»¥å°†ä¸åŒç±»å‹çš„ä»£ç†ç»„åˆä½¿ç”¨ï¼Œå¦‚è™šæ‹Ÿä»£ç†+ä¿æŠ¤ä»£ç†
:::

## 8. ç»“æ„å‹æ¨¡å¼å¯¹æ¯”

### 8.1 æ¨¡å¼é€‰æ‹©æŒ‡å—

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| **é€‚é…å™¨** | æ¥å£ä¸å…¼å®¹ | æé«˜å¤ç”¨æ€§ | å¢åŠ å¤æ‚åº¦ |
| **æ¡¥æ¥** | å¤šç»´åº¦å˜åŒ– | é¿å…ç»§æ‰¿çˆ†ç‚¸ | å¢åŠ æŠ½è±¡å±‚ |
| **ç»„åˆ** | æ ‘å½¢ç»“æ„ | ç»Ÿä¸€æ¥å£ | ç±»å‹æ£€æŸ¥å›°éš¾ |
| **è£…é¥°å™¨** | åŠ¨æ€æ‰©å±• | çµæ´»æ‰©å±• | äº§ç”Ÿå°å¯¹è±¡ |
| **å¤–è§‚** | ç®€åŒ–æ¥å£ | é™ä½è€¦åˆ | å¯èƒ½æˆä¸ºä¸Šå¸ç±» |
| **äº«å…ƒ** | å¤§é‡å¯¹è±¡ | èŠ‚çœå†…å­˜ | å¢åŠ å¤æ‚åº¦ |
| **ä»£ç†** | è®¿é—®æ§åˆ¶ | æ§åˆ¶è®¿é—® | å¢åŠ é—´æ¥å±‚ |

### 8.2 æ¨¡å¼ç»„åˆä½¿ç”¨

```java title="æ¨¡å¼ç»„åˆç¤ºä¾‹"
// ç»„åˆæ¨¡å¼ + è£…é¥°å™¨æ¨¡å¼
public abstract class FileSystemItem {
    public abstract void display(int depth);
    public abstract void add(FileSystemItem item);
    public abstract void remove(FileSystemItem item);
}

public class File extends FileSystemItem {
    private String name;
    
    public File(String name) {
        this.name = name;
    }
    
    @Override
    public void display(int depth) {
        StringBuilder prefix = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            prefix.append("  ");
        }
        System.out.println(prefix + "æ–‡ä»¶: " + name);
    }
    
    @Override
    public void add(FileSystemItem item) {
        throw new UnsupportedOperationException();
    }
    
    @Override
    public void remove(FileSystemItem item) {
        throw new UnsupportedOperationException();
    }
}

// è£…é¥°å™¨
public abstract class FileSystemDecorator extends FileSystemItem {
    protected FileSystemItem component;
    
    public FileSystemDecorator(FileSystemItem component) {
        this.component = component;
    }
    
    @Override
    public void display(int depth) {
        component.display(depth);
    }
    
    @Override
    public void add(FileSystemItem item) {
        component.add(item);
    }
    
    @Override
    public void remove(FileSystemItem item) {
        component.remove(item);
    }
}

public class ReadOnlyDecorator extends FileSystemDecorator {
    public ReadOnlyDecorator(FileSystemItem component) {
        super(component);
    }
    
    @Override
    public void add(FileSystemItem item) {
        throw new UnsupportedOperationException("åªè¯»æ–‡ä»¶ç³»ç»Ÿä¸èƒ½æ·»åŠ æ–‡ä»¶");
    }
    
    @Override
    public void remove(FileSystemItem item) {
        throw new UnsupportedOperationException("åªè¯»æ–‡ä»¶ç³»ç»Ÿä¸èƒ½åˆ é™¤æ–‡ä»¶");
    }
}
```

:::tip ç»“æ„å‹æ¨¡å¼é€‰æ‹©åŸåˆ™
1. **é€‚é…å™¨æ¨¡å¼**ï¼šéœ€è¦æ¥å£å…¼å®¹æ—¶ä½¿ç”¨
2. **æ¡¥æ¥æ¨¡å¼**ï¼šéœ€è¦å¤šç»´åº¦å˜åŒ–æ—¶ä½¿ç”¨
3. **ç»„åˆæ¨¡å¼**ï¼šéœ€è¦æ ‘å½¢ç»“æ„æ—¶ä½¿ç”¨
4. **è£…é¥°å™¨æ¨¡å¼**ï¼šéœ€è¦åŠ¨æ€æ‰©å±•åŠŸèƒ½æ—¶ä½¿ç”¨
5. **å¤–è§‚æ¨¡å¼**ï¼šéœ€è¦ç®€åŒ–å¤æ‚æ¥å£æ—¶ä½¿ç”¨
6. **äº«å…ƒæ¨¡å¼**ï¼šéœ€è¦å¤§é‡å¯¹è±¡å…±äº«æ—¶ä½¿ç”¨
7. **ä»£ç†æ¨¡å¼**ï¼šéœ€è¦æ§åˆ¶å¯¹è±¡è®¿é—®æ—¶ä½¿ç”¨
:::

---

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†ä¸ƒç§ç»“æ„å‹æ¨¡å¼çš„åŸç†ã€å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¦æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç»“æ„å‹æ¨¡å¼ï¼Œå¹¶æ³¨æ„æ¨¡å¼é—´çš„ç»„åˆä½¿ç”¨ã€‚

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†ä¸ƒç§ç»“æ„å‹æ¨¡å¼çš„åŸç†ã€å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¦æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç»“æ„å‹æ¨¡å¼ï¼Œå¹¶æ³¨æ„æ¨¡å¼é—´çš„ç»„åˆä½¿ç”¨ã€‚
