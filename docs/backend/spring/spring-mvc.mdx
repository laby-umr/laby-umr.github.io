---
sidebar_position: 4
title: "Spring MVCè¯¦è§£"
description: "æ·±å…¥ç†è§£Spring MVCæ¶æ„ã€è¯·æ±‚å¤„ç†æµç¨‹ä¸æœ€ä½³å®è·µ"
authors: [Laby]
last_update:
  date: 2025-08-07
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import TOCInline from '@theme/TOCInline';

# Spring MVC è¯¦è§£

Spring MVCæ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒWebæ¨¡å—ï¼ŒåŸºäºMVCï¼ˆModel-View-Controllerï¼‰è®¾è®¡æ¨¡å¼æ„å»ºï¼Œæä¾›äº†çµæ´»ã€å¼ºå¤§çš„Webåº”ç”¨å¼€å‘è§£å†³æ–¹æ¡ˆã€‚å®ƒæ˜¯æ„å»ºä¼ä¸šçº§Webåº”ç”¨çš„æ ‡å‡†é€‰æ‹©ã€‚

:::info æœ¬æ–‡å†…å®¹æ¦‚è§ˆ
<TOCInline toc={toc} />
:::

:::tip æ ¸å¿ƒä»·å€¼
**Spring MVC = æ¾è€¦åˆæ¶æ„ + çµæ´»é…ç½® + å¼ºå¤§æ‰©å±• + ä¼ä¸šçº§æ”¯æŒ**
- ğŸ—ï¸ **æ¾è€¦åˆæ¶æ„**ï¼šåŸºäºMVCè®¾è®¡æ¨¡å¼ï¼Œå®ç°å„å±‚åˆ†ç¦»
- âš™ï¸ **çµæ´»é…ç½®**ï¼šå¤šç§é…ç½®æ–¹å¼ï¼Œé€‚åº”ä¸åŒéœ€æ±‚
- ğŸ”Œ **å¼ºå¤§æ‰©å±•**ï¼šä¸°å¯Œçš„æ‹¦æˆªå™¨å’Œè§†å›¾æŠ€æœ¯
- ğŸ”’ **ä¼ä¸šçº§æ”¯æŒ**ï¼šè®¤è¯ã€å®‰å…¨ã€æ€§èƒ½ä¼˜åŒ–ç­‰ç‰¹æ€§
:::

## 1. Spring MVCåŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯Spring MVCï¼Ÿ

Spring MVCæ˜¯ä¸€ä¸ªåŸºäºJavaçš„Webæ¡†æ¶ï¼Œå®ç°äº†MVCè®¾è®¡æ¨¡å¼ï¼Œç”¨äºæ„å»ºWebåº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†å®Œæ•´çš„Webå¼€å‘è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è¯·æ±‚å¤„ç†ã€è§†å›¾æ¸²æŸ“ã€æ•°æ®ç»‘å®šç­‰åŠŸèƒ½ã€‚

```mermaid
graph TD
    A[Spring MVCæ¶æ„] --> B[Model æ¨¡å‹]
    A --> C[View è§†å›¾]
    A --> D[Controller æ§åˆ¶å™¨]
    
    B --> B1["ä¸šåŠ¡æ•°æ®å’Œé€»è¾‘"]
    C --> C1["ç”¨æˆ·ç•Œé¢å±•ç¤º"]
    D --> D1["å¤„ç†ç”¨æˆ·è¯·æ±‚"]
    
    D1 --> D2["æ¥æ”¶è¯·æ±‚"]
    D2 --> B1
    B1 --> C1
    C1 --> D3["è¿”å›å“åº”"]
```

#### MVCæ¶æ„æ¨¡å¼

<Tabs>
  <TabItem value="model" label="Modelï¼ˆæ¨¡å‹ï¼‰" default>
  ```java
// Modelï¼ˆæ¨¡å‹ï¼‰- æ•°æ®å’Œä¸šåŠ¡é€»è¾‘
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
    private String email;
    
    // getterå’Œsetteræ–¹æ³•
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
}
  ```
  </TabItem>
  <TabItem value="view" label="Viewï¼ˆè§†å›¾ï¼‰">
  ```html
  <!-- Viewï¼ˆè§†å›¾ï¼‰- ç”¨æˆ·ç•Œé¢ -->
  <!DOCTYPE html>
  <html>
  <head>
      <title>ç”¨æˆ·åˆ—è¡¨</title>
  </head>
  <body>
      <h1>ç”¨æˆ·åˆ—è¡¨</h1>
      <table>
          <tr>
              <th>ID</th>
              <th>å§“å</th>
              <th>é‚®ç®±</th>
          </tr>
          <tr th:each="user : ${users}">
              <td th:text="${user.id}"></td>
              <td th:text="${user.name}"></td>
              <td th:text="${user.email}"></td>
          </tr>
      </table>
  </body>
  </html>
  ```
  </TabItem>
  <TabItem value="controller" label="Controllerï¼ˆæ§åˆ¶å™¨ï¼‰">
  ```java
// Controllerï¼ˆæ§åˆ¶å™¨ï¼‰- å¤„ç†è¯·æ±‚å’Œå“åº”
@Controller
@RequestMapping("/users")
public class UserController {
    @Autowired
    private UserService userService;
    
    @GetMapping
    public String listUsers(Model model) {
        List<User> users = userService.findAll();
        model.addAttribute("users", users);
        return "user/list";
    }
}
```
  </TabItem>
</Tabs>

### 1.2 Spring MVCæ ¸å¿ƒç»„ä»¶

Spring MVCæ¡†æ¶ç”±å¤šä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼Œå®ƒä»¬ååŒå·¥ä½œå¤„ç†webè¯·æ±‚å¹¶ç”Ÿæˆå“åº”ã€‚

```mermaid
flowchart TD
    A[å®¢æˆ·ç«¯è¯·æ±‚] --> B[DispatcherServlet]
    B --> C[HandlerMapping]
    C --> D[HandlerAdapter]
    D --> E[Controller]
    E --> F[ViewResolver]
    F --> G[View]
    G --> H[å®¢æˆ·ç«¯å“åº”]
    
    B -.-> I["å‰ç«¯æ§åˆ¶å™¨"]
    C -.-> J["ç¡®å®šå¤„ç†å™¨"]
    D -.-> K["é€‚é…å¤„ç†å™¨"]
    E -.-> L["å¤„ç†è¯·æ±‚"]
    F -.-> M["è§£æè§†å›¾å"]
    G -.-> N["æ¸²æŸ“è§†å›¾"]
```

<div className="card">
<div className="card__body">

| ç»„ä»¶ | ä½œç”¨ | å®ç°ç±» |
|------|------|--------|
| **DispatcherServlet** | å‰ç«¯æ§åˆ¶å™¨ï¼Œç»Ÿä¸€å¤„ç†è¯·æ±‚ | `org.springframework.web.servlet.DispatcherServlet` |
| **HandlerMapping** | å¤„ç†å™¨æ˜ å°„ï¼Œæ ¹æ®URLæ‰¾åˆ°Handler | `RequestMappingHandlerMapping` |
| **HandlerAdapter** | å¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰§è¡ŒHandler | `RequestMappingHandlerAdapter` |
| **ViewResolver** | è§†å›¾è§£æå™¨ï¼Œè§£æè§†å›¾åç§° | `InternalResourceViewResolver` |
| **Handler** | å¤„ç†å™¨ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ | `@Controller`æ³¨è§£çš„ç±» |
| **View** | è§†å›¾ï¼Œæ¸²æŸ“å“åº” | JSPã€Thymeleafç­‰ |

</div>
</div>

:::info ç»„ä»¶åä½œ
Spring MVCé€šè¿‡è¿™äº›æ ¸å¿ƒç»„ä»¶çš„åä½œï¼Œå®ç°äº†è¯·æ±‚çš„ç»Ÿä¸€å¤„ç†å’Œå“åº”çš„ç»Ÿä¸€è¿”å›ï¼Œæä¾›äº†æ¾è€¦åˆçš„Webå¼€å‘æ¶æ„ã€‚
:::

## 2. Spring MVCè¯·æ±‚å¤„ç†æµç¨‹

### 2.1 è¯·æ±‚å¤„ç†æµç¨‹è¯¦è§£

Spring MVCçš„è¯·æ±‚å¤„ç†æµç¨‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„è´£ä»»é“¾æ¨¡å¼å®ç°ï¼š

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant DS as DispatcherServlet
    participant HM as HandlerMapping
    participant HA as HandlerAdapter
    participant H as Handler(Controller)
    participant VR as ViewResolver
    participant V as View
    
    Client->>DS: HTTPè¯·æ±‚
    DS->>HM: getHandler(request)
    HM-->>DS: è¿”å›Handler
    DS->>HA: handle(request, response, handler)
    HA->>H: è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•
    H-->>HA: è¿”å›ModelAndView
    HA-->>DS: è¿”å›ModelAndView
    
    alt è§†å›¾æ¸²æŸ“
        DS->>VR: resolveViewName(viewName, locale)
        VR-->>DS: è¿”å›Viewå¯¹è±¡
        DS->>V: render(model, request, response)
        V-->>Client: HTTPå“åº”
    else REST API
        DS-->>Client: ç›´æ¥è¿”å›æ•°æ®(JSON/XML)
    end
```

<details>
<summary>è¯·æ±‚å¤„ç†æµç¨‹ç¤ºä¾‹ä»£ç </summary>

```java title="è¯·æ±‚å¤„ç†æµç¨‹"
public class RequestProcessingFlow {
    
    public void processRequest(HttpServletRequest request, HttpServletResponse response) {
        try {
            // 1. è¯·æ±‚è¿›å…¥DispatcherServlet
            DispatcherServlet dispatcher = new DispatcherServlet();
            
            // 2. è·å–HandlerMapping
            HandlerMapping handlerMapping = getHandlerMapping();
            
            // 3. æ ¹æ®è¯·æ±‚URLæ‰¾åˆ°å¯¹åº”çš„Handler
            Object handler = handlerMapping.getHandler(request);
            
            // 4. è·å–HandlerAdapter
            HandlerAdapter handlerAdapter = getHandlerAdapter(handler);
            
            // 5. æ‰§è¡ŒHandleræ–¹æ³•
            ModelAndView mv = handlerAdapter.handle(request, response, handler);
            
            // 6. å¤„ç†è§†å›¾
            if (mv != null) {
                processView(request, response, mv);
            }
            
        } catch (Exception e) {
            // å¼‚å¸¸å¤„ç†
            handleException(request, response, e);
        }
    }
    
    private HandlerMapping getHandlerMapping() {
        return new RequestMappingHandlerMapping();
    }
    
    private HandlerAdapter getHandlerAdapter(Object handler) {
        return new RequestMappingHandlerAdapter();
    }
    
    private void processView(HttpServletRequest request, HttpServletResponse response, ModelAndView mv) {
        ViewResolver viewResolver = new InternalResourceViewResolver();
        View view = viewResolver.resolveViewName(mv.getViewName(), Locale.getDefault());
        view.render(mv.getModel(), request, response);
    }
}
```

</details>

#### è¯¦ç»†æµç¨‹è¯´æ˜
<div className="card">
<div className="card__body">

1. **è¯·æ±‚æ¥æ”¶**ï¼šå®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚åˆ°DispatcherServlet
2. **Handleræ˜ å°„**ï¼šé€šè¿‡HandlerMappingæ‰¾åˆ°å¯¹åº”çš„Handler
3. **Handleré€‚é…**ï¼šé€šè¿‡HandlerAdapteré€‚é…å¹¶æ‰§è¡ŒHandler
4. **ä¸šåŠ¡å¤„ç†**ï¼šHandleræ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ModelAndView
5. **è§†å›¾è§£æ**ï¼šé€šè¿‡ViewResolverè§£æè§†å›¾åç§°
6. **è§†å›¾æ¸²æŸ“**ï¼šæ¸²æŸ“è§†å›¾å¹¶è¿”å›å“åº”

</div>
</div>

### 2.2 æ ¸å¿ƒæ¥å£è¯¦è§£

<Tabs>
  <TabItem value="handlerMapping" label="HandlerMapping" default>
  ```java
// HandlerMappingæ¥å£
public interface HandlerMapping {
    Object getHandler(HttpServletRequest request) throws Exception;
}

  // å®ç°ç±»
  public class RequestMappingHandlerMapping implements HandlerMapping {
      @Override
      public Object getHandler(HttpServletRequest request) throws Exception {
          // æ ¹æ®è¯·æ±‚URLæ‰¾åˆ°å¯¹åº”çš„Handler
          String uri = request.getRequestURI();
          // æŸ¥æ‰¾æ˜ å°„å…³ç³»
          return findHandler(uri);
      }
  }
  ```
  </TabItem>
  <TabItem value="handlerAdapter" label="HandlerAdapter">
  ```java
// HandlerAdapteræ¥å£
public interface HandlerAdapter {
    boolean supports(Object handler);
    ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception;
}

  // å®ç°ç±»
  public class RequestMappingHandlerAdapter implements HandlerAdapter {
      @Override
      public boolean supports(Object handler) {
          return handler instanceof HandlerMethod;
      }
      
      @Override
      public ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
          // è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•
          return invokeHandlerMethod(request, response, (HandlerMethod) handler);
      }
  }
  ```
  </TabItem>
  <TabItem value="viewResolver" label="ViewResolver">
  ```java
// ViewResolveræ¥å£
public interface ViewResolver {
    View resolveViewName(String viewName, Locale locale) throws Exception;
}

// Viewæ¥å£
public interface View {
    void render(Map<String, ?> model, HttpServletRequest request, HttpServletResponse response) throws Exception;
}
  
  // å®ç°ç±»
  public class InternalResourceViewResolver implements ViewResolver {
      private String prefix;
      private String suffix;
      
      @Override
      public View resolveViewName(String viewName, Locale locale) throws Exception {
          // è§£æè§†å›¾åç§°ï¼Œå¦‚"user/list" -> "/WEB-INF/views/user/list.jsp"
          String viewPath = prefix + viewName + suffix;
          return new JstlView(viewPath);
      }
  }
  ```
  </TabItem>
</Tabs>

## 3. æ§åˆ¶å™¨å¼€å‘

### 3.1 æ§åˆ¶å™¨åŸºç¡€

æ§åˆ¶å™¨æ˜¯Spring MVCçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¤„ç†HTTPè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚

```mermaid
classDiagram
    class Controller {
        <<interface>>
    }
    
    class AbstractController {
        <<abstract>>
    }
    
    class SimpleFormController {
    }
    
    class MultiActionController {
    }
    
    class AnnotatedController {
        +@Controller
        +@RequestMapping
        +@GetMapping
        +@PostMapping
    }
    
    Controller <|-- AbstractController
    AbstractController <|-- SimpleFormController
    AbstractController <|-- MultiActionController
    Controller <|.. AnnotatedController
    
    note for AnnotatedController "ç°ä»£Spring MVCä¸»è¦ä½¿ç”¨æ³¨è§£æ§åˆ¶å™¨"
```

<div className="card">
<div className="card__body">

```java title="åŸºç¡€æ§åˆ¶å™¨"
@Controller
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // GETè¯·æ±‚ - è·å–ç”¨æˆ·åˆ—è¡¨
    @GetMapping
    public ResponseEntity<List<User>> getUsers() {
        List<User> users = userService.findAll();
        return ResponseEntity.ok(users);
    }
    
    // GETè¯·æ±‚ - è·å–å•ä¸ªç”¨æˆ·
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user != null) {
            return ResponseEntity.ok(user);
        }
        return ResponseEntity.notFound().build();
    }
    
    // POSTè¯·æ±‚ - åˆ›å»ºç”¨æˆ·
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(savedUser);
    }
    
    // PUTè¯·æ±‚ - æ›´æ–°ç”¨æˆ·
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(@PathVariable Long id, @RequestBody User user) {
        user.setId(id);
        User updatedUser = userService.update(user);
        return ResponseEntity.ok(updatedUser);
    }
    
    // DELETEè¯·æ±‚ - åˆ é™¤ç”¨æˆ·
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
        return ResponseEntity.noContent().build();
    }
}
```

</div>
</div>

### 3.2 è¯·æ±‚æ˜ å°„æ³¨è§£

Spring MVCæä¾›äº†ä¸°å¯Œçš„è¯·æ±‚æ˜ å°„æ³¨è§£ï¼Œæ”¯æŒå„ç§HTTPæ–¹æ³•å’Œå‚æ•°ç»‘å®šï¼š

<Tabs>
  <TabItem value="requestMapping" label="@RequestMapping" default>
  ```java
  // @RequestMapping - é€šç”¨æ˜ å°„
    @RequestMapping(value = "/users", method = RequestMethod.GET)
    public String getUsers() {
        return "user/list";
    }
    
  // å¯ä»¥åœ¨ç±»çº§åˆ«ä½¿ç”¨
  @Controller
  @RequestMapping("/users")
  public class UserController {
      // æ–¹æ³•æ˜ å°„ä¼šç›¸å¯¹äºç±»æ˜ å°„
      @RequestMapping("/{id}")  // å®é™…è·¯å¾„ä¸º/users/{id}
      public String getUser(@PathVariable Long id) {
          return "user/detail";
      }
  }
  ```
  </TabItem>
  <TabItem value="httpMethods" label="HTTPæ–¹æ³•æ³¨è§£">
  ```java
  // @GetMapping - GETè¯·æ±‚æ˜ å°„
    @GetMapping("/users/{id}")
    public String getUser(@PathVariable Long id) {
        return "user/detail";
    }
    
  // @PostMapping - POSTè¯·æ±‚æ˜ å°„
    @PostMapping("/users")
    public String createUser(@ModelAttribute User user) {
        return "redirect:/users";
    }
    
  // @PutMapping - PUTè¯·æ±‚æ˜ å°„
    @PutMapping("/users/{id}")
    public String updateUser(@PathVariable Long id, @RequestBody User user) {
        return "user/updated";
    }
    
  // @DeleteMapping - DELETEè¯·æ±‚æ˜ å°„
    @DeleteMapping("/users/{id}")
    public String deleteUser(@PathVariable Long id) {
        return "user/deleted";
    }
    
  // @PatchMapping - PATCHè¯·æ±‚æ˜ å°„
    @PatchMapping("/users/{id}")
    public String patchUser(@PathVariable Long id, @RequestBody User user) {
        return "user/patched";
}
```
  </TabItem>
</Tabs>

:::tip æ³¨è§£é€‰æ‹©
- ä½¿ç”¨å…·ä½“çš„HTTPæ–¹æ³•æ³¨è§£ï¼ˆ@GetMappingã€@PostMappingç­‰ï¼‰æ¯”@RequestMappingæ›´æ¸…æ™°
- å¯¹äºRESTful APIï¼Œæ¨èä½¿ç”¨@RestControlleræ³¨è§£
- å¯¹äºä¼ ç»ŸWebåº”ç”¨ï¼Œä½¿ç”¨@Controlleræ³¨è§£
:::

### 3.3 å‚æ•°ç»‘å®šæ³¨è§£

Spring MVCæä¾›äº†å¤šç§å‚æ•°ç»‘å®šæ³¨è§£ï¼Œæ”¯æŒå„ç§å‚æ•°ç±»å‹çš„è‡ªåŠ¨ç»‘å®šï¼š

```mermaid
graph TD
    A[å‚æ•°ç»‘å®šæ³¨è§£] --> B["@PathVariable"]
    A --> C["@RequestParam"]
    A --> D["@RequestBody"]
    A --> E["@ModelAttribute"]
    A --> F["@RequestHeader"]
    A --> G["@CookieValue"]
    A --> H["@SessionAttribute"]
    A --> I["@RequestPart"]
    
    B --> B1["ç»‘å®šè·¯å¾„å˜é‡"]
    C --> C1["ç»‘å®šè¯·æ±‚å‚æ•°"]
    D --> D1["ç»‘å®šè¯·æ±‚ä½“"]
    E --> E1["ç»‘å®šæ¨¡å‹å±æ€§"]
    F --> F1["ç»‘å®šè¯·æ±‚å¤´"]
    G --> G1["ç»‘å®šCookieå€¼"]
    H --> H1["ç»‘å®šä¼šè¯å±æ€§"]
    I --> I1["ç»‘å®šæ–‡ä»¶ä¸Šä¼ "]
```

<Tabs>
  <TabItem value="path" label="@PathVariable" default>
  ```java
  // @PathVariable - è·¯å¾„å˜é‡
    @GetMapping("/users/{id}/orders/{orderId}")
    public String getUserOrder(@PathVariable Long id, @PathVariable Long orderId) {
        return "user/order";
    }
  ```
  </TabItem>
  <TabItem value="param" label="@RequestParam">
  ```java
  // @RequestParam - è¯·æ±‚å‚æ•°
    @GetMapping("/search")
    public String search(@RequestParam String keyword, 
                        @RequestParam(defaultValue = "1") int page,
                        @RequestParam(required = false) String sort) {
        return "search/result";
    }
  ```
  </TabItem>
  <TabItem value="body" label="@RequestBody">
  ```java
  // @RequestBody - è¯·æ±‚ä½“
    @PostMapping("/api/users")
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.ok(savedUser);
    }
  ```
  </TabItem>
  <TabItem value="other" label="å…¶ä»–å‚æ•°æ³¨è§£">
  ```java
  // @ModelAttribute - æ¨¡å‹å±æ€§
    @PostMapping("/users")
    public String createUser(@ModelAttribute User user, Model model) {
        userService.save(user);
        model.addAttribute("message", "ç”¨æˆ·åˆ›å»ºæˆåŠŸ");
        return "user/success";
    }
    
  // @RequestHeader - è¯·æ±‚å¤´
    @GetMapping("/api/data")
    public ResponseEntity<String> getData(@RequestHeader("Authorization") String auth) {
        return ResponseEntity.ok("æ•°æ®");
    }
    
  // @CookieValue - Cookieå€¼
    @GetMapping("/preferences")
    public String getPreferences(@CookieValue("theme") String theme) {
        return "preferences";
    }
    
  // @SessionAttribute - ä¼šè¯å±æ€§
    @GetMapping("/profile")
    public String getProfile(@SessionAttribute("user") User user) {
        return "user/profile";
    }
    
  // @RequestPart - æ–‡ä»¶ä¸Šä¼ 
    @PostMapping("/upload")
    public String uploadFile(@RequestPart("file") MultipartFile file) {
        return "upload/success";
}
```
  </TabItem>
</Tabs>

## 4. æ‹¦æˆªå™¨æœºåˆ¶

### 4.1 æ‹¦æˆªå™¨åŸºç¡€

æ‹¦æˆªå™¨æ˜¯Spring MVCçš„é‡è¦ç‰¹æ€§ï¼Œå…è®¸åœ¨è¯·æ±‚å¤„ç†çš„ä¸åŒé˜¶æ®µè¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ã€‚

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant DS as DispatcherServlet
    participant I as æ‹¦æˆªå™¨(Interceptor)
    participant C as æ§åˆ¶å™¨(Controller)
    
    Client->>DS: è¯·æ±‚
    DS->>I: preHandle()
    
    alt preHandleè¿”å›true
        I-->>DS: ç»§ç»­å¤„ç†
        DS->>C: è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•
        C-->>DS: è¿”å›ç»“æœ
        DS->>I: postHandle()
        DS->>I: afterCompletion()
        DS-->>Client: å“åº”
    else preHandleè¿”å›false
        I-->>DS: ä¸­æ–­è¯·æ±‚
        DS-->>Client: ç›´æ¥å“åº”
    end
```

<div className="card">
<div className="card__body">

```java title="æ‹¦æˆªå™¨å®ç°"
// å®ç°HandlerInterceptoræ¥å£
public class LoggingInterceptor implements HandlerInterceptor {
    
    private static final Logger logger = LoggerFactory.getLogger(LoggingInterceptor.class);
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        logger.info("è¯·æ±‚å¼€å§‹: {} {}", request.getMethod(), request.getRequestURI());
        request.setAttribute("startTime", System.currentTimeMillis());
        return true; // è¿”å›trueç»§ç»­æ‰§è¡Œï¼Œè¿”å›falseä¸­æ–­è¯·æ±‚
    }
    
    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        logger.info("è¯·æ±‚å¤„ç†å®Œæˆ: {} {}", request.getMethod(), request.getRequestURI());
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        long startTime = (Long) request.getAttribute("startTime");
        long endTime = System.currentTimeMillis();
        logger.info("è¯·æ±‚å®Œæˆ: {} {} è€—æ—¶: {}ms", request.getMethod(), request.getRequestURI(), endTime - startTime);
    }
}
```

</div>
</div>

<div className="card">
<div className="card__header">
<h4>æ‹¦æˆªå™¨æ–¹æ³•è¯´æ˜</h4>
</div>
<div className="card__body">

| æ–¹æ³• | æ‰§è¡Œæ—¶æœº | ç”¨é€” | èƒ½å¦ä¸­æ–­è¯·æ±‚ |
|------|---------|------|------------|
| **preHandle** | æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰ | å‰ç½®æ£€æŸ¥ã€è®¤è¯æˆæƒ | å¯ä»¥ |
| **postHandle** | æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œåï¼Œè§†å›¾æ¸²æŸ“å‰ | æ¨¡å‹æ•°æ®ä¿®æ”¹ã€è§†å›¾é€‰æ‹© | ä¸å¯ä»¥ |
| **afterCompletion** | è§†å›¾æ¸²æŸ“å®Œæˆå | æ¸…ç†èµ„æºã€æ—¥å¿—è®°å½• | ä¸å¯ä»¥ |

</div>
</div>

### 4.2 æ‹¦æˆªå™¨åº”ç”¨

<Tabs>
  <TabItem value="auth" label="è®¤è¯æ‹¦æˆªå™¨" default>
```java title="è®¤è¯æ‹¦æˆªå™¨"
public class AuthenticationInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String token = request.getHeader("Authorization");
        
        if (token == null || !isValidToken(token)) {
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            return false;
        }
        
        // è®¾ç½®ç”¨æˆ·ä¿¡æ¯åˆ°è¯·æ±‚å±æ€§
        User user = getUserFromToken(token);
        request.setAttribute("currentUser", user);
        
        return true;
    }
    
    private boolean isValidToken(String token) {
        return token != null && token.startsWith("Bearer ");
    }
    
    private User getUserFromToken(String token) {
        // ä»tokenä¸­è·å–ç”¨æˆ·ä¿¡æ¯
        return new User();
    }
}
```
  </TabItem>
  <TabItem value="perm" label="æƒé™æ‹¦æˆªå™¨">
```java title="æƒé™æ‹¦æˆªå™¨"
public class AuthorizationInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        User user = (User) request.getAttribute("currentUser");
        
        if (user == null) {
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            return false;
        }
        
        // æ£€æŸ¥ç”¨æˆ·æƒé™
        if (!hasPermission(user, request.getRequestURI())) {
            response.setStatus(HttpServletResponse.SC_FORBIDDEN);
            return false;
        }
        
        return true;
    }
    
    private boolean hasPermission(User user, String uri) {
        return user.getPermissions().contains(uri);
    }
}
```
  </TabItem>
  <TabItem value="config" label="æ‹¦æˆªå™¨é…ç½®">
```java title="æ‹¦æˆªå™¨é…ç½®"
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // æ·»åŠ æ—¥å¿—æ‹¦æˆªå™¨
        registry.addInterceptor(new LoggingInterceptor())
                .addPathPatterns("/**")
                .excludePathPatterns("/static/**", "/error");
        
        // æ·»åŠ è®¤è¯æ‹¦æˆªå™¨
        registry.addInterceptor(new AuthenticationInterceptor())
                .addPathPatterns("/api/**")
                  .excludePathPatterns("/api/login", "/api/register");
        
        // æ·»åŠ æƒé™æ‹¦æˆªå™¨
        registry.addInterceptor(new AuthorizationInterceptor())
                  .addPathPatterns("/api/**")
                  .excludePathPatterns("/api/login", "/api/register", "/api/public/**");
    }
}
```
  </TabItem>
</Tabs>

## 5. å¼‚å¸¸å¤„ç†

### 5.1 å…¨å±€å¼‚å¸¸å¤„ç†

Spring MVCæä¾›äº†å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥ç»Ÿä¸€å¤„ç†åº”ç”¨ä¸­çš„å¼‚å¸¸ï¼š

```mermaid
flowchart TD
    A[å®¢æˆ·ç«¯è¯·æ±‚] --> B[DispatcherServlet]
    B --> C[æ§åˆ¶å™¨æ–¹æ³•]
    C -- æŠ›å‡ºå¼‚å¸¸ --> D[å¼‚å¸¸è§£æå™¨]
    D --> E["@ExceptionHandleræ–¹æ³•"]
    D --> F["SimpleMappingExceptionResolver"]
    D --> G["DefaultHandlerExceptionResolver"]
    E --> H[é”™è¯¯è§†å›¾/å“åº”]
    F --> H
    G --> H
    H --> I[å®¢æˆ·ç«¯]
```

<Tabs>
  <TabItem value="handler" label="@ExceptionHandler" default>
  ```java title="æ–¹æ³•çº§å¼‚å¸¸å¤„ç†"
  @Controller
  public class UserController {
      
      // æ§åˆ¶å™¨å†…çš„å¼‚å¸¸å¤„ç†
      @ExceptionHandler(UserNotFoundException.class)
      public ResponseEntity<ErrorResponse> handleUserNotFoundException(UserNotFoundException ex) {
        ErrorResponse error = new ErrorResponse();
          error.setMessage(ex.getMessage());
          error.setStatus(HttpStatus.NOT_FOUND.value());
          
          return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
      }
      
      @GetMapping("/users/{id}")
      public ResponseEntity<User> getUser(@PathVariable Long id) {
          User user = userService.findById(id);
          if (user == null) {
              throw new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨: " + id);
          }
          return ResponseEntity.ok(user);
      }
  }
  ```
  </TabItem>
  <TabItem value="advice" label="@ControllerAdvice">
  ```java title="å…¨å±€å¼‚å¸¸å¤„ç†"
  @ControllerAdvice
  public class GlobalExceptionHandler {
      
      @ExceptionHandler(UserNotFoundException.class)
      public ResponseEntity<ErrorResponse> handleUserNotFoundException(UserNotFoundException ex) {
        ErrorResponse error = new ErrorResponse();
          error.setMessage(ex.getMessage());
          error.setStatus(HttpStatus.NOT_FOUND.value());
          
          return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
      }
      
      @ExceptionHandler(ValidationException.class)
      public ResponseEntity<ErrorResponse> handleValidationException(ValidationException ex) {
        ErrorResponse error = new ErrorResponse();
          error.setMessage("å‚æ•°éªŒè¯å¤±è´¥");
          error.setStatus(HttpStatus.BAD_REQUEST.value());
          error.setErrors(ex.getErrors());
          
          return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
      }
      
    @ExceptionHandler(Exception.class)
      public ResponseEntity<ErrorResponse> handleGenericException(Exception ex) {
        ErrorResponse error = new ErrorResponse();
          error.setMessage("æœåŠ¡å™¨å†…éƒ¨é”™è¯¯");
          error.setStatus(HttpStatus.INTERNAL_SERVER_ERROR.value());
        
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);
    }
}
```
  </TabItem>
  <TabItem value="resolver" label="å¼‚å¸¸è§£æå™¨">
  ```java title="è‡ªå®šä¹‰å¼‚å¸¸è§£æå™¨"
  @Configuration
  public class WebMvcConfig implements WebMvcConfigurer {
      
      @Override
      public void configureHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {
          SimpleMappingExceptionResolver exceptionResolver = new SimpleMappingExceptionResolver();
          
          // é…ç½®å¼‚å¸¸æ˜ å°„
          Properties mappings = new Properties();
          mappings.setProperty("UserNotFoundException", "error/not-found");
          mappings.setProperty("AccessDeniedException", "error/access-denied");
          exceptionResolver.setExceptionMappings(mappings);
          
          // è®¾ç½®é»˜è®¤é”™è¯¯é¡µ
          exceptionResolver.setDefaultErrorView("error/generic");
          exceptionResolver.setExceptionAttribute("exception");
          
          resolvers.add(exceptionResolver);
      }
  }
  ```
  </TabItem>
</Tabs>

### 5.2 è‡ªå®šä¹‰å¼‚å¸¸

```java title="è‡ªå®šä¹‰å¼‚å¸¸ç±»"
// ç”¨æˆ·ä¸å­˜åœ¨å¼‚å¸¸
public class UserNotFoundException extends RuntimeException {
    public UserNotFoundException(String message) {
        super(message);
    }
}

// éªŒè¯å¼‚å¸¸
public class ValidationException extends RuntimeException {
    private List<String> errors;
    
    public ValidationException(String message, List<String> errors) {
        super(message);
        this.errors = errors;
    }
    
    public List<String> getErrors() {
        return errors;
    }
}
```

## 6. æ•°æ®éªŒè¯

### 6.1 Beanæ ¡éªŒ

Spring MVCé›†æˆäº†Bean Validation APIï¼Œæ”¯æŒå£°æ˜å¼æ•°æ®éªŒè¯ï¼š

```mermaid
graph LR
    A[è¡¨å•æäº¤/APIè¯·æ±‚] --> B[æ§åˆ¶å™¨]
    B --> C[å‚æ•°æ ¡éªŒ]
    C --> D{æ ¡éªŒé€šè¿‡?}
    D -- æ˜¯ --> E[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]
    D -- å¦ --> F[è¿”å›æ ¡éªŒé”™è¯¯]
    
    C -.-> G["@Valid"]
    C -.-> H["BindingResult"]
```

<div className="card">
<div className="card__body">

```java title="BeanéªŒè¯ç¤ºä¾‹"
// éªŒè¯æ¨¡å‹
public class UserDTO {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 4, max = 50, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨4-50ä¹‹é—´")
    private String username;
    
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$", message = "å¯†ç è‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—")
    private String password;
    
    @NotBlank(message = "ç”µå­é‚®ä»¶ä¸èƒ½ä¸ºç©º")
    @Email(message = "ç”µå­é‚®ä»¶æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Min(value = 18, message = "å¹´é¾„å¿…é¡»å¤§äºç­‰äº18")
    private int age;
    
    // getterå’Œsetteræ–¹æ³•
}

// æ§åˆ¶å™¨ä¸­ä½¿ç”¨
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @PostMapping("/register")
    public ResponseEntity<?> register(@Valid @RequestBody UserDTO userDTO, BindingResult result) {
        if (result.hasErrors()) {
            Map<String, String> errors = new HashMap<>();
            result.getFieldErrors().forEach(err -> 
                errors.put(err.getField(), err.getDefaultMessage())
            );
            return ResponseEntity.badRequest().body(errors);
        }
        
        // ä¸šåŠ¡å¤„ç†
        return ResponseEntity.ok("ç”¨æˆ·æ³¨å†ŒæˆåŠŸ");
    }
}
```

</div>
</div>

### 6.2 å¸¸ç”¨æ ¡éªŒæ³¨è§£

<div className="card">
<div className="card__body">

| æ³¨è§£ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **@NotNull** | ä¸èƒ½ä¸ºnull | `@NotNull(message = "ä¸èƒ½ä¸ºç©º")` |
| **@NotEmpty** | ä¸èƒ½ä¸ºç©ºå­—ç¬¦ä¸²æˆ–é›†åˆ | `@NotEmpty(message = "ä¸èƒ½ä¸ºç©º")` |
| **@NotBlank** | ä¸èƒ½ä¸ºç©ºç™½å­—ç¬¦ä¸² | `@NotBlank(message = "ä¸èƒ½ä¸ºç©ºç™½")` |
| **@Size** | é•¿åº¦æˆ–å¤§å°é™åˆ¶ | `@Size(min = 2, max = 10)` |
| **@Min/@Max** | æœ€å°/æœ€å¤§å€¼ | `@Min(value = 18)` |
| **@Pattern** | æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ | `@Pattern(regexp = "\\d+")` |
| **@Email** | ç”µå­é‚®ä»¶æ ¼å¼ | `@Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")` |
| **@Future/@Past** | æ—¥æœŸåœ¨å½“å‰æ—¶é—´ä¹‹å/ä¹‹å‰ | `@Future(message = "å¿…é¡»æ˜¯å°†æ¥æ—¶é—´")` |
| **@AssertTrue** | å¿…é¡»ä¸ºtrue | `@AssertTrue(message = "å¿…é¡»æ¥å—åè®®")` |

</div>
</div>

### 6.3 åˆ†ç»„æ ¡éªŒ

```java title="åˆ†ç»„æ ¡éªŒç¤ºä¾‹"
// å®šä¹‰éªŒè¯ç»„
public interface Create {}
public interface Update {}

// æ¨¡å‹ä½¿ç”¨åˆ†ç»„
public class UserDTO {
    @NotNull(groups = {Update.class})
    private Long id;
    
    @NotBlank(groups = {Create.class, Update.class})
    private String username;
    
    @NotBlank(groups = {Create.class})
    @Null(groups = {Update.class})
    private String password;
    
    // getterå’Œsetteræ–¹æ³•
}

// æ§åˆ¶å™¨ä½¿ç”¨åˆ†ç»„
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @PostMapping
    public ResponseEntity<?> create(@Validated(Create.class) @RequestBody UserDTO user, BindingResult result) {
        if (result.hasErrors()) {
            return ResponseEntity.badRequest().body(getErrors(result));
        }
        return ResponseEntity.ok("ç”¨æˆ·åˆ›å»ºæˆåŠŸ");
    }
    
    @PutMapping("/{id}")
    public ResponseEntity<?> update(@Validated(Update.class) @RequestBody UserDTO user, BindingResult result) {
        if (result.hasErrors()) {
            return ResponseEntity.badRequest().body(getErrors(result));
        }
        return ResponseEntity.ok("ç”¨æˆ·æ›´æ–°æˆåŠŸ");
    }
    
    private Map<String, String> getErrors(BindingResult result) {
        Map<String, String> errors = new HashMap<>();
        result.getFieldErrors().forEach(err -> 
            errors.put(err.getField(), err.getDefaultMessage())
        );
        return errors;
    }
}
```

## 7. æ–‡ä»¶ä¸Šä¼ 

### 7.1 æ–‡ä»¶ä¸Šä¼ é…ç½®

Spring MVCæä¾›äº†å†…ç½®çš„æ–‡ä»¶ä¸Šä¼ æ”¯æŒï¼Œå¯ä»¥è½»æ¾å¤„ç†æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼š

```mermaid
flowchart TD
    A[å®¢æˆ·ç«¯] -->|multipart/form-data| B[MultipartResolver]
    B --> C[æ§åˆ¶å™¨]
    C --> D[å­˜å‚¨é€»è¾‘]
    D --> E[æ–‡ä»¶ç³»ç»Ÿ]
    D --> F[æ•°æ®åº“]
    D --> G[äº‘å­˜å‚¨]
```

<Tabs>
  <TabItem value="config" label="ä¸Šä¼ é…ç½®" default>
  ```java title="ä¸Šä¼ é…ç½®"
@Configuration
public class FileUploadConfig {
    
    @Bean
    public MultipartResolver multipartResolver() {
        CommonsMultipartResolver resolver = new CommonsMultipartResolver();
        resolver.setMaxUploadSize(10 * 1024 * 1024); // 10MB
        resolver.setMaxUploadSizePerFile(5 * 1024 * 1024); // 5MB
        resolver.setDefaultEncoding("UTF-8");
        return resolver;
    }
}
  
  // æˆ–ä½¿ç”¨SpringBootä¸­çš„é…ç½®
  @SpringBootApplication
  public class Application {
      
      public static void main(String[] args) {
          SpringApplication.run(Application.class, args);
      }
  }
  
  // application.yml
  /*
  spring:
    servlet:
      multipart:
        max-file-size: 5MB
        max-request-size: 10MB
        enabled: true
  */
  ```
  </TabItem>
  <TabItem value="controller" label="æ§åˆ¶å™¨å®ç°">
```java title="æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨"
@Controller
public class FileUploadController {
      
      @Value("${file.upload-dir}")
      private String uploadDir;
    
    @PostMapping("/upload")
    public String uploadFile(@RequestParam("file") MultipartFile file, Model model) {
        if (file.isEmpty()) {
              model.addAttribute("message", "è¯·é€‰æ‹©æ–‡ä»¶");
            return "upload/form";
        }
        
        try {
              // ç”Ÿæˆæ–‡ä»¶å
              String fileName = UUID.randomUUID().toString() + 
                  "_" + file.getOriginalFilename();
              
              // ç¡®ä¿ç›®å½•å­˜åœ¨
              Path uploadPath = Paths.get(uploadDir);
              if (!Files.exists(uploadPath)) {
                  Files.createDirectories(uploadPath);
              }
              
            // ä¿å­˜æ–‡ä»¶
              Path filePath = uploadPath.resolve(fileName);
              Files.copy(file.getInputStream(), filePath, StandardCopyOption.REPLACE_EXISTING);
              
            model.addAttribute("message", "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ: " + fileName);
              return "upload/success";
          } catch (IOException e) {
              model.addAttribute("message", "æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
              return "upload/form";
          }
      }
      
      @GetMapping("/upload")
      public String showUploadForm() {
          return "upload/form";
      }
  }
  ```
  </TabItem>
  <TabItem value="multifiles" label="å¤šæ–‡ä»¶ä¸Šä¼ ">
  ```java title="å¤šæ–‡ä»¶ä¸Šä¼ "
  @Controller
  public class MultiFileUploadController {
      
      @PostMapping("/upload/multi")
      public String uploadMultipleFiles(@RequestParam("files") MultipartFile[] files, Model model) {
          List<String> uploadedFiles = new ArrayList<>();
          
          for (MultipartFile file : files) {
              if (!file.isEmpty()) {
        try {
            String fileName = saveFile(file);
                      uploadedFiles.add(fileName);
                  } catch (IOException e) {
                      model.addAttribute("message", "æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
                      return "upload/form";
                  }
              }
          }
          
          model.addAttribute("message", "ä¸Šä¼ äº† " + uploadedFiles.size() + " ä¸ªæ–‡ä»¶");
          model.addAttribute("files", uploadedFiles);
          return "upload/success";
    }
    
    private String saveFile(MultipartFile file) throws IOException {
          // æ–‡ä»¶ä¿å­˜é€»è¾‘
          return "savedFileName.ext";
      }
  }
  ```
  </TabItem>
</Tabs>

### 7.2 æ–‡ä»¶ä¸Šä¼ è§†å›¾

<div className="card">
<div className="card__body">

```html title="æ–‡ä»¶ä¸Šä¼ è¡¨å•"
<!-- upload/form.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>æ–‡ä»¶ä¸Šä¼ </title>
</head>
<body>
    <h1>æ–‡ä»¶ä¸Šä¼ </h1>
    
    <div th:if="${message}">
        <p th:text="${message}"></p>
    </div>
    
    <form method="POST" action="/upload" enctype="multipart/form-data">
        <div>
            <label for="file">é€‰æ‹©æ–‡ä»¶:</label>
            <input type="file" id="file" name="file" />
        </div>
        <div>
            <button type="submit">ä¸Šä¼ </button>
        </div>
    </form>
    
    <h2>å¤šæ–‡ä»¶ä¸Šä¼ </h2>
    <form method="POST" action="/upload/multi" enctype="multipart/form-data">
        <div>
            <label for="files">é€‰æ‹©æ–‡ä»¶:</label>
            <input type="file" id="files" name="files" multiple />
        </div>
        <div>
            <button type="submit">ä¸Šä¼ </button>
        </div>
    </form>
</body>
</html>
```

</div>
</div>

## 8. è§†å›¾æŠ€æœ¯

### 8.1 è§†å›¾è§£æå™¨

Spring MVCæ”¯æŒå¤šç§è§†å›¾æŠ€æœ¯ï¼Œé€šè¿‡è§†å›¾è§£æå™¨å°†é€»è¾‘è§†å›¾åè§£æä¸ºå®é™…çš„è§†å›¾å¯¹è±¡ï¼š

```mermaid
graph LR
    A[æ§åˆ¶å™¨] -->|è¿”å›è§†å›¾å| B[ViewResolver]
    B --> C{è§†å›¾ç±»å‹?}
    C -->|JSP| D[InternalResourceViewResolver]
    C -->|Thymeleaf| E[ThymeleafViewResolver]
    C -->|FreeMarker| F[FreeMarkerViewResolver]
    C -->|Velocity| G[VelocityViewResolver]
    D --> H[JstlView]
    E --> I[ThymeleafView]
    F --> J[FreeMarkerView]
    G --> K[VelocityView]
```

<Tabs>
  <TabItem value="jsp" label="JSPè§†å›¾" default>
  ```java title="JSPè§†å›¾è§£æå™¨"
  @Configuration
  public class WebConfig implements WebMvcConfigurer {
      
      @Bean
      public ViewResolver jspViewResolver() {
          InternalResourceViewResolver resolver = new InternalResourceViewResolver();
          resolver.setPrefix("/WEB-INF/views/");
          resolver.setSuffix(".jsp");
          resolver.setViewClass(JstlView.class);
          return resolver;
      }
  }
  
  // æ§åˆ¶å™¨
  @Controller
  public class UserController {
      
      @GetMapping("/users")
      public String listUsers(Model model) {
          // é€»è¾‘è§†å›¾å "user/list" è§£æä¸º "/WEB-INF/views/user/list.jsp"
          return "user/list";
    }
}
```
  </TabItem>
  <TabItem value="thymeleaf" label="Thymeleafè§†å›¾">
  ```java title="Thymeleafè§†å›¾è§£æå™¨"
  @Configuration
  public class ThymeleafConfig {
      
      @Bean
      public SpringTemplateEngine templateEngine() {
          SpringTemplateEngine engine = new SpringTemplateEngine();
          engine.setTemplateResolver(templateResolver());
          return engine;
      }
      
      @Bean
      public ThymeleafViewResolver thymeleafViewResolver() {
          ThymeleafViewResolver resolver = new ThymeleafViewResolver();
          resolver.setTemplateEngine(templateEngine());
          resolver.setCharacterEncoding("UTF-8");
          return resolver;
      }
      
      @Bean
      public SpringResourceTemplateResolver templateResolver() {
          SpringResourceTemplateResolver resolver = new SpringResourceTemplateResolver();
          resolver.setPrefix("classpath:/templates/");
          resolver.setSuffix(".html");
          resolver.setTemplateMode(TemplateMode.HTML);
          resolver.setCharacterEncoding("UTF-8");
          return resolver;
      }
  }
  ```
  </TabItem>
  <TabItem value="multiple" label="å¤šè§†å›¾è§£æå™¨">
  ```java title="å¤šè§†å›¾è§£æå™¨"
  @Configuration
  public class MultipleViewResolversConfig implements WebMvcConfigurer {
      
      @Bean
      public ViewResolver thymeleafViewResolver() {
          ThymeleafViewResolver resolver = new ThymeleafViewResolver();
          resolver.setTemplateEngine(templateEngine());
          resolver.setCharacterEncoding("UTF-8");
          resolver.setOrder(1);
          resolver.setViewNames(new String[] {"*.html"});
          return resolver;
      }
      
      @Bean
      public ViewResolver jspViewResolver() {
          InternalResourceViewResolver resolver = new InternalResourceViewResolver();
          resolver.setPrefix("/WEB-INF/views/");
          resolver.setSuffix(".jsp");
          resolver.setViewClass(JstlView.class);
          resolver.setOrder(2);
          return resolver;
      }
  }
  ```
  </TabItem>
</Tabs>

### 8.2 è§†å›¾å†…å®¹åå•†

Spring MVCæ”¯æŒå†…å®¹åå•†ï¼Œå¯ä»¥æ ¹æ®è¯·æ±‚çš„Acceptå¤´æˆ–URLå‚æ•°è¿”å›ä¸åŒæ ¼å¼çš„å“åº”ï¼š

<div className="card">
<div className="card__body">

```java title="å†…å®¹åå•†é…ç½®"
@Configuration
public class ContentNegotiationConfig implements WebMvcConfigurer {
    
    @Override
    public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        // é€šè¿‡URLå‚æ•°è¿›è¡Œå†…å®¹åå•†
        configurer
            .favorParameter(true)
            .parameterName("format")
            .ignoreAcceptHeader(false)
            .defaultContentType(MediaType.APPLICATION_JSON)
            .mediaType("json", MediaType.APPLICATION_JSON)
            .mediaType("xml", MediaType.APPLICATION_XML);
    }
    
    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.enableContentNegotiation(
                new MappingJackson2JsonView(),
                new MarshallingView(jaxb2Marshaller()),
                pdfView()
        );
    }
    
    @Bean
    public Jaxb2Marshaller jaxb2Marshaller() {
        Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
        marshaller.setPackagesToScan("com.example.model");
        return marshaller;
    }
    
    @Bean
    public View pdfView() {
        return new PdfView();
    }
}

// æ§åˆ¶å™¨
@Controller
public class UserController {
    
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) {
        // æ ¹æ®å†…å®¹åå•†è¿”å›JSONæˆ–XML
        return userService.findById(id);
    }
}
```

</div>
</div>

## 9. RESTful API

### 9.1 RESTful APIè®¾è®¡

RESTful APIè®¾è®¡æ˜¯æ„å»ºç°ä»£WebæœåŠ¡çš„é‡è¦èŒƒå¼ï¼ŒSpring MVCæä¾›äº†å…¨é¢çš„æ”¯æŒï¼š

```mermaid
graph TD
    A[RESTfulè®¾è®¡åŸåˆ™] --> B["èµ„æºå¯¼å‘ï¼ˆåè¯è€ŒéåŠ¨è¯ï¼‰"]
    A --> C["HTTPæ–¹æ³•è¯­ä¹‰ï¼ˆGET/POST/PUT/DELETEï¼‰"]
    A --> D["æ— çŠ¶æ€ï¼ˆæ¯ä¸ªè¯·æ±‚åŒ…å«å®Œæ•´ä¿¡æ¯ï¼‰"]
    A --> E["ç»Ÿä¸€æ¥å£ï¼ˆæ ‡å‡†HTTPçŠ¶æ€ç ï¼‰"]
    A --> F["å¯ç¼“å­˜ï¼ˆæ”¯æŒç¼“å­˜æœºåˆ¶ï¼‰"]
    A --> G["åˆ†å±‚ç³»ç»Ÿï¼ˆå®¢æˆ·ç«¯æ— éœ€äº†è§£åç«¯æ¶æ„ï¼‰"]
```

<div className="card">
<div className="card__body">

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **èµ„æºå¯¼å‘** | ä½¿ç”¨åè¯è€ŒéåŠ¨è¯ | `/users` è€Œä¸æ˜¯ `/getUsers` |
| **HTTPæ–¹æ³•è¯­ä¹‰** | ä½¿ç”¨æ­£ç¡®çš„HTTPæ–¹æ³• | GETã€POSTã€PUTã€DELETE |
| **æ— çŠ¶æ€** | æ¯ä¸ªè¯·æ±‚åŒ…å«å®Œæ•´ä¿¡æ¯ | ä¸ä¾èµ–ä¼šè¯çŠ¶æ€ |
| **ç»Ÿä¸€æ¥å£** | ä½¿ç”¨æ ‡å‡†HTTPçŠ¶æ€ç  | 200ã€201ã€400ã€404ç­‰ |
| **å¯ç¼“å­˜** | æ”¯æŒç¼“å­˜æœºåˆ¶ | ä½¿ç”¨ETagã€Cache-Control |

</div>
</div>

### 9.2 RESTful APIå®ç°

<Tabs>
  <TabItem value="basic" label="åŸºç¡€å®ç°" default>
```java title="RESTful APIæ§åˆ¶å™¨"
@RestController
@RequestMapping("/api/users")
public class UserRestController {
    
    @Autowired
    private UserService userService;
    
    // GET /api/users - è·å–ç”¨æˆ·åˆ—è¡¨
    @GetMapping
    public ResponseEntity<List<User>> getUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size) {
        
        List<User> users = userService.findAll(page, size);
        return ResponseEntity.ok(users);
    }
    
    // GET /api/users/{id} - è·å–å•ä¸ªç”¨æˆ·
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            return ResponseEntity.notFound().build();
        }
        return ResponseEntity.ok(user);
    }
    
    // POST /api/users - åˆ›å»ºç”¨æˆ·
    @PostMapping
    public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED)
                .header("Location", "/api/users/" + savedUser.getId())
                .body(savedUser);
    }
    
    // PUT /api/users/{id} - æ›´æ–°ç”¨æˆ·
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(@PathVariable Long id, @Valid @RequestBody User user) {
        user.setId(id);
        User updatedUser = userService.update(user);
        return ResponseEntity.ok(updatedUser);
    }
    
    // DELETE /api/users/{id} - åˆ é™¤ç”¨æˆ·
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
        return ResponseEntity.noContent().build();
    }
  }
  ```
  </TabItem>
  <TabItem value="hateoas" label="HATEOASæ”¯æŒ">
  ```java title="HATEOASå®ç°"
  @RestController
  @RequestMapping("/api/users")
  public class UserHateoasController {
      
      @Autowired
      private UserService userService;
      
      @GetMapping("/{id}")
      public EntityModel<User> getUser(@PathVariable Long id) {
          User user = userService.findById(id);
          if (user == null) {
              throw new UserNotFoundException(id);
          }
          
          // åˆ›å»ºè¶…é“¾æ¥
          EntityModel<User> resource = EntityModel.of(user);
          
          // æ·»åŠ è‡ªå¼•ç”¨é“¾æ¥
          resource.add(linkTo(methodOn(UserHateoasController.class)
              .getUser(id)).withSelfRel());
              
          // æ·»åŠ ç”¨æˆ·é›†åˆé“¾æ¥
          resource.add(linkTo(methodOn(UserHateoasController.class)
              .getUsers(0, 10)).withRel("users"));
              
          // æ·»åŠ ç”¨æˆ·è®¢å•é“¾æ¥
          resource.add(linkTo(methodOn(OrderController.class)
              .getUserOrders(id)).withRel("orders"));
              
          return resource;
      }
      
      @GetMapping
      public CollectionModel<EntityModel<User>> getUsers(
              @RequestParam(defaultValue = "0") int page,
              @RequestParam(defaultValue = "10") int size) {
              
          List<User> users = userService.findAll(page, size);
          
          List<EntityModel<User>> resources = users.stream()
              .map(user -> EntityModel.of(user, 
                  linkTo(methodOn(UserHateoasController.class)
                      .getUser(user.getId())).withSelfRel(),
                  linkTo(methodOn(UserHateoasController.class)
                      .getUsers(page, size)).withRel("users")))
              .collect(Collectors.toList());
              
          return CollectionModel.of(resources, 
              linkTo(methodOn(UserHateoasController.class)
                  .getUsers(page, size)).withSelfRel());
      }
  }
  ```
  </TabItem>
</Tabs>

### 9.3 APIç‰ˆæœ¬æ§åˆ¶

<div className="card">
<div className="card__body">

```java title="APIç‰ˆæœ¬æ§åˆ¶"
// 1. URLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶
@RestController
@RequestMapping("/api/v1/users")
public class UserApiV1Controller {
    // V1ç‰ˆæœ¬çš„API
}

@RestController
@RequestMapping("/api/v2/users")
public class UserApiV2Controller {
    // V2ç‰ˆæœ¬çš„API
}

// 2. è¯·æ±‚å‚æ•°ç‰ˆæœ¬æ§åˆ¶
@RestController
@RequestMapping("/api/users")
public class UserApiVersionController {
    
    @GetMapping(params = "version=1")
    public ResponseEntity<UserV1> getUserV1(@RequestParam Long id) {
        // V1ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
    }
    
    @GetMapping(params = "version=2")
    public ResponseEntity<UserV2> getUserV2(@RequestParam Long id) {
        // V2ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
    }
}

// 3. è¯·æ±‚å¤´ç‰ˆæœ¬æ§åˆ¶
@RestController
@RequestMapping("/api/users")
public class UserApiHeaderVersionController {
    
    @GetMapping(headers = "X-API-Version=1")
    public ResponseEntity<UserV1> getUserV1(@RequestParam Long id) {
        // V1ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
    }
    
    @GetMapping(headers = "X-API-Version=2")
    public ResponseEntity<UserV2> getUserV2(@RequestParam Long id) {
        // V2ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
    }
}

// 4. Acceptå¤´ç‰ˆæœ¬æ§åˆ¶
@RestController
@RequestMapping("/api/users")
public class UserApiAcceptVersionController {
    
    @GetMapping(produces = "application/vnd.company.app-v1+json")
    public ResponseEntity<UserV1> getUserV1(@RequestParam Long id) {
        // V1ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
    }
    
    @GetMapping(produces = "application/vnd.company.app-v2+json")
    public ResponseEntity<UserV2> getUserV2(@RequestParam Long id) {
        // V2ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
    }
}
```

</div>
</div>

## 10. é¢è¯•é¢˜ç²¾é€‰

### 10.1 åŸºç¡€æ¦‚å¿µé¢˜

<Tabs>
  <TabItem value="q1" label="MVCæµç¨‹" default>
  <div className="card">
  <div className="card__header">
  <h4>Q: Spring MVCçš„è¯·æ±‚å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Spring MVCçš„è¯·æ±‚å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p>
  <ol>
  <li><strong>è¯·æ±‚æ¥æ”¶</strong>ï¼šå®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚åˆ°DispatcherServlet</li>
  <li><strong>Handleræ˜ å°„</strong>ï¼šé€šè¿‡HandlerMappingæ‰¾åˆ°å¯¹åº”çš„Handler</li>
  <li><strong>Handleré€‚é…</strong>ï¼šé€šè¿‡HandlerAdapteré€‚é…å¹¶æ‰§è¡ŒHandler</li>
  <li><strong>ä¸šåŠ¡å¤„ç†</strong>ï¼šHandleræ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ModelAndView</li>
  <li><strong>è§†å›¾è§£æ</strong>ï¼šé€šè¿‡ViewResolverè§£æè§†å›¾åç§°</li>
  <li><strong>è§†å›¾æ¸²æŸ“</strong>ï¼šæ¸²æŸ“è§†å›¾å¹¶è¿”å›å“åº”</li>
  </ol>
  <p>æ•´ä¸ªè¿‡ç¨‹ç”±DispatcherServletç»Ÿä¸€è°ƒåº¦ï¼Œå®ç°äº†å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼Œä½¿å„ç»„ä»¶è§£è€¦å¹¶ååŒå·¥ä½œã€‚</p>
  </div>
  </div>
  </TabItem>
  <TabItem value="q2" label="æ³¨è§£åŒºåˆ«">
  <div className="card">
  <div className="card__header">
  <h4>Q: @RequestMappingå’Œ@GetMappingæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong></p>
  <ul>
  <li><strong>@RequestMapping</strong>æ˜¯é€šç”¨æ³¨è§£ï¼Œå¯ä»¥æŒ‡å®šmethodå±æ€§</li>
  <li><strong>@GetMapping</strong>æ˜¯<code>@RequestMapping(method = RequestMethod.GET)</code>çš„ç®€å†™</li>
  <li><strong>@GetMapping</strong>æ›´ç®€æ´ï¼Œä¸“é—¨ç”¨äºGETè¯·æ±‚</li>
  <li><strong>@RequestMapping</strong>æ›´çµæ´»ï¼Œå¯ä»¥å¤„ç†å¤šç§HTTPæ–¹æ³•</li>
  <li>ç±»ä¼¼çš„è¿˜æœ‰<strong>@PostMapping</strong>ã€<strong>@PutMapping</strong>ã€<strong>@DeleteMapping</strong>ã€<strong>@PatchMapping</strong>ï¼Œéƒ½æ˜¯å¯¹åº”HTTPæ–¹æ³•çš„ç®€å†™å½¢å¼</li>
  </ul>
  </div>
  </div>
  </TabItem>
</Tabs>

### 10.2 å®è·µé¢˜

<Tabs>
  <TabItem value="q3" label="RESTful API" default>
  <div className="card">
  <div className="card__header">
  <h4>Q: å¦‚ä½•å®ç°RESTful APIï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> å®ç°RESTful APIéœ€è¦ï¼š</p>
  <ul>
  <li>ä½¿ç”¨<code>@RestController</code>æ³¨è§£</li>
  <li>ä½¿ç”¨<code>@GetMapping</code>ã€<code>@PostMapping</code>ç­‰æ³¨è§£åŒ¹é…HTTPæ–¹æ³•</li>
  <li>è¿”å›<code>ResponseEntity</code>å¯¹è±¡æ§åˆ¶HTTPçŠ¶æ€ç å’Œå“åº”å¤´</li>
  <li>ä½¿ç”¨<code>@PathVariable</code>å¤„ç†è·¯å¾„å‚æ•°</li>
  <li>ä½¿ç”¨<code>@RequestBody</code>å¤„ç†è¯·æ±‚ä½“</li>
  <li>éµå¾ªRESTè®¾è®¡åŸåˆ™ï¼šèµ„æºå‘½åã€HTTPæ–¹æ³•è¯­ä¹‰ã€æ— çŠ¶æ€ã€ç»Ÿä¸€æ¥å£ç­‰</li>
  <li>ä½¿ç”¨é€‚å½“çš„HTTPçŠ¶æ€ç ï¼š200(OK)ã€201(Created)ã€204(No Content)ã€400(Bad Request)ã€404(Not Found)ç­‰</li>
  </ul>
  <p>å¯¹äºæ›´é«˜çº§çš„RESTful APIï¼Œè¿˜å¯ä»¥è€ƒè™‘ä½¿ç”¨HATEOASæ·»åŠ è¶…é“¾æ¥ï¼Œä½¿APIæ›´å…·è‡ªæè¿°æ€§ã€‚</p>
  </div>
  </div>
  </TabItem>
  <TabItem value="q4" label="æ‹¦æˆªå™¨ä½œç”¨">
  <div className="card">
  <div className="card__header">
  <h4>Q: Spring MVCçš„æ‹¦æˆªå™¨æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Spring MVCçš„æ‹¦æˆªå™¨å¯ä»¥åœ¨è¯·æ±‚å¤„ç†çš„ä¸åŒé˜¶æ®µè¿›è¡Œæ‹¦æˆªå’Œå¤„ç†ï¼Œä¸»è¦ä½œç”¨åŒ…æ‹¬ï¼š</p>
  <ol>
  <li><strong>èº«ä»½éªŒè¯</strong>ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•</li>
  <li><strong>æˆæƒæ£€æŸ¥</strong>ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èµ„æº</li>
  <li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•è¯·æ±‚æ—¥å¿—ï¼Œå¦‚IPã€è¯·æ±‚å‚æ•°ã€æ‰§è¡Œæ—¶é—´ç­‰</li>
  <li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šç›‘æ§è¯·æ±‚æ‰§è¡Œæ—¶é—´</li>
  <li><strong>æ•°æ®è½¬æ¢</strong>ï¼šåœ¨è¯·æ±‚å‰åå¯¹æ•°æ®è¿›è¡Œè½¬æ¢</li>
  <li><strong>å›½é™…åŒ–</strong>ï¼šæ ¹æ®è¯·æ±‚è®¾ç½®è¯­è¨€ç¯å¢ƒ</li>
  <li><strong>ä¸»é¢˜è®¾ç½®</strong>ï¼šæ ¹æ®ç”¨æˆ·è®¾ç½®ä¸»é¢˜</li>
  </ol>
  <p>æ‹¦æˆªå™¨é€šè¿‡å®ç°<code>HandlerInterceptor</code>æ¥å£ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤„ç†çš„preHandleï¼ˆå‰ï¼‰ã€postHandleï¼ˆåï¼‰å’ŒafterCompletionï¼ˆå®Œæˆï¼‰ä¸‰ä¸ªé˜¶æ®µæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</p>
  </div>
  </div>
  </TabItem>
</Tabs>

### 10.3 é«˜çº§é¢˜

<Tabs>
  <TabItem value="q5" label="å¼‚æ­¥å¤„ç†" default>
  <div className="card">
  <div className="card__header">
  <h4>Q: Spring MVCå¦‚ä½•å®ç°å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Spring MVCæ”¯æŒä¸‰ç§å¼‚æ­¥è¯·æ±‚å¤„ç†æ–¹å¼ï¼š</p>
  <ol>
  <li><strong>è¿”å›Callableå¯¹è±¡</strong>ï¼š</li>
  </ol>
  
  ```java
@GetMapping("/async")
public Callable<String> asyncTask() {
    return () -> {
        // å¼‚æ­¥ä»»åŠ¡
        Thread.sleep(5000);
        return "Async result";
    };
}
  ```
  
  <ol start="2">
  <li><strong>è¿”å›DeferredResultå¯¹è±¡</strong>ï¼š</li>
  </ol>
  
  ```java
@GetMapping("/async-deferred")
public DeferredResult<String> asyncDeferredResult() {
    DeferredResult<String> result = new DeferredResult<>();
    taskExecutor.execute(() -> {
        try {
            Thread.sleep(5000);
            result.setResult("Deferred result");
        } catch (Exception e) {
            result.setErrorResult(e);
        }
    });
    return result;
}
  ```
  
  <ol start="3">
  <li><strong>è¿”å›CompletableFutureå¯¹è±¡</strong>ï¼š</li>
  </ol>
  
  ```java
@GetMapping("/async-future")
public CompletableFuture<String> asyncFuture() {
    return CompletableFuture.supplyAsync(() -> {
        try {
            Thread.sleep(5000);
            return "Future result";
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    });
}
  ```
  
  <p>å¼‚æ­¥è¯·æ±‚å¤„ç†çš„å¥½å¤„æ˜¯å¯ä»¥é‡Šæ”¾Webå®¹å™¨çº¿ç¨‹ï¼Œæé«˜ç³»ç»Ÿååé‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚</p>
  </div>
  </div>
  </TabItem>
  <TabItem value="q6" label="å†…å®¹åå•†">
  <div className="card">
  <div className="card__header">
  <h4>Q: Spring MVCçš„å†…å®¹åå•†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> å†…å®¹åå•†(Content Negotiation)æ˜¯æŒ‡æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè¿”å›ä¸åŒæ ¼å¼(å¦‚JSONã€XMLã€PDFç­‰)çš„å“åº”æ•°æ®ã€‚</p>
  <p>å®ç°æ–¹å¼ï¼š</p>
  <ol>
  <li><strong>åŸºäºè¯·æ±‚å¤´Accept</strong>ï¼šæ ¹æ®å®¢æˆ·ç«¯å‘é€çš„Acceptå¤´é€‰æ‹©åˆé€‚çš„å“åº”æ ¼å¼</li>
  <li><strong>åŸºäºURLå‚æ•°</strong>ï¼šé€šè¿‡URLå‚æ•°æŒ‡å®šå“åº”æ ¼å¼ï¼Œå¦‚<code>?format=json</code></li>
  <li><strong>åŸºäºæ–‡ä»¶æ‰©å±•å</strong>ï¼šé€šè¿‡URLè·¯å¾„æ‰©å±•åæŒ‡å®šæ ¼å¼ï¼Œå¦‚<code>/users.json</code></li>
  </ol>
  <p>Spring MVCå®ç°å†…å®¹åå•†çš„æ–¹æ³•ï¼š</p>
  
  ```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer
            .favorParameter(true)
            .parameterName("format")
            .ignoreAcceptHeader(false)
            .defaultContentType(MediaType.APPLICATION_JSON)
            .mediaType("json", MediaType.APPLICATION_JSON)
            .mediaType("xml", MediaType.APPLICATION_XML);
    }
}

@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) {
    // æ ¹æ®å†…å®¹åå•†è¿”å›JSONæˆ–XML
    return userService.findById(id);
}
  ```
  </div>
  </div>
  </TabItem>
</Tabs>

:::tip Spring MVCå­¦ä¹ è¦ç‚¹
1. **ç†è§£æ ¸å¿ƒç»„ä»¶**ï¼šæŒæ¡DispatcherServletã€HandlerMappingã€HandlerAdapterç­‰æ ¸å¿ƒç»„ä»¶
2. **ç†Ÿæ‚‰è¯·æ±‚æµç¨‹**ï¼šç†è§£ä»è¯·æ±‚åˆ°å“åº”çš„å®Œæ•´å¤„ç†æµç¨‹
3. **æŒæ¡æ§åˆ¶å™¨å¼€å‘**ï¼šå­¦ä¼šä½¿ç”¨@Controllerã€@RestControllerç­‰æ³¨è§£å¼€å‘æ§åˆ¶å™¨
4. **äº†è§£è§†å›¾æŠ€æœ¯**ï¼šç†Ÿæ‚‰JSPã€Thymeleafç­‰è§†å›¾æŠ€æœ¯
5. **å­¦ä¼šRESTful API**ï¼šæŒæ¡RESTful APIè®¾è®¡å’Œå®ç°
6. **ç†Ÿæ‚‰æ•°æ®éªŒè¯**ï¼šå­¦ä¼šä½¿ç”¨Bean Validationè¿›è¡Œæ•°æ®éªŒè¯
7. **æŒæ¡æ‹¦æˆªå™¨æœºåˆ¶**ï¼šå­¦ä¼šè‡ªå®šä¹‰æ‹¦æˆªå™¨å¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹
:::

```mermaid
mindmap
  root((Spring MVC))
    æ ¸å¿ƒç»„ä»¶
      DispatcherServlet
      HandlerMapping
      HandlerAdapter
      ViewResolver
    æ§åˆ¶å™¨å¼€å‘
      @Controller
      @RestController
      @RequestMapping
      å‚æ•°ç»‘å®š
    è¯·æ±‚å¤„ç†
      æ‹¦æˆªå™¨
      å¼‚å¸¸å¤„ç†
      æ•°æ®éªŒè¯
    è§†å›¾æŠ€æœ¯
      JSP
      Thymeleaf
      å†…å®¹åå•†
    RESTful API
      èµ„æºè®¾è®¡
      HTTPæ–¹æ³•è¯­ä¹‰
      HATEOAS
    é«˜çº§ç‰¹æ€§
      æ–‡ä»¶ä¸Šä¼ 
      å¼‚æ­¥å¤„ç†
      å›½é™…åŒ–
```

---

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†Spring MVCçš„æ ¸å¿ƒæ¦‚å¿µã€è¯·æ±‚å¤„ç†æµç¨‹å’Œå®é™…åº”ç”¨ã€‚Spring MVCæ˜¯æ„å»ºJava Webåº”ç”¨çš„é‡è¦æ¡†æ¶ï¼ŒæŒæ¡å…¶åŸç†å’Œä½¿ç”¨æ–¹æ³•å¯¹äºå¼€å‘é«˜è´¨é‡çš„Webåº”ç”¨è‡³å…³é‡è¦ã€‚æ— è®ºæ˜¯ä¼ ç»ŸWebåº”ç”¨è¿˜æ˜¯ç°ä»£RESTful APIï¼ŒSpring MVCéƒ½èƒ½æä¾›å¼ºå¤§è€Œçµæ´»çš„æ”¯æŒã€‚ 