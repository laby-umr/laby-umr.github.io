---
sidebar_position: 1
title: "Spring IOCè¯¦è§£"
description: "æ·±å…¥ç†è§£Springæ§åˆ¶åè½¬ä¸ä¾èµ–æ³¨å…¥åŸç†"
authors: [Laby]
last_update:
  date: 2025-08-07
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import TOCInline from '@theme/TOCInline';

# Spring IOC è¯¦è§£

IOCï¼ˆInversion of Controlï¼Œæ§åˆ¶åè½¬ï¼‰æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒé€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚

:::info æœ¬æ–‡å†…å®¹æ¦‚è§ˆ
<TOCInline toc={toc} />
:::

:::tip æ ¸å¿ƒä»·å€¼
**IOC = æ§åˆ¶åè½¬ + ä¾èµ–æ³¨å…¥ + å¯¹è±¡ç®¡ç† + æ¾è€¦åˆè®¾è®¡**
- ğŸ”„ **æ§åˆ¶åè½¬**ï¼šå°†å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†æƒäº¤ç»™å®¹å™¨
- ğŸ’‰ **ä¾èµ–æ³¨å…¥**ï¼šé€šè¿‡æ„é€ å‡½æ•°ã€setteræˆ–å­—æ®µè‡ªåŠ¨æ³¨å…¥ä¾èµ–
- ğŸ§© **å¯¹è±¡ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ
- ğŸ”— **æ¾è€¦åˆè®¾è®¡**ï¼šé™ä½ç»„ä»¶é—´çš„è€¦åˆåº¦ï¼Œæé«˜å¯ç»´æŠ¤æ€§
:::

## 1. IOCåŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯IOCï¼Ÿ

IOCæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œäº¤ç»™å®¹å™¨æ¥å¤„ç†ã€‚è¿™æ ·å¯ä»¥é™ä½ä»£ç çš„è€¦åˆåº¦ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

```mermaid
graph TD
    A[å¼€å‘è€…] -->|ä¼ ç»Ÿæ–¹å¼| B[æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡]
    B --> C[æ‰‹åŠ¨ç®¡ç†ä¾èµ–]
    C --> D[ä¸šåŠ¡é€»è¾‘]
    
    A -->|IOCæ–¹å¼| E[å£°æ˜ä¾èµ–]
    E --> F[IOCå®¹å™¨]
    F -->|è‡ªåŠ¨åˆ›å»ºå¯¹è±¡| G[è‡ªåŠ¨æ³¨å…¥ä¾èµ–]
    G --> D
```

#### ä¼ ç»Ÿæ–¹å¼ vs IOCæ–¹å¼

<Tabs>
  <TabItem value="traditional" label="ä¼ ç»Ÿæ–¹å¼" default>
  ```java
  // ä¼ ç»Ÿæ–¹å¼ - ç´§è€¦åˆ
  public class UserService {
      private UserRepository userRepository;
      
      public UserService() {
          // ç›´æ¥åˆ›å»ºä¾èµ–å¯¹è±¡
          this.userRepository = new UserRepositoryImpl();
      }
      
      public void createUser(User user) {
          userRepository.save(user);
      }
  }
  ```
  </TabItem>
  <TabItem value="ioc" label="IOCæ–¹å¼">
  ```java
  // IOCæ–¹å¼ - æ¾è€¦åˆ
  @Service
  public class UserService {
      @Autowired
      private UserRepository userRepository;
      
      public void createUser(User user) {
          userRepository.save(user);
      }
  }
  
  @Repository
  public class UserRepositoryImpl implements UserRepository {
      public void save(User user) {
          // ä¿å­˜ç”¨æˆ·é€»è¾‘
      }
  }
  ```
  </TabItem>
</Tabs>

### 1.2 IOCå®¹å™¨

Spring IOCå®¹å™¨è´Ÿè´£ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³»ã€‚Springæä¾›äº†ä¸¤ç§å®¹å™¨ç±»å‹ï¼šBeanFactoryå’ŒApplicationContextã€‚

<div className="card">
<div className="card__body">
<table>
  <thead>
    <tr>
      <th>ç‰¹æ€§</th>
      <th>BeanFactory</th>
      <th>ApplicationContext</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>åŠ è½½æ–¹å¼</td>
      <td>æ‡’åŠ è½½</td>
      <td>é¢„åŠ è½½</td>
    </tr>
    <tr>
      <td>å›½é™…åŒ–</td>
      <td>ä¸æ”¯æŒ</td>
      <td>æ”¯æŒ</td>
    </tr>
    <tr>
      <td>äº‹ä»¶å‘å¸ƒ</td>
      <td>ä¸æ”¯æŒ</td>
      <td>æ”¯æŒ</td>
    </tr>
    <tr>
      <td>èµ„æºè®¿é—®</td>
      <td>æœ‰é™æ”¯æŒ</td>
      <td>å®Œå…¨æ”¯æŒ</td>
    </tr>
    <tr>
      <td>é€‚ç”¨åœºæ™¯</td>
      <td>èµ„æºå—é™ç¯å¢ƒ</td>
      <td>å¤§å¤šæ•°åº”ç”¨</td>
    </tr>
  </tbody>
</table>
</div>
</div>

```java title="IOCå®¹å™¨ç¤ºä¾‹"
// åˆ›å»ºIOCå®¹å™¨
ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);

// ä»å®¹å™¨è·å–Bean
UserService userService = context.getBean(UserService.class);

// ä½¿ç”¨Bean
userService.createUser(new User("å¼ ä¸‰"));
```

## 2. ä¾èµ–æ³¨å…¥æ–¹å¼

Springæä¾›å¤šç§ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ã€‚

```mermaid
flowchart LR
    A[ä¾èµ–æ³¨å…¥æ–¹å¼] --> B[æ„é€ å™¨æ³¨å…¥]
    A --> C[Setteræ³¨å…¥]
    A --> D[å­—æ®µæ³¨å…¥]
    
    B --> B1["é€‚åˆå¿…éœ€ä¾èµ–"]
    C --> C1["é€‚åˆå¯é€‰ä¾èµ–"]
    D --> D1["ç®€å•ä½†ä¸æ¨è"]
```

### 2.1 æ„é€ å™¨æ³¨å…¥

<Tabs>
  <TabItem value="code" label="ä»£ç å®ç°" default>
  ```java title="æ„é€ å™¨æ³¨å…¥"
  @Service
  public class UserService {
      private final UserRepository userRepository;
      private final EmailService emailService;
      
      // æ„é€ å™¨æ³¨å…¥
      public UserService(UserRepository userRepository, EmailService emailService) {
          this.userRepository = userRepository;
          this.emailService = emailService;
      }
      
      public void createUser(User user) {
          userRepository.save(user);
          emailService.sendWelcomeEmail(user.getEmail());
      }
  }
  ```
  </TabItem>
  <TabItem value="advantages" label="ä¼˜ç¼ºç‚¹">
  <div className="card">
  <div className="card__header">
  <h4>æ„é€ å™¨æ³¨å…¥ä¼˜ç¼ºç‚¹</h4>
  </div>
  <div className="card__body">
  <h5>ä¼˜ç‚¹ï¼š</h5>
  <ul>
  <li>ä¿è¯ä¾èµ–ä¸å¯å˜</li>
  <li>ç¡®ä¿å¿…éœ€çš„ä¾èµ–åœ¨å¯¹è±¡åˆ›å»ºæ—¶å¯ç”¨</li>
  <li>æ”¯æŒfinalå­—æ®µï¼Œé¿å…åç»­ä¿®æ”¹</li>
  <li>ä¾¿äºå•å…ƒæµ‹è¯•</li>
  </ul>
  <h5>ç¼ºç‚¹ï¼š</h5>
  <ul>
  <li>å½“ä¾èµ–è¿‡å¤šæ—¶ï¼Œæ„é€ å‡½æ•°å‚æ•°åˆ—è¡¨å¯èƒ½è¿‡é•¿</li>
  <li>å¯èƒ½å¯¼è‡´å¾ªç¯ä¾èµ–é—®é¢˜</li>
  </ul>
  </div>
  </div>
  </TabItem>
</Tabs>

### 2.2 Setteræ³¨å…¥

<Tabs>
  <TabItem value="code" label="ä»£ç å®ç°" default>
  ```java title="Setteræ³¨å…¥"
  @Service
  public class UserService {
      private UserRepository userRepository;
      private EmailService emailService;
      
      // Setteræ³¨å…¥
      @Autowired
      public void setUserRepository(UserRepository userRepository) {
          this.userRepository = userRepository;
      }
      
      @Autowired
      public void setEmailService(EmailService emailService) {
          this.emailService = emailService;
      }
  }
  ```
  </TabItem>
  <TabItem value="advantages" label="ä¼˜ç¼ºç‚¹">
  <div className="card">
  <div className="card__header">
  <h4>Setteræ³¨å…¥ä¼˜ç¼ºç‚¹</h4>
  </div>
  <div className="card__body">
  <h5>ä¼˜ç‚¹ï¼š</h5>
  <ul>
  <li>é€‚ç”¨äºå¯é€‰ä¾èµ–</li>
  <li>å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹ä¾èµ–</li>
  <li>é¿å…å¾ªç¯ä¾èµ–é—®é¢˜</li>
  </ul>
  <h5>ç¼ºç‚¹ï¼š</h5>
  <ul>
  <li>ä¸èƒ½ç¡®ä¿ä¾èµ–ä¸ä¸ºnull</li>
  <li>ä¸èƒ½ä½¿ç”¨finalå­—æ®µ</li>
  <li>éœ€è¦æ›´å¤šçš„ä»£ç </li>
  </ul>
  </div>
  </div>
  </TabItem>
</Tabs>

### 2.3 å­—æ®µæ³¨å…¥

<Tabs>
  <TabItem value="code" label="ä»£ç å®ç°" default>
  ```java title="å­—æ®µæ³¨å…¥"
  @Service
  public class UserService {
      @Autowired
      private UserRepository userRepository;
      
      @Autowired
      private EmailService emailService;
      
      public void createUser(User user) {
          userRepository.save(user);
          emailService.sendWelcomeEmail(user.getEmail());
      }
  }
  ```
  </TabItem>
  <TabItem value="advantages" label="ä¼˜ç¼ºç‚¹">
  <div className="card">
  <div className="card__header">
  <h4>å­—æ®µæ³¨å…¥ä¼˜ç¼ºç‚¹</h4>
  </div>
  <div className="card__body">
  <h5>ä¼˜ç‚¹ï¼š</h5>
  <ul>
  <li>ä»£ç ç®€æ´</li>
  <li>å‡å°‘æ ·æ¿ä»£ç </li>
  </ul>
  <h5>ç¼ºç‚¹ï¼š</h5>
  <ul>
  <li>ä¸åˆ©äºå•å…ƒæµ‹è¯•</li>
  <li>ä¸èƒ½ä½¿ç”¨finalå­—æ®µ</li>
  <li>å®¹æ˜“å¯¼è‡´è¿‡åº¦ä¾èµ–</li>
  <li>éšè—ä¾èµ–å…³ç³»</li>
  </ul>
  </div>
  </div>
  </TabItem>
</Tabs>

:::caution æ³¨å…¥æ–¹å¼é€‰æ‹©
- **æ„é€ å™¨æ³¨å…¥**ï¼šæ¨èä½¿ç”¨ï¼Œå¯ä»¥ç¡®ä¿ä¾èµ–ä¸ä¸ºnullï¼Œæ”¯æŒä¸å¯å˜å¯¹è±¡
- **Setteræ³¨å…¥**ï¼šé€‚ç”¨äºå¯é€‰ä¾èµ–ï¼Œå½“ä¾èµ–æœ‰åˆç†é»˜è®¤å€¼æ—¶
- **å­—æ®µæ³¨å…¥**ï¼šç®€å•ä½†ä¸æ¨èï¼Œä¸åˆ©äºæµ‹è¯•å’Œä¸å¯å˜æ€§ï¼Œéšè—ä¾èµ–å…³ç³»
:::

## 3. Beanç”Ÿå‘½å‘¨æœŸ

### 3.1 Beanç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

Spring Beançš„ç”Ÿå‘½å‘¨æœŸåŒ…å«å¤šä¸ªé˜¶æ®µï¼Œä»å®ä¾‹åŒ–åˆ°é”€æ¯ï¼Œå®¹å™¨ä¼šåœ¨å„ä¸ªé˜¶æ®µæä¾›å›è°ƒæœºåˆ¶ã€‚

```mermaid
graph TB
    A[Beanç”Ÿå‘½å‘¨æœŸ] --> B[å®ä¾‹åŒ–]
    B --> C[å±æ€§èµ‹å€¼]
    C --> D[åˆå§‹åŒ–å‰]
    D --> E[åˆå§‹åŒ–]
    E --> F[åˆå§‹åŒ–å]
    F --> G[ä½¿ç”¨]
    G --> H[é”€æ¯å‰]
    H --> I[é”€æ¯]
    
    D -.-> J["BeanPostProcessor.postProcessBeforeInitialization"]
    E -.-> K["@PostConstruct / InitializingBean"]
    F -.-> L["BeanPostProcessor.postProcessAfterInitialization"]
    H -.-> M["@PreDestroy / DisposableBean"]
```

<details>
<summary>å®Œæ•´ç”Ÿå‘½å‘¨æœŸç¤ºä¾‹ä»£ç </summary>

```java title="Beanç”Ÿå‘½å‘¨æœŸç¤ºä¾‹"
@Component
public class UserService implements InitializingBean, DisposableBean {
    
    public UserService() {
        System.out.println("1. æ„é€ å‡½æ•° - å®ä¾‹åŒ–");
    }
    
    @Autowired
    public void setUserRepository(UserRepository userRepository) {
        System.out.println("2. è®¾ç½®å±æ€§ - ä¾èµ–æ³¨å…¥");
    }
    
    @PostConstruct
    public void init() {
        System.out.println("3. @PostConstruct - åˆå§‹åŒ–");
    }
    
    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("4. InitializingBean.afterPropertiesSet()");
    }
    
    public void customInit() {
        System.out.println("5. è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•");
    }
    
    public void businessMethod() {
        System.out.println("6. ä¸šåŠ¡æ–¹æ³• - ä½¿ç”¨Bean");
    }
    
    @PreDestroy
    public void preDestroy() {
        System.out.println("7. @PreDestroy - é”€æ¯å‰");
    }
    
    @Override
    public void destroy() throws Exception {
        System.out.println("8. DisposableBean.destroy()");
    }
    
    public void customDestroy() {
        System.out.println("9. è‡ªå®šä¹‰é”€æ¯æ–¹æ³•");
    }
}
```

</details>

### 3.2 ç”Ÿå‘½å‘¨æœŸå›è°ƒ

<div className="card">
<div className="card__body">

| é˜¶æ®µ | å›è°ƒæ–¹æ³• | è¯´æ˜ |
|------|----------|------|
| **å®ä¾‹åŒ–** | æ„é€ å™¨ | åˆ›å»ºBeanå®ä¾‹ |
| **å±æ€§æ³¨å…¥** | setteræ–¹æ³• | æ³¨å…¥ä¾èµ–å±æ€§ |
| **åˆå§‹åŒ–å‰** | BeanPostProcessor | å‰ç½®å¤„ç†å™¨ |
| **åˆå§‹åŒ–** | @PostConstruct | æ³¨è§£æ–¹å¼åˆå§‹åŒ– |
| **åˆå§‹åŒ–** | InitializingBean | æ¥å£æ–¹å¼åˆå§‹åŒ– |
| **åˆå§‹åŒ–** | è‡ªå®šä¹‰initæ–¹æ³• | XMLæˆ–æ³¨è§£é…ç½® |
| **åˆå§‹åŒ–å** | BeanPostProcessor | åç½®å¤„ç†å™¨ |
| **ä½¿ç”¨** | ä¸šåŠ¡æ–¹æ³• | Beanæ­£å¸¸ä½¿ç”¨ |
| **é”€æ¯å‰** | @PreDestroy | æ³¨è§£æ–¹å¼é”€æ¯å‰ |
| **é”€æ¯** | DisposableBean | æ¥å£æ–¹å¼é”€æ¯ |
| **é”€æ¯** | è‡ªå®šä¹‰destroyæ–¹æ³• | XMLæˆ–æ³¨è§£é…ç½® |

</div>
</div>

## 4. Beanä½œç”¨åŸŸ

### 4.1 ä½œç”¨åŸŸç±»å‹

Springæä¾›äº†å¤šç§Beanä½œç”¨åŸŸï¼Œç”¨äºæ§åˆ¶Beanå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œå¯è§æ€§ã€‚

<Tabs>
  <TabItem value="singleton" label="å•ä¾‹" default>
  ```java title="å•ä¾‹ä½œç”¨åŸŸ"
  @Component
  @Scope("singleton") // é»˜è®¤ä½œç”¨åŸŸï¼Œå¯ä»¥çœç•¥
  public class SingletonService {
      // æ•´ä¸ªå®¹å™¨åªæœ‰ä¸€ä¸ªå®ä¾‹
      
      public SingletonService() {
          System.out.println("åˆ›å»ºSingletonService");
      }
      
      public void doSomething() {
          System.out.println("SingletonService doing something");
      }
  }
  ```
  </TabItem>
  <TabItem value="prototype" label="åŸå‹">
  ```java title="åŸå‹ä½œç”¨åŸŸ"
  @Component
  @Scope("prototype")
  public class PrototypeService {
      // æ¯æ¬¡è·å–éƒ½åˆ›å»ºæ–°å®ä¾‹
      
      public PrototypeService() {
          System.out.println("åˆ›å»ºPrototypeService");
      }
      
      public void doSomething() {
          System.out.println("PrototypeService doing something");
      }
  }
  ```
  </TabItem>
  <TabItem value="web" label="Webä½œç”¨åŸŸ">
  ```java title="Webä½œç”¨åŸŸ"
  @Component
  @Scope(value = WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)
  public class SessionService {
      // æ¯ä¸ªä¼šè¯ä¸€ä¸ªå®ä¾‹
      
      public SessionService() {
          System.out.println("åˆ›å»ºSessionService");
      }
  }
  
  @Component
  @Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
  public class RequestService {
      // æ¯ä¸ªè¯·æ±‚ä¸€ä¸ªå®ä¾‹
      
      public RequestService() {
          System.out.println("åˆ›å»ºRequestService");
      }
  }
  ```
  </TabItem>
</Tabs>

### 4.2 ä½œç”¨åŸŸç‰¹ç‚¹

```mermaid
graph TD
    A[Beanä½œç”¨åŸŸ] --> B[singleton]
    A --> C[prototype]
    A --> D[Webä½œç”¨åŸŸ]
    D --> E[request]
    D --> F[session]
    D --> G[application]
    D --> H[websocket]
    
    B --> B1["ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªå®ä¾‹"]
    C --> C1["æ¯æ¬¡è·å–æ–°å®ä¾‹"]
    E --> E1["æ¯ä¸ªè¯·æ±‚ä¸€ä¸ªå®ä¾‹"]
    F --> F1["æ¯ä¸ªä¼šè¯ä¸€ä¸ªå®ä¾‹"]
    G --> G1["æ¯ä¸ªåº”ç”¨ä¸€ä¸ªå®ä¾‹"]
    H --> H1["æ¯ä¸ªWebSocketä¸€ä¸ªå®ä¾‹"]
```

<div className="card">
<div className="card__body">

| ä½œç”¨åŸŸ | è¯´æ˜ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|--------|------|------|----------|
| **singleton** | å•ä¾‹ | æ•´ä¸ªå®¹å™¨åªæœ‰ä¸€ä¸ªå®ä¾‹ | æ— çŠ¶æ€æœåŠ¡ã€é…ç½®ç±» |
| **prototype** | åŸå‹ | æ¯æ¬¡è·å–éƒ½åˆ›å»ºæ–°å®ä¾‹ | æœ‰çŠ¶æ€å¯¹è±¡ã€çº¿ç¨‹å®‰å…¨ |
| **request** | è¯·æ±‚ | æ¯ä¸ªHTTPè¯·æ±‚ä¸€ä¸ªå®ä¾‹ | Webè¯·æ±‚å¤„ç†å™¨ |
| **session** | ä¼šè¯ | æ¯ä¸ªHTTPä¼šè¯ä¸€ä¸ªå®ä¾‹ | ç”¨æˆ·ä¼šè¯çŠ¶æ€ |
| **application** | åº”ç”¨ | æ¯ä¸ªServletContextä¸€ä¸ªå®ä¾‹ | å…¨å±€Webèµ„æº |
| **websocket** | è¿æ¥ | æ¯ä¸ªWebSocketè¿æ¥ä¸€ä¸ªå®ä¾‹ | WebSocketå¤„ç†å™¨ |

</div>
</div>

:::warning ä½œç”¨åŸŸæ³¨æ„äº‹é¡¹
å½“å•ä¾‹Beanä¾èµ–éå•ä¾‹Beanæ—¶ï¼Œéœ€è¦ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œå¦åˆ™éå•ä¾‹Beanå°†å¤±å»å…¶ä½œç”¨åŸŸç‰¹æ€§ã€‚ä½¿ç”¨`proxyMode = ScopedProxyMode.TARGET_CLASS`æ¥è§£å†³æ­¤é—®é¢˜ã€‚
:::

## 5. é…ç½®æ–¹å¼

Springæä¾›äº†ä¸‰ç§ä¸»è¦çš„Beané…ç½®æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹å¼ã€‚

```mermaid
flowchart LR
    A[Beané…ç½®æ–¹å¼] --> B[æ³¨è§£é…ç½®]
    A --> C[XMLé…ç½®]
    A --> D[Javaé…ç½®]
    
    B --> B1["@Component, @Service..."]
    C --> C1["&lt;bean&gt;æ ‡ç­¾"]
    D --> D1["@Configuration + @Bean"]
    
    style B stroke:#4CAF50,stroke-width:2px
    style C stroke:#FF9800,stroke-width:2px
    style D stroke:#2196F3,stroke-width:2px
```

### 5.1 æ³¨è§£é…ç½®

<Tabs>
  <TabItem value="component" label="ç»„ä»¶æ‰«æ" default>
  ```java title="ç»„ä»¶æ‰«æ"
  @Configuration
  @ComponentScan("com.example")
  public class AppConfig {
      // é…ç½®ç±»
  }
  
  @Service
  public class UserService {
      @Autowired
      private UserRepository userRepository;
  }
  
  @Repository
  public class UserRepositoryImpl implements UserRepository {
      // å®ç°
  }
  ```
  </TabItem>
  <TabItem value="bean" label="@Beanæ–¹æ³•">
  ```java title="@Beanæ–¹æ³•"
  @Configuration
  public class AppConfig {
      
      @Bean
      public UserRepository userRepository() {
          return new UserRepositoryImpl();
      }
      
      @Bean
      public EmailService emailService() {
          return new EmailServiceImpl();
      }
      
      @Bean
      public UserService userService() {
          return new UserService(userRepository(), emailService());
      }
  }
  ```
  </TabItem>
</Tabs>

### 5.2 XMLé…ç½®

<details>
<summary>XMLé…ç½®ç¤ºä¾‹</summary>

```xml title="XMLé…ç½®"
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd">
    
    <bean id="userRepository" class="com.example.repository.UserRepositoryImpl"/>
    
    <bean id="emailService" class="com.example.service.EmailServiceImpl"/>
    
    <bean id="userService" class="com.example.service.UserService">
        <constructor-arg ref="userRepository"/>
        <constructor-arg ref="emailService"/>
    </bean>
    
</beans>
```

</details>

### 5.3 Javaé…ç½®

```java title="Javaé…ç½®"
@Configuration
public class AppConfig {
    
    @Bean
    public UserRepository userRepository() {
        return new UserRepositoryImpl();
    }
    
    @Bean
    public EmailService emailService() {
        return new EmailServiceImpl();
    }
    
    @Bean
    public UserService userService(UserRepository userRepository, EmailService emailService) {
        return new UserService(userRepository, emailService);
    }
}
```

## 6. é«˜çº§ç‰¹æ€§

### 6.1 æ¡ä»¶åŒ–Bean

Springæä¾›äº†æ¡ä»¶åŒ–é…ç½®æœºåˆ¶ï¼Œå…è®¸æ ¹æ®ç‰¹å®šæ¡ä»¶åˆ›å»ºBeanã€‚

<details>
<summary>æ¡ä»¶åŒ–Beanç¤ºä¾‹</summary>

```java title="æ¡ä»¶åŒ–Bean"
@Configuration
public class AppConfig {
    
    @Bean
    @ConditionalOnProperty(name = "database.type", havingValue = "mysql")
    public DataSource mysqlDataSource() {
        return new MysqlDataSource();
    }
    
    @Bean
    @ConditionalOnProperty(name = "database.type", havingValue = "postgresql")
    public DataSource postgresqlDataSource() {
        return new PostgresqlDataSource();
    }
    
    @Bean
    @ConditionalOnClass(name = "com.mysql.jdbc.Driver")
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
```

</details>

<div className="card">
<div className="card__header">
<h4>å¸¸ç”¨æ¡ä»¶æ³¨è§£</h4>
</div>
<div className="card__body">

| æ¡ä»¶æ³¨è§£ | è¯´æ˜ | ç”¨é€” |
|----------|------|------|
| `@ConditionalOnBean` | å½“å­˜åœ¨æŒ‡å®šBeanæ—¶ | ä¾èµ–å…¶ä»–Bean |
| `@ConditionalOnMissingBean` | å½“ä¸å­˜åœ¨æŒ‡å®šBeanæ—¶ | é»˜è®¤é…ç½® |
| `@ConditionalOnClass` | å½“å­˜åœ¨æŒ‡å®šç±»æ—¶ | ä¾èµ–å¤–éƒ¨åº“ |
| `@ConditionalOnMissingClass` | å½“ä¸å­˜åœ¨æŒ‡å®šç±»æ—¶ | å…¼å®¹æ€§é…ç½® |
| `@ConditionalOnProperty` | å½“å­˜åœ¨æŒ‡å®šå±æ€§æ—¶ | é…ç½®é©±åŠ¨ |
| `@ConditionalOnExpression` | å½“è¡¨è¾¾å¼ä¸ºtrueæ—¶ | å¤æ‚æ¡ä»¶åˆ¤æ–­ |

</div>
</div>

### 6.2 Beanåå¤„ç†å™¨

Beanåå¤„ç†å™¨å…è®¸åœ¨Beanåˆå§‹åŒ–å‰åè¿›è¡Œè‡ªå®šä¹‰å¤„ç†ã€‚

```java title="Beanåå¤„ç†å™¨"
@Component
public class CustomBeanPostProcessor implements BeanPostProcessor {
    
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("Beanåˆå§‹åŒ–å‰: " + beanName);
        return bean;
    }
    
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("Beanåˆå§‹åŒ–å: " + beanName);
        return bean;
    }
}
```

### 6.3 å·¥å‚Bean

å·¥å‚Beanç”¨äºåˆ›å»ºå¤æ‚çš„Beanå®ä¾‹ï¼Œéšè—å®ä¾‹åŒ–ç»†èŠ‚ã€‚

```java title="å·¥å‚Bean"
@Component
public class UserServiceFactoryBean implements FactoryBean<UserService> {
    
    @Override
    public UserService getObject() throws Exception {
        // åˆ›å»ºå¤æ‚çš„UserServiceå®ä¾‹
        UserService userService = new UserService();
        // è¿›è¡Œä¸€äº›å¤æ‚çš„åˆå§‹åŒ–
        return userService;
    }
    
    @Override
    public Class<?> getObjectType() {
        return UserService.class;
    }
    
    @Override
    public boolean isSingleton() {
        return true;
    }
}
```

### 6.4 å¾ªç¯ä¾èµ–

Springé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å•ä¾‹Beançš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚

```mermaid
graph TD
    A[å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆ] --> B[ä¸‰çº§ç¼“å­˜]
    B --> C["ä¸€çº§ç¼“å­˜ singletonObjects"]
    B --> D["äºŒçº§ç¼“å­˜ earlySingletonObjects"]
    B --> E["ä¸‰çº§ç¼“å­˜ singletonFactories"]
    
    C -->|"å­˜å‚¨å®Œå…¨åˆå§‹åŒ–çš„Bean"| F["å®Œæˆæ€Bean"]
    D -->|"å­˜å‚¨æ—©æœŸå¼•ç”¨"| G["åŠæˆå“Bean"]
    E -->|"å­˜å‚¨Beanå·¥å‚"| H["Lambdaè¡¨è¾¾å¼"]
```

<details>
<summary>å¾ªç¯ä¾èµ–ç¤ºä¾‹ä¸è§£å†³è¿‡ç¨‹</summary>

```java title="å¾ªç¯ä¾èµ–ç¤ºä¾‹"
@Service
public class ServiceA {
    @Autowired
    private ServiceB serviceB;
    
    public void methodA() {
        serviceB.methodB();
    }
}

@Service
public class ServiceB {
    @Autowired
    private ServiceA serviceA;
    
    public void methodB() {
        serviceA.methodA();
    }
}
```

è§£å†³è¿‡ç¨‹ï¼š
1. åˆ›å»ºServiceAå®ä¾‹
2. å‘ç°ä¾èµ–ServiceBï¼Œå°†ServiceAæ”¾å…¥ä¸‰çº§ç¼“å­˜
3. åˆ›å»ºServiceBå®ä¾‹
4. å‘ç°ä¾èµ–ServiceAï¼Œå°è¯•ä»ç¼“å­˜è·å–
5. ä»ä¸‰çº§ç¼“å­˜è·å–ServiceAçš„æ—©æœŸå¼•ç”¨
6. å®ŒæˆServiceBçš„ä¾èµ–æ³¨å…¥
7. å®ŒæˆServiceAçš„ä¾èµ–æ³¨å…¥

</details>

## 7. é¢è¯•é¢˜ç²¾é€‰

### 7.1 åŸºç¡€æ¦‚å¿µé¢˜

<Tabs>
  <TabItem value="q1" label="IOCæ¦‚å¿µ" default>
  <div className="card">
  <div className="card__header">
  <h4>Q: ä»€ä¹ˆæ˜¯IOCï¼Ÿå®ƒçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> IOCï¼ˆæ§åˆ¶åè½¬ï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p>
  <ul>
  <li><strong>é™ä½è€¦åˆåº¦</strong>ï¼šå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ç”±å®¹å™¨ç®¡ç†</li>
  <li><strong>æé«˜å¯ç»´æŠ¤æ€§</strong>ï¼šä¿®æ”¹ä¾èµ–å…³ç³»ä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç </li>
  <li><strong>æé«˜å¯æµ‹è¯•æ€§</strong>ï¼šå¯ä»¥è½»æ¾æ›¿æ¢ä¾èµ–è¿›è¡Œæµ‹è¯•</li>
  <li><strong>ç®€åŒ–ä»£ç </strong>ï¼šä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å®ç°</li>
  </ul>
  </div>
  </div>
  </TabItem>
  <TabItem value="q2" label="IOCå®¹å™¨">
  <div className="card">
  <div className="card__header">
  <h4>Q: Spring IOCå®¹å™¨çš„æ ¸å¿ƒæ¥å£æœ‰å“ªäº›ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Spring IOCå®¹å™¨çš„æ ¸å¿ƒæ¥å£åŒ…æ‹¬ï¼š</p>
  <ul>
  <li><strong>BeanFactory</strong>ï¼šåŸºç¡€å®¹å™¨æ¥å£ï¼Œæä¾›åŸºæœ¬çš„IOCåŠŸèƒ½</li>
  <li><strong>ApplicationContext</strong>ï¼šBeanFactoryçš„å­æ¥å£ï¼Œæä¾›æ›´å¤šä¼ä¸šçº§åŠŸèƒ½</li>
  <li><strong>ConfigurableApplicationContext</strong>ï¼šå¯é…ç½®çš„åº”ç”¨ä¸Šä¸‹æ–‡</li>
  <li><strong>WebApplicationContext</strong>ï¼šWebåº”ç”¨çš„åº”ç”¨ä¸Šä¸‹æ–‡</li>
  <li><strong>AnnotationConfigApplicationContext</strong>ï¼šåŸºäºæ³¨è§£çš„é…ç½®ä¸Šä¸‹æ–‡</li>
  </ul>
  </div>
  </div>
  </TabItem>
</Tabs>

### 7.2 å®è·µé¢˜

<Tabs>
  <TabItem value="q3" label="ä¾èµ–æ³¨å…¥" default>
  <div className="card">
  <div className="card__header">
  <h4>Q: Springä¸­æœ‰å“ªäº›ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Springæä¾›ä¸‰ç§ä¾èµ–æ³¨å…¥æ–¹å¼ï¼š</p>
  <ul>
  <li><strong>æ„é€ å™¨æ³¨å…¥</strong>ï¼šé€šè¿‡æ„é€ å™¨æ³¨å…¥ä¾èµ–ï¼Œæ¨èä½¿ç”¨</li>
  <li><strong>Setteræ³¨å…¥</strong>ï¼šé€šè¿‡setteræ–¹æ³•æ³¨å…¥ä¾èµ–</li>
  <li><strong>å­—æ®µæ³¨å…¥</strong>ï¼šç›´æ¥åœ¨å­—æ®µä¸Šä½¿ç”¨@Autowiredæ³¨è§£</li>
  </ul>
  </div>
  </div>
  </TabItem>
  <TabItem value="q4" label="Beanä½œç”¨åŸŸ">
  <div className="card">
  <div className="card__header">
  <h4>Q: Beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Spring Beançš„ä½œç”¨åŸŸåŒ…æ‹¬ï¼š</p>
  <ul>
  <li><strong>singleton</strong>ï¼šå•ä¾‹ï¼ˆé»˜è®¤ï¼‰ï¼Œæ•´ä¸ªå®¹å™¨åªæœ‰ä¸€ä¸ªå®ä¾‹</li>
  <li><strong>prototype</strong>ï¼šåŸå‹ï¼Œæ¯æ¬¡è·å–éƒ½åˆ›å»ºæ–°å®ä¾‹</li>
  <li><strong>request</strong>ï¼šè¯·æ±‚ä½œç”¨åŸŸï¼Œæ¯ä¸ªHTTPè¯·æ±‚ä¸€ä¸ªå®ä¾‹</li>
  <li><strong>session</strong>ï¼šä¼šè¯ä½œç”¨åŸŸï¼Œæ¯ä¸ªHTTPä¼šè¯ä¸€ä¸ªå®ä¾‹</li>
  <li><strong>application</strong>ï¼šåº”ç”¨ä½œç”¨åŸŸï¼Œæ¯ä¸ªServletContextä¸€ä¸ªå®ä¾‹</li>
  <li><strong>websocket</strong>ï¼šWebSocketä½œç”¨åŸŸï¼Œæ¯ä¸ªWebSocketè¿æ¥ä¸€ä¸ªå®ä¾‹</li>
  </ul>
  </div>
  </div>
  </TabItem>
</Tabs>

### 7.3 é«˜çº§é¢˜

<Tabs>
  <TabItem value="q5" label="ç”Ÿå‘½å‘¨æœŸ" default>
  <div className="card">
  <div className="card__header">
  <h4>Q: Spring Beançš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Spring Beançš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼š</p>
  <ol>
  <li><strong>å®ä¾‹åŒ–</strong>ï¼šåˆ›å»ºBeanå®ä¾‹</li>
  <li><strong>å±æ€§æ³¨å…¥</strong>ï¼šæ³¨å…¥ä¾èµ–å±æ€§</li>
  <li><strong>BeanPostProcessorå‰ç½®å¤„ç†</strong>ï¼šåœ¨åˆå§‹åŒ–å‰è¿›è¡Œå¤„ç†</li>
  <li><strong>åˆå§‹åŒ–å›è°ƒ</strong>ï¼šæ‰§è¡Œåˆå§‹åŒ–å›è°ƒæ–¹æ³•ï¼ˆ@PostConstructã€InitializingBeanç­‰ï¼‰</li>
  <li><strong>BeanPostProcessoråç½®å¤„ç†</strong>ï¼šåœ¨åˆå§‹åŒ–åè¿›è¡Œå¤„ç†</li>
  <li><strong>ä½¿ç”¨</strong>ï¼šBeanæ­£å¸¸ä½¿ç”¨</li>
  <li><strong>é”€æ¯å›è°ƒ</strong>ï¼šæ‰§è¡Œé”€æ¯å›è°ƒæ–¹æ³•ï¼ˆ@PreDestroyã€DisposableBeanç­‰ï¼‰</li>
  </ol>
  </div>
  </div>
  </TabItem>
  <TabItem value="q6" label="å¾ªç¯ä¾èµ–">
  <div className="card">
  <div className="card__header">
  <h4>Q: å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ</h4>
  </div>
  <div className="card__body">
  <p><strong>A:</strong> Springé€šè¿‡ä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯ä¾èµ–ï¼š</p>
  <ul>
  <li><strong>ä¸€çº§ç¼“å­˜</strong>ï¼šsingletonObjectsï¼Œå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„Bean</li>
  <li><strong>äºŒçº§ç¼“å­˜</strong>ï¼šearlySingletonObjectsï¼Œå­˜æ”¾æ—©æœŸæš´éœ²çš„Beanï¼ˆæœªå®Œå…¨åˆå§‹åŒ–ï¼‰</li>
  <li><strong>ä¸‰çº§ç¼“å­˜</strong>ï¼šsingletonFactoriesï¼Œå­˜æ”¾Beançš„å·¥å‚å¯¹è±¡</li>
  </ul>
  <p>é€šè¿‡æå‰æš´éœ²Beançš„å¼•ç”¨è§£å†³å¾ªç¯ä¾èµ–ã€‚æ³¨æ„ï¼Œè¿™ç§æœºåˆ¶åªèƒ½è§£å†³å•ä¾‹Beançš„setteræ³¨å…¥å¾ªç¯ä¾èµ–ï¼Œä¸èƒ½è§£å†³æ„é€ å™¨æ³¨å…¥çš„å¾ªç¯ä¾èµ–å’ŒåŸå‹Beançš„å¾ªç¯ä¾èµ–ã€‚</p>
  </div>
  </div>
  </TabItem>
</Tabs>

:::tip IOCå­¦ä¹ è¦ç‚¹
1. **ç†è§£æ ¸å¿ƒæ¦‚å¿µ**ï¼šæŒæ¡IOCã€DIã€Beanç­‰åŸºæœ¬æ¦‚å¿µ
2. **ç†Ÿæ‚‰æ³¨å…¥æ–¹å¼**ï¼šå­¦ä¼šæ„é€ å™¨ã€Setterã€å­—æ®µæ³¨å…¥
3. **æŒæ¡ç”Ÿå‘½å‘¨æœŸ**ï¼šäº†è§£Beançš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯è¿‡ç¨‹
4. **å­¦ä¼šé…ç½®æ–¹å¼**ï¼šæŒæ¡æ³¨è§£ã€XMLã€Javaé…ç½®
5. **äº†è§£é«˜çº§ç‰¹æ€§**ï¼šå­¦ä¼šæ¡ä»¶åŒ–Beanã€åå¤„ç†å™¨ç­‰
:::

```mermaid
mindmap
  root((Spring IOC))
    åŸºç¡€æ¦‚å¿µ
      æ§åˆ¶åè½¬
      ä¾èµ–æ³¨å…¥
      IOCå®¹å™¨
    ä¾èµ–æ³¨å…¥æ–¹å¼
      æ„é€ å™¨æ³¨å…¥
      Setteræ³¨å…¥
      å­—æ®µæ³¨å…¥
    Beanç”Ÿå‘½å‘¨æœŸ
      å®ä¾‹åŒ–
      å±æ€§èµ‹å€¼
      åˆå§‹åŒ–
      é”€æ¯
    Beanä½œç”¨åŸŸ
      singleton
      prototype
      Webä½œç”¨åŸŸ
    é…ç½®æ–¹å¼
      æ³¨è§£é…ç½®
      XMLé…ç½®
      Javaé…ç½®
    é«˜çº§ç‰¹æ€§
      æ¡ä»¶åŒ–Bean
      åå¤„ç†å™¨
      å·¥å‚Bean
      å¾ªç¯ä¾èµ–
```

---

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†Spring IOCçš„æ ¸å¿ƒæ¦‚å¿µã€ä¾èµ–æ³¨å…¥æ–¹å¼å’ŒBeanç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚IOCæ˜¯Springæ¡†æ¶çš„åŸºç¡€ï¼ŒæŒæ¡IOCå¯¹äºç†è§£æ•´ä¸ªSpringç”Ÿæ€ç³»ç»Ÿè‡³å…³é‡è¦ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåˆç†ä½¿ç”¨IOCå¯ä»¥æ„å»ºå‡ºæ¾è€¦åˆã€æ˜“ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚ 