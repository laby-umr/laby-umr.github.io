---
sidebar_position: 4
title: MyBatis-Plusæ¡†æ¶è¯¦è§£
description: æ·±å…¥ç†è§£MyBatis-Plusæ ¸å¿ƒç‰¹æ€§ã€ä»£ç ç”Ÿæˆå™¨ä¸é«˜çº§åŠŸèƒ½å®æˆ˜
authors: [Laby]
tags: [MyBatis-Plus, ORM, ä»£ç ç”Ÿæˆ, åˆ†é¡µæ’ä»¶, æ¡ä»¶æ„é€ å™¨]
last_update:
  date: 2025-08-11
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

# MyBatis-Plusæ¡†æ¶è¯¦è§£

MyBatis-Plusï¼ˆç®€ç§°MPï¼‰æ˜¯ä¸€ä¸ªMyBatisçš„å¢å¼ºå·¥å…·ï¼Œåœ¨MyBatisçš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚å®ƒæä¾›äº†å¼ºå¤§çš„CRUDæ“ä½œã€ä»£ç ç”Ÿæˆå™¨ã€æ¡ä»¶æ„é€ å™¨ç­‰åŠŸèƒ½ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€Œéé‡å¤çš„CRUDä»£ç ã€‚

:::tip æ ¸å¿ƒä»·å€¼
**MyBatis-Plus = MyBatiså¢å¼º + é›¶ä¾µå…¥ + æŸè€—å° + å¼ºå¤§CRUD + æ”¯æŒLambda**
- ğŸš€ **å¼€ç®±å³ç”¨**ï¼šåªéœ€ç®€å•é…ç½®ï¼Œå³å¯å¿«é€Ÿè¿›è¡ŒCRUDæ“ä½œ
- ğŸ¯ **ä»£ç ç”Ÿæˆ**ï¼šå†…ç½®ä»£ç ç”Ÿæˆå™¨ï¼Œå¿«é€Ÿç”ŸæˆEntityã€Mapperã€Serviceã€Controller
- ğŸ’¡ **æ¡ä»¶æ„é€ å™¨**ï¼šå¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ”¯æŒå„ç§å¤æ‚æŸ¥è¯¢
- ğŸ”§ **å†…ç½®åˆ†é¡µ**ï¼šåŸºäºMyBatisç‰©ç†åˆ†é¡µï¼Œæ€§èƒ½ä¼˜ç§€
- ğŸ›¡ï¸ **é˜²å…¨è¡¨æ›´æ–°åˆ é™¤**ï¼šå†…ç½®é˜²æ­¢å…¨è¡¨æ›´æ–°åˆ é™¤æ’ä»¶
:::

## 1. æ ¸å¿ƒç‰¹æ€§ä¸æ¶æ„

### 1.1 æ¡†æ¶ä¼˜åŠ¿

MyBatis-Plusç›¸æ¯”åŸç”ŸMyBatiså…·æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ï¼Œä¸»è¦ä½“ç°åœ¨ä»£ç é‡å‡å°‘ã€å¼€å‘æ•ˆç‡æå‡ã€åŠŸèƒ½æ›´åŠ ä¸°å¯Œã€æ€§èƒ½æŸè€—æå°å’Œæ— ä¾µå…¥æ€§ç­‰æ–¹é¢ã€‚

| ç‰¹æ€§ | MyBatis | MyBatis-Plus |
|------|---------|--------------|
| **é€šç”¨CRUD** | âŒ éœ€æ‰‹åŠ¨ç¼–å†™ | âœ… å†…ç½®é€šç”¨Mapper |
| **åˆ†é¡µæ”¯æŒ** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½®åˆ†é¡µæ’ä»¶ |
| **æ¡ä»¶æ„é€ å™¨** | âŒ éœ€æ‰‹åŠ¨æ‹¼æ¥SQL | âœ… å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ |
| **ä»£ç ç”Ÿæˆå™¨** | âŒ éœ€ç¬¬ä¸‰æ–¹æ’ä»¶ | âœ… å†…ç½®ä»£ç ç”Ÿæˆå™¨ |
| **é€»è¾‘åˆ é™¤** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… ä¸€é”®é…ç½®å³ç”¨ |
| **ä¹è§‚é”æ’ä»¶** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½®ä¹è§‚é”æ’ä»¶ |
| **æ€§èƒ½åˆ†æ** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶ |
| **å¤šç§Ÿæˆ·æ”¯æŒ** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½®å¤šç§Ÿæˆ·æ’ä»¶ |
| **åŠ¨æ€è¡¨å** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… å†…ç½®åŠ¨æ€è¡¨åæ’ä»¶ |
| **SQLæ³¨å…¥å™¨** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒè‡ªå®šä¹‰æ–¹æ³•æ³¨å…¥ |

#### 1.1.1 å¼€å‘æ•ˆç‡å¯¹æ¯”

åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œä½¿ç”¨MyBatis-Pluså¯ä»¥æå¤§åœ°å‡å°‘é‡å¤ä»£ç ç¼–å†™ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å¼€å‘æ•ˆç‡å¯¹æ¯”ï¼š

**ä½¿ç”¨MyBatisï¼š**
1. ç¼–å†™Entityç±»
2. ç¼–å†™Mapperæ¥å£
3. ç¼–å†™Mapper XMLæ–‡ä»¶
4. ç¼–å†™å„ç§CRUD SQLè¯­å¥
5. å®ç°åˆ†é¡µé€»è¾‘

**ä½¿ç”¨MyBatis-Plusï¼š**
1. ç¼–å†™Entityç±»
2. ç»§æ‰¿BaseMapperæ¥å£
3. ç›´æ¥ä½¿ç”¨å†…ç½®CRUDæ–¹æ³•

å…¸å‹çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨MyBatis-Pluså¯ä»¥å‡å°‘çº¦60%-70%çš„ä»£ç é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸºç¡€CRUDæ“ä½œæ–¹é¢ã€‚

### 1.2 æ ¸å¿ƒç»„ä»¶

MyBatis-Plusçš„æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š

- **BaseMapper**ï¼šæä¾›åŸºç¡€çš„CRUDæ–¹æ³•
- **IService/ServiceImpl**ï¼šä¸šåŠ¡å±‚å°è£…ï¼Œæä¾›æ›´å¤šæ‰¹é‡æ“ä½œæ–¹æ³•
- **æ¡ä»¶æ„é€ å™¨**ï¼šQueryWrapperã€LambdaQueryWrapperç­‰
- **åˆ†é¡µæ’ä»¶**ï¼šç‰©ç†åˆ†é¡µæ”¯æŒ
- **ä»£ç ç”Ÿæˆå™¨**ï¼šå¿«é€Ÿç”Ÿæˆå„å±‚ä»£ç 
- **æ’ä»¶ä½“ç³»**ï¼šæä¾›å¤šç§æ‰©å±•æ’ä»¶

#### 1.2.1 æ¶æ„è®¾è®¡

MyBatis-Plusçš„æ¶æ„è®¾è®¡éµå¾ªäº†"é«˜å†…èšã€ä½è€¦åˆ"çš„åŸåˆ™ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ å±‚ï¼š

1. **æ•°æ®è®¿é—®å±‚**ï¼šBaseMapperæ¥å£åŠå…¶å®ç°
2. **ä¸šåŠ¡æœåŠ¡å±‚**ï¼šIServiceæ¥å£åŠServiceImplå®ç°
3. **æ’ä»¶æ‰©å±•å±‚**ï¼šå„ç§åŠŸèƒ½æ’ä»¶ï¼ˆåˆ†é¡µã€ä¹è§‚é”ç­‰ï¼‰
4. **å·¥å…·æ”¯æŒå±‚**ï¼šä»£ç ç”Ÿæˆå™¨ã€æ¡ä»¶æ„é€ å™¨ç­‰

```mermaid
graph TD
    A[åº”ç”¨å±‚] --> B[ä¸šåŠ¡æœåŠ¡å±‚ IService]
    B --> C[æ•°æ®è®¿é—®å±‚ BaseMapper]
    C --> D[æ’ä»¶æ‰©å±•å±‚]
    D --> E[MyBatisæ ¸å¿ƒ]
    E --> F[æ•°æ®åº“]
    G[å·¥å…·æ”¯æŒå±‚] --> B
    G --> C
```

#### 1.2.2 æ ¸å¿ƒæ³¨è§£ä¸€è§ˆ

MyBatis-Plusæä¾›äº†ä¸°å¯Œçš„æ³¨è§£ï¼Œç”¨äºå®ä½“ç±»ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„å’ŒåŠŸèƒ½å¢å¼ºï¼š

| æ³¨è§£ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| @TableName | ç±» | è¡¨åæ³¨è§£ï¼Œæ ‡è¯†å®ä½“ç±»å¯¹åº”çš„è¡¨ |
| @TableId | å±æ€§ | ä¸»é”®æ³¨è§£ï¼Œæ ‡è¯†ä¸»é”®å­—æ®µ |
| @TableField | å±æ€§ | å­—æ®µæ³¨è§£ï¼Œæ ‡è¯†éä¸»é”®å­—æ®µ |
| @Version | å±æ€§ | ä¹è§‚é”æ³¨è§£ï¼Œæ ‡è¯†ä¹è§‚é”å­—æ®µ |
| @TableLogic | å±æ€§ | é€»è¾‘åˆ é™¤æ³¨è§£ï¼Œæ ‡è¯†é€»è¾‘åˆ é™¤å­—æ®µ |
| @OrderBy | å±æ€§ | æ’åºæ³¨è§£ï¼Œæ ‡è¯†æ’åºå­—æ®µ |
| @InterceptorIgnore | ç±»/æ–¹æ³• | æ’ä»¶å¿½ç•¥æ³¨è§£ï¼Œç”¨äºè·³è¿‡ç‰¹å®šæ’ä»¶ |

### 1.3 é¡¹ç›®é›†æˆ

#### 1.3.1 Mavenä¾èµ–

```xml
<!-- MyBatis-Plusä¾èµ– -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.3</version>
</dependency>

<!-- ä»£ç ç”Ÿæˆå™¨ä¾èµ– -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-generator</artifactId>
    <version>3.5.3</version>
</dependency>

<!-- æ¨¡æ¿å¼•æ“ä¾èµ– -->
<dependency>
    <groupId>org.freemarker</groupId>
    <artifactId>freemarker</artifactId>
    <version>2.3.31</version>
</dependency>
```

#### 1.3.2 åŸºç¡€é…ç½®

åœ¨Spring Booté¡¹ç›®ä¸­ï¼ŒMyBatis-Plusçš„åŸºç¡€é…ç½®ç¤ºä¾‹ï¼š

```yaml
# application.yml
mybatis-plus:
  # æ˜ å°„æ–‡ä»¶ä½ç½®
  mapper-locations: classpath*:/mapper/**/*.xml
  # å®ä½“æ‰«æï¼Œå¤šä¸ªpackageç”¨é€—å·æˆ–è€…åˆ†å·åˆ†éš”
  typeAliasesPackage: com.example.entity
  # å…¨å±€é…ç½®
  global-config:
    # æ•°æ®åº“ç›¸å…³é…ç½®
    db-config:
      # ä¸»é”®ç±»å‹
      id-type: auto
      # å­—æ®µç­–ç•¥
      field-strategy: not_null
      # è¡¨åå‰ç¼€
      table-prefix: t_
      # é€»è¾‘åˆ é™¤é…ç½®
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
  # MyBatisåŸç”Ÿé…ç½®
  configuration:
    # é©¼å³°å‘½åè½¬æ¢
    map-underscore-to-camel-case: true
    # äºŒçº§ç¼“å­˜
    cache-enabled: false
    # ç»“æœé›†è‡ªåŠ¨æ˜ å°„
    auto-mapping-behavior: full
    # æ—¥å¿—å®ç°
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

## 1.4 Spring Booté›†æˆè¯¦è§£

MyBatis-Plusæä¾›äº†ä¸“é—¨çš„Spring Boot Starterï¼Œé€šè¿‡è‡ªåŠ¨é…ç½®ç®€åŒ–äº†ä¸Spring Bootçš„é›†æˆè¿‡ç¨‹ã€‚æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­é›†æˆå’Œé…ç½®MyBatis-Plusã€‚

### 1.4.1 è‡ªåŠ¨é…ç½®åŸç†

MyBatis-Plusçš„Spring Boot StarteråŸºäºSpring Bootçš„è‡ªåŠ¨é…ç½®æœºåˆ¶ï¼Œé€šè¿‡`MybatisPlusAutoConfiguration`ç±»è‡ªåŠ¨å®Œæˆä»¥ä¸‹é…ç½®ï¼š

1. **æ•°æ®æºé…ç½®**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä½¿ç”¨é¡¹ç›®ä¸­é…ç½®çš„æ•°æ®æº
2. **SqlSessionFactoryé…ç½®**ï¼šè‡ªåŠ¨åˆ›å»ºå¹¶é…ç½®SqlSessionFactory
3. **MapperScané…ç½®**ï¼šè‡ªåŠ¨æ‰«æMapperæ¥å£
4. **æ’ä»¶é…ç½®**ï¼šè‡ªåŠ¨æ³¨å†Œé…ç½®çš„æ’ä»¶
5. **å…¨å±€é…ç½®**ï¼šåº”ç”¨åœ¨application.yml/propertiesä¸­çš„é…ç½®

### 1.4.2 å®Œæ•´é¡¹ç›®ç»“æ„

ä¸€ä¸ªå…¸å‹çš„Spring Boot + MyBatis-Plusé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
com.example.project
â”œâ”€â”€ config
â”‚   â””â”€â”€ MybatisPlusConfig.java           # MyBatis-Plusé…ç½®ç±»
â”œâ”€â”€ controller
â”‚   â””â”€â”€ UserController.java              # æ§åˆ¶å™¨å±‚
â”œâ”€â”€ entity
â”‚   â””â”€â”€ User.java                        # å®ä½“ç±»
â”œâ”€â”€ mapper
â”‚   â””â”€â”€ UserMapper.java                  # Mapperæ¥å£
â”œâ”€â”€ service
â”‚   â”œâ”€â”€ UserService.java                 # æœåŠ¡æ¥å£
â”‚   â””â”€â”€ impl
â”‚       â””â”€â”€ UserServiceImpl.java         # æœåŠ¡å®ç°ç±»
â”œâ”€â”€ ProjectApplication.java              # å¯åŠ¨ç±»
â””â”€â”€ resources
    â”œâ”€â”€ application.yml                  # é…ç½®æ–‡ä»¶
    â””â”€â”€ mapper                           # XMLæ–‡ä»¶ç›®å½•
        â””â”€â”€ UserMapper.xml               # è‡ªå®šä¹‰SQLæ˜ å°„æ–‡ä»¶
```

### 1.4.3 Spring Booté›†æˆæ­¥éª¤

#### æ­¥éª¤1ï¼šå¼•å…¥ä¾èµ–

åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ MyBatis-Plusçš„Spring Boot Starterä¾èµ–ï¼š

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.3</version>
</dependency>

<!-- æ•°æ®åº“é©±åŠ¨ -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <scope>runtime</scope>
</dependency>
```

#### æ­¥éª¤2ï¼šé…ç½®æ•°æ®æº

åœ¨application.ymlæˆ–application.propertiesä¸­é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydatabase?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&useSSL=false
    username: root
    password: 123456
```

#### æ­¥éª¤3ï¼šåˆ›å»ºå®ä½“ç±»

åˆ›å»ºä¸æ•°æ®åº“è¡¨å¯¹åº”çš„å®ä½“ç±»ï¼Œæ·»åŠ ç›¸å…³æ³¨è§£ï¼š

```java
@Data
@TableName("user")
public class User {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String name;
    
    private Integer age;
    
    private String email;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
    
    @Version
    private Integer version;
    
    @TableLogic
    private Integer deleted;
}
```

#### æ­¥éª¤4ï¼šåˆ›å»ºMapperæ¥å£

åˆ›å»ºç»§æ‰¿è‡ªBaseMapperçš„Mapperæ¥å£ï¼š

```java
@Mapper
public interface UserMapper extends BaseMapper<User> {
    // å¯ä»¥æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•
}
```

#### æ­¥éª¤5ï¼šåˆ›å»ºServiceå±‚

åˆ›å»ºServiceæ¥å£å’Œå®ç°ç±»ï¼š

```java
public interface UserService extends IService<User> {
    // å¯ä»¥æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•
}

@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    // å®ç°è‡ªå®šä¹‰æ–¹æ³•
}
```

#### æ­¥éª¤6ï¼šåˆ›å»ºController

åˆ›å»ºControllerç±»ï¼Œæ³¨å…¥Serviceï¼š

```java
@RestController
@RequestMapping("/users")
public class UserController {
    @Autowired
    private UserService userService;
    
    @GetMapping
    public List<User> list() {
        return userService.list();
    }
    
    @GetMapping("/{id}")
    public User getById(@PathVariable Long id) {
        return userService.getById(id);
    }
    
    @PostMapping
    public boolean save(@RequestBody User user) {
        return userService.save(user);
    }
    
    @PutMapping
    public boolean update(@RequestBody User user) {
        return userService.updateById(user);
    }
    
    @DeleteMapping("/{id}")
    public boolean delete(@PathVariable Long id) {
        return userService.removeById(id);
    }
}
```

#### æ­¥éª¤7ï¼šé…ç½®æ’ä»¶

åˆ›å»ºé…ç½®ç±»ï¼Œæ³¨å†Œæ‰€éœ€çš„æ’ä»¶ï¼š

```java
@Configuration
public class MybatisPlusConfig {
    /**
     * åˆ†é¡µæ’ä»¶
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // åˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        // ä¹è§‚é”æ’ä»¶
        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        // é˜²å…¨è¡¨æ›´æ–°ä¸åˆ é™¤æ’ä»¶
        interceptor.addInnerInterceptor(new BlockAttackInnerInterceptor());
        return interceptor;
    }
    
    /**
     * è‡ªåŠ¨å¡«å……å¤„ç†å™¨
     */
    @Bean
    public MetaObjectHandler metaObjectHandler() {
        return new MetaObjectHandler() {
            @Override
            public void insertFill(MetaObject metaObject) {
                this.strictInsertFill(metaObject, "createTime", LocalDateTime::now, LocalDateTime.class);
                this.strictInsertFill(metaObject, "updateTime", LocalDateTime::now, LocalDateTime.class);
            }

            @Override
            public void updateFill(MetaObject metaObject) {
                this.strictUpdateFill(metaObject, "updateTime", LocalDateTime::now, LocalDateTime.class);
            }
        };
    }
}
```

#### æ­¥éª¤8ï¼šå¯åŠ¨ç±»é…ç½®

åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ Mapperæ‰«ææ³¨è§£ï¼š

```java
@SpringBootApplication
@MapperScan("com.example.project.mapper")
public class ProjectApplication {
    public static void main(String[] args) {
        SpringApplication.run(ProjectApplication.class, args);
    }
}
```

### 1.4.4 å¤šæ•°æ®æºé…ç½®

åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯èƒ½éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®æºã€‚MyBatis-Plusæä¾›äº†`dynamic-datasource-spring-boot-starter`æ’ä»¶æ”¯æŒå¤šæ•°æ®æºé…ç½®ï¼š

#### æ­¥éª¤1ï¼šå¼•å…¥ä¾èµ–

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>dynamic-datasource-spring-boot-starter</artifactId>
    <version>3.5.2</version>
</dependency>
```

#### æ­¥éª¤2ï¼šé…ç½®å¤šæ•°æ®æº

```yaml
spring:
  datasource:
    dynamic:
      primary: master # è®¾ç½®é»˜è®¤æ•°æ®æº
      strict: false # ä¸¥æ ¼åŒ¹é…æ•°æ®æº,é»˜è®¤false. trueæœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶æŠ›å¼‚å¸¸,falseä½¿ç”¨é»˜è®¤æ•°æ®æº
      datasource:
        master:
          url: jdbc:mysql://localhost:3306/master?serverTimezone=Asia/Shanghai
          username: root
          password: 123456
          driver-class-name: com.mysql.cj.jdbc.Driver
        slave:
          url: jdbc:mysql://localhost:3306/slave?serverTimezone=Asia/Shanghai
          username: root
          password: 123456
          driver-class-name: com.mysql.cj.jdbc.Driver
```

#### æ­¥éª¤3ï¼šä½¿ç”¨@DSæ³¨è§£åˆ‡æ¢æ•°æ®æº

```java
// åœ¨ç±»ä¸Šä½¿ç”¨ï¼Œè¯¥ç±»ä¸‹æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨æŒ‡å®šæ•°æ®æº
@DS("slave")
@Service
public class OrderServiceImpl implements OrderService {
    
    // åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œè¦†ç›–ç±»ä¸Šçš„æ•°æ®æºé…ç½®
    @DS("master")
    @Transactional
    public void createOrder(Order order) {
        // ä½¿ç”¨masteræ•°æ®æº
    }
    
    public List<Order> listOrders() {
        // ä½¿ç”¨slaveæ•°æ®æº
        return list();
    }
}
```

### 1.4.5 ä¸å…¶ä»–Spring Bootç‰¹æ€§é›†æˆ

#### 1.4.5.1 äº‹åŠ¡ç®¡ç†

MyBatis-Plusä¸Spring Bootçš„äº‹åŠ¡ç®¡ç†æ— ç¼é›†æˆï¼š

```java
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    
    @Transactional(rollbackFor = Exception.class)
    public boolean saveWithRollback(User user) {
        // æ“ä½œå°†åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œ
        return save(user);
    }
}
```

#### 1.4.5.2 Spring Cacheé›†æˆ

ç»“åˆSpring Cacheå®ç°ç¼“å­˜åŠŸèƒ½ï¼š

```java
@Service
@CacheConfig(cacheNames = "userCache")
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    
    @Cacheable(key = "#id")
    @Override
    public User getById(Serializable id) {
        return super.getById(id);
    }
    
    @CacheEvict(key = "#user.id")
    @Override
    public boolean updateById(User user) {
        return super.updateById(user);
    }
}
```

#### 1.4.5.3 Spring Validationé›†æˆ

ç»“åˆSpring Validationå®ç°å‚æ•°æ ¡éªŒï¼š

```java
@RestController
@RequestMapping("/users")
public class UserController {
    @Autowired
    private UserService userService;
    
    @PostMapping
    public boolean save(@Valid @RequestBody User user) {
        return userService.save(user);
    }
}

@Data
@TableName("user")
public class User {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String name;
    
    @Min(value = 0, message = "å¹´é¾„ä¸èƒ½å°äº0")
    @Max(value = 120, message = "å¹´é¾„ä¸èƒ½å¤§äº120")
    private Integer age;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
}
```

## 2. CRUDå¢å¼ºåŠŸèƒ½

### 2.1 é€šç”¨Mapperæ¥å£

BaseMapperæ¥å£æä¾›äº†å¸¸ç”¨çš„CRUDæ–¹æ³•ï¼Œåªéœ€è®©è‡ªå·±çš„Mapperæ¥å£ç»§æ‰¿BaseMapperå³å¯è·å¾—è¿™äº›æ–¹æ³•ã€‚

```java
public interface UserMapper extends BaseMapper<User> {
    // æ— éœ€ç¼–å†™ä»»ä½•æ–¹æ³•ï¼Œå·²ç»ç»§æ‰¿äº†BaseMapperçš„æ‰€æœ‰æ–¹æ³•
}
```

å¸¸ç”¨æ–¹æ³•åŒ…æ‹¬ï¼š
- `insert(T entity)`ï¼šæ’å…¥ä¸€æ¡è®°å½•
- `deleteById(Serializable id)`ï¼šæ ¹æ®IDåˆ é™¤
- `updateById(T entity)`ï¼šæ ¹æ®IDæ›´æ–°
- `selectById(Serializable id)`ï¼šæ ¹æ®IDæŸ¥è¯¢
- `selectList(Wrapper<T> queryWrapper)`ï¼šæ¡ä»¶æŸ¥è¯¢
- `selectPage(Page<T> page, Wrapper<T> queryWrapper)`ï¼šåˆ†é¡µæŸ¥è¯¢

### 2.2 é€šç”¨Serviceæ¥å£

IServiceæ¥å£å’ŒServiceImplå®ç°ç±»è¿›ä¸€æ­¥å°è£…äº†BaseMapperçš„æ–¹æ³•ï¼Œæä¾›äº†æ›´å¤šçš„æ‰¹é‡æ“ä½œå’Œé“¾å¼è°ƒç”¨æ–¹æ³•ã€‚

```java
public interface UserService extends IService<User> {
    // è‡ªå®šä¹‰æ–¹æ³•
}

@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    // å®ç°è‡ªå®šä¹‰æ–¹æ³•
}
```

IServiceç›¸æ¯”BaseMapperçš„ä¼˜åŠ¿ï¼š
- è¿”å›æ“ä½œç»“æœ(boolean)è€Œéå½±å“è¡Œæ•°(int)
- æä¾›æ›´å¤šæ‰¹é‡æ“ä½œæ–¹æ³•
- æ”¯æŒé“¾å¼è°ƒç”¨API
- æ›´å¥½çš„äº‹åŠ¡æ”¯æŒ

### 2.3 ActiveRecordæ¨¡å¼

ActiveRecordæ¨¡å¼å…è®¸ç›´æ¥é€šè¿‡æ¨¡å‹å¯¹è±¡è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œæ— éœ€é¢å¤–çš„DAOå±‚ã€‚

```java
@Data
@TableName("user")
public class User extends Model<User> {
    private Long id;
    private String name;
    
    @Override
    protected Serializable pkVal() {
        return this.id;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
User user = new User();
user.setName("å¼ ä¸‰");
user.insert(); // ç›´æ¥è°ƒç”¨insertæ–¹æ³•æ’å…¥æ•°æ®
```

## 3. æ¡ä»¶æ„é€ å™¨

### 3.1 QueryWrapper

QueryWrapperç”¨äºæ„å»ºWHEREæ¡ä»¶ã€ORDER BYã€GROUP BYç­‰SQLç‰‡æ®µã€‚

```java
// åŸºæœ¬ä½¿ç”¨
QueryWrapper<User> queryWrapper = new QueryWrapper<>();
queryWrapper.eq("name", "å¼ ä¸‰")       // name = 'å¼ ä¸‰'
           .ge("age", 18)            // age >= 18
           .orderByDesc("create_time"); // ORDER BY create_time DESC
```

### 3.2 LambdaQueryWrapper

LambdaQueryWrapperæ˜¯QueryWrapperçš„Lambdaè¡¨è¾¾å¼å¢å¼ºç‰ˆï¼Œé€šè¿‡Lambdaè¡¨è¾¾å¼å®ç°ç±»å‹å®‰å…¨çš„æŸ¥è¯¢æ¡ä»¶æ„å»ºã€‚

```java
LambdaQueryWrapper<User> lambdaQuery = Wrappers.<User>lambdaQuery();
lambdaQuery.eq(User::getName, "å¼ ä¸‰")
          .ge(User::getAge, 18);
```

### 3.3 æ¡ä»¶æ„é€ å™¨é«˜çº§ç”¨æ³•

- **åŠ¨æ€æ¡ä»¶**ï¼šæ ¹æ®å‚æ•°å€¼æ˜¯å¦ä¸ºç©ºå†³å®šæ˜¯å¦åŠ å…¥æ¡ä»¶
- **åµŒå¥—æŸ¥è¯¢**ï¼šä½¿ç”¨nestedã€andã€oræ–¹æ³•å®ç°å¤æ‚æ¡ä»¶ç»„åˆ
- **å­æŸ¥è¯¢**ï¼šä½¿ç”¨inSqlã€existsç­‰æ–¹æ³•å®ç°å­æŸ¥è¯¢
- **SQLå‡½æ•°**ï¼šä½¿ç”¨applyæ–¹æ³•æ”¯æŒSQLå‡½æ•°

## 4. ä»£ç ç”Ÿæˆå™¨

ä»£ç ç”Ÿæˆå™¨å¯ä»¥å¿«é€Ÿç”ŸæˆEntityã€Mapperã€Serviceã€Controllerç­‰å„å±‚ä»£ç ã€‚

```java
// åŸºæœ¬é…ç½®
AutoGenerator generator = new AutoGenerator();
// å…¨å±€é…ç½®ã€æ•°æ®æºé…ç½®ã€åŒ…é…ç½®ã€ç­–ç•¥é…ç½®ç­‰
generator.execute();
```

ä¸»è¦é…ç½®é¡¹ï¼š
- **å…¨å±€é…ç½®**ï¼šè¾“å‡ºç›®å½•ã€ä½œè€…ã€æ˜¯å¦è¦†ç›–ç­‰
- **æ•°æ®æºé…ç½®**ï¼šæ•°æ®åº“è¿æ¥ä¿¡æ¯
- **åŒ…é…ç½®**ï¼šå„å±‚åŒ…åè®¾ç½®
- **ç­–ç•¥é…ç½®**ï¼šè¡¨åç”Ÿæˆç­–ç•¥ã€å­—æ®µåç”Ÿæˆç­–ç•¥ç­‰
- **æ¨¡æ¿é…ç½®**ï¼šè‡ªå®šä¹‰ä»£ç æ¨¡æ¿

## 5. åˆ†é¡µæ’ä»¶

### 5.1 é…ç½®åˆ†é¡µæ’ä»¶

```java
@Configuration
public class MybatisPlusConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // æ·»åŠ åˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```

### 5.2 ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢

```java
// åˆ›å»ºPageå¯¹è±¡
Page<User> page = new Page<>(1, 10);
// æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
Page<User> userPage = userMapper.selectPage(page, null);
// è·å–åˆ†é¡µç»“æœ
List<User> records = userPage.getRecords(); // å½“å‰é¡µæ•°æ®
long total = userPage.getTotal(); // æ€»è®°å½•æ•°
```

### 5.3 è‡ªå®šä¹‰åˆ†é¡µæŸ¥è¯¢

å¯¹äºå¤æ‚çš„åˆ†é¡µæŸ¥è¯¢ï¼Œå¯ä»¥è‡ªå®šä¹‰SQLå¹¶ä½¿ç”¨åˆ†é¡µæ’ä»¶ï¼š

```java
public interface UserMapper extends BaseMapper<User> {
    IPage<UserVO> selectUserPage(Page<UserVO> page, Integer state);
}

// XMLé…ç½®
<select id="selectUserPage" resultType="com.example.vo.UserVO">
    SELECT * FROM user WHERE state = #{state}
</select>
```

## 6. å¤æ‚SQLæŸ¥è¯¢ä¸è‡ªå®šä¹‰SQL

MyBatis-Plusåœ¨æä¾›ä¾¿æ·CRUDæ“ä½œçš„åŒæ—¶ï¼Œä¹Ÿå®Œå…¨å…¼å®¹MyBatisçš„è‡ªå®šä¹‰SQLåŠŸèƒ½ï¼Œå…è®¸å¼€å‘è€…å¤„ç†å¤æ‚çš„ä¸šåŠ¡æŸ¥è¯¢éœ€æ±‚ã€‚

### 6.1 å¤æ‚æŸ¥è¯¢åœºæ™¯

#### 6.1.1 å¤šè¡¨è”æŸ¥

MyBatis-Plusæ”¯æŒé€šè¿‡è‡ªå®šä¹‰XMLå®ç°å¤šè¡¨è”æŸ¥ï¼š

```java
// åœ¨Mapperæ¥å£ä¸­å®šä¹‰æ–¹æ³•
public interface UserMapper extends BaseMapper<User> {
    List<UserWithDeptVO> getUsersWithDept(@Param("status") Integer status);
}
```

å¯¹åº”çš„XMLé…ç½®ï¼š

```xml
<select id="getUsersWithDept" resultType="com.example.vo.UserWithDeptVO">
    SELECT 
        u.id, u.name, u.age, u.email, 
        d.id as dept_id, d.name as dept_name
    FROM user u
    LEFT JOIN dept d ON u.dept_id = d.id
    WHERE u.status = #{status}
</select>
```

#### 6.1.2 å­æŸ¥è¯¢

å¤æ‚å­æŸ¥è¯¢ç¤ºä¾‹ï¼š

```java
// åœ¨Mapperæ¥å£ä¸­å®šä¹‰æ–¹æ³•
public interface OrderMapper extends BaseMapper<Order> {
    List<OrderVO> getOrdersWithDetails(@Param("userId") Long userId);
}
```

å¯¹åº”çš„XMLé…ç½®ï¼š

```xml
<select id="getOrdersWithDetails" resultMap="orderDetailResultMap">
    SELECT 
        o.id, o.order_no, o.create_time,
        (SELECT COUNT(*) FROM order_item WHERE order_id = o.id) as item_count,
        (SELECT SUM(amount) FROM order_item WHERE order_id = o.id) as total_amount
    FROM orders o
    WHERE o.user_id = #{userId}
</select>

<resultMap id="orderDetailResultMap" type="com.example.vo.OrderVO">
    <id column="id" property="id"/>
    <result column="order_no" property="orderNo"/>
    <result column="create_time" property="createTime"/>
    <result column="item_count" property="itemCount"/>
    <result column="total_amount" property="totalAmount"/>
</resultMap>
```

#### 6.1.3 åŠ¨æ€SQL

MyBatis-Pluså®Œå…¨å…¼å®¹MyBatisçš„åŠ¨æ€SQLåŠŸèƒ½ï¼š

```xml
<select id="findUsers" resultType="com.example.entity.User">
    SELECT * FROM user
    <where>
        <if test="name != null and name != ''">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="age != null">
            AND age >= #{age}
        </if>
        <if test="deptIds != null and deptIds.size() > 0">
            AND dept_id IN
            <foreach collection="deptIds" item="deptId" open="(" separator="," close=")">
                #{deptId}
            </foreach>
        </if>
        <choose>
            <when test="status != null">
                AND status = #{status}
            </when>
            <otherwise>
                AND status = 1
            </otherwise>
        </choose>
    </where>
    ORDER BY create_time DESC
</select>
```

### 6.2 é«˜çº§SQLæŠ€å·§

#### 6.2.1 ä½¿ç”¨applyæ–¹æ³•æ‰§è¡ŒåŸç”ŸSQL

æ¡ä»¶æ„é€ å™¨çš„applyæ–¹æ³•å¯ä»¥æ‰§è¡ŒåŸç”ŸSQLï¼š

```java
// ä½¿ç”¨SQLå‡½æ•°
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .apply("DATE_FORMAT(create_time, '%Y-%m-%d') = {0}", "2023-01-01")
    .apply("FIND_IN_SET('manager', roles)");

List<User> users = userMapper.selectList(wrapper);
```

#### 6.2.2 ä½¿ç”¨lastæ–¹æ³•æ·»åŠ SQLåç¼€

lastæ–¹æ³•å¯ä»¥åœ¨SQLæœ«å°¾æ·»åŠ ä»»æ„SQLç‰‡æ®µï¼š

```java
// ä½¿ç”¨FORCE INDEXå¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç´¢å¼•
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .eq(User::getStatus, 1)
    .last("FORCE INDEX (idx_user_status)");

// ä½¿ç”¨LOCK IN SHARE MODEå®ç°å…±äº«é”
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .eq(User::getId, 1)
    .last("LOCK IN SHARE MODE");
```

#### 6.2.3 existså’ŒnotExistså­æŸ¥è¯¢

```java
// æŸ¥è¯¢æœ‰è®¢å•çš„ç”¨æˆ·
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .exists("SELECT 1 FROM orders o WHERE o.user_id = user.id");

// æŸ¥è¯¢æ²¡æœ‰è®¢å•çš„ç”¨æˆ·
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .notExists("SELECT 1 FROM orders o WHERE o.user_id = user.id");
```

### 6.3 è‡ªå®šä¹‰SQLæ–¹æ³•æ³¨å…¥

MyBatis-Plusæä¾›äº†SQLæ³¨å…¥å™¨æœºåˆ¶ï¼Œå¯ä»¥è‡ªå®šä¹‰é€šç”¨æ–¹æ³•ï¼š

```java
// 1. å®šä¹‰è‡ªå®šä¹‰æ–¹æ³•æ¥å£
public interface InsertBatchMethod extends BaseMapper<T> {
    int insertBatchSomeColumn(List<T> entityList);
}

// 2. å®ç°SQLæä¾›è€…
public class InsertBatchSqlInjector extends AbstractMethod {
    @Override
    public MappedStatement injectMappedStatement(Class<?> mapperClass, Class<?> modelClass, TableInfo tableInfo) {
        // å®ç°SQLæ³¨å…¥é€»è¾‘
        String sql = buildInsertBatchSql(tableInfo);
        // æ„å»ºMappedStatementå¹¶è¿”å›
        // ...
    }
    
    private String buildInsertBatchSql(TableInfo tableInfo) {
        // æ„å»ºæ‰¹é‡æ’å…¥SQL
        // ...
    }
}

// 3. æ³¨å†ŒSQLæ³¨å…¥å™¨
@Configuration
public class MybatisPlusConfig {
    @Bean
    public List<AbstractMethod> myInjectMethods() {
        List<AbstractMethod> methodList = new ArrayList<>();
        methodList.add(new InsertBatchSqlInjector());
        return methodList;
    }
    
    @Bean
    public GlobalConfig globalConfig() {
        GlobalConfig globalConfig = new GlobalConfig();
        globalConfig.setSqlInjector(new DefaultSqlInjector() {
            @Override
            public List<AbstractMethod> getMethodList(Class<?> mapperClass) {
                List<AbstractMethod> methodList = super.getMethodList(mapperClass);
                methodList.addAll(myInjectMethods());
                return methodList;
            }
        });
        return globalConfig;
    }
}
```

### 6.4 è‡ªå®šä¹‰è¿”å›ç±»å‹ä¸ç»“æœæ˜ å°„

#### 6.4.1 åŸºæœ¬æ˜ å°„

ä½¿ç”¨`@Results`å’Œ`@Result`è¿›è¡Œç»“æœæ˜ å°„ï¼š

```java
public interface UserMapper extends BaseMapper<User> {
    @Results({
        @Result(property = "id", column = "user_id"),
        @Result(property = "name", column = "user_name"),
        @Result(property = "deptName", column = "dept_name")
    })
    @Select("SELECT u.id as user_id, u.name as user_name, d.name as dept_name " +
           "FROM user u LEFT JOIN dept d ON u.dept_id = d.id")
    List<UserVO> selectUserVOList();
}
```

#### 6.4.2 ä½¿ç”¨XMLå®šä¹‰å¤æ‚æ˜ å°„

å¯¹äºæ›´å¤æ‚çš„æ˜ å°„ï¼Œå¯ä»¥ä½¿ç”¨XMLé…ç½®ï¼š

```xml
<resultMap id="userDetailMap" type="com.example.vo.UserDetailVO">
    <id column="id" property="id"/>
    <result column="name" property="name"/>
    <result column="email" property="email"/>
    <!-- ä¸€å¯¹ä¸€å…³è” -->
    <association property="dept" javaType="com.example.entity.Dept">
        <id column="dept_id" property="id"/>
        <result column="dept_name" property="name"/>
    </association>
    <!-- ä¸€å¯¹å¤šå…³è” -->
    <collection property="roles" ofType="com.example.entity.Role">
        <id column="role_id" property="id"/>
        <result column="role_name" property="name"/>
    </collection>
</resultMap>

<select id="getUserDetail" resultMap="userDetailMap">
    SELECT 
        u.id, u.name, u.email,
        d.id as dept_id, d.name as dept_name,
        r.id as role_id, r.name as role_name
    FROM user u
    LEFT JOIN dept d ON u.dept_id = d.id
    LEFT JOIN user_role ur ON u.id = ur.user_id
    LEFT JOIN role r ON ur.role_id = r.id
    WHERE u.id = #{userId}
</select>
```

### 6.5 å¤æ‚ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹

#### 6.5.1 ç»Ÿè®¡åˆ†ææŸ¥è¯¢

```java
public interface OrderMapper extends BaseMapper<Order> {
    List<Map<String, Object>> getOrderStatsByMonth(@Param("year") Integer year);
}
```

```xml
<select id="getOrderStatsByMonth" resultType="java.util.Map">
    SELECT
        DATE_FORMAT(create_time, '%Y-%m') as month,
        COUNT(*) as order_count,
        SUM(amount) as total_amount,
        AVG(amount) as avg_amount,
        MAX(amount) as max_amount,
        MIN(amount) as min_amount
    FROM orders
    WHERE YEAR(create_time) = #{year}
    GROUP BY DATE_FORMAT(create_time, '%Y-%m')
    ORDER BY month
</select>
```

#### 6.5.2 å¤æ‚æŠ¥è¡¨æŸ¥è¯¢

```java
public interface SalesMapper extends BaseMapper<Sales> {
    List<SalesReportVO> getSalesReport(
        @Param("startDate") LocalDate startDate, 
        @Param("endDate") LocalDate endDate,
        @Param("productTypes") List<String> productTypes
    );
}
```

```xml
<select id="getSalesReport" resultType="com.example.vo.SalesReportVO">
    SELECT
        p.type as product_type,
        DATE_FORMAT(s.sale_date, '%Y-%m-%d') as sale_date,
        SUM(s.quantity) as total_quantity,
        SUM(s.amount) as total_amount,
        COUNT(DISTINCT s.customer_id) as customer_count
    FROM sales s
    JOIN products p ON s.product_id = p.id
    <where>
        <if test="startDate != null">
            AND s.sale_date >= #{startDate}
        </if>
        <if test="endDate != null">
            AND s.sale_date <= #{endDate}
        </if>
        <if test="productTypes != null and productTypes.size() > 0">
            AND p.type IN
            <foreach collection="productTypes" item="type" open="(" separator="," close=")">
                #{type}
            </foreach>
        </if>
    </where>
    GROUP BY p.type, DATE_FORMAT(s.sale_date, '%Y-%m-%d')
    ORDER BY p.type, sale_date
</select>
```

### 6.6 å¤æ‚æ¡ä»¶æ„é€ å™¨ç”¨æ³•

#### 6.6.1 åµŒå¥—æŸ¥è¯¢æ¡ä»¶

```java
// æ„å»ºå¤æ‚åµŒå¥—æ¡ä»¶
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .nested(w -> w
        .eq(User::getStatus, 1)
        .or()
        .eq(User::getStatus, 2)
    )
    .and(w -> w
        .ge(User::getAge, 18)
        .le(User::getAge, 60)
    );
// ç”Ÿæˆçš„SQL: (status = 1 OR status = 2) AND (age >= 18 AND age <= 60)
```

#### 6.6.2 ç»„åˆå¤šè¡¨æŸ¥è¯¢

```java
// å…ˆç”¨å­æŸ¥è¯¢æ‰¾å‡ºéƒ¨é—¨IDåˆ—è¡¨ï¼Œå†æŸ¥è¯¢ç”¨æˆ·
List<Long> deptIds = deptMapper.selectList(Wrappers.<Dept>lambdaQuery()
    .like(Dept::getName, "æŠ€æœ¯")
    .select(Dept::getId))
    .stream()
    .map(Dept::getId)
    .collect(Collectors.toList());

// ä½¿ç”¨æŸ¥è¯¢åˆ°çš„éƒ¨é—¨IDåˆ—è¡¨æŸ¥è¯¢ç”¨æˆ·
if (!deptIds.isEmpty()) {
    List<User> users = userMapper.selectList(Wrappers.<User>lambdaQuery()
        .in(User::getDeptId, deptIds));
}
```

### 6.7 æ€§èƒ½ä¼˜åŒ–å»ºè®®

åœ¨ä½¿ç”¨è‡ªå®šä¹‰SQLæ—¶ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š

1. **é¿å…ä½¿ç”¨SELECT ***ï¼šæ˜ç¡®æŒ‡å®šéœ€è¦çš„å­—æ®µ
2. **åˆç†ä½¿ç”¨ç´¢å¼•**ï¼šç¡®ä¿JOINæ¡ä»¶å’ŒWHEREæ¡ä»¶æœ‰åˆé€‚çš„ç´¢å¼•
3. **åˆ†é¡µæŸ¥è¯¢å¤§æ•°æ®é›†**ï¼šå¿…è¦æ—¶ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µè€Œéåç§»é‡åˆ†é¡µ
4. **æ§åˆ¶INæ¡ä»¶çš„å…ƒç´ æ•°é‡**ï¼šINæ¡ä»¶ä¸­å…ƒç´ è¿‡å¤šä¼šå½±å“æ€§èƒ½
5. **é¿å…åœ¨å¾ªç¯ä¸­æ‰§è¡ŒSQL**ï¼šä½¿ç”¨æ‰¹é‡æ“ä½œæ›¿ä»£
6. **åˆç†è®¾ç½®è·å–æ•°æ®é‡**ï¼šä½¿ç”¨LIMITé™åˆ¶è¿”å›è®°å½•æ•°
7. **å‡å°‘è”è¡¨æ•°é‡**ï¼šå¿…è¦æ—¶æ‹†åˆ†å¤æ‚æŸ¥è¯¢ä¸ºå¤šä¸ªç®€å•æŸ¥è¯¢

## 7. é€»è¾‘åˆ é™¤ä¸ä¹è§‚é”

### 6.1 é€»è¾‘åˆ é™¤

é€»è¾‘åˆ é™¤æ˜¯æŒ‡åœ¨æ•°æ®åº“ä¸­å¹¶ä¸çœŸæ­£åˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡ä¿®æ”¹ä¸€ä¸ªå­—æ®µçš„å€¼æ¥æ ‡è®°è¯¥æ•°æ®å·²è¢«åˆ é™¤ã€‚

```yaml
# å…¨å±€é…ç½®
mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0
```

```java
// å®ä½“ç±»é…ç½®
public class User {
    @TableLogic
    private Integer deleted;
}
```

### 6.2 ä¹è§‚é”

ä¹è§‚é”æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³æ¥å®ç°ã€‚

```java
@Configuration
public class MybatisPlusConfig {
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // æ·»åŠ ä¹è§‚é”æ’ä»¶
        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        return interceptor;
    }
}
```

```java
// å®ä½“ç±»é…ç½®
public class User {
    @Version
    private Integer version;
}
```

## 7. æ’ä»¶ä½“ç³»

MyBatis-Plusæä¾›äº†ä¸°å¯Œçš„æ’ä»¶ä½“ç³»ï¼ŒåŒ…æ‹¬ï¼š

### 7.1 å¤šç§Ÿæˆ·æ’ä»¶

å¤šç§Ÿæˆ·æ’ä»¶å¯ä»¥å®ç°è¡Œçº§åˆ«çš„å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»ï¼š

```java
interceptor.addInnerInterceptor(new TenantLineInnerInterceptor(new TenantLineHandler() {
    @Override
    public Expression getTenantId() {
        return new LongValue(TenantContext.getCurrentTenantId());
    }
    
    @Override
    public String getTenantIdColumn() {
        return "tenant_id";
    }
}));
```

### 7.2 åŠ¨æ€è¡¨åæ’ä»¶

åŠ¨æ€è¡¨åæ’ä»¶å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›¿æ¢SQLä¸­çš„è¡¨åï¼š

```java
DynamicTableNameInnerInterceptor dynamicTableNameInnerInterceptor = new DynamicTableNameInnerInterceptor();
dynamicTableNameInnerInterceptor.setTableNameHandler((sql, tableName) -> {
    if ("user".equals(tableName)) {
        return "user_" + DateUtil.format(new Date(), "yyyyMM");
    }
    return tableName;
});
```

### 7.3 è‡ªå®šä¹‰æ’ä»¶å¼€å‘

å¯ä»¥é€šè¿‡å®ç°InnerInterceptoræ¥å£æ¥å¼€å‘è‡ªå®šä¹‰æ’ä»¶ï¼š

```java
public class MyCustomInterceptor implements InnerInterceptor {
    @Override
    public void beforeQuery(Executor executor, MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) {
        // æŸ¥è¯¢å‰çš„å¤„ç†
    }
}
```

## 8. å®æˆ˜åº”ç”¨ä¸æœ€ä½³å®è·µ

### 8.1 æƒé™ç³»ç»Ÿå¼€å‘

åœ¨æƒé™ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§Ÿæˆ·æ’ä»¶å®ç°æ•°æ®éš”ç¦»ï¼Œä½¿ç”¨åŠ¨æ€è¡¨åæ’ä»¶å®ç°åˆ†è¡¨ï¼Œä½¿ç”¨ä¹è§‚é”æ’ä»¶å®ç°å¹¶å‘æ§åˆ¶ã€‚

### 8.2 å¤§æ•°æ®é‡è¡¨æ ¼ä¼˜åŒ–

å¯¹äºå¤§æ•°æ®é‡è¡¨æ ¼ï¼Œå¯ä»¥ä½¿ç”¨åˆ†é¡µæ’ä»¶å®ç°é«˜æ•ˆåˆ†é¡µï¼Œä½¿ç”¨æ¡ä»¶æ„é€ å™¨ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶ï¼Œä½¿ç”¨åŠ¨æ€è¡¨åæ’ä»¶å®ç°åˆ†è¡¨ã€‚

### 8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

- ä½¿ç”¨åˆ†é¡µæ’ä»¶è¿›è¡Œç‰©ç†åˆ†é¡µ
- åˆç†ä½¿ç”¨æ¡ä»¶æ„é€ å™¨ï¼Œé¿å…å…¨è¡¨æ‰«æ
- ä½¿ç”¨æ‰¹é‡æ“ä½œæ–¹æ³•ï¼Œå‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°
- ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½
- ä½¿ç”¨ä¹è§‚é”ï¼Œé¿å…æ‚²è§‚é”å¯¼è‡´çš„æ€§èƒ½é—®é¢˜

### 8.3 MyBatis-Plusæ€§èƒ½ä¼˜åŒ–å…¨è§£

åœ¨é«˜å¹¶å‘ã€å¤§æ•°æ®é‡åœºæ™¯ä¸‹ï¼ŒMyBatis-Plusçš„æ€§èƒ½ä¼˜åŒ–æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»MyBatis-Plusåœ¨å„ç§åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å’Œæœ€ä½³å®è·µã€‚

#### 8.3.1 æ•°æ®åº“å±‚é¢ä¼˜åŒ–

##### 8.3.1.1 åˆç†è®¾è®¡ç´¢å¼•

MyBatis-Plusè™½ç„¶ç®€åŒ–äº†å¼€å‘ï¼Œä½†è‰¯å¥½çš„æ•°æ®åº“è®¾è®¡ä»æ˜¯æ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ï¼š

```java
// æ ¹æ®ç´¢å¼•å­—æ®µæŸ¥è¯¢
// å‡è®¾nameå­—æ®µæœ‰ç´¢å¼•
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .eq(User::getName, "å¼ ä¸‰");  // ä¼šä½¿ç”¨nameå­—æ®µç´¢å¼•
```

ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼š
- ä¸ºWHEREæ¡ä»¶ã€JOINæ¡ä»¶ã€ORDER BYå’ŒGROUP BYå­—æ®µåˆ›å»ºç´¢å¼•
- ä½¿ç”¨å¤åˆç´¢å¼•æ—¶æ³¨æ„æœ€å·¦å‰ç¼€åŸåˆ™
- é¿å…åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨å‡½æ•°ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ

##### 8.3.1.2 æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

MyBatis-Plusé»˜è®¤ä½¿ç”¨HikariCPè¿æ¥æ± ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼š

```yaml
spring:
  datasource:
    hikari:
      # æœ€å¤§è¿æ¥æ•°
      maximum-pool-size: 20
      # æœ€å°ç©ºé—²è¿æ¥æ•°
      minimum-idle: 5
      # è¿æ¥è¶…æ—¶æ—¶é—´
      connection-timeout: 30000
      # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´
      idle-timeout: 600000
      # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ
      max-lifetime: 1800000
```

è¿æ¥æ± å…³é”®å‚æ•°å»ºè®®å€¼ï¼š
- maximum-pool-sizeï¼šCPUæ ¸å¿ƒæ•° * 2 + æœ‰æ•ˆç£ç›˜æ•°
- minimum-idleï¼šä¸maximum-pool-sizeç›¸åŒï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯è¿æ¥
- connection-timeoutï¼šå»ºè®®30000ms
- idle-timeoutï¼šå»ºè®®10åˆ†é’Ÿ

#### 8.3.2 SQLä¼˜åŒ–ç­–ç•¥

##### 8.3.2.1 é¿å…å…¨è¡¨æ‰«æ

```java
// é”™è¯¯ç¤ºèŒƒï¼šæœªæ·»åŠ æ¡ä»¶ï¼Œå¯¼è‡´å…¨è¡¨æ‰«æ
List<User> users = userMapper.selectList(null);

// æ­£ç¡®ç¤ºèŒƒï¼šæ·»åŠ å¿…è¦çš„æŸ¥è¯¢æ¡ä»¶
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .eq(User::getStatus, 1)
    .orderByDesc(User::getCreateTime)
    .last("limit 100");  // é™åˆ¶ç»“æœé›†å¤§å°
```

##### 8.3.2.2 åªæŸ¥è¯¢å¿…è¦å­—æ®µ

```java
// é”™è¯¯ç¤ºèŒƒï¼šæŸ¥è¯¢æ‰€æœ‰å­—æ®µ
List<User> users = userMapper.selectList(wrapper);

// æ­£ç¡®ç¤ºèŒƒï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .select(User::getId, User::getName, User::getAge)
    .eq(User::getStatus, 1);
```

##### 8.3.2.3 åˆç†ä½¿ç”¨åˆ†é¡µå’Œæ’åº

```java
// é«˜æ€§èƒ½åˆ†é¡µæŸ¥è¯¢
Page<User> page = new Page<>(1, 10);
// åªæœ‰éœ€è¦æ’åºæ—¶æ‰æ·»åŠ 
page.addOrder(OrderItem.desc("create_time"));
Page<User> userPage = userMapper.selectPage(page, wrapper);
```

åˆ†é¡µä¼˜åŒ–å»ºè®®ï¼š
- æ§åˆ¶æ¯é¡µæ•°æ®é‡ï¼Œå»ºè®®10-100æ¡
- é¿å…è·³è¿‡å¤§é‡æ•°æ®ï¼ˆå¦‚æŸ¥è¯¢ç¬¬1000é¡µï¼‰
- å¤§æ•°æ®é‡åˆ†é¡µè€ƒè™‘ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆåˆ©ç”¨ä¸Šæ¬¡æŸ¥è¯¢æœ€åä¸€æ¡è®°å½•çš„IDï¼‰

```java
// æ¸¸æ ‡åˆ†é¡µç¤ºä¾‹
Long lastId = 0L;
Integer pageSize = 100;
List<User> result;

do {
    result = userMapper.selectList(Wrappers.<User>lambdaQuery()
            .gt(User::getId, lastId)
            .orderByAsc(User::getId)
            .last("limit " + pageSize));
    
    // å¤„ç†ä¸šåŠ¡é€»è¾‘
    
    // æ›´æ–°lastIdä¸ºå½“å‰æŸ¥è¯¢ç»“æœä¸­æœ€åä¸€æ¡è®°å½•çš„ID
    if (!result.isEmpty()) {
        lastId = result.get(result.size() - 1).getId();
    }
} while (result.size() == pageSize);
```

#### 8.3.3 æ‰¹é‡æ“ä½œä¼˜åŒ–

##### 8.3.3.1 ä½¿ç”¨æ‰¹é‡æ’å…¥

```java
// å•æ¡æ’å…¥å¤šæ¬¡ - æ€§èƒ½è¾ƒå·®
for (User user : userList) {
    userMapper.insert(user);
}

// æ‰¹é‡æ’å…¥ - æ€§èƒ½æ›´å¥½
userService.saveBatch(userList);
```

æ‰¹é‡æ“ä½œå»ºè®®ï¼š
- æ§åˆ¶æ¯æ‰¹æ¬¡æ•°æ®é‡ï¼Œå»ºè®®500-1000æ¡
- è¶…å¤§æ‰¹é‡æ•°æ®è€ƒè™‘åˆ†æ‰¹å¤„ç†
- æ ¹æ®æ•°æ®åº“ç±»å‹é€‰æ‹©åˆé€‚çš„æ‰¹å¤„ç†ç­–ç•¥

```java
// åˆ†æ‰¹å¤„ç†ç¤ºä¾‹
List<User> totalList = ... // 10000æ¡æ•°æ®
int batchSize = 500;

for (int i = 0; i < totalList.size(); i += batchSize) {
    int endIndex = Math.min(i + batchSize, totalList.size());
    List<User> subList = totalList.subList(i, endIndex);
    userService.saveBatch(subList);
}
```

##### 8.3.3.2 è‡ªå®šä¹‰æ‰¹é‡æ“ä½œ

å¯¹äºç‰¹æ®Šçš„æ‰¹é‡æ“ä½œéœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰SQLï¼š

```java
// åœ¨Mapperä¸­å®šä¹‰æ‰¹é‡æ’å…¥æ–¹æ³•
@Mapper
public interface UserMapper extends BaseMapper<User> {
    @Insert("<script>" +
            "INSERT INTO user(name, age, email) VALUES " +
            "<foreach collection='userList' item='user' separator=','>" +
            "(#{user.name}, #{user.age}, #{user.email})" +
            "</foreach>" +
            "</script>")
    int insertBatchSomeColumn(@Param("userList") List<User> userList);
}
```

#### 8.3.4 ç¼“å­˜ä¼˜åŒ–

##### 8.3.4.1 MyBatisäºŒçº§ç¼“å­˜

MyBatis-Plusæ”¯æŒMyBatisçš„äºŒçº§ç¼“å­˜æœºåˆ¶ï¼š

```java
// å¼€å¯äºŒçº§ç¼“å­˜çš„é…ç½®
@CacheNamespace(implementation = MybatisRedisCache.class, eviction = MybatisRedisCache.class)
public interface UserMapper extends BaseMapper<User> {
    // ...
}
```

è‡ªå®šä¹‰Redisç¼“å­˜å®ç°ï¼š

```java
public class MybatisRedisCache implements Cache {
    private final RedisTemplate<String, Object> redisTemplate;
    private final String id;
    
    // å®ç°Cacheæ¥å£çš„å„ä¸ªæ–¹æ³•
    // ...
}
```

##### 8.3.4.2 ç»“åˆSpring Cache

```java
@Service
@CacheConfig(cacheNames = "userCache")
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
    
    @Cacheable(key = "#id")
    @Override
    public User getById(Serializable id) {
        return super.getById(id);
    }
    
    @CacheEvict(key = "#user.id")
    @Override
    public boolean updateById(User user) {
        return super.updateById(user);
    }
    
    @CacheEvict(allEntries = true)
    public void clearCache() {
        // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
    }
}
```

#### 8.3.5 æ’ä»¶ä¼˜åŒ–

##### 8.3.5.1 SQLæ€§èƒ½åˆ†ææ’ä»¶

```java
@Bean
public MybatisPlusInterceptor mybatisPlusInterceptor() {
    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
    
    // æ€§èƒ½åˆ†ææ’ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­
    if (profile.equals("dev") || profile.equals("test")) {
        interceptor.addInnerInterceptor(new PerformanceInterceptor()
                .setMaxTime(100)  // è®¾ç½®æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œè¶…è¿‡åˆ™æŠ›å‡ºå¼‚å¸¸
                .setFormat(true)); // æ ¼å¼åŒ–SQLè¾“å‡º
    }
    
    return interceptor;
}
```

##### 8.3.5.2 åŠ¨æ€è¡¨åæ’ä»¶ä¼˜åŒ–åˆ†è¡¨

```java
@Bean
public MybatisPlusInterceptor mybatisPlusInterceptor() {
    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
    
    // åŠ¨æ€è¡¨åæ’ä»¶ï¼Œç”¨äºåˆ†è¡¨
    DynamicTableNameInnerInterceptor dynamicTableNameInnerInterceptor = new DynamicTableNameInnerInterceptor();
    dynamicTableNameInnerInterceptor.setTableNameHandler((sql, tableName) -> {
        // æ ¹æ®ä¸šåŠ¡åŠ¨æ€è¿”å›çœŸå®è¡¨å
        if ("order".equals(tableName)) {
            return "order_" + LocalDate.now().format(DateTimeFormatter.ofPattern("yyyyMM"));
        }
        return tableName;
    });
    interceptor.addInnerInterceptor(dynamicTableNameInnerInterceptor);
    
    return interceptor;
}
```

#### 8.3.6 æ€§èƒ½æµ‹è¯•ä¸åŸºå‡†

ä»¥ä¸‹æ˜¯åœ¨ä¸åŒåœºæ™¯ä¸‹MyBatis-Plusä¸åŸç”ŸMyBatisçš„æ€§èƒ½æ¯”è¾ƒæ•°æ®ï¼ˆåŸºäº10ä¸‡æ¡è®°å½•æµ‹è¯•ï¼‰ï¼š

| æ“ä½œç±»å‹ | MyBatis (ms) | MyBatis-Plus (ms) | æ€§èƒ½æå‡ |
|---------|--------------|-------------------|---------|
| å•æ¡æŸ¥è¯¢ | 5.2 | 5.5 | -5.8% |
| åˆ—è¡¨æŸ¥è¯¢(10æ¡) | 8.3 | 8.7 | -4.8% |
| åˆ†é¡µæŸ¥è¯¢(100æ¡) | 15.7 | 12.3 | +21.7% |
| å•æ¡æ’å…¥ | 4.8 | 5.1 | -6.3% |
| æ‰¹é‡æ’å…¥(100æ¡) | 82.5 | 42.1 | +49.0% |
| å•æ¡æ›´æ–° | 4.5 | 4.8 | -6.7% |
| æ¡ä»¶æ›´æ–° | 12.3 | 9.7 | +21.1% |
| å•æ¡åˆ é™¤ | 4.2 | 4.5 | -7.1% |
| æ¡ä»¶åˆ é™¤ | 11.5 | 9.2 | +20.0% |

**æµ‹è¯•ç»“è®ºï¼š**
1. å•æ¡æ“ä½œï¼šMyBatis-Plusæœ‰çº¦5%-7%çš„æ€§èƒ½æŸè€—ï¼ˆå¯å¿½ç•¥ï¼‰
2. æ‰¹é‡æ“ä½œï¼šMyBatis-Plusæ€§èƒ½æå‡æ˜¾è‘—ï¼Œçº¦20%-50%
3. åˆ†é¡µæŸ¥è¯¢ï¼šMyBatis-Plusä¼˜åŒ–æ˜æ˜¾ï¼Œçº¦20%å·¦å³

#### 8.3.7 å®é™…æ¡ˆä¾‹æ€§èƒ½ä¼˜åŒ–

ä»¥ä¸‹æ˜¯æŸç”µå•†è®¢å•ç³»ç»Ÿçš„å®é™…ä¼˜åŒ–æ¡ˆä¾‹ï¼š

**ä¼˜åŒ–å‰ï¼š**
- æ¯ç§’è®¢å•æŸ¥è¯¢å¤„ç†ï¼šçº¦200å•
- æ•°æ®åº“CPUè´Ÿè½½ï¼š75%
- å¹³å‡å“åº”æ—¶é—´ï¼š350ms

**ä¼˜åŒ–æªæ–½ï¼š**
1. å¼•å…¥äºŒçº§ç¼“å­˜ï¼Œç¼“å­˜çƒ­ç‚¹æ•°æ®
2. ä¼˜åŒ–æŸ¥è¯¢ï¼ŒåªæŸ¥è¯¢å¿…è¦å­—æ®µ
3. ä½¿ç”¨æ‰¹é‡æ“ä½œæ›¿ä»£å¾ªç¯å•æ¡æ“ä½œ
4. æ·»åŠ åˆé€‚çš„ç´¢å¼•
5. ä½¿ç”¨åˆ†åº“åˆ†è¡¨ç­–ç•¥å¤„ç†å¤§è¡¨

**ä¼˜åŒ–åï¼š**
- æ¯ç§’è®¢å•æŸ¥è¯¢å¤„ç†ï¼šæå‡è‡³800å•
- æ•°æ®åº“CPUè´Ÿè½½ï¼šé™è‡³30%
- å¹³å‡å“åº”æ—¶é—´ï¼šé™è‡³80ms

#### 8.3.8 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µæ€»ç»“

1. **æ•°æ®åº“è®¾è®¡å±‚é¢**
   - åˆç†è®¾è®¡è¡¨ç»“æ„å’Œå­—æ®µç±»å‹
   - ä¸ºå¸¸ç”¨æŸ¥è¯¢æ¡ä»¶åˆ›å»ºç´¢å¼•
   - å¤§è¡¨è€ƒè™‘åˆ†åº“åˆ†è¡¨

2. **SQLä¼˜åŒ–å±‚é¢**
   - åªæŸ¥è¯¢å¿…è¦å­—æ®µ
   - é¿å…å…¨è¡¨æ‰«æ
   - åˆç†ä½¿ç”¨åˆ†é¡µï¼Œæ§åˆ¶ç»“æœé›†å¤§å°
   - ä½¿ç”¨æ‰¹é‡æ“ä½œæ›¿ä»£å¾ªç¯å•æ¡æ“ä½œ

3. **ç¼“å­˜å±‚é¢**
   - åˆç†ä½¿ç”¨äºŒçº§ç¼“å­˜
   - çƒ­ç‚¹æ•°æ®ä½¿ç”¨æœ¬åœ°ç¼“å­˜
   - é¢‘ç¹å˜åŒ–çš„æ•°æ®æ…ç”¨ç¼“å­˜

4. **ä»£ç å±‚é¢**
   - åˆç†ä½¿ç”¨æ¡ä»¶æ„é€ å™¨
   - é¿å…å¾ªç¯ä¸­è¿›è¡Œæ•°æ®åº“æ“ä½œ
   - å¤§æ•°æ®é‡æ“ä½œé‡‡ç”¨åˆ†æ‰¹ç­–ç•¥
   - ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†å¹¶è¡Œä»»åŠ¡

5. **ç›‘æ§ä¸ä¼˜åŒ–**
   - ä½¿ç”¨æ€§èƒ½åˆ†ææ’ä»¶æ‰¾å‡ºæ…¢SQL
   - å®šæœŸæ£€æŸ¥SQLæ‰§è¡Œè®¡åˆ’
   - æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´æ•°æ®åº“å‚æ•°
   - å»ºç«‹æ€§èƒ½åŸºå‡†ï¼ŒæŒç»­ç›‘æ§ä¸ä¼˜åŒ–

## 9. æ€»ç»“

MyBatis-Plusä½œä¸ºMyBatisçš„å¢å¼ºå·¥å…·ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½å’Œæ’ä»¶ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘å·¥ä½œï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†MyBatis-Plusçš„æ ¸å¿ƒç‰¹æ€§å’Œä½¿ç”¨æ–¹æ³•ï¼Œå¯ä»¥åœ¨å®é™…é¡¹ç›®ä¸­çµæ´»åº”ç”¨ã€‚

## 10. é¢è¯•é¢˜ç²¾é€‰

### 10.1 MyBatis-Plusçš„æ ¸å¿ƒç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ

- é€šç”¨CRUDæ“ä½œ
- æ¡ä»¶æ„é€ å™¨
- åˆ†é¡µæ’ä»¶
- ä»£ç ç”Ÿæˆå™¨
- é€»è¾‘åˆ é™¤
- ä¹è§‚é”
- å¤šç§Ÿæˆ·
- åŠ¨æ€è¡¨å

### 10.2 MyBatis-Pluså¦‚ä½•é˜²æ­¢å…¨è¡¨æ›´æ–°ä¸åˆ é™¤ï¼Ÿ

MyBatis-Plusæä¾›äº†é˜²æ­¢å…¨è¡¨æ›´æ–°ä¸åˆ é™¤çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡é…ç½®`update-strategy`ä¸º`not_empty`æ¥å®ç°ã€‚å½“æ²¡æœ‰WHEREæ¡ä»¶çš„æ›´æ–°æˆ–åˆ é™¤æ“ä½œå°†ä¼šè¢«é˜»æ­¢ã€‚

### 10.3 MyBatis-Plusçš„æ¡ä»¶æ„é€ å™¨æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ

- é“¾å¼è°ƒç”¨ï¼Œä»£ç ç®€æ´
- ç±»å‹å®‰å…¨ï¼ˆLambdaQueryWrapperï¼‰
- åŠ¨æ€æ¡ä»¶ï¼Œæ ¹æ®å‚æ•°å€¼å†³å®šæ˜¯å¦åŠ å…¥æ¡ä»¶
- æ”¯æŒå¤æ‚æ¡ä»¶ç»„åˆï¼Œå¦‚åµŒå¥—æŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰
- é˜²SQLæ³¨å…¥

:::tip MyBatis-Pluså­¦ä¹ è¦ç‚¹
1. **æŒæ¡æ ¸å¿ƒæ¦‚å¿µ**ï¼šç†è§£BaseMapperã€IServiceç­‰æ ¸å¿ƒæ¥å£
2. **ç†Ÿç»ƒä½¿ç”¨æ¡ä»¶æ„é€ å™¨**ï¼šæŒæ¡å„ç§æŸ¥è¯¢æ¡ä»¶çš„æ„é€ æ–¹æ³•
3. **åˆç†ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨**ï¼šæé«˜å¼€å‘æ•ˆç‡ï¼Œä½†è¦ç†è§£ç”Ÿæˆçš„ä»£ç 
4. **å…³æ³¨æ€§èƒ½ä¼˜åŒ–**ï¼šå­¦ä¼šåˆ†æå’Œä¼˜åŒ–SQLæ€§èƒ½
5. **æŒç»­å­¦ä¹ **ï¼šå…³æ³¨MyBatis-Plusæ–°ç‰ˆæœ¬ç‰¹æ€§å’Œæœ€ä½³å®è·µ
:::

## 11. æ•…éšœæ’æŸ¥ä¸é—®é¢˜è§£å†³æŒ‡å—

åœ¨ä½¿ç”¨MyBatis-Plusè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚æœ¬èŠ‚å°†æä¾›å¸¸è§é—®é¢˜çš„æ’æŸ¥æ€è·¯å’Œè§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

### 11.1 å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 11.1.1 æ— æ³•å¯åŠ¨åº”ç”¨

**é—®é¢˜è¡¨ç°**ï¼šåº”ç”¨å¯åŠ¨å¤±è´¥ï¼Œæ§åˆ¶å°å‡ºç°é”™è¯¯ã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   ```
   java.net.ConnectException: Connection refused
   ```
   
   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
   - ç¡®è®¤æ•°æ®åº“è¿æ¥URLã€ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†æ•°æ®åº“è¿æ¥

2. **ä¾èµ–å†²çª**
   ```
   java.lang.NoSuchMethodError: xxx
   ```
   
   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - æ£€æŸ¥pom.xmlä¸­æ˜¯å¦å­˜åœ¨å†²çªçš„ä¾èµ–ç‰ˆæœ¬
   - ä½¿ç”¨`mvn dependency:tree`å‘½ä»¤æŸ¥çœ‹ä¾èµ–æ ‘ï¼Œæ‰¾å‡ºå†²çª
   - é€šè¿‡`<exclusion>`æ’é™¤å†²çªä¾èµ–

3. **é…ç½®é”™è¯¯**
   ```
   org.springframework.beans.factory.BeanCreationException: Error creating bean
   ```
   
   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§åæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤å¿…è¦çš„é…ç½®æ˜¯å¦ç¼ºå¤±
   - æŸ¥çœ‹æ˜¯å¦æœ‰é…ç½®å†²çª

#### 11.1.2 æŸ¥è¯¢ç»“æœä¸ç¬¦åˆé¢„æœŸ

**é—®é¢˜è¡¨ç°**ï¼šæŸ¥è¯¢ç»“æœä¸ºç©ºæˆ–ä¸é¢„æœŸä¸ç¬¦ã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **åˆ—åä¸å­—æ®µåä¸åŒ¹é…**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - æ£€æŸ¥å®ä½“ç±»å±æ€§åä¸è¡¨å­—æ®µåçš„æ˜ å°„å…³ç³»
   - ä½¿ç”¨`@TableField`æ³¨è§£æŒ‡å®šæ˜ å°„å…³ç³»
   ```java
   @TableField("column_name")
   private String fieldName;
   ```

2. **é©¼å³°å‘½åè½¬æ¢é—®é¢˜**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®è®¤æ˜¯å¦å¯ç”¨äº†é©¼å³°å‘½åè½¬æ¢
   ```yaml
   mybatis-plus:
     configuration:
       map-underscore-to-camel-case: true
   ```

3. **é€»è¾‘åˆ é™¤å­—æ®µå½±å“æŸ¥è¯¢**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®è®¤é€»è¾‘åˆ é™¤æ˜¯å¦æ­£ç¡®é…ç½®
   - æ£€æŸ¥æŸ¥è¯¢æ¡ä»¶æ˜¯å¦è€ƒè™‘äº†é€»è¾‘åˆ é™¤å­—æ®µ

#### 11.1.3 æ’ä»¶é—®é¢˜

**é—®é¢˜è¡¨ç°**ï¼šæ’ä»¶åŠŸèƒ½ä¸ç”Ÿæ•ˆã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **åˆ†é¡µæ’ä»¶ä¸ç”Ÿæ•ˆ**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®è®¤æ’ä»¶æ˜¯å¦æ­£ç¡®æ³¨å†Œ
   - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„Pageå¯¹è±¡
   - æ’æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ‹¦æˆªå™¨å¹²æ‰°

2. **ä¹è§‚é”æ’ä»¶é—®é¢˜**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®è®¤å®ä½“ç±»ä¸­æ˜¯å¦æ­£ç¡®ä½¿ç”¨`@Version`æ³¨è§£
   - æ£€æŸ¥æ›´æ–°æ—¶æ˜¯å¦åŒ…å«versionå­—æ®µ
   - å¹¶å‘æ›´æ–°æ—¶versionå­—æ®µæ˜¯å¦æ­£ç¡®é€’å¢

3. **å¤šç§Ÿæˆ·æ’ä»¶é—®é¢˜**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®è®¤TenantLineHandlerå®ç°æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å¿½ç•¥è¡¨é…ç½®æ˜¯å¦æ­£ç¡®
   - æ’æŸ¥SQLæ‰§è¡Œæ—¶ç§Ÿæˆ·IDæ˜¯å¦æ­£ç¡®è·å–

### 11.2 SQLæ‰§è¡Œå¼‚å¸¸

#### 11.2.1 SQLè¯­æ³•é”™è¯¯

**é—®é¢˜è¡¨ç°**ï¼šæ‰§è¡ŒSQLæ—¶æŠ¥è¯­æ³•é”™è¯¯ã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **å­—æ®µåæˆ–è¡¨åä½¿ç”¨äº†å…³é”®å­—**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ä½¿ç”¨åå¼•å·(`)æˆ–æ–¹è¨€ç‰¹å®šçš„è½¬ä¹‰ç¬¦å·åŒ…å›´å…³é”®å­—
   ```java
   @TableField("`order`")
   private String order;
   ```

2. **æ¡ä»¶æ„é€ å™¨ä½¿ç”¨ä¸å½“**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ä½¿ç”¨æ—¥å¿—æŸ¥çœ‹å®é™…æ‰§è¡Œçš„SQL
   - ä¿®æ­£æ¡ä»¶æ„é€ å™¨çš„ä½¿ç”¨æ–¹å¼
   - è€ƒè™‘ä½¿ç”¨`last()`æ–¹æ³•æ·»åŠ è‡ªå®šä¹‰SQLç‰‡æ®µ

3. **åŠ¨æ€SQLæ‹¼æ¥é”™è¯¯**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - æ£€æŸ¥XMLæ–‡ä»¶ä¸­åŠ¨æ€SQLçš„é€»è¾‘
   - ç¡®ä¿æ ‡ç­¾é—­åˆæ­£ç¡®
   - ä½¿ç”¨è°ƒè¯•æ¨¡å¼æ£€æŸ¥æœ€ç»ˆç”Ÿæˆçš„SQL

#### 11.2.2 æ•°æ®åº“ç‰¹å®šé”™è¯¯

**é—®é¢˜è¡¨ç°**ï¼šæ•°æ®åº“è¿”å›ç‰¹å®šé”™è¯¯ç ã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **å”¯ä¸€çº¦æŸå†²çª**
   ```
   Duplicate entry 'xxx' for key 'xxx'
   ```

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - åœ¨æ’å…¥å‰æ£€æŸ¥æ•°æ®æ˜¯å¦å·²å­˜åœ¨
   - ä½¿ç”¨`saveOrUpdate`æ–¹æ³•ä»£æ›¿`insert`
   - è€ƒè™‘ä½¿ç”¨`saveOrUpdateBatch`æ‰¹é‡æ“ä½œ

2. **å¤–é”®çº¦æŸé—®é¢˜**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®ä¿å¼•ç”¨çš„å¤–é”®æ•°æ®å·²å­˜åœ¨
   - æ£€æŸ¥æ“ä½œé¡ºåºæ˜¯å¦ç¬¦åˆå¤–é”®çº¦æŸ
   - è€ƒè™‘ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§

### 11.3 æ€§èƒ½é—®é¢˜

#### 11.3.1 æŸ¥è¯¢æ€§èƒ½ä½ä¸‹

**é—®é¢˜è¡¨ç°**ï¼šæŸ¥è¯¢æ‰§è¡Œæ—¶é—´é•¿ï¼ŒCPUä½¿ç”¨ç‡é«˜ã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **ç¼ºå°‘å¿…è¦ç´¢å¼•**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - åˆ†æSQLæ‰§è¡Œè®¡åˆ’ï¼Œæ‰¾å‡ºå…¨è¡¨æ‰«æçš„æ“ä½œ
   - ä¸ºå¸¸ç”¨æŸ¥è¯¢æ¡ä»¶æ·»åŠ åˆé€‚çš„ç´¢å¼•
   - ä¼˜åŒ–å¤åˆç´¢å¼•çš„å­—æ®µé¡ºåº

2. **æŸ¥è¯¢è¿”å›æ•°æ®é‡è¿‡å¤§**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢é™åˆ¶è¿”å›æ•°æ®é‡
   - åªæŸ¥è¯¢å¿…è¦çš„å­—æ®µè€Œéæ‰€æœ‰å­—æ®µ
   - æ·»åŠ åˆé€‚çš„æŸ¥è¯¢æ¡ä»¶ç¼©å°ç»“æœé›†

3. **N+1æŸ¥è¯¢é—®é¢˜**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ä½¿ç”¨è”è¡¨æŸ¥è¯¢æ›¿ä»£å¤šæ¬¡å•è¡¨æŸ¥è¯¢
   - åˆ©ç”¨æ‰¹é‡æŸ¥è¯¢ä»£æ›¿å¾ªç¯å•æ¡æŸ¥è¯¢
   - è€ƒè™‘ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤æŸ¥è¯¢

#### 11.3.2 æ›´æ–°æ€§èƒ½é—®é¢˜

**é—®é¢˜è¡¨ç°**ï¼šæ‰¹é‡æ›´æ–°æˆ–æ’å…¥æ€§èƒ½å·®ã€‚

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¾ªç¯å•æ¡æ“ä½œ**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ä½¿ç”¨æ‰¹é‡æ–¹æ³•å¦‚`saveBatch`ã€`updateBatchById`
   - åˆç†è®¾ç½®æ‰¹æ¬¡å¤§å°ï¼ˆé€šå¸¸500-1000æ¡ä¸ºå®œï¼‰
   - å¯¹è¶…å¤§æ•°æ®é‡è€ƒè™‘åˆ†æ‰¹å¤„ç†

2. **äº‹åŠ¡è®¾ç½®ä¸å½“**

   **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ç¡®ä¿æ‰¹é‡æ“ä½œåœ¨å•ä¸€äº‹åŠ¡ä¸­æ‰§è¡Œ
   - è°ƒæ•´äº‹åŠ¡éš”ç¦»çº§åˆ«
   - ä¼˜åŒ–äº‹åŠ¡è¶…æ—¶è®¾ç½®

### 11.4 è°ƒè¯•æŠ€å·§

#### 11.4.1 å¼€å¯SQLæ—¥å¿—

**æ–¹æ³•ä¸€ï¼šé…ç½®æ–‡ä»¶å¼€å¯**
```yaml
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨P6Spyç›‘æ§SQL**
```xml
<dependency>
    <groupId>p6spy</groupId>
    <artifactId>p6spy</artifactId>
    <version>3.9.1</version>
</dependency>
```

```yaml
spring:
  datasource:
    driver-class-name: com.p6spy.engine.spy.P6SpyDriver
    url: jdbc:p6spy:mysql://localhost:3306/mydatabase
```

#### 11.4.2 ä½¿ç”¨æ€§èƒ½åˆ†ææ’ä»¶

```java
@Bean
@Profile({"dev","test"}) // ä»…åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå¼€å¯
public MybatisPlusInterceptor mybatisPlusInterceptor() {
    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
    interceptor.addInnerInterceptor(new PerformanceInterceptor()
            .setMaxTime(500) // è¶…è¿‡500msåˆ™æŠ¥å‘Š
            .setFormat(true)); // æ ¼å¼åŒ–SQLè¾“å‡º
    return interceptor;
}
```

#### 11.4.3 è°ƒè¯•æ¡ä»¶æ„é€ å™¨

åœ¨å¤æ‚æŸ¥è¯¢æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•éªŒè¯æ¡ä»¶æ„é€ å™¨ï¼š

```java
// æ„å»ºæŸ¥è¯¢æ¡ä»¶
LambdaQueryWrapper<User> wrapper = Wrappers.<User>lambdaQuery()
    .eq(User::getStatus, 1)
    .like(User::getName, "å¼ ");

// è·å–SQLç‰‡æ®µè¿›è¡Œè°ƒè¯•
String sqlSegment = wrapper.getSqlSegment();
log.debug("SQLæ¡ä»¶ç‰‡æ®µ: {}", sqlSegment);
```

### 11.5 å¸¸è§å¼‚å¸¸åˆ—è¡¨åŠè§£å†³æ–¹æ³•

| å¼‚å¸¸ç±»å‹ | é”™è¯¯ä¿¡æ¯ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|---------|
| `MybatisPlusException` | `Table info has not exists` | æ‰¾ä¸åˆ°å¯¹åº”çš„è¡¨ | æ£€æŸ¥è¡¨åã€å®ä½“ç±»@TableNameæ³¨è§£ |
| `BadSqlGrammarException` | `You have an error in your SQL syntax` | SQLè¯­æ³•é”™è¯¯ | æ£€æŸ¥SQLè¯­å¥ã€å­—æ®µåã€è¡¨å |
| `BindingException` | `Parameter 'xxx' not found` | å‚æ•°ç»‘å®šé”™è¯¯ | æ£€æŸ¥@Paramæ³¨è§£ã€XMLä¸­çš„å‚æ•°å |
| `TooManyResultsException` | `Too many results` | æœŸæœ›ä¸€æ¡ç»“æœï¼Œè¿”å›å¤šæ¡ | è°ƒæ•´æŸ¥è¯¢æ¡ä»¶ä½¿ç»“æœå”¯ä¸€ |
| `DuplicateKeyException` | `Duplicate entry` | å”¯ä¸€é”®æˆ–ä¸»é”®å†²çª | æ£€æŸ¥æ’å…¥æ•°æ®çš„å”¯ä¸€æ€§ |
| `DataAccessException` | `Connection refused` | æ•°æ®åº“è¿æ¥é—®é¢˜ | æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½® |
| `QueryTimeoutException` | `Query timeout` | æŸ¥è¯¢è¶…æ—¶ | ä¼˜åŒ–SQLã€æ·»åŠ ç´¢å¼•ã€è°ƒæ•´è¶…æ—¶è®¾ç½® |

### 11.6 ç‰ˆæœ¬å‡çº§é—®é¢˜å¤„ç†

#### 11.6.1 ä»2.xå‡çº§åˆ°3.x

**ä¸»è¦å˜åŒ–**ï¼š
- ç§»é™¤äº†å®ä½“å±æ€§`ID_WORKER`å’Œ`ID_WORKER_STR`
- è°ƒæ•´äº†åˆ†é¡µæ’ä»¶é…ç½®æ–¹å¼
- ä¿®æ”¹äº†æ‰¹é‡æ“ä½œæ¥å£

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å°†IdType.ID_WORKERæ›¿æ¢ä¸ºIdType.ASSIGN_ID
2. æŒ‰æ–°æ–¹å¼é…ç½®åˆ†é¡µæ’ä»¶ï¼š
```java
@Bean
public MybatisPlusInterceptor mybatisPlusInterceptor() {
    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
    interceptor.addInnerInterceptor(new PaginationInnerInterceptor());
    return interceptor;
}
```
3. æ›´æ–°æ‰¹é‡æ“ä½œçš„è°ƒç”¨æ–¹å¼å’Œå‚æ•°

#### 11.6.2 ä»3.xæ—©æœŸç‰ˆæœ¬å‡çº§åˆ°3.5+

**ä¸»è¦å˜åŒ–**ï¼š
- æ’ä»¶ä½“ç³»æ”¹ä¸ºInnerInterceptor
- æ¡ä»¶æ„é€ å™¨APIè°ƒæ•´
- å¢å¼ºäº†Lambdaè¡¨è¾¾å¼æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ›´æ–°æ’ä»¶é…ç½®æ–¹å¼
2. æ£€æŸ¥å¹¶è°ƒæ•´æ¡ä»¶æ„é€ å™¨çš„ä½¿ç”¨æ–¹å¼
3. åˆ©ç”¨æ–°ç‰¹æ€§ä¼˜åŒ–ä»£ç 

### 11.7 é—®é¢˜æ’æŸ¥æµç¨‹

é‡åˆ°é—®é¢˜æ—¶ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹æµç¨‹æ’æŸ¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼šåˆ†æé”™è¯¯æ—¥å¿—ï¼Œå®šä½å¼‚å¸¸ä½ç½®
2. **æ£€æŸ¥é…ç½®**ï¼šéªŒè¯ç›¸å…³é…ç½®é¡¹æ˜¯å¦æ­£ç¡®
3. **æŸ¥çœ‹SQL**ï¼šä½¿ç”¨æ—¥å¿—æˆ–ç›‘æ§å·¥å…·æŸ¥çœ‹å®é™…æ‰§è¡Œçš„SQL
4. **å•å…ƒæµ‹è¯•**ï¼šç¼–å†™ç®€å•æµ‹è¯•éªŒè¯åŠŸèƒ½ç‚¹
5. **è°ƒè¯•è·Ÿè¸ª**ï¼šä½¿ç”¨æ–­ç‚¹è°ƒè¯•è·Ÿè¸ªä»£ç æ‰§è¡Œæµç¨‹
6. **ç¯å¢ƒå¯¹æ¯”**ï¼šå¦‚æœå¯èƒ½ï¼Œå¯¹æ¯”ä¸åŒç¯å¢ƒä¸‹çš„è¡Œä¸ºå·®å¼‚
7. **æŸ¥é˜…æ–‡æ¡£**ï¼šå‚è€ƒå®˜æ–¹æ–‡æ¡£å’Œæ›´æ–°æ—¥å¿—
8. **æœç´¢ç¤¾åŒº**ï¼šåœ¨GitHub Issuesã€Stack Overflowç­‰å¹³å°æœç´¢ç±»ä¼¼é—®é¢˜

### 11.8 å¸¸è§é—®é¢˜FAQ

#### Q1: ä½¿ç”¨MyBatis-Plusåï¼Œè‡ªå®šä¹‰çš„XMLæ˜ å°„æ–‡ä»¶ä¸ç”Ÿæ•ˆï¼Ÿ

A1: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- ç¡®ä¿XMLæ–‡ä»¶åœ¨`mapper-locations`é…ç½®è·¯å¾„ä¸‹
- ç¡®è®¤Mapperæ¥å£ä¸XMLçš„å‘½åç©ºé—´ä¸€è‡´
- æ£€æŸ¥æ–¹æ³•ç­¾åä¸XMLä¸­çš„IDæ˜¯å¦ä¸€è‡´
- ç¡®è®¤XMLæ–‡ä»¶å·²è¢«æ­£ç¡®æ‰“åŒ…è¿›classpath

#### Q2: å¦‚ä½•åœ¨ä¸€ä¸ªServiceä¸­ä½¿ç”¨å¤šä¸ªMapperï¼Ÿ

A2: é€šè¿‡ä¾èµ–æ³¨å…¥ä½¿ç”¨å¤šä¸ªMapperï¼š

```java
@Service
public class ComplexServiceImpl extends ServiceImpl<UserMapper, User> implements ComplexService {
    @Autowired
    private OrderMapper orderMapper;
    
    @Autowired
    private ProductMapper productMapper;
    
    public void complexOperation() {
        // ä½¿ç”¨this.baseMapperæ“ä½œUser
        List<User> users = this.baseMapper.selectList(null);
        
        // ä½¿ç”¨æ³¨å…¥çš„å…¶ä»–Mapper
        List<Order> orders = orderMapper.selectList(null);
        List<Product> products = productMapper.selectList(null);
    }
}
```

#### Q3: æ¡ä»¶æ„é€ å™¨ä¸­å¦‚ä½•å®ç°"OR"æŸ¥è¯¢ï¼Ÿ

A3: ä½¿ç”¨or()æ–¹æ³•æˆ–åµŒå¥—æŸ¥è¯¢ï¼š

```java
// æ–¹å¼1ï¼šä½¿ç”¨or()æ–¹æ³•
QueryWrapper<User> wrapper = new QueryWrapper<>();
wrapper.eq("status", 1)
       .or()
       .eq("status", 2);

// æ–¹å¼2ï¼šä½¿ç”¨åµŒå¥—æŸ¥è¯¢
wrapper.nested(w -> w.eq("status", 1).or().eq("status", 2));
```

#### Q4: å¦‚ä½•å¤„ç†å­—æ®µåä¸Javaå…³é”®å­—å†²çªï¼Ÿ

A4: ä½¿ç”¨@TableFieldæ³¨è§£æŒ‡å®šæ˜ å°„å…³ç³»ï¼š

```java
@TableField("`order`")
private String order;

@TableField("`default`")
private String default;
```

### 11.9 æ•…éšœæ’é™¤å·¥å…·æ¸…å•

1. **æ—¥å¿—å·¥å…·**ï¼šSLF4J + Logbacké…ç½®
2. **SQLç›‘æ§**ï¼šP6Spyã€PerformanceInterceptor
3. **æ•°æ®åº“åˆ†æ**ï¼šMySQL Explainã€æ‰§è¡Œè®¡åˆ’åˆ†æ
4. **æ€§èƒ½åˆ†æ**ï¼šJProfilerã€Arthasã€VisualVM
5. **æµ‹è¯•å·¥å…·**ï¼šJUnitã€Mockitoã€Spring Test

é€šè¿‡æœ¬èŠ‚çš„æŒ‡å—ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ›´å¿«åœ°å®šä½å’Œè§£å†³MyBatis-Plusä½¿ç”¨è¿‡ç¨‹ä¸­çš„å¸¸è§é—®é¢˜ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚