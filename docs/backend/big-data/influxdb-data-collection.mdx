---
sidebar_position: 6
title: InfluxDBæ•°æ®é‡‡é›†è¯¦è§£
description: æ·±å…¥ç†è§£InfluxDBæ—¶åºæ•°æ®åº“ã€æ•°æ®é‡‡é›†æ–¹æ³•ã€æ€§èƒ½ä¼˜åŒ–å’Œæœ€ä½³å®è·µ
authors: [Laby]
last_update:
  date: 2025-08-16
  author: Laby
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import TOCInline from '@theme/TOCInline';

# InfluxDBæ•°æ®é‡‡é›†è¯¦è§£

InfluxDBæ˜¯ä¸€ä¸ªä¸“ä¸ºæ—¶é—´åºåˆ—æ•°æ®è®¾è®¡çš„é«˜æ€§èƒ½æ•°æ®åº“ï¼Œå¹¿æ³›åº”ç”¨äºç›‘æ§ç³»ç»Ÿã€IoTè®¾å¤‡ã€å®æ—¶åˆ†æç­‰åœºæ™¯ã€‚å®ƒæä¾›äº†é«˜æ•ˆçš„æ•°æ®å†™å…¥ã€æŸ¥è¯¢å’Œèšåˆèƒ½åŠ›ï¼Œæ˜¯æ„å»ºå®æ—¶æ•°æ®é‡‡é›†ç³»ç»Ÿçš„ç†æƒ³é€‰æ‹©ã€‚

:::info æœ¬æ–‡å†…å®¹æ¦‚è§ˆ
<TOCInline toc={toc} />
:::

:::tip æ ¸å¿ƒä»·å€¼
**InfluxDBæ•°æ®é‡‡é›† = é«˜æ€§èƒ½æ—¶åºå­˜å‚¨ + å®æ—¶æ•°æ®å†™å…¥ + çµæ´»æŸ¥è¯¢è¯­è¨€ + æ•°æ®å‹ç¼©ä¼˜åŒ– + é›†ç¾¤æ‰©å±•èƒ½åŠ›**
- ğŸš€ **é«˜æ€§èƒ½æ—¶åºå­˜å‚¨**ï¼šä¸“ä¸ºæ—¶é—´åºåˆ—æ•°æ®ä¼˜åŒ–çš„å­˜å‚¨å¼•æ“
- ğŸ‘¨â€ğŸ’» **å®æ—¶æ•°æ®å†™å…¥**ï¼šæ”¯æŒé«˜ååé‡çš„æ•°æ®å†™å…¥æ“ä½œ
- ğŸ” **çµæ´»æŸ¥è¯¢è¯­è¨€**ï¼šInfluxQLå’ŒFluxæŸ¥è¯¢è¯­è¨€æ”¯æŒå¤æ‚æŸ¥è¯¢
- ğŸ”— **æ•°æ®å‹ç¼©ä¼˜åŒ–**ï¼šè‡ªåŠ¨æ•°æ®å‹ç¼©ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- ğŸ“š **é›†ç¾¤æ‰©å±•èƒ½åŠ›**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œæ»¡è¶³å¤§è§„æ¨¡æ•°æ®éœ€æ±‚
:::

## 1. InfluxDBåŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯InfluxDBï¼Ÿ

InfluxDBæ˜¯ä¸€ä¸ªå¼€æºçš„æ—¶åºæ•°æ®åº“ï¼Œä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

```mermaid
graph TD
    A[InfluxDBç‰¹ç‚¹] --> B[æ—¶åºä¼˜åŒ–]
    A --> C[é«˜æ€§èƒ½]
    A --> D[æ˜“æ‰©å±•]
    A --> E[SQLå…¼å®¹]
    
    B --> B1["æ—¶é—´ç´¢å¼•ä¼˜åŒ–"]
    B --> B2["è‡ªåŠ¨æ•°æ®å‹ç¼©"]
    
    C --> C1["é«˜å†™å…¥ååé‡"]
    C --> C2["å¿«é€ŸæŸ¥è¯¢å“åº”"]
    
    D --> D1["æ°´å¹³æ‰©å±•"]
    D --> D2["é›†ç¾¤éƒ¨ç½²"]
    
    E --> E1["InfluxQLè¯­æ³•"]
    E --> E2["FluxæŸ¥è¯¢è¯­è¨€"]
```

#### InfluxDBæ ¸å¿ƒæ¦‚å¿µ
```java title="InfluxDBæ ¸å¿ƒæ¦‚å¿µç¤ºä¾‹"
public class InfluxDBConcepts {
    public static void main(String[] args) {
        // 1. Database - æ•°æ®åº“
        System.out.println("Database: å­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®çš„å®¹å™¨");
        
        // 2. Measurement - æµ‹é‡å€¼ï¼ˆç±»ä¼¼å…³ç³»æ•°æ®åº“çš„è¡¨ï¼‰
        System.out.println("Measurement: å­˜å‚¨ç›¸å…³æ—¶é—´åºåˆ—æ•°æ®çš„é›†åˆ");
        
        // 3. Tag - æ ‡ç­¾ï¼ˆç´¢å¼•å­—æ®µï¼‰
        System.out.println("Tag: ç”¨äºæŸ¥è¯¢å’Œåˆ†ç»„çš„å…ƒæ•°æ®å­—æ®µ");
        
        // 4. Field - å­—æ®µï¼ˆå®é™…æ•°æ®å€¼ï¼‰
        System.out.println("Field: å­˜å‚¨å®é™…æµ‹é‡å€¼çš„å­—æ®µ");
        
        // 5. Timestamp - æ—¶é—´æˆ³
        System.out.println("Timestamp: æ•°æ®ç‚¹çš„æ—¶é—´æ ‡è¯†");
        
        // 6. Retention Policy - ä¿ç•™ç­–ç•¥
        System.out.println("Retention Policy: æ•°æ®ä¿ç•™æ—¶é—´å’Œåˆ†ç‰‡ç­–ç•¥");
    }
}
```

### 1.2 æ•°æ®æ¨¡å‹

InfluxDBçš„æ•°æ®æ¨¡å‹ä¸ä¼ ç»Ÿå…³ç³»æ•°æ®åº“ä¸åŒï¼š

| æ¦‚å¿µ | å…³ç³»æ•°æ®åº“ | InfluxDB |
|------|------------|----------|
| **æ•°æ®åº“** | Database | Database |
| **è¡¨** | Table | Measurement |
| **è¡Œ** | Row | Point |
| **åˆ—** | Column | Tag/Field |
| **ä¸»é”®** | Primary Key | Timestamp + Tag Set |

#### æ•°æ®ç‚¹ç»“æ„ç¤ºä¾‹
```java title="æ•°æ®ç‚¹ç»“æ„ç¤ºä¾‹"
public class DataPointStructure {
    // InfluxDBæ•°æ®ç‚¹ç»“æ„
    public static class DataPoint {
        private String measurement;        // æµ‹é‡å€¼åç§°
        private Map<String, String> tags; // æ ‡ç­¾é›†åˆ
        private Map<String, Object> fields; // å­—æ®µé›†åˆ
        private long timestamp;            // æ—¶é—´æˆ³
        
        // ç¤ºä¾‹ï¼šCPUä½¿ç”¨ç‡æ•°æ®ç‚¹
        public static DataPoint createCPUUsagePoint() {
            DataPoint point = new DataPoint();
            point.measurement = "cpu_usage";
            
            // æ ‡ç­¾ï¼šç”¨äºæŸ¥è¯¢å’Œåˆ†ç»„
            point.tags = new HashMap<>();
            point.tags.put("host", "server-01");
            point.tags.put("region", "us-west");
            point.tags.put("cpu_core", "0");
            
            // å­—æ®µï¼šå®é™…æµ‹é‡å€¼
            point.fields = new HashMap<>();
            point.fields.put("usage_percent", 75.5);
            point.fields.put("temperature", 45.2);
            
            // æ—¶é—´æˆ³
            point.timestamp = System.currentTimeMillis();
            
            return point;
        }
    }
}
```

## 2. InfluxDBå®‰è£…å’Œé…ç½®

### 2.1 å®‰è£…æ–¹æ³•

<Tabs>
  <TabItem value="docker" label="Dockerå®‰è£…" default>
  ```bash
  # ä½¿ç”¨Dockerå®‰è£…InfluxDB
  docker run -d \
    --name influxdb \
    -p 8086:8086 \
    -v influxdb-data:/var/lib/influxdb2 \
    -v influxdb-config:/etc/influxdb2 \
    -e DOCKER_INFLUXDB_INIT_MODE=setup \
    -e DOCKER_INFLUXDB_INIT_USERNAME=admin \
    -e DOCKER_INFLUXDB_INIT_PASSWORD=password123 \
    -e DOCKER_INFLUXDB_INIT_ORG=myorg \
    -e DOCKER_INFLUXDB_INIT_BUCKET=mybucket \
    influxdb:2.7
  ```
  </TabItem>
  <TabItem value="package" label="åŒ…ç®¡ç†å™¨å®‰è£…">
  ```bash
  # Ubuntu/Debian
  wget https://dl.influxdata.com/influxdb/releases/influxdb2-2.7.1-amd64.deb
  sudo dpkg -i influxdb2-2.7.1-amd64.deb
  
  # CentOS/RHEL
  wget https://dl.influxdata.com/influxdb/releases/influxdb2-2.7.1.x86_64.rpm
  sudo yum localinstall influxdb2-2.7.1.x86_64.rpm
  ```
  </TabItem>
  <TabItem value="binary" label="äºŒè¿›åˆ¶å®‰è£…">
  ```bash
  # ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
  wget https://dl.influxdata.com/influxdb/releases/influxdb2-2.7.1-linux-amd64.tar.gz
  tar xvfz influxdb2-2.7.1-linux-amd64.tar.gz
  cd influxdb2-2.7.1-linux-amd64
  
  # å¯åŠ¨æœåŠ¡
  ./influxd
  ```
  </TabItem>
</Tabs>

### 2.2 é…ç½®æ–‡ä»¶

InfluxDBçš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼š

```yaml title="influxdb.ymlé…ç½®ç¤ºä¾‹"
# InfluxDBé…ç½®æ–‡ä»¶
api:
  bind-address: ":8086"
  auth-enabled: true

meta:
  dir: "/var/lib/influxdb2/meta"
  bind-address: ":8089"

data:
  dir: "/var/lib/influxdb2/data"
  wal-dir: "/var/lib/influxdb2/wal"
  series-id-set-cache-size: 100

http:
  bind-address: ":8086"
  auth-enabled: true
  log-enabled: true
  write-tracing: false
  pprof-enabled: false

logging:
  level: "info"
  format: "auto"
```

## 3. æ•°æ®é‡‡é›†æ–¹æ³•

### 3.1 HTTP APIå†™å…¥

InfluxDBæä¾›äº†RESTful HTTP APIç”¨äºæ•°æ®å†™å…¥ï¼š

```java title="HTTP APIæ•°æ®å†™å…¥ç¤ºä¾‹"
public class InfluxDBHTTPWriter {
    private final String url;
    private final String token;
    private final String org;
    private final String bucket;
    
    public InfluxDBHTTPWriter(String url, String token, String org, String bucket) {
        this.url = url;
        this.token = token;
        this.org = org;
        this.bucket = bucket;
    }
    
    public void writeDataPoint(DataPoint point) throws IOException {
        // æ„å»ºLine Protocolæ ¼å¼çš„æ•°æ®
        String lineProtocol = buildLineProtocol(point);
        
        // å‘é€HTTP POSTè¯·æ±‚
        URL writeUrl = new URL(url + "/api/v2/write?org=" + org + "&bucket=" + bucket);
        HttpURLConnection connection = (HttpURLConnection) writeUrl.openConnection();
        connection.setRequestMethod("POST");
        connection.setRequestProperty("Authorization", "Token " + token);
        connection.setRequestProperty("Content-Type", "text/plain; charset=utf-8");
        connection.setDoOutput(true);
        
        try (OutputStreamWriter writer = new OutputStreamWriter(connection.getOutputStream())) {
            writer.write(lineProtocol);
        }
        
        int responseCode = connection.getResponseCode();
        if (responseCode != 204) {
            throw new IOException("Write failed with response code: " + responseCode);
        }
    }
    
    private String buildLineProtocol(DataPoint point) {
        StringBuilder sb = new StringBuilder();
        
        // æµ‹é‡å€¼åç§°
        sb.append(point.measurement);
        
        // æ ‡ç­¾
        if (point.tags != null && !point.tags.isEmpty()) {
            for (Map.Entry<String, String> tag : point.tags.entrySet()) {
                sb.append(",").append(tag.getKey()).append("=").append(tag.getValue());
            }
        }
        
        // å­—æ®µ
        sb.append(" ");
        boolean first = true;
        for (Map.Entry<String, Object> field : point.fields.entrySet()) {
            if (!first) sb.append(",");
            sb.append(field.getKey()).append("=");
            
            Object value = field.getValue();
            if (value instanceof String) {
                sb.append("\"").append(value).append("\"");
            } else {
                sb.append(value);
            }
            first = false;
        }
        
        // æ—¶é—´æˆ³ï¼ˆçº³ç§’ï¼‰
        sb.append(" ").append(point.timestamp * 1_000_000);
        
        return sb.toString();
    }
}
```

### 3.2 å®¢æˆ·ç«¯åº“å†™å…¥

ä½¿ç”¨å®˜æ–¹Javaå®¢æˆ·ç«¯åº“ï¼š

```java title="Javaå®¢æˆ·ç«¯å†™å…¥ç¤ºä¾‹"
public class InfluxDBClientWriter {
    private final InfluxDBClient client;
    private final WriteApi writeApi;
    
    public InfluxDBClientWriter(String url, String token, String org, String bucket) {
        this.client = InfluxDBClientFactory.create(url, token.toCharArray(), org, bucket);
        this.writeApi = client.getWriteApi();
    }
    
    public void writeDataPoint(DataPoint point) {
        Point influxPoint = Point.measurement(point.measurement)
            .addTags(point.tags)
            .addFields(point.fields)
            .time(point.timestamp, WritePrecision.MS);
        
        writeApi.writePoint(influxPoint);
    }
    
    public void writeBatch(List<DataPoint> points) {
        List<Point> influxPoints = points.stream()
            .map(point -> Point.measurement(point.measurement)
                .addTags(point.tags)
                .addFields(point.fields)
                .time(point.timestamp, WritePrecision.MS))
            .collect(Collectors.toList());
        
        writeApi.writePoints(influxPoints);
    }
    
    public void close() {
        writeApi.close();
        client.close();
    }
}
```

### 3.3 æ‰¹é‡å†™å…¥ä¼˜åŒ–

å¯¹äºé«˜ååé‡åœºæ™¯ï¼Œæ‰¹é‡å†™å…¥æ˜¯å¿…è¦çš„ï¼š

```java title="æ‰¹é‡å†™å…¥ä¼˜åŒ–ç¤ºä¾‹"
public class BatchWriter {
    private final InfluxDBClient client;
    private final WriteApi writeApi;
    private final int batchSize;
    private final long flushInterval;
    
    private final List<Point> buffer = new ArrayList<>();
    private final ScheduledExecutorService scheduler;
    
    public BatchWriter(String url, String token, String org, String bucket, 
                      int batchSize, long flushInterval) {
        this.client = InfluxDBClientFactory.create(url, token.toCharArray(), org, bucket);
        this.writeApi = client.getWriteApi();
        this.batchSize = batchSize;
        this.flushInterval = flushInterval;
        
        // è®¾ç½®æ‰¹é‡å†™å…¥é€‰é¡¹
        writeApi.setWriteOptions(WriteOptions.builder()
            .batchSize(batchSize)
            .flushDuration(flushInterval)
            .jitterDuration(1000)
            .retryBufferLimit(50000)
            .maxRetries(5)
            .maxRetryDelay(30000)
            .exponentialBase(2)
            .build());
        
        // å¯åŠ¨å®šæ—¶åˆ·æ–°ä»»åŠ¡
        this.scheduler = Executors.newScheduledThreadPool(1);
        this.scheduler.scheduleAtFixedRate(this::flush, flushInterval, flushInterval, TimeUnit.MILLISECONDS);
    }
    
    public void writePoint(Point point) {
        synchronized (buffer) {
            buffer.add(point);
            if (buffer.size() >= batchSize) {
                flush();
            }
        }
    }
    
    private void flush() {
        synchronized (buffer) {
            if (!buffer.isEmpty()) {
                writeApi.writePoints(buffer);
                buffer.clear();
            }
        }
    }
    
    public void close() {
        flush();
        scheduler.shutdown();
        writeApi.close();
        client.close();
    }
}
```

## 4. æ•°æ®é‡‡é›†æœ€ä½³å®è·µ

### 4.1 æ•°æ®æ¨¡å‹è®¾è®¡

<div className="card">
<div className="card__header">
<h4>æ—¶åºæ•°æ®æ¨¡å‹è®¾è®¡åŸåˆ™</h4>
</div>
<div className="card__body">
<ol>
<li><strong>åˆç†ä½¿ç”¨æ ‡ç­¾</strong>ï¼šæ ‡ç­¾ç”¨äºæŸ¥è¯¢å’Œåˆ†ç»„ï¼Œå­—æ®µç”¨äºå­˜å‚¨å®é™…å€¼</li>
<li><strong>é¿å…é«˜åŸºæ•°æ ‡ç­¾</strong>ï¼šé«˜åŸºæ•°æ ‡ç­¾ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜</li>
<li><strong>æ—¶é—´ç²¾åº¦é€‰æ‹©</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ—¶é—´ç²¾åº¦</li>
<li><strong>æ•°æ®å‹ç¼©</strong>ï¼šåˆ©ç”¨InfluxDBçš„è‡ªåŠ¨å‹ç¼©åŠŸèƒ½</li>
</ol>
</div>
</div>

#### å¥½çš„æ•°æ®æ¨¡å‹ç¤ºä¾‹
```java title="å¥½çš„æ•°æ®æ¨¡å‹ç¤ºä¾‹"
public class GoodDataModel {
    // å¥½çš„æ•°æ®æ¨¡å‹ï¼šCPUç›‘æ§æ•°æ®
    public static class CPUMeasurement {
        // æµ‹é‡å€¼åç§°
        public static final String MEASUREMENT = "cpu_metrics";
        
        // æ ‡ç­¾ï¼šç”¨äºæŸ¥è¯¢å’Œåˆ†ç»„
        public static final Map<String, String> TAGS = Map.of(
            "host", "server-01",
            "datacenter", "dc-west",
            "environment", "production"
        );
        
        // å­—æ®µï¼šå®é™…æµ‹é‡å€¼
        public static final Map<String, Object> FIELDS = Map.of(
            "cpu_usage", 75.5,
            "cpu_temperature", 45.2,
            "cpu_frequency", 2400.0
        );
    }
    
    // é¿å…çš„é«˜åŸºæ•°æ ‡ç­¾ç¤ºä¾‹
    public static class BadDataModel {
        // é”™è¯¯ï¼šä½¿ç”¨é«˜åŸºæ•°æ ‡ç­¾
        public static final Map<String, String> HIGH_CARDINALITY_TAGS = Map.of(
            "user_id", "12345",        // é«˜åŸºæ•°ï¼šç”¨æˆ·ID
            "session_id", "abc123",    // é«˜åŸºæ•°ï¼šä¼šè¯ID
            "request_id", "req-456"    // é«˜åŸºæ•°ï¼šè¯·æ±‚ID
        );
    }
}
```

### 4.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

<Tabs>
  <TabItem value="influxdb-batch" label="æ‰¹é‡å†™å…¥" default>
  ```java
  // æ‰¹é‡å†™å…¥ä¼˜åŒ–
  public class PerformanceOptimization {
      public void optimizeBatchWriting() {
          // 1. è®¾ç½®åˆé€‚çš„æ‰¹é‡å¤§å°
          int batchSize = 1000;
          
          // 2. è®¾ç½®åˆ·æ–°é—´éš”
          long flushInterval = 1000; // 1ç§’
          
          // 3. ä½¿ç”¨å¼‚æ­¥å†™å…¥
          WriteApi writeApi = client.getWriteApi();
          writeApi.setWriteOptions(WriteOptions.builder()
              .batchSize(batchSize)
              .flushDuration(flushInterval)
              .build());
      }
  }
  ```
  </TabItem>
  <TabItem value="compression" label="æ•°æ®å‹ç¼©">
  ```java
  // æ•°æ®å‹ç¼©ä¼˜åŒ–
  public class CompressionOptimization {
      public void optimizeCompression() {
          // 1. ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹
          Map<String, Object> fields = new HashMap<>();
          fields.put("cpu_usage", 75.5);      // æµ®ç‚¹æ•°
          fields.put("status", 1);            // æ•´æ•°è€Œä¸æ˜¯å­—ç¬¦ä¸²
          fields.put("is_active", true);      // å¸ƒå°”å€¼
          
          // 2. é¿å…å­˜å‚¨é‡å¤æ•°æ®
          // é”™è¯¯ï¼šå­˜å‚¨é‡å¤çš„æ—¶é—´æˆ³
          // æ­£ç¡®ï¼šä½¿ç”¨ç›¸å¯¹æ—¶é—´æˆ–æ—¶é—´åç§»
      }
  }
  ```
  </TabItem>
  <TabItem value="indexing" label="ç´¢å¼•ä¼˜åŒ–">
  ```java
  // ç´¢å¼•ä¼˜åŒ–
  public class IndexOptimization {
      public void optimizeIndexing() {
          // 1. åˆç†ä½¿ç”¨æ ‡ç­¾
          Map<String, String> tags = new HashMap<>();
          tags.put("host", "server-01");      // ä½åŸºæ•°æ ‡ç­¾
          tags.put("service", "web");         // ä½åŸºæ•°æ ‡ç­¾
          tags.put("version", "v1.0");       // ä½åŸºæ•°æ ‡ç­¾
          
          // 2. é¿å…é«˜åŸºæ•°æ ‡ç­¾
          // é”™è¯¯ï¼šä½¿ç”¨ç”¨æˆ·IDä½œä¸ºæ ‡ç­¾
          // tags.put("user_id", "12345");
          
          // 3. ä½¿ç”¨å­—æ®µå­˜å‚¨é«˜åŸºæ•°æ•°æ®
          Map<String, Object> fields = new HashMap<>();
          fields.put("user_id", "12345");    // ä½œä¸ºå­—æ®µå­˜å‚¨
      }
  }
  ```
  </TabItem>
</Tabs>

## 5. æ•°æ®é‡‡é›†åº”ç”¨åœºæ™¯

### 5.1 ç³»ç»Ÿç›‘æ§

```java title="ç³»ç»Ÿç›‘æ§æ•°æ®é‡‡é›†ç¤ºä¾‹"
public class SystemMonitoring {
    public void collectSystemMetrics() {
        // 1. CPUç›‘æ§
        collectCPUMetrics();
        
        // 2. å†…å­˜ç›‘æ§
        collectMemoryMetrics();
        
        // 3. ç£ç›˜ç›‘æ§
        collectDiskMetrics();
        
        // 4. ç½‘ç»œç›‘æ§
        collectNetworkMetrics();
    }
    
    private void collectCPUMetrics() {
        OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();
        if (osBean instanceof com.sun.management.OperatingSystemMXBean) {
            com.sun.management.OperatingSystemMXBean sunOsBean = 
                (com.sun.management.OperatingSystemMXBean) osBean;
            
            double cpuLoad = sunOsBean.getCpuLoad();
            double cpuUsage = cpuLoad * 100;
            
            Point cpuPoint = Point.measurement("system_cpu")
                .addTag("host", getHostname())
                .addTag("metric", "usage_percent")
                .addField("value", cpuUsage)
                .time(System.currentTimeMillis(), WritePrecision.MS);
            
            writePoint(cpuPoint);
        }
    }
    
    private void collectMemoryMetrics() {
        MemoryMXBean memoryBean = ManagementFactory.getMemoryMXBean();
        MemoryUsage heapUsage = memoryBean.getHeapMemoryUsage();
        
        long usedMemory = heapUsage.getUsed();
        long maxMemory = heapUsage.getMax();
        double memoryUsage = (double) usedMemory / maxMemory * 100;
        
        Point memoryPoint = Point.measurement("system_memory")
            .addTag("host", getHostname())
            .addTag("type", "heap")
            .addField("used_bytes", usedMemory)
            .addField("max_bytes", maxMemory)
            .addField("usage_percent", memoryUsage)
            .time(System.currentTimeMillis(), WritePrecision.MS);
        
        writePoint(memoryPoint);
    }
    
    private String getHostname() {
        try {
            return InetAddress.getLocalHost().getHostName();
        } catch (UnknownHostException e) {
            return "unknown";
        }
    }
}
```

### 5.2 IoTè®¾å¤‡æ•°æ®é‡‡é›†

```java title="IoTè®¾å¤‡æ•°æ®é‡‡é›†ç¤ºä¾‹"
public class IoTDataCollection {
    public void collectSensorData() {
        // 1. æ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ®
        collectTemperatureData();
        
        // 2. æ¹¿åº¦ä¼ æ„Ÿå™¨æ•°æ®
        collectHumidityData();
        
        // 3. å‹åŠ›ä¼ æ„Ÿå™¨æ•°æ®
        collectPressureData();
        
        // 4. ä½ç½®æ•°æ®
        collectLocationData();
    }
    
    private void collectTemperatureData() {
        // æ¨¡æ‹Ÿæ¸©åº¦ä¼ æ„Ÿå™¨æ•°æ®
        double temperature = 20.0 + Math.random() * 10.0;
        double humidity = 40.0 + Math.random() * 20.0;
        
        Point tempPoint = Point.measurement("sensor_data")
            .addTag("device_id", "temp_sensor_001")
            .addTag("sensor_type", "temperature")
            .addTag("location", "room_101")
            .addField("temperature_c", temperature)
            .addField("humidity_percent", humidity)
            .addField("battery_level", 85.0)
            .time(System.currentTimeMillis(), WritePrecision.MS);
        
        writePoint(tempPoint);
    }
    
    private void collectLocationData() {
        // æ¨¡æ‹ŸGPSä½ç½®æ•°æ®
        double latitude = 37.7749 + (Math.random() - 0.5) * 0.01;
        double longitude = -122.4194 + (Math.random() - 0.5) * 0.01;
        double altitude = 100.0 + Math.random() * 50.0;
        
        Point locationPoint = Point.measurement("gps_data")
            .addTag("device_id", "gps_tracker_001")
            .addTag("vehicle_type", "delivery_truck")
            .addField("latitude", latitude)
            .addField("longitude", longitude)
            .addField("altitude_m", altitude)
            .addField("speed_kmh", 35.0 + Math.random() * 20.0)
            .time(System.currentTimeMillis(), WritePrecision.MS);
        
        writePoint(locationPoint);
    }
}
```

## 6. æ•°æ®æŸ¥è¯¢å’Œåˆ†æ

### 6.1 åŸºæœ¬æŸ¥è¯¢

```java title="åŸºæœ¬æŸ¥è¯¢ç¤ºä¾‹"
public class InfluxDBQueries {
    private final InfluxDBClient client;
    private final QueryApi queryApi;
    
    public InfluxDBQueries(String url, String token, String org) {
        this.client = InfluxDBClientFactory.create(url, token.toCharArray(), org);
        this.queryApi = client.getQueryApi();
    }
    
    // æŸ¥è¯¢æœ€è¿‘1å°æ—¶çš„CPUä½¿ç”¨ç‡
    public List<FluxTable> queryRecentCPUUsage() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -1h)
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r._field == "value")
                |> aggregateWindow(every: 1m, fn: mean)
                |> yield(name: "mean")
            """;
        
        return queryApi.query(flux);
    }
    
    // æŸ¥è¯¢ç‰¹å®šä¸»æœºçš„å†…å­˜ä½¿ç”¨æƒ…å†µ
    public List<FluxTable> queryHostMemoryUsage(String hostname, Duration duration) {
        String flux = String.format("""
            from(bucket: "system_metrics")
                |> range(start: -%ds)
                |> filter(fn: (r) => r._measurement == "system_memory")
                |> filter(fn: (r) => r.host == "%s")
                |> filter(fn: (r) => r._field == "usage_percent")
                |> aggregateWindow(every: 5m, fn: mean)
                |> yield(name: "mean")
            """, duration.getSeconds(), hostname);
        
        return queryApi.query(flux);
    }
    
    // èšåˆæŸ¥è¯¢ï¼šè®¡ç®—æ¯å°æ—¶çš„å¹³å‡å€¼
    public List<FluxTable> queryHourlyAggregation() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -24h)
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r._field == "value")
                |> aggregateWindow(every: 1h, fn: mean)
                |> yield(name: "hourly_mean")
            """;
        
        return queryApi.query(flux);
    }
}
```

### 6.2 é«˜çº§æŸ¥è¯¢å’Œåˆ†æ

```java title="é«˜çº§æŸ¥è¯¢ç¤ºä¾‹"
public class AdvancedQueries {
    private final QueryApi queryApi;
    
    public AdvancedQueries(QueryApi queryApi) {
        this.queryApi = queryApi;
    }
    
    // å¼‚å¸¸æ£€æµ‹ï¼šæ£€æµ‹CPUä½¿ç”¨ç‡å¼‚å¸¸
    public List<FluxTable> detectCPUAnomalies() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -1h)
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r._field == "value")
                |> aggregateWindow(every: 1m, fn: mean)
                |> map(fn: (r) => ({
                    _value: r._value,
                    anomaly: if r._value > 90.0 then "high" else "normal"
                }))
                |> filter(fn: (r) => r.anomaly == "high")
            """;
        
        return queryApi.query(flux);
    }
    
    // è¶‹åŠ¿åˆ†æï¼šè®¡ç®—CPUä½¿ç”¨ç‡è¶‹åŠ¿
    public List<FluxTable> analyzeCPUTrend() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -7d)
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r._field == "value")
                |> aggregateWindow(every: 1h, fn: mean)
                |> linearRegression(predict: 24h)
            """;
        
        return queryApi.query(flux);
    }
    
    // å¤šç»´åº¦åˆ†æï¼šæŒ‰ä¸»æœºå’ŒæœåŠ¡åˆ†ç»„
    public List<FluxTable> multiDimensionalAnalysis() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -1h)
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r._field == "value")
                |> group(columns: ["host", "service"])
                |> aggregateWindow(every: 5m, fn: mean)
                |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
            """;
        
        return queryApi.query(flux);
    }
}
```

## 7. ç›‘æ§å’Œå‘Šè­¦

### 7.1 æ•°æ®è´¨é‡ç›‘æ§

```java title="æ•°æ®è´¨é‡ç›‘æ§ç¤ºä¾‹"
public class DataQualityMonitoring {
    private final InfluxDBClient client;
    private final WriteApi writeApi;
    
    public DataQualityMonitoring(String url, String token, String org, String bucket) {
        this.client = InfluxDBClientFactory.create(url, token.toCharArray(), org, bucket);
        this.writeApi = client.getWriteApi();
    }
    
    // ç›‘æ§æ•°æ®é‡‡é›†å»¶è¿Ÿ
    public void monitorDataLatency(String measurement, long expectedInterval) {
        long currentTime = System.currentTimeMillis();
        long lastDataTime = getLastDataTime(measurement);
        long latency = currentTime - lastDataTime;
        
        // å¦‚æœå»¶è¿Ÿè¶…è¿‡é¢„æœŸï¼Œè®°å½•å‘Šè­¦
        if (latency > expectedInterval * 2) {
            Point alertPoint = Point.measurement("data_quality_alerts")
                .addTag("alert_type", "data_latency")
                .addTag("measurement", measurement)
                .addTag("severity", "warning")
                .addField("expected_interval_ms", expectedInterval)
                .addField("actual_latency_ms", latency)
                .addField("message", "Data collection delayed")
                .time(currentTime, WritePrecision.MS);
            
            writeApi.writePoint(alertPoint);
        }
    }
    
    // ç›‘æ§æ•°æ®å®Œæ•´æ€§
    public void monitorDataCompleteness(String measurement, int expectedCount, Duration window) {
        int actualCount = getDataCount(measurement, window);
        double completeness = (double) actualCount / expectedCount * 100;
        
        if (completeness < 90.0) {
            Point alertPoint = Point.measurement("data_quality_alerts")
                .addTag("alert_type", "data_completeness")
                .addTag("measurement", measurement)
                .addTag("severity", "error")
                .addField("expected_count", expectedCount)
                .addField("actual_count", actualCount)
                .addField("completeness_percent", completeness)
                .addField("message", "Data completeness below threshold")
                .time(System.currentTimeMillis(), WritePrecision.MS);
            
            writeApi.writePoint(alertPoint);
        }
    }
    
    private long getLastDataTime(String measurement) {
        // å®ç°è·å–æœ€åæ•°æ®æ—¶é—´çš„é€»è¾‘
        return System.currentTimeMillis() - 60000; // æ¨¡æ‹Ÿæ•°æ®
    }
    
    private int getDataCount(String measurement, Duration window) {
        // å®ç°è·å–æ•°æ®è®¡æ•°çš„é€»è¾‘
        return 85; // æ¨¡æ‹Ÿæ•°æ®
    }
}
```

### 7.2 å‘Šè­¦è§„åˆ™é…ç½®

```yaml title="å‘Šè­¦è§„åˆ™é…ç½®ç¤ºä¾‹"
# InfluxDBå‘Šè­¦è§„åˆ™é…ç½®
alerts:
  - name: "High CPU Usage"
    query: |
      from(bucket: "system_metrics")
        |> range(start: -5m)
        |> filter(fn: (r) => r._measurement == "system_cpu")
        |> filter(fn: (r) => r._field == "value")
        |> aggregateWindow(every: 1m, fn: mean)
        |> filter(fn: (r) => r._value > 90.0)
    condition: "count() > 0"
    message: "CPU usage is above 90% for the last 5 minutes"
    severity: "warning"
    
  - name: "Data Collection Failure"
    query: |
      from(bucket: "system_metrics")
        |> range(start: -10m)
        |> filter(fn: (r) => r._measurement == "data_quality_alerts")
        |> filter(fn: (r) => r.alert_type == "data_latency")
        |> filter(fn: (r) => r.severity == "error")
    condition: "count() > 0"
    message: "Data collection has failed or is severely delayed"
    severity: "critical"
```

## 8. æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜

### 8.1 å†™å…¥æ€§èƒ½ä¼˜åŒ–

<div className="card">
<div className="card__body">
<h5>å†™å…¥æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h5>
<ol>
<li><strong>æ‰¹é‡å†™å…¥</strong>ï¼šä½¿ç”¨åˆé€‚çš„æ‰¹é‡å¤§å°ï¼Œé€šå¸¸1000-5000ä¸ªç‚¹</li>
<li><strong>å¼‚æ­¥å†™å…¥</strong>ï¼šä½¿ç”¨å¼‚æ­¥å†™å…¥APIï¼Œé¿å…é˜»å¡</li>
<li><strong>è¿æ¥æ± </strong>ï¼šå¤ç”¨HTTPè¿æ¥ï¼Œå‡å°‘è¿æ¥å»ºç«‹å¼€é”€</li>
<li><strong>æ•°æ®å‹ç¼©</strong>ï¼šå¯ç”¨gzipå‹ç¼©ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“</li>
<li><strong>å¹¶è¡Œå†™å…¥</strong>ï¼šä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œå†™å…¥æ•°æ®</li>
</ol>
</div>
</div>

### 8.2 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

```java title="æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹"
public class QueryPerformanceOptimization {
    private final QueryApi queryApi;
    
    public QueryPerformanceOptimization(QueryApi queryApi) {
        this.queryApi = queryApi;
    }
    
    // ä¼˜åŒ–æŸ¥è¯¢ï¼šä½¿ç”¨æ—¶é—´èŒƒå›´é™åˆ¶
    public List<FluxTable> optimizedTimeRangeQuery() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -1h)  // é™åˆ¶æ—¶é—´èŒƒå›´
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r.host == "server-01")  // å…ˆè¿‡æ»¤æ ‡ç­¾
                |> filter(fn: (r) => r._field == "value")
                |> aggregateWindow(every: 5m, fn: mean)  // èšåˆå‡å°‘æ•°æ®é‡
                |> yield(name: "optimized_result")
            """;
        
        return queryApi.query(flux);
    }
    
    // ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
    public List<FluxTable> indexedQuery() {
        String flux = """
            from(bucket: "system_metrics")
                |> range(start: -1h)
                |> filter(fn: (r) => r._measurement == "system_cpu")
                |> filter(fn: (r) => r.host == "server-01")  // ä½¿ç”¨ç´¢å¼•æ ‡ç­¾
                |> filter(fn: (r) => r.service == "web")     // ä½¿ç”¨ç´¢å¼•æ ‡ç­¾
                |> filter(fn: (r) => r._field == "value")
                |> yield(name: "indexed_result")
            """;
        
        return queryApi.query(flux);
    }
}
```

## 9. é›†ç¾¤éƒ¨ç½²å’Œé«˜å¯ç”¨

### 9.1 é›†ç¾¤æ¶æ„

```mermaid
graph TB
    A[è´Ÿè½½å‡è¡¡å™¨] --> B[InfluxDBèŠ‚ç‚¹1]
    A --> C[InfluxDBèŠ‚ç‚¹2]
    A --> D[InfluxDBèŠ‚ç‚¹3]
    
    B --> E[å…ƒæ•°æ®å­˜å‚¨]
    C --> E
    D --> E
    
    B --> F[æ•°æ®å­˜å‚¨]
    C --> F
    D --> F
    
    G[ç›‘æ§ç³»ç»Ÿ] --> H[Prometheus]
    G --> I[Grafana]
```

### 9.2 é«˜å¯ç”¨é…ç½®

```yaml title="é«˜å¯ç”¨é…ç½®ç¤ºä¾‹"
# InfluxDBé›†ç¾¤é…ç½®
meta:
  dir: "/var/lib/influxdb2/meta"
  bind-address: ":8089"
  http-bind-address: ":8091"
  auth-enabled: true
  auth-secret: "your-auth-secret"
  
data:
  dir: "/var/lib/influxdb2/data"
  wal-dir: "/var/lib/influxdb2/wal"
  series-id-set-cache-size: 100
  series-file-max-concurrent-snapshot-compactions: 4
  
http:
  bind-address: ":8086"
  auth-enabled: true
  log-enabled: true
  
# é›†ç¾¤é…ç½®
cluster:
  enabled: true
  meta-nodes: ["node1:8089", "node2:8089", "node3:8089"]
  data-nodes: ["node1:8086", "node2:8086", "node3:8086"]
```

## 10. æ€»ç»“

InfluxDBä½œä¸ºä¸“ä¸šçš„æ—¶åºæ•°æ®åº“ï¼Œä¸ºæ•°æ®é‡‡é›†ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚é€šè¿‡åˆç†çš„è®¾è®¡å’Œä¼˜åŒ–ï¼Œå¯ä»¥æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯é çš„æ•°æ®é‡‡é›†ç³»ç»Ÿã€‚

### å…³é”®è¦ç‚¹

1. **æ•°æ®æ¨¡å‹è®¾è®¡**ï¼šåˆç†ä½¿ç”¨æ ‡ç­¾å’Œå­—æ®µï¼Œé¿å…é«˜åŸºæ•°é—®é¢˜
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¹é‡å†™å…¥ã€å¼‚æ­¥å¤„ç†ã€æŸ¥è¯¢ä¼˜åŒ–
3. **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹å®Œå–„çš„æ•°æ®è´¨é‡ç›‘æ§ä½“ç³»
4. **é«˜å¯ç”¨éƒ¨ç½²**ï¼šé›†ç¾¤éƒ¨ç½²ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤

### å­¦ä¹ å»ºè®®

1. **æŒæ¡åŸºç¡€æ¦‚å¿µ**ï¼šç†è§£æ—¶åºæ•°æ®åº“çš„ç‰¹ç‚¹å’Œæ•°æ®æ¨¡å‹
2. **å®è·µæ•°æ®é‡‡é›†**ï¼šä»ç®€å•çš„ç³»ç»Ÿç›‘æ§å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°å¤æ‚åœºæ™¯
3. **æ€§èƒ½è°ƒä¼˜**ï¼šå­¦ä¹ æŸ¥è¯¢ä¼˜åŒ–å’Œå†™å…¥ä¼˜åŒ–æŠ€å·§
4. **è¿ç»´ç®¡ç†**ï¼šæŒæ¡é›†ç¾¤éƒ¨ç½²å’Œç›‘æ§å‘Šè­¦é…ç½®

InfluxDBæ•°æ®é‡‡é›†æŠ€æœ¯æ˜¯ç°ä»£æ•°æ®æ¶æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ŒæŒæ¡å®ƒå°†ä¸ºæ„å»ºå®æ—¶æ•°æ®å¤„ç†ç³»ç»Ÿå¥ å®šåšå®åŸºç¡€ã€‚ 