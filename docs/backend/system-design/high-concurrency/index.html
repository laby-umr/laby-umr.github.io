<!doctype html><html lang=zh-Hans dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-backend/system-design/high-concurrency" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡ | Labyçš„åšå®¢</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true property=og:image content=https://laby-umr.github.io/img/docusaurus-social-card.jpg /><meta data-rh=true name=twitter:image content=https://laby-umr.github.io/img/docusaurus-social-card.jpg /><meta data-rh=true property=og:url content=https://laby-umr.github.io/docs/backend/system-design/high-concurrency /><meta data-rh=true property=og:locale content=zh_Hans /><meta data-rh=true property=og:locale:alternate content=en /><meta data-rh=true name=docusaurus_locale content=zh-Hans /><meta data-rh=true name=docsearch:language content=zh-Hans /><meta data-rh=true name=keywords content="blog, javascript, typescript, react, vue, java, spring, å‰ç«¯, åç«¯, å…¨æ ˆå¼€å‘"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:type content=website /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡ | Labyçš„åšå®¢"/><meta data-rh=true name=description content=æ·±å…¥ç†è§£é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡åŸç†ã€æ¶æ„æ¨¡å¼ä¸æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ /><meta data-rh=true property=og:description content=æ·±å…¥ç†è§£é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡åŸç†ã€æ¶æ„æ¨¡å¼ä¸æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ /><link data-rh=true rel=icon href=/img/logo.jpg /><link data-rh=true rel=canonical href=https://laby-umr.github.io/docs/backend/system-design/high-concurrency /><link data-rh=true rel=alternate href=https://laby-umr.github.io/docs/backend/system-design/high-concurrency hreflang=zh-Hans /><link data-rh=true rel=alternate href=https://laby-umr.github.io/en/docs/backend/system-design/high-concurrency hreflang=en /><link data-rh=true rel=alternate href=https://laby-umr.github.io/docs/backend/system-design/high-concurrency hreflang=x-default /><link data-rh=true rel=preconnect href=https://Z8PAZK675G-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://laby-umr.github.io/docs/backend","name":"åç«¯å¼€å‘","position":1},{"@type":"ListItem","item":"https://laby-umr.github.io/docs/backend/system-design/high-concurrency","name":"é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡","position":2}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Labyçš„åšå®¢ RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Labyçš„åšå®¢ Atom Feed"><link rel=alternate type=application/json href=/blog/feed.json title="Labyçš„åšå®¢ JSON Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-03NXQZ7S0Z"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-03NXQZ7S0Z",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=Labyçš„åšå®¢ href=/opensearch.xml><link rel=icon href=/img/logo.jpg><link rel=manifest href=/manifest.json><meta name=theme-color content=#667eea><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><link rel=apple-touch-icon href=/img/logo.jpg><script>window.blogApiConfig={apiBaseUrl:"http://120.48.86.168:48080"}</script><link rel=dns-prefetch href=http://120.48.86.168:48080><link rel=preconnect href=http://120.48.86.168:48080 crossorigin=anonymous><link rel=stylesheet href=/assets/css/styles.072c8765.css /><script src=/assets/js/runtime~main.106f27b6.js defer></script><script src=/assets/js/main.f3282124.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id=__docusaurus><link rel=preload as=image href=/img/logo.jpg /><link rel=preload as=image href=/img/head.jpg /><link rel=preload as=image href=/img/user/WeChat.png /><canvas style=position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none></canvas><div class=progressContainer_awPh><div class=progressBar_CB9G style=width:0%><div class=progressGlow_gVHl></div></div><div class=particlesContainer_jiFR></div></div><div class=target-cursor-wrapper><div class=target-cursor-dot></div><div class="target-cursor-corner corner-tl"></div><div class="target-cursor-corner corner-tr"></div><div class="target-cursor-corner corner-br"></div><div class="target-cursor-corner corner-bl"></div></div><div role=region aria-label=è·³åˆ°ä¸»è¦å†…å®¹><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>è·³åˆ°ä¸»è¦å†…å®¹</a></div><div class="theme-announcement-bar announcementBar_mb4j" style=background-color:#667eea;color:#ffffff role=banner><div class=announcementBarPlaceholder_vyr4></div><div class="content_knG7 announcementBarContent_xLdY">â­ï¸ å¦‚æœè§‰å¾—è¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª <a target=_blank rel="noopener noreferrer" href=https://github.com/laby-umr/laby-umr.github.io>Star</a> æ”¯æŒä¸€ä¸‹ï¼</div><button type=button aria-label=å…³é—­ class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width=14 height=14><g stroke=currentColor stroke-width=3.1><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"/></g></svg></button></div><nav aria-label=ä¸»å¯¼èˆª class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=åˆ‡æ¢å¯¼èˆªæ  aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.jpg alt=Labyçš„åšå®¢Logo class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/logo.jpg alt=Labyçš„åšå®¢Logo class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div><b class="navbar__title text--truncate">Labyçš„åšå®¢</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/intro>çŸ¥è¯†åº“å¯¼èˆª</a><a class="navbar__item navbar__link" href=/blog>åšå®¢</a><a class="navbar__item navbar__link" href=/projects>é¡¹ç›®</a><a class="navbar__item navbar__link" href=/music>éŸ³ä¹</a><a class="navbar__item navbar__link" href=/contact>è”ç³»æˆ‘</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/about>å…³äºæˆ‘</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>ç®€ä½“ä¸­æ–‡</a><ul class=dropdown__menu><li><a href=/docs/backend/system-design/high-concurrency target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-Hans>ç®€ä½“ä¸­æ–‡</a><li><a href=/en/docs/backend/system-design/high-concurrency target=_self rel="noopener noreferrer" class=dropdown__link lang=en>English</a></ul></div><a href=https://github.com/MasterLiu93 target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºsystem modeï¼‰"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="æœç´¢æ–‡æ¡£ (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>æœç´¢</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=å›åˆ°é¡¶éƒ¨ class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=æ–‡æ¡£ä¾§è¾¹æ  class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/intro><span title=çŸ¥è¯†åº“å¯¼èˆª class=linkLabel_WmDU>çŸ¥è¯†åº“å¯¼èˆª</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/docs/frontend><span title=å‰ç«¯å¼€å‘ class=categoryLinkLabel_W154>å‰ç«¯å¼€å‘</span></a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» 'å‰ç«¯å¼€å‘'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/docs/backend><span title=åç«¯å¼€å‘ class=categoryLinkLabel_W154>åç«¯å¼€å‘</span></a><button aria-label="æŠ˜å ä¾§è¾¹æ åˆ†ç±» 'åç«¯å¼€å‘'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/backend-intro><span title=åç«¯å¼€å‘çŸ¥è¯†ä½“ç³» class=linkLabel_WmDU>åç«¯å¼€å‘çŸ¥è¯†ä½“ç³»</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/java-basics/data-types><span title=JavaåŸºç¡€ class=categoryLinkLabel_W154>JavaåŸºç¡€</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/java-collections/collection-interface><span title=Javaé›†åˆæ¡†æ¶ class=categoryLinkLabel_W154>Javaé›†åˆæ¡†æ¶</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/concurrency/thread-basics><span title=å¹¶å‘ç¼–ç¨‹ class=categoryLinkLabel_W154>å¹¶å‘ç¼–ç¨‹</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/jvm/memory-model><span title=JVM class=categoryLinkLabel_W154>JVM</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/spring/ioc><span title=Springæ¡†æ¶ class=categoryLinkLabel_W154>Springæ¡†æ¶</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/database-orm/database-intro><span title=æ•°æ®åº“ä¸ORM class=categoryLinkLabel_W154>æ•°æ®åº“ä¸ORM</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/microservices/service-discovery><span title=å¾®æœåŠ¡ class=categoryLinkLabel_W154>å¾®æœåŠ¡</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/distributed-systems/distributed-theory><span title=åˆ†å¸ƒå¼ç³»ç»Ÿ class=categoryLinkLabel_W154>åˆ†å¸ƒå¼ç³»ç»Ÿ</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/message-queues/kafka><span title=æ¶ˆæ¯é˜Ÿåˆ— class=categoryLinkLabel_W154>æ¶ˆæ¯é˜Ÿåˆ—</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/network-programming/tcp-ip><span title=ç½‘ç»œç¼–ç¨‹ class=categoryLinkLabel_W154>ç½‘ç»œç¼–ç¨‹</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/design-patterns/code-quality-intro><span title=è®¾è®¡æ¨¡å¼ class=categoryLinkLabel_W154>è®¾è®¡æ¨¡å¼</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/backend/big-data/big-data-intro><span title=å¤§æ•°æ®æŠ€æœ¯ class=categoryLinkLabel_W154>å¤§æ•°æ®æŠ€æœ¯</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/docs/backend/system-design/devops-intro><span title=ç³»ç»Ÿè®¾è®¡ class=categoryLinkLabel_W154>ç³»ç»Ÿè®¾è®¡</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/system-design/devops-intro><span title=DevOpså®è·µæŒ‡å— class=linkLabel_WmDU>DevOpså®è·µæŒ‡å—</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/system-design/high-availability><span title=é«˜å¯ç”¨æ€§ç³»ç»Ÿè®¾è®¡ class=linkLabel_WmDU>é«˜å¯ç”¨æ€§ç³»ç»Ÿè®¾è®¡</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/system-design/high-performance><span title=é«˜æ€§èƒ½ç³»ç»Ÿè®¾è®¡ class=linkLabel_WmDU>é«˜æ€§èƒ½ç³»ç»Ÿè®¾è®¡</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/backend/system-design/high-concurrency><span title=é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡ class=linkLabel_WmDU>é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/system-design/circuit-breaking><span title=ç†”æ–­å™¨æ¨¡å¼è®¾è®¡ class=linkLabel_WmDU>ç†”æ–­å™¨æ¨¡å¼è®¾è®¡</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/system-design/fallback><span title=é™çº§ç­–ç•¥è®¾è®¡ class=linkLabel_WmDU>é™çº§ç­–ç•¥è®¾è®¡</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/docs/backend/system-design/rate-limiting><span title=é™æµç³»ç»Ÿè®¾è®¡ class=linkLabel_WmDU>é™æµç³»ç»Ÿè®¾è®¡</span></a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/docs/digital-twin/digital-twin-intro><span title=æ•°å­—å­ªç”Ÿ class=categoryLinkLabel_W154>æ•°å­—å­ªç”Ÿ</span></a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» 'æ•°å­—å­ªç”Ÿ'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/docs/projectDesign/project-design-intro><span title=é¡¹ç›®è®¾è®¡ class=categoryLinkLabel_W154>é¡¹ç›®è®¾è®¡</span></a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» 'é¡¹ç›®è®¾è®¡'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/docs/document-template/template-index><span title=æ–‡æ¡£æ¨¡æ¿ class=categoryLinkLabel_W154>æ–‡æ¡£æ¨¡æ¿</span></a><button aria-label="å±•å¼€ä¾§è¾¹æ åˆ†ç±» 'æ–‡æ¡£æ¨¡æ¿'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=é¡µé¢è·¯å¾„><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label=ä¸»é¡µé¢ class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/docs/backend><span>åç«¯å¼€å‘</span></a><li class=breadcrumbs__item><span class=breadcrumbs__link>ç³»ç»Ÿè®¾è®¡</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><header><h1>é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡</h1></header>
<p>é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡æ˜¯æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯ã€‚é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡ã€ç¼“å­˜ç­–ç•¥ã€å¼‚æ­¥å¤„ç†å’Œæ•°æ®åº“ä¼˜åŒ–ï¼Œå¯ä»¥æ„å»ºå‡ºèƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚çš„ç³»ç»Ÿã€‚</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>æœ¬æ–‡å†…å®¹æ¦‚è§ˆ</div><div class=admonitionContent_BuS1><div class=tableOfContentsInline_prmo><ul class=table-of-contents><li><a href=#1-å¹¶å‘æ¨¡å‹åŸºç¡€>1. å¹¶å‘æ¨¡å‹åŸºç¡€</a><ul><li><a href=#11-å¹¶å‘ä¸å¹¶è¡Œ>1.1 å¹¶å‘ä¸å¹¶è¡Œ</a><li><a href=#12-çº¿ç¨‹æ¨¡å‹>1.2 çº¿ç¨‹æ¨¡å‹</a></ul><li><a href=#2-é«˜å¹¶å‘æ¶æ„è®¾è®¡>2. é«˜å¹¶å‘æ¶æ„è®¾è®¡</a><ul><li><a href=#21-åˆ†å±‚æ¶æ„>2.1 åˆ†å±‚æ¶æ„</a><li><a href=#22-å¾®æœåŠ¡æ¶æ„>2.2 å¾®æœåŠ¡æ¶æ„</a></ul><li><a href=#3-ç¼“å­˜ä¼˜åŒ–ç­–ç•¥>3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥</a><ul><li><a href=#31-å¤šçº§ç¼“å­˜æ¶æ„>3.1 å¤šçº§ç¼“å­˜æ¶æ„</a><li><a href=#32-ç¼“å­˜æ›´æ–°ç­–ç•¥>3.2 ç¼“å­˜æ›´æ–°ç­–ç•¥</a><li><a href=#33-ç¼“å­˜ç©¿é€é˜²æŠ¤>3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤</a></ul><li><a href=#4-å¼‚æ­¥å¤„ç†æœºåˆ¶>4. å¼‚æ­¥å¤„ç†æœºåˆ¶</a><ul><li><a href=#41-æ¶ˆæ¯é˜Ÿåˆ—>4.1 æ¶ˆæ¯é˜Ÿåˆ—</a><li><a href=#42-å¼‚æ­¥è°ƒç”¨>4.2 å¼‚æ­¥è°ƒç”¨</a></ul><li><a href=#5-æ•°æ®åº“ä¼˜åŒ–>5. æ•°æ®åº“ä¼˜åŒ–</a><ul><li><a href=#51-è¯»å†™åˆ†ç¦»>5.1 è¯»å†™åˆ†ç¦»</a><li><a href=#52-åˆ†åº“åˆ†è¡¨>5.2 åˆ†åº“åˆ†è¡¨</a></ul><li><a href=#6-é¢è¯•é¢˜ç²¾é€‰>6. é¢è¯•é¢˜ç²¾é€‰</a></ul></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>æ ¸å¿ƒä»·å€¼</div><div class=admonitionContent_BuS1><p><strong>é«˜å¹¶å‘ = å¹¶å‘æ¨¡å‹ + ç¼“å­˜ä¼˜åŒ– + å¼‚æ­¥å¤„ç† + æ•°æ®åº“ä¼˜åŒ– + è´Ÿè½½å‡è¡¡</strong><ul>
<li class="">ğŸ§µ <strong>å¹¶å‘æ¨¡å‹</strong>ï¼šé«˜æ•ˆå¤„ç†å¤šä»»åŠ¡çš„çº¿ç¨‹æ¨¡å‹è®¾è®¡</li>
<li class="">ğŸš€ <strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šå‡å°‘è®¿é—®å»¶è¿Ÿï¼Œæé«˜æ•°æ®è¯»å–é€Ÿåº¦</li>
<li class="">âš¡ <strong>å¼‚æ­¥å¤„ç†</strong>ï¼šé¿å…é˜»å¡ï¼Œæé«˜ç³»ç»Ÿååé‡</li>
<li class="">ğŸ“Š <strong>æ•°æ®åº“ä¼˜åŒ–</strong>ï¼šåˆ†ç‰‡ã€ç´¢å¼•ã€è¯»å†™åˆ†ç¦»ç­‰ç­–ç•¥</li>
<li class="">âš–ï¸ <strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåˆç†åˆ†é…è¯·æ±‚ï¼Œé¿å…å•ç‚¹è¿‡è½½</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=1-å¹¶å‘æ¨¡å‹åŸºç¡€>1. å¹¶å‘æ¨¡å‹åŸºç¡€<a href=#1-å¹¶å‘æ¨¡å‹åŸºç¡€ class=hash-link aria-label="1. å¹¶å‘æ¨¡å‹åŸºç¡€çš„ç›´æ¥é“¾æ¥" title="1. å¹¶å‘æ¨¡å‹åŸºç¡€çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=11-å¹¶å‘ä¸å¹¶è¡Œ>1.1 å¹¶å‘ä¸å¹¶è¡Œ<a href=#11-å¹¶å‘ä¸å¹¶è¡Œ class=hash-link aria-label="1.1 å¹¶å‘ä¸å¹¶è¡Œçš„ç›´æ¥é“¾æ¥" title="1.1 å¹¶å‘ä¸å¹¶è¡Œçš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<!-- -->
<p>å¹¶å‘å’Œå¹¶è¡Œæ˜¯å¤„ç†å¤šä»»åŠ¡çš„ä¸åŒæ–¹å¼ï¼š</p>
<table><thead><tr><th>æ¦‚å¿µ<th>è¯´æ˜<th>ç‰¹ç‚¹<tbody><tr><td><strong>å¹¶å‘ (Concurrency)</strong><td>å¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œ<td>å•æ ¸CPUä¸Šçš„å¤šä»»åŠ¡å¤„ç†<tr><td><strong>å¹¶è¡Œ (Parallelism)</strong><td>å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ<td>å¤šæ ¸CPUä¸Šçš„å¤šä»»åŠ¡å¤„ç†</table>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>å¹¶å‘ä¸å¹¶è¡Œçš„è¯¦ç»†æ¯”è¾ƒ</summary><div><div class=collapsibleContent_i85q><p><strong>å¹¶å‘ (Concurrency)</strong>:<ul>
<li class="">æ˜¯ä¸€ç§é€»è¾‘æ¦‚å¿µï¼ŒæŒ‡å¤šä¸ªä»»åŠ¡å¯ä»¥åœ¨é‡å çš„æ—¶é—´æ®µå†…å¯åŠ¨ã€è¿è¡Œå’Œå®Œæˆ</li>
<li class="">ä¸€ä¸ªå¤„ç†å™¨é€šè¿‡æ—¶é—´ç‰‡åˆ‡æ¢æ¥å¤„ç†å¤šä¸ªä»»åŠ¡</li>
<li class="">å¼ºè°ƒä»»åŠ¡çš„è°ƒåº¦ä¸åˆ‡æ¢</li>
<li class="">é€‚ç”¨äºIOå¯†é›†å‹ä»»åŠ¡</li>
</ul><p><strong>å¹¶è¡Œ (Parallelism)</strong>:<ul>
<li class="">æ˜¯ä¸€ç§ç‰©ç†æ¦‚å¿µï¼ŒæŒ‡å¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶åˆ»åŒæ—¶è¿è¡Œ</li>
<li class="">éœ€è¦å¤šä¸ªå¤„ç†å™¨æˆ–å¤šæ ¸å¤„ç†å™¨</li>
<li class="">å¼ºè°ƒåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡</li>
<li class="">é€‚ç”¨äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡</li>
</ul></div></div></details>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">å¹¶å‘ç¤ºä¾‹<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">å¹¶è¡Œç¤ºä¾‹</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@RestController</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ConcurrentController</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">AsyncTaskExecutor</span><span class="token plain"> taskExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@GetMapping</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"/concurrent"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handleConcurrent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sleep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">InterruptedException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">currentThread</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">interrupt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"å¹¶å‘å¤„ç†å®Œæˆ"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> taskExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ParallelService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processParallel</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parallelStream</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">item </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¹¶è¡Œå¤„ç†æ¯ä¸ªé¡¹ç›®</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processItem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Collectors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">toList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processItem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¤„ç†å•ä¸ªé¡¹ç›®çš„é€»è¾‘</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"processed_"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> item</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=12-çº¿ç¨‹æ¨¡å‹>1.2 çº¿ç¨‹æ¨¡å‹<a href=#12-çº¿ç¨‹æ¨¡å‹ class=hash-link aria-label="1.2 çº¿ç¨‹æ¨¡å‹çš„ç›´æ¥é“¾æ¥" title="1.2 çº¿ç¨‹æ¨¡å‹çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<!-- -->
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id=çº¿ç¨‹æ± è®¾è®¡>çº¿ç¨‹æ± è®¾è®¡<a href=#çº¿ç¨‹æ± è®¾è®¡ class=hash-link aria-label=çº¿ç¨‹æ± è®¾è®¡çš„ç›´æ¥é“¾æ¥ title=çº¿ç¨‹æ± è®¾è®¡çš„ç›´æ¥é“¾æ¥ translate=no>â€‹</a></h4>
<p>çº¿ç¨‹æ± æ˜¯ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸã€æ§åˆ¶å¹¶å‘çš„é‡è¦å·¥å…·ã€‚åˆç†é…ç½®çº¿ç¨‹æ± å‚æ•°å¯¹ç³»ç»Ÿæ€§èƒ½è‡³å…³é‡è¦ã€‚</p>
<div class=card><div class=card__header><h4>çº¿ç¨‹æ± å‚æ•°é…ç½®æŒ‡å—</h4></div><div class=card__body><table><thead><tr><th>å‚æ•°<th>è¯´æ˜<th>é…ç½®å»ºè®®<tbody><tr><td><strong>æ ¸å¿ƒçº¿ç¨‹æ•°(corePoolSize)</strong><td>çº¿ç¨‹æ± ç»´æŠ¤çš„æœ€å°çº¿ç¨‹æ•°<td>IOå¯†é›†å‹ï¼šCPUæ ¸å¿ƒæ•° * 2<br/>CPUå¯†é›†å‹ï¼šCPUæ ¸å¿ƒæ•°<tr><td><strong>æœ€å¤§çº¿ç¨‹æ•°(maxPoolSize)</strong><td>çº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°<td>IOå¯†é›†å‹ï¼šæ ¸å¿ƒçº¿ç¨‹æ•° * 3<br/>CPUå¯†é›†å‹ï¼šæ ¸å¿ƒçº¿ç¨‹æ•° + 1<tr><td><strong>é˜Ÿåˆ—å®¹é‡(queueCapacity)</strong><td>ä»»åŠ¡é˜Ÿåˆ—å¤§å°<td>æ ¹æ®å†…å­˜å’Œä»»åŠ¡ç‰¹æ€§è¯„ä¼°ï¼Œå¸¸è§100~1000<tr><td><strong>æ‹’ç»ç­–ç•¥(rejectedExecutionHandler)</strong><td>é˜Ÿåˆ—æ»¡æ—¶çš„å¤„ç†ç­–ç•¥<td>AbortPolicyï¼šæŠ›å¼‚å¸¸<br/>CallerRunsPolicyï¼šç”±è°ƒç”¨è€…çº¿ç¨‹æ‰§è¡Œ<br/>DiscardPolicyï¼šä¸¢å¼ƒä»»åŠ¡<br/>DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€æ—§ä»»åŠ¡</table></div></div>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">çº¿ç¨‹æ± é…ç½®<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">çº¿ç¨‹æ± ä½¿ç”¨<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">çº¿ç¨‹æ± ç›‘æ§</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Configuration</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ThreadPoolConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Bean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ioThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ioThreadPool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> executor </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setCorePoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">20</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setMaxPoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setQueueCapacity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">500</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setThreadNamePrefix</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"IO-"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setRejectedExecutionHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ThreadPoolExecutor</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">CallerRunsPolicy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">initialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Bean</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"cpuThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cpuThreadPool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> executor </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setCorePoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Runtime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getRuntime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">availableProcessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setMaxPoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Runtime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getRuntime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">availableProcessors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setQueueCapacity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setThreadNamePrefix</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"CPU-"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setRejectedExecutionHandler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ThreadPoolExecutor</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token class-name">AbortPolicy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">      executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">initialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ThreadPoolService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Qualifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ioThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> ioExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Qualifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"cpuThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> cpuExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handleIOBoundTask</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// IOå¯†é›†å‹ä»»åŠ¡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">performIOOperation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ioExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handleCPUBoundTask</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// CPUå¯†é›†å‹ä»»åŠ¡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">performCPUOperation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cpuExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Component</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ThreadPoolMonitor</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Qualifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ioThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> ioExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Qualifier</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"cpuThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> cpuExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Scheduled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fixedRate </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">30000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// æ¯30ç§’æ‰§è¡Œä¸€æ¬¡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">monitorThreadPools</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">logThreadPoolStats</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"IOçº¿ç¨‹æ± "</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ioExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">logThreadPoolStats</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"CPUçº¿ç¨‹æ± "</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cpuExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">logThreadPoolStats</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> poolName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">ThreadPoolExecutor</span><span class="token plain"> threadPoolExecutor </span><span class="token operator">=</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getThreadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> corePoolSize </span><span class="token operator">=</span><span class="token plain"> threadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getCorePoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> poolSize </span><span class="token operator">=</span><span class="token plain"> threadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getPoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> activeCount </span><span class="token operator">=</span><span class="token plain"> threadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getActiveCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token plain"> taskCount </span><span class="token operator">=</span><span class="token plain"> threadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getTaskCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token plain"> completedTaskCount </span><span class="token operator">=</span><span class="token plain"> threadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getCompletedTaskCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> queueSize </span><span class="token operator">=</span><span class="token plain"> threadPoolExecutor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getQueue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"{} çŠ¶æ€ - æ ¸å¿ƒçº¿ç¨‹æ•°: {}, å½“å‰çº¿ç¨‹æ•°: {}, æ´»è·ƒçº¿ç¨‹æ•°: {}, "</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"ä»»åŠ¡æ€»æ•°: {}, å·²å®Œæˆä»»åŠ¡: {}, é˜Ÿåˆ—å¤§å°: {}"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">                poolName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> corePoolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> poolSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> activeCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">                taskCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> completedTaskCount</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> queueSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>çº¿ç¨‹æ± é…ç½®æ³¨æ„äº‹é¡¹</div><div class=admonitionContent_BuS1><ol>
<li class=""><strong>é¿å…æ— é™å¢é•¿</strong>ï¼šè®¾ç½®åˆç†çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œé˜²æ­¢èµ„æºè€—å°½</li>
<li class=""><strong>ä»»åŠ¡åˆ†ç±»</strong>ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹ï¼ˆIOå¯†é›†/CPUå¯†é›†ï¼‰ä½¿ç”¨ä¸åŒçº¿ç¨‹æ± </li>
<li class=""><strong>åŠ¨æ€è°ƒæ•´</strong>ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å‚æ•°</li>
<li class=""><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§çº¿ç¨‹æ± çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°é—®é¢˜</li>
<li class=""><strong>ä¼˜é›…å…³é—­</strong>ï¼šåº”ç”¨å…³é—­æ—¶ç­‰å¾…çº¿ç¨‹æ± ä»»åŠ¡å®Œæˆ</li>
</ol></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id=å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹>å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹<a href=#å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ class=hash-link aria-label=å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„ç›´æ¥é“¾æ¥ title=å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„ç›´æ¥é“¾æ¥ translate=no>â€‹</a></h4>
<p>å¼‚æ­¥ç¼–ç¨‹æ˜¯é«˜å¹¶å‘ç³»ç»Ÿçš„é‡è¦æŠ€æœ¯ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜ç³»ç»Ÿååé‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">@Asyncæ³¨è§£<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">CompletableFuture<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">å“åº”å¼ç¼–ç¨‹</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">AsyncService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Async</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ioThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">asyncOperation1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¼‚æ­¥æ“ä½œ1</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">completedFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"æ“ä½œ1å®Œæˆ"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Async</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ioThreadPool"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">asyncOperation2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¼‚æ­¥æ“ä½œ2</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">completedFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"æ“ä½œ2å®Œæˆ"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">performAsyncOperations</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> future1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">asyncOperation1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> future2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">asyncOperation2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">allOf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">future1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> future2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">thenApply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ArrayList</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">                results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">future1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">                results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">future2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> results</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CompletableFutureService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ProductRepository</span><span class="token plain"> productRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ReviewRepository</span><span class="token plain"> reviewRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">PriceRepository</span><span class="token plain"> priceRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">Executor</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">ProductDetails</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getProductDetails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Long</span><span class="token plain"> productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Product</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> productFuture </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> productRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">findById</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">orElseThrow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ProductNotFoundException</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Review</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> reviewsFuture </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> reviewRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">findByProductId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Price</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> priceFuture </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> priceRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">findByProductId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">allOf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> reviewsFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> priceFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">thenApply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">v </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">Product</span><span class="token plain"> product </span><span class="token operator">=</span><span class="token plain"> productFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Review</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> reviews </span><span class="token operator">=</span><span class="token plain"> reviewsFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">Price</span><span class="token plain"> price </span><span class="token operator">=</span><span class="token plain"> priceFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">                </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ProductDetails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> price</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>36</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ReactiveService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ReactiveProductRepository</span><span class="token plain"> productRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ReactiveReviewRepository</span><span class="token plain"> reviewRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">Mono</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">ProductDetails</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getProductDetails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Long</span><span class="token plain"> productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">Mono</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Product</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> productMono </span><span class="token operator">=</span><span class="token plain"> productRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">findById</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">Flux</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Review</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> reviewsFlux </span><span class="token operator">=</span><span class="token plain"> reviewRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">findByProductId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">productId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> productMono</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zipWith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">reviewsFlux</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collectList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tuple </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">Product</span><span class="token plain"> product </span><span class="token operator">=</span><span class="token plain"> tuple</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getT1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Review</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> reviews </span><span class="token operator">=</span><span class="token plain"> tuple</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getT2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ProductDetails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> reviews</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=2-é«˜å¹¶å‘æ¶æ„è®¾è®¡>2. é«˜å¹¶å‘æ¶æ„è®¾è®¡<a href=#2-é«˜å¹¶å‘æ¶æ„è®¾è®¡ class=hash-link aria-label="2. é«˜å¹¶å‘æ¶æ„è®¾è®¡çš„ç›´æ¥é“¾æ¥" title="2. é«˜å¹¶å‘æ¶æ„è®¾è®¡çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=21-åˆ†å±‚æ¶æ„>2.1 åˆ†å±‚æ¶æ„<a href=#21-åˆ†å±‚æ¶æ„ class=hash-link aria-label="2.1 åˆ†å±‚æ¶æ„çš„ç›´æ¥é“¾æ¥" title="2.1 åˆ†å±‚æ¶æ„çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>åˆ†å±‚æ¶æ„æ˜¯æ„å»ºé«˜å¹¶å‘ç³»ç»Ÿçš„åŸºç¡€ï¼Œé€šè¿‡å°†ç³»ç»Ÿåˆ†ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œå¯ä»¥å®ç°æ›´å¥½çš„æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<!-- -->
<div class=card><div class=card__body><p>é«˜å¹¶å‘ç³»ç»Ÿå¸¸è§çš„æ¶æ„å±‚æ¬¡ï¼š<ol>
<li class=""><strong>è´Ÿè½½å‡è¡¡å±‚</strong>ï¼šåˆ†å‘è¯·æ±‚ï¼Œé˜²æ­¢å•ç‚¹è¿‡è½½</li>
<li class=""><strong>åº”ç”¨æœåŠ¡å±‚</strong>ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œæƒé™éªŒè¯ï¼Œå‚æ•°æ ¡éªŒ</li>
<li class=""><strong>ä¸šåŠ¡æœåŠ¡å±‚</strong>ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</li>
<li class=""><strong>æ•°æ®è®¿é—®å±‚</strong>ï¼šæä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£</li>
<li class=""><strong>æ•°æ®å­˜å‚¨å±‚</strong>ï¼šå®é™…çš„æ•°æ®å­˜å‚¨ï¼Œå¦‚æ•°æ®åº“ã€ç¼“å­˜ç­‰</li>
<li class=""><strong>ç¼“å­˜å±‚</strong>ï¼šæ¨ªåˆ‡å„å±‚ï¼Œæä¾›æ•°æ®ç¼“å­˜</li>
</ol></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=22-å¾®æœåŠ¡æ¶æ„>2.2 å¾®æœåŠ¡æ¶æ„<a href=#22-å¾®æœåŠ¡æ¶æ„ class=hash-link aria-label="2.2 å¾®æœåŠ¡æ¶æ„çš„ç›´æ¥é“¾æ¥" title="2.2 å¾®æœåŠ¡æ¶æ„çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>å¾®æœåŠ¡æ¶æ„å°†ç³»ç»Ÿæ‹†åˆ†ä¸ºå¤šä¸ªå°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è´Ÿè´£ç‰¹å®šä¸šåŠ¡åŠŸèƒ½ï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡APIé€šä¿¡ã€‚è¿™ç§æ¶æ„å¯ä»¥å®ç°æ›´å¥½çš„æ°´å¹³æ‰©å±•ï¼Œæé«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p>
<!-- -->
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>å¾®æœåŠ¡æ¶æ„ä¼˜åŠ¿ä¸æŒ‘æˆ˜</summary><div><div class=collapsibleContent_i85q><p><strong>ä¼˜åŠ¿</strong>ï¼š<ul>
<li class=""><strong>ç‹¬ç«‹æ‰©å±•</strong>ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒæœåŠ¡è¿›è¡Œç‹¬ç«‹æ‰©å±•</li>
<li class=""><strong>æŠ€æœ¯å¤šæ ·æ€§</strong>ï¼šä¸åŒæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ</li>
<li class=""><strong>æ•…éšœéš”ç¦»</strong>ï¼šå•ä¸ªæœåŠ¡æ•…éšœä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ</li>
<li class=""><strong>å›¢é˜Ÿè‡ªæ²»</strong>ï¼šå°å›¢é˜Ÿè´Ÿè´£ç‰¹å®šæœåŠ¡ï¼Œæé«˜å¼€å‘æ•ˆç‡</li>
<li class=""><strong>è¿­ä»£é€Ÿåº¦</strong>ï¼šå°æœåŠ¡å¯ä»¥å¿«é€Ÿè¿­ä»£æ›´æ–°</li>
</ul><p><strong>æŒ‘æˆ˜</strong>ï¼š<ul>
<li class=""><strong>åˆ†å¸ƒå¼å¤æ‚æ€§</strong>ï¼šéœ€è¦å¤„ç†ç½‘ç»œå»¶è¿Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ç­‰</li>
<li class=""><strong>æœåŠ¡æ²»ç†</strong>ï¼šéœ€è¦ç®¡ç†æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰</li>
<li class=""><strong>ä¸€è‡´æ€§ä¿è¯</strong>ï¼šè·¨æœåŠ¡äº‹åŠ¡éš¾ä»¥ä¿è¯å¼ºä¸€è‡´æ€§</li>
<li class=""><strong>è¿ç»´å¤æ‚åº¦</strong>ï¼šéœ€è¦ç®¡ç†å¤šä¸ªæœåŠ¡å®ä¾‹</li>
<li class=""><strong>ç›‘æ§éš¾åº¦</strong>ï¼šéœ€è¦è·¨æœåŠ¡é“¾è·¯è¿½è¸ªå’Œç›‘æ§</li>
</ul></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=3-ç¼“å­˜ä¼˜åŒ–ç­–ç•¥>3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥<a href=#3-ç¼“å­˜ä¼˜åŒ–ç­–ç•¥ class=hash-link aria-label="3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥çš„ç›´æ¥é“¾æ¥" title="3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h2>
<p>ç¼“å­˜æ˜¯é«˜å¹¶å‘ç³»ç»Ÿä¸­æå‡æ€§èƒ½çš„å…³é”®æŠ€æœ¯ï¼Œåˆç†ä½¿ç”¨ç¼“å­˜å¯ä»¥å¤§å¹…å‡å°‘å¯¹åç«¯æœåŠ¡çš„è®¿é—®å‹åŠ›ã€‚</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=31-å¤šçº§ç¼“å­˜æ¶æ„>3.1 å¤šçº§ç¼“å­˜æ¶æ„<a href=#31-å¤šçº§ç¼“å­˜æ¶æ„ class=hash-link aria-label="3.1 å¤šçº§ç¼“å­˜æ¶æ„çš„ç›´æ¥é“¾æ¥" title="3.1 å¤šçº§ç¼“å­˜æ¶æ„çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<!-- -->
<div class=card><div class=card__header><h4>å¤šçº§ç¼“å­˜ç‰¹ç‚¹</h4></div><div class=card__body><table><thead><tr><th>ç¼“å­˜çº§åˆ«<th>è¯´æ˜<th>ç‰¹ç‚¹<th>é€‚ç”¨åœºæ™¯<tbody><tr><td><strong>L1 æœ¬åœ°ç¼“å­˜</strong><td>åº”ç”¨å†…å­˜ä¸­çš„ç¼“å­˜<td>è®¿é—®æœ€å¿«ã€å®¹é‡æœ‰é™ã€ä¸åº”ç”¨åŒç”Ÿå‘½å‘¨æœŸ<td>é«˜é¢‘è®¿é—®ã€å˜åŒ–å°‘çš„æ•°æ®<tr><td><strong>L2 åˆ†å¸ƒå¼ç¼“å­˜</strong><td>Redisç­‰åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿ<td>å®¹é‡å¤§ã€å¯é æ€§é«˜ã€è·¨åº”ç”¨å…±äº«<td>éœ€è¦è·¨å®ä¾‹å…±äº«çš„æ•°æ®<tr><td><strong>L3 æ•°æ®åº“</strong><td>æŒä¹…åŒ–å­˜å‚¨<td>å®¹é‡æœ€å¤§ã€è®¿é—®æœ€æ…¢ã€æœ€ç»ˆæ•°æ®æº<td>æ‰€æœ‰éœ€è¦æŒä¹…åŒ–çš„æ•°æ®</table></div></div>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">å¤šçº§ç¼“å­˜å®ç°<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">ç¼“å­˜ç›‘æ§</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">MultiLevelCacheService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// L1ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">LoadingCache</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> localCache </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Caffeine</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">newBuilder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">maximumSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">expireAfterWrite</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key </span><span class="token operator">-></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromL2Cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// L2ç¼“å­˜ï¼šRedisç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">RedisTemplate</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// L3ç¼“å­˜ï¼šæ•°æ®åº“</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">UserRepository</span><span class="token plain"> userRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// ä»L1ç¼“å­˜è·å–</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> localCache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">          log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"L1ç¼“å­˜è·å–å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// é™çº§åˆ°L2ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromL2Cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromL2Cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token class-name">Object</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token comment" style="color:rgb(98, 114, 164)">// L2ç¼“å­˜æœªå‘½ä¸­ï¼Œä»L3è·å–</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">              value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromL3Cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>36</span><span class=codeLineContent_HA3z><span class="token plain">                  </span><span class="token comment" style="color:rgb(98, 114, 164)">// å†™å…¥L2ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>37</span><span class=codeLineContent_HA3z><span class="token plain">                  redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>38</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>39</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>40</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>41</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>42</span><span class=codeLineContent_HA3z><span class="token plain">          log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"L2ç¼“å­˜è·å–å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>43</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// é™çº§åˆ°L3ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>44</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromL3Cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>45</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>46</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>47</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>48</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromL3Cache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>49</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// ä»æ•°æ®åº“è·å–æ•°æ®</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>50</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">startsWith</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"user:"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>51</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token class-name">Long</span><span class="token plain"> userId </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Long</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">parseLong</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>52</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> userRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">findById</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">orElse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>53</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>54</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>55</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>56</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Component</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CacheMetricsCollector</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">final</span><span class="token plain"> </span><span class="token class-name">MeterRegistry</span><span class="token plain"> registry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">final</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Counter</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> hitCounters </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">final</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Counter</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> missCounters </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">final</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Timer</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> accessTimers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CacheMetricsCollector</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">MeterRegistry</span><span class="token plain"> registry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">registry </span><span class="token operator">=</span><span class="token plain"> registry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// åˆå§‹åŒ–è®¡æ•°å™¨</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">initializeCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"l1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">initializeCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"l2"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">initializeCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"l3"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">initializeCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">        hitCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">put</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">builder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"cache."</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> level </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">".hits"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">description</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">" cache hit count"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">register</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">registry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">        missCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">put</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">builder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"cache."</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> level </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">".misses"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">description</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">" cache miss count"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">register</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">registry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">        accessTimers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">put</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Timer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">builder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"cache."</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> level </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">".access.time"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">description</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">" cache access time"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">register</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">registry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">recordHit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">        hitCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>36</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">recordMiss</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>37</span><span class=codeLineContent_HA3z><span class="token plain">        missCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">increment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>38</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>39</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>40</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token class-name">T</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">recordAccessTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Supplier</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">T</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> operation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>41</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> accessTimers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">record</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">operation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>42</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>43</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>44</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// è·å–å‘½ä¸­ç‡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>45</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">double</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getHitRate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>46</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token plain"> hits </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> hitCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>47</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token plain"> misses </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> missCounters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>48</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token plain"> total </span><span class="token operator">=</span><span class="token plain"> hits </span><span class="token operator">+</span><span class="token plain"> misses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>49</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>50</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> total </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">double</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> hits </span><span class="token operator">/</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>51</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>52</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=32-ç¼“å­˜æ›´æ–°ç­–ç•¥>3.2 ç¼“å­˜æ›´æ–°ç­–ç•¥<a href=#32-ç¼“å­˜æ›´æ–°ç­–ç•¥ class=hash-link aria-label="3.2 ç¼“å­˜æ›´æ–°ç­–ç•¥çš„ç›´æ¥é“¾æ¥" title="3.2 ç¼“å­˜æ›´æ–°ç­–ç•¥çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>ç¼“å­˜æ›´æ–°ç­–ç•¥å…³ç³»åˆ°ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½ï¼Œä¸åŒçš„åœºæ™¯éœ€è¦é€‰æ‹©ä¸åŒçš„ç­–ç•¥ã€‚</p>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">å†™ç©¿ç­–ç•¥<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">å†™å›ç­–ç•¥<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">å¤±æ•ˆç­–ç•¥</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Transactional</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">writeThrough</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. æ›´æ–°æ•°æ®åº“</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">updateDatabase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. æ›´æ–°ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      localCache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">invalidate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">writeBack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. æ›´æ–°ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">      redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">      localCache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">invalidate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. å¼‚æ­¥æ›´æ–°æ•°æ®åº“</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">runAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token function" style="color:rgb(80, 250, 123)">updateDatabase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Transactional</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">writeInvalidate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. æ›´æ–°æ•°æ®åº“</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token function" style="color:rgb(80, 250, 123)">updateDatabase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. åˆ é™¤ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">delete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      localCache</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">invalidate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>ç¼“å­˜æ›´æ–°æ³¨æ„äº‹é¡¹</div><div class=admonitionContent_BuS1><ol>
<li class=""><strong>ä¸€è‡´æ€§ä¸æ€§èƒ½å¹³è¡¡</strong>ï¼šå¼ºä¸€è‡´æ€§ä¼šå½±å“æ€§èƒ½ï¼Œéœ€è¦åœ¨ä¸€è‡´æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾å¹³è¡¡</li>
<li class=""><strong>æ•°æ®ç‰¹æ€§è€ƒè™‘</strong>ï¼šé«˜é¢‘è¯»å–çš„æ•°æ®é€‚åˆRead-Throughï¼Œé¢‘ç¹å†™å…¥çš„æ•°æ®å¯èƒ½é€‚åˆWrite-Invalidate</li>
<li class=""><strong>å¤±æ•ˆé£é™©</strong>ï¼šå…ˆåˆ é™¤ç¼“å­˜å†æ›´æ–°æ•°æ®åº“å¯èƒ½å¯¼è‡´è„è¯»</li>
<li class=""><strong>åŒå†™é£é™©</strong>ï¼šå…ˆæ›´æ–°æ•°æ®åº“å†æ›´æ–°ç¼“å­˜å¯èƒ½å› ä¸ºå¹¶å‘å¯¼è‡´ä¸ä¸€è‡´</li>
<li class=""><strong>å»¶è¿ŸåŒåˆ </strong>ï¼šæ›´æ–°æ•°æ®åº“ååˆ é™¤ç¼“å­˜ï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´åå†æ¬¡åˆ é™¤ç¼“å­˜</li>
</ol></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=33-ç¼“å­˜ç©¿é€é˜²æŠ¤>3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤<a href=#33-ç¼“å­˜ç©¿é€é˜²æŠ¤ class=hash-link aria-label="3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤çš„ç›´æ¥é“¾æ¥" title="3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½ä¼šç©¿é€ç¼“å­˜åˆ°è¾¾æ•°æ®åº“ã€‚</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©çš„åŒºåˆ«</summary><div><div class=collapsibleContent_i85q><p><strong>ç¼“å­˜ç©¿é€(Cache Penetration)</strong>ï¼š<ul>
<li class="">æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜æœªå‘½ä¸­ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</li>
<li class="">å¯ä»¥é€šè¿‡ç©ºå€¼ç¼“å­˜ã€å¸ƒéš†è¿‡æ»¤å™¨ç­‰æ–¹æ¡ˆè§£å†³</li>
</ul><p><strong>ç¼“å­˜å‡»ç©¿(Cache Breakdown)</strong>ï¼š<ul>
<li class="">çƒ­ç‚¹æ•°æ®è¿‡æœŸç¬é—´ï¼Œå¤§é‡è¯·æ±‚ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</li>
<li class="">å¯ä»¥é€šè¿‡äº’æ–¥é”ã€çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸç­‰æ–¹æ¡ˆè§£å†³</li>
</ul><p><strong>ç¼“å­˜é›ªå´©(Cache Avalanche)</strong>ï¼š<ul>
<li class="">å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°æ•°æ®åº“</li>
<li class="">å¯ä»¥é€šè¿‡éšæœºè¿‡æœŸæ—¶é—´ã€å¤šçº§ç¼“å­˜ç­‰æ–¹æ¡ˆè§£å†³</li>
</ul></div></div></details>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">å¸ƒéš†è¿‡æ»¤å™¨<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">äº’æ–¥é”é˜²å‡»ç©¿</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Component</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">BloomFilter</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">BitSet</span><span class="token plain"> bitSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> hashFunctions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">BloomFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> hashFunctions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">bitSet </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">BitSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">size </span><span class="token operator">=</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">hashFunctions </span><span class="token operator">=</span><span class="token plain"> hashFunctions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> hashFunctions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> hash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">            bitSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hash </span><span class="token operator">%</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">boolean</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mightContain</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> hashFunctions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> hash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">bitSet</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hash </span><span class="token operator">%</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">hash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> seed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i </span><span class="token operator">&lt;</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> i</span><span class="token operator">++</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">            result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">31</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> result </span><span class="token operator">+</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">charAt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> seed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>36</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">abs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>37</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>38</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>39</span><span class=codeLineContent_HA3z><span class="token plain" style=display:inline-block></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>40</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>41</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>42</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CachePenetrationProtection</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>43</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>44</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>45</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">RedisTemplate</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>46</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>47</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>48</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">BloomFilter</span><span class="token plain"> bloomFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>49</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>50</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getDataWithProtection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>51</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. å¸ƒéš†è¿‡æ»¤å™¨æ£€æŸ¥</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>52</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">!</span><span class="token plain">bloomFilter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">mightContain</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>53</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>54</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>55</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>56</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. ä»ç¼“å­˜è·å–</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>57</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">Object</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>58</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>59</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>60</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>61</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>62</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 3. ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“è·å–</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>63</span><span class=codeLineContent_HA3z><span class="token plain">      value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromDatabase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>64</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>65</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// å†™å…¥ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>66</span><span class=codeLineContent_HA3z><span class="token plain">          redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>67</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>68</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token comment" style="color:rgb(98, 114, 164)">// ç©ºå€¼ç¼“å­˜ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>69</span><span class=codeLineContent_HA3z><span class="token plain">          redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"NULL"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>70</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>71</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>72</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>73</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>74</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">CacheBreakdownProtection</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">RedisTemplate</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">StringRedisTemplate</span><span class="token plain"> stringRedisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">    </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getDataWithLock</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. ä»ç¼“å­˜è·å–</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">Object</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. è·å–äº’æ–¥é”</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">String</span><span class="token plain"> lockKey </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"lock:"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">boolean</span><span class="token plain"> locked </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">            locked </span><span class="token operator">=</span><span class="token plain"> stringRedisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setIfAbsent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lockKey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofSeconds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">locked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 3. åŒé‡æ£€æŸ¥</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">                value </span><span class="token operator">=</span><span class="token plain"> redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">                </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 4. ä»æ•°æ®åº“åŠ è½½</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">                value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFromDatabase</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">                </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 5. æ›´æ–°ç¼“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">value </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>36</span><span class=codeLineContent_HA3z><span class="token plain">                    redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">30</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>37</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>38</span><span class=codeLineContent_HA3z><span class="token plain">                    redisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">opsForValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"NULL"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ofMinutes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>39</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>40</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>41</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 6. ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>42</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sleep</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">50</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>43</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getDataWithLock</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>44</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>45</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>46</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>47</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>48</span><span class=codeLineContent_HA3z><span class="token plain">            log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"è·å–æ•°æ®å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>49</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>50</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>51</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// 7. é‡Šæ”¾é”</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>52</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">locked</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>53</span><span class=codeLineContent_HA3z><span class="token plain">                stringRedisTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">delete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">lockKey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>54</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>55</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>56</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>57</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=4-å¼‚æ­¥å¤„ç†æœºåˆ¶>4. å¼‚æ­¥å¤„ç†æœºåˆ¶<a href=#4-å¼‚æ­¥å¤„ç†æœºåˆ¶ class=hash-link aria-label="4. å¼‚æ­¥å¤„ç†æœºåˆ¶çš„ç›´æ¥é“¾æ¥" title="4. å¼‚æ­¥å¤„ç†æœºåˆ¶çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h2>
<p>å¼‚æ­¥å¤„ç†æ˜¯é«˜å¹¶å‘ç³»ç»Ÿæå‡ååé‡çš„é‡è¦æ‰‹æ®µï¼Œé€šè¿‡å°†è€—æ—¶æ“ä½œå¼‚æ­¥åŒ–ï¼Œå¯ä»¥å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ã€‚</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=41-æ¶ˆæ¯é˜Ÿåˆ—>4.1 æ¶ˆæ¯é˜Ÿåˆ—<a href=#41-æ¶ˆæ¯é˜Ÿåˆ— class=hash-link aria-label="4.1 æ¶ˆæ¯é˜Ÿåˆ—çš„ç›´æ¥é“¾æ¥" title="4.1 æ¶ˆæ¯é˜Ÿåˆ—çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥è§£è€¦ç³»ç»Ÿç»„ä»¶ï¼Œå¹³æ»‘æµé‡å³°å€¼ï¼Œæé«˜ç³»ç»Ÿå¯é æ€§ã€‚</p>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">æ¶ˆæ¯ç”Ÿäº§è€…<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">æ¶ˆæ¯æ¶ˆè´¹è€…</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">MessageQueueService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">RabbitTemplate</span><span class="token plain"> rabbitTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">KafkaTemplate</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> kafkaTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// å‘é€æ¶ˆæ¯åˆ°RabbitMQ</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sendToRabbitMQ</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">      rabbitTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">convertAndSend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"exchange"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"routing.key"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// å‘é€æ¶ˆæ¯åˆ°Kafka</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sendToKafka</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">      kafkaTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">send</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¼‚æ­¥å¤„ç†è®¢å•</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">Long</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processOrderAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Order</span><span class="token plain"> order</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. åˆ›å»ºè®¢å•</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">Order</span><span class="token plain"> savedOrder </span><span class="token operator">=</span><span class="token plain"> orderRepository</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">save</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">order</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. å‘é€å¼‚æ­¥æ¶ˆæ¯</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">OrderEvent</span><span class="token plain"> event </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">OrderEvent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">savedOrder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"CREATED"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">      rabbitTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">convertAndSend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"order.exchange"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"order.created"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 3. ç«‹å³è¿”å›è®¢å•ID</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> savedOrder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Component</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">OrderMessageConsumer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@RabbitListener</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">queues </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"order.queue"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">handleOrderCreated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">OrderEvent</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¼‚æ­¥å¤„ç†è®¢å•åˆ›å»ºåçš„ä¸šåŠ¡é€»è¾‘</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"CREATED"</span><span class="token operator">:</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token function" style="color:rgb(80, 250, 123)">processOrderCreated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getOrderId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"PAID"</span><span class="token operator">:</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token function" style="color:rgb(80, 250, 123)">processOrderPaid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getOrderId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"SHIPPED"</span><span class="token operator">:</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token function" style="color:rgb(80, 250, 123)">processOrderShipped</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getOrderId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">break</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">processOrderCreated</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Long</span><span class="token plain"> orderId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¤„ç†è®¢å•åˆ›å»ºé€»è¾‘</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 1. å‘é€ç¡®è®¤é‚®ä»¶</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 2. æ›´æ–°åº“å­˜</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// 3. ç”Ÿæˆç‰©æµå•</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=42-å¼‚æ­¥è°ƒç”¨>4.2 å¼‚æ­¥è°ƒç”¨<a href=#42-å¼‚æ­¥è°ƒç”¨ class=hash-link aria-label="4.2 å¼‚æ­¥è°ƒç”¨çš„ç›´æ¥é“¾æ¥" title="4.2 å¼‚æ­¥è°ƒç”¨çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>å¼‚æ­¥è°ƒç”¨å¯ä»¥é¿å…è¯·æ±‚çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡ï¼Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</p>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">å¼‚æ­¥è°ƒç”¨å®ç°<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">è¶…æ—¶æ§åˆ¶<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">é™çº§å¤„ç†</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">AsyncCallService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ThreadPoolTaskExecutor</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¼‚æ­¥è°ƒç”¨å¤–éƒ¨æœåŠ¡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">ApiResponse</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callExternalServiceAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">supplyAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token comment" style="color:rgb(98, 114, 164)">// è°ƒç”¨å¤–éƒ¨API</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token class-name">RestTemplate</span><span class="token plain"> restTemplate </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">RestTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> restTemplate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getForObject</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">              log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"å¤–éƒ¨æœåŠ¡è°ƒç”¨å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">              </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ERROR"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getMessage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> executor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// æ‰¹é‡å¼‚æ­¥å¤„ç†</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">ApiResponse</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">batchProcessAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> urls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">ApiResponse</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> futures </span><span class="token operator">=</span><span class="token plain"> urls</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">stream</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">this</span><span class="token operator">::</span><span class="token function" style="color:rgb(80, 250, 123)">callExternalServiceAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Collectors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">toList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// ç­‰å¾…æ‰€æœ‰å¼‚æ­¥è°ƒç”¨å®Œæˆ</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">allOf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">futures</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">toArray</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">        </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// æ”¶é›†ç»“æœ</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> futures</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">stream</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function" style="color:rgb(80, 250, 123)">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Collectors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">toList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callWithTimeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">long</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callExternalServiceAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">orTimeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">timeout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">TimeUnit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">MILLISECONDS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">exceptionally</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ex </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ex </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">instanceof</span><span class="token plain"> </span><span class="token class-name">TimeoutException</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">                    log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"è°ƒç”¨è¶…æ—¶"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"TIMEOUT"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"è¯·æ±‚è¶…æ—¶"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">                    log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"è°ƒç”¨å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ERROR"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getMessage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">        log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"è·å–å¼‚æ­¥ç»“æœå¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"ERROR"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getMessage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">CompletableFuture</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">ApiResponse</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callWithFallback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">callExternalServiceAsync</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">thenApply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¤„ç†æˆåŠŸå“åº”</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"SUCCESS"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">equals</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getStatus</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// å¯¹é”™è¯¯å“åº”è¿›è¡Œè½¬æ¢</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">enhanceErrorResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">exceptionally</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ex </span><span class="token operator">-></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">            log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é™çº§å“åº”"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> ex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFallbackResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain" style=display:inline-block></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getFallbackResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// æä¾›é™çº§å“åº”</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ApiResponse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"FALLBACK"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ä½¿ç”¨é™çº§å“åº”"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=5-æ•°æ®åº“ä¼˜åŒ–>5. æ•°æ®åº“ä¼˜åŒ–<a href=#5-æ•°æ®åº“ä¼˜åŒ– class=hash-link aria-label="5. æ•°æ®åº“ä¼˜åŒ–çš„ç›´æ¥é“¾æ¥" title="5. æ•°æ®åº“ä¼˜åŒ–çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h2>
<p>æ•°æ®åº“å¾€å¾€æ˜¯é«˜å¹¶å‘ç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–æ•°æ®åº“è®¿é—®å¯¹æå‡ç³»ç»Ÿæ•´ä½“æ€§èƒ½è‡³å…³é‡è¦ã€‚</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=51-è¯»å†™åˆ†ç¦»>5.1 è¯»å†™åˆ†ç¦»<a href=#51-è¯»å†™åˆ†ç¦» class=hash-link aria-label="5.1 è¯»å†™åˆ†ç¦»çš„ç›´æ¥é“¾æ¥" title="5.1 è¯»å†™åˆ†ç¦»çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<!-- -->
<div class=card><div class=card__body><p>è¯»å†™åˆ†ç¦»çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š<ol>
<li class=""><strong>è´Ÿè½½åˆ†æ‹…</strong>ï¼šå†™æ“ä½œé›†ä¸­åœ¨ä¸»åº“ï¼Œè¯»æ“ä½œåˆ†æ•£åˆ°å¤šä¸ªä»åº“</li>
<li class=""><strong>æ°´å¹³æ‰©å±•</strong>ï¼šå¯ä»¥é€šè¿‡å¢åŠ ä»åº“æå‡è¯»æ€§èƒ½</li>
<li class=""><strong>é«˜å¯ç”¨æ€§</strong>ï¼šä¸»åº“æ•…éšœæ—¶å¯ä»¥æå‡ä»åº“ä¸ºä¸»åº“</li>
<li class=""><strong>è¯»å†™å¹¶è¡Œ</strong>ï¼šè¯»å†™æ“ä½œå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œæé«˜ååé‡</li>
</ol></div></div>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">è¯»å†™åˆ†ç¦»é…ç½®<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">æ•°æ®æºè·¯ç”±<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">AOPåˆ‡é¢</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Configuration</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">DataSourceConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Bean</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Primary</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@ConfigurationProperties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"spring.datasource.master"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">DataSource</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">masterDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">DataSourceBuilder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Bean</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@ConfigurationProperties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"spring.datasource.slave"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">DataSource</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">slaveDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">DataSourceBuilder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">build</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Bean</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">DataSource</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">routingDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">RoutingDataSource</span><span class="token plain"> routingDataSource </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">RoutingDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">Map</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token generics"> </span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> targetDataSources </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">      targetDataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">put</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"master"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">masterDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">      targetDataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">put</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"slave"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">slaveDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      routingDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setTargetDataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">targetDataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">      routingDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setDefaultTargetDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">masterDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> routingDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token comment" style="color:rgb(98, 114, 164)">// æ•°æ®æºè·¯ç”±</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">RoutingDataSource</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name">AbstractRoutingDataSource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Override</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">protected</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">determineCurrentLookupKey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">DataSourceContextHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getDataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain" style=display:inline-block></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// æ•°æ®æºä¸Šä¸‹æ–‡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">DataSourceContextHolder</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">final</span><span class="token plain"> </span><span class="token class-name">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">String</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> contextHolder </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">ThreadLocal</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">setDataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> dataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">      contextHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">set</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getDataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> contextHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">clearDataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">      contextHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token comment" style="color:rgb(98, 114, 164)">// AOPåˆ‡é¢</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Aspect</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Component</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">DataSourceAspect</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Around</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"@annotation(readOnly)"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">around</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">ProceedingJoinPoint</span><span class="token plain"> point</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">ReadOnly</span><span class="token plain"> readOnly</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">throws</span><span class="token plain"> </span><span class="token class-name">Throwable</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">DataSourceContextHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setDataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"slave"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> point</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">proceed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">          </span><span class="token class-name">DataSourceContextHolder</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">clearDataSourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain" style=display:inline-block></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// åªè¯»æ³¨è§£</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">ElementType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">METHOD</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Retention</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token constant" style="color:rgb(189, 147, 249)">RUNTIME</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@interface</span><span class="token plain"> </span><span class="token class-name">ReadOnly</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=52-åˆ†åº“åˆ†è¡¨>5.2 åˆ†åº“åˆ†è¡¨<a href=#52-åˆ†åº“åˆ†è¡¨ class=hash-link aria-label="5.2 åˆ†åº“åˆ†è¡¨çš„ç›´æ¥é“¾æ¥" title="5.2 åˆ†åº“åˆ†è¡¨çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h3>
<p>åˆ†åº“åˆ†è¡¨æ˜¯è§£å†³æ•°æ®åº“å•è¡¨æ•°æ®é‡è¿‡å¤§é—®é¢˜çš„æœ‰æ•ˆæ–¹æ¡ˆï¼Œé€šè¿‡æ°´å¹³æˆ–å‚ç›´æ‹†åˆ†ï¼Œå¯ä»¥æå‡æ•°æ®åº“çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p>
<!-- -->
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role=tablist aria-orientation=horizontal class=tabs><li role=tab tabindex=0 aria-selected=true class="tabs__item tabItem_LNqP tabs__item--active">åˆ†ç‰‡ç­–ç•¥<li role=tab tabindex=-1 aria-selected=false class="tabs__item tabItem_LNqP">åˆ†ç‰‡æœåŠ¡</ul><div class=margin-top--md><div role=tabpanel class=tabItem_Ymn6><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Component</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ShardingStrategy</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token generics class-name">DataSource</span><span class="token generics punctuation" style="color:rgb(248, 248, 242)">></span><span class="token plain"> dataSources </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Arrays</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">asList</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">      dataSource1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dataSource2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dataSource3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> dataSource4</span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// æ ¹æ®ç”¨æˆ·IDåˆ†åº“</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">DataSource</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getDataSourceByUserId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Long</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> dbIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">userId </span><span class="token operator">%</span><span class="token plain"> dataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> dataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dbIndex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// æ ¹æ®ç”¨æˆ·IDåˆ†è¡¨</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getTableNameByUserId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> baseTableName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Long</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> tableIndex </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">userId </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> baseTableName </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"_"</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> tableIndex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// ä¸€è‡´æ€§å“ˆå¸Œåˆ†ç‰‡</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">DataSource</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getDataSourceByHash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">String</span><span class="token plain"> key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> hash </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">abs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">hashCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">int</span><span class="token plain"> index </span><span class="token operator">=</span><span class="token plain"> hash </span><span class="token operator">%</span><span class="token plain"> dataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> dataSources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div><div role=tabpanel class=tabItem_Ymn6 hidden><div class="codeBlockContainer_X7hc language-java"><div class=codeBlockHeader_viex><div class=codeBlockControls_mxj2><span class="codeDot_PWGG codeDotRed_ANoD"></span><span class="codeDot_PWGG codeDotYellow_HH1J"></span><span class="codeDot_PWGG codeDotGreen_RM6U"></span></div><div class=codeBlockMeta_lRk3><div class=codeBlockLanguage_Vqu6><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 384 512" class=langIcon_gX7_><path fill=currentColor d="M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"/></svg><span>java</span></div><button type=button aria-label=å¤åˆ¶ä»£ç  class=copyButton_H_xL><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor class=copyButtonIcon_f_OW><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg><span>å¤åˆ¶</span></button></div></div><div class=codeBlockContent_vqWU><pre class="prism-code language-java codeBlock_wPnj" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_fQUY><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>1</span><span class=codeLineContent_HA3z><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Service</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>2</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">class</span><span class="token plain"> </span><span class="token class-name">ShardingService</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>3</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>4</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token annotation punctuation" style="color:rgb(248, 248, 242)">@Autowired</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>5</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">ShardingStrategy</span><span class="token plain"> shardingStrategy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>6</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>7</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">getUserById</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Long</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>8</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">DataSource</span><span class="token plain"> dataSource </span><span class="token operator">=</span><span class="token plain"> shardingStrategy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getDataSourceByUserId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>9</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token class-name">String</span><span class="token plain"> tableName </span><span class="token operator">=</span><span class="token plain"> shardingStrategy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getTableNameByUserId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"users"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>10</span><span class=codeLineContent_HA3z><span class="token plain">      </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>11</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token comment" style="color:rgb(98, 114, 164)">// ä½¿ç”¨æŒ‡å®šçš„æ•°æ®æºå’Œè¡¨åæŸ¥è¯¢</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>12</span><span class=codeLineContent_HA3z><span class="token plain">      </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">queryUserFromDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> tableName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>13</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>14</span><span class=codeLineContent_HA3z><span class="token plain">  </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>15</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">private</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">queryUserFromDataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">DataSource</span><span class="token plain"> dataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> tableName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Long</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>16</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Connection</span><span class="token plain"> conn </span><span class="token operator">=</span><span class="token plain"> dataSource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getConnection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>17</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token class-name">PreparedStatement</span><span class="token plain"> stmt </span><span class="token operator">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">prepareStatement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>18</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token string" style="color:rgb(255, 121, 198)">"SELECT * FROM "</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> tableName </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">" WHERE id = ?"</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>19</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>20</span><span class=codeLineContent_HA3z><span class="token plain">            stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setLong</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>21</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token class-name">ResultSet</span><span class="token plain"> rs </span><span class="token operator">=</span><span class="token plain"> stmt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">executeQuery</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>22</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>23</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">next</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>24</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token class-name">User</span><span class="token plain"> user </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">User</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>25</span><span class=codeLineContent_HA3z><span class="token plain">                user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getLong</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"id"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>26</span><span class=codeLineContent_HA3z><span class="token plain">                user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"name"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>27</span><span class=codeLineContent_HA3z><span class="token plain">                user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">setEmail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">getString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"email"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>28</span><span class=codeLineContent_HA3z><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> user</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>29</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>30</span><span class=codeLineContent_HA3z><span class="token plain">            </span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>31</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">null</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>32</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">SQLException</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>33</span><span class=codeLineContent_HA3z><span class="token plain">            log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"æŸ¥è¯¢ç”¨æˆ·å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>34</span><span class=codeLineContent_HA3z><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token class-name">RuntimeException</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"æŸ¥è¯¢ç”¨æˆ·å¤±è´¥"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>35</span><span class=codeLineContent_HA3z><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>36</span><span class=codeLineContent_HA3z><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span></div><div class="token-line codeLine_fSta" style=color:#F8F8F2><span class=codeLineNumber_x9bH>37</span><span class=codeLineContent_HA3z><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></div></code></pre></div></div></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 16 16"><path fill-rule=evenodd d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"/></svg></span>åˆ†åº“åˆ†è¡¨æ³¨æ„äº‹é¡¹</div><div class=admonitionContent_BuS1><ol>
<li class=""><strong>åˆ†ç‰‡é”®é€‰æ‹©</strong>ï¼šé€‰æ‹©åˆé€‚çš„åˆ†ç‰‡é”®å¯¹æ€§èƒ½è‡³å…³é‡è¦</li>
<li class=""><strong>è·¨åº“æŸ¥è¯¢</strong>ï¼šè·¨åº“æŸ¥è¯¢ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œåº”å°½é‡é¿å…</li>
<li class=""><strong>äº‹åŠ¡å¤„ç†</strong>ï¼šè·¨åº“äº‹åŠ¡éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†</li>
<li class=""><strong>æ•°æ®æ‰©å®¹</strong>ï¼šéšç€æ•°æ®å¢é•¿ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ†ç‰‡</li>
<li class=""><strong>æ•°æ®è¿ç§»</strong>ï¼šå†å²æ•°æ®è¿ç§»éœ€è¦åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œ</li>
</ol></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=6-é¢è¯•é¢˜ç²¾é€‰>6. é¢è¯•é¢˜ç²¾é€‰<a href=#6-é¢è¯•é¢˜ç²¾é€‰ class=hash-link aria-label="6. é¢è¯•é¢˜ç²¾é€‰çš„ç›´æ¥é“¾æ¥" title="6. é¢è¯•é¢˜ç²¾é€‰çš„ç›´æ¥é“¾æ¥" translate=no>â€‹</a></h2>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary><strong>Q: ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Ÿå¦‚ä½•è®¾è®¡é«˜å¹¶å‘ç³»ç»Ÿï¼Ÿ</strong></summary><div><div class=collapsibleContent_i85q><p><strong>A:</strong> é«˜å¹¶å‘æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚çš„èƒ½åŠ›ã€‚è®¾è®¡é«˜å¹¶å‘ç³»ç»Ÿçš„æ–¹æ³•ï¼š<ul>
<li class=""><strong>æ¶æ„å±‚é¢</strong>ï¼šé‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„ã€å¾®æœåŠ¡æ¶æ„</li>
<li class=""><strong>ç¼“å­˜å±‚é¢</strong>ï¼šå¤šçº§ç¼“å­˜ã€ç¼“å­˜é¢„çƒ­ã€ç¼“å­˜æ›´æ–°ç­–ç•¥</li>
<li class=""><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€å¼‚æ­¥è°ƒç”¨ã€äº‹ä»¶é©±åŠ¨</li>
<li class=""><strong>æ•°æ®åº“ä¼˜åŒ–</strong>ï¼šè¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ã€ç´¢å¼•ä¼˜åŒ–</li>
<li class=""><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåº”ç”¨å±‚è´Ÿè½½å‡è¡¡ã€æ•°æ®åº“è´Ÿè½½å‡è¡¡</li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary><strong>Q: å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜ï¼Ÿ</strong></summary><div><div class=collapsibleContent_i85q><p><strong>A:</strong> è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ³•ï¼š<ul>
<li class=""><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼šå¿«é€Ÿåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</li>
<li class=""><strong>ç©ºå€¼ç¼“å­˜</strong>ï¼šå°†ç©ºç»“æœä¹Ÿç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</li>
<li class=""><strong>å‚æ•°æ ¡éªŒ</strong>ï¼šå¯¹è¯·æ±‚å‚æ•°è¿›è¡Œä¸¥æ ¼æ ¡éªŒ</li>
<li class=""><strong>é™æµä¿æŠ¤</strong>ï¼šå¯¹å¼‚å¸¸è¯·æ±‚è¿›è¡Œé™æµ</li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary><strong>Q: å¦‚ä½•è®¾è®¡ä¸€ä¸ªç§’æ€ç³»ç»Ÿï¼Ÿ</strong></summary><div><div class=collapsibleContent_i85q><p><strong>A:</strong> ç§’æ€ç³»ç»Ÿè®¾è®¡è¦ç‚¹ï¼š<ul>
<li class=""><strong>å‰ç«¯ä¼˜åŒ–</strong>ï¼šé¡µé¢é™æ€åŒ–ã€CDNåŠ é€Ÿã€æŒ‰é’®æ§åˆ¶</li>
<li class=""><strong>æ¥å£ä¼˜åŒ–</strong>ï¼šé™æµã€å¼‚æ­¥å¤„ç†ã€ç¼“å­˜é¢„çƒ­</li>
<li class=""><strong>åº“å­˜æ§åˆ¶</strong>ï¼šé¢„æ‰£åº“å­˜ã€åº“å­˜é”å®šã€è¶…æ—¶é‡Šæ”¾</li>
<li class=""><strong>è®¢å•å¤„ç†</strong>ï¼šå¼‚æ­¥åˆ›å»ºè®¢å•ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“ä¼˜åŒ–</li>
<li class=""><strong>é˜²åˆ·æœºåˆ¶</strong>ï¼šç”¨æˆ·é™è´­ã€IPé™æµã€éªŒè¯ç </li>
</ul></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary><strong>Q: å¦‚ä½•å¤„ç†é«˜å¹¶å‘ä¸‹çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</strong></summary><div><div class=collapsibleContent_i85q><p><strong>A:</strong> æ•°æ®ä¸€è‡´æ€§å¤„ç†æ–¹æ³•ï¼š<ul>
<li class=""><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼š2PCã€3PCã€TCCã€Saga</li>
<li class=""><strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€è¡¥å¿æœºåˆ¶ã€å¹‚ç­‰æ€§</li>
<li class=""><strong>ä¹è§‚é”</strong>ï¼šç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ã€CASæ“ä½œ</li>
<li class=""><strong>æ‚²è§‚é”</strong>ï¼šæ•°æ®åº“é”ã€åˆ†å¸ƒå¼é”ã€Redisé”</li>
</ul></div></div></details>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>é«˜å¹¶å‘å­¦ä¹ è¦ç‚¹</div><div class=admonitionContent_BuS1><ol>
<li class=""><strong>ç†è§£å¹¶å‘æ¨¡å‹</strong>ï¼šæŒæ¡çº¿ç¨‹æ¨¡å‹ã€å¼‚æ­¥ç¼–ç¨‹ã€å¹¶å‘æ§åˆ¶</li>
<li class=""><strong>æŒæ¡ç¼“å­˜ç­–ç•¥</strong>ï¼šå­¦ä¼šå¤šçº§ç¼“å­˜ã€ç¼“å­˜æ›´æ–°ã€ç¼“å­˜ç©¿é€é˜²æŠ¤</li>
<li class=""><strong>ç†Ÿæ‚‰å¼‚æ­¥å¤„ç†</strong>ï¼šäº†è§£æ¶ˆæ¯é˜Ÿåˆ—ã€å¼‚æ­¥è°ƒç”¨ã€äº‹ä»¶é©±åŠ¨</li>
<li class=""><strong>å­¦ä¼šæ•°æ®åº“ä¼˜åŒ–</strong>ï¼šæŒæ¡è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ã€ç´¢å¼•ä¼˜åŒ–</li>
<li class=""><strong>äº†è§£è´Ÿè½½å‡è¡¡</strong>ï¼šå­¦ä¼šè´Ÿè½½å‡è¡¡ç®—æ³•ã€å¥åº·æ£€æŸ¥ã€æ•…éšœè½¬ç§»</li>
</ol></div></div>
<hr/>
<p>é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒæ¦‚å¿µã€æ¶æ„æ¨¡å¼å’Œä¼˜åŒ–ç­–ç•¥ã€‚é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡æ˜¯æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨ç³»ç»Ÿçš„é‡è¦æŠ€èƒ½ï¼ŒæŒæ¡è¿™äº›æŠ€æœ¯å¯ä»¥å¸®åŠ©ä½ è®¾è®¡å‡ºèƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚çš„ç³»ç»Ÿã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåˆç†è¿ç”¨è¿™äº›æŠ€æœ¯å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œç”¨æˆ·ä½“éªŒã€‚<div class=docFooter_IWbN><div class=commentsSection_qKMH><div class=commentsContainer_DyUU><h2 class=commentsTitle_lsB6>è¯„è®º</h2><div class=commentsWrapper_DNkH></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href=https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/system-design/high-concurrency.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>æœ€å<!-- -->ç”± <b>Laby</b> <!-- -->äº <b><time datetime=2025-08-07T00:00:00.000Z itemprop=dateModified>2025å¹´8æœˆ7æ—¥</time></b> <!-- -->æ›´æ–°</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label=æ–‡ä»¶é€‰é¡¹å¡><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/backend/system-design/high-performance><div class=pagination-nav__sublabel>ä¸Šä¸€é¡µ</div><div class=pagination-nav__label>é«˜æ€§èƒ½ç³»ç»Ÿè®¾è®¡</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/backend/system-design/circuit-breaking><div class=pagination-nav__sublabel>ä¸‹ä¸€é¡µ</div><div class=pagination-nav__label>ç†”æ–­å™¨æ¨¡å¼è®¾è®¡</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#1-å¹¶å‘æ¨¡å‹åŸºç¡€ class="table-of-contents__link toc-highlight">1. å¹¶å‘æ¨¡å‹åŸºç¡€</a><ul><li><a href=#11-å¹¶å‘ä¸å¹¶è¡Œ class="table-of-contents__link toc-highlight">1.1 å¹¶å‘ä¸å¹¶è¡Œ</a><li><a href=#12-çº¿ç¨‹æ¨¡å‹ class="table-of-contents__link toc-highlight">1.2 çº¿ç¨‹æ¨¡å‹</a></ul><li><a href=#2-é«˜å¹¶å‘æ¶æ„è®¾è®¡ class="table-of-contents__link toc-highlight">2. é«˜å¹¶å‘æ¶æ„è®¾è®¡</a><ul><li><a href=#21-åˆ†å±‚æ¶æ„ class="table-of-contents__link toc-highlight">2.1 åˆ†å±‚æ¶æ„</a><li><a href=#22-å¾®æœåŠ¡æ¶æ„ class="table-of-contents__link toc-highlight">2.2 å¾®æœåŠ¡æ¶æ„</a></ul><li><a href=#3-ç¼“å­˜ä¼˜åŒ–ç­–ç•¥ class="table-of-contents__link toc-highlight">3. ç¼“å­˜ä¼˜åŒ–ç­–ç•¥</a><ul><li><a href=#31-å¤šçº§ç¼“å­˜æ¶æ„ class="table-of-contents__link toc-highlight">3.1 å¤šçº§ç¼“å­˜æ¶æ„</a><li><a href=#32-ç¼“å­˜æ›´æ–°ç­–ç•¥ class="table-of-contents__link toc-highlight">3.2 ç¼“å­˜æ›´æ–°ç­–ç•¥</a><li><a href=#33-ç¼“å­˜ç©¿é€é˜²æŠ¤ class="table-of-contents__link toc-highlight">3.3 ç¼“å­˜ç©¿é€é˜²æŠ¤</a></ul><li><a href=#4-å¼‚æ­¥å¤„ç†æœºåˆ¶ class="table-of-contents__link toc-highlight">4. å¼‚æ­¥å¤„ç†æœºåˆ¶</a><ul><li><a href=#41-æ¶ˆæ¯é˜Ÿåˆ— class="table-of-contents__link toc-highlight">4.1 æ¶ˆæ¯é˜Ÿåˆ—</a><li><a href=#42-å¼‚æ­¥è°ƒç”¨ class="table-of-contents__link toc-highlight">4.2 å¼‚æ­¥è°ƒç”¨</a></ul><li><a href=#5-æ•°æ®åº“ä¼˜åŒ– class="table-of-contents__link toc-highlight">5. æ•°æ®åº“ä¼˜åŒ–</a><ul><li><a href=#51-è¯»å†™åˆ†ç¦» class="table-of-contents__link toc-highlight">5.1 è¯»å†™åˆ†ç¦»</a><li><a href=#52-åˆ†åº“åˆ†è¡¨ class="table-of-contents__link toc-highlight">5.2 åˆ†åº“åˆ†è¡¨</a></ul><li><a href=#6-é¢è¯•é¢˜ç²¾é€‰ class="table-of-contents__link toc-highlight">6. é¢è¯•é¢˜ç²¾é€‰</a></ul></div></div></div></div></main></div></div></div><footer class=footer_xBL4><div class=container><div class=footerContent_QbTG><div class=footerSection_NcK9><div class=profileSection_obHN><img src=/img/head.jpg alt=Laby class=footerAvatar_Tac4 /><div class=profileInfo_hxzo><h3 class=profileName_hl7T>Laby</h3><p class=profileDesc_qTmn>çƒ­çˆ±ä¸€åˆ‡æ–°é²œçš„æŠ€æœ¯ï¼Œä¸æ­¢äºä»£ç çš„å…¨æ ˆå·¥ç¨‹å¸ˆã€‚ç”¨æŠ€æœ¯åˆ›é€ ä»·å€¼ï¼Œç”¨ä»£ç æ”¹å˜ä¸–ç•Œã€‚</div></div></div><div class=footerSection_NcK9><h4 class=sectionTitle_wYQ0>å¿«é€Ÿé“¾æ¥</h4><ul class=linkList_QvGs><li><a href=/>é¦–é¡µ</a><li><a href=/blog>åšå®¢</a><li><a href=/projects>é¡¹ç›®</a><li><a href=/contact>è”ç³»æˆ‘</a><li><a href=/about>å…³äº</a></ul></div><div class=footerSection_NcK9><h4 class=sectionTitle_wYQ0>è”ç³»æ–¹å¼</h4><ul class=contactList_FX1g><li class=contactItem_xQY_><svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg><span>1521170425@qq.com</span><li class=contactItem_xQY_><svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg><span>13261915710</span><li class=contactItem_xQY_><svg viewBox="0 0 24 24" width=16 height=16 fill=currentColor><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg><span>åŒ—äº¬</span></ul><div class=socialLinks_pCXT><a href=https://github.com/MasterLiu93 target=_blank rel="noopener noreferrer" class=socialIcon_oRq4><svg viewBox="0 0 24 24" width=20 height=20 fill=currentColor><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg></a><a href=https://twitter.com target=_blank rel="noopener noreferrer" class=socialIcon_oRq4><svg viewBox="0 0 24 24" width=20 height=20 fill=currentColor><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a><a href=https://linkedin.com target=_blank rel="noopener noreferrer" class=socialIcon_oRq4><svg viewBox="0 0 24 24" width=20 height=20 fill=currentColor><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg></a></div></div><div class=footerSection_NcK9><h4 class=sectionTitle_wYQ0>å¾®ä¿¡</h4><div class=qrcodeWrapper_Hqnk><img src=/img/user/WeChat.png alt="WeChat QR Code" class=qrcode_e_MU /><p class=qrcodeText_Hzwk>æ‰«ç æ·»åŠ å¥½å‹</div></div></div><div class=footerBottom_SMHg><div class=copyright_g70o><p>Copyright Â© <!-- -->2025<!-- --> Labyçš„åšå®¢. Built with<!-- --> <a href=https://docusaurus.io target=_blank rel="noopener noreferrer">Docusaurus</a>.</div></div></div></footer><button class=floatingButton_SY9y aria-label="æ‰“å¼€ AI åŠ©æ‰‹"><span role=img aria-label=robot class="anticon anticon-robot icon_PXiV"><svg viewBox="64 64 896 896" focusable=false data-icon=robot width=1em height=1em fill=currentColor aria-hidden=true><path d="M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"/></svg></span><span class=badge_DEfZ>AI</span></button></div></body>