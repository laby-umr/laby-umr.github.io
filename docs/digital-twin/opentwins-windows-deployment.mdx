---
sidebar_position: 7
title: OpenTwins Windows æœ¬åœ°éƒ¨ç½²å®æˆ˜æŒ‡å—
description: OpenTwins æ•°å­—å­ªç”Ÿå¹³å° Windows æœ¬åœ°ç¯å¢ƒå®Œæ•´éƒ¨ç½²å®æˆ˜è®°å½•
tags: [æ•°å­—å­ªç”Ÿ, OpenTwins, Windowséƒ¨ç½², æœ¬åœ°éƒ¨ç½², Kubernetes, Minikube, Docker]
---

# OpenTwins Windows æœ¬åœ°éƒ¨ç½²å®æˆ˜æŒ‡å—

æœ¬æ–‡æ¡£è®°å½•äº†åœ¨ Windows ç¯å¢ƒä¸‹æˆåŠŸéƒ¨ç½² OpenTwins æ•°å­—å­ªç”Ÿå¹³å°çš„å®Œæ•´è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¿…è¦çš„å·¥å…·å®‰è£…ã€é…ç½®å’Œæ•…éšœæ’æŸ¥ã€‚

## ä¸€ã€éƒ¨ç½²æ¦‚è¿°

### 1.1 OpenTwins ç®€ä»‹

OpenTwins æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°å­—å­ªç”Ÿå¹³å°ï¼ŒåŸºäº Eclipse Ditto æ„å»ºï¼Œæä¾›äº†å®Œæ•´çš„æ•°å­—å­ªç”Ÿç®¡ç†ã€æ•°æ®é‡‡é›†ã€å­˜å‚¨å’Œå¯è§†åŒ–åŠŸèƒ½ã€‚

### 1.2 éƒ¨ç½²æ¶æ„

```
Windows æœ¬åœ°ç¯å¢ƒ
â”œâ”€â”€ Docker Desktopï¼ˆå®¹å™¨è¿è¡Œæ—¶ï¼‰
â”œâ”€â”€ Minikubeï¼ˆæœ¬åœ° Kubernetes é›†ç¾¤ï¼‰
â”œâ”€â”€ Helm 3ï¼ˆåŒ…ç®¡ç†å™¨ï¼‰
â””â”€â”€ OpenTwins å¹³å°ç»„ä»¶
    â”œâ”€â”€ Eclipse Dittoï¼ˆæ•°å­—å­ªç”Ÿæ ¸å¿ƒå¼•æ“ï¼‰
    â”œâ”€â”€ Mosquittoï¼ˆMQTT æ¶ˆæ¯ä»£ç†ï¼‰
    â”œâ”€â”€ InfluxDBï¼ˆæ—¶åºæ•°æ®åº“ï¼‰
    â”œâ”€â”€ Grafanaï¼ˆæ•°æ®å¯è§†åŒ–ï¼‰
    â””â”€â”€ MongoDBï¼ˆæ•°æ®å­˜å‚¨ï¼‰
```

### 1.3 ç³»ç»Ÿè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚
- **CPU**: 4 æ ¸å¿ƒæˆ–ä»¥ä¸Šï¼ˆæ¨è 8 æ ¸å¿ƒï¼‰
- **å†…å­˜**: 8GB RAMï¼ˆæœ€ä½ï¼‰ï¼Œæ¨è 16GB
- **ç£ç›˜**: è‡³å°‘ 40GB å¯ç”¨ç©ºé—´
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 Proã€Enterprise æˆ– Education

#### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Windows 10 (1903+) æˆ– Windows 11
- **PowerShell**: 5.1 æˆ–ä»¥ä¸Š
- **è™šæ‹ŸåŒ–**: å¯ç”¨ Hyper-V æˆ– WSL 2

:::warning é‡è¦æç¤º
æœ¬æ¬¡éƒ¨ç½²ä½¿ç”¨ Docker Desktop + WSL 2 ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼ŒMinikube ä½œä¸º Kubernetes é›†ç¾¤ã€‚
:::

## äºŒã€ç¯å¢ƒå‡†å¤‡

### 2.1 å®‰è£… Docker Desktop

#### ä¸‹è½½å®‰è£…

1. è®¿é—® [Docker Desktop å®˜ç½‘](https://www.docker.com/products/docker-desktop/)
2. ä¸‹è½½ Windows ç‰ˆæœ¬å®‰è£…ç¨‹åº
3. è¿è¡Œå®‰è£…ç¨‹åºå¹¶æŒ‰ç…§å‘å¯¼å®Œæˆå®‰è£…
4. é‡å¯è®¡ç®—æœº

#### é…ç½® Docker Desktop

å¯åŠ¨ Docker Desktop åï¼Œè¿›è¡Œä»¥ä¸‹é…ç½®ï¼š

1. **é€‰æ‹©åç«¯**ï¼š
   - è®¾ç½® â†’ General â†’ Use WSL 2 based engineï¼ˆæ¨èï¼‰

2. **èµ„æºé…ç½®**ï¼š
   - è®¾ç½® â†’ Resources â†’ Advanced
   - **CPUs**: è‡³å°‘ 4 æ ¸å¿ƒ
   - **Memory**: è‡³å°‘ 8GB
   - **Disk image size**: è‡³å°‘ 60GB

#### éªŒè¯ Docker å®‰è£…

æ‰“å¼€ PowerShellï¼š

```powershell
# æ£€æŸ¥ Docker ç‰ˆæœ¬
docker --version
# è¾“å‡ºç¤ºä¾‹: Docker version 28.5.1, build e180ab8

# è¿è¡Œæµ‹è¯•å®¹å™¨
docker run hello-world

# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps
```

### 2.2 å®‰è£… kubectl

kubectl å·²ç»éš Docker Desktop å®‰è£…ï¼ŒéªŒè¯ç‰ˆæœ¬ï¼š

```powershell
kubectl version --client
# è¾“å‡ºç¤ºä¾‹: Client Version: v1.34.1
```

### 2.3 å®‰è£… Chocolateyï¼ˆå¯é€‰ä½†æ¨èï¼‰

Chocolatey æ˜¯ Windows çš„åŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥ç®€åŒ–åç»­å·¥å…·çš„å®‰è£…ã€‚

ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShellï¼š

```powershell
Set-ExecutionPolicy Bypass -Scope Process -Force
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
```

éªŒè¯å®‰è£…ï¼š

```powershell
choco --version
# è¾“å‡ºç¤ºä¾‹: 2.5.1
```

### 2.4 å®‰è£… Helm

ä½¿ç”¨ Chocolatey å®‰è£…ï¼š

```powershell
choco install kubernetes-helm -y
```

éªŒè¯å®‰è£…ï¼š

```powershell
helm version
# è¾“å‡ºç¤ºä¾‹: version.BuildInfo{Version:"v3.18.6"...}
```

### 2.5 å®‰è£… Minikube

ä½¿ç”¨ Chocolatey å®‰è£…ï¼š

```powershell
choco install minikube -y
```

éªŒè¯å®‰è£…ï¼š

```powershell
minikube version
# è¾“å‡ºç¤ºä¾‹: minikube version: v1.37.0
```

## ä¸‰ã€éƒ¨ç½² Kubernetes é›†ç¾¤

### 3.1 å¯åŠ¨ Minikube

æ‰“å¼€ PowerShellï¼ˆå»ºè®®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰ï¼š

```powershell
# å¯åŠ¨ Minikube é›†ç¾¤ï¼ˆä½¿ç”¨ Docker é©±åŠ¨ï¼‰
minikube start `
  --cpus 4 `
  --memory 8192 `
  --disk-size 40gb `
  --driver=docker
```

:::tip å¯åŠ¨æ—¶é—´
é¦–æ¬¡å¯åŠ¨ Minikube éœ€è¦ä¸‹è½½ Kubernetes é•œåƒï¼Œå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
:::

é¢„æœŸè¾“å‡ºï¼š

```
* Microsoft Windows 11 Pro 10.0.26100 ä¸Šçš„ minikube v1.37.0
* æ ¹æ®ç”¨æˆ·é…ç½®ä½¿ç”¨ docker é©±åŠ¨ç¨‹åº
* æ­£åœ¨æ‹‰å–åŸºç¡€é•œåƒ v0.0.48 ...
* æ­£åœ¨ä¸‹è½½ Kubernetes v1.34.0 çš„é¢„åŠ è½½æ–‡ä»¶...
* å¯ç”¨æ’ä»¶ï¼š storage-provisioner, default-storageclass
* å®Œæˆï¼kubectl ç°åœ¨å·²é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨"minikube"é›†ç¾¤å’Œ"default"å‘½åç©ºé—´
```

### 3.2 éªŒè¯é›†ç¾¤çŠ¶æ€

```powershell
# é…ç½® kubectl ä½¿ç”¨ minikube ä¸Šä¸‹æ–‡
kubectl config use-context minikube

# éªŒè¯é›†ç¾¤è¿æ¥
kubectl cluster-info
# è¾“å‡º: Kubernetes control plane is running at https://127.0.0.1:xxxxx

# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
kubectl get nodes
# è¾“å‡º:
# NAME       STATUS   ROLES           AGE   VERSION
# minikube   Ready    control-plane   2m    v1.34.0
```

### 3.3 éªŒè¯é›†ç¾¤åŠŸèƒ½

```powershell
# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´
kubectl get namespaces

# æŸ¥çœ‹ç³»ç»Ÿ Pod
kubectl get pods -n kube-system

# æŸ¥çœ‹æœåŠ¡
kubectl get services
```

## å››ã€éƒ¨ç½² OpenTwins

### 4.1 æ·»åŠ  Helm ä»“åº“

```powershell
# æ·»åŠ  ERTIS Helm ä»“åº“
helm repo add ertis https://ertis-research.github.io/Helm-charts/

# æ›´æ–°ä»“åº“
helm repo update

# æŸ¥çœ‹ OpenTwins Chart ä¿¡æ¯
helm search repo opentwins
```

é¢„æœŸè¾“å‡ºï¼š

```
NAME                       	CHART VERSION	APP VERSION	DESCRIPTION
ertis/OpenTwins            	0.5.23       	0.5.0      	Esta es una plataforma de codigo abierto...
```

### 4.2 å®‰è£… OpenTwins

```powershell
# å®‰è£… OpenTwinsï¼ˆæ¨èé…ç½®ï¼‰
helm upgrade --install opentwins ertis/OpenTwins `
  --wait `
  --timeout 20m `
  --dependency-update
```

:::info å®‰è£…è¯´æ˜
- `--wait`: ç­‰å¾…æ‰€æœ‰ Pod å°±ç»ª
- `--timeout 20m`: è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 20 åˆ†é’Ÿï¼ˆé¦–æ¬¡å®‰è£…éœ€è¦æ‹‰å–é•œåƒï¼‰
- `--dependency-update`: è‡ªåŠ¨æ›´æ–°ä¾èµ–çš„ Chart
:::

### 4.3 ç›‘æ§éƒ¨ç½²è¿›åº¦

åœ¨å¦ä¸€ä¸ª PowerShell çª—å£ä¸­è¿è¡Œï¼š

```powershell
# å®æ—¶æŸ¥çœ‹æ‰€æœ‰ Pod çŠ¶æ€
kubectl get pods -w
```

æˆ–è€…å®šæœŸæ£€æŸ¥ï¼š

```powershell
# æŸ¥çœ‹æ‰€æœ‰ Pod çŠ¶æ€
kubectl get pods

# æŸ¥çœ‹ç‰¹å®š Pod çš„è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name>

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs <pod-name>
```

### 4.4 éƒ¨ç½²è¿‡ç¨‹è¯´æ˜

OpenTwins åŒ…å« 12 ä¸ªç»„ä»¶ï¼Œéƒ¨ç½²è¿‡ç¨‹å¤§çº¦éœ€è¦ 15-25 åˆ†é’Ÿï¼š

1. **åˆå§‹é˜¶æ®µï¼ˆ0-5åˆ†é’Ÿï¼‰**
   - ä¸‹è½½ Helm Chart
   - åˆ›å»º Kubernetes èµ„æº
   - å¼€å§‹æ‹‰å–å®¹å™¨é•œåƒ

2. **é•œåƒæ‹‰å–é˜¶æ®µï¼ˆ5-15åˆ†é’Ÿï¼‰**
   - ä¸‹è½½å„ç»„ä»¶çš„ Docker é•œåƒ
   - é•œåƒå¤§å°æ€»è®¡çº¦ 2-3GB
   - çŠ¶æ€æ˜¾ç¤ºä¸º `ContainerCreating` æˆ– `Init`

3. **å¯åŠ¨é˜¶æ®µï¼ˆ15-20åˆ†é’Ÿï¼‰**
   - å®¹å™¨ä¾æ¬¡å¯åŠ¨
   - MongoDBã€InfluxDB ç­‰åŸºç¡€æœåŠ¡å…ˆå¯åŠ¨
   - Ditto ç»„ä»¶ä¾æ¬¡å¯åŠ¨
   - Grafana æœ€åå¯åŠ¨

4. **å°±ç»ªé˜¶æ®µï¼ˆ20-25åˆ†é’Ÿï¼‰**
   - æ‰€æœ‰ Pod çŠ¶æ€å˜ä¸º `Running`
   - `READY` åˆ—æ˜¾ç¤º `1/1` æˆ– `2/2`

:::tip å¸¸è§çŠ¶æ€è¯´æ˜
- `ContainerCreating`: æ­£åœ¨æ‹‰å–é•œåƒæˆ–åˆ›å»ºå®¹å™¨
- `Init:0/1`: æ­£åœ¨è¿è¡Œåˆå§‹åŒ–å®¹å™¨
- `PodInitializing`: Pod æ­£åœ¨åˆå§‹åŒ–
- `Running`: å®¹å™¨æ­£åœ¨è¿è¡Œ
- `CrashLoopBackOff`: å®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•ï¼ˆTelegraf åœ¨ç­‰å¾… InfluxDB æ—¶ä¼šå‡ºç°ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰
:::

### 4.5 éªŒè¯éƒ¨ç½²

ç­‰å¾…æ‰€æœ‰ Pod å°±ç»ªï¼š

```powershell
# æ£€æŸ¥æ‰€æœ‰ Pod çŠ¶æ€
kubectl get pods
```

é¢„æœŸè¾“å‡ºï¼ˆæ‰€æœ‰ Pod éƒ½åº”è¯¥æ˜¯ Running çŠ¶æ€ï¼‰ï¼š

```
NAME                                            READY   STATUS    RESTARTS   AGE
opentwins-ditto-connectivity-xxx                1/1     Running   0          23m
opentwins-ditto-extended-api-xxx                1/1     Running   0          23m
opentwins-ditto-gateway-xxx                     1/1     Running   0          23m
opentwins-ditto-nginx-xxx                       1/1     Running   0          23m
opentwins-ditto-policies-xxx                    1/1     Running   0          23m
opentwins-ditto-things-xxx                      1/1     Running   0          23m
opentwins-ditto-thingssearch-xxx                1/1     Running   0          23m
opentwins-grafana-xxx                           2/2     Running   0          23m
opentwins-influxdb2-0                           1/1     Running   0          23m
opentwins-mongodb-xxx                           1/1     Running   0          23m
opentwins-mosquitto-xxx                         1/1     Running   0          23m
opentwins-telegraf-xxx                          1/1     Running   9          23m
```

æŸ¥çœ‹æœåŠ¡ï¼š

```powershell
kubectl get services
```

é¢„æœŸè¾“å‡ºï¼š

```
NAME                           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)
opentwins-ditto-extended-api   NodePort    10.105.182.81    <none>        8080:30526/TCP
opentwins-ditto-nginx          NodePort    10.102.210.73    <none>        8080:30525/TCP
opentwins-grafana              NodePort    10.109.196.142   <none>        80:30718/TCP
opentwins-influxdb2            NodePort    10.108.92.37     <none>        80:30716/TCP
opentwins-mongodb              NodePort    10.109.115.172   <none>        27017:30717/TCP
opentwins-mosquitto            NodePort    10.103.102.84    <none>        1883:30511/TCP,9001:32453/TCP
```

## äº”ã€è®¿é—® OpenTwins

### 5.1 ç½‘ç»œè®¿é—®è¯´æ˜

ç”±äº Windows ä¸Š Minikube çš„ç½‘ç»œé™åˆ¶ï¼Œæ— æ³•ç›´æ¥é€šè¿‡ Minikube IP è®¿é—®æœåŠ¡ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨**ç«¯å£è½¬å‘**çš„æ–¹å¼ã€‚

:::warning é‡è¦
ä¸è¦å°è¯•é€šè¿‡ `minikube ip` è·å–çš„ IP åœ°å€è®¿é—®æœåŠ¡ï¼Œè¿™åœ¨ Windows ä¸Šé€šå¸¸ä¸èµ·ä½œç”¨ã€‚
:::

### 5.2 æ‰‹åŠ¨ç«¯å£è½¬å‘

#### æ–¹å¼ 1: å•ä¸ªæœåŠ¡ç«¯å£è½¬å‘

```powershell
# Grafanaï¼ˆæ•°æ®å¯è§†åŒ–ï¼‰
kubectl port-forward svc/opentwins-grafana 3000:80

# Ditto APIï¼ˆæ•°å­—å­ªç”Ÿæ ¸å¿ƒï¼‰
kubectl port-forward svc/opentwins-ditto-nginx 8080:8080

# OpenTwins Extended API
kubectl port-forward svc/opentwins-ditto-extended-api 8081:8080

# InfluxDBï¼ˆæ—¶åºæ•°æ®åº“ï¼‰
kubectl port-forward svc/opentwins-influxdb2 8086:80

# Mosquitto MQTTï¼ˆæ¶ˆæ¯ä»£ç†ï¼‰
kubectl port-forward svc/opentwins-mosquitto 1883:1883
```

:::tip æç¤º
ç«¯å£è½¬å‘å‘½ä»¤ä¼šå ç”¨å½“å‰ç»ˆç«¯çª—å£ï¼Œéœ€è¦ä¿æŒçª—å£æ‰“å¼€ã€‚å»ºè®®ä¸ºæ¯ä¸ªæœåŠ¡å¼€å¯ä¸€ä¸ªæ–°çš„ PowerShell çª—å£ã€‚
:::

#### æ–¹å¼ 2: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬

åˆ›å»º `start-opentwins-portforward.ps1` æ–‡ä»¶ï¼š

```powershell title="start-opentwins-portforward.ps1"
# OpenTwins ç«¯å£è½¬å‘å¯åŠ¨è„šæœ¬

Write-Host "======================================" -ForegroundColor Green
Write-Host "å¯åŠ¨ OpenTwins ç«¯å£è½¬å‘" -ForegroundColor Green
Write-Host "======================================" -ForegroundColor Green
Write-Host ""

# å¯åŠ¨ç«¯å£è½¬å‘ï¼ˆåå°è¿è¡Œï¼‰
Write-Host "æ­£åœ¨å¯åŠ¨ç«¯å£è½¬å‘..." -ForegroundColor Yellow
Write-Host ""

# Grafana
Start-Job -Name "grafana-forward" -ScriptBlock { 
    kubectl port-forward svc/opentwins-grafana 3000:80 
} | Out-Null

# Ditto API
Start-Job -Name "ditto-forward" -ScriptBlock { 
    kubectl port-forward svc/opentwins-ditto-nginx 8080:8080 
} | Out-Null

# OpenTwins Extended API
Start-Job -Name "extended-api-forward" -ScriptBlock { 
    kubectl port-forward svc/opentwins-ditto-extended-api 8081:8080 
} | Out-Null

# InfluxDB
Start-Job -Name "influxdb-forward" -ScriptBlock { 
    kubectl port-forward svc/opentwins-influxdb2 8086:80 
} | Out-Null

# Mosquitto MQTT
Start-Job -Name "mosquitto-forward" -ScriptBlock { 
    kubectl port-forward svc/opentwins-mosquitto 1883:1883 
} | Out-Null

# ç­‰å¾…ç«¯å£è½¬å‘å¯åŠ¨
Start-Sleep -Seconds 3

Write-Host "======================================" -ForegroundColor Green
Write-Host "ç«¯å£è½¬å‘å·²å¯åŠ¨ï¼" -ForegroundColor Green
Write-Host "======================================" -ForegroundColor Green
Write-Host ""
Write-Host "è®¿é—®åœ°å€:" -ForegroundColor Yellow
Write-Host ""
Write-Host "  Grafana (æ•°æ®å¯è§†åŒ–):" -ForegroundColor Cyan
Write-Host "    http://localhost:3000" -ForegroundColor White
Write-Host "    ç”¨æˆ·å: admin" -ForegroundColor Gray
Write-Host "    å¯†ç : admin" -ForegroundColor Gray
Write-Host ""
Write-Host "  Ditto API (æ•°å­—å­ªç”Ÿæ ¸å¿ƒ):" -ForegroundColor Cyan
Write-Host "    http://localhost:8080" -ForegroundColor White
Write-Host ""
Write-Host "  OpenTwins Extended API:" -ForegroundColor Cyan
Write-Host "    http://localhost:8081" -ForegroundColor White
Write-Host ""
Write-Host "  InfluxDB (æ—¶åºæ•°æ®åº“):" -ForegroundColor Cyan
Write-Host "    http://localhost:8086" -ForegroundColor White
Write-Host ""
Write-Host "  Mosquitto MQTT:" -ForegroundColor Cyan
Write-Host "    localhost:1883" -ForegroundColor White
Write-Host ""
Write-Host "======================================" -ForegroundColor Green
Write-Host ""
Write-Host "ç®¡ç†å‘½ä»¤:" -ForegroundColor Yellow
Write-Host "  æŸ¥çœ‹åå°ä»»åŠ¡: Get-Job" -ForegroundColor Gray
Write-Host "  åœæ­¢æ‰€æœ‰è½¬å‘: Get-Job | Stop-Job; Get-Job | Remove-Job" -ForegroundColor Gray
Write-Host ""
Write-Host "æç¤º: ä¿æŒæ­¤çª—å£æ‰“å¼€ä»¥ç»´æŒç«¯å£è½¬å‘" -ForegroundColor Yellow
Write-Host "      æŒ‰ Ctrl+C å¯ä»¥åœæ­¢æ‰€æœ‰è½¬å‘" -ForegroundColor Yellow
Write-Host ""

# æ˜¾ç¤ºåå°ä»»åŠ¡çŠ¶æ€
Write-Host "åå°ä»»åŠ¡çŠ¶æ€:" -ForegroundColor Yellow
Get-Job | Format-Table -AutoSize

Write-Host ""
Write-Host "æ­£åœ¨ç›‘æ§ç«¯å£è½¬å‘çŠ¶æ€... (æŒ‰ Ctrl+C åœæ­¢)" -ForegroundColor Gray
Write-Host ""

# ä¿æŒè„šæœ¬è¿è¡Œ
try {
    while ($true) {
        Start-Sleep -Seconds 10
        
        # æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
        $failedJobs = Get-Job | Where-Object { $_.State -eq "Failed" }
        if ($failedJobs) {
            Write-Host "è­¦å‘Š: æœ‰ç«¯å£è½¬å‘ä»»åŠ¡å¤±è´¥" -ForegroundColor Red
            $failedJobs | Format-Table -AutoSize
        }
    }
} finally {
    Write-Host ""
    Write-Host "æ­£åœ¨åœæ­¢æ‰€æœ‰ç«¯å£è½¬å‘..." -ForegroundColor Yellow
    Get-Job | Stop-Job
    Get-Job | Remove-Job
    Write-Host "å·²åœæ­¢æ‰€æœ‰ç«¯å£è½¬å‘" -ForegroundColor Green
}
```

è¿è¡Œè„šæœ¬ï¼š

```powershell
powershell -ExecutionPolicy Bypass -File .\start-opentwins-portforward.ps1
```

### 5.3 è®¿é—®æœåŠ¡

å¯åŠ¨ç«¯å£è½¬å‘åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

#### ğŸ“Š Grafanaï¼ˆæ•°æ®å¯è§†åŒ–ï¼‰- æ¨èé¦–å…ˆè®¿é—®

```
http://localhost:3000
```

- **é»˜è®¤ç”¨æˆ·å**: `admin`
- **é»˜è®¤å¯†ç **: `admin`
- é¦–æ¬¡ç™»å½•ä¼šè¦æ±‚ä¿®æ”¹å¯†ç 

#### ğŸŒ Ditto APIï¼ˆæ•°å­—å­ªç”Ÿæ ¸å¿ƒï¼‰

```
http://localhost:8080
```

Eclipse Ditto æä¾›äº†å®Œæ•´çš„æ•°å­—å­ªç”Ÿç®¡ç† APIã€‚

#### ğŸŒ OpenTwins Extended API

```
http://localhost:8081
```

OpenTwins çš„æ‰©å±• API æ¥å£ã€‚

#### ğŸ’¾ InfluxDBï¼ˆæ—¶åºæ•°æ®åº“ï¼‰

```
http://localhost:8086
```

#### ğŸ“¡ Mosquitto MQTTï¼ˆæ¶ˆæ¯ä»£ç†ï¼‰

```
localhost:1883
```

ä½¿ç”¨ MQTT å®¢æˆ·ç«¯è¿æ¥æ­¤åœ°å€ã€‚

## å…­ã€é…ç½®å’Œä½¿ç”¨

### 6.1 Grafana åˆå§‹é…ç½®

1. è®¿é—® `http://localhost:3000`
2. ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•ï¼ˆadmin/adminï¼‰
3. ç³»ç»Ÿä¼šæç¤ºä¿®æ”¹å¯†ç ï¼Œå»ºè®®ä¿®æ”¹
4. è¿›å…¥ä¸»ç•Œé¢åï¼Œå¯ä»¥çœ‹åˆ°é¢„é…ç½®çš„ä»ªè¡¨æ¿

### 6.2 åˆ›å»ºæ•°å­—å­ªç”Ÿ

ä½¿ç”¨ Ditto API åˆ›å»ºæ•°å­—å­ªç”Ÿå®ä¾‹ï¼š

```bash
# ä½¿ç”¨ curl åˆ›å»ºä¸€ä¸ªç®€å•çš„æ•°å­—å­ªç”Ÿ
curl -X PUT http://localhost:8080/api/2/things/org.example:my-thing \
  -H "Content-Type: application/json" \
  -d '{
    "attributes": {
      "location": "Room 42"
    },
    "features": {
      "temperature": {
        "properties": {
          "value": 23.5
        }
      }
    }
  }'
```

### 6.3 MQTT æ¶ˆæ¯å‘å¸ƒ

ä½¿ç”¨ MQTT å®¢æˆ·ç«¯å‘å¸ƒæ¶ˆæ¯ï¼š

```bash
# ä½¿ç”¨ mosquitto_pub å‘å¸ƒæ¶ˆæ¯
mosquitto_pub -h localhost -p 1883 -t "org.example/my-thing" -m '{"temperature": 24.5}'
```

## ä¸ƒã€å¸¸ç”¨ç®¡ç†å‘½ä»¤

### 7.1 æŸ¥çœ‹çŠ¶æ€

```powershell
# æŸ¥çœ‹æ‰€æœ‰ Pod çŠ¶æ€
kubectl get pods

# æŸ¥çœ‹æœåŠ¡
kubectl get services

# æŸ¥çœ‹ Helm å‘å¸ƒ
helm list

# æŸ¥çœ‹ Helm å‘å¸ƒè¯¦æƒ…
helm status opentwins

# æŸ¥çœ‹ç‰¹å®š Pod æ—¥å¿—
kubectl logs <pod-name>

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
kubectl logs -f <pod-name>
```

### 7.2 é‡å¯æœåŠ¡

```powershell
# é‡å¯ç‰¹å®š Podï¼ˆåˆ é™¤åä¼šè‡ªåŠ¨é‡å»ºï¼‰
kubectl delete pod <pod-name>

# é‡å¯æ‰€æœ‰ OpenTwins Pod
kubectl delete pods -l app.kubernetes.io/instance=opentwins
```

### 7.3 åœæ­¢å’Œå¯åŠ¨

```powershell
# åœæ­¢ Minikubeï¼ˆä¿ç•™æ•°æ®ï¼‰
minikube stop

# å¯åŠ¨ Minikube
minikube start

# åˆ é™¤ Minikubeï¼ˆåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
minikube delete
```

### 7.4 å¸è½½ OpenTwins

```powershell
# å¸è½½ OpenTwins
helm uninstall opentwins

# ç¡®è®¤å¸è½½
kubectl get pods
# åº”è¯¥çœ‹ä¸åˆ° opentwins ç›¸å…³çš„ Pod
```

## å…«ã€æ•…éšœæ’æŸ¥

### 8.1 Pod æ— æ³•å¯åŠ¨

**é—®é¢˜**: Pod ä¸€ç›´å¤„äº `Pending` æˆ– `ContainerCreating` çŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**:

```powershell
# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name>

# æŸ¥çœ‹äº‹ä»¶æ—¥å¿—
kubectl get events --sort-by='.lastTimestamp'

# æ£€æŸ¥é•œåƒæ‹‰å–çŠ¶æ€
kubectl get pods -o wide
```

å¸¸è§åŸå› ï¼š
- é•œåƒæ‹‰å–å¤±è´¥ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥
- èµ„æºä¸è¶³ï¼šå¢åŠ  Minikube çš„ CPU å’Œå†…å­˜é…ç½®
- å­˜å‚¨ä¸è¶³ï¼šæ¸…ç† Docker é•œåƒå’Œå®¹å™¨

### 8.2 ç«¯å£è½¬å‘å¤±è´¥

**é—®é¢˜**: æ— æ³•é€šè¿‡ localhost è®¿é—®æœåŠ¡

**è§£å†³æ–¹æ¡ˆ**:

```powershell
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr :3000

# ä½¿ç”¨ä¸åŒçš„æœ¬åœ°ç«¯å£
kubectl port-forward svc/opentwins-grafana 3001:80

# æ£€æŸ¥æœåŠ¡æ˜¯å¦å­˜åœ¨
kubectl get svc opentwins-grafana
```

### 8.3 Minikube å¯åŠ¨å¤±è´¥

**é—®é¢˜**: Minikube æ— æ³•å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:

```powershell
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
minikube start --alsologtostderr -v=7

# åˆ é™¤å¹¶é‡æ–°åˆ›å»º
minikube delete
minikube start --cpus 4 --memory 8192 --disk-size 40gb --driver=docker

# æ£€æŸ¥ Docker Desktop æ˜¯å¦è¿è¡Œ
docker ps
```

### 8.4 Telegraf CrashLoopBackOff

**é—®é¢˜**: opentwins-telegraf Pod æ˜¾ç¤º `CrashLoopBackOff`

**è¯´æ˜**: è¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚Telegraf åœ¨ç­‰å¾… InfluxDB å®Œå…¨å¯åŠ¨ã€‚ä¸€æ—¦ InfluxDB å°±ç»ªï¼ŒTelegraf ä¼šè‡ªåŠ¨æ¢å¤æ­£å¸¸ã€‚

**éªŒè¯**:

```powershell
# æ£€æŸ¥ InfluxDB çŠ¶æ€
kubectl get pod -l app.kubernetes.io/name=influxdb2

# æŸ¥çœ‹ Telegraf æ—¥å¿—
kubectl logs <telegraf-pod-name>
```

### 8.5 å†…å­˜ä¸è¶³

**é—®é¢˜**: Pod è¢«é©±é€æˆ– OOMKilled

**è§£å†³æ–¹æ¡ˆ**:

```powershell
# åœæ­¢ Minikube
minikube stop

# å¢åŠ å†…å­˜é…ç½®
minikube config set memory 12288

# é‡æ–°å¯åŠ¨
minikube start
```

## ä¹ã€æ€§èƒ½ä¼˜åŒ–

### 9.1 è°ƒæ•´èµ„æºé…ç½®

æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ Minikube èµ„æºï¼š

```powershell
# åœæ­¢ Minikube
minikube stop

# è°ƒæ•´é…ç½®
minikube config set cpus 6
minikube config set memory 12288

# é‡æ–°å¯åŠ¨
minikube start
```

### 9.2 æŒä¹…åŒ–æ•°æ®

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®å­˜å‚¨åœ¨ Minikube è™šæ‹Ÿæœºä¸­ã€‚å¦‚æœéœ€è¦æŒä¹…åŒ–æ•°æ®ï¼š

```powershell
# æŸ¥çœ‹æŒä¹…å·
kubectl get pv
kubectl get pvc

# å¤‡ä»½æ•°æ®ï¼ˆä»¥ MongoDB ä¸ºä¾‹ï¼‰
kubectl exec -it <mongodb-pod-name> -- mongodump --out /tmp/backup
kubectl cp <mongodb-pod-name>:/tmp/backup ./mongodb-backup
```

### 9.3 é•œåƒç¼“å­˜

ä¸ºäº†åŠ å¿«åç»­éƒ¨ç½²ï¼Œå¯ä»¥é¢„æ‹‰å–é•œåƒï¼š

```powershell
# è¿›å…¥ Minikube
minikube ssh

# æ‰‹åŠ¨æ‹‰å–é•œåƒ
docker pull eclipse/ditto-gateway:latest
docker pull grafana/grafana:latest
# ... å…¶ä»–é•œåƒ
```

## åã€æ€»ç»“

### 10.1 éƒ¨ç½²æ¸…å•

å®Œæ•´çš„éƒ¨ç½²æµç¨‹åŒ…æ‹¬ï¼š

1. âœ… å®‰è£… Docker Desktop
2. âœ… å®‰è£… Chocolateyï¼ˆå¯é€‰ï¼‰
3. âœ… å®‰è£… Helm
4. âœ… å®‰è£… Minikube
5. âœ… å¯åŠ¨ Kubernetes é›†ç¾¤
6. âœ… éƒ¨ç½² OpenTwins
7. âœ… é…ç½®ç«¯å£è½¬å‘
8. âœ… è®¿é—®å’Œé…ç½®æœåŠ¡

### 10.2 å…³é”®è¦ç‚¹

- **ç½‘ç»œè®¿é—®**: Windows ä¸Šå¿…é¡»ä½¿ç”¨ç«¯å£è½¬å‘ï¼Œä¸èƒ½ç›´æ¥è®¿é—® Minikube IP
- **èµ„æºé…ç½®**: ç¡®ä¿åˆ†é…è¶³å¤Ÿçš„ CPU å’Œå†…å­˜ï¼ˆæœ€ä½ 4 æ ¸ 8GBï¼‰
- **éƒ¨ç½²æ—¶é—´**: é¦–æ¬¡éƒ¨ç½²éœ€è¦ 20-25 åˆ†é’Ÿï¼Œä¸»è¦æ—¶é—´ç”¨äºä¸‹è½½é•œåƒ
- **Telegraf é‡å¯**: åœ¨ InfluxDB å¯åŠ¨å‰ä¼šå‡ºç° CrashLoopBackOffï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡

### 10.3 å¿«é€Ÿè®¿é—®

éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **Grafana**: http://localhost:3000 (admin/admin)
- **Ditto API**: http://localhost:8080
- **Extended API**: http://localhost:8081
- **InfluxDB**: http://localhost:8086
- **MQTT**: localhost:1883

### 10.4 åç»­æ­¥éª¤

1. ç†Ÿæ‚‰ Grafana ä»ªè¡¨æ¿
2. å­¦ä¹  Ditto API ä½¿ç”¨
3. åˆ›å»ºè‡ªå·±çš„æ•°å­—å­ªç”Ÿå®ä¾‹
4. é›†æˆ MQTT è®¾å¤‡
5. å¼€å‘è‡ªå®šä¹‰åº”ç”¨

## åä¸€ã€å‚è€ƒèµ„æº

- [OpenTwins å®˜æ–¹æ–‡æ¡£](https://ertis-research.github.io/opentwins/)
- [Eclipse Ditto æ–‡æ¡£](https://www.eclipse.org/ditto/)
- [Minikube æ–‡æ¡£](https://minikube.sigs.k8s.io/docs/)
- [Kubernetes æ–‡æ¡£](https://kubernetes.io/docs/)
- [Helm æ–‡æ¡£](https://helm.sh/docs/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-14  
**æµ‹è¯•ç¯å¢ƒ**: Windows 11 Pro, Docker Desktop 28.5.1, Minikube 1.37.0, Kubernetes 1.34.0

