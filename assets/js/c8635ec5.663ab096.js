"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["76518"],{99500:function(e,n,i){i.r(n),i.d(n,{metadata:()=>l,default:()=>u,frontMatter:()=>t,contentTitle:()=>c,toc:()=>o,assets:()=>d});var l=JSON.parse('{"id":"backend/distributed-systems/distributed-lock","title":"\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\u8BE6\u89E3","description":"\u5168\u9762\u4ECB\u7ECD\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u3001\u6280\u672F\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5","source":"@site/docs/backend/distributed-systems/distributed-lock.mdx","sourceDirName":"backend/distributed-systems","slug":"/backend/distributed-systems/distributed-lock","permalink":"/docs/backend/distributed-systems/distributed-lock","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/distributed-systems/distributed-lock.mdx","tags":[],"version":"current","lastUpdatedBy":"Laby","lastUpdatedAt":1736208000000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\u8BE6\u89E3","description":"\u5168\u9762\u4ECB\u7ECD\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u3001\u6280\u672F\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5","authors":["Laby"],"last_update":{"date":"2025-01-07T00:00:00.000Z","author":"Laby"}},"sidebar":"tutorialSidebar","previous":{"title":"\u5206\u5E03\u5F0F\u7F13\u5B58\u67B6\u6784\u8BE6\u89E3","permalink":"/docs/backend/distributed-systems/distributed-cache"},"next":{"title":"\u5206\u5E03\u5F0F\u4E8B\u52A1\u89E3\u51B3\u65B9\u6848\u8BE6\u89E3","permalink":"/docs/backend/distributed-systems/distributed-transaction"}}'),r=i(74848),s=i(28453);let t={sidebar_position:3,title:"\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\u8BE6\u89E3",description:"\u5168\u9762\u4ECB\u7ECD\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u3001\u6280\u672F\u65B9\u6848\u4E0E\u6700\u4F73\u5B9E\u8DF5",authors:["Laby"],last_update:{date:new Date("2025-01-07T00:00:00.000Z"),author:"Laby"}},c="\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\u8BE6\u89E3",d={},o=[{value:"1. \u5206\u5E03\u5F0F\u9501\u7684\u57FA\u672C\u8981\u6C42",id:"1-\u5206\u5E03\u5F0F\u9501\u7684\u57FA\u672C\u8981\u6C42",level:2},{value:"1.1 \u6838\u5FC3\u7279\u6027",id:"11-\u6838\u5FC3\u7279\u6027",level:3},{value:"1.2 \u5B9E\u73B0\u6311\u6218",id:"12-\u5B9E\u73B0\u6311\u6218",level:3},{value:"2. Redis\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",id:"2-redis\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",level:2},{value:"2.1 \u57FA\u7840\u5B9E\u73B0",id:"21-\u57FA\u7840\u5B9E\u73B0",level:3},{value:"\u83B7\u53D6\u9501",id:"\u83B7\u53D6\u9501",level:4},{value:"\u4F7F\u7528\u793A\u4F8B",id:"\u4F7F\u7528\u793A\u4F8B",level:4},{value:"2.2 \u770B\u95E8\u72D7\u673A\u5236",id:"22-\u770B\u95E8\u72D7\u673A\u5236",level:3},{value:"2.3 RedLock\u7B97\u6CD5",id:"23-redlock\u7B97\u6CD5",level:3},{value:"2.4 RedLock\u7684\u4F18\u7F3A\u70B9",id:"24-redlock\u7684\u4F18\u7F3A\u70B9",level:3},{value:"\u4F18\u70B9",id:"\u4F18\u70B9",level:4},{value:"\u7F3A\u70B9",id:"\u7F3A\u70B9",level:4},{value:"3. Zookeeper\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",id:"3-zookeeper\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",level:2},{value:"3.1 \u57FA\u672C\u539F\u7406",id:"31-\u57FA\u672C\u539F\u7406",level:3},{value:"\u6838\u5FC3\u673A\u5236",id:"\u6838\u5FC3\u673A\u5236",level:4},{value:"3.2 \u5B9E\u73B0\u4EE3\u7801",id:"32-\u5B9E\u73B0\u4EE3\u7801",level:3},{value:"3.3 \u624B\u52A8\u5B9E\u73B0Zookeeper\u9501",id:"33-\u624B\u52A8\u5B9E\u73B0zookeeper\u9501",level:3},{value:"3.4 Zookeeper\u9501\u7684\u7279\u70B9",id:"34-zookeeper\u9501\u7684\u7279\u70B9",level:3},{value:"\u4F18\u70B9",id:"\u4F18\u70B9-1",level:4},{value:"\u7F3A\u70B9",id:"\u7F3A\u70B9-1",level:4},{value:"4. \u6570\u636E\u5E93\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",id:"4-\u6570\u636E\u5E93\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",level:2},{value:"4.1 \u57FA\u4E8E\u552F\u4E00\u7D22\u5F15\u7684\u9501",id:"41-\u57FA\u4E8E\u552F\u4E00\u7D22\u5F15\u7684\u9501",level:3},{value:"4.2 \u6570\u636E\u5E93\u9501\u8868\u7ED3\u6784",id:"42-\u6570\u636E\u5E93\u9501\u8868\u7ED3\u6784",level:3},{value:"4.3 \u6570\u636E\u5E93\u9501\u7684\u7279\u70B9",id:"43-\u6570\u636E\u5E93\u9501\u7684\u7279\u70B9",level:3},{value:"\u4F18\u70B9",id:"\u4F18\u70B9-2",level:4},{value:"\u7F3A\u70B9",id:"\u7F3A\u70B9-2",level:4},{value:"5. \u5206\u5E03\u5F0F\u9501\u9009\u578B\u5BF9\u6BD4",id:"5-\u5206\u5E03\u5F0F\u9501\u9009\u578B\u5BF9\u6BD4",level:2},{value:"5.1 \u6280\u672F\u65B9\u6848\u5BF9\u6BD4",id:"51-\u6280\u672F\u65B9\u6848\u5BF9\u6BD4",level:3},{value:"5.2 \u9009\u578B\u5EFA\u8BAE",id:"52-\u9009\u578B\u5EFA\u8BAE",level:3},{value:"\u9009\u62E9Redis\u9501\u7684\u573A\u666F",id:"\u9009\u62E9redis\u9501\u7684\u573A\u666F",level:4},{value:"\u9009\u62E9Zookeeper\u9501\u7684\u573A\u666F",id:"\u9009\u62E9zookeeper\u9501\u7684\u573A\u666F",level:4},{value:"\u9009\u62E9\u6570\u636E\u5E93\u9501\u7684\u573A\u666F",id:"\u9009\u62E9\u6570\u636E\u5E93\u9501\u7684\u573A\u666F",level:4},{value:"6. \u5206\u5E03\u5F0F\u9501\u6700\u4F73\u5B9E\u8DF5",id:"6-\u5206\u5E03\u5F0F\u9501\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"6.1 \u9501\u7684\u8BBE\u8BA1\u539F\u5219",id:"61-\u9501\u7684\u8BBE\u8BA1\u539F\u5219",level:3},{value:"\u9501\u7C92\u5EA6\u8BBE\u8BA1",id:"\u9501\u7C92\u5EA6\u8BBE\u8BA1",level:4},{value:"\u9501\u8D85\u65F6\u8BBE\u7F6E",id:"\u9501\u8D85\u65F6\u8BBE\u7F6E",level:4},{value:"6.2 \u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848",id:"62-\u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848",level:3},{value:"\u8BEF\u5220\u9501\u95EE\u9898",id:"\u8BEF\u5220\u9501\u95EE\u9898",level:4},{value:"\u53EF\u91CD\u5165\u9501\u5B9E\u73B0",id:"\u53EF\u91CD\u5165\u9501\u5B9E\u73B0",level:4},{value:"\u8BFB\u5199\u9501\u5B9E\u73B0",id:"\u8BFB\u5199\u9501\u5B9E\u73B0",level:4},{value:"6.3 \u76D1\u63A7\u4E0E\u544A\u8B66",id:"63-\u76D1\u63A7\u4E0E\u544A\u8B66",level:3},{value:"\u9501\u76D1\u63A7\u6307\u6807",id:"\u9501\u76D1\u63A7\u6307\u6807",level:4},{value:"7. \u5206\u5E03\u5F0F\u9501\u9762\u8BD5\u9898\u7CBE\u9009",id:"7-\u5206\u5E03\u5F0F\u9501\u9762\u8BD5\u9898\u7CBE\u9009",level:2},{value:"7.1 \u57FA\u7840\u6982\u5FF5",id:"71-\u57FA\u7840\u6982\u5FF5",level:3},{value:"Q1: \u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u9501\uFF1F\u4E3A\u4EC0\u4E48\u9700\u8981\u5206\u5E03\u5F0F\u9501\uFF1F",id:"q1-\u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u9501\u4E3A\u4EC0\u4E48\u9700\u8981\u5206\u5E03\u5F0F\u9501",level:4},{value:"Q2: \u5206\u5E03\u5F0F\u9501\u9700\u8981\u6EE1\u8DB3\u54EA\u4E9B\u57FA\u672C\u8981\u6C42\uFF1F",id:"q2-\u5206\u5E03\u5F0F\u9501\u9700\u8981\u6EE1\u8DB3\u54EA\u4E9B\u57FA\u672C\u8981\u6C42",level:4},{value:"7.2 Redis\u5206\u5E03\u5F0F\u9501",id:"72-redis\u5206\u5E03\u5F0F\u9501",level:3},{value:"Q3: Redis\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F",id:"q3-redis\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48",level:4},{value:"Q4: Redis\u5206\u5E03\u5F0F\u9501\u5B58\u5728\u54EA\u4E9B\u95EE\u9898\uFF1F\u5982\u4F55\u89E3\u51B3\uFF1F",id:"q4-redis\u5206\u5E03\u5F0F\u9501\u5B58\u5728\u54EA\u4E9B\u95EE\u9898\u5982\u4F55\u89E3\u51B3",level:4},{value:"7.3 Zookeeper\u5206\u5E03\u5F0F\u9501",id:"73-zookeeper\u5206\u5E03\u5F0F\u9501",level:3},{value:"Q5: Zookeeper\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F",id:"q5-zookeeper\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48",level:4},{value:"Q6: Zookeeper\u5206\u5E03\u5F0F\u9501\u76F8\u6BD4Redis\u9501\u6709\u4EC0\u4E48\u4F18\u52BF\uFF1F",id:"q6-zookeeper\u5206\u5E03\u5F0F\u9501\u76F8\u6BD4redis\u9501\u6709\u4EC0\u4E48\u4F18\u52BF",level:4},{value:"7.4 \u9AD8\u7EA7\u95EE\u9898",id:"74-\u9AD8\u7EA7\u95EE\u9898",level:3},{value:"Q7: \u5982\u4F55\u5B9E\u73B0\u53EF\u91CD\u5165\u5206\u5E03\u5F0F\u9501\uFF1F",id:"q7-\u5982\u4F55\u5B9E\u73B0\u53EF\u91CD\u5165\u5206\u5E03\u5F0F\u9501",level:4},{value:"Q8: \u5982\u4F55\u8BBE\u8BA1\u5206\u5E03\u5F0F\u9501\u7684\u76D1\u63A7\u7CFB\u7EDF\uFF1F",id:"q8-\u5982\u4F55\u8BBE\u8BA1\u5206\u5E03\u5F0F\u9501\u7684\u76D1\u63A7\u7CFB\u7EDF",level:4},{value:"8. \u603B\u7ED3",id:"8-\u603B\u7ED3",level:2},{value:"\u5173\u952E\u8981\u70B9",id:"\u5173\u952E\u8981\u70B9",level:3}];function a(e){let n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\u8BE6\u89E3",children:"\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\u8BE6\u89E3"})}),"\n",(0,r.jsx)(n.p,{children:"\u5206\u5E03\u5F0F\u9501\u662F\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0C\u7528\u4E8E\u5728\u5206\u5E03\u5F0F\u573A\u666F\u4E0B\u5B9E\u73B0\u4E34\u754C\u8D44\u6E90\u7684\u4E92\u65A5\u8BBF\u95EE\u3002\u672C\u7AE0\u5C06\u8BE6\u7EC6\u4ECB\u7ECD\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u3001\u6280\u672F\u65B9\u6848\u548C\u6700\u4F73\u5B9E\u8DF5\u3002"}),"\n",(0,r.jsx)(n.admonition,{title:"\u5206\u5E03\u5F0F\u9501\u7684\u91CD\u8981\u6027",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8D44\u6E90\u4FDD\u62A4"}),"\uFF1A\u9632\u6B62\u591A\u4E2A\u8FDB\u7A0B\u540C\u65F6\u8BBF\u95EE\u5171\u4EAB\u8D44\u6E90"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6570\u636E\u4E00\u81F4\u6027"}),"\uFF1A\u786E\u4FDD\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u7684\u6570\u636E\u64CD\u4F5C\u539F\u5B50\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4E1A\u52A1\u5B89\u5168"}),"\uFF1A\u907F\u514D\u91CD\u590D\u5904\u7406\u3001\u8D85\u5356\u7B49\u4E1A\u52A1\u95EE\u9898"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7CFB\u7EDF\u7A33\u5B9A"}),"\uFF1A\u9632\u6B62\u5E76\u53D1\u64CD\u4F5C\u5BFC\u81F4\u7684\u7CFB\u7EDF\u5F02\u5E38"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"1-\u5206\u5E03\u5F0F\u9501\u7684\u57FA\u672C\u8981\u6C42",children:"1. \u5206\u5E03\u5F0F\u9501\u7684\u57FA\u672C\u8981\u6C42"}),"\n",(0,r.jsx)(n.h3,{id:"11-\u6838\u5FC3\u7279\u6027",children:"1.1 \u6838\u5FC3\u7279\u6027"}),"\n",(0,r.jsx)(n.p,{children:"\u5206\u5E03\u5F0F\u9501\u9700\u8981\u6EE1\u8DB3\u4EE5\u4E0B\u57FA\u672C\u8981\u6C42\uFF1A"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7279\u6027"}),(0,r.jsx)(n.th,{children:"\u63CF\u8FF0"}),(0,r.jsx)(n.th,{children:"\u91CD\u8981\u6027"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u4E92\u65A5\u6027"})}),(0,r.jsx)(n.td,{children:"\u540C\u4E00\u65F6\u95F4\u53EA\u80FD\u6709\u4E00\u4E2A\u5BA2\u6237\u7AEF\u6301\u6709\u9501"}),(0,r.jsx)(n.td,{children:"\u6838\u5FC3\u8981\u6C42"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u9632\u6B7B\u9501"})}),(0,r.jsx)(n.td,{children:"\u9501\u5FC5\u987B\u80FD\u591F\u81EA\u52A8\u91CA\u653E\uFF0C\u907F\u514D\u6B7B\u9501"}),(0,r.jsx)(n.td,{children:"\u7CFB\u7EDF\u7A33\u5B9A\u6027"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u53EF\u91CD\u5165\u6027"})}),(0,r.jsx)(n.td,{children:"\u540C\u4E00\u5BA2\u6237\u7AEF\u53EF\u4EE5\u591A\u6B21\u83B7\u53D6\u540C\u4E00\u628A\u9501"}),(0,r.jsx)(n.td,{children:"\u4E1A\u52A1\u4FBF\u5229\u6027"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u9AD8\u6027\u80FD"})}),(0,r.jsx)(n.td,{children:"\u83B7\u53D6\u548C\u91CA\u653E\u9501\u7684\u64CD\u4F5C\u8981\u5FEB\u901F"}),(0,r.jsx)(n.td,{children:"\u7CFB\u7EDF\u6027\u80FD"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u9AD8\u53EF\u7528"})}),(0,r.jsx)(n.td,{children:"\u9501\u670D\u52A1\u672C\u8EAB\u8981\u5177\u5907\u9AD8\u53EF\u7528\u6027"}),(0,r.jsx)(n.td,{children:"\u7CFB\u7EDF\u53EF\u9760\u6027"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"12-\u5B9E\u73B0\u6311\u6218",children:"1.2 \u5B9E\u73B0\u6311\u6218"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    A[\u5206\u5E03\u5F0F\u9501\u6311\u6218] --\x3e B[\u7F51\u7EDC\u5206\u533A]\n    A --\x3e C[\u65F6\u949F\u6F02\u79FB]\n    A --\x3e D[\u8282\u70B9\u6545\u969C]\n    A --\x3e E[\u5E76\u53D1\u7ADE\u4E89]\n    \n    B --\x3e B1[\u7F51\u7EDC\u5EF6\u8FDF]\n    B --\x3e B2[\u6D88\u606F\u4E22\u5931]\n    B --\x3e B3[\u8111\u88C2\u95EE\u9898]\n    \n    C --\x3e C1[\u65F6\u949F\u4E0D\u540C\u6B65]\n    C --\x3e C2[\u65F6\u949F\u56DE\u62E8]\n    C --\x3e C3[\u65F6\u95F4\u5224\u65AD\u9519\u8BEF]\n    \n    D --\x3e D1[\u5355\u70B9\u6545\u969C]\n    D --\x3e D2[\u6570\u636E\u4E22\u5931]\n    D --\x3e D3[\u670D\u52A1\u4E0D\u53EF\u7528]\n    \n    E --\x3e E1[\u7ADE\u6001\u6761\u4EF6]\n    E --\x3e E2[ABA\u95EE\u9898]\n    E --\x3e E3[\u6D3B\u9501\u95EE\u9898]"}),"\n",(0,r.jsx)(n.h2,{id:"2-redis\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",children:"2. Redis\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0"}),"\n",(0,r.jsx)(n.h3,{id:"21-\u57FA\u7840\u5B9E\u73B0",children:"2.1 \u57FA\u7840\u5B9E\u73B0"}),"\n",(0,r.jsx)(n.p,{children:"Redis\u5206\u5E03\u5F0F\u9501\u662F\u6700\u5E38\u7528\u7684\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0\u65B9\u6848\uFF0C\u5177\u6709\u9AD8\u6027\u80FD\u3001\u6613\u5B9E\u73B0\u7684\u7279\u70B9\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u83B7\u53D6\u9501",children:"\u83B7\u53D6\u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="Redis\u5206\u5E03\u5F0F\u9501\u57FA\u7840\u5B9E\u73B0"',children:'@Service\npublic class RedisDistributedLock {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final String lockKey;\n    private final String lockValue;\n    private final long expireTime;\n    \n    public RedisDistributedLock(RedisTemplate<String, String> redisTemplate, \n                               String lockKey, long expireTime) {\n        this.redisTemplate = redisTemplate;\n        this.lockKey = lockKey;\n        this.lockValue = UUID.randomUUID().toString(); // \u552F\u4E00\u6807\u8BC6\n        this.expireTime = expireTime;\n    }\n    \n    /**\n     * \u5C1D\u8BD5\u83B7\u53D6\u9501\n     * @param timeout \u8D85\u65F6\u65F6\u95F4\n     * @param unit \u65F6\u95F4\u5355\u4F4D\n     * @return \u662F\u5426\u83B7\u53D6\u6210\u529F\n     */\n    public boolean tryLock(long timeout, TimeUnit unit) {\n        long startTime = System.currentTimeMillis();\n        long timeoutMillis = unit.toMillis(timeout);\n        \n        while (System.currentTimeMillis() - startTime < timeoutMillis) {\n            // \u4F7F\u7528SET NX EX\u547D\u4EE4\u539F\u5B50\u6027\u5730\u8BBE\u7F6E\u9501\n            Boolean success = redisTemplate.opsForValue()\n                .setIfAbsent(lockKey, lockValue, expireTime, TimeUnit.MILLISECONDS);\n            \n            if (Boolean.TRUE.equals(success)) {\n                return true; // \u83B7\u53D6\u9501\u6210\u529F\n            }\n            \n            // \u83B7\u53D6\u9501\u5931\u8D25\uFF0C\u77ED\u6682\u7B49\u5F85\u540E\u91CD\u8BD5\n            try {\n                Thread.sleep(10);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return false;\n            }\n        }\n        \n        return false; // \u8D85\u65F6\u672A\u83B7\u53D6\u5230\u9501\n    }\n    \n    /**\n     * \u91CA\u653E\u9501\n     * @return \u662F\u5426\u91CA\u653E\u6210\u529F\n     */\n    public boolean releaseLock() {\n        // \u4F7F\u7528Lua\u811A\u672C\u4FDD\u8BC1\u539F\u5B50\u6027\n        String script = "if redis.call(\'get\', KEYS[1]) == ARGV[1] then " +\n                       "return redis.call(\'del\', KEYS[1]) " +\n                       "else return 0 end";\n        \n        Long result = redisTemplate.execute(\n            new DefaultRedisScript<>(script, Long.class),\n            Collections.singletonList(lockKey),\n            lockValue\n        );\n        \n        return Long.valueOf(1).equals(result);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u4F7F\u7528\u793A\u4F8B",children:"\u4F7F\u7528\u793A\u4F8B"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="Redis\u5206\u5E03\u5F0F\u9501\u4F7F\u7528\u793A\u4F8B"',children:'@Service\npublic class OrderService {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    \n    public void processOrder(String orderId) {\n        String lockKey = "order:lock:" + orderId;\n        RedisDistributedLock lock = new RedisDistributedLock(redisTemplate, lockKey, 30000);\n        \n        try {\n            // \u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C\u8D85\u65F6\u65F6\u95F45\u79D2\n            if (lock.tryLock(5, TimeUnit.SECONDS)) {\n                try {\n                    // \u6267\u884C\u4E1A\u52A1\u903B\u8F91\n                    doProcessOrder(orderId);\n                } finally {\n                    // \u91CA\u653E\u9501\n                    lock.releaseLock();\n                }\n            } else {\n                throw new RuntimeException("Failed to acquire lock for order: " + orderId);\n            }\n        } catch (Exception e) {\n            log.error("Error processing order: " + orderId, e);\n            throw e;\n        }\n    }\n    \n    private void doProcessOrder(String orderId) {\n        // \u5177\u4F53\u7684\u8BA2\u5355\u5904\u7406\u903B\u8F91\n        log.info("Processing order: " + orderId);\n        // ... \u4E1A\u52A1\u903B\u8F91\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"22-\u770B\u95E8\u72D7\u673A\u5236",children:"2.2 \u770B\u95E8\u72D7\u673A\u5236"}),"\n",(0,r.jsx)(n.p,{children:"\u4E3A\u4E86\u9632\u6B62\u4E1A\u52A1\u6267\u884C\u65F6\u95F4\u8D85\u8FC7\u9501\u7684\u8FC7\u671F\u65F6\u95F4\uFF0C\u9700\u8981\u5B9E\u73B0\u770B\u95E8\u72D7\u673A\u5236\u81EA\u52A8\u7EED\u671F\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="Redis\u5206\u5E03\u5F0F\u9501\u770B\u95E8\u72D7\u5B9E\u73B0"',children:'@Service\npublic class RedisDistributedLockWithWatchdog {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final String lockKey;\n    private final String lockValue;\n    private final long expireTime;\n    private final ScheduledExecutorService scheduler;\n    private volatile boolean isLocked = false;\n    private volatile ScheduledFuture<?> renewalTask;\n    \n    public RedisDistributedLockWithWatchdog(RedisTemplate<String, String> redisTemplate, \n                                           String lockKey, long expireTime) {\n        this.redisTemplate = redisTemplate;\n        this.lockKey = lockKey;\n        this.lockValue = UUID.randomUUID().toString();\n        this.expireTime = expireTime;\n        this.scheduler = Executors.newScheduledThreadPool(1);\n    }\n    \n    /**\n     * \u5C1D\u8BD5\u83B7\u53D6\u9501\uFF08\u5E26\u770B\u95E8\u72D7\uFF09\n     */\n    public boolean tryLock(long timeout, TimeUnit unit) {\n        long startTime = System.currentTimeMillis();\n        long timeoutMillis = unit.toMillis(timeout);\n        \n        while (System.currentTimeMillis() - startTime < timeoutMillis) {\n            Boolean success = redisTemplate.opsForValue()\n                .setIfAbsent(lockKey, lockValue, expireTime, TimeUnit.MILLISECONDS);\n            \n            if (Boolean.TRUE.equals(success)) {\n                isLocked = true;\n                // \u542F\u52A8\u770B\u95E8\u72D7\u4EFB\u52A1\n                startWatchdog();\n                return true;\n            }\n            \n            try {\n                Thread.sleep(10);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return false;\n            }\n        }\n        \n        return false;\n    }\n    \n    /**\n     * \u542F\u52A8\u770B\u95E8\u72D7\u4EFB\u52A1\n     */\n    private void startWatchdog() {\n        // \u5728\u8FC7\u671F\u65F6\u95F4\u76841/3\u65F6\u5F00\u59CB\u7EED\u671F\n        long renewalInterval = expireTime / 3;\n        \n        renewalTask = scheduler.scheduleAtFixedRate(() -> {\n            if (isLocked) {\n                try {\n                    // \u68C0\u67E5\u9501\u662F\u5426\u4ECD\u7136\u5C5E\u4E8E\u5F53\u524D\u5BA2\u6237\u7AEF\n                    String currentValue = redisTemplate.opsForValue().get(lockKey);\n                    if (lockValue.equals(currentValue)) {\n                        // \u7EED\u671F\u9501\n                        redisTemplate.expire(lockKey, expireTime, TimeUnit.MILLISECONDS);\n                        log.debug("Lock renewed for key: " + lockKey);\n                    } else {\n                        // \u9501\u5DF2\u88AB\u5176\u4ED6\u5BA2\u6237\u7AEF\u83B7\u53D6\uFF0C\u505C\u6B62\u7EED\u671F\n                        isLocked = false;\n                        if (renewalTask != null) {\n                            renewalTask.cancel(false);\n                        }\n                    }\n                } catch (Exception e) {\n                    log.error("Error renewing lock: " + lockKey, e);\n                    isLocked = false;\n                    if (renewalTask != null) {\n                        renewalTask.cancel(false);\n                    }\n                }\n            }\n        }, renewalInterval, renewalInterval, TimeUnit.MILLISECONDS);\n    }\n    \n    /**\n     * \u91CA\u653E\u9501\n     */\n    public boolean releaseLock() {\n        if (!isLocked) {\n            return false;\n        }\n        \n        // \u505C\u6B62\u770B\u95E8\u72D7\u4EFB\u52A1\n        if (renewalTask != null) {\n            renewalTask.cancel(false);\n        }\n        \n        // \u91CA\u653E\u9501\n        String script = "if redis.call(\'get\', KEYS[1]) == ARGV[1] then " +\n                       "return redis.call(\'del\', KEYS[1]) " +\n                       "else return 0 end";\n        \n        Long result = redisTemplate.execute(\n            new DefaultRedisScript<>(script, Long.class),\n            Collections.singletonList(lockKey),\n            lockValue\n        );\n        \n        boolean released = Long.valueOf(1).equals(result);\n        if (released) {\n            isLocked = false;\n        }\n        \n        return released;\n    }\n    \n    /**\n     * \u5173\u95ED\u8D44\u6E90\n     */\n    public void close() {\n        if (renewalTask != null) {\n            renewalTask.cancel(false);\n        }\n        scheduler.shutdown();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"23-redlock\u7B97\u6CD5",children:"2.3 RedLock\u7B97\u6CD5"}),"\n",(0,r.jsx)(n.p,{children:"RedLock\u662FRedis\u5B98\u65B9\u63A8\u8350\u7684\u5206\u5E03\u5F0F\u9501\u7B97\u6CD5\uFF0C\u901A\u8FC7\u591A\u4E2A\u72EC\u7ACB\u7684Redis\u8282\u70B9\u6765\u63D0\u9AD8\u53EF\u9760\u6027\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="RedLock\u5B9E\u73B0\u793A\u4F8B"',children:'@Service\npublic class RedLockDistributedLock {\n    \n    private final List<RedisTemplate<String, String>> redisTemplates;\n    private final String lockKey;\n    private final String lockValue;\n    private final long expireTime;\n    private final int quorum;\n    \n    public RedLockDistributedLock(List<RedisTemplate<String, String>> redisTemplates, \n                                 String lockKey, long expireTime) {\n        this.redisTemplates = redisTemplates;\n        this.lockKey = lockKey;\n        this.lockValue = UUID.randomUUID().toString();\n        this.expireTime = expireTime;\n        this.quorum = redisTemplates.size() / 2 + 1; // \u591A\u6570\u6D3E\n    }\n    \n    /**\n     * \u5C1D\u8BD5\u83B7\u53D6\u9501\n     */\n    public boolean tryLock(long timeout, TimeUnit unit) {\n        long startTime = System.currentTimeMillis();\n        long timeoutMillis = unit.toMillis(timeout);\n        \n        while (System.currentTimeMillis() - startTime < timeoutMillis) {\n            long lockStartTime = System.currentTimeMillis();\n            \n            // \u5C1D\u8BD5\u5728\u6240\u6709Redis\u8282\u70B9\u4E0A\u83B7\u53D6\u9501\n            int successCount = 0;\n            for (RedisTemplate<String, String> redisTemplate : redisTemplates) {\n                try {\n                    Boolean success = redisTemplate.opsForValue()\n                        .setIfAbsent(lockKey, lockValue, expireTime, TimeUnit.MILLISECONDS);\n                    if (Boolean.TRUE.equals(success)) {\n                        successCount++;\n                    }\n                } catch (Exception e) {\n                    log.warn("Failed to acquire lock on Redis node", e);\n                }\n            }\n            \n            // \u68C0\u67E5\u662F\u5426\u83B7\u5F97\u591A\u6570\u6D3E\u652F\u6301\n            if (successCount >= quorum) {\n                // \u8BA1\u7B97\u9501\u7684\u6709\u6548\u65F6\u95F4\n                long lockTime = System.currentTimeMillis() - lockStartTime;\n                long validTime = expireTime - lockTime;\n                \n                if (validTime > 0) {\n                    return true; // \u83B7\u53D6\u9501\u6210\u529F\n                } else {\n                    // \u9501\u7684\u6709\u6548\u65F6\u95F4\u4E0D\u8DB3\uFF0C\u91CA\u653E\u6240\u6709\u9501\n                    releaseAllLocks();\n                }\n            } else {\n                // \u672A\u83B7\u5F97\u591A\u6570\u6D3E\u652F\u6301\uFF0C\u91CA\u653E\u5DF2\u83B7\u53D6\u7684\u9501\n                releaseAllLocks();\n            }\n            \n            // \u77ED\u6682\u7B49\u5F85\u540E\u91CD\u8BD5\n            try {\n                Thread.sleep(10);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return false;\n            }\n        }\n        \n        return false;\n    }\n    \n    /**\n     * \u91CA\u653E\u6240\u6709\u9501\n     */\n    private void releaseAllLocks() {\n        for (RedisTemplate<String, String> redisTemplate : redisTemplates) {\n            try {\n                String script = "if redis.call(\'get\', KEYS[1]) == ARGV[1] then " +\n                               "return redis.call(\'del\', KEYS[1]) " +\n                               "else return 0 end";\n                \n                redisTemplate.execute(\n                    new DefaultRedisScript<>(script, Long.class),\n                    Collections.singletonList(lockKey),\n                    lockValue\n                );\n            } catch (Exception e) {\n                log.warn("Failed to release lock on Redis node", e);\n            }\n        }\n    }\n    \n    /**\n     * \u91CA\u653E\u9501\n     */\n    public boolean releaseLock() {\n        return releaseAllLocks();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u83B7\u53D6\u9501\nBoolean ok = redis.opsForValue().setIfAbsent(k, v, java.time.Duration.ofSeconds(30));\n// \u91CA\u653E\u9501\uFF08Lua\uFF09\nString script = \"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end\";\nLong r = redis.execute(new org.springframework.data.redis.core.script.DefaultRedisScript<>(script, Long.class),\n        java.util.Collections.singletonList(k), v);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"24-redlock\u7684\u4F18\u7F3A\u70B9",children:"2.4 RedLock\u7684\u4F18\u7F3A\u70B9"}),"\n",(0,r.jsx)(n.h4,{id:"\u4F18\u70B9",children:"\u4F18\u70B9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9AD8\u53EF\u9760\u6027"}),"\uFF1A\u901A\u8FC7\u591A\u4E2A\u72EC\u7ACBRedis\u8282\u70B9\u63D0\u9AD8\u53EF\u7528\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5F3A\u4E00\u81F4\u6027"}),"\uFF1A\u9700\u8981\u591A\u6570\u6D3E\u8282\u70B9\u786E\u8BA4\uFF0C\u4FDD\u8BC1\u9501\u7684\u5B89\u5168\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5BB9\u9519\u80FD\u529B"}),"\uFF1A\u90E8\u5206\u8282\u70B9\u6545\u969C\u4E0D\u5F71\u54CD\u9501\u7684\u6B63\u5E38\u5DE5\u4F5C"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u7F3A\u70B9",children:"\u7F3A\u70B9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u590D\u6742\u6027\u9AD8"}),"\uFF1A\u9700\u8981\u7BA1\u7406\u591A\u4E2ARedis\u8282\u70B9"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6027\u80FD\u5F00\u9500"}),"\uFF1A\u9700\u8981\u4E0E\u591A\u4E2A\u8282\u70B9\u901A\u4FE1\uFF0C\u589E\u52A0\u5EF6\u8FDF"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u65F6\u949F\u4F9D\u8D56"}),"\uFF1A\u5BF9\u65F6\u949F\u540C\u6B65\u8981\u6C42\u8F83\u9AD8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8D44\u6E90\u6D88\u8017"}),"\uFF1A\u9700\u8981\u66F4\u591A\u7684Redis\u5B9E\u4F8B"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"RedLock\u4E89\u8BAE",type:"caution",children:(0,r.jsx)(n.p,{children:"RedLock\u7B97\u6CD5\u5728\u5B66\u672F\u754C\u5B58\u5728\u4E89\u8BAE\uFF0C\u4E3B\u8981\u95EE\u9898\u662F\u65F6\u949F\u6F02\u79FB\u53EF\u80FD\u5BFC\u81F4\u9501\u7684\u5B89\u5168\u6027\u65E0\u6CD5\u4FDD\u8BC1\u3002\u5728\u5B9E\u9645\u4F7F\u7528\u4E2D\u9700\u8981\u8C28\u614E\u8BC4\u4F30\u3002"})}),"\n",(0,r.jsx)(n.h2,{id:"3-zookeeper\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",children:"3. Zookeeper\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0"}),"\n",(0,r.jsx)(n.h3,{id:"31-\u57FA\u672C\u539F\u7406",children:"3.1 \u57FA\u672C\u539F\u7406"}),"\n",(0,r.jsx)(n.p,{children:"Zookeeper\u5206\u5E03\u5F0F\u9501\u57FA\u4E8E\u4E34\u65F6\u987A\u5E8F\u8282\u70B9\u5B9E\u73B0\uFF0C\u5177\u6709\u5F3A\u4E00\u81F4\u6027\u548C\u81EA\u52A8\u91CA\u653E\u7684\u7279\u70B9\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u6838\u5FC3\u673A\u5236",children:"\u6838\u5FC3\u673A\u5236"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4E34\u65F6\u8282\u70B9"}),"\uFF1A\u5BA2\u6237\u7AEF\u65AD\u5F00\u8FDE\u63A5\u65F6\u81EA\u52A8\u5220\u9664"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u987A\u5E8F\u8282\u70B9"}),"\uFF1A\u4FDD\u8BC1\u83B7\u53D6\u9501\u7684\u516C\u5E73\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u76D1\u542C\u673A\u5236"}),"\uFF1A\u76D1\u542C\u524D\u9A71\u8282\u70B9\u53D8\u5316\uFF0C\u5B9E\u73B0\u963B\u585E\u7B49\u5F85"]}),"\n"]}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    A[\u5BA2\u6237\u7AEFA\u8BF7\u6C42\u9501] --\x3e B[\u521B\u5EFA\u4E34\u65F6\u987A\u5E8F\u8282\u70B9]\n    B --\x3e C[\u68C0\u67E5\u662F\u5426\u4E3A\u6700\u5C0F\u5E8F\u53F7]\n    C --\x3e|\u662F| D[\u83B7\u53D6\u9501\u6210\u529F]\n    C --\x3e|\u5426| E[\u76D1\u542C\u524D\u9A71\u8282\u70B9]\n    E --\x3e F[\u524D\u9A71\u8282\u70B9\u5220\u9664]\n    F --\x3e G[\u91CD\u65B0\u68C0\u67E5\u5E8F\u53F7]\n    G --\x3e C\n    \n    H[\u5BA2\u6237\u7AEFB\u8BF7\u6C42\u9501] --\x3e I[\u521B\u5EFA\u4E34\u65F6\u987A\u5E8F\u8282\u70B9]\n    I --\x3e J[\u68C0\u67E5\u662F\u5426\u4E3A\u6700\u5C0F\u5E8F\u53F7]\n    J --\x3e|\u662F| K[\u83B7\u53D6\u9501\u6210\u529F]\n    J --\x3e|\u5426| L[\u76D1\u542C\u524D\u9A71\u8282\u70B9]\n    L --\x3e M[\u524D\u9A71\u8282\u70B9\u5220\u9664]\n    M --\x3e N[\u91CD\u65B0\u68C0\u67E5\u5E8F\u53F7]\n    N --\x3e J"}),"\n",(0,r.jsx)(n.h3,{id:"32-\u5B9E\u73B0\u4EE3\u7801",children:"3.2 \u5B9E\u73B0\u4EE3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="Zookeeper\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0"',children:'@Service\npublic class ZookeeperDistributedLock {\n    \n    private final CuratorFramework client;\n    private final String lockPath;\n    private final String lockName;\n    private InterProcessMutex mutex;\n    \n    public ZookeeperDistributedLock(CuratorFramework client, String lockPath, String lockName) {\n        this.client = client;\n        this.lockPath = lockPath;\n        this.lockName = lockName;\n        this.mutex = new InterProcessMutex(client, lockPath + "/" + lockName);\n    }\n    \n    /**\n     * \u5C1D\u8BD5\u83B7\u53D6\u9501\n     */\n    public boolean tryLock(long timeout, TimeUnit unit) {\n        try {\n            return mutex.acquire(timeout, unit);\n        } catch (Exception e) {\n            log.error("Failed to acquire lock: " + lockName, e);\n            return false;\n        }\n    }\n    \n    /**\n     * \u91CA\u653E\u9501\n     */\n    public boolean releaseLock() {\n        try {\n            if (mutex.isAcquiredInThisProcess()) {\n                mutex.release();\n                return true;\n            }\n            return false;\n        } catch (Exception e) {\n            log.error("Failed to release lock: " + lockName, e);\n            return false;\n        }\n    }\n    \n    /**\n     * \u68C0\u67E5\u662F\u5426\u6301\u6709\u9501\n     */\n    public boolean isLocked() {\n        return mutex.isAcquiredInThisProcess();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"33-\u624B\u52A8\u5B9E\u73B0zookeeper\u9501",children:"3.3 \u624B\u52A8\u5B9E\u73B0Zookeeper\u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u624B\u52A8\u5B9E\u73B0Zookeeper\u5206\u5E03\u5F0F\u9501"',children:'@Service\npublic class ManualZookeeperLock {\n    \n    private final CuratorFramework client;\n    private final String lockPath;\n    private final String lockName;\n    private String currentNode;\n    private final CountDownLatch lockLatch = new CountDownLatch(1);\n    \n    public ManualZookeeperLock(CuratorFramework client, String lockPath, String lockName) {\n        this.client = client;\n        this.lockPath = lockPath;\n        this.lockName = lockName;\n    }\n    \n    /**\n     * \u5C1D\u8BD5\u83B7\u53D6\u9501\n     */\n    public boolean tryLock(long timeout, TimeUnit unit) {\n        try {\n            // 1. \u521B\u5EFA\u4E34\u65F6\u987A\u5E8F\u8282\u70B9\n            currentNode = client.create()\n                .withMode(CreateMode.EPHEMERAL_SEQUENTIAL)\n                .forPath(lockPath + "/" + lockName + "-");\n            \n            // 2. \u83B7\u53D6\u6240\u6709\u5B50\u8282\u70B9\n            List<String> children = client.getChildren().forPath(lockPath);\n            children.sort(String::compareTo);\n            \n            // 3. \u68C0\u67E5\u5F53\u524D\u8282\u70B9\u662F\u5426\u4E3A\u6700\u5C0F\u5E8F\u53F7\n            String nodeName = currentNode.substring(currentNode.lastIndexOf(\'/\') + 1);\n            if (children.get(0).equals(nodeName)) {\n                return true; // \u83B7\u53D6\u9501\u6210\u529F\n            }\n            \n            // 4. \u76D1\u542C\u524D\u9A71\u8282\u70B9\n            String previousNode = getPreviousNode(children, nodeName);\n            if (previousNode != null) {\n                // \u8BBE\u7F6E\u76D1\u542C\u5668\n                NodeCache nodeCache = new NodeCache(client, lockPath + "/" + previousNode);\n                nodeCache.getListenable().addListener(() -> {\n                    if (nodeCache.getCurrentData() == null) {\n                        lockLatch.countDown(); // \u524D\u9A71\u8282\u70B9\u5220\u9664\uFF0C\u901A\u77E5\u7B49\u5F85\u7EBF\u7A0B\n                    }\n                });\n                nodeCache.start();\n                \n                // \u7B49\u5F85\u524D\u9A71\u8282\u70B9\u5220\u9664\n                return lockLatch.await(timeout, unit);\n            }\n            \n            return false;\n        } catch (Exception e) {\n            log.error("Failed to acquire lock: " + lockName, e);\n            return false;\n        }\n    }\n    \n    /**\n     * \u83B7\u53D6\u524D\u9A71\u8282\u70B9\n     */\n    private String getPreviousNode(List<String> children, String currentNode) {\n        int index = children.indexOf(currentNode);\n        if (index > 0) {\n            return children.get(index - 1);\n        }\n        return null;\n    }\n    \n    /**\n     * \u91CA\u653E\u9501\n     */\n    public boolean releaseLock() {\n        try {\n            if (currentNode != null) {\n                client.delete().forPath(currentNode);\n                return true;\n            }\n            return false;\n        } catch (Exception e) {\n            log.error("Failed to release lock: " + lockName, e);\n            return false;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"34-zookeeper\u9501\u7684\u7279\u70B9",children:"3.4 Zookeeper\u9501\u7684\u7279\u70B9"}),"\n",(0,r.jsx)(n.h4,{id:"\u4F18\u70B9-1",children:"\u4F18\u70B9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5F3A\u4E00\u81F4\u6027"}),"\uFF1A\u57FA\u4E8EZookeeper\u7684\u5F3A\u4E00\u81F4\u6027\u4FDD\u8BC1"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u81EA\u52A8\u91CA\u653E"}),"\uFF1A\u5BA2\u6237\u7AEF\u65AD\u5F00\u8FDE\u63A5\u65F6\u81EA\u52A8\u91CA\u653E\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u516C\u5E73\u6027"}),"\uFF1A\u57FA\u4E8E\u987A\u5E8F\u8282\u70B9\uFF0C\u4FDD\u8BC1\u83B7\u53D6\u9501\u7684\u516C\u5E73\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53EF\u9760\u6027"}),"\uFF1AZookeeper\u7684\u9AD8\u53EF\u7528\u6027\u4FDD\u8BC1\u9501\u670D\u52A1\u7684\u53EF\u9760\u6027"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u7F3A\u70B9-1",children:"\u7F3A\u70B9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6027\u80FD\u8F83\u4F4E"}),"\uFF1A\u76F8\u6BD4Redis\u9501\uFF0C\u6027\u80FD\u8F83\u4F4E"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u590D\u6742\u6027"}),"\uFF1A\u9700\u8981\u7EF4\u62A4Zookeeper\u96C6\u7FA4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7F51\u7EDC\u5F00\u9500"}),"\uFF1A\u6BCF\u6B21\u64CD\u4F5C\u90FD\u9700\u8981\u7F51\u7EDC\u901A\u4FE1"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"4-\u6570\u636E\u5E93\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0",children:"4. \u6570\u636E\u5E93\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0"}),"\n",(0,r.jsx)(n.h3,{id:"41-\u57FA\u4E8E\u552F\u4E00\u7D22\u5F15\u7684\u9501",children:"4.1 \u57FA\u4E8E\u552F\u4E00\u7D22\u5F15\u7684\u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u6570\u636E\u5E93\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0"',children:'@Service\npublic class DatabaseDistributedLock {\n    \n    private final JdbcTemplate jdbcTemplate;\n    private final String lockKey;\n    private final String owner;\n    \n    public DatabaseDistributedLock(JdbcTemplate jdbcTemplate, String lockKey, String owner) {\n        this.jdbcTemplate = jdbcTemplate;\n        this.lockKey = lockKey;\n        this.owner = owner;\n    }\n    \n    /**\n     * \u5C1D\u8BD5\u83B7\u53D6\u9501\n     */\n    public boolean tryLock(long timeout, TimeUnit unit) {\n        long startTime = System.currentTimeMillis();\n        long timeoutMillis = unit.toMillis(timeout);\n        \n        while (System.currentTimeMillis() - startTime < timeoutMillis) {\n            try {\n                // \u5C1D\u8BD5\u63D2\u5165\u9501\u8BB0\u5F55\n                String sql = "INSERT INTO distributed_lock (lock_key, owner, expire_at) VALUES (?, ?, ?)";\n                long expireAt = System.currentTimeMillis() + timeoutMillis;\n                \n                jdbcTemplate.update(sql, lockKey, owner, expireAt);\n                return true; // \u63D2\u5165\u6210\u529F\uFF0C\u83B7\u53D6\u9501\n                \n            } catch (DuplicateKeyException e) {\n                // \u9501\u5DF2\u5B58\u5728\uFF0C\u68C0\u67E5\u662F\u5426\u8FC7\u671F\n                if (isLockExpired()) {\n                    // \u5220\u9664\u8FC7\u671F\u9501\u5E76\u91CD\u8BD5\n                    releaseExpiredLock();\n                    continue;\n                }\n                \n                // \u9501\u672A\u8FC7\u671F\uFF0C\u7B49\u5F85\u540E\u91CD\u8BD5\n                try {\n                    Thread.sleep(100);\n                } catch (InterruptedException ie) {\n                    Thread.currentThread().interrupt();\n                    return false;\n                }\n            }\n        }\n        \n        return false; // \u8D85\u65F6\u672A\u83B7\u53D6\u5230\u9501\n    }\n    \n    /**\n     * \u68C0\u67E5\u9501\u662F\u5426\u8FC7\u671F\n     */\n    private boolean isLockExpired() {\n        String sql = "SELECT expire_at FROM distributed_lock WHERE lock_key = ?";\n        try {\n            Long expireAt = jdbcTemplate.queryForObject(sql, Long.class, lockKey);\n            return expireAt != null && expireAt < System.currentTimeMillis();\n        } catch (EmptyResultDataAccessException e) {\n            return true; // \u9501\u4E0D\u5B58\u5728\uFF0C\u89C6\u4E3A\u8FC7\u671F\n        }\n    }\n    \n    /**\n     * \u91CA\u653E\u8FC7\u671F\u9501\n     */\n    private void releaseExpiredLock() {\n        String sql = "DELETE FROM distributed_lock WHERE lock_key = ? AND expire_at < ?";\n        jdbcTemplate.update(sql, lockKey, System.currentTimeMillis());\n    }\n    \n    /**\n     * \u91CA\u653E\u9501\n     */\n    public boolean releaseLock() {\n        String sql = "DELETE FROM distributed_lock WHERE lock_key = ? AND owner = ?";\n        int rows = jdbcTemplate.update(sql, lockKey, owner);\n        return rows > 0;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"42-\u6570\u636E\u5E93\u9501\u8868\u7ED3\u6784",children:"4.2 \u6570\u636E\u5E93\u9501\u8868\u7ED3\u6784"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",metastring:'title="\u5206\u5E03\u5F0F\u9501\u8868\u7ED3\u6784"',children:"CREATE TABLE distributed_lock (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    lock_key VARCHAR(128) NOT NULL UNIQUE,\n    owner VARCHAR(64) NOT NULL,\n    expire_at BIGINT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n    INDEX idx_lock_key (lock_key),\n    INDEX idx_expire_at (expire_at)\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"43-\u6570\u636E\u5E93\u9501\u7684\u7279\u70B9",children:"4.3 \u6570\u636E\u5E93\u9501\u7684\u7279\u70B9"}),"\n",(0,r.jsx)(n.h4,{id:"\u4F18\u70B9-2",children:"\u4F18\u70B9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5B9E\u73B0\u7B80\u5355"}),"\uFF1A\u57FA\u4E8E\u6570\u636E\u5E93\uFF0C\u5B9E\u73B0\u76F8\u5BF9\u7B80\u5355"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5F3A\u4E00\u81F4\u6027"}),"\uFF1A\u5229\u7528\u6570\u636E\u5E93\u7684\u4E8B\u52A1\u7279\u6027\u4FDD\u8BC1\u4E00\u81F4\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53EF\u9760\u6027\u9AD8"}),"\uFF1A\u6570\u636E\u5E93\u7684\u9AD8\u53EF\u7528\u6027\u4FDD\u8BC1\u9501\u7684\u53EF\u9760\u6027"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u7F3A\u70B9-2",children:"\u7F3A\u70B9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6027\u80FD\u8F83\u4F4E"}),"\uFF1A\u6570\u636E\u5E93\u64CD\u4F5C\u76F8\u5BF9\u8F83\u6162"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5355\u70B9\u74F6\u9888"}),"\uFF1A\u5BB9\u6613\u6210\u4E3A\u7CFB\u7EDF\u74F6\u9888"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8D44\u6E90\u6D88\u8017"}),"\uFF1A\u5360\u7528\u6570\u636E\u5E93\u8FDE\u63A5\u548C\u8D44\u6E90"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"5-\u5206\u5E03\u5F0F\u9501\u9009\u578B\u5BF9\u6BD4",children:"5. \u5206\u5E03\u5F0F\u9501\u9009\u578B\u5BF9\u6BD4"}),"\n",(0,r.jsx)(n.h3,{id:"51-\u6280\u672F\u65B9\u6848\u5BF9\u6BD4",children:"5.1 \u6280\u672F\u65B9\u6848\u5BF9\u6BD4"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7279\u6027"}),(0,r.jsx)(n.th,{children:"Redis\u9501"}),(0,r.jsx)(n.th,{children:"Zookeeper\u9501"}),(0,r.jsx)(n.th,{children:"\u6570\u636E\u5E93\u9501"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u6027\u80FD"})}),(0,r.jsx)(n.td,{children:"\u6781\u9AD8"}),(0,r.jsx)(n.td,{children:"\u4E2D\u7B49"}),(0,r.jsx)(n.td,{children:"\u8F83\u4F4E"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u4E00\u81F4\u6027"})}),(0,r.jsx)(n.td,{children:"\u6700\u7EC8\u4E00\u81F4"}),(0,r.jsx)(n.td,{children:"\u5F3A\u4E00\u81F4"}),(0,r.jsx)(n.td,{children:"\u5F3A\u4E00\u81F4"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u53EF\u9760\u6027"})}),(0,r.jsx)(n.td,{children:"\u4E2D\u7B49"}),(0,r.jsx)(n.td,{children:"\u9AD8"}),(0,r.jsx)(n.td,{children:"\u9AD8"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u5B9E\u73B0\u590D\u6742\u5EA6"})}),(0,r.jsx)(n.td,{children:"\u7B80\u5355"}),(0,r.jsx)(n.td,{children:"\u4E2D\u7B49"}),(0,r.jsx)(n.td,{children:"\u7B80\u5355"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u81EA\u52A8\u91CA\u653E"})}),(0,r.jsx)(n.td,{children:"\u9700\u8981TTL"}),(0,r.jsx)(n.td,{children:"\u81EA\u52A8"}),(0,r.jsx)(n.td,{children:"\u9700\u8981TTL"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u516C\u5E73\u6027"})}),(0,r.jsx)(n.td,{children:"\u65E0"}),(0,r.jsx)(n.td,{children:"\u6709"}),(0,r.jsx)(n.td,{children:"\u65E0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u53EF\u91CD\u5165"})}),(0,r.jsx)(n.td,{children:"\u9700\u8981\u5B9E\u73B0"}),(0,r.jsx)(n.td,{children:"\u652F\u6301"}),(0,r.jsx)(n.td,{children:"\u9700\u8981\u5B9E\u73B0"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"52-\u9009\u578B\u5EFA\u8BAE",children:"5.2 \u9009\u578B\u5EFA\u8BAE"}),"\n",(0,r.jsx)(n.h4,{id:"\u9009\u62E9redis\u9501\u7684\u573A\u666F",children:"\u9009\u62E9Redis\u9501\u7684\u573A\u666F"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9AD8\u6027\u80FD\u8981\u6C42"}),"\uFF1A\u5BF9\u9501\u7684\u6027\u80FD\u8981\u6C42\u6781\u9AD8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7B80\u5355\u4E1A\u52A1"}),"\uFF1A\u4E1A\u52A1\u903B\u8F91\u76F8\u5BF9\u7B80\u5355\uFF0C\u4E0D\u9700\u8981\u5F3A\u4E00\u81F4\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5FEB\u901F\u5B9E\u73B0"}),"\uFF1A\u9700\u8981\u5FEB\u901F\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501\u529F\u80FD"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5927\u89C4\u6A21\u90E8\u7F72"}),"\uFF1A\u9700\u8981\u652F\u6301\u5927\u89C4\u6A21\u5E76\u53D1\u8BBF\u95EE"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u9009\u62E9zookeeper\u9501\u7684\u573A\u666F",children:"\u9009\u62E9Zookeeper\u9501\u7684\u573A\u666F"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5F3A\u4E00\u81F4\u6027\u8981\u6C42"}),"\uFF1A\u5BF9\u6570\u636E\u4E00\u81F4\u6027\u8981\u6C42\u6781\u9AD8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u590D\u6742\u4E1A\u52A1"}),"\uFF1A\u4E1A\u52A1\u903B\u8F91\u590D\u6742\uFF0C\u9700\u8981\u53EF\u9760\u7684\u9501\u673A\u5236"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u516C\u5E73\u6027\u8981\u6C42"}),"\uFF1A\u9700\u8981\u4FDD\u8BC1\u83B7\u53D6\u9501\u7684\u516C\u5E73\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u81EA\u52A8\u91CA\u653E"}),"\uFF1A\u5E0C\u671B\u9501\u80FD\u591F\u81EA\u52A8\u91CA\u653E\uFF0C\u907F\u514D\u6B7B\u9501"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u9009\u62E9\u6570\u636E\u5E93\u9501\u7684\u573A\u666F",children:"\u9009\u62E9\u6570\u636E\u5E93\u9501\u7684\u573A\u666F"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7B80\u5355\u5B9E\u73B0"}),"\uFF1A\u5E0C\u671B\u7528\u6700\u7B80\u5355\u7684\u65B9\u5F0F\u5B9E\u73B0\u5206\u5E03\u5F0F\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5C0F\u89C4\u6A21\u5E94\u7528"}),"\uFF1A\u5E94\u7528\u89C4\u6A21\u8F83\u5C0F\uFF0C\u6027\u80FD\u8981\u6C42\u4E0D\u9AD8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8FC7\u6E21\u65B9\u6848"}),"\uFF1A\u4F5C\u4E3A\u4E34\u65F6\u6216\u8FC7\u6E21\u7684\u5206\u5E03\u5F0F\u9501\u65B9\u6848"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5DF2\u6709\u6570\u636E\u5E93"}),"\uFF1A\u7CFB\u7EDF\u4E2D\u5DF2\u7ECF\u6709\u6570\u636E\u5E93\uFF0C\u4E0D\u60F3\u5F15\u5165\u989D\u5916\u7EC4\u4EF6"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"6-\u5206\u5E03\u5F0F\u9501\u6700\u4F73\u5B9E\u8DF5",children:"6. \u5206\u5E03\u5F0F\u9501\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,r.jsx)(n.h3,{id:"61-\u9501\u7684\u8BBE\u8BA1\u539F\u5219",children:"6.1 \u9501\u7684\u8BBE\u8BA1\u539F\u5219"}),"\n",(0,r.jsx)(n.h4,{id:"\u9501\u7C92\u5EA6\u8BBE\u8BA1",children:"\u9501\u7C92\u5EA6\u8BBE\u8BA1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u9501\u7C92\u5EA6\u8BBE\u8BA1\u793A\u4F8B"',children:'public class LockGranularityExample {\n    \n    // \u7C97\u7C92\u5EA6\u9501\uFF1A\u6574\u4E2A\u7528\u6237\u7EA7\u522B\u7684\u9501\n    public void processUserData(String userId) {\n        String lockKey = "user:lock:" + userId;\n        // \u4F7F\u7528\u5206\u5E03\u5F0F\u9501\u4FDD\u62A4\u6574\u4E2A\u7528\u6237\u6570\u636E\u5904\u7406\u8FC7\u7A0B\n    }\n    \n    // \u7EC6\u7C92\u5EA6\u9501\uFF1A\u5177\u4F53\u64CD\u4F5C\u7EA7\u522B\u7684\u9501\n    public void updateUserBalance(String userId, String operation) {\n        String lockKey = "user:balance:lock:" + userId + ":" + operation;\n        // \u53EA\u9501\u5B9A\u5177\u4F53\u7684\u4F59\u989D\u64CD\u4F5C\n    }\n    \n    // \u5206\u5C42\u9501\uFF1A\u591A\u7EA7\u9501\u4FDD\u62A4\n    public void complexOperation(String userId, String resourceId) {\n        // \u5148\u83B7\u53D6\u7528\u6237\u9501\n        String userLockKey = "user:lock:" + userId;\n        // \u518D\u83B7\u53D6\u8D44\u6E90\u9501\n        String resourceLockKey = "resource:lock:" + resourceId;\n        // \u907F\u514D\u6B7B\u9501\uFF1A\u6309\u56FA\u5B9A\u987A\u5E8F\u83B7\u53D6\u9501\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u9501\u8D85\u65F6\u8BBE\u7F6E",children:"\u9501\u8D85\u65F6\u8BBE\u7F6E"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u9501\u8D85\u65F6\u8BBE\u7F6E\u793A\u4F8B"',children:"public class LockTimeoutExample {\n    \n    // \u6839\u636E\u4E1A\u52A1\u590D\u6742\u5EA6\u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4\n    public void processSimpleTask() {\n        // \u7B80\u5355\u4EFB\u52A1\uFF1A30\u79D2\u8D85\u65F6\n        long timeout = 30_000;\n    }\n    \n    public void processComplexTask() {\n        // \u590D\u6742\u4EFB\u52A1\uFF1A5\u5206\u949F\u8D85\u65F6\n        long timeout = 5 * 60 * 1000;\n    }\n    \n    public void processBatchTask() {\n        // \u6279\u91CF\u4EFB\u52A1\uFF1A30\u5206\u949F\u8D85\u65F6\n        long timeout = 30 * 60 * 1000;\n    }\n    \n    // \u52A8\u6001\u8D85\u65F6\u8BBE\u7F6E\n    public long calculateTimeout(int dataSize, int complexity) {\n        long baseTimeout = 10_000; // \u57FA\u7840\u8D85\u65F6\u65F6\u95F4\n        long dataTimeout = dataSize * 100; // \u6570\u636E\u91CF\u76F8\u5173\u8D85\u65F6\n        long complexityTimeout = complexity * 5_000; // \u590D\u6742\u5EA6\u76F8\u5173\u8D85\u65F6\n        return baseTimeout + dataTimeout + complexityTimeout;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"62-\u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848",children:"6.2 \u5E38\u89C1\u95EE\u9898\u4E0E\u89E3\u51B3\u65B9\u6848"}),"\n",(0,r.jsx)(n.h4,{id:"\u8BEF\u5220\u9501\u95EE\u9898",children:"\u8BEF\u5220\u9501\u95EE\u9898"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u9632\u6B62\u8BEF\u5220\u9501\u793A\u4F8B"',children:'public class SafeLockRelease {\n    \n    public boolean safeReleaseLock(String lockKey, String lockValue) {\n        // \u4F7F\u7528Lua\u811A\u672C\u4FDD\u8BC1\u539F\u5B50\u6027\u68C0\u67E5\u548C\u5220\u9664\n        String script = "if redis.call(\'get\', KEYS[1]) == ARGV[1] then " +\n                       "return redis.call(\'del\', KEYS[1]) " +\n                       "else return 0 end";\n        \n        Long result = redisTemplate.execute(\n            new DefaultRedisScript<>(script, Long.class),\n            Collections.singletonList(lockKey),\n            lockValue\n        );\n        \n        return Long.valueOf(1).equals(result);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u53EF\u91CD\u5165\u9501\u5B9E\u73B0",children:"\u53EF\u91CD\u5165\u9501\u5B9E\u73B0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u53EF\u91CD\u5165\u9501\u5B9E\u73B0\u793A\u4F8B"',children:'public class ReentrantDistributedLock {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final String lockKey;\n    private final String lockValue;\n    private final ThreadLocal<Integer> lockCount = new ThreadLocal<>();\n    \n    public boolean tryLock(long timeout, TimeUnit unit) {\n        Integer count = lockCount.get();\n        if (count != null && count > 0) {\n            // \u5F53\u524D\u7EBF\u7A0B\u5DF2\u6301\u6709\u9501\uFF0C\u589E\u52A0\u8BA1\u6570\n            lockCount.set(count + 1);\n            return true;\n        }\n        \n        // \u5C1D\u8BD5\u83B7\u53D6\u9501\n        Boolean success = redisTemplate.opsForValue()\n            .setIfAbsent(lockKey, lockValue + ":1", timeout, unit);\n        \n        if (Boolean.TRUE.equals(success)) {\n            lockCount.set(1);\n            return true;\n        }\n        \n        return false;\n    }\n    \n    public boolean releaseLock() {\n        Integer count = lockCount.get();\n        if (count == null || count <= 0) {\n            return false;\n        }\n        \n        if (count == 1) {\n            // \u6700\u540E\u4E00\u6B21\u91CA\u653E\uFF0C\u5220\u9664\u9501\n            lockCount.remove();\n            return safeReleaseLock(lockKey, lockValue + ":1");\n        } else {\n            // \u51CF\u5C11\u8BA1\u6570\n            lockCount.set(count - 1);\n            return true;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u8BFB\u5199\u9501\u5B9E\u73B0",children:"\u8BFB\u5199\u9501\u5B9E\u73B0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u8BFB\u5199\u9501\u5B9E\u73B0\u793A\u4F8B"',children:'public class ReadWriteDistributedLock {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final String lockKey;\n    private final String clientId;\n    \n    public boolean tryReadLock(long timeout, TimeUnit unit) {\n        String readLockKey = lockKey + ":read";\n        String writeLockKey = lockKey + ":write";\n        \n        // \u68C0\u67E5\u662F\u5426\u6709\u5199\u9501\n        String writeLock = redisTemplate.opsForValue().get(writeLockKey);\n        if (writeLock != null && !writeLock.equals(clientId)) {\n            return false; // \u6709\u5199\u9501\u4E14\u4E0D\u662F\u5F53\u524D\u5BA2\u6237\u7AEF\n        }\n        \n        // \u5C1D\u8BD5\u83B7\u53D6\u8BFB\u9501\n        return redisTemplate.opsForValue()\n            .setIfAbsent(readLockKey + ":" + clientId, "1", timeout, unit);\n    }\n    \n    public boolean tryWriteLock(long timeout, TimeUnit unit) {\n        String readLockKey = lockKey + ":read";\n        String writeLockKey = lockKey + ":write";\n        \n        // \u68C0\u67E5\u662F\u5426\u6709\u8BFB\u9501\n        Set<String> readLocks = redisTemplate.keys(readLockKey + ":*");\n        if (!readLocks.isEmpty()) {\n            return false; // \u6709\u8BFB\u9501\u5B58\u5728\n        }\n        \n        // \u5C1D\u8BD5\u83B7\u53D6\u5199\u9501\n        return redisTemplate.opsForValue()\n            .setIfAbsent(writeLockKey, clientId, timeout, unit);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"63-\u76D1\u63A7\u4E0E\u544A\u8B66",children:"6.3 \u76D1\u63A7\u4E0E\u544A\u8B66"}),"\n",(0,r.jsx)(n.h4,{id:"\u9501\u76D1\u63A7\u6307\u6807",children:"\u9501\u76D1\u63A7\u6307\u6807"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u9501\u76D1\u63A7\u793A\u4F8B"',children:'@Component\npublic class LockMonitorService {\n    \n    private final MeterRegistry meterRegistry;\n    \n    public void recordLockAcquisition(String lockKey, long duration, boolean success) {\n        // \u8BB0\u5F55\u9501\u83B7\u53D6\u6B21\u6570\n        Counter.builder("distributed_lock.acquisitions")\n            .tag("lock_key", lockKey)\n            .tag("result", success ? "success" : "failure")\n            .register(meterRegistry)\n            .increment();\n        \n        // \u8BB0\u5F55\u9501\u83B7\u53D6\u65F6\u95F4\n        Timer.builder("distributed_lock.acquisition_time")\n            .tag("lock_key", lockKey)\n            .register(meterRegistry)\n            .record(duration, TimeUnit.MILLISECONDS);\n    }\n    \n    public void recordLockHoldingTime(String lockKey, long duration) {\n        // \u8BB0\u5F55\u9501\u6301\u6709\u65F6\u95F4\n        Timer.builder("distributed_lock.holding_time")\n            .tag("lock_key", lockKey)\n            .register(meterRegistry)\n            .record(duration, TimeUnit.MILLISECONDS);\n    }\n    \n    @Scheduled(fixedRate = 60000) // \u6BCF\u5206\u949F\u68C0\u67E5\u4E00\u6B21\n    public void checkLockHealth() {\n        // \u68C0\u67E5\u9501\u7684\u5065\u5EB7\u72B6\u6001\n        // \u4F8B\u5982\uFF1A\u68C0\u67E5\u662F\u5426\u6709\u957F\u65F6\u95F4\u672A\u91CA\u653E\u7684\u9501\n        // \u68C0\u67E5\u9501\u7684\u83B7\u53D6\u5931\u8D25\u7387\u7B49\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"7-\u5206\u5E03\u5F0F\u9501\u9762\u8BD5\u9898\u7CBE\u9009",children:"7. \u5206\u5E03\u5F0F\u9501\u9762\u8BD5\u9898\u7CBE\u9009"}),"\n",(0,r.jsx)(n.h3,{id:"71-\u57FA\u7840\u6982\u5FF5",children:"7.1 \u57FA\u7840\u6982\u5FF5"}),"\n",(0,r.jsx)(n.h4,{id:"q1-\u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u9501\u4E3A\u4EC0\u4E48\u9700\u8981\u5206\u5E03\u5F0F\u9501",children:"Q1: \u4EC0\u4E48\u662F\u5206\u5E03\u5F0F\u9501\uFF1F\u4E3A\u4EC0\u4E48\u9700\u8981\u5206\u5E03\u5F0F\u9501\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": \u5206\u5E03\u5F0F\u9501\u662F\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u4E00\u79CD\u540C\u6B65\u673A\u5236\uFF0C\u7528\u4E8E\u5728\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u5B9E\u73B0\u4E34\u754C\u8D44\u6E90\u7684\u4E92\u65A5\u8BBF\u95EE\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4E3A\u4EC0\u4E48\u9700\u8981\u5206\u5E03\u5F0F\u9501"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8D44\u6E90\u4FDD\u62A4"}),"\uFF1A\u9632\u6B62\u591A\u4E2A\u8FDB\u7A0B\u540C\u65F6\u8BBF\u95EE\u5171\u4EAB\u8D44\u6E90"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6570\u636E\u4E00\u81F4\u6027"}),"\uFF1A\u786E\u4FDD\u5206\u5E03\u5F0F\u73AF\u5883\u4E0B\u7684\u6570\u636E\u64CD\u4F5C\u539F\u5B50\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4E1A\u52A1\u5B89\u5168"}),"\uFF1A\u907F\u514D\u91CD\u590D\u5904\u7406\u3001\u8D85\u5356\u7B49\u4E1A\u52A1\u95EE\u9898"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7CFB\u7EDF\u7A33\u5B9A"}),"\uFF1A\u9632\u6B62\u5E76\u53D1\u64CD\u4F5C\u5BFC\u81F4\u7684\u7CFB\u7EDF\u5F02\u5E38"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"q2-\u5206\u5E03\u5F0F\u9501\u9700\u8981\u6EE1\u8DB3\u54EA\u4E9B\u57FA\u672C\u8981\u6C42",children:"Q2: \u5206\u5E03\u5F0F\u9501\u9700\u8981\u6EE1\u8DB3\u54EA\u4E9B\u57FA\u672C\u8981\u6C42\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": \u5206\u5E03\u5F0F\u9501\u9700\u8981\u6EE1\u8DB3\u4EE5\u4E0B\u57FA\u672C\u8981\u6C42\uFF1A"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4E92\u65A5\u6027"}),"\uFF1A\u540C\u4E00\u65F6\u95F4\u53EA\u80FD\u6709\u4E00\u4E2A\u5BA2\u6237\u7AEF\u6301\u6709\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9632\u6B7B\u9501"}),"\uFF1A\u9501\u5FC5\u987B\u80FD\u591F\u81EA\u52A8\u91CA\u653E\uFF0C\u907F\u514D\u6B7B\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53EF\u91CD\u5165\u6027"}),"\uFF1A\u540C\u4E00\u5BA2\u6237\u7AEF\u53EF\u4EE5\u591A\u6B21\u83B7\u53D6\u540C\u4E00\u628A\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9AD8\u6027\u80FD"}),"\uFF1A\u83B7\u53D6\u548C\u91CA\u653E\u9501\u7684\u64CD\u4F5C\u8981\u5FEB\u901F"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9AD8\u53EF\u7528"}),"\uFF1A\u9501\u670D\u52A1\u672C\u8EAB\u8981\u5177\u5907\u9AD8\u53EF\u7528\u6027"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"72-redis\u5206\u5E03\u5F0F\u9501",children:"7.2 Redis\u5206\u5E03\u5F0F\u9501"}),"\n",(0,r.jsx)(n.h4,{id:"q3-redis\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48",children:"Q3: Redis\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": Redis\u5206\u5E03\u5F0F\u9501\u57FA\u4E8ERedis\u7684SET\u547D\u4EE4\u7684\u539F\u5B50\u6027\u5B9E\u73B0\uFF1A"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u83B7\u53D6\u9501"}),"\uFF1A\u4F7F\u7528",(0,r.jsx)(n.code,{children:"SET key value NX EX ttl"}),"\u547D\u4EE4"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"NX\uFF1A\u53EA\u6709\u5F53key\u4E0D\u5B58\u5728\u65F6\u624D\u8BBE\u7F6E"}),"\n",(0,r.jsx)(n.li,{children:"EX\uFF1A\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4"}),"\n",(0,r.jsx)(n.li,{children:"\u8FD4\u56DEOK\u8868\u793A\u83B7\u53D6\u6210\u529F\uFF0C\u8FD4\u56DEnil\u8868\u793A\u83B7\u53D6\u5931\u8D25"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u91CA\u653E\u9501"}),"\uFF1A\u4F7F\u7528Lua\u811A\u672C\u4FDD\u8BC1\u539F\u5B50\u6027"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u68C0\u67E5\u9501\u662F\u5426\u5C5E\u4E8E\u5F53\u524D\u5BA2\u6237\u7AEF"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679C\u662F\uFF0C\u5219\u5220\u9664\u9501\uFF1B\u5426\u5219\u4E0D\u5220\u9664"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="Redis\u5206\u5E03\u5F0F\u9501\u6838\u5FC3\u5B9E\u73B0"',children:'// \u83B7\u53D6\u9501\nBoolean success = redisTemplate.opsForValue()\n    .setIfAbsent(lockKey, lockValue, expireTime, TimeUnit.MILLISECONDS);\n\n// \u91CA\u653E\u9501\uFF08Lua\u811A\u672C\uFF09\nString script = "if redis.call(\'get\', KEYS[1]) == ARGV[1] then " +\n               "return redis.call(\'del\', KEYS[1]) " +\n               "else return 0 end";\nLong result = redisTemplate.execute(script, lockKey, lockValue);\n'})}),"\n",(0,r.jsx)(n.h4,{id:"q4-redis\u5206\u5E03\u5F0F\u9501\u5B58\u5728\u54EA\u4E9B\u95EE\u9898\u5982\u4F55\u89E3\u51B3",children:"Q4: Redis\u5206\u5E03\u5F0F\u9501\u5B58\u5728\u54EA\u4E9B\u95EE\u9898\uFF1F\u5982\u4F55\u89E3\u51B3\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": Redis\u5206\u5E03\u5F0F\u9501\u5B58\u5728\u4EE5\u4E0B\u95EE\u9898\uFF1A"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9501\u8BEF\u5220\u95EE\u9898"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u95EE\u9898"}),"\uFF1A\u5BA2\u6237\u7AEFA\u83B7\u53D6\u9501\u540E\uFF0C\u4E1A\u52A1\u6267\u884C\u65F6\u95F4\u8D85\u8FC7\u9501\u8FC7\u671F\u65F6\u95F4\uFF0C\u9501\u88AB\u81EA\u52A8\u91CA\u653E\uFF0C\u5BA2\u6237\u7AEFB\u83B7\u53D6\u9501\uFF0C\u7136\u540E\u5BA2\u6237\u7AEFA\u91CA\u653E\u9501\u65F6\u8BEF\u5220\u4E86\u5BA2\u6237\u7AEFB\u7684\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u89E3\u51B3"}),"\uFF1A\u5728\u91CA\u653E\u9501\u65F6\u68C0\u67E5\u9501\u662F\u5426\u5C5E\u4E8E\u5F53\u524D\u5BA2\u6237\u7AEF"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9501\u7EED\u671F\u95EE\u9898"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u95EE\u9898"}),"\uFF1A\u4E1A\u52A1\u6267\u884C\u65F6\u95F4\u53EF\u80FD\u8D85\u8FC7\u9501\u7684\u8FC7\u671F\u65F6\u95F4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u89E3\u51B3"}),"\uFF1A\u5B9E\u73B0\u770B\u95E8\u72D7\u673A\u5236\uFF0C\u5B9A\u671F\u7EED\u671F\u9501"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u5355\u70B9\u6545\u969C\u95EE\u9898"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u95EE\u9898"}),"\uFF1ARedis\u5355\u70B9\u6545\u969C\u5BFC\u81F4\u9501\u670D\u52A1\u4E0D\u53EF\u7528"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u89E3\u51B3"}),"\uFF1A\u4F7F\u7528Redis\u96C6\u7FA4\u6216RedLock\u7B97\u6CD5"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u770B\u95E8\u72D7\u673A\u5236\u793A\u4F8B"',children:"private void startWatchdog() {\n    long renewalInterval = expireTime / 3;\n    \n    renewalTask = scheduler.scheduleAtFixedRate(() -> {\n        if (isLocked) {\n            String currentValue = redisTemplate.opsForValue().get(lockKey);\n            if (lockValue.equals(currentValue)) {\n                // \u7EED\u671F\u9501\n                redisTemplate.expire(lockKey, expireTime, TimeUnit.MILLISECONDS);\n            }\n        }\n    }, renewalInterval, renewalInterval, TimeUnit.MILLISECONDS);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"73-zookeeper\u5206\u5E03\u5F0F\u9501",children:"7.3 Zookeeper\u5206\u5E03\u5F0F\u9501"}),"\n",(0,r.jsx)(n.h4,{id:"q5-zookeeper\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48",children:"Q5: Zookeeper\u5206\u5E03\u5F0F\u9501\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": Zookeeper\u5206\u5E03\u5F0F\u9501\u57FA\u4E8E\u4E34\u65F6\u987A\u5E8F\u8282\u70B9\u5B9E\u73B0\uFF1A"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u521B\u5EFA\u8282\u70B9"}),"\uFF1A\u5BA2\u6237\u7AEF\u5728\u9501\u76EE\u5F55\u4E0B\u521B\u5EFA\u4E34\u65F6\u987A\u5E8F\u8282\u70B9"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u68C0\u67E5\u5E8F\u53F7"}),"\uFF1A\u68C0\u67E5\u5F53\u524D\u8282\u70B9\u662F\u5426\u4E3A\u6700\u5C0F\u5E8F\u53F7"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u76D1\u542C\u524D\u9A71"}),"\uFF1A\u5982\u679C\u4E0D\u662F\u6700\u5C0F\u5E8F\u53F7\uFF0C\u76D1\u542C\u524D\u9A71\u8282\u70B9"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u83B7\u53D6\u9501"}),"\uFF1A\u524D\u9A71\u8282\u70B9\u5220\u9664\u540E\uFF0C\u91CD\u65B0\u68C0\u67E5\u5E8F\u53F7"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="Zookeeper\u9501\u6838\u5FC3\u903B\u8F91"',children:'// \u521B\u5EFA\u4E34\u65F6\u987A\u5E8F\u8282\u70B9\nString currentNode = client.create()\n    .withMode(CreateMode.EPHEMERAL_SEQUENTIAL)\n    .forPath(lockPath + "/" + lockName + "-");\n\n// \u83B7\u53D6\u6240\u6709\u5B50\u8282\u70B9\u5E76\u6392\u5E8F\nList<String> children = client.getChildren().forPath(lockPath);\nchildren.sort(String::compareTo);\n\n// \u68C0\u67E5\u662F\u5426\u4E3A\u6700\u5C0F\u5E8F\u53F7\nString nodeName = currentNode.substring(currentNode.lastIndexOf(\'/\') + 1);\nif (children.get(0).equals(nodeName)) {\n    return true; // \u83B7\u53D6\u9501\u6210\u529F\n}\n\n// \u76D1\u542C\u524D\u9A71\u8282\u70B9\nString previousNode = getPreviousNode(children, nodeName);\n// \u8BBE\u7F6E\u76D1\u542C\u5668\u7B49\u5F85\u524D\u9A71\u8282\u70B9\u5220\u9664\n'})}),"\n",(0,r.jsx)(n.h4,{id:"q6-zookeeper\u5206\u5E03\u5F0F\u9501\u76F8\u6BD4redis\u9501\u6709\u4EC0\u4E48\u4F18\u52BF",children:"Q6: Zookeeper\u5206\u5E03\u5F0F\u9501\u76F8\u6BD4Redis\u9501\u6709\u4EC0\u4E48\u4F18\u52BF\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": Zookeeper\u5206\u5E03\u5F0F\u9501\u76F8\u6BD4Redis\u9501\u6709\u4EE5\u4E0B\u4F18\u52BF\uFF1A"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5F3A\u4E00\u81F4\u6027"}),"\uFF1A\u57FA\u4E8EZookeeper\u7684\u5F3A\u4E00\u81F4\u6027\u4FDD\u8BC1"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u81EA\u52A8\u91CA\u653E"}),"\uFF1A\u5BA2\u6237\u7AEF\u65AD\u5F00\u8FDE\u63A5\u65F6\u81EA\u52A8\u91CA\u653E\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u516C\u5E73\u6027"}),"\uFF1A\u57FA\u4E8E\u987A\u5E8F\u8282\u70B9\uFF0C\u4FDD\u8BC1\u83B7\u53D6\u9501\u7684\u516C\u5E73\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53EF\u9760\u6027"}),"\uFF1AZookeeper\u7684\u9AD8\u53EF\u7528\u6027\u4FDD\u8BC1\u9501\u670D\u52A1\u7684\u53EF\u9760\u6027"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7F3A\u70B9"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6027\u80FD\u8F83\u4F4E\uFF1A\u76F8\u6BD4Redis\u9501\uFF0C\u6027\u80FD\u8F83\u4F4E"}),"\n",(0,r.jsx)(n.li,{children:"\u590D\u6742\u6027\uFF1A\u9700\u8981\u7EF4\u62A4Zookeeper\u96C6\u7FA4"}),"\n",(0,r.jsx)(n.li,{children:"\u7F51\u7EDC\u5F00\u9500\uFF1A\u6BCF\u6B21\u64CD\u4F5C\u90FD\u9700\u8981\u7F51\u7EDC\u901A\u4FE1"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"74-\u9AD8\u7EA7\u95EE\u9898",children:"7.4 \u9AD8\u7EA7\u95EE\u9898"}),"\n",(0,r.jsx)(n.h4,{id:"q7-\u5982\u4F55\u5B9E\u73B0\u53EF\u91CD\u5165\u5206\u5E03\u5F0F\u9501",children:"Q7: \u5982\u4F55\u5B9E\u73B0\u53EF\u91CD\u5165\u5206\u5E03\u5F0F\u9501\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": \u53EF\u91CD\u5165\u5206\u5E03\u5F0F\u9501\u9700\u8981\u8BB0\u5F55\u9501\u7684\u6301\u6709\u6B21\u6570\uFF1A"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u53EF\u91CD\u5165\u9501\u5B9E\u73B0"',children:'public class ReentrantDistributedLock {\n    private final ThreadLocal<Integer> lockCount = new ThreadLocal<>();\n    \n    public boolean tryLock(long timeout, TimeUnit unit) {\n        Integer count = lockCount.get();\n        if (count != null && count > 0) {\n            // \u5F53\u524D\u7EBF\u7A0B\u5DF2\u6301\u6709\u9501\uFF0C\u589E\u52A0\u8BA1\u6570\n            lockCount.set(count + 1);\n            return true;\n        }\n        \n        // \u5C1D\u8BD5\u83B7\u53D6\u9501\n        Boolean success = redisTemplate.opsForValue()\n            .setIfAbsent(lockKey, lockValue + ":1", timeout, unit);\n        \n        if (Boolean.TRUE.equals(success)) {\n            lockCount.set(1);\n            return true;\n        }\n        \n        return false;\n    }\n    \n    public boolean releaseLock() {\n        Integer count = lockCount.get();\n        if (count == null || count <= 0) {\n            return false;\n        }\n        \n        if (count == 1) {\n            // \u6700\u540E\u4E00\u6B21\u91CA\u653E\uFF0C\u5220\u9664\u9501\n            lockCount.remove();\n            return safeReleaseLock(lockKey, lockValue + ":1");\n        } else {\n            // \u51CF\u5C11\u8BA1\u6570\n            lockCount.set(count - 1);\n            return true;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"q8-\u5982\u4F55\u8BBE\u8BA1\u5206\u5E03\u5F0F\u9501\u7684\u76D1\u63A7\u7CFB\u7EDF",children:"Q8: \u5982\u4F55\u8BBE\u8BA1\u5206\u5E03\u5F0F\u9501\u7684\u76D1\u63A7\u7CFB\u7EDF\uFF1F"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7B54"}),": \u5206\u5E03\u5F0F\u9501\u76D1\u63A7\u7CFB\u7EDF\u9700\u8981\u5173\u6CE8\u4EE5\u4E0B\u6307\u6807\uFF1A"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6027\u80FD\u6307\u6807"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9501\u83B7\u53D6\u6210\u529F\u7387"}),"\n",(0,r.jsx)(n.li,{children:"\u9501\u83B7\u53D6\u5E73\u5747\u65F6\u95F4"}),"\n",(0,r.jsx)(n.li,{children:"\u9501\u6301\u6709\u65F6\u95F4\u5206\u5E03"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4E1A\u52A1\u6307\u6807"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9501\u7ADE\u4E89\u60C5\u51B5"}),"\n",(0,r.jsx)(n.li,{children:"\u9501\u7B49\u5F85\u961F\u5217\u957F\u5EA6"}),"\n",(0,r.jsx)(n.li,{children:"\u9501\u8D85\u65F6\u60C5\u51B5"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u7CFB\u7EDF\u6307\u6807"}),"\uFF1A"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9501\u670D\u52A1\u53EF\u7528\u6027"}),"\n",(0,r.jsx)(n.li,{children:"\u9501\u670D\u52A1\u54CD\u5E94\u65F6\u95F4"}),"\n",(0,r.jsx)(n.li,{children:"\u9501\u670D\u52A1\u9519\u8BEF\u7387"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="\u9501\u76D1\u63A7\u5B9E\u73B0"',children:'@Component\npublic class LockMonitorService {\n    \n    public void recordLockAcquisition(String lockKey, long duration, boolean success) {\n        // \u8BB0\u5F55\u9501\u83B7\u53D6\u6B21\u6570\n        Counter.builder("distributed_lock.acquisitions")\n            .tag("lock_key", lockKey)\n            .tag("result", success ? "success" : "failure")\n            .register(meterRegistry)\n            .increment();\n        \n        // \u8BB0\u5F55\u9501\u83B7\u53D6\u65F6\u95F4\n        Timer.builder("distributed_lock.acquisition_time")\n            .tag("lock_key", lockKey)\n            .register(meterRegistry)\n            .record(duration, TimeUnit.MILLISECONDS);\n    }\n    \n    @Scheduled(fixedRate = 60000)\n    public void checkLockHealth() {\n        // \u68C0\u67E5\u957F\u65F6\u95F4\u672A\u91CA\u653E\u7684\u9501\n        // \u68C0\u67E5\u9501\u7684\u83B7\u53D6\u5931\u8D25\u7387\n        // \u53D1\u9001\u544A\u8B66\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"8-\u603B\u7ED3",children:"8. \u603B\u7ED3"}),"\n",(0,r.jsx)(n.p,{children:"\u5206\u5E03\u5F0F\u9501\u662F\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u91CD\u8981\u7EC4\u4EF6\uFF0C\u4E0D\u540C\u7684\u5B9E\u73B0\u65B9\u6848\u5404\u6709\u4F18\u7F3A\u70B9\u3002\u5728\u5B9E\u9645\u5E94\u7528\u4E2D\uFF0C\u9700\u8981\u6839\u636E\u4E1A\u52A1\u573A\u666F\u3001\u6027\u80FD\u8981\u6C42\u548C\u4E00\u81F4\u6027\u8981\u6C42\u9009\u62E9\u5408\u9002\u7684\u5206\u5E03\u5F0F\u9501\u65B9\u6848\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u5173\u952E\u8981\u70B9",children:"\u5173\u952E\u8981\u70B9"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u9009\u62E9\u5408\u9002\u7684\u9501\u65B9\u6848"}),"\uFF1A\u6839\u636E\u4E1A\u52A1\u9700\u6C42\u9009\u62E9Redis\u3001Zookeeper\u6216\u6570\u636E\u5E93\u9501"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u89E3\u51B3\u9501\u7684\u95EE\u9898"}),"\uFF1A\u6B63\u786E\u5904\u7406\u9501\u7684\u8BEF\u5220\u3001\u7EED\u671F\u3001\u53EF\u91CD\u5165\u7B49\u95EE\u9898"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4FDD\u8BC1\u9501\u7684\u5B89\u5168\u6027"}),"\uFF1A\u4F7F\u7528Lua\u811A\u672C\u3001\u770B\u95E8\u72D7\u673A\u5236\u7B49\u6280\u672F\u4FDD\u8BC1\u9501\u7684\u5B89\u5168\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u76D1\u63A7\u548C\u4F18\u5316"}),"\uFF1A\u5EFA\u7ACB\u5B8C\u5584\u7684\u76D1\u63A7\u4F53\u7CFB\uFF0C\u6301\u7EED\u4F18\u5316\u9501\u7684\u6027\u80FD"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u901A\u8FC7\u6DF1\u5165\u7406\u89E3\u548C\u719F\u7EC3\u8FD0\u7528\u8FD9\u4E9B\u6280\u672F\uFF0C\u6211\u4EEC\u80FD\u591F\u6784\u5EFA\u51FA\u5B89\u5168\u3001\u9AD8\u6548\u7684\u5206\u5E03\u5F0F\u9501\u7CFB\u7EDF\u3002"})]})}function u(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:function(e,n,i){i.d(n,{R:()=>t,x:()=>c});var l=i(96540);let r={},s=l.createContext(r);function t(e){let n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);