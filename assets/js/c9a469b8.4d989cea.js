"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["58566"],{25301:function(n,e,r){r.r(e),r.d(e,{metadata:()=>s,default:()=>o,frontMatter:()=>c,contentTitle:()=>d,toc:()=>a,assets:()=>t});var s=JSON.parse('{"id":"interview/java-\u6D88\u606F\u961F\u5217","title":"Java \u6D88\u606F\u961F\u5217\u9762\u8BD5\u9898\u96C6","description":"\u603B\u9898\u6570 MQ\u539F\u7406\u3001RabbitMQ\u3001RocketMQ\u3001Kafka |  \u96BE\u5EA6\u5206\u5E03: \u4E2D\u9AD8\u7EA7","source":"@site/docs/interview/java-\u6D88\u606F\u961F\u5217.md","sourceDirName":"interview","slug":"/interview/java-\u6D88\u606F\u961F\u5217","permalink":"/docs/interview/java-\u6D88\u606F\u961F\u5217","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/interview/java-\u6D88\u606F\u961F\u5217.md","tags":[],"version":"current","lastUpdatedBy":"laby","lastUpdatedAt":1763643037000,"frontMatter":{}}'),l=r(74848),i=r(28453);let c={},d="Java \u6D88\u606F\u961F\u5217\u9762\u8BD5\u9898\u96C6",t={},a=[{value:"\u9762\u8BD5\u9898\u76EE\u5217\u8868",id:"\u9762\u8BD5\u9898\u76EE\u5217\u8868",level:2},{value:"1. \u4EC0\u4E48\u662F\u6D88\u606F\u961F\u5217\uFF1F",id:"1-\u4EC0\u4E48\u662F\u6D88\u606F\u961F\u5217",level:3},{value:"2. \u4E3A\u4EC0\u4E48\u9700\u8981\u6D88\u606F\u961F\u5217\uFF1F",id:"2-\u4E3A\u4EC0\u4E48\u9700\u8981\u6D88\u606F\u961F\u5217",level:3},{value:"3. \u8BF4\u4E00\u4E0B\u6D88\u606F\u961F\u5217\u7684\u6A21\u578B\u6709\u54EA\u4E9B\uFF1F",id:"3-\u8BF4\u4E00\u4E0B\u6D88\u606F\u961F\u5217\u7684\u6A21\u578B\u6709\u54EA\u4E9B",level:3},{value:"4. \u7B80\u8FF0\u4E0B\u6D88\u606F\u961F\u5217\u6838\u5FC3\u7684\u4E00\u4E9B\u672F\u8BED\uFF1F",id:"4-\u7B80\u8FF0\u4E0B\u6D88\u606F\u961F\u5217\u6838\u5FC3\u7684\u4E00\u4E9B\u672F\u8BED",level:3},{value:"5. \u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u5931\uFF1F",id:"5-\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u5931",level:3},{value:"6. \u5982\u4F55\u5904\u7406\u91CD\u590D\u6D88\u606F\uFF1F",id:"6-\u5982\u4F55\u5904\u7406\u91CD\u590D\u6D88\u606F",level:3},{value:"7. \u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u7684\u6709\u5E8F\u6027\uFF1F",id:"7-\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u7684\u6709\u5E8F\u6027",level:3},{value:"8. \u5982\u4F55\u5904\u7406\u6D88\u606F\u5806\u79EF\uFF1F",id:"8-\u5982\u4F55\u5904\u7406\u6D88\u606F\u5806\u79EF",level:3},{value:"9. \u6D88\u606F\u961F\u5217\u8BBE\u8BA1\u6210\u63A8\u6D88\u606F\u8FD8\u662F\u62C9\u6D88\u606F\uFF1F\u63A8\u62C9\u6A21\u5F0F\u7684\u4F18\u7F3A\u70B9\uFF1F",id:"9-\u6D88\u606F\u961F\u5217\u8BBE\u8BA1\u6210\u63A8\u6D88\u606F\u8FD8\u662F\u62C9\u6D88\u606F\u63A8\u62C9\u6A21\u5F0F\u7684\u4F18\u7F3A\u70B9",level:3},{value:"10. RocketMQ \u7684\u4E8B\u52A1\u6D88\u606F\u6709\u4EC0\u4E48\u7F3A\u70B9\uFF1F\u4F60\u8FD8\u4E86\u89E3\u8FC7\u522B\u7684\u4E8B\u52A1\u6D88\u606F\u5B9E\u73B0\u5417\uFF1F",id:"10-rocketmq-\u7684\u4E8B\u52A1\u6D88\u606F\u6709\u4EC0\u4E48\u7F3A\u70B9\u4F60\u8FD8\u4E86\u89E3\u8FC7\u522B\u7684\u4E8B\u52A1\u6D88\u606F\u5B9E\u73B0\u5417",level:3},{value:"11. \u8BF4\u4E00\u4E0B Kafka \u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0\uFF1F",id:"11-\u8BF4\u4E00\u4E0B-kafka-\u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0",level:3},{value:"12. \u4F60\u4E86\u89E3 Kafka \u4E2D\u7684\u65F6\u95F4\u8F6E\u5B9E\u73B0\u5417?",id:"12-\u4F60\u4E86\u89E3-kafka-\u4E2D\u7684\u65F6\u95F4\u8F6E\u5B9E\u73B0\u5417",level:3},{value:"13. \u8BF4\u8BF4 Kafka \u7684\u7D22\u5F15\u8BBE\u8BA1\u6709\u4EC0\u4E48\u4EAE\u70B9\uFF1F",id:"13-\u8BF4\u8BF4-kafka-\u7684\u7D22\u5F15\u8BBE\u8BA1\u6709\u4EC0\u4E48\u4EAE\u70B9",level:3},{value:"14. \u770B\u8FC7\u6E90\u7801\uFF1F\u90A3\u8BF4\u8BF4 Kafka \u63A7\u5236\u5668\u4E8B\u4EF6\u5904\u7406\u5168\u6D41\u7A0B\uFF1F",id:"14-\u770B\u8FC7\u6E90\u7801\u90A3\u8BF4\u8BF4-kafka-\u63A7\u5236\u5668\u4E8B\u4EF6\u5904\u7406\u5168\u6D41\u7A0B",level:3},{value:"15. Kafka \u4E2D Zookeeper \u7684\u4F5C\u7528\uFF1F",id:"15-kafka-\u4E2D-zookeeper-\u7684\u4F5C\u7528",level:3},{value:"16. Kafka\u4E3A\u4EC0\u4E48\u8981\u629B\u5F03 Zookeeper\uFF1F",id:"16-kafka\u4E3A\u4EC0\u4E48\u8981\u629B\u5F03-zookeeper",level:3},{value:"17. \u770B\u8FC7\u6E90\u7801\uFF1F\u90A3\u8BF4\u8BF4 Kafka \u5904\u7406\u8BF7\u6C42\u7684\u5168\u6D41\u7A0B\uFF1F",id:"17-\u770B\u8FC7\u6E90\u7801\u90A3\u8BF4\u8BF4-kafka-\u5904\u7406\u8BF7\u6C42\u7684\u5168\u6D41\u7A0B",level:3},{value:"18. RabbitMQ \u4E2D\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\u4F1A\u53BB\u5230\u54EA\u91CC\uFF1F",id:"18-rabbitmq-\u4E2D\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\u4F1A\u53BB\u5230\u54EA\u91CC",level:3},{value:"19. RabbitMQ \u4E2D\u6D88\u606F\u4EC0\u4E48\u65F6\u5019\u4F1A\u8FDB\u5165\u6B7B\u4FE1\u4EA4\u6362\u673A\uFF1F",id:"19-rabbitmq-\u4E2D\u6D88\u606F\u4EC0\u4E48\u65F6\u5019\u4F1A\u8FDB\u5165\u6B7B\u4FE1\u4EA4\u6362\u673A",level:3},{value:"20. \u8BF4\u4E00\u4E0B AMQP \u534F\u8BAE\uFF1F",id:"20-\u8BF4\u4E00\u4E0B-amqp-\u534F\u8BAE",level:3},{value:"21. \u8BF4\u4E00\u4E0B RabbitMQ \u7684\u4E8B\u52A1\u673A\u5236\uFF1F",id:"21-\u8BF4\u4E00\u4E0B-rabbitmq-\u7684\u4E8B\u52A1\u673A\u5236",level:3},{value:"22. RabbitMQ \u4E2D\u4E3B\u8981\u6709\u54EA\u51E0\u4E2A\u89D2\u8272\u6216\u8005\u8BF4\u6982\u5FF5\uFF1F",id:"22-rabbitmq-\u4E2D\u4E3B\u8981\u6709\u54EA\u51E0\u4E2A\u89D2\u8272\u6216\u8005\u8BF4\u6982\u5FF5",level:3},{value:"23. RabbitMQ \u7684 routing key \u548C binding key \u7684\u6700\u5927\u957F\u5EA6\u662F\u591A\u5C11\u5B57\u8282\uFF1F",id:"23-rabbitmq-\u7684-routing-key-\u548C-binding-key-\u7684\u6700\u5927\u957F\u5EA6\u662F\u591A\u5C11\u5B57\u8282",level:3},{value:"24. \u8BF4\u8BF4 RabbitMQ \u7684\u5DE5\u4F5C\u6A21\u5F0F\uFF1F",id:"24-\u8BF4\u8BF4-rabbitmq-\u7684\u5DE5\u4F5C\u6A21\u5F0F",level:3},{value:"25. \u8BF4\u8BF4 RabbitMQ \u7684\u96C6\u7FA4\u6A21\u5F0F\uFF1F",id:"25-\u8BF4\u8BF4-rabbitmq-\u7684\u96C6\u7FA4\u6A21\u5F0F",level:3},{value:"26. \u4E3A\u4EC0\u4E48 RocketMQ \u4E0D\u4F7F\u7528 Zookeeper \u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\u5462\uFF1F\u800C\u9009\u62E9\u81EA\u5DF1\u5B9E\u73B0 NameServer\uFF1F",id:"26-\u4E3A\u4EC0\u4E48-rocketmq-\u4E0D\u4F7F\u7528-zookeeper-\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\u5462\u800C\u9009\u62E9\u81EA\u5DF1\u5B9E\u73B0-nameserver",level:3},{value:"27. \u8BF4\u4E00\u4E0B Kafka \u4E3A\u4EC0\u4E48\u6027\u80FD\u9AD8\uFF1F",id:"27-\u8BF4\u4E00\u4E0B-kafka-\u4E3A\u4EC0\u4E48\u6027\u80FD\u9AD8",level:3},{value:"28. RabbitMQ \u600E\u4E48\u5B9E\u73B0\u5EF6\u8FDF\u961F\u5217\uFF1F",id:"28-rabbitmq-\u600E\u4E48\u5B9E\u73B0\u5EF6\u8FDF\u961F\u5217",level:3},{value:"29. RocketMQ \u7684\u5EF6\u8FDF\u6D88\u606F\u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F",id:"29-rocketmq-\u7684\u5EF6\u8FDF\u6D88\u606F\u662F\u600E\u4E48\u5B9E\u73B0\u7684",level:3},{value:"30. RocketMQ \u7684\u5F00\u53D1\u53C2\u8003\u4E86 Kafka\uFF0C\u90A3\u4E24\u8005\u5728\u67B6\u6784\u548C\u529F\u80FD\u4E0A\u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"30-rocketmq-\u7684\u5F00\u53D1\u53C2\u8003\u4E86-kafka\u90A3\u4E24\u8005\u5728\u67B6\u6784\u548C\u529F\u80FD\u4E0A\u6709\u4EC0\u4E48\u533A\u522B",level:3},{value:"31. \u8BF4\u4E00\u4E0B RocketMQ \u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0\uFF1F",id:"31-\u8BF4\u4E00\u4E0B-rocketmq-\u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0",level:3},{value:"\u5B66\u4E60\u6307\u5357",id:"\u5B66\u4E60\u6307\u5357",level:2}];function h(n){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"java-\u6D88\u606F\u961F\u5217\u9762\u8BD5\u9898\u96C6",children:"Java \u6D88\u606F\u961F\u5217\u9762\u8BD5\u9898\u96C6"})}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u603B\u9898\u6570"}),": 31\u9053 |  ",(0,l.jsx)(e.strong,{children:"\u91CD\u70B9\u9886\u57DF"}),": MQ\u539F\u7406\u3001RabbitMQ\u3001RocketMQ\u3001Kafka |  ",(0,l.jsx)(e.strong,{children:"\u96BE\u5EA6\u5206\u5E03"}),": \u4E2D\u9AD8\u7EA7"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u672C\u6587\u6863\u6574\u7406\u4E86 Java \u6D88\u606F\u961F\u5217\u7684\u5B8C\u657431\u9053\u9762\u8BD5\u9898\u76EE\uFF0C\u6DB5\u76D6\u6D88\u606F\u961F\u5217\u539F\u7406\u3001\u4E3B\u6D41MQ\u4EA7\u54C1\u7279\u6027\u7B49\u5404\u4E2A\u65B9\u9762\u3002"}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"\u9762\u8BD5\u9898\u76EE\u5217\u8868",children:"\u9762\u8BD5\u9898\u76EE\u5217\u8868"}),"\n",(0,l.jsx)(e.h3,{id:"1-\u4EC0\u4E48\u662F\u6D88\u606F\u961F\u5217",children:"1. \u4EC0\u4E48\u662F\u6D88\u606F\u961F\u5217\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"\u6D88\u606F\u961F\u5217\uFF08Message Queue\uFF0C\u7B80\u79F0MQ\uFF09\u662F\u4E00\u79CD\u5E94\u7528\u7A0B\u5E8F\u95F4\u7684\u901A\u4FE1\u65B9\u6CD5\uFF0C\u901A\u8FC7\u5728\u6D88\u606F\u7684\u4F20\u8F93\u8FC7\u7A0B\u4E2D\u4FDD\u5B58\u6D88\u606F\u6765\u5B9E\u73B0\u5E94\u7528\u7A0B\u5E8F\u4E4B\u95F4\u7684\u5F02\u6B65\u901A\u4FE1\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u6982\u5FF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\uFF08Producer\uFF09"}),"\uFF1A\u8D1F\u8D23\u4EA7\u751F\u548C\u53D1\u9001\u6D88\u606F\u5230\u6D88\u606F\u961F\u5217"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\uFF08Consumer\uFF09"}),"\uFF1A\u4ECE\u6D88\u606F\u961F\u5217\u4E2D\u83B7\u53D6\u6D88\u606F\u5E76\u8FDB\u884C\u5904\u7406"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u961F\u5217\uFF08Queue\uFF09"}),"\uFF1A\u5B58\u50A8\u6D88\u606F\u7684\u5BB9\u5668\uFF0C\u9075\u5FAAFIFO\u539F\u5219"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u4EE3\u7406\uFF08Broker\uFF09"}),"\uFF1A\u6D88\u606F\u961F\u5217\u670D\u52A1\u5668\uFF0C\u8D1F\u8D23\u63A5\u6536\u3001\u5B58\u50A8\u548C\u8F6C\u53D1\u6D88\u606F"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u5C06\u6D88\u606F\u53D1\u9001\u5230\u6D88\u606F\u961F\u5217"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u961F\u5217\u5C06\u6D88\u606F\u6301\u4E45\u5316\u5B58\u50A8"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u4ECE\u961F\u5217\u4E2D\u62C9\u53D6\u6216\u88AB\u63A8\u9001\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5904\u7406\u5B8C\u6D88\u606F\u540E\uFF0C\u5411\u961F\u5217\u53D1\u9001\u786E\u8BA4"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"2-\u4E3A\u4EC0\u4E48\u9700\u8981\u6D88\u606F\u961F\u5217",children:"2. \u4E3A\u4EC0\u4E48\u9700\u8981\u6D88\u606F\u961F\u5217\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"\u6D88\u606F\u961F\u5217\u4E3B\u8981\u89E3\u51B3\u4EE5\u4E0B\u51E0\u4E2A\u6838\u5FC3\u95EE\u9898\uFF1A"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u5E94\u7528\u89E3\u8026"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7CFB\u7EDF\u95F4\u4E0D\u76F4\u63A5\u8C03\u7528\uFF0C\u901A\u8FC7\u6D88\u606F\u961F\u5217\u8FDB\u884C\u901A\u4FE1"}),"\n",(0,l.jsx)(e.li,{children:"\u964D\u4F4E\u7CFB\u7EDF\u95F4\u7684\u8026\u5408\u5EA6\uFF0C\u63D0\u9AD8\u7CFB\u7EDF\u7684\u53EF\u7EF4\u62A4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u67D0\u4E2A\u670D\u52A1\u5B95\u673A\u4E0D\u4F1A\u5F71\u54CD\u5176\u4ED6\u670D\u52A1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u5F02\u6B65\u5904\u7406"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5C06\u975E\u6838\u5FC3\u4E1A\u52A1\u5F02\u6B65\u5316\uFF0C\u63D0\u5347\u7CFB\u7EDF\u54CD\u5E94\u901F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u4F8B\u5982\uFF1A\u7528\u6237\u6CE8\u518C\u540E\uFF0C\u53D1\u9001\u90AE\u4EF6\u3001\u77ED\u4FE1\u7B49\u64CD\u4F5C\u53EF\u4EE5\u5F02\u6B65\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u4E3B\u6D41\u7A0B\u5FEB\u901F\u8FD4\u56DE\uFF0C\u63D0\u5347\u7528\u6237\u4F53\u9A8C"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u6D41\u91CF\u524A\u5CF0"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5728\u9AD8\u5E76\u53D1\u573A\u666F\u4E0B\uFF0C\u901A\u8FC7\u6D88\u606F\u961F\u5217\u7F13\u51B2\u8BF7\u6C42"}),"\n",(0,l.jsx)(e.li,{children:"\u9632\u6B62\u7CFB\u7EDF\u56E0\u77AC\u65F6\u6D41\u91CF\u8FC7\u5927\u800C\u5D29\u6E83"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u6309\u7167\u81EA\u5DF1\u7684\u5904\u7406\u80FD\u529B\u6D88\u8D39\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u6570\u636E\u5206\u53D1"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u6D88\u606F\u53EF\u4EE5\u88AB\u591A\u4E2A\u6D88\u8D39\u8005\u6D88\u8D39"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9E\u73B0\u6570\u636E\u7684\u4E00\u5BF9\u591A\u5206\u53D1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u6700\u7EC8\u4E00\u81F4\u6027"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u901A\u8FC7\u6D88\u606F\u961F\u5217\u5B9E\u73B0\u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u6700\u7EC8\u4E00\u81F4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u4FDD\u8BC1\u6570\u636E\u5728\u5404\u4E2A\u7CFB\u7EDF\u95F4\u7684\u4E00\u81F4\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"3-\u8BF4\u4E00\u4E0B\u6D88\u606F\u961F\u5217\u7684\u6A21\u578B\u6709\u54EA\u4E9B",children:"3. \u8BF4\u4E00\u4E0B\u6D88\u606F\u961F\u5217\u7684\u6A21\u578B\u6709\u54EA\u4E9B\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"\u6D88\u606F\u961F\u5217\u4E3B\u8981\u6709\u4E24\u79CD\u6D88\u606F\u6A21\u578B\uFF1A"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u70B9\u5BF9\u70B9\u6A21\u578B\uFF08Point-to-Point\uFF0CP2P\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u57FA\u4E8E\u961F\u5217\uFF08Queue\uFF09\u5B9E\u73B0"}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u6D88\u606F\u53EA\u80FD\u88AB\u4E00\u4E2A\u6D88\u8D39\u8005\u6D88\u8D39"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u88AB\u6D88\u8D39\u540E\u4F1A\u4ECE\u961F\u5217\u4E2D\u5220\u9664"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u591A\u4E2A\u6D88\u8D39\u8005\uFF0C\u4F46\u6BCF\u6761\u6D88\u606F\u53EA\u4F1A\u88AB\u5176\u4E2D\u4E00\u4E2A\u6D88\u8D39\u8005\u5904\u7406"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4EFB\u52A1\u5206\u53D1\u7CFB\u7EDF"}),"\n",(0,l.jsx)(e.li,{children:"\u8BA2\u5355\u5904\u7406\u7CFB\u7EDF"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u53D1\u5E03/\u8BA2\u9605\u6A21\u578B\uFF08Publish/Subscribe\uFF0CPub/Sub\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u57FA\u4E8E\u4E3B\u9898\uFF08Topic\uFF09\u5B9E\u73B0"}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u6D88\u606F\u53EF\u4EE5\u88AB\u591A\u4E2A\u6D88\u8D39\u8005\u6D88\u8D39"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u88AB\u6D88\u8D39\u540E\u4E0D\u4F1A\u7ACB\u5373\u5220\u9664"}),"\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u53D1\u5E03\u6D88\u606F\u5230\u4E3B\u9898\uFF0C\u8BA2\u9605\u8BE5\u4E3B\u9898\u7684\u6240\u6709\u6D88\u8D39\u8005\u90FD\u4F1A\u6536\u5230\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u5E7F\u64AD"}),"\n",(0,l.jsx)(e.li,{children:"\u65E5\u5FD7\u6536\u96C6"}),"\n",(0,l.jsx)(e.li,{children:"\u4E8B\u4EF6\u901A\u77E5"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4E3B\u6D41MQ\u5BF9\u6A21\u578B\u7684\u652F\u6301\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"RabbitMQ"}),"\uFF1A\u652F\u6301\u4E24\u79CD\u6A21\u578B\uFF0C\u901A\u8FC7Exchange\u7C7B\u578B\u5B9E\u73B0"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Kafka"}),"\uFF1A\u4E3B\u8981\u57FA\u4E8E\u53D1\u5E03/\u8BA2\u9605\u6A21\u578B"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"RocketMQ"}),"\uFF1A\u652F\u6301\u4E24\u79CD\u6A21\u578B"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"4-\u7B80\u8FF0\u4E0B\u6D88\u606F\u961F\u5217\u6838\u5FC3\u7684\u4E00\u4E9B\u672F\u8BED",children:"4. \u7B80\u8FF0\u4E0B\u6D88\u606F\u961F\u5217\u6838\u5FC3\u7684\u4E00\u4E9B\u672F\u8BED\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u57FA\u7840\u6982\u5FF5"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Producer\uFF08\u751F\u4EA7\u8005\uFF09"}),"\uFF1A\u8D1F\u8D23\u751F\u4EA7\u6D88\u606F\u5E76\u53D1\u9001\u5230\u6D88\u606F\u961F\u5217"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Consumer\uFF08\u6D88\u8D39\u8005\uFF09"}),"\uFF1A\u4ECE\u6D88\u606F\u961F\u5217\u4E2D\u83B7\u53D6\u6D88\u606F\u5E76\u6D88\u8D39"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Broker\uFF08\u6D88\u606F\u4EE3\u7406\uFF09"}),"\uFF1A\u6D88\u606F\u961F\u5217\u670D\u52A1\u5668\uFF0C\u8D1F\u8D23\u63A5\u6536\u3001\u5B58\u50A8\u3001\u8F6C\u53D1\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Message\uFF08\u6D88\u606F\uFF09"}),"\uFF1A\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u4E4B\u95F4\u4F20\u9012\u7684\u6570\u636E\u5355\u5143"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u6D88\u606F\u7EC4\u7EC7"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Queue\uFF08\u961F\u5217\uFF09"}),"\uFF1A\u5B58\u50A8\u6D88\u606F\u7684\u5BB9\u5668\uFF0C\u9075\u5FAAFIFO\u539F\u5219"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Topic\uFF08\u4E3B\u9898\uFF09"}),"\uFF1A\u6D88\u606F\u7684\u903B\u8F91\u5206\u7C7B\uFF0C\u7528\u4E8E\u53D1\u5E03/\u8BA2\u9605\u6A21\u5F0F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Partition\uFF08\u5206\u533A\uFF09"}),"\uFF1ATopic\u7684\u7269\u7406\u5206\u7EC4\uFF0C\u63D0\u9AD8\u5E76\u53D1\u80FD\u529B"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Tag\uFF08\u6807\u7B7E\uFF09"}),"\uFF1A\u6D88\u606F\u7684\u6807\u8BB0\uFF0C\u7528\u4E8E\u6D88\u606F\u8FC7\u6EE4"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u6D88\u8D39\u76F8\u5173"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Consumer Group\uFF08\u6D88\u8D39\u8005\u7EC4\uFF09"}),"\uFF1A\u591A\u4E2A\u6D88\u8D39\u8005\u7EC4\u6210\u7684\u7EC4\uFF0C\u5171\u540C\u6D88\u8D39\u4E00\u4E2ATopic"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Offset\uFF08\u504F\u79FB\u91CF\uFF09"}),"\uFF1A\u6D88\u8D39\u8005\u5728\u5206\u533A\u4E2D\u7684\u6D88\u8D39\u4F4D\u7F6E"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Acknowledgment\uFF08\u786E\u8BA4\uFF09"}),"\uFF1A\u6D88\u8D39\u8005\u5904\u7406\u5B8C\u6D88\u606F\u540E\u7684\u786E\u8BA4\u673A\u5236"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u9AD8\u7EA7\u7279\u6027"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Dead Letter Queue\uFF08\u6B7B\u4FE1\u961F\u5217\uFF09"}),"\uFF1A\u65E0\u6CD5\u88AB\u6B63\u5E38\u6D88\u8D39\u7684\u6D88\u606F\u5B58\u653E\u7684\u961F\u5217"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Delay Message\uFF08\u5EF6\u8FDF\u6D88\u606F\uFF09"}),"\uFF1A\u6307\u5B9A\u65F6\u95F4\u540E\u624D\u80FD\u88AB\u6D88\u8D39\u7684\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Transaction Message\uFF08\u4E8B\u52A1\u6D88\u606F\uFF09"}),"\uFF1A\u652F\u6301\u5206\u5E03\u5F0F\u4E8B\u52A1\u7684\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Message Filter\uFF08\u6D88\u606F\u8FC7\u6EE4\uFF09"}),"\uFF1A\u6839\u636E\u6761\u4EF6\u8FC7\u6EE4\u6D88\u606F"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u53EF\u9760\u6027\u76F8\u5173"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Persistence\uFF08\u6301\u4E45\u5316\uFF09"}),"\uFF1A\u5C06\u6D88\u606F\u5B58\u50A8\u5230\u78C1\u76D8\uFF0C\u9632\u6B62\u4E22\u5931"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Replication\uFF08\u526F\u672C\uFF09"}),"\uFF1A\u6D88\u606F\u7684\u591A\u526F\u672C\u5B58\u50A8\uFF0C\u4FDD\u8BC1\u9AD8\u53EF\u7528"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Retry\uFF08\u91CD\u8BD5\uFF09"}),"\uFF1A\u6D88\u606F\u6D88\u8D39\u5931\u8D25\u540E\u7684\u91CD\u8BD5\u673A\u5236"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"5-\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u5931",children:"5. \u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u4E0D\u4E22\u5931\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"\u6D88\u606F\u4E22\u5931\u53EF\u80FD\u53D1\u751F\u5728\u4E09\u4E2A\u9636\u6BB5\uFF0C\u9700\u8981\u5206\u522B\u5904\u7406\uFF1A"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u751F\u4EA7\u8005\u9636\u6BB5\uFF08\u6D88\u606F\u53D1\u9001\u4E22\u5931\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u540C\u6B65\u53D1\u9001 + \u786E\u8BA4\u673A\u5236"}),"\uFF1A\u7B49\u5F85Broker\u786E\u8BA4\u540E\u518D\u8FD4\u56DE"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5F02\u6B65\u53D1\u9001 + \u56DE\u8C03"}),"\uFF1A\u901A\u8FC7\u56DE\u8C03\u51FD\u6570\u786E\u8BA4\u6D88\u606F\u662F\u5426\u53D1\u9001\u6210\u529F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5931\u8D25\u91CD\u8BD5"}),"\uFF1A\u53D1\u9001\u5931\u8D25\u65F6\u8FDB\u884C\u91CD\u8BD5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u672C\u5730\u6D88\u606F\u8868"}),"\uFF1A\u5148\u4FDD\u5B58\u5230\u672C\u5730\u6570\u636E\u5E93\uFF0C\u53D1\u9001\u6210\u529F\u540E\u5220\u9664"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RabbitMQ\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5F00\u542F\u53D1\u9001\u786E\u8BA4\nchannel.confirmSelect();\nchannel.basicPublish(...);\nchannel.waitForConfirms(); // \u7B49\u5F85\u786E\u8BA4\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Kafka\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u8BBE\u7F6Eacks=all\uFF0C\u7B49\u5F85\u6240\u6709\u526F\u672C\u786E\u8BA4\nprops.put("acks", "all");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. Broker\u9636\u6BB5\uFF08\u5B58\u50A8\u4E22\u5931\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u6301\u4E45\u5316"}),"\uFF1A\u5C06\u6D88\u606F\u5199\u5165\u78C1\u76D8"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4E3B\u4ECE\u590D\u5236"}),"\uFF1A\u591A\u526F\u672C\u673A\u5236\uFF0C\u9632\u6B62\u5355\u70B9\u6545\u969C"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5237\u76D8\u7B56\u7565"}),"\uFF1A\u540C\u6B65\u5237\u76D8\uFF08\u53EF\u9760\u4F46\u6162\uFF09vs \u5F02\u6B65\u5237\u76D8\uFF08\u5FEB\u4F46\u53EF\u80FD\u4E22\u5931\uFF09"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RabbitMQ\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u961F\u5217\u6301\u4E45\u5316\nchannel.queueDeclare(queueName, true, false, false, null);\n// \u6D88\u606F\u6301\u4E45\u5316\nchannel.basicPublish("", queueName, \n    MessageProperties.PERSISTENT_TEXT_PLAIN, message);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RocketMQ\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u540C\u6B65\u5237\u76D8\nbrokerConfig.setFlushDiskType(FlushDiskType.SYNC_FLUSH);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Kafka\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u526F\u672C\u6570\u91CF\nreplication.factor=3\n# \u6700\u5C0F\u540C\u6B65\u526F\u672C\u6570\nmin.insync.replicas=2\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u6D88\u8D39\u8005\u9636\u6BB5\uFF08\u6D88\u8D39\u4E22\u5931\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u624B\u52A8\u786E\u8BA4\uFF08ACK\uFF09"}),"\uFF1A\u6D88\u8D39\u6210\u529F\u540E\u518D\u786E\u8BA4"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5173\u95ED\u81EA\u52A8\u63D0\u4EA4"}),"\uFF1A\u9632\u6B62\u6D88\u606F\u672A\u5904\u7406\u5C31\u63D0\u4EA4offset"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u91CD\u8BD5"}),"\uFF1A\u6D88\u8D39\u5931\u8D25\u65F6\u91CD\u8BD5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6B7B\u4FE1\u961F\u5217"}),"\uFF1A\u591A\u6B21\u5931\u8D25\u540E\u8FDB\u5165\u6B7B\u4FE1\u961F\u5217"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RabbitMQ\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u624B\u52A8\u786E\u8BA4\nchannel.basicConsume(queueName, false, consumer);\n// \u5904\u7406\u5B8C\u6210\u540E\u786E\u8BA4\nchannel.basicAck(deliveryTag, false);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Kafka\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5173\u95ED\u81EA\u52A8\u63D0\u4EA4\nprops.put("enable.auto.commit", "false");\n// \u624B\u52A8\u63D0\u4EA4\nconsumer.commitSync();\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7EFC\u5408\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\uFF1A\u4F7F\u7528\u786E\u8BA4\u673A\u5236 + \u91CD\u8BD5"}),"\n",(0,l.jsx)(e.li,{children:"Broker\uFF1A\u6301\u4E45\u5316 + \u591A\u526F\u672C"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\uFF1A\u624B\u52A8\u786E\u8BA4 + \u6D88\u8D39\u91CD\u8BD5"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u544A\u8B66\uFF1A\u53CA\u65F6\u53D1\u73B0\u95EE\u9898"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"6-\u5982\u4F55\u5904\u7406\u91CD\u590D\u6D88\u606F",children:"6. \u5982\u4F55\u5904\u7406\u91CD\u590D\u6D88\u606F\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsxs)(e.p,{children:["\u6D88\u606F\u91CD\u590D\u7684\u539F\u56E0\u4E3B\u8981\u6709\uFF1A\u7F51\u7EDC\u6296\u52A8\u3001\u6D88\u8D39\u8005\u5B95\u673A\u91CD\u542F\u3001\u6D88\u606F\u91CD\u8BD5\u7B49\u3002\u89E3\u51B3\u91CD\u590D\u6D88\u606F\u7684\u6838\u5FC3\u601D\u60F3\u662F",(0,l.jsx)(e.strong,{children:"\u5E42\u7B49\u6027"}),"\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u4E1A\u52A1\u5C42\u9762\u4FDD\u8BC1\u5E42\u7B49\u6027"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6570\u636E\u5E93\u552F\u4E00\u7EA6\u675F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528\u552F\u4E00\u7D22\u5F15\u9632\u6B62\u91CD\u590D\u63D2\u5165\nCREATE UNIQUE INDEX idx_order_id ON orders(order_id);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u5E03\u5F0F\u9501\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u4F7F\u7528Redis\u5206\u5E03\u5F0F\u9501\nString lockKey = "lock:order:" + orderId;\nif (redisTemplate.opsForValue().setIfAbsent(lockKey, "1", 10, TimeUnit.SECONDS)) {\n    try {\n        // \u5904\u7406\u4E1A\u52A1\u903B\u8F91\n        processOrder(orderId);\n    } finally {\n        redisTemplate.delete(lockKey);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u6D88\u606F\u53BB\u91CD\u8868"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528\u6D88\u606FID\u4F5C\u4E3A\u552F\u4E00\u952E\n@Transactional\npublic void handleMessage(String messageId, String content) {\n    // \u68C0\u67E5\u6D88\u606F\u662F\u5426\u5DF2\u5904\u7406\n    if (messageRecordMapper.exists(messageId)) {\n        return; // \u5DF2\u5904\u7406\uFF0C\u76F4\u63A5\u8FD4\u56DE\n    }\n    \n    // \u5904\u7406\u4E1A\u52A1\u903B\u8F91\n    processBusiness(content);\n    \n    // \u8BB0\u5F55\u6D88\u606F\u5DF2\u5904\u7406\n    messageRecordMapper.insert(messageId);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u5168\u5C40\u552F\u4E00ID"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528\u96EA\u82B1\u7B97\u6CD5\u751F\u6210\u5168\u5C40\u552F\u4E00ID\nlong messageId = snowflakeIdGenerator.nextId();\nmessage.setKey(String.valueOf(messageId));\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u72B6\u6001\u673A\u673A\u5236"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u8BA2\u5355\u72B6\u6001\u6D41\u8F6C\npublic void updateOrderStatus(String orderId, OrderStatus newStatus) {\n    Order order = orderMapper.selectById(orderId);\n    \n    // \u53EA\u6709\u5728\u7279\u5B9A\u72B6\u6001\u624D\u80FD\u6D41\u8F6C\n    if (order.getStatus() == OrderStatus.CREATED && \n        newStatus == OrderStatus.PAID) {\n        orderMapper.updateStatus(orderId, newStatus);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. Token\u673A\u5236"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u751F\u6210\u552F\u4E00token\nString token = UUID.randomUUID().toString();\nredisTemplate.opsForValue().set("token:" + token, "1", 5, TimeUnit.MINUTES);\n\n// \u6D88\u8D39\u65F6\u9A8C\u8BC1token\nif (redisTemplate.delete("token:" + token) > 0) {\n    // token\u5B58\u5728\u4E14\u5220\u9664\u6210\u529F\uFF0C\u5904\u7406\u4E1A\u52A1\n    processBusiness();\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F18\u5148\u4F7F\u7528\u4E1A\u52A1\u5C42\u9762\u7684\u5E42\u7B49\u6027\u8BBE\u8BA1"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u5E93\u5C42\u9762\u4F7F\u7528\u552F\u4E00\u7D22\u5F15"}),"\n",(0,l.jsx)(e.li,{children:"\u5173\u952E\u4E1A\u52A1\u4F7F\u7528\u5206\u5E03\u5F0F\u9501"}),"\n",(0,l.jsx)(e.li,{children:"\u8BB0\u5F55\u6D88\u606F\u5904\u7406\u72B6\u6001"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"7-\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u7684\u6709\u5E8F\u6027",children:"7. \u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u7684\u6709\u5E8F\u6027\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u4E3A\u4EC0\u4E48\u4F1A\u51FA\u73B0\u4E71\u5E8F\uFF1F"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u591A\u4E2A\u751F\u4EA7\u8005\u5E76\u53D1\u53D1\u9001"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u5728\u591A\u4E2A\u5206\u533A/\u961F\u5217\u4E2D\u5B58\u50A8"}),"\n",(0,l.jsx)(e.li,{children:"\u591A\u4E2A\u6D88\u8D39\u8005\u5E76\u53D1\u6D88\u8D39"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. Kafka\u4FDD\u8BC1\u6709\u5E8F\u6027"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5355\u5206\u533A\u6709\u5E8F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u65B9\u68481\uFF1A\u6307\u5B9A\u5206\u533A\nproducer.send(new ProducerRecord<>("topic", partition, key, value));\n\n// \u65B9\u68482\uFF1A\u4F7F\u7528\u76F8\u540C\u7684key\uFF0C\u4F1A\u8DEF\u7531\u5230\u540C\u4E00\u5206\u533A\nproducer.send(new ProducerRecord<>("topic", orderId, message));\n\n// \u6D88\u8D39\u8005\uFF1A\u4E00\u4E2A\u5206\u533A\u53EA\u80FD\u88AB\u6D88\u8D39\u8005\u7EC4\u4E2D\u7684\u4E00\u4E2A\u6D88\u8D39\u8005\u6D88\u8D39\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u8981\u6C42\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u751F\u4EA7\u8005\uFF1A\u8BBE\u7F6E\u4E3A1\uFF0C\u4FDD\u8BC1\u6D88\u606F\u987A\u5E8F\u53D1\u9001\nmax.in.flight.requests.per.connection=1\n\n# \u6216\u4F7F\u7528\u5E42\u7B49\u6027\u751F\u4EA7\u8005\uFF08Kafka 1.0+\uFF09\nenable.idempotence=true\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. RocketMQ\u4FDD\u8BC1\u6709\u5E8F\u6027"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5168\u5C40\u6709\u5E8F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u53EA\u521B\u5EFA\u4E00\u4E2A\u961F\u5217\n// \u53EA\u6709\u4E00\u4E2A\u751F\u4EA7\u8005\u548C\u4E00\u4E2A\u6D88\u8D39\u8005\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u533A\u6709\u5E8F\uFF08\u63A8\u8350\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u53D1\u9001\u6D88\u606F\u65F6\u6307\u5B9AMessageQueueSelector\nproducer.send(message, new MessageQueueSelector() {\n    @Override\n    public MessageQueue select(List<MessageQueue> mqs, \n                               Message msg, Object arg) {\n        // \u6839\u636E\u8BA2\u5355ID\u9009\u62E9\u961F\u5217\n        Long orderId = (Long) arg;\n        int index = (int) (orderId % mqs.size());\n        return mqs.get(index);\n    }\n}, orderId);\n\n// \u6D88\u8D39\u8005\u4F7F\u7528MessageListenerOrderly\nconsumer.registerMessageListener(new MessageListenerOrderly() {\n    @Override\n    public ConsumeOrderlyStatus consumeMessage(\n            List<MessageExt> msgs, ConsumeOrderlyContext context) {\n        // \u987A\u5E8F\u6D88\u8D39\n        return ConsumeOrderlyStatus.SUCCESS;\n    }\n});\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. RabbitMQ\u4FDD\u8BC1\u6709\u5E8F\u6027"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u4F7F\u7528\u5355\u4E2A\u961F\u5217 + \u5355\u4E2A\u6D88\u8D39\u8005\nchannel.basicQos(1); // \u6BCF\u6B21\u53EA\u5904\u7406\u4E00\u6761\u6D88\u606F\n\n// \u6216\u4F7F\u7528\u4E00\u81F4\u6027\u54C8\u5E0C\u4EA4\u6362\u673A\nMap<String, Object> args = new HashMap<>();\nargs.put("hash-header", "order-id");\nchannel.exchangeDeclare("exchange", "x-consistent-hash", true, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u4E1A\u52A1\u5C42\u9762\u4FDD\u8BC1\u6709\u5E8F"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F7F\u7528\u7248\u672C\u53F7\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6D88\u606F\u643A\u5E26\u7248\u672C\u53F7\npublic class OrderMessage {\n    private String orderId;\n    private Integer version;\n    private String content;\n}\n\n// \u6D88\u8D39\u65F6\u68C0\u67E5\u7248\u672C\u53F7\nif (message.getVersion() > currentVersion) {\n    processMessage(message);\n    updateVersion(message.getVersion());\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F7F\u7528\u65F6\u95F4\u6233\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u53EA\u5904\u7406\u6700\u65B0\u7684\u6D88\u606F\nif (message.getTimestamp() > lastProcessedTimestamp) {\n    processMessage(message);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u76F8\u540C\u7684key/\u5206\u533A\u952E\u4FDD\u8BC1\u76F8\u5173\u6D88\u606F\u8DEF\u7531\u5230\u540C\u4E00\u5206\u533A"}),"\n",(0,l.jsx)(e.li,{children:"\u5355\u5206\u533A\u5355\u6D88\u8D39\u8005\u4FDD\u8BC1\u987A\u5E8F\u6D88\u8D39"}),"\n",(0,l.jsx)(e.li,{children:"\u4E1A\u52A1\u5C42\u9762\u8BBE\u8BA1\u5E42\u7B49\u6027\u548C\u7248\u672C\u63A7\u5236"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"8-\u5982\u4F55\u5904\u7406\u6D88\u606F\u5806\u79EF",children:"8. \u5982\u4F55\u5904\u7406\u6D88\u606F\u5806\u79EF\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u6D88\u606F\u5806\u79EF\u7684\u539F\u56E0"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u6D88\u8D39\u901F\u5EA6\u6162\u4E8E\u751F\u4EA7\u8005\u751F\u4EA7\u901F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u51FA\u73B0\u6545\u969C\u6216\u5B95\u673A"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u903B\u8F91\u590D\u6742\uFF0C\u5904\u7406\u65F6\u95F4\u957F"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u6570\u91CF\u4E0D\u8DB3"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u4E34\u65F6\u89E3\u51B3\u65B9\u6848"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u589E\u52A0\u6D88\u8D39\u8005\u6570\u91CF\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5FEB\u901F\u6269\u5BB9\u6D88\u8D39\u8005\u5B9E\u4F8B\n// \u6CE8\u610F\uFF1A\u6D88\u8D39\u8005\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7\u5206\u533A\u6570\uFF08Kafka\uFF09\u6216\u961F\u5217\u6570\uFF08RocketMQ\uFF09\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u63D0\u9AD8\u6D88\u8D39\u5E76\u884C\u5EA6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// RocketMQ\uFF1A\u589E\u52A0\u6D88\u8D39\u7EBF\u7A0B\u6570\nconsumer.setConsumeThreadMin(20);\nconsumer.setConsumeThreadMax(64);\n\n// Kafka\uFF1A\u589E\u52A0\u5206\u533A\u6570\nkafka-topics.sh --alter --topic my-topic --partitions 10\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6279\u91CF\u6D88\u8D39\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// RocketMQ\u6279\u91CF\u6D88\u8D39\nconsumer.setConsumeMessageBatchMaxSize(100);\n\n// Kafka\u6279\u91CF\u62C9\u53D6\nprops.put("max.poll.records", 500);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u7D27\u6025\u5904\u7406\u65B9\u6848"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4E34\u65F6\u961F\u5217\u8F6C\u50A8\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u521B\u5EFA\u4E34\u65F6Topic\uFF0C\u5C06\u6D88\u606F\u5FEB\u901F\u8F6C\u79FB\n// \u4F7F\u7528\u66F4\u591A\u6D88\u8D39\u8005\u5E76\u884C\u5904\u7406\u4E34\u65F6Topic\npublic void transferMessages() {\n    // \u4ECE\u5806\u79EF\u961F\u5217\u6D88\u8D39\n    List<Message> messages = consumer.poll();\n    \n    // \u5FEB\u901F\u8F6C\u53D1\u5230\u4E34\u65F6\u961F\u5217\n    for (Message msg : messages) {\n        producer.send("temp-topic", msg);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u964D\u7EA7\u5904\u7406\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5BF9\u975E\u6838\u5FC3\u6D88\u606F\u8FDB\u884C\u964D\u7EA7\u5904\u7406\nif (isNonCriticalMessage(message)) {\n    // \u7B80\u5316\u5904\u7406\u903B\u8F91\u6216\u76F4\u63A5\u4E22\u5F03\n    logAndDiscard(message);\n} else {\n    // \u6B63\u5E38\u5904\u7406\n    processMessage(message);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u957F\u671F\u4F18\u5316\u65B9\u6848"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u5316\u6D88\u8D39\u903B\u8F91\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5F02\u6B65\u5904\u7406\u8017\u65F6\u64CD\u4F5C\n@Async\npublic void processTimeConsumingTask(Message message) {\n    // \u8017\u65F6\u64CD\u4F5C\n}\n\n// \u6279\u91CF\u5904\u7406\u6570\u636E\u5E93\u64CD\u4F5C\npublic void batchInsert(List<Order> orders) {\n    orderMapper.batchInsert(orders);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5408\u7406\u8BBE\u7F6E\u6D88\u8D39\u53C2\u6570\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// Kafka\nprops.put("fetch.min.bytes", 1024 * 1024); // 1MB\nprops.put("fetch.max.wait.ms", 500);\n\n// RocketMQ\nconsumer.setPullBatchSize(32);\nconsumer.setConsumeMessageBatchMaxSize(10);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u76D1\u63A7\u548C\u9884\u8B66"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u76D1\u63A7\u6D88\u606F\u5806\u79EF\u6570\u91CF\nlong lag = getConsumerLag();\nif (lag > threshold) {\n    sendAlert("\u6D88\u606F\u5806\u79EF\u544A\u8B66\uFF1A" + lag);\n}\n\n// Kafka\u76D1\u63A7\nkafka-consumer-groups.sh --describe --group my-group\n\n// RocketMQ\u76D1\u63A7\nmqadmin consumerProgress -g my-group\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u67B6\u6784\u4F18\u5316"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u589E\u52A0\u5206\u533A/\u961F\u5217\u6570"}),"\uFF1A\u63D0\u9AD8\u5E76\u884C\u5EA6"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4F7F\u7528\u6D88\u606F\u8FC7\u6EE4"}),"\uFF1A\u51CF\u5C11\u65E0\u6548\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u79BB\u6838\u5FC3\u548C\u975E\u6838\u5FC3\u6D88\u606F"}),"\uFF1A\u4E0D\u540CTopic\u4E0D\u540C\u4F18\u5148\u7EA7"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5F15\u5165\u7F13\u5B58"}),"\uFF1A\u51CF\u5C11\u6570\u636E\u5E93\u67E5\u8BE2"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6570\u636E\u5E93\u4F18\u5316"}),"\uFF1A\u6DFB\u52A0\u7D22\u5F15\u3001\u4F18\u5316SQL"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u63D0\u524D\u89C4\u5212\u597D\u5206\u533A\u6570\u548C\u6D88\u8D39\u8005\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u505A\u597D\u76D1\u63A7\u548C\u544A\u8B66"}),"\n",(0,l.jsx)(e.li,{children:"\u4F18\u5316\u6D88\u8D39\u903B\u8F91\uFF0C\u63D0\u9AD8\u5904\u7406\u901F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u51C6\u5907\u597D\u6269\u5BB9\u65B9\u6848"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"9-\u6D88\u606F\u961F\u5217\u8BBE\u8BA1\u6210\u63A8\u6D88\u606F\u8FD8\u662F\u62C9\u6D88\u606F\u63A8\u62C9\u6A21\u5F0F\u7684\u4F18\u7F3A\u70B9",children:"9. \u6D88\u606F\u961F\u5217\u8BBE\u8BA1\u6210\u63A8\u6D88\u606F\u8FD8\u662F\u62C9\u6D88\u606F\uFF1F\u63A8\u62C9\u6A21\u5F0F\u7684\u4F18\u7F3A\u70B9\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u63A8\u6A21\u5F0F\uFF08Push\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Broker\u4E3B\u52A8\u5C06\u6D88\u606F\u63A8\u9001\u7ED9\u6D88\u8D39\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u88AB\u52A8\u63A5\u6536\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B9E\u65F6\u6027\u9AD8\uFF0C\u6D88\u606F\u5230\u8FBE\u540E\u7ACB\u5373\u63A8\u9001"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5B9E\u73B0\u7B80\u5355\uFF0C\u65E0\u9700\u4E3B\u52A8\u62C9\u53D6"}),"\n",(0,l.jsx)(e.li,{children:"\u9002\u5408\u6D88\u606F\u91CF\u5C11\u3001\u5B9E\u65F6\u6027\u8981\u6C42\u9AD8\u7684\u573A\u666F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Broker\u9700\u8981\u7EF4\u62A4\u6BCF\u4E2A\u6D88\u8D39\u8005\u7684\u72B6\u6001"}),"\n",(0,l.jsx)(e.li,{children:"\u96BE\u4EE5\u63A7\u5236\u63A8\u9001\u901F\u7387\uFF0C\u53EF\u80FD\u538B\u57AE\u6D88\u8D39\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5904\u7406\u80FD\u529B\u4E0D\u540C\uFF0C\u96BE\u4EE5\u505A\u5230\u6D41\u91CF\u63A7\u5236"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B9E\u65F6\u6027\u8981\u6C42\u9AD8"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u91CF\u4E0D\u5927"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5904\u7406\u80FD\u529B\u7A33\u5B9A"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EE3\u8868\uFF1ARabbitMQ\uFF08\u9ED8\u8BA4\u63A8\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u62C9\u6A21\u5F0F\uFF08Pull\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u4E3B\u52A8\u4ECEBroker\u62C9\u53D6\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"Broker\u88AB\u52A8\u7B49\u5F85\u6D88\u8D39\u8005\u8BF7\u6C42"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u53EF\u4EE5\u6839\u636E\u81EA\u5DF1\u7684\u5904\u7406\u80FD\u529B\u62C9\u53D6\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u6279\u91CF\u62C9\u53D6\uFF0C\u63D0\u9AD8\u541E\u5410\u91CF"}),"\n",(0,l.jsx)(e.li,{children:"Broker\u5B9E\u73B0\u7B80\u5355\uFF0C\u65E0\u9700\u7EF4\u62A4\u6D88\u8D39\u8005\u72B6\u6001"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u53EF\u4EE5\u63A7\u5236\u6D88\u8D39\u901F\u7387"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B9E\u65F6\u6027\u76F8\u5BF9\u8F83\u5DEE"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u9700\u8981\u5FAA\u73AF\u62C9\u53D6\uFF0C\u53EF\u80FD\u9020\u6210\u7A7A\u8F6E\u8BE2"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5B9E\u73B0\u76F8\u5BF9\u590D\u6742"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9AD8\u541E\u5410\u91CF\u573A\u666F"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5904\u7406\u80FD\u529B\u5DEE\u5F02\u5927"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u6279\u91CF\u5904\u7406\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EE3\u8868\uFF1AKafka\u3001RocketMQ\uFF08\u9ED8\u8BA4\u62C9\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. Kafka\u7684\u62C9\u6A21\u5F0F\u5B9E\u73B0"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6D88\u8D39\u8005\u4E3B\u52A8\u62C9\u53D6\nwhile (true) {\n    ConsumerRecords<String, String> records = \n        consumer.poll(Duration.ofMillis(100));\n    \n    for (ConsumerRecord<String, String> record : records) {\n        processMessage(record);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u5316\u7A7A\u8F6E\u8BE2\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u957F\u8F6E\u8BE2\uFF1A\u5982\u679C\u6CA1\u6709\u6570\u636E\uFF0CBroker\u4F1A\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\nfetch.min.bytes=1\nfetch.max.wait.ms=500\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. RabbitMQ\u7684\u63A8\u6A21\u5F0F\u5B9E\u73B0"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u63A8\u6A21\u5F0F\nchannel.basicConsume(queueName, false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        processMessage(body);\n        channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n});\n\n// RabbitMQ\u4E5F\u652F\u6301\u62C9\u6A21\u5F0F\nGetResponse response = channel.basicGet(queueName, false);\nif (response != null) {\n    processMessage(response.getBody());\n    channel.basicAck(response.getEnvelope().getDeliveryTag(), false);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u6DF7\u5408\u6A21\u5F0F"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RocketMQ\u7684\u957F\u8F6E\u8BE2\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6D88\u8D39\u8005\u62C9\u53D6\uFF0C\u4F46Broker\u4F1Ahold\u4F4F\u8BF7\u6C42\n// \u5982\u679C\u6709\u65B0\u6D88\u606F\u7ACB\u5373\u8FD4\u56DE\uFF0C\u5426\u5219\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\nconsumer.setPullTimeoutMillis(30000);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"\u63A8\u6A21\u5F0F"}),(0,l.jsx)(e.th,{children:"\u62C9\u6A21\u5F0F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5B9E\u65F6\u6027"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u76F8\u5BF9\u8F83\u4F4E"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u541E\u5410\u91CF"}),(0,l.jsx)(e.td,{children:"\u8F83\u4F4E"}),(0,l.jsx)(e.td,{children:"\u9AD8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6D41\u91CF\u63A7\u5236"}),(0,l.jsx)(e.td,{children:"\u56F0\u96BE"}),(0,l.jsx)(e.td,{children:"\u5BB9\u6613"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Broker\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4F4E"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6D88\u8D39\u8005\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u4F4E"}),(0,l.jsx)(e.td,{children:"\u9AD8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6279\u91CF\u5904\u7406"}),(0,l.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,l.jsx)(e.td,{children:"\u652F\u6301"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9AD8\u541E\u5410\u91CF\u573A\u666F\uFF1A\u9009\u62E9\u62C9\u6A21\u5F0F\uFF08Kafka\u3001RocketMQ\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9E\u65F6\u6027\u8981\u6C42\u9AD8\uFF1A\u9009\u62E9\u63A8\u6A21\u5F0F\uFF08RabbitMQ\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u73B0\u4EE3MQ\uFF1A\u91C7\u7528\u957F\u8F6E\u8BE2\uFF0C\u517C\u987E\u5B9E\u65F6\u6027\u548C\u541E\u5410\u91CF"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"10-rocketmq-\u7684\u4E8B\u52A1\u6D88\u606F\u6709\u4EC0\u4E48\u7F3A\u70B9\u4F60\u8FD8\u4E86\u89E3\u8FC7\u522B\u7684\u4E8B\u52A1\u6D88\u606F\u5B9E\u73B0\u5417",children:"10. RocketMQ \u7684\u4E8B\u52A1\u6D88\u606F\u6709\u4EC0\u4E48\u7F3A\u70B9\uFF1F\u4F60\u8FD8\u4E86\u89E3\u8FC7\u522B\u7684\u4E8B\u52A1\u6D88\u606F\u5B9E\u73B0\u5417\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. RocketMQ\u4E8B\u52A1\u6D88\u606F\u539F\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u53D1\u9001\u4E8B\u52A1\u6D88\u606F\nTransactionMQProducer producer = new TransactionMQProducer("group");\nproducer.setTransactionListener(new TransactionListener() {\n    @Override\n    public LocalTransactionState executeLocalTransaction(Message msg, Object arg) {\n        // \u6267\u884C\u672C\u5730\u4E8B\u52A1\n        try {\n            executeLocalBusiness();\n            return LocalTransactionState.COMMIT_MESSAGE;\n        } catch (Exception e) {\n            return LocalTransactionState.ROLLBACK_MESSAGE;\n        }\n    }\n    \n    @Override\n    public LocalTransactionState checkLocalTransaction(MessageExt msg) {\n        // \u4E8B\u52A1\u56DE\u67E5\n        return checkLocalTransactionStatus();\n    }\n});\n\n// \u53D1\u9001\u534A\u6D88\u606F\nproducer.sendMessageInTransaction(message, null);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u53D1\u9001\u534A\u6D88\u606F\uFF08Half Message\uFF09\u5230Broker"}),"\n",(0,l.jsx)(e.li,{children:"\u6267\u884C\u672C\u5730\u4E8B\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u6839\u636E\u672C\u5730\u4E8B\u52A1\u7ED3\u679C\u63D0\u4EA4\u6216\u56DE\u6EDA\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679C\u957F\u65F6\u95F4\u672A\u6536\u5230\u786E\u8BA4\uFF0CBroker\u56DE\u67E5\u4E8B\u52A1\u72B6\u6001"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. RocketMQ\u4E8B\u52A1\u6D88\u606F\u7684\u7F3A\u70B9"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B91\uFF1A\u53EA\u652F\u6301\u5355\u5411\u6D88\u606F"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53EA\u4FDD\u8BC1\u751F\u4EA7\u8005\u7684\u672C\u5730\u4E8B\u52A1\u548C\u53D1\u9001\u6D88\u606F\u7684\u4E00\u81F4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u4FDD\u8BC1\u6D88\u8D39\u8005\u7684\u6D88\u8D39\u548C\u672C\u5730\u4E8B\u52A1\u7684\u4E00\u81F4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u4ECD\u9700\u81EA\u5DF1\u4FDD\u8BC1\u5E42\u7B49\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B92\uFF1A\u4E8B\u52A1\u56DE\u67E5\u7684\u6027\u80FD\u5F00\u9500"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Broker\u9700\u8981\u5B9A\u671F\u56DE\u67E5\u4E8B\u52A1\u72B6\u6001"}),"\n",(0,l.jsx)(e.li,{children:"\u56DE\u67E5\u9891\u7387\u8FC7\u9AD8\u5F71\u54CD\u6027\u80FD"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u4E1A\u52A1\u65B9\u5B9E\u73B0\u56DE\u67E5\u63A5\u53E3"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B93\uFF1A\u534A\u6D88\u606F\u7684\u5B58\u50A8\u5F00\u9500"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u534A\u6D88\u606F\u9700\u8981\u5355\u72EC\u5B58\u50A8"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u52A0\u4E86\u5B58\u50A8\u6210\u672C"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B94\uFF1A\u4E0D\u652F\u6301\u8DE8\u96C6\u7FA4\u4E8B\u52A1"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53EA\u80FD\u5728\u5355\u4E2ARocketMQ\u96C6\u7FA4\u5185\u4F7F\u7528"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B95\uFF1A\u5B9E\u73B0\u590D\u6742"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5B9E\u73B0\u4E8B\u52A1\u76D1\u542C\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5B9E\u73B0\u4E8B\u52A1\u56DE\u67E5\u903B\u8F91"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u8003\u8651\u5404\u79CD\u5F02\u5E38\u60C5\u51B5"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u5176\u4ED6\u4E8B\u52A1\u6D88\u606F\u5B9E\u73B0"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Kafka\u4E8B\u52A1\u6D88\u606F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u751F\u4EA7\u8005\u914D\u7F6E\nprops.put("transactional.id", "my-transactional-id");\nprops.put("enable.idempotence", true);\n\n// \u4F7F\u7528\u4E8B\u52A1\nproducer.initTransactions();\ntry {\n    producer.beginTransaction();\n    \n    // \u53D1\u9001\u6D88\u606F\n    producer.send(record1);\n    producer.send(record2);\n    \n    // \u6267\u884C\u672C\u5730\u4E8B\u52A1\n    executeLocalTransaction();\n    \n    // \u63D0\u4EA4\u4E8B\u52A1\n    producer.commitTransaction();\n} catch (Exception e) {\n    producer.abortTransaction();\n}\n\n// \u6D88\u8D39\u8005\u914D\u7F6E\nprops.put("isolation.level", "read_committed");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u8DE8\u5206\u533A\u3001\u8DE8Topic\u7684\u4E8B\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u4FDD\u8BC1Exactly-Once\u8BED\u4E49"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u6D88\u8D39-\u8F6C\u6362-\u751F\u4EA7\u7684\u539F\u5B50\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u6027\u80FD\u76F8\u5BF9\u8F83\u597D"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E0D\u652F\u6301\u672C\u5730\u4E8B\u52A1\u548C\u6D88\u606F\u53D1\u9001\u7684\u539F\u5B50\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u4E3B\u8981\u7528\u4E8E\u6D88\u606F\u7CFB\u7EDF\u5185\u90E8\u7684\u4E8B\u52A1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u57FA\u4E8E\u672C\u5730\u6D88\u606F\u8868\u7684\u4E8B\u52A1\u5B9E\u73B0"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"@Transactional\npublic void createOrder(Order order) {\n    // 1. \u63D2\u5165\u8BA2\u5355\n    orderMapper.insert(order);\n    \n    // 2. \u63D2\u5165\u672C\u5730\u6D88\u606F\u8868\n    LocalMessage message = new LocalMessage();\n    message.setContent(JSON.toJSONString(order));\n    message.setStatus(MessageStatus.PENDING);\n    messageMapper.insert(message);\n}\n\n// \u5B9A\u65F6\u4EFB\u52A1\u626B\u63CF\u672C\u5730\u6D88\u606F\u8868\n@Scheduled(fixedDelay = 1000)\npublic void sendPendingMessages() {\n    List<LocalMessage> messages = \n        messageMapper.selectPendingMessages();\n    \n    for (LocalMessage message : messages) {\n        try {\n            // \u53D1\u9001\u6D88\u606F\n            producer.send(message.getContent());\n            \n            // \u66F4\u65B0\u72B6\u6001\u4E3A\u5DF2\u53D1\u9001\n            message.setStatus(MessageStatus.SENT);\n            messageMapper.update(message);\n        } catch (Exception e) {\n            // \u53D1\u9001\u5931\u8D25\uFF0C\u4E0B\u6B21\u7EE7\u7EED\u91CD\u8BD5\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B9E\u73B0\u7B80\u5355"}),"\n",(0,l.jsx)(e.li,{children:"\u53EF\u9760\u6027\u9AD8"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u4EFB\u4F55\u6D88\u606F\u961F\u5217"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u989D\u5916\u7684\u8868\u548C\u5B9A\u65F6\u4EFB\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u6709\u4E00\u5B9A\u5EF6\u8FDF"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5904\u7406\u6D88\u606F\u8868\u7684\u6E05\u7406"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u57FA\u4E8ETCC\u7684\u5206\u5E03\u5F0F\u4E8B\u52A1"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Try\u9636\u6BB5\uFF1A\u9884\u7559\u8D44\u6E90\npublic void tryCreateOrder(Order order) {\n    // \u51BB\u7ED3\u5E93\u5B58\n    inventoryService.freeze(order.getProductId(), order.getQuantity());\n    // \u53D1\u9001\u6D88\u606F\u5230MQ\n    producer.send(createOrderMessage);\n}\n\n// Confirm\u9636\u6BB5\uFF1A\u786E\u8BA4\u63D0\u4EA4\npublic void confirmCreateOrder(Order order) {\n    // \u6263\u51CF\u5E93\u5B58\n    inventoryService.deduct(order.getProductId(), order.getQuantity());\n}\n\n// Cancel\u9636\u6BB5\uFF1A\u56DE\u6EDA\npublic void cancelCreateOrder(Order order) {\n    // \u91CA\u653E\u5E93\u5B58\n    inventoryService.unfreeze(order.getProductId(), order.getQuantity());\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u65B9\u6848"}),(0,l.jsx)(e.th,{children:"\u4F18\u70B9"}),(0,l.jsx)(e.th,{children:"\u7F3A\u70B9"}),(0,l.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"RocketMQ\u4E8B\u52A1\u6D88\u606F"}),(0,l.jsx)(e.td,{children:"\u5B9E\u73B0\u76F8\u5BF9\u7B80\u5355"}),(0,l.jsx)(e.td,{children:"\u53EA\u652F\u6301\u5355\u5411\u3001\u9700\u8981\u56DE\u67E5"}),(0,l.jsx)(e.td,{children:"\u751F\u4EA7\u8005\u4E8B\u52A1"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Kafka\u4E8B\u52A1"}),(0,l.jsx)(e.td,{children:"\u6027\u80FD\u597D\u3001\u652F\u6301\u8DE8\u5206\u533A"}),(0,l.jsx)(e.td,{children:"\u4E0D\u652F\u6301\u672C\u5730\u4E8B\u52A1"}),(0,l.jsx)(e.td,{children:"\u6D88\u606F\u7CFB\u7EDF\u5185\u90E8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u672C\u5730\u6D88\u606F\u8868"}),(0,l.jsx)(e.td,{children:"\u53EF\u9760\u6027\u9AD8\u3001\u901A\u7528"}),(0,l.jsx)(e.td,{children:"\u6709\u5EF6\u8FDF\u3001\u9700\u8981\u989D\u5916\u8868"}),(0,l.jsx)(e.td,{children:"\u901A\u7528\u573A\u666F"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"TCC"}),(0,l.jsx)(e.td,{children:"\u4E00\u81F4\u6027\u5F3A"}),(0,l.jsx)(e.td,{children:"\u5B9E\u73B0\u590D\u6742"}),(0,l.jsx)(e.td,{children:"\u5F3A\u4E00\u81F4\u6027\u8981\u6C42"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u672C\u5730\u4E8B\u52A1 + \u6D88\u606F\u53D1\u9001\uFF1A\u4F7F\u7528RocketMQ\u4E8B\u52A1\u6D88\u606F\u6216\u672C\u5730\u6D88\u606F\u8868"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u7CFB\u7EDF\u5185\u90E8\u4E8B\u52A1\uFF1A\u4F7F\u7528Kafka\u4E8B\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u5F3A\u4E00\u81F4\u6027\u8981\u6C42\uFF1A\u4F7F\u7528TCC\u6216Saga"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u7EC8\u4E00\u81F4\u6027\uFF1A\u4F7F\u7528\u53EF\u9760\u6D88\u606F\u6700\u7EC8\u4E00\u81F4\u6027\u65B9\u6848"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"11-\u8BF4\u4E00\u4E0B-kafka-\u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0",children:"11. \u8BF4\u4E00\u4E0B Kafka \u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u4ECE0.11\u7248\u672C\u5F00\u59CB\u652F\u6301\u4E8B\u52A1\u6D88\u606F\uFF0C\u4E3B\u8981\u7528\u4E8E\u5B9E\u73B0Exactly-Once\u8BED\u4E49\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u6838\u5FC3\u6982\u5FF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Transaction Coordinator\uFF08\u4E8B\u52A1\u534F\u8C03\u5668\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8D1F\u8D23\u7BA1\u7406\u4E8B\u52A1\u72B6\u6001"}),"\n",(0,l.jsx)(e.li,{children:"\u6BCF\u4E2A\u751F\u4EA7\u8005\u90FD\u6709\u4E00\u4E2A\u5BF9\u5E94\u7684\u4E8B\u52A1\u534F\u8C03\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8\u5728__transaction_state\u5185\u90E8Topic\u4E2D"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"TransactionalId\uFF08\u4E8B\u52A1ID\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u552F\u4E00\u6807\u8BC6\u4E00\u4E2A\u751F\u4EA7\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u7528\u4E8E\u6545\u969C\u6062\u590D\u548C\u5E42\u7B49\u6027\u4FDD\u8BC1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Producer Epoch\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u7684\u7248\u672C\u53F7"}),"\n",(0,l.jsx)(e.li,{children:"\u9632\u6B62\u50F5\u5C38\u5B9E\u4F8B"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u4E8B\u52A1\u5B9E\u73B0\u539F\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u914D\u7F6E\u4E8B\u52A1\u751F\u4EA7\u8005\nprops.put("transactional.id", "my-transactional-id");\nprops.put("enable.idempotence", true);\nprops.put("acks", "all");\n\nKafkaProducer<String, String> producer = new KafkaProducer<>(props);\n\n// \u521D\u59CB\u5316\u4E8B\u52A1\nproducer.initTransactions();\n\ntry {\n    // \u5F00\u542F\u4E8B\u52A1\n    producer.beginTransaction();\n    \n    // \u53D1\u9001\u6D88\u606F\n    producer.send(new ProducerRecord<>("topic1", "key1", "value1"));\n    producer.send(new ProducerRecord<>("topic2", "key2", "value2"));\n    \n    // \u63D0\u4EA4\u4E8B\u52A1\n    producer.commitTransaction();\n} catch (Exception e) {\n    // \u56DE\u6EDA\u4E8B\u52A1\n    producer.abortTransaction();\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u4E8B\u52A1\u6D41\u7A0B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9636\u6BB51\uFF1A\u67E5\u627E\u4E8B\u52A1\u534F\u8C03\u5668"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u6839\u636Etransactional.id\u627E\u5230\u5BF9\u5E94\u7684\u4E8B\u52A1\u534F\u8C03\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u53D1\u9001FindCoordinator\u8BF7\u6C42"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9636\u6BB52\uFF1A\u521D\u59CB\u5316\u4E8B\u52A1"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u5411\u534F\u8C03\u5668\u53D1\u9001InitPidRequest"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5206\u914DPID\uFF08Producer ID\uFF09\u548CEpoch"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5728__transaction_state\u4E2D\u8BB0\u5F55\u4E8B\u52A1\u4FE1\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9636\u6BB53\uFF1A\u5F00\u59CB\u4E8B\u52A1"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8C03\u7528beginTransaction()\u6807\u8BB0\u4E8B\u52A1\u5F00\u59CB"}),"\n",(0,l.jsx)(e.li,{children:"\u672C\u5730\u64CD\u4F5C\uFF0C\u4E0D\u4E0EBroker\u4EA4\u4E92"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9636\u6BB54\uFF1A\u6D88\u8D39-\u8F6C\u6362-\u751F\u4EA7\uFF08\u53EF\u9009\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u8BFB\u53D6\u6D88\u606F\u3001\u5904\u7406\u3001\u53D1\u9001\u5230\u65B0Topic\nproducer.beginTransaction();\nConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\nfor (ConsumerRecord<String, String> record : records) {\n    // \u5904\u7406\u6D88\u606F\n    String result = process(record.value());\n    // \u53D1\u9001\u5230\u65B0Topic\n    producer.send(new ProducerRecord<>("output-topic", result));\n}\n// \u63D0\u4EA4\u6D88\u8D39\u4F4D\u79FB\u5230\u4E8B\u52A1\nproducer.sendOffsetsToTransaction(offsets, "consumer-group-id");\nproducer.commitTransaction();\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9636\u6BB55\uFF1A\u63D0\u4EA4\u6216\u56DE\u6EDA"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u63D0\u4EA4\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u53D1\u9001EndTxnRequest\uFF08COMMIT\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5199\u5165PREPARE_COMMIT\u5230\u4E8B\u52A1\u65E5\u5FD7"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5411\u6240\u6709\u76F8\u5173\u5206\u533A\u5199\u5165\u4E8B\u52A1\u63D0\u4EA4\u6807\u8BB0"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5199\u5165COMPLETE_COMMIT\u5230\u4E8B\u52A1\u65E5\u5FD7"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u56DE\u6EDA\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u53D1\u9001EndTxnRequest\uFF08ABORT\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5199\u5165PREPARE_ABORT\u5230\u4E8B\u52A1\u65E5\u5FD7"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5411\u6240\u6709\u76F8\u5173\u5206\u533A\u5199\u5165\u4E8B\u52A1\u56DE\u6EDA\u6807\u8BB0"}),"\n",(0,l.jsx)(e.li,{children:"\u534F\u8C03\u5668\u5199\u5165COMPLETE_ABORT\u5230\u4E8B\u52A1\u65E5\u5FD7"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u6D88\u8D39\u8005\u8BFB\u53D6\u4E8B\u52A1\u6D88\u606F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u914D\u7F6E\u9694\u79BB\u7EA7\u522B\nprops.put("isolation.level", "read_committed");\n\nKafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);\n// \u53EA\u80FD\u8BFB\u53D6\u5DF2\u63D0\u4EA4\u7684\u6D88\u606F\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9694\u79BB\u7EA7\u522B\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"read_uncommitted"}),"\uFF1A\u9ED8\u8BA4\uFF0C\u8BFB\u53D6\u6240\u6709\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"read_committed"}),"\uFF1A\u53EA\u8BFB\u53D6\u5DF2\u63D0\u4EA4\u7684\u4E8B\u52A1\u6D88\u606F"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u4E8B\u52A1\u4FDD\u8BC1"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u539F\u5B50\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u591A\u4E2A\u5206\u533A\u7684\u6D88\u606F\u8981\u4E48\u5168\u90E8\u6210\u529F\uFF0C\u8981\u4E48\u5168\u90E8\u5931\u8D25"}),"\n",(0,l.jsx)(e.li,{children:"\u901A\u8FC7\u4E24\u9636\u6BB5\u63D0\u4EA4\u5B9E\u73B0"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E42\u7B49\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u901A\u8FC7PID + Epoch + Sequence Number\u4FDD\u8BC1"}),"\n",(0,l.jsx)(e.li,{children:"\u9632\u6B62\u6D88\u606F\u91CD\u590D"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9694\u79BB\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u672A\u63D0\u4EA4\u7684\u6D88\u606F\u5BF9read_committed\u6D88\u8D39\u8005\u4E0D\u53EF\u89C1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u4E8B\u52A1\u72B6\u6001\u673A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Empty -> Ongoing -> PrepareCommit -> CompleteCommit\n              \\-> PrepareAbort -> CompleteAbort\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u6027\u80FD\u5F71\u54CD"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4FDD\u8BC1Exactly-Once\u8BED\u4E49"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u8DE8\u5206\u533A\u3001\u8DE8Topic\u7684\u539F\u5B50\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6027\u80FD\u5F00\u9500\u8F83\u5927\uFF08\u7EA630%\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5EF6\u8FDF\u589E\u52A0"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u989D\u5916\u7684\u5B58\u50A8\u7A7A\u95F4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53EA\u5728\u9700\u8981\u5F3A\u4E00\u81F4\u6027\u65F6\u4F7F\u7528\u4E8B\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8BBE\u7F6Etransaction.timeout.ms"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u4E8B\u52A1\u534F\u8C03\u5668\u7684\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"12-\u4F60\u4E86\u89E3-kafka-\u4E2D\u7684\u65F6\u95F4\u8F6E\u5B9E\u73B0\u5417",children:"12. \u4F60\u4E86\u89E3 Kafka \u4E2D\u7684\u65F6\u95F4\u8F6E\u5B9E\u73B0\u5417?"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u4F7F\u7528\u65F6\u95F4\u8F6E\uFF08Timing Wheel\uFF09\u7B97\u6CD5\u6765\u9AD8\u6548\u7BA1\u7406\u5927\u91CF\u5EF6\u65F6\u4EFB\u52A1\uFF0C\u4E3B\u8981\u7528\u4E8E\u5904\u7406\u5EF6\u65F6\u64CD\u4F5C\u3001\u5FC3\u8DF3\u68C0\u6D4B\u3001\u8D85\u65F6\u63A7\u5236\u7B49\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u4E3A\u4EC0\u4E48\u9700\u8981\u65F6\u95F4\u8F6E\uFF1F"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F20\u7EDF\u65B9\u6848\u7684\u95EE\u9898\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"JDK Timer"}),"\uFF1A\u5355\u7EBF\u7A0B\uFF0C\u4EFB\u52A1\u963B\u585E\u4F1A\u5F71\u54CD\u5176\u4ED6\u4EFB\u52A1"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"ScheduledExecutorService"}),"\uFF1A\u57FA\u4E8E\u5806\u5B9E\u73B0\uFF0C\u63D2\u5165\u548C\u5220\u9664O(logN)"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"DelayQueue"}),"\uFF1A\u57FA\u4E8E\u4F18\u5148\u961F\u5217\uFF0C\u6027\u80FD\u4E0D\u591F\u9AD8"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Kafka\u7684\u9700\u6C42\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u7BA1\u7406\u5927\u91CF\u5EF6\u65F6\u4EFB\u52A1\uFF08\u767E\u4E07\u7EA7\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u63D2\u5165\u3001\u5220\u9664\u64CD\u4F5C\u8981\u5FEB\uFF08O(1)\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u4EFB\u52A1\u6267\u884C\u8981\u51C6\u786E"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u65F6\u95F4\u8F6E\u539F\u7406"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u57FA\u672C\u7ED3\u6784\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u65F6\u95F4\u8F6E\u662F\u4E00\u4E2A\u73AF\u5F62\u6570\u7EC4\uFF0C\u6BCF\u4E2A\u69FD\u4F4D\u5B58\u50A8\u4E00\u4E2A\u4EFB\u52A1\u94FE\u8868\n\n     0   1   2   3   4   5   6   7\n    [*]-[*]-[*]-[*]-[*]-[*]-[*]-[*]\n     |   |   |   |   |   |   |   |\n    \u4EFB\u52A1 \u4EFB\u52A1 \u4EFB\u52A1 ...         \u4EFB\u52A1\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u53C2\u6570\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"tickMs"}),"\uFF1A\u65F6\u95F4\u8F6E\u7684\u65F6\u95F4\u7CBE\u5EA6\uFF08\u6EF4\u7B54\u95F4\u9694\uFF09\uFF0C\u59821ms"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"wheelSize"}),"\uFF1A\u65F6\u95F4\u8F6E\u7684\u69FD\u4F4D\u6570\uFF0C\u598220"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"interval"}),"\uFF1A\u65F6\u95F4\u8F6E\u7684\u65F6\u95F4\u8DE8\u5EA6 = tickMs \xd7 wheelSize"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"currentTime"}),"\uFF1A\u5F53\u524D\u65F6\u95F4\u6307\u9488"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. Kafka\u7684\u65F6\u95F4\u8F6E\u5B9E\u73B0"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"TimingWheel\u7C7B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"class TimingWheel(\n    tickMs: Long,           // \u65F6\u95F4\u7CBE\u5EA6\n    wheelSize: Int,         // \u69FD\u4F4D\u6570\n    startMs: Long,          // \u8D77\u59CB\u65F6\u95F4\n    taskCounter: AtomicInteger,\n    queue: DelayQueue[TimerTaskList]\n) {\n    private val interval = tickMs * wheelSize  // \u65F6\u95F4\u8DE8\u5EA6\n    private val buckets = Array.tabulate[TimerTaskList](wheelSize) { _ => \n        new TimerTaskList(taskCounter) \n    }\n    private var currentTime = startMs - (startMs % tickMs)\n    \n    // \u4E0A\u5C42\u65F6\u95F4\u8F6E\uFF08\u7528\u4E8E\u66F4\u957F\u7684\u5EF6\u65F6\uFF09\n    @volatile private var overflowWheel: TimingWheel = null\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u5C42\u7EA7\u65F6\u95F4\u8F6E"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u591A\u5C42\u7ED3\u6784\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u7B2C1\u5C42\uFF1AtickMs=1ms,  wheelSize=20, interval=20ms\n\u7B2C2\u5C42\uFF1AtickMs=20ms, wheelSize=20, interval=400ms\n\u7B2C3\u5C42\uFF1AtickMs=400ms,wheelSize=20, interval=8000ms\n...\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EFB\u52A1\u5206\u914D\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5EF6\u65F6 < 20ms\uFF1A\u653E\u5165\u7B2C1\u5C42"}),"\n",(0,l.jsx)(e.li,{children:"\u5EF6\u65F6 < 400ms\uFF1A\u653E\u5165\u7B2C2\u5C42"}),"\n",(0,l.jsx)(e.li,{children:"\u5EF6\u65F6 < 8000ms\uFF1A\u653E\u5165\u7B2C3\u5C42"}),"\n",(0,l.jsx)(e.li,{children:"\u4EE5\u6B64\u7C7B\u63A8"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u6DFB\u52A0\u4EFB\u52A1"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"def add(timerTaskEntry: TimerTaskEntry): Boolean = {\n    val expiration = timerTaskEntry.expirationMs\n    \n    if (timerTaskEntry.cancelled) {\n        false\n    } else if (expiration < currentTime + tickMs) {\n        // \u5DF2\u8FC7\u671F\uFF0C\u7ACB\u5373\u6267\u884C\n        false\n    } else if (expiration < currentTime + interval) {\n        // \u5728\u5F53\u524D\u65F6\u95F4\u8F6E\u8303\u56F4\u5185\n        val virtualId = expiration / tickMs\n        val bucket = buckets((virtualId % wheelSize.toLong).toInt)\n        bucket.add(timerTaskEntry)\n        \n        // \u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4\n        if (bucket.setExpiration(virtualId * tickMs)) {\n            queue.offer(bucket)\n        }\n        true\n    } else {\n        // \u8D85\u51FA\u5F53\u524D\u65F6\u95F4\u8F6E\u8303\u56F4\uFF0C\u653E\u5165\u4E0A\u5C42\u65F6\u95F4\u8F6E\n        if (overflowWheel == null) addOverflowWheel()\n        overflowWheel.add(timerTaskEntry)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u63A8\u8FDB\u65F6\u95F4\u8F6E"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"def advanceClock(timeMs: Long): Unit = {\n    if (timeMs >= currentTime + tickMs) {\n        currentTime = timeMs - (timeMs % tickMs)\n        \n        // \u63A8\u8FDB\u4E0A\u5C42\u65F6\u95F4\u8F6E\n        if (overflowWheel != null) {\n            overflowWheel.advanceClock(currentTime)\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u4EFB\u52A1\u6267\u884C\u6D41\u7A0B"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// SystemTimer\u7C7B\ndef advanceClock(timeoutMs: Long): Boolean = {\n    // \u4ECEDelayQueue\u83B7\u53D6\u5230\u671F\u7684bucket\n    val bucket = delayQueue.poll(timeoutMs, TimeUnit.MILLISECONDS)\n    \n    if (bucket != null) {\n        // \u63A8\u8FDB\u65F6\u95F4\u8F6E\n        timingWheel.advanceClock(bucket.getExpiration)\n        \n        // \u6267\u884Cbucket\u4E2D\u7684\u6240\u6709\u4EFB\u52A1\n        bucket.flush(reinsert)\n        true\n    } else {\n        false\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u65F6\u95F4\u590D\u6742\u5EA6"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u64CD\u4F5C"}),(0,l.jsx)(e.th,{children:"\u65F6\u95F4\u590D\u6742\u5EA6"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6DFB\u52A0\u4EFB\u52A1"}),(0,l.jsx)(e.td,{children:"O(1)"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5220\u9664\u4EFB\u52A1"}),(0,l.jsx)(e.td,{children:"O(1)"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6267\u884C\u4EFB\u52A1"}),(0,l.jsx)(e.td,{children:"O(1)"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"9. Kafka\u4E2D\u7684\u5E94\u7528\u573A\u666F"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5EF6\u65F6\u64CD\u4F5C\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Produce\u8BF7\u6C42\u7684\u5EF6\u65F6\u54CD\u5E94"}),"\n",(0,l.jsx)(e.li,{children:"Fetch\u8BF7\u6C42\u7684\u5EF6\u65F6\u54CD\u5E94"}),"\n",(0,l.jsx)(e.li,{children:"\u7B49\u5F85ISR\u526F\u672C\u540C\u6B65"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8D85\u65F6\u63A7\u5236\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E8B\u52A1\u8D85\u65F6"}),"\n",(0,l.jsx)(e.li,{children:"\u8BF7\u6C42\u8D85\u65F6"}),"\n",(0,l.jsx)(e.li,{children:"\u4F1A\u8BDD\u8D85\u65F6"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5FC3\u8DF3\u68C0\u6D4B\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5FC3\u8DF3"}),"\n",(0,l.jsx)(e.li,{children:"\u526F\u672C\u540C\u6B65\u5FC3\u8DF3"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"10. \u4F18\u52BF"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u9AD8\u6027\u80FD"}),"\uFF1AO(1)\u7684\u63D2\u5165\u548C\u5220\u9664"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4F4E\u5EF6\u8FDF"}),"\uFF1A\u7CBE\u786E\u7684\u65F6\u95F4\u63A7\u5236"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u53EF\u6269\u5C55"}),"\uFF1A\u652F\u6301\u5C42\u7EA7\u7ED3\u6784\uFF0C\u5904\u7406\u4EFB\u610F\u957F\u7684\u5EF6\u65F6"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5185\u5B58\u53CB\u597D"}),"\uFF1A\u53EA\u5B58\u50A8\u4EFB\u52A1\u5F15\u7528\uFF0C\u4E0D\u590D\u5236\u4EFB\u52A1"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6839\u636E\u4E1A\u52A1\u9700\u6C42\u8BBE\u7F6E\u5408\u9002\u7684tickMs\u548CwheelSize"}),"\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u521B\u5EFA\u8FC7\u591A\u7684\u65F6\u95F4\u8F6E\u5C42\u7EA7"}),"\n",(0,l.jsx)(e.li,{children:"\u53CA\u65F6\u6E05\u7406\u5DF2\u53D6\u6D88\u7684\u4EFB\u52A1"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"13-\u8BF4\u8BF4-kafka-\u7684\u7D22\u5F15\u8BBE\u8BA1\u6709\u4EC0\u4E48\u4EAE\u70B9",children:"13. \u8BF4\u8BF4 Kafka \u7684\u7D22\u5F15\u8BBE\u8BA1\u6709\u4EC0\u4E48\u4EAE\u70B9\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsxs)(e.p,{children:["Kafka\u7684\u7D22\u5F15\u8BBE\u8BA1\u975E\u5E38\u5DE7\u5999\uFF0C\u4E3B\u8981\u5305\u62EC",(0,l.jsx)(e.strong,{children:"\u504F\u79FB\u91CF\u7D22\u5F15"}),"\u548C",(0,l.jsx)(e.strong,{children:"\u65F6\u95F4\u6233\u7D22\u5F15"}),"\uFF0C\u5B9E\u73B0\u4E86\u5FEB\u901F\u5B9A\u4F4D\u6D88\u606F\u7684\u529F\u80FD\u3002"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u7D22\u5F15\u6587\u4EF6\u7ED3\u6784"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4E09\u79CD\u6587\u4EF6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"00000000000000000000.log    # \u65E5\u5FD7\u6587\u4EF6\uFF08\u5B58\u50A8\u6D88\u606F\uFF09\n00000000000000000000.index  # \u504F\u79FB\u91CF\u7D22\u5F15\u6587\u4EF6\n00000000000000000000.timeindex  # \u65F6\u95F4\u6233\u7D22\u5F15\u6587\u4EF6\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6587\u4EF6\u547D\u540D\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6587\u4EF6\u540D\u662F\u8BE5segment\u7684\u8D77\u59CBoffset"}),"\n",(0,l.jsx)(e.li,{children:"\u4F8B\u5982\uFF1A00000000000000368769.log\u8868\u793A\u4ECEoffset 368769\u5F00\u59CB"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u504F\u79FB\u91CF\u7D22\u5F15\uFF08OffsetIndex\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7D22\u5F15\u683C\u5F0F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"[\u76F8\u5BF9offset, \u7269\u7406\u4F4D\u7F6E]\n[4 bytes,    4 bytes]\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u76F8\u5BF9offset  \u7269\u7406\u4F4D\u7F6E\n0          0\n10         1024\n20         2048\n30         3072\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7A00\u758F\u7D22\u5F15"}),"\uFF1A\u4E0D\u662F\u6BCF\u6761\u6D88\u606F\u90FD\u6709\u7D22\u5F15\uFF0C\u800C\u662F\u6BCF\u9694\u4E00\u5B9A\u6570\u91CF\u7684\u6D88\u606F\u5EFA\u7ACB\u4E00\u4E2A\u7D22\u5F15"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u76F8\u5BF9offset"}),"\uFF1A\u5B58\u50A8\u7684\u662F\u76F8\u5BF9\u4E8Esegment\u8D77\u59CBoffset\u7684\u76F8\u5BF9\u503C"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u56FA\u5B9A\u5927\u5C0F"}),"\uFF1A\u6BCF\u4E2A\u7D22\u5F15\u98798\u5B57\u8282\uFF0C\u4FBF\u4E8E\u4E8C\u5206\u67E5\u627E"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5185\u5B58\u6620\u5C04"}),"\uFF1A\u4F7F\u7528mmap\u6280\u672F\uFF0C\u63D0\u9AD8\u8BBF\u95EE\u901F\u5EA6"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u65F6\u95F4\u6233\u7D22\u5F15\uFF08TimeIndex\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7D22\u5F15\u683C\u5F0F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"[\u65F6\u95F4\u6233,     \u76F8\u5BF9offset]\n[8 bytes,   4 bytes]\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u65F6\u95F4\u6233              \u76F8\u5BF9offset\n1609459200000      0\n1609459260000      100\n1609459320000      200\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7528\u9014\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6839\u636E\u65F6\u95F4\u6233\u67E5\u627E\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u57FA\u4E8E\u65F6\u95F4\u7684\u6D88\u606F\u6E05\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u57FA\u4E8E\u65F6\u95F4\u7684\u6D88\u606F\u6D88\u8D39"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u67E5\u627E\u6D88\u606F\u7684\u8FC7\u7A0B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6839\u636Eoffset\u67E5\u627E\u6D88\u606F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// 1. \u5B9A\u4F4Dsegment\u6587\u4EF6\n// \u5047\u8BBE\u8981\u67E5\u627Eoffset=368800\u7684\u6D88\u606F\n// \u627E\u5230segment: 00000000000000368769.log\n\n// 2. \u5728index\u6587\u4EF6\u4E2D\u4E8C\u5206\u67E5\u627E\n// \u67E5\u627E\u5C0F\u4E8E\u7B49\u4E8E368800\u7684\u6700\u5927\u7D22\u5F15\u9879\n// \u5047\u8BBE\u627E\u5230\uFF1A\u76F8\u5BF9offset=31, \u7269\u7406\u4F4D\u7F6E=3072\n\n// 3. \u4ECE\u7269\u7406\u4F4D\u7F6E3072\u5F00\u59CB\u987A\u5E8F\u626B\u63CFlog\u6587\u4EF6\n// \u76F4\u5230\u627E\u5230offset=368800\u7684\u6D88\u606F\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6839\u636E\u65F6\u95F4\u6233\u67E5\u627E\u6D88\u606F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// 1. \u5728timeindex\u6587\u4EF6\u4E2D\u4E8C\u5206\u67E5\u627E\n// \u627E\u5230\u5C0F\u4E8E\u7B49\u4E8E\u76EE\u6807\u65F6\u95F4\u6233\u7684\u6700\u5927\u7D22\u5F15\u9879\n// \u5F97\u5230\u76F8\u5BF9offset\n\n// 2. \u4F7F\u7528\u76F8\u5BF9offset\u5728index\u6587\u4EF6\u4E2D\u67E5\u627E\n// \u5F97\u5230\u7269\u7406\u4F4D\u7F6E\n\n// 3. \u4ECE\u7269\u7406\u4F4D\u7F6E\u5F00\u59CB\u987A\u5E8F\u626B\u63CF\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u7D22\u5F15\u7684\u4EAE\u70B9"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EAE\u70B91\uFF1A\u7A00\u758F\u7D22\u5F15"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E0D\u4E3A\u6BCF\u6761\u6D88\u606F\u5EFA\u7D22\u5F15\uFF0C\u8282\u7701\u7A7A\u95F4"}),"\n",(0,l.jsxs)(e.li,{children:["\u901A\u8FC7",(0,l.jsx)(e.code,{children:"log.index.interval.bytes"}),"\u63A7\u5236\u7D22\u5F15\u5BC6\u5EA6\uFF08\u9ED8\u8BA44KB\uFF09"]}),"\n",(0,l.jsx)(e.li,{children:"\u5E73\u8861\u4E86\u7A7A\u95F4\u548C\u67E5\u627E\u6548\u7387"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EAE\u70B92\uFF1A\u5185\u5B58\u6620\u5C04\u6587\u4EF6\uFF08mmap\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Kafka\u4F7F\u7528MappedByteBuffer\nMappedByteBuffer mmap = channel.map(\n    FileChannel.MapMode.READ_WRITE, 0, fileSize);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u52BF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u7CFB\u7EDF\u8C03\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u5229\u7528\u64CD\u4F5C\u7CFB\u7EDF\u7684\u9875\u7F13\u5B58"}),"\n",(0,l.jsx)(e.li,{children:"\u96F6\u62F7\u8D1D\u6280\u672F"}),"\n",(0,l.jsx)(e.li,{children:"\u81EA\u52A8\u9884\u8BFB"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EAE\u70B93\uFF1A\u4E8C\u5206\u67E5\u627E"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7D22\u5F15\u9879\u56FA\u5B9A\u5927\u5C0F\uFF0C\u652F\u6301O(log n)\u7684\u4E8C\u5206\u67E5\u627E"}),"\n",(0,l.jsx)(e.li,{children:"\u5FEB\u901F\u5B9A\u4F4D\u5230\u63A5\u8FD1\u76EE\u6807\u7684\u4F4D\u7F6E"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EAE\u70B94\uFF1A\u5206\u6BB5\u5B58\u50A8"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6BCF\u4E2Asegment\u72EC\u7ACB\u7D22\u5F15"}),"\n",(0,l.jsx)(e.li,{children:"\u4FBF\u4E8E\u5220\u9664\u8FC7\u671F\u6570\u636E"}),"\n",(0,l.jsx)(e.li,{children:"\u63D0\u9AD8\u5E76\u53D1\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EAE\u70B95\uFF1A\u5EF6\u8FDF\u5199\u5165"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u7D22\u5F15\u4E0D\u662F\u5B9E\u65F6\u5199\u5165\uFF0C\u800C\u662F\u6279\u91CF\u5199\u5165\n// \u51CF\u5C11\u78C1\u76D8IO\u6B21\u6570\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u7D22\u5F15\u6587\u4EF6\u7684\u521B\u5EFA\u548C\u7EF4\u62A4"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u521B\u5EFA\u65F6\u673A\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5F53\u5199\u5165\u7684\u6D88\u606F\u5927\u5C0F\u7D2F\u8BA1\u8D85\u8FC7log.index.interval.bytes\u65F6\nif (bytesSinceLastIndexEntry > indexIntervalBytes) {\n    // \u6DFB\u52A0\u7D22\u5F15\u9879\n    offsetIndex.append(offset, position);\n    timeIndex.append(timestamp, offset);\n    bytesSinceLastIndexEntry = 0;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7D22\u5F15\u6062\u590D\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Broker\u542F\u52A8\u65F6\uFF0C\u68C0\u67E5\u7D22\u5F15\u6587\u4EF6\u662F\u5426\u5B8C\u6574\n// \u5982\u679C\u4E0D\u5B8C\u6574\uFF0C\u91CD\u5EFA\u7D22\u5F15\ndef rebuildIndex() {\n    // \u904D\u5386log\u6587\u4EF6\n    // \u91CD\u65B0\u6784\u5EFAindex\u548Ctimeindex\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u914D\u7F6E\u53C2\u6570"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u7D22\u5F15\u95F4\u9694\uFF08\u5B57\u8282\uFF09\nlog.index.interval.bytes=4096\n\n# segment\u5927\u5C0F\nlog.segment.bytes=1073741824\n\n# \u7D22\u5F15\u6587\u4EF6\u5927\u5C0F\nsegment.index.bytes=10485760\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u6027\u80FD\u4F18\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9884\u5206\u914D\u7A7A\u95F4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u7D22\u5F15\u6587\u4EF6\u9884\u5206\u914D\u56FA\u5B9A\u5927\u5C0F\n// \u907F\u514D\u9891\u7E41\u6269\u5BB9\nval indexFile = new File("00000000000000000000.index")\nindexFile.setLength(10 * 1024 * 1024)  // 10MB\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6279\u91CF\u5237\u76D8\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u662F\u6BCF\u6B21\u5199\u5165\u90FD\u5237\u76D8\n// \u5B9A\u671F\u6216\u8FBE\u5230\u4E00\u5B9A\u91CF\u540E\u5237\u76D8\nif (needFlush) {\n    mmap.force()  // \u5F3A\u5236\u5237\u76D8\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"9. \u7D22\u5F15\u7684\u9650\u5236"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u7A00\u758F\u6027"}),"\uFF1A\u9700\u8981\u987A\u5E8F\u626B\u63CF\u90E8\u5206log\u6587\u4EF6"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5185\u5B58\u5360\u7528"}),"\uFF1A\u5927\u91CFsegment\u4F1A\u5360\u7528\u8F83\u591A\u5185\u5B58"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u91CD\u5EFA\u6210\u672C"}),"\uFF1A\u7D22\u5F15\u635F\u574F\u65F6\u91CD\u5EFA\u8017\u65F6"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"10. \u5B9E\u9645\u5E94\u7528"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u4ECE\u6307\u5B9Aoffset\u6D88\u8D39\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'consumer.seek(new TopicPartition("topic", 0), 368800);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u4ECE\u6307\u5B9A\u65F6\u95F4\u6D88\u8D39\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"Map<TopicPartition, Long> timestampsToSearch = new HashMap<>();\ntimestampsToSearch.put(partition, timestamp);\nMap<TopicPartition, OffsetAndTimestamp> offsets = \n    consumer.offsetsForTimes(timestampsToSearch);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8BBE\u7F6Esegment\u5927\u5C0F\u548C\u7D22\u5F15\u95F4\u9694"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u7D22\u5F15\u6587\u4EF6\u5927\u5C0F\u548C\u6570\u91CF"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9A\u671F\u6E05\u7406\u8FC7\u671F\u6570\u636E"}),"\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u9891\u7E41\u7684\u968F\u673A\u8BBF\u95EE"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"14-\u770B\u8FC7\u6E90\u7801\u90A3\u8BF4\u8BF4-kafka-\u63A7\u5236\u5668\u4E8B\u4EF6\u5904\u7406\u5168\u6D41\u7A0B",children:"14. \u770B\u8FC7\u6E90\u7801\uFF1F\u90A3\u8BF4\u8BF4 Kafka \u63A7\u5236\u5668\u4E8B\u4EF6\u5904\u7406\u5168\u6D41\u7A0B\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u63A7\u5236\u5668\uFF08Controller\uFF09\u662F\u96C6\u7FA4\u4E2D\u7684\u4E00\u4E2A\u7279\u6B8ABroker\uFF0C\u8D1F\u8D23\u7BA1\u7406\u6574\u4E2A\u96C6\u7FA4\u7684\u5143\u6570\u636E\u548C\u72B6\u6001\u53D8\u66F4\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u63A7\u5236\u5668\u7684\u804C\u8D23"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u804C\u8D23\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u533ALeader\u9009\u4E3E"}),"\uFF1A\u5F53Leader\u526F\u672C\u5931\u6548\u65F6\u9009\u4E3E\u65B0Leader"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5206\u533A\u91CD\u5206\u914D"}),"\uFF1A\u6267\u884C\u5206\u533A\u526F\u672C\u7684\u91CD\u65B0\u5206\u914D"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Topic\u7BA1\u7406"}),"\uFF1A\u521B\u5EFA\u3001\u5220\u9664Topic"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u526F\u672C\u7BA1\u7406"}),"\uFF1A\u7BA1\u7406ISR\u5217\u8868\u7684\u53D8\u66F4"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Broker\u4E0A\u4E0B\u7EBF"}),"\uFF1A\u5904\u7406Broker\u7684\u52A0\u5165\u548C\u79BB\u5F00"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u63A7\u5236\u5668\u9009\u4E3E"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9009\u4E3E\u8FC7\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// 1. \u6BCF\u4E2ABroker\u542F\u52A8\u65F6\u5C1D\u8BD5\u5728ZK\u521B\u5EFA/controller\u8282\u70B9\ntry {\n    zkClient.createEphemeralNodeForController("/controller", brokerId);\n    // \u521B\u5EFA\u6210\u529F\uFF0C\u6210\u4E3AController\n    becomeController();\n} catch (NodeExistsException e) {\n    // \u8282\u70B9\u5DF2\u5B58\u5728\uFF0C\u6CE8\u518C\u76D1\u542C\u5668\n    zkClient.registerControllerChangeListener();\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Controller\u4FE1\u606F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'{\n  "version": 1,\n  "brokerid": 0,\n  "timestamp": "1609459200000"\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u4E8B\u4EF6\u961F\u5217\u673A\u5236"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ControllerEventManager\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'class ControllerEventManager(\n    controllerId: Int,\n    processor: ControllerEventProcessor,\n    eventQueueTimeHist: Histogram\n) {\n    // \u4E8B\u4EF6\u961F\u5217\n    private val queue = new LinkedBlockingQueue[ControllerEvent]\n    \n    // \u4E8B\u4EF6\u5904\u7406\u7EBF\u7A0B\n    private val thread = new ControllerEventThread("controller-event-thread")\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4E8B\u4EF6\u7C7B\u578B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"sealed trait ControllerEvent\ncase object Startup extends ControllerEvent\ncase object BrokerChange extends ControllerEvent\ncase class TopicChange(topics: Set[String]) extends ControllerEvent\ncase class PartitionModifications(topic: String) extends ControllerEvent\ncase class LeaderAndIsrChange(partitions: Set[TopicPartition]) extends ControllerEvent\ncase class ControllerChange extends ControllerEvent\ncase object Reelect extends ControllerEvent\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u4E8B\u4EF6\u5904\u7406\u5168\u6D41\u7A0B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D41\u7A0B\u56FE\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u4E8B\u4EF6\u4EA7\u751F -> \u52A0\u5165\u961F\u5217 -> \u4E8B\u4EF6\u7EBF\u7A0B\u53D6\u51FA -> \u72B6\u6001\u673A\u5904\u7406 -> \u53D1\u9001\u8BF7\u6C42 -> \u66F4\u65B0\u5143\u6570\u636E\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8BE6\u7EC6\u6B65\u9AA4\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA41\uFF1A\u4E8B\u4EF6\u4EA7\u751F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"// ZK\u76D1\u542C\u5668\u89E6\u53D1\u4E8B\u4EF6\nclass BrokerChangeListener extends IZkChildListener {\n    override def handleChildChange(parentPath: String, \n                                   currentChildren: java.util.List[String]) {\n        // \u5C06\u4E8B\u4EF6\u52A0\u5165\u961F\u5217\n        eventManager.put(BrokerChange)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA42\uFF1A\u4E8B\u4EF6\u5165\u961F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def put(event: ControllerEvent): Unit = {\n    queue.put(event)\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA43\uFF1A\u4E8B\u4EF6\u5904\u7406\u7EBF\u7A0B"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'class ControllerEventThread extends ShutdownableThread {\n    override def doWork(): Unit = {\n        // \u4ECE\u961F\u5217\u53D6\u51FA\u4E8B\u4EF6\n        val event = queue.take()\n        \n        try {\n            // \u5904\u7406\u4E8B\u4EF6\n            processor.process(event)\n        } catch {\n            case e: Throwable => error("Error processing event", e)\n        }\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA44\uFF1A\u4E8B\u4EF6\u5904\u7406\u5668"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def process(event: ControllerEvent): Unit = {\n    event match {\n        case BrokerChange =>\n            processBrokerChange()\n        case TopicChange(topics) =>\n            processTopicChange(topics)\n        case PartitionModifications(topic) =>\n            processPartitionModifications(topic)\n        case LeaderAndIsrChange(partitions) =>\n            processLeaderAndIsrChange(partitions)\n        // ...\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u5177\u4F53\u4E8B\u4EF6\u5904\u7406\u793A\u4F8B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u793A\u4F8B1\uFF1ABroker\u4E0B\u7EBF\u5904\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def processBrokerChange(): Unit = {\n    // 1. \u83B7\u53D6\u5F53\u524D\u5B58\u6D3B\u7684Broker\u5217\u8868\n    val curBrokers = zkClient.getAllBrokersInCluster()\n    val curBrokerIds = curBrokers.map(_.id).toSet\n    \n    // 2. \u627E\u51FA\u65B0\u589E\u548C\u5220\u9664\u7684Broker\n    val newBrokerIds = curBrokerIds -- controllerContext.liveBrokerIds\n    val deadBrokerIds = controllerContext.liveBrokerIds -- curBrokerIds\n    \n    // 3. \u66F4\u65B0Controller\u4E0A\u4E0B\u6587\n    controllerContext.liveBrokerIds = curBrokerIds\n    \n    // 4. \u5904\u7406\u65B0\u589EBroker\n    if (newBrokerIds.nonEmpty) {\n        onBrokerStartup(newBrokerIds.toSeq)\n    }\n    \n    // 5. \u5904\u7406\u4E0B\u7EBFBroker\n    if (deadBrokerIds.nonEmpty) {\n        onBrokerFailure(deadBrokerIds.toSeq)\n    }\n}\n\ndef onBrokerFailure(deadBrokers: Seq[Int]): Unit = {\n    // 1. \u627E\u51FA\u53D7\u5F71\u54CD\u7684\u5206\u533A\uFF08Leader\u5728\u4E0B\u7EBFBroker\u4E0A\uFF09\n    val partitionsWithoutLeader = controllerContext.partitionLeadershipInfo\n        .filter { case (_, leaderIsrAndControllerEpoch) =>\n            deadBrokers.contains(leaderIsrAndControllerEpoch.leaderAndIsr.leader)\n        }.keySet\n    \n    // 2. \u4E3A\u8FD9\u4E9B\u5206\u533A\u9009\u4E3E\u65B0Leader\n    partitionStateMachine.handleStateChanges(\n        partitionsWithoutLeader.toSeq,\n        OnlinePartition,\n        Option(OfflinePartitionLeaderElectionStrategy)\n    )\n    \n    // 3. \u4ECEISR\u4E2D\u79FB\u9664\u4E0B\u7EBF\u7684\u526F\u672C\n    replicaStateMachine.handleStateChanges(\n        getReplicasOnBrokers(deadBrokers),\n        OfflineReplica\n    )\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u793A\u4F8B2\uFF1A\u5206\u533ALeader\u9009\u4E3E"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def electLeader(\n    partition: TopicPartition,\n    strategy: PartitionLeaderElectionStrategy\n): Option[Int] = {\n    \n    val assignment = controllerContext.partitionReplicaAssignment(partition)\n    val liveReplicas = assignment.filter(r => \n        controllerContext.isReplicaOnline(r, partition))\n    \n    strategy match {\n        case OfflinePartitionLeaderElectionStrategy =>\n            // \u4ECEISR\u4E2D\u9009\u62E9\u7B2C\u4E00\u4E2A\u5B58\u6D3B\u7684\u526F\u672C\n            liveReplicas.find(r => \n                controllerContext.partitionLeadershipInfo(partition)\n                    .leaderAndIsr.isr.contains(r)\n            )\n        \n        case PreferredReplicaPartitionLeaderElectionStrategy =>\n            // \u9009\u62E9preferred replica\uFF08AR\u4E2D\u7684\u7B2C\u4E00\u4E2A\uFF09\n            if (liveReplicas.head == assignment.head)\n                Some(assignment.head)\n            else\n                None\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u72B6\u6001\u673A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u4F7F\u7528\u4E24\u4E2A\u72B6\u6001\u673A\u7BA1\u7406\u72B6\u6001\u53D8\u66F4\uFF1A"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ReplicaStateMachine\uFF08\u526F\u672C\u72B6\u6001\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"NewReplica -> OnlineReplica -> OfflineReplica -> ReplicaDeletionStarted \n                                              -> ReplicaDeletionSuccessful\n                                              -> NonExistentReplica\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"PartitionStateMachine\uFF08\u5206\u533A\u72B6\u6001\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"NewPartition -> OnlinePartition -> OfflinePartition -> NonExistentPartition\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u8BF7\u6C42\u53D1\u9001"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"// Controller\u5411Broker\u53D1\u9001\u8BF7\u6C42\ndef sendRequest(\n    brokerId: Int,\n    request: AbstractControlRequest\n): Unit = {\n    \n    request match {\n        case leaderAndIsrRequest: LeaderAndIsrRequest =>\n            // \u53D1\u9001Leader\u548CISR\u53D8\u66F4\u8BF7\u6C42\n            controllerChannelManager.sendRequest(brokerId, leaderAndIsrRequest)\n        \n        case updateMetadataRequest: UpdateMetadataRequest =>\n            // \u53D1\u9001\u5143\u6570\u636E\u66F4\u65B0\u8BF7\u6C42\n            controllerChannelManager.sendRequest(brokerId, updateMetadataRequest)\n        \n        case stopReplicaRequest: StopReplicaRequest =>\n            // \u53D1\u9001\u505C\u6B62\u526F\u672C\u8BF7\u6C42\n            controllerChannelManager.sendRequest(brokerId, stopReplicaRequest)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u5143\u6570\u636E\u66F4\u65B0"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'// \u66F4\u65B0ZK\u4E2D\u7684\u5143\u6570\u636E\ndef updateLeaderAndIsr(\n    partition: TopicPartition,\n    newLeaderAndIsr: LeaderAndIsr\n): Unit = {\n    \n    val path = s"/brokers/topics/${partition.topic}/partitions/${partition.partition}/state"\n    \n    zkClient.updatePersistentPath(path, newLeaderAndIsr.toJson)\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"9. Controller Epoch"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'// \u6BCF\u6B21Controller\u53D8\u66F4\u65F6\u9012\u589E\nvar controllerEpoch: Int = 0\n\ndef incrementControllerEpoch(): Unit = {\n    controllerEpoch += 1\n    zkClient.updatePersistentPath("/controller_epoch", controllerEpoch.toString)\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u7528\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9632\u6B62\u8111\u88C2"}),"\n",(0,l.jsx)(e.li,{children:"\u62D2\u7EDD\u8FC7\u671FController\u7684\u8BF7\u6C42"}),"\n",(0,l.jsx)(e.li,{children:"\u4FDD\u8BC1\u64CD\u4F5C\u7684\u987A\u5E8F\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"10. \u6027\u80FD\u4F18\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6279\u91CF\u5904\u7406\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"// \u6279\u91CF\u5904\u7406\u5206\u533A\u53D8\u66F4\ndef batchLeaderElection(\n    partitions: Set[TopicPartition]\n): Unit = {\n    // \u4E00\u6B21\u6027\u5904\u7406\u591A\u4E2A\u5206\u533A\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5F02\u6B65\u53D1\u9001\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"// \u5F02\u6B65\u53D1\u9001\u8BF7\u6C42\u7ED9Broker\ncontrollerChannelManager.sendRequest(brokerId, request, callback)\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7Controller\u7684\u4E8B\u4EF6\u961F\u5217\u5927\u5C0F"}),"\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u9891\u7E41\u7684\u5206\u533A\u91CD\u5206\u914D"}),"\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8BBE\u7F6EZK\u7684session timeout"}),"\n",(0,l.jsx)(e.li,{children:"\u5173\u6CE8Controller\u5207\u6362\u7684\u9891\u7387"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"15-kafka-\u4E2D-zookeeper-\u7684\u4F5C\u7528",children:"15. Kafka \u4E2D Zookeeper \u7684\u4F5C\u7528\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"ZooKeeper\u5728Kafka\u4E2D\u626E\u6F14\u7740\u975E\u5E38\u91CD\u8981\u7684\u89D2\u8272\uFF0C\u4E3B\u8981\u7528\u4E8E\u96C6\u7FA4\u7BA1\u7406\u3001\u5143\u6570\u636E\u5B58\u50A8\u548C\u5206\u5E03\u5F0F\u534F\u8C03\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. ZooKeeper\u7684\u6838\u5FC3\u4F5C\u7528"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u75281\uFF1AController\u9009\u4E3E"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u901A\u8FC7\u4E34\u65F6\u8282\u70B9",(0,l.jsx)(e.code,{children:"/controller"}),"\u5B9E\u73B0Controller\u9009\u4E3E"]}),"\n",(0,l.jsx)(e.li,{children:"\u4FDD\u8BC1\u96C6\u7FA4\u4E2D\u53EA\u6709\u4E00\u4E2AController"}),"\n",(0,l.jsx)(e.li,{children:"Controller\u5B95\u673A\u540E\u81EA\u52A8\u91CD\u65B0\u9009\u4E3E"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u75282\uFF1ABroker\u6CE8\u518C"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u6BCF\u4E2ABroker\u542F\u52A8\u65F6\u5728",(0,l.jsx)(e.code,{children:"/brokers/ids/[broker_id]"}),"\u521B\u5EFA\u4E34\u65F6\u8282\u70B9"]}),"\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8Broker\u7684host\u3001port\u7B49\u4FE1\u606F"}),"\n",(0,l.jsx)(e.li,{children:"Broker\u5B95\u673A\u540E\u8282\u70B9\u81EA\u52A8\u5220\u9664"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u75283\uFF1ATopic\u6CE8\u518C"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8Topic\u7684\u914D\u7F6E\u4FE1\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8\u5206\u533A\u548C\u526F\u672C\u7684\u5206\u914D\u4FE1\u606F"}),"\n",(0,l.jsxs)(e.li,{children:["\u8DEF\u5F84\uFF1A",(0,l.jsx)(e.code,{children:"/brokers/topics/[topic_name]"})]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u75284\uFF1A\u5206\u533A\u72B6\u6001\u7BA1\u7406"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8\u6BCF\u4E2A\u5206\u533A\u7684Leader\u3001ISR\u7B49\u4FE1\u606F"}),"\n",(0,l.jsxs)(e.li,{children:["\u8DEF\u5F84\uFF1A",(0,l.jsx)(e.code,{children:"/brokers/topics/[topic]/partitions/[partition]/state"})]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u75285\uFF1A\u6D88\u8D39\u8005\u7EC4\u7BA1\u7406\uFF08\u65E7\u7248\uFF09"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8\u6D88\u8D39\u8005\u7EC4\u4FE1\u606F\uFF08\u65B0\u7248\u5DF2\u8FC1\u79FB\u5230Kafka\u5185\u90E8\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8\u6D88\u8D39offset\uFF08\u65B0\u7248\u4F7F\u7528__consumer_offsets\uFF09"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F5C\u75286\uFF1A\u914D\u7F6E\u7BA1\u7406"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8Topic\u548CBroker\u7684\u52A8\u6001\u914D\u7F6E"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u914D\u7F6E\u7684\u52A8\u6001\u53D8\u66F4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. ZooKeeper\u8282\u70B9\u7ED3\u6784"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"/\n\u251C\u2500\u2500 controller              # Controller\u4FE1\u606F\n\u251C\u2500\u2500 controller_epoch        # Controller\u7248\u672C\u53F7\n\u251C\u2500\u2500 brokers\n\u2502   \u251C\u2500\u2500 ids                # Broker\u5217\u8868\n\u2502   \u2502   \u251C\u2500\u2500 0             # Broker 0\u7684\u4FE1\u606F\n\u2502   \u2502   \u251C\u2500\u2500 1             # Broker 1\u7684\u4FE1\u606F\n\u2502   \u2502   \u2514\u2500\u2500 2             # Broker 2\u7684\u4FE1\u606F\n\u2502   \u251C\u2500\u2500 topics            # Topic\u4FE1\u606F\n\u2502   \u2502   \u2514\u2500\u2500 test-topic\n\u2502   \u2502       \u251C\u2500\u2500 partitions\n\u2502   \u2502       \u2502   \u251C\u2500\u2500 0\n\u2502   \u2502       \u2502   \u2502   \u2514\u2500\u2500 state  # \u5206\u533A0\u7684\u72B6\u6001\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 1\n\u2502   \u2502       \u2502       \u2514\u2500\u2500 state  # \u5206\u533A1\u7684\u72B6\u6001\n\u2502   \u2514\u2500\u2500 seqid             # Broker ID\u5E8F\u5217\u53F7\n\u251C\u2500\u2500 config\n\u2502   \u251C\u2500\u2500 topics            # Topic\u914D\u7F6E\n\u2502   \u251C\u2500\u2500 brokers           # Broker\u914D\u7F6E\n\u2502   \u2514\u2500\u2500 changes           # \u914D\u7F6E\u53D8\u66F4\u901A\u77E5\n\u251C\u2500\u2500 admin\n\u2502   \u251C\u2500\u2500 delete_topics     # \u5F85\u5220\u9664\u7684Topic\n\u2502   \u2514\u2500\u2500 reassign_partitions  # \u5206\u533A\u91CD\u5206\u914D\n\u251C\u2500\u2500 isr_change_notification  # ISR\u53D8\u66F4\u901A\u77E5\n\u2514\u2500\u2500 consumers             # \u6D88\u8D39\u8005\u7EC4\uFF08\u65E7\u7248\uFF09\n    \u2514\u2500\u2500 group-1\n        \u251C\u2500\u2500 ids           # \u6D88\u8D39\u8005\u5217\u8868\n        \u2514\u2500\u2500 offsets       # \u6D88\u8D39offset\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u8BE6\u7EC6\u8282\u70B9\u8BF4\u660E"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Controller\u8282\u70B9\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'// /controller\n{\n  "version": 1,\n  "brokerid": 0,\n  "timestamp": "1609459200000"\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Broker\u8282\u70B9\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'// /brokers/ids/0\n{\n  "version": 4,\n  "host": "localhost",\n  "port": 9092,\n  "jmx_port": 9999,\n  "timestamp": "1609459200000",\n  "endpoints": ["PLAINTEXT://localhost:9092"],\n  "rack": null\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Topic\u8282\u70B9\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'// /brokers/topics/test-topic\n{\n  "version": 2,\n  "partitions": {\n    "0": [0, 1, 2],  // \u5206\u533A0\u7684\u526F\u672C\u5728Broker 0,1,2\u4E0A\n    "1": [1, 2, 0],  // \u5206\u533A1\u7684\u526F\u672C\u5728Broker 1,2,0\u4E0A\n    "2": [2, 0, 1]   // \u5206\u533A2\u7684\u526F\u672C\u5728Broker 2,0,1\u4E0A\n  },\n  "adding_replicas": {},\n  "removing_replicas": {}\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u533A\u72B6\u6001\u8282\u70B9\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-json",children:'// /brokers/topics/test-topic/partitions/0/state\n{\n  "controller_epoch": 1,\n  "leader": 0,           // Leader\u526F\u672C\u5728Broker 0\n  "version": 1,\n  "leader_epoch": 0,\n  "isr": [0, 1, 2]       // ISR\u5217\u8868\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. ZooKeeper\u7684\u76D1\u542C\u673A\u5236"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Broker\u76D1\u542C\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'// Controller\u76D1\u542CBroker\u53D8\u5316\nzkClient.subscribeChildChanges("/brokers/ids", new IZkChildListener {\n    override def handleChildChange(parentPath: String, \n                                   currentChildren: java.util.List[String]) {\n        // Broker\u4E0A\u4E0B\u7EBF\u5904\u7406\n        eventManager.put(BrokerChange)\n    }\n})\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Topic\u76D1\u542C\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'// Controller\u76D1\u542CTopic\u53D8\u5316\nzkClient.subscribeChildChanges("/brokers/topics", new IZkChildListener {\n    override def handleChildChange(parentPath: String, \n                                   currentChildren: java.util.List[String]) {\n        // Topic\u521B\u5EFA/\u5220\u9664\u5904\u7406\n        eventManager.put(TopicChange(currentChildren.toSet))\n    }\n})\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u533A\u72B6\u6001\u76D1\u542C\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:'// Controller\u76D1\u542C\u5206\u533A\u72B6\u6001\u53D8\u5316\nzkClient.subscribeDataChanges(\n    s"/brokers/topics/$topic/partitions/$partition/state",\n    new IZkDataListener {\n        override def handleDataChange(dataPath: String, data: Object) {\n            // \u5206\u533A\u72B6\u6001\u53D8\u66F4\u5904\u7406\n        }\n        override def handleDataDeleted(dataPath: String) {\n            // \u5206\u533A\u5220\u9664\u5904\u7406\n        }\n    }\n)\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. ZooKeeper\u5728Kafka\u4E2D\u7684\u5DE5\u4F5C\u6D41\u7A0B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Broker\u542F\u52A8\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1. \u8FDE\u63A5ZooKeeper\n2. \u5728/brokers/ids/[broker_id]\u521B\u5EFA\u4E34\u65F6\u8282\u70B9\n3. \u6CE8\u518C\u76D1\u542C\u5668\u76D1\u542CController\u53D8\u5316\n4. \u5C1D\u8BD5\u7ADE\u9009Controller\n5. \u4ECEZooKeeper\u52A0\u8F7D\u5143\u6570\u636E\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Topic\u521B\u5EFA\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1. \u5728/brokers/topics/[topic]\u5199\u5165\u5206\u533A\u5206\u914D\u4FE1\u606F\n2. Controller\u76D1\u542C\u5230\u53D8\u5316\n3. Controller\u4E3A\u6BCF\u4E2A\u5206\u533A\u9009\u4E3ELeader\n4. Controller\u66F4\u65B0/brokers/topics/[topic]/partitions/[partition]/state\n5. Controller\u901A\u77E5\u76F8\u5173Broker\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u533ALeader\u9009\u4E3E\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1. Controller\u68C0\u6D4B\u5230Leader\u5931\u6548\n2. \u4ECEISR\u4E2D\u9009\u62E9\u65B0Leader\n3. \u66F4\u65B0ZooKeeper\u4E2D\u7684\u5206\u533A\u72B6\u6001\n4. \u53D1\u9001LeaderAndIsrRequest\u7ED9\u76F8\u5173Broker\n5. \u53D1\u9001UpdateMetadataRequest\u7ED9\u6240\u6709Broker\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. ZooKeeper\u7684\u6027\u80FD\u5F71\u54CD"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u74F6\u9888\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZooKeeper\u5199\u5165\u6027\u80FD\u6709\u9650\uFF08\u7EA61000 TPS\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u91CF\u76D1\u542C\u5668\u4F1A\u589E\u52A0ZooKeeper\u8D1F\u8F7D"}),"\n",(0,l.jsx)(e.li,{children:"\u7F51\u7EDC\u5EF6\u8FDF\u5F71\u54CD\u5143\u6570\u636E\u66F4\u65B0\u901F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u9891\u7E41\u7684\u5143\u6570\u636E\u53D8\u66F4\u4F1A\u5F71\u54CD\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u5316\u63AA\u65BD\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u589E\u52A0ZooKeeper\u4F1A\u8BDD\u8D85\u65F6\u65F6\u95F4\nzookeeper.session.timeout.ms=18000\n\n# \u51CF\u5C11\u4E0D\u5FC5\u8981\u7684\u5143\u6570\u636E\u66F4\u65B0\n# \u6279\u91CF\u5904\u7406\u5206\u533A\u53D8\u66F4\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. ZooKeeper\u7684\u95EE\u9898"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u98981\uFF1A\u6269\u5C55\u6027\u9650\u5236"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZooKeeper\u96C6\u7FA4\u89C4\u6A21\u6709\u9650\uFF08\u901A\u5E383-7\u4E2A\u8282\u70B9\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u89C4\u6A21Kafka\u96C6\u7FA4\u5143\u6570\u636E\u91CF\u5927"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u542C\u5668\u6570\u91CF\u8FC7\u591A\u5F71\u54CD\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u98982\uFF1A\u8FD0\u7EF4\u590D\u6742"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5355\u72EC\u90E8\u7F72\u548C\u7EF4\u62A4ZooKeeper\u96C6\u7FA4"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u52A0\u4E86\u7CFB\u7EDF\u590D\u6742\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u6545\u969C\u6392\u67E5\u56F0\u96BE"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u95EE\u98983\uFF1A\u6027\u80FD\u95EE\u9898"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Controller\u53D8\u66F4\u65F6\u9700\u8981\u91CD\u65B0\u52A0\u8F7D\u6240\u6709\u5143\u6570\u636E"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u91CF\u5206\u533A\u65F6\u5143\u6570\u636E\u52A0\u8F7D\u6162"}),"\n",(0,l.jsx)(e.li,{children:"\u9891\u7E41\u7684ZK\u5199\u5165\u5F71\u54CD\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u65B0\u7248Kafka\u7684\u6539\u8FDB\uFF08KRaft\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"KRaft\u6A21\u5F0F\uFF08Kafka 2.8+\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u79FB\u9664ZooKeeper\u4F9D\u8D56\n\u4F7F\u7528Raft\u534F\u8BAE\u5B9E\u73B0\u5143\u6570\u636E\u7BA1\u7406\n\u5143\u6570\u636E\u5B58\u50A8\u5728Kafka\u5185\u90E8Topic\u4E2D\n\u63D0\u9AD8\u6027\u80FD\u548C\u53EF\u6269\u5C55\u6027\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5BF9\u6BD4\uFF1A"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"ZooKeeper\u6A21\u5F0F"}),(0,l.jsx)(e.th,{children:"KRaft\u6A21\u5F0F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u4F9D\u8D56"}),(0,l.jsx)(e.td,{children:"\u9700\u8981ZooKeeper"}),(0,l.jsx)(e.td,{children:"\u65E0\u9700ZooKeeper"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5143\u6570\u636E\u5B58\u50A8"}),(0,l.jsx)(e.td,{children:"ZooKeeper"}),(0,l.jsx)(e.td,{children:"Kafka\u5185\u90E8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Controller\u9009\u4E3E"}),(0,l.jsx)(e.td,{children:"ZooKeeper"}),(0,l.jsx)(e.td,{children:"Raft\u534F\u8BAE"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6269\u5C55\u6027"}),(0,l.jsx)(e.td,{children:"\u53D7\u9650"}),(0,l.jsx)(e.td,{children:"\u66F4\u597D"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8FD0\u7EF4\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4F4E"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6027\u80FD"}),(0,l.jsx)(e.td,{children:"\u4E00\u822C"}),(0,l.jsx)(e.td,{children:"\u66F4\u597D"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8BBE\u7F6EZooKeeper\u4F1A\u8BDD\u8D85\u65F6\u65F6\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7ZooKeeper\u7684\u6027\u80FD\u6307\u6807"}),"\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u9891\u7E41\u7684\u5143\u6570\u636E\u53D8\u66F4"}),"\n",(0,l.jsx)(e.li,{children:"\u8003\u8651\u5347\u7EA7\u5230KRaft\u6A21\u5F0F\uFF08\u751F\u4EA7\u73AF\u5883\u9700\u8C28\u614E\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9A\u671F\u6E05\u7406ZooKeeper\u4E2D\u7684\u8FC7\u671F\u6570\u636E"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"16-kafka\u4E3A\u4EC0\u4E48\u8981\u629B\u5F03-zookeeper",children:"16. Kafka\u4E3A\u4EC0\u4E48\u8981\u629B\u5F03 Zookeeper\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u4ECE2.8\u7248\u672C\u5F00\u59CB\u5F15\u5165KRaft\u6A21\u5F0F\uFF08Kafka Raft\uFF09\uFF0C\u9010\u6B65\u79FB\u9664\u5BF9ZooKeeper\u7684\u4F9D\u8D56\uFF0C\u4E3B\u8981\u539F\u56E0\u5982\u4E0B\uFF1A"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u6027\u80FD\u95EE\u9898"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5143\u6570\u636E\u52A0\u8F7D\u6162\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Controller\u5207\u6362\u65F6\u9700\u8981\u4ECEZK\u91CD\u65B0\u52A0\u8F7D\u6240\u6709\u5143\u6570\u636E"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u89C4\u6A21\u96C6\u7FA4\uFF08\u6570\u4E07\u5206\u533A\uFF09\u52A0\u8F7D\u8017\u65F6\u53EF\u8FBE\u6570\u5206\u949F"}),"\n",(0,l.jsx)(e.li,{children:"\u5F71\u54CD\u96C6\u7FA4\u7684\u53EF\u7528\u6027\u548C\u6062\u590D\u65F6\u95F4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5199\u5165\u6027\u80FD\u74F6\u9888\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZooKeeper\u5199\u5165TPS\u6709\u9650\uFF08\u7EA61000-2000\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u9891\u7E41\u7684\u5143\u6570\u636E\u66F4\u65B0\u4F1A\u6210\u4E3A\u74F6\u9888"}),"\n",(0,l.jsx)(e.li,{children:"\u9650\u5236\u4E86Kafka\u7684\u6269\u5C55\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u6269\u5C55\u6027\u9650\u5236"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u96C6\u7FA4\u89C4\u6A21\u9650\u5236\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"ZooKeeper\u96C6\u7FA4\u901A\u5E383-7\u4E2A\u8282\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u542C\u5668\u6570\u91CF\u8FC7\u591A\u5F71\u54CD\u6027\u80FD"}),"\n",(0,l.jsx)(e.li,{children:"\u96BE\u4EE5\u652F\u6301\u8D85\u5927\u89C4\u6A21Kafka\u96C6\u7FA4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u533A\u6570\u91CF\u9650\u5236\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5927\u91CF\u5206\u533A\u5BFC\u81F4ZK\u5143\u6570\u636E\u81A8\u80C0"}),"\n",(0,l.jsx)(e.li,{children:"Controller\u7BA1\u7406\u5F00\u9500\u5927"}),"\n",(0,l.jsx)(e.li,{children:"\u5F71\u54CD\u6574\u4F53\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u8FD0\u7EF4\u590D\u6742\u5EA6"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u989D\u5916\u7EC4\u4EF6\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5355\u72EC\u90E8\u7F72\u548C\u7EF4\u62A4ZooKeeper\u96C6\u7FA4"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u52A0\u8FD0\u7EF4\u6210\u672C\u548C\u590D\u6742\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u6545\u969C\u70B9\u589E\u52A0"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7248\u672C\u517C\u5BB9\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Kafka\u548CZooKeeper\u7248\u672C\u517C\u5BB9\u6027\u95EE\u9898"}),"\n",(0,l.jsx)(e.li,{children:"\u5347\u7EA7\u56F0\u96BE"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u67B6\u6784\u95EE\u9898"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u53CC\u5199\u95EE\u9898\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5143\u6570\u636E\u65E2\u5728ZK\u53C8\u5728Kafka\u5185\u90E8"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u4E00\u81F4\u6027\u96BE\u4EE5\u4FDD\u8BC1"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u52A0\u590D\u6742\u5EA6"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F9D\u8D56\u5916\u90E8\u7CFB\u7EDF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Kafka\u4F9D\u8D56ZooKeeper\u7684\u7A33\u5B9A\u6027"}),"\n",(0,l.jsx)(e.li,{children:"ZK\u6545\u969C\u5F71\u54CDKafka\u53EF\u7528\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. KRaft\u6A21\u5F0F\u7684\u4F18\u52BF"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u63D0\u5347\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Controller\u5207\u6362\u66F4\u5FEB\uFF08\u79D2\u7EA7\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5143\u6570\u636E\u66F4\u65B0\u66F4\u9AD8\u6548"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u66F4\u5927\u89C4\u6A21\u96C6\u7FA4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B80\u5316\u67B6\u6784\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u79FB\u9664ZooKeeper\u4F9D\u8D56"}),"\n",(0,l.jsx)(e.li,{children:"\u5143\u6570\u636E\u5B58\u50A8\u5728Kafka\u5185\u90E8"}),"\n",(0,l.jsx)(e.li,{children:"\u964D\u4F4E\u8FD0\u7EF4\u590D\u6742\u5EA6"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u66F4\u597D\u7684\u6269\u5C55\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u767E\u4E07\u7EA7\u5206\u533A"}),"\n",(0,l.jsx)(e.li,{children:"Controller\u6027\u80FD\u66F4\u597D"}),"\n",(0,l.jsx)(e.li,{children:"\u96C6\u7FA4\u6062\u590D\u66F4\u5FEB"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. KRaft\u67B6\u6784"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u7EC4\u4EF6\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Quorum Controller"}),"\uFF1A\u57FA\u4E8ERaft\u534F\u8BAE\u7684Controller"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Metadata Topic"}),"\uFF1A\u5B58\u50A8\u5143\u6570\u636E\u7684\u5185\u90E8Topic"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Metadata Log"}),"\uFF1A\u5143\u6570\u636E\u53D8\u66F4\u65E5\u5FD7"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1. \u4F7F\u7528Raft\u534F\u8BAE\u9009\u4E3EController Leader\n2. \u5143\u6570\u636E\u5B58\u50A8\u5728__cluster_metadata Topic\u4E2D\n3. Controller\u53D8\u66F4\u901A\u8FC7\u65E5\u5FD7\u590D\u5236\u540C\u6B65\n4. Broker\u4ECE\u5143\u6570\u636ETopic\u8BFB\u53D6\u6700\u65B0\u72B6\u6001\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u5BF9\u6BD4\u603B\u7ED3"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"ZooKeeper\u6A21\u5F0F"}),(0,l.jsx)(e.th,{children:"KRaft\u6A21\u5F0F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5916\u90E8\u4F9D\u8D56"}),(0,l.jsx)(e.td,{children:"\u9700\u8981ZK"}),(0,l.jsx)(e.td,{children:"\u65E0\u9700ZK"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Controller\u5207\u6362"}),(0,l.jsx)(e.td,{children:"\u5206\u949F\u7EA7"}),(0,l.jsx)(e.td,{children:"\u79D2\u7EA7"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5143\u6570\u636E\u5B58\u50A8"}),(0,l.jsx)(e.td,{children:"ZooKeeper"}),(0,l.jsx)(e.td,{children:"Kafka\u5185\u90E8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5206\u533A\u6570\u91CF"}),(0,l.jsx)(e.td,{children:"\u53D7\u9650\uFF08\u6570\u4E07\uFF09"}),(0,l.jsx)(e.td,{children:"\u66F4\u9AD8\uFF08\u767E\u4E07\uFF09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8FD0\u7EF4\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4F4E"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6027\u80FD"}),(0,l.jsx)(e.td,{children:"\u4E00\u822C"}),(0,l.jsx)(e.td,{children:"\u66F4\u597D"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u7A33\u5B9A\u6027"}),(0,l.jsx)(e.td,{children:"\u6210\u719F"}),(0,l.jsx)(e.td,{children:"\u9010\u6B65\u6210\u719F"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65B0\u96C6\u7FA4\u5EFA\u8BAE\u4F7F\u7528KRaft\u6A21\u5F0F"}),"\n",(0,l.jsx)(e.li,{children:"\u73B0\u6709\u96C6\u7FA4\u53EF\u89C4\u5212\u8FC1\u79FB\uFF08Kafka 3.3+\u652F\u6301\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u73AF\u5883\u9700\u5145\u5206\u6D4B\u8BD5"}),"\n",(0,l.jsx)(e.li,{children:"\u5173\u6CE8\u793E\u533A\u7A33\u5B9A\u6027\u53CD\u9988"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"17-\u770B\u8FC7\u6E90\u7801\u90A3\u8BF4\u8BF4-kafka-\u5904\u7406\u8BF7\u6C42\u7684\u5168\u6D41\u7A0B",children:"17. \u770B\u8FC7\u6E90\u7801\uFF1F\u90A3\u8BF4\u8BF4 Kafka \u5904\u7406\u8BF7\u6C42\u7684\u5168\u6D41\u7A0B\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u4F7F\u7528Reactor\u6A21\u5F0F\u5904\u7406\u5BA2\u6237\u7AEF\u8BF7\u6C42\uFF0C\u91C7\u7528\u591A\u7EBF\u7A0B\u5F02\u6B65\u5904\u7406\u63D0\u9AD8\u541E\u5410\u91CF\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u6574\u4F53\u67B6\u6784"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u7EC4\u4EF6\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Acceptor\u7EBF\u7A0B"}),"\uFF1A\u63A5\u53D7\u65B0\u8FDE\u63A5"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Processor\u7EBF\u7A0B"}),"\uFF08\u7F51\u7EDC\u7EBF\u7A0B\uFF09\uFF1A\u5904\u7406\u7F51\u7EDCIO"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"RequestChannel"}),"\uFF1A\u8BF7\u6C42\u961F\u5217"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"KafkaRequestHandler\u7EBF\u7A0B"}),"\uFF08IO\u7EBF\u7A0B\uFF09\uFF1A\u5904\u7406\u4E1A\u52A1\u903B\u8F91"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"ResponseQueue"}),"\uFF1A\u54CD\u5E94\u961F\u5217"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u5904\u7406\u6D41\u7A0B"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u5BA2\u6237\u7AEF -> Acceptor -> Processor -> RequestQueue -> Handler -> ResponseQueue -> Processor -> \u5BA2\u6237\u7AEF\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u8BE6\u7EC6\u6B65\u9AA4"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA41\uFF1A\u63A5\u53D7\u8FDE\u63A5\uFF08Acceptor\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"class Acceptor extends Runnable {\n    def run(): Unit = {\n        serverChannel.register(nioSelector, SelectionKey.OP_ACCEPT)\n        while (isRunning) {\n            val ready = nioSelector.select(500)\n            if (ready > 0) {\n                val keys = nioSelector.selectedKeys()\n                keys.forEach { key =>\n                    if (key.isAcceptable) {\n                        accept(key)\n                    }\n                }\n            }\n        }\n    }\n    \n    def accept(key: SelectionKey): Unit = {\n        val socketChannel = serverSocketChannel.accept()\n        socketChannel.configureBlocking(false)\n        // \u8F6E\u8BE2\u5206\u914D\u7ED9Processor\n        val processor = processors(currentProcessor)\n        processor.accept(socketChannel)\n        currentProcessor = (currentProcessor + 1) % processors.length\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA42\uFF1A\u8BFB\u53D6\u8BF7\u6C42\uFF08Processor\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"class Processor extends Runnable {\n    def run(): Unit = {\n        while (isRunning) {\n            // \u5904\u7406\u65B0\u8FDE\u63A5\n            configureNewConnections()\n            \n            // \u5904\u7406\u54CD\u5E94\n            processNewResponses()\n            \n            // \u5904\u7406\u7F51\u7EDCIO\n            poll()\n            \n            // \u5904\u7406\u5B8C\u6210\u7684\u63A5\u6536\n            processCompletedReceives()\n            \n            // \u5904\u7406\u5B8C\u6210\u7684\u53D1\u9001\n            processCompletedSends()\n        }\n    }\n    \n    def processCompletedReceives(): Unit = {\n        selector.completedReceives().forEach { receive =>\n            val channel = receive.source()\n            val request = parseRequest(receive.payload())\n            // \u653E\u5165\u8BF7\u6C42\u961F\u5217\n            requestChannel.sendRequest(request)\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA43\uFF1A\u8BF7\u6C42\u5165\u961F\uFF08RequestChannel\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"class RequestChannel(numProcessors: Int) {\n    // \u8BF7\u6C42\u961F\u5217\n    private val requestQueue = new ArrayBlockingQueue[RequestChannel.Request](queueSize)\n    \n    // \u54CD\u5E94\u961F\u5217\uFF08\u6BCF\u4E2AProcessor\u4E00\u4E2A\uFF09\n    private val responseQueues = Array.fill(numProcessors)(\n        new LinkedBlockingQueue[RequestChannel.Response]()\n    )\n    \n    def sendRequest(request: Request): Unit = {\n        requestQueue.put(request)\n    }\n    \n    def receiveRequest(timeout: Long): Request = {\n        requestQueue.poll(timeout, TimeUnit.MILLISECONDS)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA44\uFF1A\u4E1A\u52A1\u5904\u7406\uFF08KafkaRequestHandler\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"class KafkaRequestHandler extends Runnable {\n    def run(): Unit = {\n        while (!stopped) {\n            // \u4ECE\u8BF7\u6C42\u961F\u5217\u83B7\u53D6\u8BF7\u6C42\n            val req = requestChannel.receiveRequest(300)\n            \n            if (req != null) {\n                req.requestId match {\n                    case ApiKeys.PRODUCE => handleProduceRequest(req)\n                    case ApiKeys.FETCH => handleFetchRequest(req)\n                    case ApiKeys.METADATA => handleMetadataRequest(req)\n                    case ApiKeys.OFFSET_COMMIT => handleOffsetCommitRequest(req)\n                    // ...\n                }\n            }\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA45\uFF1AProduce\u8BF7\u6C42\u5904\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def handleProduceRequest(request: RequestChannel.Request): Unit = {\n    val produceRequest = request.body[ProduceRequest]\n    \n    // 1. \u9A8C\u8BC1\u6743\u9650\n    authorize(request.session, Write, Resource(Topic, topicPartition.topic))\n    \n    // 2. \u8FFD\u52A0\u6D88\u606F\u5230\u65E5\u5FD7\n    val results = replicaManager.appendRecords(\n        timeout = produceRequest.timeout,\n        requiredAcks = produceRequest.acks,\n        internalTopicsAllowed = internalTopicsAllowed,\n        origin = AppendOrigin.Client,\n        entriesPerPartition = produceRequest.partitionRecordsOrFail\n    )\n    \n    // 3. \u7B49\u5F85\u526F\u672C\u540C\u6B65\uFF08\u5982\u679Cacks=-1\uFF09\n    if (produceRequest.acks == -1) {\n        results.foreach { case (tp, result) =>\n            result.onComplete { response =>\n                sendResponse(request, response)\n            }\n        }\n    } else {\n        // \u7ACB\u5373\u54CD\u5E94\n        sendResponse(request, results)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA46\uFF1AFetch\u8BF7\u6C42\u5904\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def handleFetchRequest(request: RequestChannel.Request): Unit = {\n    val fetchRequest = request.body[FetchRequest]\n    \n    // 1. \u8BFB\u53D6\u6D88\u606F\n    val fetchInfo = replicaManager.fetchMessages(\n        timeout = fetchRequest.maxWait,\n        replicaId = fetchRequest.replicaId,\n        fetchMinBytes = fetchRequest.minBytes,\n        fetchMaxBytes = fetchRequest.maxBytes,\n        fetchInfos = fetchRequest.fetchData\n    )\n    \n    // 2. \u5982\u679C\u6570\u636E\u4E0D\u8DB3\u4E14\u672A\u8D85\u65F6\uFF0C\u5EF6\u8FDF\u54CD\u5E94\n    if (fetchInfo.bytesRead < fetchRequest.minBytes && \n        !fetchInfo.isTimedOut) {\n        // \u52A0\u5165\u5EF6\u8FDF\u961F\u5217\n        delayedFetchPurgatory.tryCompleteElseWatch(\n            delayedFetch, Seq(topicPartition)\n        )\n    } else {\n        // \u7ACB\u5373\u54CD\u5E94\n        sendResponse(request, fetchInfo)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA47\uFF1A\u53D1\u9001\u54CD\u5E94\uFF08Processor\uFF09"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"def processNewResponses(): Unit = {\n    var currentResponse: RequestChannel.Response = null\n    while ({currentResponse = dequeueResponse(); currentResponse != null}) {\n        val channelId = currentResponse.request.context.connectionId\n        \n        currentResponse match {\n            case response: SendResponse =>\n                sendResponse(response)\n            case response: NoOpResponse =>\n                // \u4E0D\u9700\u8981\u54CD\u5E94\n            case response: CloseConnectionResponse =>\n                close(channelId)\n        }\n    }\n}\n\ndef sendResponse(response: SendResponse): Unit = {\n    val responseSend = response.responseSend\n    selector.send(responseSend)\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u5EF6\u8FDF\u64CD\u4F5C\uFF08DelayedOperation\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5EF6\u8FDFProduce\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"class DelayedProduce extends DelayedOperation {\n    override def tryComplete(): Boolean = {\n        // \u68C0\u67E5\u662F\u5426\u6240\u6709ISR\u526F\u672C\u90FD\u5DF2\u540C\u6B65\n        val allReplicasCaughtUp = partition.inSyncReplicas.forall { replica =>\n            replica.logEndOffset >= requiredOffset\n        }\n        \n        if (allReplicasCaughtUp) {\n            forceComplete()\n            true\n        } else {\n            false\n        }\n    }\n    \n    override def onComplete(): Unit = {\n        // \u53D1\u9001\u54CD\u5E94\u7ED9\u5BA2\u6237\u7AEF\n        responseCallback(response)\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u96F6\u62F7\u8D1D\u6280\u672F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"// \u4F7F\u7528FileChannel.transferTo\u5B9E\u73B0\u96F6\u62F7\u8D1D\ndef sendFile(channel: FileChannel, \n             position: Long, \n             count: Long): Long = {\n    channel.transferTo(position, count, socketChannel)\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u7EBF\u7A0B\u6A21\u578B\u914D\u7F6E"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# Acceptor\u7EBF\u7A0B\u6570\uFF08\u901A\u5E38\u4E3A1\uFF09\nnum.network.threads=3\n\n# Processor\u7EBF\u7A0B\u6570\uFF08\u7F51\u7EDC\u7EBF\u7A0B\uFF09\nnum.io.threads=8\n\n# \u8BF7\u6C42\u961F\u5217\u5927\u5C0F\nqueued.max.requests=500\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u6027\u80FD\u4F18\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6279\u91CF\u5904\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6279\u91CF\u8BFB\u53D6\u8BF7\u6C42"}),"\n",(0,l.jsx)(e.li,{children:"\u6279\u91CF\u5199\u5165\u65E5\u5FD7"}),"\n",(0,l.jsx)(e.li,{children:"\u6279\u91CF\u53D1\u9001\u54CD\u5E94"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5F02\u6B65\u5904\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7F51\u7EDCIO\u5F02\u6B65\u5316"}),"\n",(0,l.jsx)(e.li,{children:"\u78C1\u76D8IO\u5F02\u6B65\u5316"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u56DE\u8C03\u673A\u5236"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u96F6\u62F7\u8D1D\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"sendfile\u7CFB\u7EDF\u8C03\u7528"}),"\n",(0,l.jsx)(e.li,{children:"mmap\u5185\u5B58\u6620\u5C04"}),"\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u6570\u636E\u62F7\u8D1D"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u914D\u7F6E\u7EBF\u7A0B\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u8BF7\u6C42\u961F\u5217\u5927\u5C0F"}),"\n",(0,l.jsx)(e.li,{children:"\u4F18\u5316\u7F51\u7EDC\u53C2\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u6279\u91CF\u64CD\u4F5C"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"18-rabbitmq-\u4E2D\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\u4F1A\u53BB\u5230\u54EA\u91CC",children:"18. RabbitMQ \u4E2D\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\u4F1A\u53BB\u5230\u54EA\u91CC\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u4E2D\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\u5904\u7406\u65B9\u5F0F\u53D6\u51B3\u4E8E\u53D1\u5E03\u6D88\u606F\u65F6\u7684\u914D\u7F6E\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u9ED8\u8BA4\u884C\u4E3A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u76F4\u63A5\u4E22\u5F03\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\u4F1A\u88AB\u76F4\u63A5\u4E22\u5F03"}),"\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u4E0D\u4F1A\u6536\u5230\u4EFB\u4F55\u901A\u77E5"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u4E22\u5931\u4E14\u65E0\u6CD5\u8FFD\u8E2A"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. mandatory\u53C2\u6570"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8BBE\u7F6Emandatory=true\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u53D1\u9001\u6D88\u606F\u65F6\u8BBE\u7F6Emandatory\u53C2\u6570\nchannel.basicPublish(\n    exchange,\n    routingKey,\n    true,  // mandatory=true\n    MessageProperties.PERSISTENT_TEXT_PLAIN,\n    message.getBytes()\n);\n\n// \u6DFB\u52A0ReturnListener\u76D1\u542C\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\nchannel.addReturnListener(new ReturnListener() {\n    @Override\n    public void handleReturn(int replyCode,\n                            String replyText,\n                            String exchange,\n                            String routingKey,\n                            AMQP.BasicProperties properties,\n                            byte[] body) {\n        System.out.println("\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F: " + new String(body));\n        System.out.println("\u539F\u56E0: " + replyText);\n        // \u5904\u7406\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F\n        handleUnroutableMessage(body);\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u65E0\u6CD5\u8DEF\u7531\u65F6\uFF0C\u4F1A\u8FD4\u56DE\u7ED9\u751F\u4EA7\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u89E6\u53D1ReturnListener\u56DE\u8C03"}),"\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u53EF\u4EE5\u8BB0\u5F55\u65E5\u5FD7\u6216\u91CD\u65B0\u53D1\u9001"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u5907\u4EFD\u4EA4\u6362\u673A\uFF08Alternate Exchange\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u5907\u4EFD\u4EA4\u6362\u673A\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660E\u4E3B\u4EA4\u6362\u673A\u65F6\u6307\u5B9A\u5907\u4EFD\u4EA4\u6362\u673A\nMap<String, Object> args = new HashMap<>();\nargs.put("alternate-exchange", "backup-exchange");\n\nchannel.exchangeDeclare(\n    "main-exchange",\n    "direct",\n    true,\n    false,\n    args\n);\n\n// \u58F0\u660E\u5907\u4EFD\u4EA4\u6362\u673A\uFF08\u901A\u5E38\u4F7F\u7528fanout\u7C7B\u578B\uFF09\nchannel.exchangeDeclare("backup-exchange", "fanout", true);\n\n// \u58F0\u660E\u5907\u4EFD\u961F\u5217\nchannel.queueDeclare("backup-queue", true, false, false, null);\n\n// \u7ED1\u5B9A\u5907\u4EFD\u961F\u5217\u5230\u5907\u4EFD\u4EA4\u6362\u673A\nchannel.queueBind("backup-queue", "backup-exchange", "");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u65E0\u6CD5\u5728\u4E3B\u4EA4\u6362\u673A\u8DEF\u7531\u65F6"}),"\n",(0,l.jsx)(e.li,{children:"\u81EA\u52A8\u8F6C\u53D1\u5230\u5907\u4EFD\u4EA4\u6362\u673A"}),"\n",(0,l.jsx)(e.li,{children:"\u5907\u4EFD\u4EA4\u6362\u673A\u901A\u5E38\u4F7F\u7528fanout\u7C7B\u578B\uFF0C\u5C06\u6D88\u606F\u53D1\u9001\u5230\u6240\u6709\u7ED1\u5B9A\u7684\u961F\u5217"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u5904\u7406\u7B56\u7565\u5BF9\u6BD4"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7B56\u7565"}),(0,l.jsx)(e.th,{children:"\u4F18\u70B9"}),(0,l.jsx)(e.th,{children:"\u7F3A\u70B9"}),(0,l.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u9ED8\u8BA4\u4E22\u5F03"}),(0,l.jsx)(e.td,{children:"\u7B80\u5355"}),(0,l.jsx)(e.td,{children:"\u6D88\u606F\u4E22\u5931"}),(0,l.jsx)(e.td,{children:"\u53EF\u5BB9\u5FCD\u6D88\u606F\u4E22\u5931"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"mandatory"}),(0,l.jsx)(e.td,{children:"\u751F\u4EA7\u8005\u53EF\u611F\u77E5"}),(0,l.jsx)(e.td,{children:"\u9700\u8981\u5904\u7406\u56DE\u8C03"}),(0,l.jsx)(e.td,{children:"\u9700\u8981\u77E5\u9053\u8DEF\u7531\u5931\u8D25"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5907\u4EFD\u4EA4\u6362\u673A"}),(0,l.jsx)(e.td,{children:"\u81EA\u52A8\u5904\u7406\uFF0C\u4E0D\u4E22\u5931"}),(0,l.jsx)(e.td,{children:"\u914D\u7F6E\u590D\u6742"}),(0,l.jsx)(e.td,{children:"\u4E0D\u80FD\u4E22\u5931\u6D88\u606F"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u6700\u4F73\u5B9E\u8DF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65B9\u68481\uFF1Amandatory + \u65E5\u5FD7\u8BB0\u5F55"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'channel.addReturnListener((replyCode, replyText, exchange, \n                          routingKey, properties, body) -> {\n    // \u8BB0\u5F55\u5230\u65E5\u5FD7\u6216\u6570\u636E\u5E93\n    logger.error("\u6D88\u606F\u8DEF\u7531\u5931\u8D25: exchange={}, routingKey={}, message={}", \n                 exchange, routingKey, new String(body));\n    \n    // \u53D1\u9001\u544A\u8B66\n    alertService.sendAlert("\u6D88\u606F\u8DEF\u7531\u5931\u8D25");\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65B9\u68482\uFF1A\u5907\u4EFD\u4EA4\u6362\u673A + \u76D1\u63A7\u961F\u5217"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5B9A\u671F\u68C0\u67E5\u5907\u4EFD\u961F\u5217\n@Scheduled(fixedDelay = 60000)\npublic void checkBackupQueue() {\n    long messageCount = getQueueMessageCount("backup-queue");\n    if (messageCount > 0) {\n        logger.warn("\u5907\u4EFD\u961F\u5217\u6709{}\u6761\u6D88\u606F", messageCount);\n        // \u5904\u7406\u5907\u4EFD\u961F\u5217\u4E2D\u7684\u6D88\u606F\n        processBackupMessages();\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u63A8\u8350\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u91CD\u8981\u6D88\u606F\uFF1A\u4F7F\u7528\u5907\u4EFD\u4EA4\u6362\u673A"}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u822C\u6D88\u606F\uFF1A\u4F7F\u7528mandatory\u53C2\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u5F00\u53D1\u73AF\u5883\uFF1A\u4F7F\u7528mandatory\u4FBF\u4E8E\u8C03\u8BD5"}),"\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u73AF\u5883\uFF1A\u6839\u636E\u4E1A\u52A1\u91CD\u8981\u6027\u9009\u62E9"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"19-rabbitmq-\u4E2D\u6D88\u606F\u4EC0\u4E48\u65F6\u5019\u4F1A\u8FDB\u5165\u6B7B\u4FE1\u4EA4\u6362\u673A",children:"19. RabbitMQ \u4E2D\u6D88\u606F\u4EC0\u4E48\u65F6\u5019\u4F1A\u8FDB\u5165\u6B7B\u4FE1\u4EA4\u6362\u673A\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"\u6B7B\u4FE1\uFF08Dead Letter\uFF09\u662F\u6307\u65E0\u6CD5\u88AB\u6B63\u5E38\u6D88\u8D39\u7684\u6D88\u606F\uFF0CRabbitMQ\u63D0\u4F9B\u4E86\u6B7B\u4FE1\u4EA4\u6362\u673A\uFF08DLX\uFF09\u6765\u5904\u7406\u8FD9\u4E9B\u6D88\u606F\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u4EA7\u751F\u6B7B\u4FE1\u7684\u4E09\u79CD\u60C5\u51B5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u60C5\u51B51\uFF1A\u6D88\u606F\u88AB\u62D2\u7EDD\uFF08reject/nack\uFF09\u4E14requeue=false"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6D88\u8D39\u8005\u62D2\u7EDD\u6D88\u606F\u4E14\u4E0D\u91CD\u65B0\u5165\u961F\nchannel.basicReject(deliveryTag, false);  // requeue=false\n\n// \u6216\u4F7F\u7528basicNack\nchannel.basicNack(deliveryTag, false, false);  // requeue=false\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u60C5\u51B52\uFF1A\u6D88\u606FTTL\u8FC7\u671F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u8BBE\u7F6E\u6D88\u606FTTL\nAMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()\n    .expiration("10000")  // 10\u79D2\u540E\u8FC7\u671F\n    .build();\n\nchannel.basicPublish(exchange, routingKey, properties, message);\n\n// \u6216\u8BBE\u7F6E\u961F\u5217TTL\nMap<String, Object> args = new HashMap<>();\nargs.put("x-message-ttl", 10000);  // \u961F\u5217\u4E2D\u6240\u6709\u6D88\u606F10\u79D2\u540E\u8FC7\u671F\nchannel.queueDeclare("my-queue", true, false, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u60C5\u51B53\uFF1A\u961F\u5217\u8FBE\u5230\u6700\u5927\u957F\u5EA6"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u8BBE\u7F6E\u961F\u5217\u6700\u5927\u957F\u5EA6\nMap<String, Object> args = new HashMap<>();\nargs.put("x-max-length", 1000);  // \u6700\u591A1000\u6761\u6D88\u606F\nchannel.queueDeclare("my-queue", true, false, false, args);\n\n// \u6216\u8BBE\u7F6E\u961F\u5217\u6700\u5927\u5B57\u8282\u6570\nargs.put("x-max-length-bytes", 1048576);  // \u6700\u591A1MB\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u914D\u7F6E\u6B7B\u4FE1\u4EA4\u6362\u673A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// 1. \u58F0\u660E\u6B7B\u4FE1\u4EA4\u6362\u673A\nchannel.exchangeDeclare("dlx-exchange", "direct", true);\n\n// 2. \u58F0\u660E\u6B7B\u4FE1\u961F\u5217\nchannel.queueDeclare("dlx-queue", true, false, false, null);\n\n// 3. \u7ED1\u5B9A\u6B7B\u4FE1\u961F\u5217\u5230\u6B7B\u4FE1\u4EA4\u6362\u673A\nchannel.queueBind("dlx-queue", "dlx-exchange", "dlx-routing-key");\n\n// 4. \u58F0\u660E\u4E1A\u52A1\u961F\u5217\uFF0C\u6307\u5B9A\u6B7B\u4FE1\u4EA4\u6362\u673A\nMap<String, Object> args = new HashMap<>();\nargs.put("x-dead-letter-exchange", "dlx-exchange");  // \u6B7B\u4FE1\u4EA4\u6362\u673A\nargs.put("x-dead-letter-routing-key", "dlx-routing-key");  // \u6B7B\u4FE1\u8DEF\u7531\u952E\uFF08\u53EF\u9009\uFF09\nargs.put("x-message-ttl", 10000);  // \u6D88\u606FTTL\nargs.put("x-max-length", 1000);  // \u961F\u5217\u6700\u5927\u957F\u5EA6\n\nchannel.queueDeclare("business-queue", true, false, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u6B7B\u4FE1\u6D88\u606F\u7684\u5C5E\u6027\u53D8\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B7B\u4FE1\u6D88\u606F\u4F1A\u643A\u5E26\u989D\u5916\u4FE1\u606F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u6D88\u8D39\u6B7B\u4FE1\u961F\u5217\nchannel.basicConsume("dlx-queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        // \u83B7\u53D6\u6B7B\u4FE1\u539F\u56E0\n        Map<String, Object> headers = properties.getHeaders();\n        \n        // x-death\u5305\u542B\u6B7B\u4FE1\u8BE6\u7EC6\u4FE1\u606F\n        List<Map<String, Object>> xDeath = \n            (List<Map<String, Object>>) headers.get("x-death");\n        \n        if (xDeath != null && !xDeath.isEmpty()) {\n            Map<String, Object> death = xDeath.get(0);\n            String reason = (String) death.get("reason");  // \u6B7B\u4FE1\u539F\u56E0\n            String queue = (String) death.get("queue");    // \u539F\u961F\u5217\n            String exchange = (String) death.get("exchange");  // \u539F\u4EA4\u6362\u673A\n            Long count = (Long) death.get("count");  // \u6B7B\u4FE1\u6B21\u6570\n            \n            System.out.println("\u6B7B\u4FE1\u539F\u56E0: " + reason);\n            System.out.println("\u539F\u961F\u5217: " + queue);\n        }\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B7B\u4FE1\u539F\u56E0\uFF08reason\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"rejected"}),"\uFF1A\u6D88\u606F\u88AB\u62D2\u7EDD"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"expired"}),"\uFF1A\u6D88\u606F\u8FC7\u671F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"maxlen"}),"\uFF1A\u961F\u5217\u8FBE\u5230\u6700\u5927\u957F\u5EA6"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u6B7B\u4FE1\u961F\u5217\u7684\u5E94\u7528\u573A\u666F"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u573A\u666F1\uFF1A\u6D88\u606F\u91CD\u8BD5"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u4E1A\u52A1\u961F\u5217\u6D88\u8D39\u5931\u8D25\u540E\u8FDB\u5165\u6B7B\u4FE1\u961F\u5217\n// \u6B7B\u4FE1\u961F\u5217\u6D88\u8D39\u8005\u8FDB\u884C\u91CD\u8BD5\nchannel.basicConsume("dlx-queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        try {\n            // \u91CD\u8BD5\u5904\u7406\n            retryProcess(body);\n            channel.basicAck(envelope.getDeliveryTag(), false);\n        } catch (Exception e) {\n            // \u91CD\u8BD5\u5931\u8D25\uFF0C\u8BB0\u5F55\u65E5\u5FD7\n            logger.error("\u91CD\u8BD5\u5931\u8D25", e);\n            channel.basicNack(envelope.getDeliveryTag(), false, false);\n        }\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u573A\u666F2\uFF1A\u5EF6\u8FDF\u961F\u5217"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5229\u7528TTL + \u6B7B\u4FE1\u5B9E\u73B0\u5EF6\u8FDF\u961F\u5217\n// 1. \u58F0\u660E\u5EF6\u8FDF\u961F\u5217\uFF08\u65E0\u6D88\u8D39\u8005\uFF0C\u6D88\u606F\u8FC7\u671F\u540E\u8FDB\u5165\u6B7B\u4FE1\uFF09\nMap<String, Object> delayArgs = new HashMap<>();\ndelayArgs.put("x-dead-letter-exchange", "business-exchange");\ndelayArgs.put("x-dead-letter-routing-key", "business-key");\ndelayArgs.put("x-message-ttl", 30000);  // 30\u79D2\u5EF6\u8FDF\n\nchannel.queueDeclare("delay-queue", true, false, false, delayArgs);\n\n// 2. \u53D1\u9001\u6D88\u606F\u5230\u5EF6\u8FDF\u961F\u5217\nchannel.basicPublish("", "delay-queue", null, message);\n\n// 3. 30\u79D2\u540E\u6D88\u606F\u81EA\u52A8\u8FDB\u5165\u4E1A\u52A1\u961F\u5217\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u573A\u666F3\uFF1A\u5F02\u5E38\u6D88\u606F\u5904\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u6B7B\u4FE1\u961F\u5217\u4E13\u95E8\u5904\u7406\u5F02\u5E38\u6D88\u606F\nchannel.basicConsume("dlx-queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        // \u8BB0\u5F55\u5F02\u5E38\u6D88\u606F\n        saveToDatabase(body, properties);\n        \n        // \u53D1\u9001\u544A\u8B66\n        alertService.sendAlert("\u53D1\u73B0\u5F02\u5E38\u6D88\u606F");\n        \n        channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u6700\u4F73\u5B9E\u8DF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u5EFA\u8BAE\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6240\u6709\u4E1A\u52A1\u961F\u5217\u90FD\u914D\u7F6E\u6B7B\u4FE1\u4EA4\u6362\u673A"}),"\n",(0,l.jsx)(e.li,{children:"\u6B7B\u4FE1\u961F\u5217\u8BBE\u7F6E\u5408\u7406\u7684TTL\u548C\u6700\u5927\u957F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u6B7B\u4FE1\u961F\u5217\u7684\u6D88\u606F\u6570\u91CF"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9A\u671F\u6E05\u7406\u6B7B\u4FE1\u961F\u5217"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6CE8\u610F\u4E8B\u9879\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6B7B\u4FE1\u6D88\u606F\u4E5F\u53EF\u80FD\u518D\u6B21\u6210\u4E3A\u6B7B\u4FE1\uFF08\u907F\u514D\u5FAA\u73AF\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u6B7B\u4FE1\u4EA4\u6362\u673A\u53EF\u4EE5\u662F\u4EFB\u610F\u7C7B\u578B"}),"\n",(0,l.jsx)(e.li,{children:"\u6B7B\u4FE1routing key\u53EF\u4EE5\u91CD\u65B0\u6307\u5B9A"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"20-\u8BF4\u4E00\u4E0B-amqp-\u534F\u8BAE",children:"20. \u8BF4\u4E00\u4E0B AMQP \u534F\u8BAE\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"AMQP\uFF08Advanced Message Queuing Protocol\uFF0C\u9AD8\u7EA7\u6D88\u606F\u961F\u5217\u534F\u8BAE\uFF09\u662F\u4E00\u4E2A\u5E94\u7528\u5C42\u534F\u8BAE\uFF0C\u4E3A\u9762\u5411\u6D88\u606F\u7684\u4E2D\u95F4\u4EF6\u8BBE\u8BA1\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. AMQP\u534F\u8BAE\u6982\u8FF0"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9A\u4E49\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5F00\u653E\u6807\u51C6\u7684\u5E94\u7528\u5C42\u534F\u8BAE"}),"\n",(0,l.jsx)(e.li,{children:"\u7528\u4E8E\u6D88\u606F\u4E2D\u95F4\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0E\u5E73\u53F0\u548C\u8BED\u8A00\u65E0\u5173"}),"\n",(0,l.jsx)(e.li,{children:"\u63D0\u4F9B\u7EDF\u4E00\u7684\u6D88\u606F\u670D\u52A1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7248\u672C\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"AMQP 0-9-1"}),"\uFF1ARabbitMQ\u4E3B\u8981\u4F7F\u7528\u7684\u7248\u672C"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"AMQP 1.0"}),"\uFF1AOASIS\u6807\u51C6\uFF0C\u4E0E0-9-1\u4E0D\u517C\u5BB9"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. AMQP\u6838\u5FC3\u6982\u5FF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u7EC4\u4EF6\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Broker"}),"\uFF1A\u6D88\u606F\u4EE3\u7406\u670D\u52A1\u5668"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Virtual Host"}),"\uFF1A\u865A\u62DF\u4E3B\u673A\uFF0C\u9694\u79BB\u73AF\u5883"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Exchange"}),"\uFF1A\u4EA4\u6362\u673A\uFF0C\u63A5\u6536\u5E76\u8DEF\u7531\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Queue"}),"\uFF1A\u961F\u5217\uFF0C\u5B58\u50A8\u6D88\u606F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Binding"}),"\uFF1A\u7ED1\u5B9A\uFF0C\u8FDE\u63A5Exchange\u548CQueue"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Routing Key"}),"\uFF1A\u8DEF\u7531\u952E\uFF0C\u6D88\u606F\u8DEF\u7531\u89C4\u5219"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Message"}),"\uFF1A\u6D88\u606F\uFF0C\u5305\u542B\u6D88\u606F\u4F53\u548C\u5C5E\u6027"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. AMQP\u5DE5\u4F5C\u6A21\u578B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u6D41\u8F6C\u8FC7\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Producer -> Exchange -> Binding -> Queue -> Consumer\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8BE6\u7EC6\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u53D1\u9001\u6D88\u606F\u5230Exchange"}),"\n",(0,l.jsx)(e.li,{children:"Exchange\u6839\u636ERouting Key\u548CBinding\u89C4\u5219\u8DEF\u7531\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u88AB\u8DEF\u7531\u5230\u4E00\u4E2A\u6216\u591A\u4E2AQueue"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u4ECEQueue\u83B7\u53D6\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u8005\u5904\u7406\u5B8C\u6210\u540E\u53D1\u9001ACK"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. Exchange\u7C7B\u578B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Direct Exchange\uFF08\u76F4\u8FDE\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u7CBE\u786E\u5339\u914Drouting key\nchannel.exchangeDeclare("direct-exchange", "direct");\nchannel.queueBind("queue1", "direct-exchange", "key1");\n\n// \u53D1\u9001\u6D88\u606F\nchannel.basicPublish("direct-exchange", "key1", null, message);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Fanout Exchange\uFF08\u6247\u51FA\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5E7F\u64AD\u5230\u6240\u6709\u7ED1\u5B9A\u7684\u961F\u5217\uFF0C\u5FFD\u7565routing key\nchannel.exchangeDeclare("fanout-exchange", "fanout");\nchannel.queueBind("queue1", "fanout-exchange", "");\nchannel.queueBind("queue2", "fanout-exchange", "");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Topic Exchange\uFF08\u4E3B\u9898\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u652F\u6301\u901A\u914D\u7B26\u5339\u914D\n// * \u5339\u914D\u4E00\u4E2A\u5355\u8BCD\n// # \u5339\u914D\u96F6\u4E2A\u6216\u591A\u4E2A\u5355\u8BCD\nchannel.exchangeDeclare("topic-exchange", "topic");\nchannel.queueBind("queue1", "topic-exchange", "user.*.create");\nchannel.queueBind("queue2", "topic-exchange", "user.#");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Headers Exchange\uFF08\u5934\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u6839\u636E\u6D88\u606F\u5934\u5C5E\u6027\u8DEF\u7531\nMap<String, Object> headers = new HashMap<>();\nheaders.put("x-match", "all");  // all\u6216any\nheaders.put("format", "pdf");\nheaders.put("type", "report");\n\nchannel.queueBind("queue1", "headers-exchange", "", headers);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. AMQP\u6D88\u606F\u5C5E\u6027"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u57FA\u672C\u5C5E\u6027\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()\n    .contentType("application/json")     // \u5185\u5BB9\u7C7B\u578B\n    .contentEncoding("UTF-8")            // \u7F16\u7801\n    .deliveryMode(2)                     // \u6301\u4E45\u5316\uFF081=\u975E\u6301\u4E45\u5316\uFF0C2=\u6301\u4E45\u5316\uFF09\n    .priority(5)                         // \u4F18\u5148\u7EA7\uFF080-9\uFF09\n    .correlationId("correlation-id")     // \u5173\u8054ID\n    .replyTo("reply-queue")              // \u56DE\u590D\u961F\u5217\n    .expiration("10000")                 // \u8FC7\u671F\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\n    .messageId("message-id")             // \u6D88\u606FID\n    .timestamp(new Date())               // \u65F6\u95F4\u6233\n    .type("order")                       // \u6D88\u606F\u7C7B\u578B\n    .userId("user")                      // \u7528\u6237ID\n    .appId("app")                        // \u5E94\u7528ID\n    .headers(customHeaders)              // \u81EA\u5B9A\u4E49\u5934\n    .build();\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. AMQP\u8FDE\u63A5\u6A21\u578B"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5C42\u6B21\u7ED3\u6784\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Connection\uFF08TCP\u8FDE\u63A5\uFF09\n  \u2514\u2500\u2500 Channel\uFF08\u865A\u62DF\u8FDE\u63A5\uFF09\n       \u251C\u2500\u2500 Exchange\n       \u251C\u2500\u2500 Queue\n       \u2514\u2500\u2500 Binding\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8FDE\u63A5\u7BA1\u7406\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u521B\u5EFA\u8FDE\u63A5\nConnectionFactory factory = new ConnectionFactory();\nfactory.setHost("localhost");\nfactory.setPort(5672);\nfactory.setVirtualHost("/");\nfactory.setUsername("guest");\nfactory.setPassword("guest");\n\nConnection connection = factory.newConnection();\n\n// \u521B\u5EFAChannel\nChannel channel = connection.createChannel();\n\n// \u4F7F\u7528\u5B8C\u6BD5\u540E\u5173\u95ED\nchannel.close();\nconnection.close();\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. AMQP\u786E\u8BA4\u673A\u5236"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u786E\u8BA4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5F00\u542F\u53D1\u9001\u786E\u8BA4\nchannel.confirmSelect();\n\n// \u540C\u6B65\u786E\u8BA4\nchannel.basicPublish(exchange, routingKey, null, message);\nchannel.waitForConfirms();\n\n// \u5F02\u6B65\u786E\u8BA4\nchannel.addConfirmListener(new ConfirmListener() {\n    public void handleAck(long deliveryTag, boolean multiple) {\n        // \u6D88\u606F\u786E\u8BA4\n    }\n    public void handleNack(long deliveryTag, boolean multiple) {\n        // \u6D88\u606F\u672A\u786E\u8BA4\n    }\n});\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u786E\u8BA4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u624B\u52A8\u786E\u8BA4\nchannel.basicConsume(queueName, false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        try {\n            processMessage(body);\n            // \u786E\u8BA4\u6D88\u606F\n            channel.basicAck(envelope.getDeliveryTag(), false);\n        } catch (Exception e) {\n            // \u62D2\u7EDD\u6D88\u606F\n            channel.basicNack(envelope.getDeliveryTag(), false, true);\n        }\n    }\n});\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. AMQP\u4E8B\u52A1"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u5F00\u542F\u4E8B\u52A1\nchannel.txSelect();\n\ntry {\n    // \u53D1\u9001\u6D88\u606F\n    channel.basicPublish(exchange, routingKey, null, message1);\n    channel.basicPublish(exchange, routingKey, null, message2);\n    \n    // \u63D0\u4EA4\u4E8B\u52A1\n    channel.txCommit();\n} catch (Exception e) {\n    // \u56DE\u6EDA\u4E8B\u52A1\n    channel.txRollback();\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"9. AMQP\u534F\u8BAE\u7279\u6027"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u53EF\u9760\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u6301\u4E45\u5316"}),"\n",(0,l.jsx)(e.li,{children:"\u53D1\u9001\u786E\u8BA4"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u786E\u8BA4"}),"\n",(0,l.jsx)(e.li,{children:"\u4E8B\u52A1\u652F\u6301"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7075\u6D3B\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u591A\u79CDExchange\u7C7B\u578B"}),"\n",(0,l.jsx)(e.li,{children:"\u7075\u6D3B\u7684\u8DEF\u7531\u89C4\u5219"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u4F18\u5148\u7EA7\u961F\u5217"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B89\u5168\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7528\u6237\u8BA4\u8BC1"}),"\n",(0,l.jsx)(e.li,{children:"\u865A\u62DF\u4E3B\u673A\u9694\u79BB"}),"\n",(0,l.jsx)(e.li,{children:"\u6743\u9650\u63A7\u5236"}),"\n",(0,l.jsx)(e.li,{children:"SSL/TLS\u652F\u6301"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"10. AMQP vs \u5176\u4ED6\u534F\u8BAE"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"AMQP"}),(0,l.jsx)(e.th,{children:"MQTT"}),(0,l.jsx)(e.th,{children:"STOMP"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8BBE\u8BA1\u76EE\u6807"}),(0,l.jsx)(e.td,{children:"\u4F01\u4E1A\u6D88\u606F"}),(0,l.jsx)(e.td,{children:"IoT"}),(0,l.jsx)(e.td,{children:"\u7B80\u5355\u6587\u672C"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4F4E"}),(0,l.jsx)(e.td,{children:"\u4F4E"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u529F\u80FD"}),(0,l.jsx)(e.td,{children:"\u4E30\u5BCC"}),(0,l.jsx)(e.td,{children:"\u57FA\u7840"}),(0,l.jsx)(e.td,{children:"\u57FA\u7840"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6027\u80FD"}),(0,l.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4E2D\u7B49"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u53EF\u9760\u6027"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,l.jsx)(e.td,{children:"\u4E2D\u7B49"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7406\u89E3AMQP\u6A21\u578B\u548C\u6982\u5FF5"}),"\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u4F7F\u7528Exchange\u7C7B\u578B"}),"\n",(0,l.jsx)(e.li,{children:"\u6B63\u786E\u914D\u7F6E\u6D88\u606F\u5C5E\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u786E\u8BA4\u673A\u5236\u4FDD\u8BC1\u53EF\u9760\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u8FC7\u5EA6\u4F7F\u7528\u4E8B\u52A1\uFF08\u6027\u80FD\u5F00\u9500\u5927\uFF09"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"21-\u8BF4\u4E00\u4E0B-rabbitmq-\u7684\u4E8B\u52A1\u673A\u5236",children:"21. \u8BF4\u4E00\u4E0B RabbitMQ \u7684\u4E8B\u52A1\u673A\u5236\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u63D0\u4F9B\u4E86\u4E8B\u52A1\u673A\u5236\u6765\u4FDD\u8BC1\u6D88\u606F\u7684\u53EF\u9760\u6027\uFF0C\u4F46\u7531\u4E8E\u6027\u80FD\u5F00\u9500\u8F83\u5927\uFF0C\u751F\u4EA7\u73AF\u5883\u66F4\u63A8\u8350\u4F7F\u7528\u53D1\u9001\u8005\u786E\u8BA4\u6A21\u5F0F\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u4E8B\u52A1\u57FA\u672C\u7528\u6CD5"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'Channel channel = connection.createChannel();\n\ntry {\n    // \u5F00\u542F\u4E8B\u52A1\n    channel.txSelect();\n    \n    // \u53D1\u9001\u6D88\u606F\n    channel.basicPublish(exchange, routingKey, null, message1.getBytes());\n    channel.basicPublish(exchange, routingKey, null, message2.getBytes());\n    \n    // \u6A21\u62DF\u4E1A\u52A1\u903B\u8F91\n    doBusinessLogic();\n    \n    // \u63D0\u4EA4\u4E8B\u52A1\n    channel.txCommit();\n    \n} catch (Exception e) {\n    // \u56DE\u6EDA\u4E8B\u52A1\n    channel.txRollback();\n    logger.error("\u4E8B\u52A1\u56DE\u6EDA", e);\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u4E8B\u52A1\u7684\u5DE5\u4F5C\u539F\u7406"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4E8B\u52A1\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"txSelect()"}),"\uFF1A\u5C06Channel\u8BBE\u7F6E\u4E3A\u4E8B\u52A1\u6A21\u5F0F"]}),"\n",(0,l.jsx)(e.li,{children:"\u53D1\u9001\u6D88\u606F\uFF1A\u6D88\u606F\u6682\u5B58\u5728\u5185\u5B58\u4E2D"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"txCommit()"}),"\uFF1A\u63D0\u4EA4\u4E8B\u52A1\uFF0C\u6D88\u606F\u6301\u4E45\u5316\u5230\u78C1\u76D8"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"txRollback()"}),"\uFF1A\u56DE\u6EDA\u4E8B\u52A1\uFF0C\u4E22\u5F03\u6240\u6709\u672A\u63D0\u4EA4\u7684\u6D88\u606F"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u4E8B\u52A1\u7684\u7279\u70B9"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4FDD\u8BC1\u6D88\u606F\u7684\u539F\u5B50\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u8981\u4E48\u5168\u90E8\u6210\u529F\uFF0C\u8981\u4E48\u5168\u90E8\u5931\u8D25"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9E\u73B0\u7B80\u5355"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6027\u80FD\u5F00\u9500\u5927\uFF08\u541E\u5410\u91CF\u964D\u4F4E\u7EA6250\u500D\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u963B\u585E\u5F0F\u64CD\u4F5C\uFF0C\u5F71\u54CD\u5E76\u53D1"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u9002\u5408\u9AD8\u5E76\u53D1\u573A\u666F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u53D1\u9001\u8005\u786E\u8BA4\u6A21\u5F0F\uFF08\u63A8\u8350\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u666E\u901A\u786E\u8BA4\u6A21\u5F0F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5F00\u542F\u786E\u8BA4\u6A21\u5F0F\nchannel.confirmSelect();\n\n// \u53D1\u9001\u6D88\u606F\nchannel.basicPublish(exchange, routingKey, null, message.getBytes());\n\n// \u540C\u6B65\u7B49\u5F85\u786E\u8BA4\nif (channel.waitForConfirms()) {\n    System.out.println("\u6D88\u606F\u53D1\u9001\u6210\u529F");\n} else {\n    System.out.println("\u6D88\u606F\u53D1\u9001\u5931\u8D25");\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6279\u91CF\u786E\u8BA4\u6A21\u5F0F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"channel.confirmSelect();\n\n// \u53D1\u9001\u591A\u6761\u6D88\u606F\nfor (int i = 0; i < 100; i++) {\n    channel.basicPublish(exchange, routingKey, null, message.getBytes());\n}\n\n// \u6279\u91CF\u7B49\u5F85\u786E\u8BA4\nchannel.waitForConfirmsOrDie();\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5F02\u6B65\u786E\u8BA4\u6A21\u5F0F\uFF08\u6700\u4F73\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"channel.confirmSelect();\n\n// \u6DFB\u52A0\u786E\u8BA4\u76D1\u542C\u5668\nchannel.addConfirmListener(new ConfirmListener() {\n    @Override\n    public void handleAck(long deliveryTag, boolean multiple) {\n        // \u6D88\u606F\u786E\u8BA4\u6210\u529F\n        if (multiple) {\n            // \u6279\u91CF\u786E\u8BA4\n            confirmedMessages.headMap(deliveryTag + 1).clear();\n        } else {\n            // \u5355\u6761\u786E\u8BA4\n            confirmedMessages.remove(deliveryTag);\n        }\n    }\n    \n    @Override\n    public void handleNack(long deliveryTag, boolean multiple) {\n        // \u6D88\u606F\u786E\u8BA4\u5931\u8D25\uFF0C\u9700\u8981\u91CD\u53D1\n        if (multiple) {\n            // \u6279\u91CF\u5931\u8D25\n            resendMessages(deliveryTag);\n        } else {\n            // \u5355\u6761\u5931\u8D25\n            resendMessage(deliveryTag);\n        }\n    }\n});\n\n// \u53D1\u9001\u6D88\u606F\nlong nextPublishSeqNo = channel.getNextPublishSeqNo();\nchannel.basicPublish(exchange, routingKey, null, message.getBytes());\nconfirmedMessages.put(nextPublishSeqNo, message);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u4E8B\u52A1 vs \u53D1\u9001\u8005\u786E\u8BA4"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"\u4E8B\u52A1\u6A21\u5F0F"}),(0,l.jsx)(e.th,{children:"\u53D1\u9001\u8005\u786E\u8BA4\u6A21\u5F0F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6027\u80FD"}),(0,l.jsx)(e.td,{children:"\u4F4E\uFF08\u7EA6250\u500D\u5DEE\u8DDD\uFF09"}),(0,l.jsx)(e.td,{children:"\u9AD8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u541E\u5410\u91CF"}),(0,l.jsx)(e.td,{children:"\u4F4E"}),(0,l.jsx)(e.td,{children:"\u9AD8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5B9E\u73B0\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u7B80\u5355"}),(0,l.jsx)(e.td,{children:"\u4E2D\u7B49"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u963B\u585E\u6027"}),(0,l.jsx)(e.td,{children:"\u963B\u585E"}),(0,l.jsx)(e.td,{children:"\u975E\u963B\u585E\uFF08\u5F02\u6B65\uFF09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,l.jsx)(e.td,{children:"\u4F4E\u5E76\u53D1"}),(0,l.jsx)(e.td,{children:"\u9AD8\u5E76\u53D1"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u6D88\u8D39\u8005\u4E8B\u52A1"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6D88\u8D39\u8005\u4E5F\u53EF\u4EE5\u4F7F\u7528\u4E8B\u52A1\nchannel.txSelect();\n\nQueueingConsumer consumer = new QueueingConsumer(channel);\nchannel.basicConsume(queueName, false, consumer);\n\nwhile (true) {\n    QueueingConsumer.Delivery delivery = consumer.nextDelivery();\n    \n    try {\n        // \u5904\u7406\u6D88\u606F\n        processMessage(delivery.getBody());\n        \n        // \u786E\u8BA4\u6D88\u606F\n        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n        \n        // \u63D0\u4EA4\u4E8B\u52A1\n        channel.txCommit();\n    } catch (Exception e) {\n        // \u56DE\u6EDA\u4E8B\u52A1\n        channel.txRollback();\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u6700\u4F73\u5B9E\u8DF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u63A8\u8350\u65B9\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u751F\u4EA7\u8005\uFF1A\u4F7F\u7528\u5F02\u6B65\u786E\u8BA4\u6A21\u5F0F\npublic class ReliableProducer {\n    private final ConcurrentNavigableMap<Long, String> outstandingConfirms = \n        new ConcurrentSkipListMap<>();\n    \n    public void sendMessage(String message) throws IOException {\n        channel.confirmSelect();\n        \n        channel.addConfirmListener(new ConfirmListener() {\n            public void handleAck(long deliveryTag, boolean multiple) {\n                cleanOutstandingConfirms(deliveryTag, multiple);\n            }\n            \n            public void handleNack(long deliveryTag, boolean multiple) {\n                String msg = outstandingConfirms.get(deliveryTag);\n                logger.error("\u6D88\u606F\u53D1\u9001\u5931\u8D25: {}", msg);\n                // \u91CD\u53D1\u6216\u8BB0\u5F55\n                resendMessage(msg);\n            }\n        });\n        \n        long nextSeqNo = channel.getNextPublishSeqNo();\n        channel.basicPublish(exchange, routingKey, null, message.getBytes());\n        outstandingConfirms.put(nextSeqNo, message);\n    }\n    \n    private void cleanOutstandingConfirms(long sequenceNumber, boolean multiple) {\n        if (multiple) {\n            outstandingConfirms.headMap(sequenceNumber + 1).clear();\n        } else {\n            outstandingConfirms.remove(sequenceNumber);\n        }\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6CE8\u610F\u4E8B\u9879\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u5728\u9AD8\u5E76\u53D1\u573A\u666F\u4F7F\u7528\u4E8B\u52A1"}),"\n",(0,l.jsx)(e.li,{children:"\u4F18\u5148\u4F7F\u7528\u5F02\u6B65\u786E\u8BA4\u6A21\u5F0F"}),"\n",(0,l.jsx)(e.li,{children:"\u4E8B\u52A1\u548C\u786E\u8BA4\u6A21\u5F0F\u4E0D\u80FD\u540C\u65F6\u4F7F\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u786E\u8BA4\u6A21\u5F0F\u4E0B\u9700\u8981\u5904\u7406\u91CD\u53D1\u903B\u8F91"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"22-rabbitmq-\u4E2D\u4E3B\u8981\u6709\u54EA\u51E0\u4E2A\u89D2\u8272\u6216\u8005\u8BF4\u6982\u5FF5",children:"22. RabbitMQ \u4E2D\u4E3B\u8981\u6709\u54EA\u51E0\u4E2A\u89D2\u8272\u6216\u8005\u8BF4\u6982\u5FF5\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u57FA\u4E8EAMQP\u534F\u8BAE\uFF0C\u5305\u542B\u591A\u4E2A\u6838\u5FC3\u6982\u5FF5\u548C\u7EC4\u4EF6\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u6838\u5FC3\u7EC4\u4EF6"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Broker\uFF08\u6D88\u606F\u4EE3\u7406\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RabbitMQ\u670D\u52A1\u5668\u5B9E\u4F8B"}),"\n",(0,l.jsx)(e.li,{children:"\u63A5\u6536\u3001\u5B58\u50A8\u548C\u8F6C\u53D1\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u7BA1\u7406Exchange\u3001Queue\u7B49\u8D44\u6E90"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Virtual Host\uFF08\u865A\u62DF\u4E3B\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u903B\u8F91\u9694\u79BB\u5355\u5143"}),"\n",(0,l.jsx)(e.li,{children:"\u7C7B\u4F3C\u4E8E\u547D\u540D\u7A7A\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u540Cvhost\u4E4B\u95F4\u5B8C\u5168\u9694\u79BB"}),"\n",(0,l.jsx)(e.li,{children:"\u6BCF\u4E2Avhost\u6709\u72EC\u7ACB\u7684Exchange\u3001Queue\u3001\u6743\u9650"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u8FDE\u63A5\u5230\u6307\u5B9Avhost\nfactory.setVirtualHost("/my-vhost");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u6D88\u606F\u8DEF\u7531\u7EC4\u4EF6"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Exchange\uFF08\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u63A5\u6536\u751F\u4EA7\u8005\u53D1\u9001\u7684\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u6839\u636E\u8DEF\u7531\u89C4\u5219\u5C06\u6D88\u606F\u8DEF\u7531\u5230Queue"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u5B58\u50A8\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7C7B\u578B\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Direct"}),"\uFF1A\u7CBE\u786E\u5339\u914Drouting key"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Fanout"}),"\uFF1A\u5E7F\u64AD\u5230\u6240\u6709\u7ED1\u5B9A\u7684\u961F\u5217"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Topic"}),"\uFF1A\u901A\u914D\u7B26\u5339\u914D"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Headers"}),"\uFF1A\u6839\u636E\u6D88\u606F\u5934\u5339\u914D"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660EExchange\nchannel.exchangeDeclare("my-exchange", "direct", true, false, null);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Queue\uFF08\u961F\u5217\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5B58\u50A8\u6D88\u606F\u7684\u5BB9\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u9075\u5FAAFIFO\u539F\u5219"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u6700\u7EC8\u88AB\u6D88\u8D39\u8005\u6D88\u8D39"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660EQueue\nchannel.queueDeclare("my-queue", true, false, false, null);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Binding\uFF08\u7ED1\u5B9A\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8FDE\u63A5Exchange\u548CQueue\u7684\u89C4\u5219"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9A\u4E49\u6D88\u606F\u5982\u4F55\u4ECEExchange\u8DEF\u7531\u5230Queue"}),"\n",(0,l.jsx)(e.li,{children:"\u5305\u542Brouting key\u6216\u5176\u4ED6\u5339\u914D\u6761\u4EF6"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u7ED1\u5B9AQueue\u5230Exchange\nchannel.queueBind("my-queue", "my-exchange", "routing-key");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u6D88\u606F\u7EC4\u4EF6"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Message\uFF08\u6D88\u606F\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u4F53\uFF08Body\uFF09"}),"\uFF1A\u5B9E\u9645\u6570\u636E"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u5C5E\u6027\uFF08Properties\uFF09"}),"\uFF1A\u5143\u6570\u636E"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()\n    .contentType("application/json")\n    .deliveryMode(2)  // \u6301\u4E45\u5316\n    .priority(5)\n    .build();\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Routing Key\uFF08\u8DEF\u7531\u952E\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u751F\u4EA7\u8005\u53D1\u9001\u6D88\u606F\u65F6\u6307\u5B9A"}),"\n",(0,l.jsx)(e.li,{children:"Exchange\u6839\u636Erouting key\u8DEF\u7531\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Binding Key\uFF08\u7ED1\u5B9A\u952E\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7ED1\u5B9AQueue\u5230Exchange\u65F6\u6307\u5B9A"}),"\n",(0,l.jsx)(e.li,{children:"\u7528\u4E8E\u5339\u914Drouting key"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u89D2\u8272\u7EC4\u4EF6"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Producer\uFF08\u751F\u4EA7\u8005\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u53D1\u9001\u6D88\u606F\u7684\u5E94\u7528\u7A0B\u5E8F"}),"\n",(0,l.jsx)(e.li,{children:"\u8FDE\u63A5\u5230Broker"}),"\n",(0,l.jsx)(e.li,{children:"\u53D1\u9001\u6D88\u606F\u5230Exchange"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"channel.basicPublish(exchange, routingKey, properties, message.getBytes());\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Consumer\uFF08\u6D88\u8D39\u8005\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u63A5\u6536\u6D88\u606F\u7684\u5E94\u7528\u7A0B\u5E8F"}),"\n",(0,l.jsx)(e.li,{children:"\u8BA2\u9605Queue"}),"\n",(0,l.jsx)(e.li,{children:"\u5904\u7406\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"channel.basicConsume(queueName, false, consumer);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Connection\uFF08\u8FDE\u63A5\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5E94\u7528\u7A0B\u5E8F\u4E0EBroker\u4E4B\u95F4\u7684TCP\u8FDE\u63A5"}),"\n",(0,l.jsx)(e.li,{children:"\u53EF\u4EE5\u5305\u542B\u591A\u4E2AChannel"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"Connection connection = factory.newConnection();\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Channel\uFF08\u4FE1\u9053\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5EFA\u7ACB\u5728Connection\u4E4B\u4E0A\u7684\u865A\u62DF\u8FDE\u63A5"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u90E8\u5206\u64CD\u4F5C\u5728Channel\u4E0A\u5B8C\u6210"}),"\n",(0,l.jsx)(e.li,{children:"\u8F7B\u91CF\u7EA7\uFF0C\u53EF\u521B\u5EFA\u591A\u4E2A"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"Channel channel = connection.createChannel();\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u9AD8\u7EA7\u6982\u5FF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Dead Letter Exchange\uFF08\u6B7B\u4FE1\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5904\u7406\u65E0\u6CD5\u6B63\u5E38\u6D88\u8D39\u7684\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E\u5728Queue\u4E0A"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Alternate Exchange\uFF08\u5907\u4EFD\u4EA4\u6362\u673A\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5904\u7406\u65E0\u6CD5\u8DEF\u7531\u7684\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E\u5728Exchange\u4E0A"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"TTL\uFF08Time To Live\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u6216\u961F\u5217\u7684\u8FC7\u671F\u65F6\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u8FC7\u671F\u540E\u8FDB\u5165\u6B7B\u4FE1\u961F\u5217\u6216\u88AB\u5220\u9664"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Priority Queue\uFF08\u4F18\u5148\u7EA7\u961F\u5217\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u6D88\u606F\u4F18\u5148\u7EA7"}),"\n",(0,l.jsx)(e.li,{children:"\u9AD8\u4F18\u5148\u7EA7\u6D88\u606F\u5148\u88AB\u6D88\u8D39"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'Map<String, Object> args = new HashMap<>();\nargs.put("x-max-priority", 10);\nchannel.queueDeclare("priority-queue", true, false, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u7BA1\u7406\u7EC4\u4EF6"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"User\uFF08\u7528\u6237\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8BBF\u95EERabbitMQ\u7684\u8D26\u6237"}),"\n",(0,l.jsx)(e.li,{children:"\u6709\u4E0D\u540C\u7684\u6743\u9650\u7EA7\u522B"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Permission\uFF08\u6743\u9650\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E\u6743\u9650\uFF1A\u521B\u5EFA/\u5220\u9664Exchange\u3001Queue"}),"\n",(0,l.jsx)(e.li,{children:"\u5199\u6743\u9650\uFF1A\u53D1\u9001\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u8BFB\u6743\u9650\uFF1A\u6D88\u8D39\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Policy\uFF08\u7B56\u7565\uFF09\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u52A8\u6001\u914D\u7F6EQueue\u548CExchange\u7684\u884C\u4E3A"}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u955C\u50CF\u961F\u5217\u3001TTL\u7B49"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u7EC4\u4EF6\u5173\u7CFB\u56FE"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Producer -> Connection -> Channel -> Exchange -> Binding -> Queue -> Consumer\n                                         |\n                                    Routing Key\n                                         |\n                                    Binding Key\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u5B8C\u6574\u793A\u4F8B"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u521B\u5EFA\u8FDE\u63A5\u548CChannel\nConnectionFactory factory = new ConnectionFactory();\nfactory.setHost("localhost");\nfactory.setVirtualHost("/my-vhost");\nConnection connection = factory.newConnection();\nChannel channel = connection.createChannel();\n\n// \u58F0\u660EExchange\nchannel.exchangeDeclare("my-exchange", "direct", true);\n\n// \u58F0\u660EQueue\nchannel.queueDeclare("my-queue", true, false, false, null);\n\n// \u7ED1\u5B9A\nchannel.queueBind("my-queue", "my-exchange", "my-routing-key");\n\n// \u751F\u4EA7\u8005\u53D1\u9001\u6D88\u606F\nchannel.basicPublish("my-exchange", "my-routing-key", null, "Hello".getBytes());\n\n// \u6D88\u8D39\u8005\u63A5\u6536\u6D88\u606F\nchannel.basicConsume("my-queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        System.out.println("\u6536\u5230\u6D88\u606F: " + new String(body));\n        channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u4F7F\u7528Virtual Host\u8FDB\u884C\u73AF\u5883\u9694\u79BB"}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2AConnection\u5305\u542B\u591A\u4E2AChannel"}),"\n",(0,l.jsx)(e.li,{children:"\u6B63\u786E\u914D\u7F6EExchange\u7C7B\u578B"}),"\n",(0,l.jsx)(e.li,{children:"\u7406\u89E3Binding\u89C4\u5219"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u6301\u4E45\u5316\u4FDD\u8BC1\u6D88\u606F\u53EF\u9760\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"23-rabbitmq-\u7684-routing-key-\u548C-binding-key-\u7684\u6700\u5927\u957F\u5EA6\u662F\u591A\u5C11\u5B57\u8282",children:"23. RabbitMQ \u7684 routing key \u548C binding key \u7684\u6700\u5927\u957F\u5EA6\u662F\u591A\u5C11\u5B57\u8282\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u5BF9routing key\u548Cbinding key\u7684\u957F\u5EA6\u6709\u660E\u786E\u9650\u5236\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u957F\u5EA6\u9650\u5236"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u5927\u957F\u5EA6\uFF1A255\u5B57\u8282\uFF08255 bytes\uFF09"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Routing Key"}),"\uFF1A\u6700\u5927255\u5B57\u8282"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Binding Key"}),"\uFF1A\u6700\u5927255\u5B57\u8282"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u9650\u5236\u539F\u56E0"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u534F\u8BAE\u5C42\u9762\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"AMQP 0-9-1\u534F\u8BAE\u89C4\u5B9Ashort string\u7C7B\u578B\u6700\u5927255\u5B57\u8282"}),"\n",(0,l.jsx)(e.li,{children:"routing key\u548Cbinding key\u90FD\u662Fshort string\u7C7B\u578B"}),"\n",(0,l.jsx)(e.li,{children:"\u8FD9\u662F\u534F\u8BAE\u7EA7\u522B\u7684\u786C\u6027\u9650\u5236"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u8003\u8651\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8F83\u77ED\u7684key\u63D0\u9AD8\u8DEF\u7531\u6548\u7387"}),"\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u5185\u5B58\u5360\u8017"}),"\n",(0,l.jsx)(e.li,{children:"\u52A0\u5FEB\u5339\u914D\u901F\u5EA6"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u5B9E\u9645\u6D4B\u8BD5"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u6D4B\u8BD5routing key\u957F\u5EA6\u9650\u5236\npublic void testRoutingKeyLength() {\n    Channel channel = connection.createChannel();\n    \n    // 255\u5B57\u8282\u7684routing key - \u6B63\u5E38\n    String routingKey255 = StringUtils.repeat("a", 255);\n    channel.basicPublish("exchange", routingKey255, null, "test".getBytes());\n    \n    // 256\u5B57\u8282\u7684routing key - \u4F1A\u629B\u51FA\u5F02\u5E38\n    try {\n        String routingKey256 = StringUtils.repeat("a", 256);\n        channel.basicPublish("exchange", routingKey256, null, "test".getBytes());\n    } catch (IOException e) {\n        // com.rabbitmq.client.ShutdownSignalException: \n        // channel error; protocol method: #method<channel.close>(reply-code=406, ...)\n        System.out.println("\u8D85\u8FC7\u957F\u5EA6\u9650\u5236");\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u5B57\u7B26\u7F16\u7801\u5F71\u54CD"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"UTF-8\u7F16\u7801\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u82F1\u6587\u5B57\u7B26\uFF1A1\u5B57\u8282"}),"\n",(0,l.jsx)(e.li,{children:"\u4E2D\u6587\u5B57\u7B26\uFF1A\u901A\u5E383\u5B57\u8282"}),"\n",(0,l.jsx)(e.li,{children:"\u7279\u6B8A\u5B57\u7B26\uFF1A1-4\u5B57\u8282"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u4E2D\u6587routing key\u793A\u4F8B\nString chineseKey = "\u8BA2\u5355.\u521B\u5EFA.\u6210\u529F"; // \u7EA618\u5B57\u8282\uFF086\u4E2A\u4E2D\u6587\u5B57\u7B26\uFF09\nString maxChineseKey = StringUtils.repeat("\u4E2D", 85); // \u7EA6255\u5B57\u8282\uFF0885\u4E2A\u4E2D\u6587\u5B57\u7B26\uFF09\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. Topic Exchange\u7684\u901A\u914D\u7B26"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u901A\u914D\u7B26\u4E0D\u5360\u7528\u989D\u5916\u957F\u5EA6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u4EE5\u4E0B\u90FD\u662F\u6709\u6548\u7684binding key\n"user.*.create"        // \u7EA614\u5B57\u8282\n"order.#"              // \u7EA67\u5B57\u8282\n"*.*.*.*.*.*.*.*.#"    // \u7EA617\u5B57\u8282\n\n// \u4F46\u603B\u957F\u5EA6\u4ECD\u4E0D\u80FD\u8D85\u8FC7255\u5B57\u8282\nString longPattern = "a.b.c.d.e..." // \u6700\u591A255\u5B57\u8282\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u6700\u4F73\u5B9E\u8DF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u547D\u540D\u5EFA\u8BAE\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u63A8\u8350\uFF1A\u7B80\u6D01\u660E\u4E86\u7684routing key\n"order.created"\n"user.updated"\n"payment.success"\n\n// \u907F\u514D\uFF1A\u8FC7\u957F\u7684routing key\n"com.example.service.order.domain.event.OrderCreatedEvent.v1.production"\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5C42\u6B21\u7ED3\u6784\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u4F7F\u7528\u70B9\u53F7\u5206\u9694\u7684\u5C42\u6B21\u7ED3\u6784\n"\u4E1A\u52A1\u57DF.\u5B9E\u4F53.\u64CD\u4F5C.\u72B6\u6001"\n\n// \u793A\u4F8B\n"order.payment.process.success"  // \u8BA2\u5355.\u652F\u4ED8.\u5904\u7406.\u6210\u529F\n"user.profile.update.complete"   // \u7528\u6237.\u8D44\u6599.\u66F4\u65B0.\u5B8C\u6210\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u8D85\u957Fkey\u7684\u5904\u7406\u65B9\u6848"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65B9\u68481\uFF1A\u4F7F\u7528\u54C8\u5E0C\u503C"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5C06\u957Fkey\u8F6C\u6362\u4E3A\u54C8\u5E0C\u503C\nString longKey = "very.long.routing.key.that.exceeds.limit...";\nString shortKey = DigestUtils.md5Hex(longKey).substring(0, 32);\nchannel.basicPublish("exchange", shortKey, null, message);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65B9\u68482\uFF1A\u4F7F\u7528\u6D88\u606F\u5934"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5C06\u8BE6\u7EC6\u4FE1\u606F\u653E\u5728\u6D88\u606F\u5934\u4E2D\nMap<String, Object> headers = new HashMap<>();\nheaders.put("full-routing-info", longRoutingInfo);\n\nAMQP.BasicProperties props = new AMQP.BasicProperties.Builder()\n    .headers(headers)\n    .build();\n\nchannel.basicPublish("exchange", "short-key", props, message);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65B9\u68483\uFF1A\u91CD\u65B0\u8BBE\u8BA1\u8DEF\u7531\u89C4\u5219"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u7B80\u5316routing key\u8BBE\u8BA1\n// \u539F\u6765\uFF1Acom.company.department.team.service.module.action.status\n// \u7B80\u5316\uFF1Aservice.action.status\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u76F8\u5173\u9650\u5236"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5176\u4ED6\u957F\u5EA6\u9650\u5236\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Queue\u540D\u79F0"}),"\uFF1A\u6700\u5927255\u5B57\u8282"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Exchange\u540D\u79F0"}),"\uFF1A\u6700\u5927255\u5B57\u8282"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Virtual Host\u540D\u79F0"}),"\uFF1A\u6700\u5927255\u5B57\u8282"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6D88\u606F\u5934\u952E\u540D"}),"\uFF1A\u6700\u5927255\u5B57\u8282"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6CE8\u610F\u4E8B\u9879\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8D85\u8FC7\u9650\u5236\u4F1A\u5BFC\u81F4channel\u5173\u95ED"}),"\n",(0,l.jsx)(e.li,{children:"\u5EFA\u8BAE\u4FDD\u6301key\u7B80\u77ED\uFF0850\u5B57\u8282\u4EE5\u5185\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u82F1\u6587\u548C\u6570\u5B57\uFF0C\u907F\u514D\u7279\u6B8A\u5B57\u7B26"}),"\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8BBE\u8BA1\u547D\u540D\u89C4\u8303"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"24-\u8BF4\u8BF4-rabbitmq-\u7684\u5DE5\u4F5C\u6A21\u5F0F",children:"24. \u8BF4\u8BF4 RabbitMQ \u7684\u5DE5\u4F5C\u6A21\u5F0F\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u652F\u6301\u591A\u79CD\u5DE5\u4F5C\u6A21\u5F0F\uFF08Work Pattern\uFF09\uFF0C\u9002\u7528\u4E8E\u4E0D\u540C\u7684\u4E1A\u52A1\u573A\u666F\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. Simple\u6A21\u5F0F\uFF08\u7B80\u5355\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u751F\u4EA7\u8005\uFF0C\u4E00\u4E2A\u6D88\u8D39\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u7B80\u5355\u7684\u6A21\u5F0F"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u4F7F\u7528Exchange"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u751F\u4EA7\u8005\nchannel.queueDeclare("simple-queue", true, false, false, null);\nchannel.basicPublish("", "simple-queue", null, message.getBytes());\n\n// \u6D88\u8D39\u8005\nchannel.basicConsume("simple-queue", true, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        System.out.println("\u6536\u5230\u6D88\u606F: " + new String(body));\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7B80\u5355\u7684\u70B9\u5BF9\u70B9\u901A\u4FE1"}),"\n",(0,l.jsx)(e.li,{children:"\u6D4B\u8BD5\u548C\u5B66\u4E60"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. Work Queue\u6A21\u5F0F\uFF08\u5DE5\u4F5C\u961F\u5217\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u751F\u4EA7\u8005\uFF0C\u591A\u4E2A\u6D88\u8D39\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u8F6E\u8BE2\u5206\u53D1\u7ED9\u6D88\u8D39\u8005"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9E\u73B0\u4EFB\u52A1\u5206\u53D1\u548C\u8D1F\u8F7D\u5747\u8861"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u751F\u4EA7\u8005\nfor (int i = 0; i < 100; i++) {\n    String message = "Task " + i;\n    channel.basicPublish("", "work-queue", null, message.getBytes());\n}\n\n// \u6D88\u8D39\u80051\u548C\u6D88\u8D39\u80052\nchannel.basicQos(1); // \u516C\u5E73\u5206\u53D1\uFF0C\u6BCF\u6B21\u53EA\u5904\u7406\u4E00\u6761\u6D88\u606F\nchannel.basicConsume("work-queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        try {\n            System.out.println("\u5904\u7406\u4EFB\u52A1: " + new String(body));\n            Thread.sleep(1000); // \u6A21\u62DF\u8017\u65F6\u64CD\u4F5C\n            channel.basicAck(envelope.getDeliveryTag(), false);\n        } catch (Exception e) {\n            channel.basicNack(envelope.getDeliveryTag(), false, true);\n        }\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4EFB\u52A1\u5206\u53D1"}),"\n",(0,l.jsx)(e.li,{children:"\u8D1F\u8F7D\u5747\u8861"}),"\n",(0,l.jsx)(e.li,{children:"\u5F02\u6B65\u5904\u7406"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. Publish/Subscribe\u6A21\u5F0F\uFF08\u53D1\u5E03\u8BA2\u9605\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528Fanout Exchange"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u5E7F\u64AD\u5230\u6240\u6709\u7ED1\u5B9A\u7684\u961F\u5217"}),"\n",(0,l.jsx)(e.li,{children:"\u4E00\u4E2A\u6D88\u606F\u88AB\u591A\u4E2A\u6D88\u8D39\u8005\u63A5\u6536"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660EFanout Exchange\nchannel.exchangeDeclare("logs", "fanout");\n\n// \u751F\u4EA7\u8005\nchannel.basicPublish("logs", "", null, message.getBytes());\n\n// \u6D88\u8D39\u80051\uFF1A\u4FDD\u5B58\u5230\u6570\u636E\u5E93\nString queue1 = channel.queueDeclare().getQueue();\nchannel.queueBind(queue1, "logs", "");\nchannel.basicConsume(queue1, true, (consumerTag, delivery) -> {\n    saveToDatabase(new String(delivery.getBody()));\n});\n\n// \u6D88\u8D39\u80052\uFF1A\u5199\u5165\u65E5\u5FD7\u6587\u4EF6\nString queue2 = channel.queueDeclare().getQueue();\nchannel.queueBind(queue2, "logs", "");\nchannel.basicConsume(queue2, true, (consumerTag, delivery) -> {\n    writeToFile(new String(delivery.getBody()));\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65E5\u5FD7\u6536\u96C6"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u5E7F\u64AD"}),"\n",(0,l.jsx)(e.li,{children:"\u4E8B\u4EF6\u901A\u77E5"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. Routing\u6A21\u5F0F\uFF08\u8DEF\u7531\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528Direct Exchange"}),"\n",(0,l.jsx)(e.li,{children:"\u6839\u636Erouting key\u7CBE\u786E\u5339\u914D"}),"\n",(0,l.jsx)(e.li,{children:"\u9009\u62E9\u6027\u63A5\u6536\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660EDirect Exchange\nchannel.exchangeDeclare("direct-logs", "direct");\n\n// \u751F\u4EA7\u8005\uFF1A\u53D1\u9001\u4E0D\u540C\u7EA7\u522B\u7684\u65E5\u5FD7\nchannel.basicPublish("direct-logs", "error", null, "\u9519\u8BEF\u65E5\u5FD7".getBytes());\nchannel.basicPublish("direct-logs", "info", null, "\u4FE1\u606F\u65E5\u5FD7".getBytes());\nchannel.basicPublish("direct-logs", "warning", null, "\u8B66\u544A\u65E5\u5FD7".getBytes());\n\n// \u6D88\u8D39\u80051\uFF1A\u53EA\u63A5\u6536error\u65E5\u5FD7\nString errorQueue = channel.queueDeclare().getQueue();\nchannel.queueBind(errorQueue, "direct-logs", "error");\nchannel.basicConsume(errorQueue, true, (consumerTag, delivery) -> {\n    System.out.println("Error: " + new String(delivery.getBody()));\n});\n\n// \u6D88\u8D39\u80052\uFF1A\u63A5\u6536error\u548Cwarning\u65E5\u5FD7\nString alertQueue = channel.queueDeclare().getQueue();\nchannel.queueBind(alertQueue, "direct-logs", "error");\nchannel.queueBind(alertQueue, "direct-logs", "warning");\nchannel.basicConsume(alertQueue, true, (consumerTag, delivery) -> {\n    sendAlert(new String(delivery.getBody()));\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65E5\u5FD7\u5206\u7EA7\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u5206\u7C7B"}),"\n",(0,l.jsx)(e.li,{children:"\u9009\u62E9\u6027\u8BA2\u9605"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. Topics\u6A21\u5F0F\uFF08\u4E3B\u9898\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528Topic Exchange"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u901A\u914D\u7B26\u5339\u914D"}),"\n",(0,l.jsx)(e.li,{children:"\u66F4\u7075\u6D3B\u7684\u8DEF\u7531\u89C4\u5219"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660ETopic Exchange\nchannel.exchangeDeclare("topic-logs", "topic");\n\n// \u751F\u4EA7\u8005\uFF1A\u53D1\u9001\u4E0D\u540C\u4E3B\u9898\u7684\u6D88\u606F\nchannel.basicPublish("topic-logs", "user.order.created", null, msg1);\nchannel.basicPublish("topic-logs", "user.profile.updated", null, msg2);\nchannel.basicPublish("topic-logs", "system.error.database", null, msg3);\n\n// \u6D88\u8D39\u80051\uFF1A\u63A5\u6536\u6240\u6709user\u76F8\u5173\u6D88\u606F\nString userQueue = channel.queueDeclare().getQueue();\nchannel.queueBind(userQueue, "topic-logs", "user.#");\n\n// \u6D88\u8D39\u80052\uFF1A\u63A5\u6536\u6240\u6709error\u6D88\u606F\nString errorQueue = channel.queueDeclare().getQueue();\nchannel.queueBind(errorQueue, "topic-logs", "*.error.*");\n\n// \u6D88\u8D39\u80053\uFF1A\u63A5\u6536\u6240\u6709created\u6D88\u606F\nString createdQueue = channel.queueDeclare().getQueue();\nchannel.queueBind(createdQueue, "topic-logs", "*.*.created");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u901A\u914D\u7B26\u89C4\u5219\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"*"}),"\uFF1A\u5339\u914D\u4E00\u4E2A\u5355\u8BCD"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"#"}),"\uFF1A\u5339\u914D\u96F6\u4E2A\u6216\u591A\u4E2A\u5355\u8BCD"]}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u590D\u6742\u7684\u6D88\u606F\u8DEF\u7531"}),"\n",(0,l.jsx)(e.li,{children:"\u591A\u7EF4\u5EA6\u6D88\u606F\u5206\u7C7B"}),"\n",(0,l.jsx)(e.li,{children:"\u7075\u6D3B\u7684\u8BA2\u9605\u89C4\u5219"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. RPC\u6A21\u5F0F\uFF08\u8FDC\u7A0B\u8FC7\u7A0B\u8C03\u7528\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5BA2\u6237\u7AEF\u53D1\u9001\u8BF7\u6C42\uFF0C\u7B49\u5F85\u54CD\u5E94"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528reply_to\u548Ccorrelation_id"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9E\u73B0\u540C\u6B65\u8C03\u7528"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// RPC\u5BA2\u6237\u7AEF\npublic String call(String message) throws Exception {\n    // \u521B\u5EFA\u56DE\u8C03\u961F\u5217\n    String replyQueueName = channel.queueDeclare().getQueue();\n    String corrId = UUID.randomUUID().toString();\n    \n    // \u8BBE\u7F6E\u5C5E\u6027\n    AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()\n        .correlationId(corrId)\n        .replyTo(replyQueueName)\n        .build();\n    \n    // \u53D1\u9001\u8BF7\u6C42\n    channel.basicPublish("", "rpc_queue", props, message.getBytes());\n    \n    // \u7B49\u5F85\u54CD\u5E94\n    BlockingQueue<String> response = new ArrayBlockingQueue<>(1);\n    \n    channel.basicConsume(replyQueueName, true, (consumerTag, delivery) -> {\n        if (delivery.getProperties().getCorrelationId().equals(corrId)) {\n            response.offer(new String(delivery.getBody()));\n        }\n    });\n    \n    return response.take();\n}\n\n// RPC\u670D\u52A1\u7AEF\nchannel.basicConsume("rpc_queue", false, (consumerTag, delivery) -> {\n    String message = new String(delivery.getBody());\n    \n    // \u5904\u7406\u8BF7\u6C42\n    String result = processRequest(message);\n    \n    // \u53D1\u9001\u54CD\u5E94\n    AMQP.BasicProperties replyProps = new AMQP.BasicProperties.Builder()\n        .correlationId(delivery.getProperties().getCorrelationId())\n        .build();\n    \n    channel.basicPublish("", delivery.getProperties().getReplyTo(), \n                        replyProps, result.getBytes());\n    \n    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8FDC\u7A0B\u65B9\u6CD5\u8C03\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u540C\u6B65\u8BF7\u6C42\u54CD\u5E94"}),"\n",(0,l.jsx)(e.li,{children:"\u5FAE\u670D\u52A1\u95F4\u901A\u4FE1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u6A21\u5F0F\u5BF9\u6BD4"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u6A21\u5F0F"}),(0,l.jsx)(e.th,{children:"Exchange\u7C7B\u578B"}),(0,l.jsx)(e.th,{children:"\u7279\u70B9"}),(0,l.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Simple"}),(0,l.jsx)(e.td,{children:"\u9ED8\u8BA4"}),(0,l.jsx)(e.td,{children:"\u70B9\u5BF9\u70B9"}),(0,l.jsx)(e.td,{children:"\u7B80\u5355\u901A\u4FE1"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Work Queue"}),(0,l.jsx)(e.td,{children:"\u9ED8\u8BA4"}),(0,l.jsx)(e.td,{children:"\u591A\u6D88\u8D39\u8005\u8D1F\u8F7D\u5747\u8861"}),(0,l.jsx)(e.td,{children:"\u4EFB\u52A1\u5206\u53D1"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Pub/Sub"}),(0,l.jsx)(e.td,{children:"Fanout"}),(0,l.jsx)(e.td,{children:"\u5E7F\u64AD"}),(0,l.jsx)(e.td,{children:"\u6D88\u606F\u5E7F\u64AD"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Routing"}),(0,l.jsx)(e.td,{children:"Direct"}),(0,l.jsx)(e.td,{children:"\u7CBE\u786E\u5339\u914D"}),(0,l.jsx)(e.td,{children:"\u6D88\u606F\u5206\u7C7B"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"Topics"}),(0,l.jsx)(e.td,{children:"Topic"}),(0,l.jsx)(e.td,{children:"\u901A\u914D\u7B26\u5339\u914D"}),(0,l.jsx)(e.td,{children:"\u590D\u6742\u8DEF\u7531"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"RPC"}),(0,l.jsx)(e.td,{children:"\u9ED8\u8BA4"}),(0,l.jsx)(e.td,{children:"\u8BF7\u6C42\u54CD\u5E94"}),(0,l.jsx)(e.td,{children:"\u540C\u6B65\u8C03\u7528"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6839\u636E\u4E1A\u52A1\u573A\u666F\u9009\u62E9\u5408\u9002\u7684\u6A21\u5F0F"}),"\n",(0,l.jsx)(e.li,{children:"Work Queue\u6A21\u5F0F\u4F7F\u7528basicQos\u5B9E\u73B0\u516C\u5E73\u5206\u53D1"}),"\n",(0,l.jsx)(e.li,{children:"Pub/Sub\u6A21\u5F0F\u4F7F\u7528\u4E34\u65F6\u961F\u5217"}),"\n",(0,l.jsx)(e.li,{children:"Topics\u6A21\u5F0F\u5408\u7406\u8BBE\u8BA1routing key\u5C42\u6B21"}),"\n",(0,l.jsx)(e.li,{children:"RPC\u6A21\u5F0F\u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"25-\u8BF4\u8BF4-rabbitmq-\u7684\u96C6\u7FA4\u6A21\u5F0F",children:"25. \u8BF4\u8BF4 RabbitMQ \u7684\u96C6\u7FA4\u6A21\u5F0F\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u63D0\u4F9B\u4E86\u591A\u79CD\u96C6\u7FA4\u6A21\u5F0F\u6765\u5B9E\u73B0\u9AD8\u53EF\u7528\u548C\u8D1F\u8F7D\u5747\u8861\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u666E\u901A\u96C6\u7FA4\u6A21\u5F0F\uFF08\u9ED8\u8BA4\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5143\u6570\u636E\u5728\u6240\u6709\u8282\u70B9\u540C\u6B65\uFF08Exchange\u3001Queue\u5B9A\u4E49\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u53EA\u5B58\u50A8\u5728\u58F0\u660E\u961F\u5217\u7684\u8282\u70B9\u4E0A"}),"\n",(0,l.jsx)(e.li,{children:"\u5176\u4ED6\u8282\u70B9\u53EA\u5B58\u50A8\u961F\u5217\u7684\u5143\u6570\u636E\u6307\u9488"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u8D39\u65F6\u9700\u8981\u4ECE\u5B58\u50A8\u8282\u70B9\u62C9\u53D6\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u67B6\u6784\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Node1: Queue A (\u6570\u636E) + Queue B (\u5143\u6570\u636E)\nNode2: Queue B (\u6570\u636E) + Queue A (\u5143\u6570\u636E)\nNode3: Queue A (\u5143\u6570\u636E) + Queue B (\u5143\u6570\u636E)\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# Node1\nrabbitmq-server -detached\n\n# Node2\u52A0\u5165\u96C6\u7FA4\nrabbitmqctl stop_app\nrabbitmqctl join_cluster rabbit@node1\nrabbitmqctl start_app\n\n# Node3\u52A0\u5165\u96C6\u7FA4\nrabbitmqctl stop_app\nrabbitmqctl join_cluster rabbit@node1\nrabbitmqctl start_app\n\n# \u67E5\u770B\u96C6\u7FA4\u72B6\u6001\nrabbitmqctl cluster_status\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E\u7B80\u5355"}),"\n",(0,l.jsx)(e.li,{children:"\u8282\u7701\u5B58\u50A8\u7A7A\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u63D0\u9AD8\u541E\u5410\u91CF"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u961F\u5217\u6240\u5728\u8282\u70B9\u5B95\u673A\uFF0C\u6D88\u606F\u4E22\u5931"}),"\n",(0,l.jsx)(e.li,{children:"\u8DE8\u8282\u70B9\u6D88\u8D39\u6027\u80FD\u4E0B\u964D"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u662F\u771F\u6B63\u7684\u9AD8\u53EF\u7528"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u955C\u50CF\u961F\u5217\u6A21\u5F0F\uFF08\u9AD8\u53EF\u7528\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u961F\u5217\u5728\u591A\u4E2A\u8282\u70B9\u4E0A\u6709\u526F\u672C"}),"\n",(0,l.jsx)(e.li,{children:"\u4E3B\u961F\u5217\uFF08Master\uFF09\u548C\u955C\u50CF\u961F\u5217\uFF08Mirror\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u5728\u6240\u6709\u955C\u50CF\u8282\u70B9\u540C\u6B65"}),"\n",(0,l.jsx)(e.li,{children:"Master\u5B95\u673A\uFF0C\u81EA\u52A8\u9009\u4E3E\u65B0Master"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u65B9\u5F0F1\uFF1A\u901A\u8FC7Policy\u914D\u7F6E"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u8BBE\u7F6E\u6240\u6709\u961F\u5217\u955C\u50CF\u5230\u6240\u6709\u8282\u70B9\nrabbitmqctl set_policy ha-all "^" \'{"ha-mode":"all"}\'\n\n# \u8BBE\u7F6E\u955C\u50CF\u52302\u4E2A\u8282\u70B9\nrabbitmqctl set_policy ha-two "^" \'{"ha-mode":"exactly","ha-params":2}\'\n\n# \u8BBE\u7F6E\u955C\u50CF\u5230\u6307\u5B9A\u8282\u70B9\nrabbitmqctl set_policy ha-nodes "^" \\\n  \'{"ha-mode":"nodes","ha-params":["rabbit@node1","rabbit@node2"]}\'\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u65B9\u5F0F2\uFF1A\u901A\u8FC7\u7BA1\u7406\u754C\u9762"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"Admin -> Policies -> Add Policy\n- Name: ha-all\n- Pattern: ^\n- Apply to: Queues\n- Definition: ha-mode = all\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u65B9\u5F0F3\uFF1A\u901A\u8FC7\u4EE3\u7801"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'Map<String, Object> args = new HashMap<>();\nargs.put("x-ha-policy", "all");\nchannel.queueDeclare("ha-queue", true, false, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u540C\u6B65\u6A21\u5F0F\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u81EA\u52A8\u540C\u6B65\uFF08\u63A8\u8350\uFF09\nrabbitmqctl set_policy ha-all "^" \\\n  \'{"ha-mode":"all","ha-sync-mode":"automatic"}\'\n\n# \u624B\u52A8\u540C\u6B65\nrabbitmqctl sync_queue queue_name\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1. \u6D88\u606F\u53D1\u9001\u5230Master\u961F\u5217\n2. Master\u540C\u6B65\u6D88\u606F\u5230\u6240\u6709Mirror\n3. \u6240\u6709Mirror\u786E\u8BA4\u540E\uFF0CMaster\u8FD4\u56DE\u786E\u8BA4\n4. Master\u5B95\u673A\uFF0C\u9009\u4E3E\u65B0Master\n5. \u65B0Master\u7EE7\u7EED\u63D0\u4F9B\u670D\u52A1\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u771F\u6B63\u7684\u9AD8\u53EF\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u4E0D\u4E22\u5931"}),"\n",(0,l.jsx)(e.li,{children:"\u81EA\u52A8\u6545\u969C\u8F6C\u79FB"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6027\u80FD\u5F00\u9500\u5927"}),"\n",(0,l.jsx)(e.li,{children:"\u7F51\u7EDC\u5E26\u5BBD\u6D88\u8017\u9AD8"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u9002\u5408\u5927\u91CF\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u4EF2\u88C1\u961F\u5217\u6A21\u5F0F\uFF08Quorum Queue\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RabbitMQ 3.8+\u5F15\u5165"}),"\n",(0,l.jsx)(e.li,{children:"\u57FA\u4E8ERaft\u534F\u8BAE"}),"\n",(0,l.jsx)(e.li,{children:"\u66F4\u597D\u7684\u6570\u636E\u5B89\u5168\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u63A8\u8350\u7684\u9AD8\u53EF\u7528\u65B9\u6848"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u58F0\u660E\u4EF2\u88C1\u961F\u5217\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'Map<String, Object> args = new HashMap<>();\nargs.put("x-queue-type", "quorum");\nchannel.queueDeclare("quorum-queue", true, false, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u901A\u8FC7Policy\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'rabbitmqctl set_policy quorum-policy "^quorum\\." \\\n  \'{"queue-type":"quorum","delivery-limit":3}\'\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u6027\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u81EA\u52A8\u590D\u5236\u5230\u591A\u4E2A\u8282\u70B9\uFF08\u9ED8\u8BA43\u4E2A\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528Raft\u534F\u8BAE\u4FDD\u8BC1\u4E00\u81F4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u6D88\u606F\u91CD\u8BD5\u9650\u5236"}),"\n",(0,l.jsx)(e.li,{children:"\u66F4\u597D\u7684\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5BF9\u6BD4\u955C\u50CF\u961F\u5217\uFF1A"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"\u955C\u50CF\u961F\u5217"}),(0,l.jsx)(e.th,{children:"\u4EF2\u88C1\u961F\u5217"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u534F\u8BAE"}),(0,l.jsx)(e.td,{children:"\u81EA\u5B9A\u4E49"}),(0,l.jsx)(e.td,{children:"Raft"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6027\u80FD"}),(0,l.jsx)(e.td,{children:"\u4E00\u822C"}),(0,l.jsx)(e.td,{children:"\u66F4\u597D"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6570\u636E\u5B89\u5168"}),(0,l.jsx)(e.td,{children:"\u597D"}),(0,l.jsx)(e.td,{children:"\u66F4\u597D"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5185\u5B58\u4F7F\u7528"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u8F83\u4F4E"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u63A8\u8350\u5EA6"}),(0,l.jsx)(e.td,{children:"\u4E0D\u63A8\u8350"}),(0,l.jsx)(e.td,{children:"\u63A8\u8350"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. Federation\u63D2\u4EF6\uFF08\u8054\u90A6\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8FDE\u63A5\u4E0D\u540C\u7684RabbitMQ\u96C6\u7FA4"}),"\n",(0,l.jsx)(e.li,{children:"\u8DE8\u6570\u636E\u4E2D\u5FC3\u6D88\u606F\u4F20\u9012"}),"\n",(0,l.jsx)(e.li,{children:"\u677E\u8026\u5408"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'# \u542F\u7528\u63D2\u4EF6\nrabbitmq-plugins enable rabbitmq_federation\nrabbitmq-plugins enable rabbitmq_federation_management\n\n# \u914D\u7F6Eupstream\nrabbitmqctl set_parameter federation-upstream my-upstream \\\n  \'{"uri":"amqp://remote-server","expires":3600000}\'\n\n# \u914D\u7F6Epolicy\nrabbitmqctl set_policy federate-me "^federated\\." \\\n  \'{"federation-upstream-set":"all"}\'\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8DE8\u5730\u57DF\u90E8\u7F72"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u4E2D\u5FC3\u4E92\u8054"}),"\n",(0,l.jsx)(e.li,{children:"\u707E\u5907\u65B9\u6848"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. Shovel\u63D2\u4EF6\uFF08\u94F2\u5B50\u6A21\u5F0F\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5728\u4E0D\u540C\u96C6\u7FA4\u95F4\u8F6C\u53D1\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u66F4\u7075\u6D3B\u7684\u6D88\u606F\u8DEF\u7531"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u6D88\u606F\u8F6C\u6362"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:'rabbitmq-plugins enable rabbitmq_shovel\nrabbitmq-plugins enable rabbitmq_shovel_management\n\nrabbitmqctl set_parameter shovel my-shovel \\\n  \'{"src-uri":"amqp://","src-queue":"source-queue",\n    "dest-uri":"amqp://remote","dest-queue":"dest-queue"}\'\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u8D1F\u8F7D\u5747\u8861\u65B9\u6848"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F7F\u7528HAProxy\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"# haproxy.cfg\nlisten rabbitmq\n    bind *:5672\n    mode tcp\n    balance roundrobin\n    server rabbit1 node1:5672 check inter 5s rise 2 fall 3\n    server rabbit2 node2:5672 check inter 5s rise 2 fall 3\n    server rabbit3 node3:5672 check inter 5s rise 2 fall 3\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F7F\u7528Nginx\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-nginx",children:"stream {\n    upstream rabbitmq {\n        server node1:5672;\n        server node2:5672;\n        server node3:5672;\n    }\n    \n    server {\n        listen 5672;\n        proxy_pass rabbitmq;\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5BA2\u6237\u7AEF\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'ConnectionFactory factory = new ConnectionFactory();\nfactory.setAddresses(new Address[] {\n    new Address("node1", 5672),\n    new Address("node2", 5672),\n    new Address("node3", 5672)\n});\nfactory.setAutomaticRecoveryEnabled(true);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u6700\u4F73\u5B9E\u8DF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u96C6\u7FA4\u89C4\u5212\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u81F3\u5C113\u4E2A\u8282\u70B9\uFF08\u5947\u6570\u4E2A\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u4EF2\u88C1\u961F\u5217\u66FF\u4EE3\u955C\u50CF\u961F\u5217"}),"\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E\u81EA\u52A8\u6062\u590D\u673A\u5236"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u96C6\u7FA4\u72B6\u6001"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5316\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u8BBE\u7F6E\u955C\u50CF\u8282\u70B9\u6570\u91CF"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528SSD\u5B58\u50A8"}),"\n",(0,l.jsx)(e.li,{children:"\u4F18\u5316\u7F51\u7EDC\u914D\u7F6E"}),"\n",(0,l.jsx)(e.li,{children:"\u9650\u5236\u961F\u5217\u957F\u5EA6"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9AD8\u53EF\u7528\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"ConnectionFactory factory = new ConnectionFactory();\nfactory.setAutomaticRecoveryEnabled(true);\nfactory.setNetworkRecoveryInterval(10000);\nfactory.setRequestedHeartbeat(60);\nfactory.setConnectionTimeout(30000);\n"})}),"\n",(0,l.jsx)(e.h3,{id:"26-\u4E3A\u4EC0\u4E48-rocketmq-\u4E0D\u4F7F\u7528-zookeeper-\u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\u5462\u800C\u9009\u62E9\u81EA\u5DF1\u5B9E\u73B0-nameserver",children:"26. \u4E3A\u4EC0\u4E48 RocketMQ \u4E0D\u4F7F\u7528 Zookeeper \u4F5C\u4E3A\u6CE8\u518C\u4E2D\u5FC3\u5462\uFF1F\u800C\u9009\u62E9\u81EA\u5DF1\u5B9E\u73B0 NameServer\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RocketMQ\u9009\u62E9\u81EA\u7814NameServer\u800C\u975EZooKeeper\uFF0C\u4E3B\u8981\u57FA\u4E8E\u4EE5\u4E0B\u8003\u8651\uFF1A"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u67B6\u6784\u7B80\u5355\u6027"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65E0\u72B6\u6001\u8BBE\u8BA1"}),"\n",(0,l.jsx)(e.li,{children:"\u8282\u70B9\u4E4B\u95F4\u4E0D\u901A\u4FE1"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u9700\u8981\u9009\u4E3E"}),"\n",(0,l.jsx)(e.li,{children:"\u90E8\u7F72\u7B80\u5355"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ZooKeeper\u7279\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6709\u72B6\u6001\u8BBE\u8BA1"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981ZAB\u534F\u8BAE\u4FDD\u8BC1\u4E00\u81F4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u9009\u4E3ELeader"}),"\n",(0,l.jsx)(e.li,{children:"\u90E8\u7F72\u590D\u6742"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// NameServer\u542F\u52A8\u975E\u5E38\u7B80\u5355\npublic class NamesrvStartup {\n    public static void main(String[] args) {\n        NamesrvController controller = createNamesrvController(args);\n        start(controller);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u6027\u80FD\u8003\u8651"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\u4F18\u52BF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7EAF\u5185\u5B58\u64CD\u4F5C"}),"\n",(0,l.jsx)(e.li,{children:"\u65E0\u78C1\u76D8IO"}),"\n",(0,l.jsx)(e.li,{children:"\u54CD\u5E94\u901F\u5EA6\u5FEB\uFF08\u6BEB\u79D2\u7EA7\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u9AD8\u5E76\u53D1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ZooKeeper\u9650\u5236\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u6301\u4E45\u5316\u5230\u78C1\u76D8"}),"\n",(0,l.jsx)(e.li,{children:"\u5199\u5165\u6027\u80FD\u6709\u9650\uFF08\u7EA61000-2000 TPS\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u54CD\u5E94\u76F8\u5BF9\u8F83\u6162"}),"\n",(0,l.jsx)(e.li,{children:"\u5927\u91CF\u76D1\u542C\u5668\u5F71\u54CD\u6027\u80FD"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"NameServer: \n- \u8DEF\u7531\u67E5\u8BE2: <1ms\n- \u6CE8\u518C\u66F4\u65B0: <5ms\n- \u65E0\u78C1\u76D8IO\n\nZooKeeper:\n- \u8BFB\u53D6: \u51E0\u6BEB\u79D2\n- \u5199\u5165: 10-50ms\n- \u9700\u8981\u78C1\u76D8IO\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u529F\u80FD\u9700\u6C42\u5339\u914D"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"RocketMQ\u7684\u9700\u6C42\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8DEF\u7531\u4FE1\u606F\u67E5\u8BE2\uFF08\u8BFB\u591A\u5199\u5C11\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u6700\u7EC8\u4E00\u81F4\u6027\u5373\u53EF"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u9700\u8981\u5F3A\u4E00\u81F4\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u5141\u8BB8\u77ED\u6682\u4E0D\u4E00\u81F4"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\u8BBE\u8BA1\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u8DEF\u7531\u4FE1\u606F\u5B9A\u671F\u66F4\u65B0\uFF0C\u5141\u8BB8\u77ED\u6682\u4E0D\u4E00\u81F4\npublic class RouteInfoManager {\n    // Broker\u6BCF30\u79D2\u53D1\u9001\u5FC3\u8DF3\n    private final static long BROKER_CHANNEL_EXPIRED_TIME = 1000 * 60 * 2;\n    \n    // \u8DEF\u7531\u4FE1\u606F\u8868\n    private final HashMap<String, List<QueueData>> topicQueueTable;\n    private final HashMap<String, BrokerData> brokerAddrTable;\n    \n    // \u6CE8\u518CBroker\n    public void registerBroker(String brokerName, String brokerAddr) {\n        // \u76F4\u63A5\u66F4\u65B0\u5185\u5B58\uFF0C\u4E0D\u9700\u8981\u5F3A\u4E00\u81F4\u6027\u4FDD\u8BC1\n        this.brokerAddrTable.put(brokerName, brokerData);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ZooKeeper\u63D0\u4F9B\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5F3A\u4E00\u81F4\u6027\uFF08CP\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5206\u5E03\u5F0F\u9501"}),"\n",(0,l.jsx)(e.li,{children:"\u9009\u4E3E\u529F\u80FD"}),"\n",(0,l.jsx)(e.li,{children:"\u5BF9RocketMQ\u6765\u8BF4\u662F\u8FC7\u5EA6\u8BBE\u8BA1"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u53EF\u7528\u6027\u8BBE\u8BA1"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\u9AD8\u53EF\u7528\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u591A\u4E2ANameServer\u8282\u70B9\u72EC\u7ACB\u8FD0\u884C"}),"\n",(0,l.jsx)(e.li,{children:"\u5BA2\u6237\u7AEF\u8FDE\u63A5\u4EFB\u610F\u53EF\u7528\u8282\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"\u67D0\u4E2A\u8282\u70B9\u5B95\u673A\u4E0D\u5F71\u54CD\u5176\u4ED6\u8282\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"\u65E0\u5355\u70B9\u6545\u969C"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5BA2\u6237\u7AEF\u914D\u7F6E\u591A\u4E2ANameServer\u5730\u5740\nproducer.setNamesrvAddr("192.168.1.1:9876;192.168.1.2:9876;192.168.1.3:9876");\n\n// \u5BA2\u6237\u7AEF\u81EA\u52A8\u5207\u6362\npublic class MQClientInstance {\n    public void updateNameServerAddressList(String addrs) {\n        String[] addrArray = addrs.split(";");\n        // \u968F\u673A\u9009\u62E9\u4E00\u4E2ANameServer\n        Collections.shuffle(Arrays.asList(addrArray));\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ZooKeeper\u9AD8\u53EF\u7528\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u8FC7\u534A\u8282\u70B9\u5B58\u6D3B"}),"\n",(0,l.jsx)(e.li,{children:"Leader\u5B95\u673A\u9700\u8981\u91CD\u65B0\u9009\u4E3E"}),"\n",(0,l.jsx)(e.li,{children:"\u9009\u4E3E\u671F\u95F4\u4E0D\u53EF\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u6709\u5355\u70B9\u98CE\u9669"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u8FD0\u7EF4\u6210\u672C"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\u4F18\u52BF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u90E8\u7F72\u7B80\u5355\uFF0C\u542F\u52A8\u5373\u53EF"}),"\n",(0,l.jsx)(e.li,{children:"\u65E0\u9700\u914D\u7F6E\u96C6\u7FA4\u5173\u7CFB"}),"\n",(0,l.jsx)(e.li,{children:"\u65E0\u9700\u8C03\u4F18\u53C2\u6570"}),"\n",(0,l.jsx)(e.li,{children:"\u6545\u969C\u6062\u590D\u5FEB"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ZooKeeper\u52A3\u52BF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u914D\u7F6E\u96C6\u7FA4"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u8C03\u4F18\uFF08\u5185\u5B58\u3001GC\u7B49\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u76D1\u63A7\u9009\u4E3E\u72B6\u6001"}),"\n",(0,l.jsx)(e.li,{children:"\u8FD0\u7EF4\u590D\u6742"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u4F9D\u8D56\u7BA1\u7406"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"RocketMQ\u81EA\u5E26\u7EC4\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"\u7248\u672C\u7EDF\u4E00\u7BA1\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u65E0\u5916\u90E8\u4F9D\u8D56"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"ZooKeeper\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u989D\u5916\u7684\u5916\u90E8\u4F9D\u8D56"}),"\n",(0,l.jsx)(e.li,{children:"\u7248\u672C\u517C\u5BB9\u6027\u95EE\u9898"}),"\n",(0,l.jsx)(e.li,{children:"\u589E\u52A0\u7CFB\u7EDF\u590D\u6742\u5EA6"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. NameServer\u5DE5\u4F5C\u539F\u7406"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6CE8\u518C\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// Broker\u542F\u52A8\u65F6\u5411\u6240\u6709NameServer\u6CE8\u518C\npublic class BrokerController {\n    public void registerBrokerAll() {\n        List<String> nameServerAddressList = this.remotingClient.getNameServerAddressList();\n        \n        for (String namesrvAddr : nameServerAddressList) {\n            try {\n                // \u5411\u6BCF\u4E2ANameServer\u6CE8\u518C\n                this.registerBroker(namesrvAddr);\n            } catch (Exception e) {\n                log.warn("registerBroker Exception", e);\n            }\n        }\n    }\n    \n    // \u6BCF30\u79D2\u53D1\u9001\u5FC3\u8DF3\n    this.scheduledExecutorService.scheduleAtFixedRate(() -> {\n        this.registerBrokerAll();\n    }, 10, 30, TimeUnit.SECONDS);\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8DEF\u7531\u53D1\u73B0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Producer/Consumer\u4ECENameServer\u83B7\u53D6\u8DEF\u7531\u4FE1\u606F\npublic class MQClientInstance {\n    public TopicRouteData getTopicRouteInfoFromNameServer(String topic) {\n        // \u4ECE\u4EFB\u610F\u4E00\u4E2ANameServer\u83B7\u53D6\n        for (String addr : this.remotingClient.getNameServerAddressList()) {\n            try {\n                return this.mQClientAPIImpl.getTopicRouteInfoFromNameServer(topic, addr);\n            } catch (Exception e) {\n                // \u5931\u8D25\u5219\u5C1D\u8BD5\u4E0B\u4E00\u4E2A\n                continue;\n            }\n        }\n        return null;\n    }\n    \n    // \u5B9A\u671F\u66F4\u65B0\u8DEF\u7531\u4FE1\u606F\uFF08\u9ED8\u8BA430\u79D2\uFF09\n    this.scheduledExecutorService.scheduleAtFixedRate(() -> {\n        this.updateTopicRouteInfoFromNameServer();\n    }, 10, 30, TimeUnit.SECONDS);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u6570\u636E\u4E00\u81F4\u6027\u5904\u7406"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u7EC8\u4E00\u81F4\u6027\u6A21\u578B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// NameServer\u4E4B\u95F4\u4E0D\u901A\u4FE1\uFF0C\u901A\u8FC7Broker\u5FC3\u8DF3\u5B9E\u73B0\u6700\u7EC8\u4E00\u81F4\n// 1. Broker\u5411\u6240\u6709NameServer\u53D1\u9001\u5FC3\u8DF3\n// 2. \u6BCF\u4E2ANameServer\u72EC\u7ACB\u7EF4\u62A4\u8DEF\u7531\u8868\n// 3. \u77ED\u6682\u4E0D\u4E00\u81F4\u53EF\u4EE5\u63A5\u53D7\uFF08\u6700\u591A30\u79D2\uFF09\n\n// \u5BA2\u6237\u7AEF\u5BB9\u9519\u673A\u5236\npublic class DefaultMQProducerImpl {\n    private SendResult sendDefaultImpl(Message msg) {\n        // \u83B7\u53D6\u8DEF\u7531\u4FE1\u606F\n        TopicPublishInfo topicPublishInfo = this.tryToFindTopicPublishInfo(msg.getTopic());\n        \n        // \u9009\u62E9\u961F\u5217\u53D1\u9001\n        MessageQueue mq = selectOneMessageQueue(topicPublishInfo);\n        \n        // \u53D1\u9001\u5931\u8D25\u81EA\u52A8\u91CD\u8BD5\u5176\u4ED6Broker\n        for (int times = 0; times < retryTimes; times++) {\n            try {\n                return this.sendKernelImpl(msg, mq);\n            } catch (Exception e) {\n                // \u9009\u62E9\u5176\u4ED6\u961F\u5217\u91CD\u8BD5\n                mq = selectOneMessageQueue(topicPublishInfo);\n            }\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"9. \u5BF9\u6BD4\u603B\u7ED3"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"NameServer"}),(0,l.jsx)(e.th,{children:"ZooKeeper"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u67B6\u6784"}),(0,l.jsx)(e.td,{children:"\u65E0\u72B6\u6001"}),(0,l.jsx)(e.td,{children:"\u6709\u72B6\u6001"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u4E00\u81F4\u6027"}),(0,l.jsx)(e.td,{children:"\u6700\u7EC8\u4E00\u81F4"}),(0,l.jsx)(e.td,{children:"\u5F3A\u4E00\u81F4\uFF08CP\uFF09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6027\u80FD"}),(0,l.jsx)(e.td,{children:"\u9AD8"}),(0,l.jsx)(e.td,{children:"\u4E2D\u7B49"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u590D\u6742\u5EA6"}),(0,l.jsx)(e.td,{children:"\u7B80\u5355"}),(0,l.jsx)(e.td,{children:"\u590D\u6742"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8FD0\u7EF4\u6210\u672C"}),(0,l.jsx)(e.td,{children:"\u4F4E"}),(0,l.jsx)(e.td,{children:"\u9AD8"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u4F9D\u8D56"}),(0,l.jsx)(e.td,{children:"\u65E0"}),(0,l.jsx)(e.td,{children:"\u5916\u90E8\u4F9D\u8D56"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,l.jsx)(e.td,{children:"\u8DEF\u7531\u6CE8\u518C"}),(0,l.jsx)(e.td,{children:"\u914D\u7F6E\u7BA1\u7406\u3001\u5206\u5E03\u5F0F\u9501"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"10. \u6700\u4F73\u5B9E\u8DF5"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NameServer\u90E8\u7F72\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u81F3\u5C11\u90E8\u7F722\u4E2A\u8282\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"\u63A8\u83503\u4E2A\u8282\u70B9"}),"\n",(0,l.jsx)(e.li,{children:"\u8282\u70B9\u5206\u5E03\u5728\u4E0D\u540C\u673A\u5668"}),"\n",(0,l.jsx)(e.li,{children:"\u914D\u7F6E\u81EA\u52A8\u91CD\u542F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# NameServer\u914D\u7F6E\nlistenPort=9876\n# \u8DEF\u7531\u4FE1\u606F\u6E05\u7406\u95F4\u9694\uFF08\u9ED8\u8BA410\u79D2\uFF09\nscanNotActiveBrokerInterval=10000\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5BA2\u6237\u7AEF\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u914D\u7F6E\u591A\u4E2ANameServer\u5730\u5740\nDefaultMQProducer producer = new DefaultMQProducer("ProducerGroup");\nproducer.setNamesrvAddr("192.168.1.1:9876;192.168.1.2:9876;192.168.1.3:9876");\n\n// \u914D\u7F6E\u91CD\u8BD5\u6B21\u6570\nproducer.setRetryTimesWhenSendFailed(3);\n'})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u603B\u7ED3\uFF1A"}),'\nRocketMQ\u9009\u62E9\u81EA\u7814NameServer\u662F\u57FA\u4E8E\u5B9E\u9645\u9700\u6C42\u7684\u6743\u8861\uFF0C\u8FFD\u6C42\u7B80\u5355\u3001\u9AD8\u6548\u3001\u6613\u8FD0\u7EF4\uFF0C\u800C\u975E\u76F2\u76EE\u4F7F\u7528ZooKeeper\u3002\u8FD9\u4F53\u73B0\u4E86"\u5408\u9002\u7684\u624D\u662F\u6700\u597D\u7684"\u8BBE\u8BA1\u7406\u5FF5\u3002']}),"\n",(0,l.jsx)(e.h3,{id:"27-\u8BF4\u4E00\u4E0B-kafka-\u4E3A\u4EC0\u4E48\u6027\u80FD\u9AD8",children:"27. \u8BF4\u4E00\u4E0B Kafka \u4E3A\u4EC0\u4E48\u6027\u80FD\u9AD8\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"Kafka\u7684\u9AD8\u6027\u80FD\u662F\u591A\u79CD\u6280\u672F\u624B\u6BB5\u7EFC\u5408\u4F5C\u7528\u7684\u7ED3\u679C\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. \u987A\u5E8F\u5199\u78C1\u76D8"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u8FFD\u52A0\u5230\u65E5\u5FD7\u6587\u4EF6\u672B\u5C3E"}),"\n",(0,l.jsx)(e.li,{children:"\u907F\u514D\u968F\u673AIO"}),"\n",(0,l.jsx)(e.li,{children:"\u987A\u5E8F\u5199\u6027\u80FD\u63A5\u8FD1\u5185\u5B58"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u987A\u5E8F\u5199\u78C1\u76D8: 600MB/s\n\u968F\u673A\u5199\u78C1\u76D8: 100KB/s\n\u987A\u5E8F\u5199\u5185\u5B58: \u51E0GB/s\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9E\u73B0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Kafka\u65E5\u5FD7\u8FFD\u52A0\npublic class Log {\n    public void append(MemoryRecords records) {\n        // \u8FFD\u52A0\u5230\u6D3B\u8DC3\u6BB5\u6587\u4EF6\u672B\u5C3E\n        segment.append(records);\n        // \u987A\u5E8F\u5199\uFF0C\u6027\u80FD\u6781\u9AD8\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u96F6\u62F7\u8D1D\u6280\u672F\uFF08Zero-Copy\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F20\u7EDFIO\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u78C1\u76D8 -> \u5185\u6838\u7F13\u51B2\u533A -> \u7528\u6237\u7F13\u51B2\u533A -> Socket\u7F13\u51B2\u533A -> \u7F51\u5361\n\uFF084\u6B21\u62F7\u8D1D\uFF0C4\u6B21\u4E0A\u4E0B\u6587\u5207\u6362\uFF09\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u96F6\u62F7\u8D1D\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"\u78C1\u76D8 -> \u5185\u6838\u7F13\u51B2\u533A -> \u7F51\u5361\n\uFF082\u6B21\u62F7\u8D1D\uFF0C2\u6B21\u4E0A\u4E0B\u6587\u5207\u6362\uFF09\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9E\u73B0\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528FileChannel.transferTo\u5B9E\u73B0\u96F6\u62F7\u8D1D\npublic long writeTo(GatheringByteChannel channel, long position, int length) {\n    return fileChannel.transferTo(position, length, channel);\n}\n\n// sendfile\u7CFB\u7EDF\u8C03\u7528\n// \u6570\u636E\u76F4\u63A5\u4ECE\u6587\u4EF6\u4F20\u8F93\u5230Socket\uFF0C\u4E0D\u7ECF\u8FC7\u7528\u6237\u7A7A\u95F4\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6027\u80FD\u63D0\u5347\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11CPU\u62F7\u8D1D"}),"\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u4E0A\u4E0B\u6587\u5207\u6362"}),"\n",(0,l.jsx)(e.li,{children:"\u63D0\u53472-3\u500D\u541E\u5410\u91CF"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u9875\u7F13\u5B58\uFF08Page Cache\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5229\u7528\u64CD\u4F5C\u7CFB\u7EDF\u9875\u7F13\u5B58"}),"\n",(0,l.jsx)(e.li,{children:"\u5199\u5165\u65F6\u5148\u5199\u5165\u9875\u7F13\u5B58"}),"\n",(0,l.jsx)(e.li,{children:"\u8BFB\u53D6\u65F6\u4F18\u5148\u4ECE\u9875\u7F13\u5B58\u8BFB\u53D6"}),"\n",(0,l.jsx)(e.li,{children:"\u64CD\u4F5C\u7CFB\u7EDF\u8D1F\u8D23\u5237\u76D8"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F18\u52BF\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Kafka\u4E0D\u7EF4\u62A4\u81EA\u5DF1\u7684\u7F13\u5B58\n// \u5145\u5206\u5229\u7528OS\u7684\u9875\u7F13\u5B58\n// 1. \u907F\u514DGC\u538B\u529B\n// 2. \u8FDB\u7A0B\u91CD\u542F\u6570\u636E\u4E0D\u4E22\u5931\n// 3. \u81EA\u52A8\u9884\u8BFB\u548C\u540E\u5199\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6548\u679C\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5199\u5165\uFF1A\u5185\u5B58\u901F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u8BFB\u53D6\uFF1A\u5927\u90E8\u5206\u547D\u4E2D\u7F13\u5B58"}),"\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u78C1\u76D8IO"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u6279\u91CF\u5904\u7406"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u6279\u91CF\u53D1\u9001\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u914D\u7F6E\u6279\u91CF\u5927\u5C0F\nprops.put("batch.size", 16384);  // 16KB\nprops.put("linger.ms", 10);      // \u7B49\u5F8510ms\n\n// \u6D88\u606F\u7D2F\u79EF\u5230batch.size\u6216linger.ms\u540E\u6279\u91CF\u53D1\u9001\npublic class RecordAccumulator {\n    public RecordAppendResult append(TopicPartition tp, Record record) {\n        // \u8FFD\u52A0\u5230\u6279\u6B21\n        Deque<ProducerBatch> dq = getOrCreateDeque(tp);\n        ProducerBatch last = dq.peekLast();\n        \n        if (last != null) {\n            // \u8FFD\u52A0\u5230\u73B0\u6709\u6279\u6B21\n            FutureRecordMetadata future = last.tryAppend(record);\n            if (future != null) {\n                return new RecordAppendResult(future, false);\n            }\n        }\n        \n        // \u521B\u5EFA\u65B0\u6279\u6B21\n        ProducerBatch batch = new ProducerBatch(tp, records, now);\n        dq.addLast(batch);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u6279\u91CF\u62C9\u53D6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u914D\u7F6E\u6BCF\u6B21\u62C9\u53D6\u7684\u6570\u636E\u91CF\nprops.put("fetch.min.bytes", 1024);      // \u6700\u5C0F1KB\nprops.put("fetch.max.bytes", 52428800);  // \u6700\u592750MB\nprops.put("max.poll.records", 500);      // \u6700\u591A500\u6761\n\n// \u4E00\u6B21\u62C9\u53D6\u591A\u6761\u6D88\u606F\nConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6279\u91CF\u5199\u5165\u78C1\u76D8\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6279\u91CF\u5237\u76D8\npublic void flush() {\n    // \u6279\u91CF\u5199\u5165\u591A\u6761\u6D88\u606F\n    fileChannel.write(buffers);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. \u6570\u636E\u538B\u7F29"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u652F\u6301\u7684\u538B\u7F29\u7B97\u6CD5\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u751F\u4EA7\u8005\u914D\u7F6E\u538B\u7F29\nprops.put("compression.type", "lz4");  // gzip, snappy, lz4, zstd\n\n// \u538B\u7F29\u6BD4\u5BF9\u6BD4\n// gzip: \u538B\u7F29\u6BD4\u6700\u9AD8\uFF0CCPU\u6D88\u8017\u5927\n// snappy: \u5E73\u8861\n// lz4: \u901F\u5EA6\u6700\u5FEB\n// zstd: \u65B0\u7B97\u6CD5\uFF0C\u7EFC\u5408\u6700\u4F18\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6548\u679C\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u7F51\u7EDC\u4F20\u8F93"}),"\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u78C1\u76D8\u5B58\u50A8"}),"\n",(0,l.jsx)(e.li,{children:"\u63D0\u5347\u541E\u5410\u91CF"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u5206\u533A\u5E76\u884C"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5206\u533A\u8BBE\u8BA1\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// Topic\u5206\u4E3A\u591A\u4E2A\u5206\u533A\n// \u6BCF\u4E2A\u5206\u533A\u72EC\u7ACB\u8BFB\u5199\n// \u5E76\u884C\u5904\u7406\u63D0\u5347\u541E\u5410\u91CF\n\n// \u521B\u5EFA\u591A\u5206\u533ATopic\nkafka-topics.sh --create \\\n  --topic my-topic \\\n  --partitions 10 \\\n  --replication-factor 3\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E76\u884C\u5199\u5165\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u591A\u4E2A\u751F\u4EA7\u8005\u5E76\u884C\u5199\u5165\u4E0D\u540C\u5206\u533A\nproducer.send(new ProducerRecord<>("topic", partition, key, value));\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5E76\u884C\u6D88\u8D39\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6D88\u8D39\u8005\u7EC4\u5185\u591A\u4E2A\u6D88\u8D39\u8005\u5E76\u884C\u6D88\u8D39\u4E0D\u540C\u5206\u533A\n// \u5206\u533A\u6570 = \u6700\u5927\u5E76\u884C\u5EA6\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u9AD8\u6548\u7684\u6570\u636E\u7ED3\u6784"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65E5\u5FD7\u6BB5\uFF08Log Segment\uFF09\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u6BCF\u4E2A\u5206\u533A\u7531\u591A\u4E2A\u6BB5\u6587\u4EF6\u7EC4\u6210\n00000000000000000000.log  // \u7B2C\u4E00\u4E2A\u6BB5\n00000000000000368769.log  // \u7B2C\u4E8C\u4E2A\u6BB5\n00000000000000737337.log  // \u7B2C\u4E09\u4E2A\u6BB5\n\n// \u4F18\u52BF\uFF1A\n// 1. \u5FEB\u901F\u5B9A\u4F4D\u6D88\u606F\n// 2. \u65B9\u4FBF\u6E05\u7406\u8FC7\u671F\u6570\u636E\n// 3. \u652F\u6301\u5E76\u884C\u5199\u5165\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7D22\u5F15\u6587\u4EF6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u504F\u79FB\u91CF\u7D22\u5F15\n00000000000000000000.index\n// \u65F6\u95F4\u6233\u7D22\u5F15\n00000000000000000000.timeindex\n\n// \u7A00\u758F\u7D22\u5F15\uFF0C\u5FEB\u901F\u5B9A\u4F4D\npublic class OffsetIndex {\n    // \u6BCF\u96944KB\u8BB0\u5F55\u4E00\u4E2A\u7D22\u5F15\u9879\n    private final int indexIntervalBytes = 4096;\n    \n    public OffsetPosition lookup(long targetOffset) {\n        // \u4E8C\u5206\u67E5\u627E\n        int slot = indexSlotFor(targetOffset);\n        return parseEntry(slot);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"8. \u7F51\u7EDC\u6A21\u578B\u4F18\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Reactor\u6A21\u5F0F\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-scala",children:"// Acceptor\u7EBF\u7A0B\u63A5\u53D7\u8FDE\u63A5\n// Processor\u7EBF\u7A0B\u5904\u7406\u7F51\u7EDCIO\n// Handler\u7EBF\u7A0B\u5904\u7406\u4E1A\u52A1\u903B\u8F91\n\nclass SocketServer {\n    val processors = new Array[Processor](numProcessors)\n    val acceptor = new Acceptor(...)\n    \n    // \u591A\u7EBF\u7A0B\u5E76\u884C\u5904\u7406\n    processors.foreach(_.start())\n    acceptor.start()\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"NIO\u975E\u963B\u585E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528Java NIO\nSelector selector = Selector.open();\nchannel.register(selector, SelectionKey.OP_READ);\n\n// \u5355\u7EBF\u7A0B\u5904\u7406\u591A\u4E2A\u8FDE\u63A5\nwhile (true) {\n    selector.select();\n    Set<SelectionKey> keys = selector.selectedKeys();\n    // \u5904\u7406\u5C31\u7EEA\u7684\u8FDE\u63A5\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"9. \u5185\u5B58\u7BA1\u7406\u4F18\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5185\u5B58\u6C60\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// BufferPool\u590D\u7528ByteBuffer\npublic class BufferPool {\n    private final Deque<ByteBuffer> free;\n    \n    public ByteBuffer allocate(int size) {\n        // \u4ECE\u6C60\u4E2D\u83B7\u53D6\uFF0C\u907F\u514D\u9891\u7E41\u5206\u914D\n        ByteBuffer buffer = free.pollFirst();\n        if (buffer == null) {\n            buffer = ByteBuffer.allocate(size);\n        }\n        return buffer;\n    }\n    \n    public void deallocate(ByteBuffer buffer) {\n        // \u5F52\u8FD8\u5230\u6C60\u4E2D\n        free.add(buffer);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u907F\u514DGC\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u5806\u5916\u5185\u5B58"}),"\n",(0,l.jsx)(e.li,{children:"\u590D\u7528\u5BF9\u8C61"}),"\n",(0,l.jsx)(e.li,{children:"\u51CF\u5C11\u4E34\u65F6\u5BF9\u8C61\u521B\u5EFA"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"10. \u914D\u7F6E\u4F18\u5316"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u6279\u91CF\u5927\u5C0F\nbatch.size=16384\nlinger.ms=10\n\n# \u538B\u7F29\ncompression.type=lz4\n\n# \u7F13\u51B2\u533A\nbuffer.memory=33554432\n\n# \u5E76\u53D1\u8BF7\u6C42\nmax.in.flight.requests.per.connection=5\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Broker\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u7F51\u7EDC\u7EBF\u7A0B\nnum.network.threads=8\n\n# IO\u7EBF\u7A0B\nnum.io.threads=8\n\n# \u65E5\u5FD7\u5237\u76D8\u7B56\u7565\nlog.flush.interval.messages=10000\nlog.flush.interval.ms=1000\n\n# \u526F\u672C\u62C9\u53D6\u7EBF\u7A0B\nnum.replica.fetchers=4\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u914D\u7F6E\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-properties",children:"# \u62C9\u53D6\u5927\u5C0F\nfetch.min.bytes=1024\nfetch.max.bytes=52428800\nmax.poll.records=500\n\n# \u5E76\u884C\u5EA6\uFF08\u5206\u533A\u6570\uFF09\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"11. \u6027\u80FD\u6570\u636E"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u541E\u5410\u91CF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5355\u673A\uFF1A\u51E0\u5341\u4E07\u5230\u767E\u4E07TPS"}),"\n",(0,l.jsx)(e.li,{children:"\u96C6\u7FA4\uFF1A\u5343\u4E07\u7EA7TPS"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5EF6\u8FDF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7AEF\u5230\u7AEF\u5EF6\u8FDF\uFF1A\u51E0\u6BEB\u79D2\u5230\u51E0\u5341\u6BEB\u79D2"}),"\n",(0,l.jsx)(e.li,{children:"99\u5206\u4F4D\u5EF6\u8FDF\uFF1A\u5C0F\u4E8E100ms"}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u603B\u7ED3\uFF1A"}),"\nKafka\u7684\u9AD8\u6027\u80FD\u6765\u81EA\u4E8E\uFF1A"]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u987A\u5E8F\u5199\u78C1\u76D8"}),"\n",(0,l.jsx)(e.li,{children:"\u96F6\u62F7\u8D1D\u6280\u672F"}),"\n",(0,l.jsx)(e.li,{children:"\u9875\u7F13\u5B58\u5229\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u6279\u91CF\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636E\u538B\u7F29"}),"\n",(0,l.jsx)(e.li,{children:"\u5206\u533A\u5E76\u884C"}),"\n",(0,l.jsx)(e.li,{children:"\u9AD8\u6548\u6570\u636E\u7ED3\u6784"}),"\n",(0,l.jsx)(e.li,{children:"\u7F51\u7EDC\u6A21\u578B\u4F18\u5316"}),"\n",(0,l.jsx)(e.li,{children:"\u5185\u5B58\u7BA1\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u5408\u7406\u914D\u7F6E"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"28-rabbitmq-\u600E\u4E48\u5B9E\u73B0\u5EF6\u8FDF\u961F\u5217",children:"28. RabbitMQ \u600E\u4E48\u5B9E\u73B0\u5EF6\u8FDF\u961F\u5217\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RabbitMQ\u5B9E\u73B0\u5EF6\u8FDF\u961F\u5217\u4E3B\u8981\u6709\u4E24\u79CD\u65B9\u5F0F\uFF1ATTL+\u6B7B\u4FE1\u961F\u5217\u548C\u5EF6\u8FDF\u63D2\u4EF6\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"1. TTL + \u6B7B\u4FE1\u961F\u5217\uFF08\u63A8\u8350\u65B9\u6848\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u8BBE\u7F6ETTL\u8FC7\u671F\u65F6\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u8FC7\u671F\u540E\u8FDB\u5165\u6B7B\u4FE1\u4EA4\u6362\u673A"}),"\n",(0,l.jsx)(e.li,{children:"\u6B7B\u4FE1\u961F\u5217\u7684\u6D88\u8D39\u8005\u5904\u7406\u5EF6\u8FDF\u6D88\u606F"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9E\u73B0\u6B65\u9AA4\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA41\uFF1A\u58F0\u660E\u6B7B\u4FE1\u4EA4\u6362\u673A\u548C\u961F\u5217"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// 1. \u58F0\u660E\u6B7B\u4FE1\u4EA4\u6362\u673A\nchannel.exchangeDeclare("dlx.exchange", "direct", true);\n\n// 2. \u58F0\u660E\u6B7B\u4FE1\u961F\u5217\uFF08\u5B9E\u9645\u4E1A\u52A1\u961F\u5217\uFF09\nchannel.queueDeclare("dlx.queue", true, false, false, null);\n\n// 3. \u7ED1\u5B9A\nchannel.queueBind("dlx.queue", "dlx.exchange", "dlx.routing.key");\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA42\uFF1A\u58F0\u660E\u5EF6\u8FDF\u961F\u5217"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u58F0\u660E\u5EF6\u8FDF\u961F\u5217\uFF0C\u914D\u7F6E\u6B7B\u4FE1\u4EA4\u6362\u673A\nMap<String, Object> args = new HashMap<>();\nargs.put("x-dead-letter-exchange", "dlx.exchange");\nargs.put("x-dead-letter-routing-key", "dlx.routing.key");\nargs.put("x-message-ttl", 30000);  // 30\u79D2\u5EF6\u8FDF\n\nchannel.queueDeclare("delay.queue", true, false, false, args);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA43\uFF1A\u53D1\u9001\u5EF6\u8FDF\u6D88\u606F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u53D1\u9001\u6D88\u606F\u5230\u5EF6\u8FDF\u961F\u5217\nchannel.basicPublish("", "delay.queue", null, message.getBytes());\n\n// \u6D88\u606F30\u79D2\u540E\u81EA\u52A8\u8FDB\u5165dlx.queue\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6B65\u9AA44\uFF1A\u6D88\u8D39\u5EF6\u8FDF\u6D88\u606F"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u6D88\u8D39\u6B7B\u4FE1\u961F\u5217\uFF08\u5B9E\u9645\u4E1A\u52A1\u961F\u5217\uFF09\nchannel.basicConsume("dlx.queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        System.out.println("\u6536\u5230\u5EF6\u8FDF\u6D88\u606F: " + new String(body));\n        channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"2. \u652F\u6301\u591A\u79CD\u5EF6\u8FDF\u65F6\u95F4"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u65B9\u6848\uFF1A\u4E3A\u6BCF\u79CD\u5EF6\u8FDF\u65F6\u95F4\u521B\u5EFA\u4E00\u4E2A\u961F\u5217"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u5EF6\u8FDF\u961F\u5217\u5DE5\u5382\npublic class DelayQueueFactory {\n    \n    // \u521B\u5EFA\u5EF6\u8FDF\u961F\u5217\n    public void createDelayQueue(int delaySeconds) {\n        String queueName = "delay.queue." + delaySeconds;\n        \n        Map<String, Object> args = new HashMap<>();\n        args.put("x-dead-letter-exchange", "dlx.exchange");\n        args.put("x-dead-letter-routing-key", "dlx.routing.key");\n        args.put("x-message-ttl", delaySeconds * 1000);\n        \n        channel.queueDeclare(queueName, true, false, false, args);\n    }\n    \n    // \u53D1\u9001\u5EF6\u8FDF\u6D88\u606F\n    public void sendDelayMessage(String message, int delaySeconds) {\n        String queueName = "delay.queue." + delaySeconds;\n        channel.basicPublish("", queueName, null, message.getBytes());\n    }\n}\n\n// \u4F7F\u7528\nfactory.createDelayQueue(10);   // 10\u79D2\u5EF6\u8FDF\u961F\u5217\nfactory.createDelayQueue(30);   // 30\u79D2\u5EF6\u8FDF\u961F\u5217\nfactory.createDelayQueue(60);   // 60\u79D2\u5EF6\u8FDF\u961F\u5217\n\nfactory.sendDelayMessage("10\u79D2\u540E\u6267\u884C", 10);\nfactory.sendDelayMessage("30\u79D2\u540E\u6267\u884C", 30);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"3. \u6D88\u606F\u7EA7\u522BTTL\uFF08\u7075\u6D3B\u5EF6\u8FDF\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8BBE\u7F6E\u6D88\u606FTTL\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u6BCF\u6761\u6D88\u606F\u8BBE\u7F6E\u4E0D\u540C\u7684TTL\nAMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()\n    .expiration(String.valueOf(delayMillis))  // \u6D88\u606F\u7EA7\u522BTTL\n    .build();\n\nchannel.basicPublish("", "delay.queue", properties, message.getBytes());\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6CE8\u610F\u4E8B\u9879\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u7EA7\u522BTTL\u53EF\u80FD\u5BFC\u81F4\u961F\u5934\u963B\u585E"}),"\n",(0,l.jsx)(e.li,{children:"\u5982\u679C\u961F\u5934\u6D88\u606F\u672A\u8FC7\u671F\uFF0C\u540E\u9762\u7684\u6D88\u606F\u5373\u4F7F\u8FC7\u671F\u4E5F\u4E0D\u4F1A\u88AB\u5904\u7406"}),"\n",(0,l.jsx)(e.li,{children:"\u5EFA\u8BAE\u4F7F\u7528\u961F\u5217\u7EA7\u522BTTL"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4. \u5EF6\u8FDF\u63D2\u4EF6\u65B9\u6848\uFF08rabbitmq_delayed_message_exchange\uFF09"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B89\u88C5\u63D2\u4EF6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-bash",children:"# \u4E0B\u8F7D\u63D2\u4EF6\nwget https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/download/v3.9.0/rabbitmq_delayed_message_exchange-3.9.0.ez\n\n# \u590D\u5236\u5230\u63D2\u4EF6\u76EE\u5F55\ncp rabbitmq_delayed_message_exchange-3.9.0.ez /usr/lib/rabbitmq/plugins/\n\n# \u542F\u7528\u63D2\u4EF6\nrabbitmq-plugins enable rabbitmq_delayed_message_exchange\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F7F\u7528\u63D2\u4EF6\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// 1. \u58F0\u660E\u5EF6\u8FDF\u4EA4\u6362\u673A\nMap<String, Object> args = new HashMap<>();\nargs.put("x-delayed-type", "direct");\n\nchannel.exchangeDeclare("delayed.exchange", "x-delayed-message", true, false, args);\n\n// 2. \u58F0\u660E\u961F\u5217\u5E76\u7ED1\u5B9A\nchannel.queueDeclare("delayed.queue", true, false, false, null);\nchannel.queueBind("delayed.queue", "delayed.exchange", "delayed.routing.key");\n\n// 3. \u53D1\u9001\u5EF6\u8FDF\u6D88\u606F\nMap<String, Object> headers = new HashMap<>();\nheaders.put("x-delay", 30000);  // \u5EF6\u8FDF30\u79D2\n\nAMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()\n    .headers(headers)\n    .build();\n\nchannel.basicPublish("delayed.exchange", "delayed.routing.key", properties, message.getBytes());\n\n// 4. \u6D88\u8D39\u6D88\u606F\nchannel.basicConsume("delayed.queue", false, new DefaultConsumer(channel) {\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope,\n                               AMQP.BasicProperties properties, byte[] body) {\n        System.out.println("\u6536\u5230\u5EF6\u8FDF\u6D88\u606F: " + new String(body));\n        channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n});\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u63D2\u4EF6\u4F18\u52BF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652F\u6301\u4EFB\u610F\u5EF6\u8FDF\u65F6\u95F4"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0D\u4F1A\u961F\u5934\u963B\u585E"}),"\n",(0,l.jsx)(e.li,{children:"\u4F7F\u7528\u7B80\u5355"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u63D2\u4EF6\u52A3\u52BF\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5B89\u88C5\u63D2\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"\u6027\u80FD\u76F8\u5BF9\u8F83\u4F4E"}),"\n",(0,l.jsx)(e.li,{children:"\u5EF6\u8FDF\u6D88\u606F\u5B58\u50A8\u5728\u5185\u5B58\u4E2D"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"5. Spring Boot\u96C6\u6210"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u914D\u7F6E\u7C7B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class DelayQueueConfig {\n    \n    // \u6B7B\u4FE1\u4EA4\u6362\u673A\n    @Bean\n    public DirectExchange dlxExchange() {\n        return new DirectExchange("dlx.exchange");\n    }\n    \n    // \u6B7B\u4FE1\u961F\u5217\n    @Bean\n    public Queue dlxQueue() {\n        return new Queue("dlx.queue");\n    }\n    \n    // \u7ED1\u5B9A\n    @Bean\n    public Binding dlxBinding() {\n        return BindingBuilder.bind(dlxQueue())\n            .to(dlxExchange())\n            .with("dlx.routing.key");\n    }\n    \n    // \u5EF6\u8FDF\u961F\u5217\n    @Bean\n    public Queue delayQueue() {\n        Map<String, Object> args = new HashMap<>();\n        args.put("x-dead-letter-exchange", "dlx.exchange");\n        args.put("x-dead-letter-routing-key", "dlx.routing.key");\n        args.put("x-message-ttl", 30000);\n        return new Queue("delay.queue", true, false, false, args);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'@Service\npublic class DelayMessageProducer {\n    \n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n    \n    public void sendDelayMessage(String message, int delaySeconds) {\n        MessageProperties properties = new MessageProperties();\n        properties.setExpiration(String.valueOf(delaySeconds * 1000));\n        \n        Message msg = new Message(message.getBytes(), properties);\n        rabbitTemplate.send("", "delay.queue", msg);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'@Component\npublic class DelayMessageConsumer {\n    \n    @RabbitListener(queues = "dlx.queue")\n    public void handleDelayMessage(String message) {\n        System.out.println("\u6536\u5230\u5EF6\u8FDF\u6D88\u606F: " + message);\n        // \u5904\u7406\u4E1A\u52A1\u903B\u8F91\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"6. \u5E94\u7528\u573A\u666F"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u8BA2\u5355\u8D85\u65F6\u53D6\u6D88\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// \u521B\u5EFA\u8BA2\u5355\u540E\u53D1\u900130\u5206\u949F\u5EF6\u8FDF\u6D88\u606F\npublic void createOrder(Order order) {\n    // \u4FDD\u5B58\u8BA2\u5355\n    orderRepository.save(order);\n    \n    // \u53D1\u9001\u5EF6\u8FDF\u6D88\u606F\n    delayProducer.sendDelayMessage(order.getId(), 30 * 60);\n}\n\n// 30\u5206\u949F\u540E\u68C0\u67E5\u8BA2\u5355\u72B6\u6001\n@RabbitListener(queues = "dlx.queue")\npublic void checkOrderStatus(String orderId) {\n    Order order = orderRepository.findById(orderId);\n    if (order.getStatus() == OrderStatus.UNPAID) {\n        // \u53D6\u6D88\u8BA2\u5355\n        order.setStatus(OrderStatus.CANCELLED);\n        orderRepository.save(order);\n    }\n}\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9A\u65F6\u4EFB\u52A1\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"// \u53D1\u9001\u5B9A\u65F6\u63D0\u9192\npublic void scheduleReminder(String userId, String content, int delaySeconds) {\n    ReminderMessage message = new ReminderMessage(userId, content);\n    delayProducer.sendDelayMessage(JSON.toJSONString(message), delaySeconds);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"7. \u65B9\u6848\u5BF9\u6BD4"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u65B9\u6848"}),(0,l.jsx)(e.th,{children:"\u4F18\u70B9"}),(0,l.jsx)(e.th,{children:"\u7F3A\u70B9"}),(0,l.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"TTL+\u6B7B\u4FE1"}),(0,l.jsx)(e.td,{children:"\u65E0\u9700\u63D2\u4EF6\uFF0C\u7A33\u5B9A"}),(0,l.jsx)(e.td,{children:"\u56FA\u5B9A\u5EF6\u8FDF\u65F6\u95F4"}),(0,l.jsx)(e.td,{children:"\u56FA\u5B9A\u5EF6\u8FDF\u573A\u666F"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6D88\u606FTTL"}),(0,l.jsx)(e.td,{children:"\u7075\u6D3B"}),(0,l.jsx)(e.td,{children:"\u961F\u5934\u963B\u585E"}),(0,l.jsx)(e.td,{children:"\u4E0D\u63A8\u8350"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5EF6\u8FDF\u63D2\u4EF6"}),(0,l.jsx)(e.td,{children:"\u7075\u6D3B\uFF0C\u65E0\u963B\u585E"}),(0,l.jsx)(e.td,{children:"\u9700\u8981\u63D2\u4EF6"}),(0,l.jsx)(e.td,{children:"\u4EFB\u610F\u5EF6\u8FDF\u573A\u666F"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u56FA\u5B9A\u5EF6\u8FDF\u65F6\u95F4\uFF1A\u4F7F\u7528TTL+\u6B7B\u4FE1\u961F\u5217"}),"\n",(0,l.jsx)(e.li,{children:"\u4EFB\u610F\u5EF6\u8FDF\u65F6\u95F4\uFF1A\u4F7F\u7528\u5EF6\u8FDF\u63D2\u4EF6"}),"\n",(0,l.jsx)(e.li,{children:"\u76D1\u63A7\u5EF6\u8FDF\u961F\u5217\u957F\u5EA6"}),"\n",(0,l.jsx)(e.li,{children:"\u8BBE\u7F6E\u5408\u7406\u7684TTL"}),"\n",(0,l.jsx)(e.li,{children:"\u5904\u7406\u6D88\u606F\u5E42\u7B49\u6027"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"29-rocketmq-\u7684\u5EF6\u8FDF\u6D88\u606F\u662F\u600E\u4E48\u5B9E\u73B0\u7684",children:"29. RocketMQ \u7684\u5EF6\u8FDF\u6D88\u606F\u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RocketMQ\u901A\u8FC7\u5185\u90E8\u5EF6\u8FDF\u961F\u5217\u673A\u5236\u5B9E\u73B0\u5EF6\u8FDF\u6D88\u606F\uFF0C\u652F\u630118\u4E2A\u9884\u8BBE\u5EF6\u8FDF\u7EA7\u522B\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9E\u73B0\u539F\u7406\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5EF6\u8FDF\u6D88\u606F\u5148\u53D1\u9001\u5230\u5185\u90E8Topic\uFF08SCHEDULE_TOPIC_XXXX\uFF09"}),"\n",(0,l.jsx)(e.li,{children:"\u5B9A\u65F6\u4EFB\u52A1\u626B\u63CF\u5230\u671F\u6D88\u606F"}),"\n",(0,l.jsx)(e.li,{children:"\u5C06\u5230\u671F\u6D88\u606F\u6295\u9012\u5230\u76EE\u6807Topic"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4F7F\u7528\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'Message message = new Message("TopicTest", "Hello".getBytes());\nmessage.setDelayTimeLevel(3);  // level 3 = 10\u79D2\u5EF6\u8FDF\nproducer.send(message);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5EF6\u8FDF\u7EA7\u522B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h\n"})}),"\n",(0,l.jsx)(e.h3,{id:"30-rocketmq-\u7684\u5F00\u53D1\u53C2\u8003\u4E86-kafka\u90A3\u4E24\u8005\u5728\u67B6\u6784\u548C\u529F\u80FD\u4E0A\u6709\u4EC0\u4E48\u533A\u522B",children:"30. RocketMQ \u7684\u5F00\u53D1\u53C2\u8003\u4E86 Kafka\uFF0C\u90A3\u4E24\u8005\u5728\u67B6\u6784\u548C\u529F\u80FD\u4E0A\u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u5DEE\u5F02\u5BF9\u6BD4\uFF1A"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u7279\u6027"}),(0,l.jsx)(e.th,{children:"Kafka"}),(0,l.jsx)(e.th,{children:"RocketMQ"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u8BBE\u8BA1\u76EE\u6807"}),(0,l.jsx)(e.td,{children:"\u65E5\u5FD7\u6536\u96C6\u3001\u6D41\u5904\u7406"}),(0,l.jsx)(e.td,{children:"\u4E1A\u52A1\u6D88\u606F\u4F20\u9012"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6CE8\u518C\u4E2D\u5FC3"}),(0,l.jsx)(e.td,{children:"ZooKeeper/KRaft"}),(0,l.jsx)(e.td,{children:"NameServer"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5B58\u50A8\u6A21\u578B"}),(0,l.jsx)(e.td,{children:"\u5206\u533A\u72EC\u7ACB\u5B58\u50A8"}),(0,l.jsx)(e.td,{children:"\u7EDF\u4E00CommitLog"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6D88\u606F\u8FC7\u6EE4"}),(0,l.jsx)(e.td,{children:"\u5BA2\u6237\u7AEF\u8FC7\u6EE4"}),(0,l.jsx)(e.td,{children:"\u670D\u52A1\u7AEF\u8FC7\u6EE4\uFF08Tag/SQL\uFF09"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5EF6\u8FDF\u6D88\u606F"}),(0,l.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,l.jsx)(e.td,{children:"\u652F\u630118\u4E2A\u5EF6\u8FDF\u7EA7\u522B"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u4E8B\u52A1\u6D88\u606F"}),(0,l.jsx)(e.td,{children:"\u652F\u6301Exactly Once"}),(0,l.jsx)(e.td,{children:"\u652F\u6301\u5206\u5E03\u5F0F\u4E8B\u52A1"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6D88\u606F\u91CD\u8BD5"}),(0,l.jsx)(e.td,{children:"\u9700\u81EA\u5DF1\u5B9E\u73B0"}),(0,l.jsx)(e.td,{children:"\u5185\u7F6E\u91CD\u8BD5\u673A\u5236"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u6B7B\u4FE1\u961F\u5217"}),(0,l.jsx)(e.td,{children:"\u9700\u81EA\u5DF1\u5B9E\u73B0"}),(0,l.jsx)(e.td,{children:"\u5185\u7F6E\u6B7B\u4FE1\u961F\u5217"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u541E\u5410\u91CF"}),(0,l.jsx)(e.td,{children:"\u6781\u9AD8\uFF08\u767E\u4E07\u7EA7\uFF09"}),(0,l.jsx)(e.td,{children:"\u9AD8\uFF08\u5341\u4E07\u7EA7\uFF09"})]})]})]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u9009\u578B\u5EFA\u8BAE\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u9009Kafka"}),"\uFF1A\u65E5\u5FD7\u6536\u96C6\u3001\u5927\u6570\u636E\u5904\u7406\u3001\u9AD8\u541E\u5410\u91CF\u573A\u666F"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u9009RocketMQ"}),"\uFF1A\u4E1A\u52A1\u6D88\u606F\u3001\u9700\u8981\u4E8B\u52A1/\u5EF6\u8FDF\u6D88\u606F\u3001\u91D1\u878D\u7EA7\u5E94\u7528"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"31-\u8BF4\u4E00\u4E0B-rocketmq-\u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0",children:"31. \u8BF4\u4E00\u4E0B RocketMQ \u4E2D\u5173\u4E8E\u4E8B\u52A1\u6D88\u606F\u7684\u5B9E\u73B0\uFF1F"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,l.jsx)(e.p,{children:"RocketMQ\u4E8B\u52A1\u6D88\u606F\u901A\u8FC7\u4E24\u9636\u6BB5\u63D0\u4EA4\u548C\u4E8B\u52A1\u56DE\u67E5\u673A\u5236\u5B9E\u73B0\u5206\u5E03\u5F0F\u4E8B\u52A1\u3002"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B9E\u73B0\u6D41\u7A0B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"1. \u53D1\u9001Half\u6D88\u606F\uFF08\u9884\u63D0\u4EA4\uFF09\n2. \u6267\u884C\u672C\u5730\u4E8B\u52A1\n3. \u63D0\u4EA4\u6216\u56DE\u6EDA\u6D88\u606F\n4. \u8D85\u65F6\u5219Broker\u56DE\u67E5\u4E8B\u52A1\u72B6\u6001\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B\uFF1A"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'// 1. \u521B\u5EFA\u4E8B\u52A1\u751F\u4EA7\u8005\nTransactionMQProducer producer = new TransactionMQProducer("group");\nproducer.setTransactionListener(new TransactionListenerImpl());\n\n// 2. \u5B9E\u73B0\u4E8B\u52A1\u76D1\u542C\u5668\npublic class TransactionListenerImpl implements TransactionListener {\n    @Override\n    public LocalTransactionState executeLocalTransaction(Message msg, Object arg) {\n        try {\n            // \u6267\u884C\u672C\u5730\u4E8B\u52A1\n            orderService.createOrder((Order) arg);\n            return LocalTransactionState.COMMIT_MESSAGE;\n        } catch (Exception e) {\n            return LocalTransactionState.ROLLBACK_MESSAGE;\n        }\n    }\n    \n    @Override\n    public LocalTransactionState checkLocalTransaction(MessageExt msg) {\n        // \u4E8B\u52A1\u56DE\u67E5\n        String status = transactionLogService.getStatus(msg.getTransactionId());\n        return "COMMIT".equals(status) ? \n            LocalTransactionState.COMMIT_MESSAGE : \n            LocalTransactionState.ROLLBACK_MESSAGE;\n    }\n}\n\n// 3. \u53D1\u9001\u4E8B\u52A1\u6D88\u606F\nMessage message = new Message("OrderTopic", order.toBytes());\nproducer.sendMessageInTransaction(message, order);\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u672C\u5730\u4E8B\u52A1\u8981\u5FEB\u901F\u6267\u884C"}),"\n",(0,l.jsx)(e.li,{children:"\u8BB0\u5F55\u4E8B\u52A1\u65E5\u5FD7\u7528\u4E8E\u56DE\u67E5"}),"\n",(0,l.jsx)(e.li,{children:"\u4E0B\u6E38\u6D88\u8D39\u8981\u5E42\u7B49\u5904\u7406"}),"\n"]}),"\n",(0,l.jsx)(e.hr,{}),"\n",(0,l.jsx)(e.h2,{id:"\u5B66\u4E60\u6307\u5357",children:"\u5B66\u4E60\u6307\u5357"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u6838\u5FC3\u8981\u70B9\uFF1A"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u961F\u5217\u7684\u57FA\u672C\u6982\u5FF5\u548C\u6A21\u578B"}),"\n",(0,l.jsx)(e.li,{children:"\u4E3B\u6D41MQ\u4EA7\u54C1\u7684\u67B6\u6784\u548C\u7279\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u53EF\u9760\u6027\u548C\u4E00\u81F4\u6027\u4FDD\u8BC1"}),"\n",(0,l.jsx)(e.li,{children:"\u6D88\u606F\u961F\u5217\u5728\u5206\u5E03\u5F0F\u7CFB\u7EDF\u4E2D\u7684\u5E94\u7528"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE\uFF1A"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u638C\u63E1\u6D88\u606F\u961F\u5217\u7684\u57FA\u672C\u6982\u5FF5"}),"\n",(0,l.jsx)(e.li,{children:"\u6DF1\u5165\u7406\u89E3\u4E3B\u6D41MQ\u4EA7\u54C1\u7684\u7279\u6027"}),"\n",(0,l.jsx)(e.li,{children:"\u719F\u6089\u6D88\u606F\u961F\u5217\u7684\u9AD8\u53EF\u7528\u65B9\u6848"}),"\n",(0,l.jsx)(e.li,{children:"\u5B66\u4E60\u6D88\u606F\u961F\u5217\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\u7684\u5E94\u7528"}),"\n"]})]})}function o(n={}){let{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(h,{...n})}):h(n)}},28453:function(n,e,r){r.d(e,{R:()=>c,x:()=>d});var s=r(96540);let l={},i=s.createContext(l);function c(n){let e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:c(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);