"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["91340"],{69277:function(n,e,r){r.r(e),r.d(e,{metadata:()=>l,default:()=>o,frontMatter:()=>c,contentTitle:()=>a,toc:()=>d,assets:()=>t});var l=JSON.parse('{"id":"interview/java-\u5E76\u53D1","title":"Java \u5E76\u53D1\u9762\u8BD5\u9898\u96C6","description":"\u603B\u9898\u6570 \u7EBF\u7A0B\u3001\u9501\u3001\u5E76\u53D1\u5BB9\u5668\u3001JMM |  \u96BE\u5EA6\u5206\u5E03: \u4E2D\u7EA7\u5230\u9AD8\u7EA7","source":"@site/docs/interview/java-\u5E76\u53D1.md","sourceDirName":"interview","slug":"/interview/java-\u5E76\u53D1","permalink":"/docs/interview/java-\u5E76\u53D1","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/interview/java-\u5E76\u53D1.md","tags":[],"version":"current","lastUpdatedBy":"laby","lastUpdatedAt":1763643037000,"frontMatter":{}}'),i=r(74848),s=r(28453);let c={},a="Java \u5E76\u53D1\u9762\u8BD5\u9898\u96C6",t={},d=[{value:"\u9762\u8BD5\u9898\u76EE\u5217\u8868",id:"\u9762\u8BD5\u9898\u76EE\u5217\u8868",level:2},{value:"1. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u7EBF\u7A0B\u540C\u6B65\uFF1F",id:"1-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u7EBF\u7A0B\u540C\u6B65",level:3},{value:"2. Java \u4E2D\u7684\u7EBF\u7A0B\u5B89\u5168\u662F\u4EC0\u4E48\u610F\u601D\uFF1F",id:"2-java-\u4E2D\u7684\u7EBF\u7A0B\u5B89\u5168\u662F\u4EC0\u4E48\u610F\u601D",level:3},{value:"3. \u4EC0\u4E48\u662F\u534F\u7A0B\uFF1FJava \u652F\u6301\u534F\u7A0B\u5417\uFF1F",id:"3-\u4EC0\u4E48\u662F\u534F\u7A0Bjava-\u652F\u6301\u534F\u7A0B\u5417",level:3},{value:"4. \u7EBF\u7A0B\u7684\u751F\u547D\u5468\u671F\u5728 Java \u4E2D\u662F\u5982\u4F55\u5B9A\u4E49\u7684\uFF1F",id:"4-\u7EBF\u7A0B\u7684\u751F\u547D\u5468\u671F\u5728-java-\u4E2D\u662F\u5982\u4F55\u5B9A\u4E49\u7684",level:3},{value:"5. Java \u4E2D\u7EBF\u7A0B\u4E4B\u95F4\u5982\u4F55\u8FDB\u884C\u901A\u4FE1\uFF1F",id:"5-java-\u4E2D\u7EBF\u7A0B\u4E4B\u95F4\u5982\u4F55\u8FDB\u884C\u901A\u4FE1",level:3},{value:"6. Java \u4E2D\u5982\u4F55\u521B\u5EFA\u591A\u7EBF\u7A0B\uFF1F",id:"6-java-\u4E2D\u5982\u4F55\u521B\u5EFA\u591A\u7EBF\u7A0B",level:3},{value:"7. \u4F60\u4E86\u89E3 Java \u7EBF\u7A0B\u6C60\u7684\u539F\u7406\u5417\uFF1F",id:"7-\u4F60\u4E86\u89E3-java-\u7EBF\u7A0B\u6C60\u7684\u539F\u7406\u5417",level:3},{value:"8. \u5982\u4F55\u5408\u7406\u5730\u8BBE\u7F6E Java \u7EBF\u7A0B\u6C60\u7684\u7EBF\u7A0B\u6570\uFF1F",id:"8-\u5982\u4F55\u5408\u7406\u5730\u8BBE\u7F6E-java-\u7EBF\u7A0B\u6C60\u7684\u7EBF\u7A0B\u6570",level:3},{value:"9. Java \u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u62D2\u7EDD\u7B56\u7565\uFF1F",id:"9-java-\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u62D2\u7EDD\u7B56\u7565",level:3},{value:"10. Java \u5E76\u53D1\u5E93\u4E2D\u63D0\u4F9B\u4E86\u54EA\u4E9B\u7EBF\u7A0B\u6C60\u5B9E\u73B0\uFF1F\u5B83\u4EEC\u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"10-java-\u5E76\u53D1\u5E93\u4E2D\u63D0\u4F9B\u4E86\u54EA\u4E9B\u7EBF\u7A0B\u6C60\u5B9E\u73B0\u5B83\u4EEC\u6709\u4EC0\u4E48\u533A\u522B",level:3},{value:"11. Java \u7EBF\u7A0B\u6C60\u6838\u5FC3\u7EBF\u7A0B\u6570\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u80FD\u4FEE\u6539\u5417\uFF1F\u5982\u4F55\u4FEE\u6539\uFF1F",id:"11-java-\u7EBF\u7A0B\u6C60\u6838\u5FC3\u7EBF\u7A0B\u6570\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u80FD\u4FEE\u6539\u5417\u5982\u4F55\u4FEE\u6539",level:3},{value:"12. \u7EBF\u7A0B\u6C60\u4E2D shutdown \u4E0E shutdownNow \u7684\u533A\u522B\u662F\u4EC0\u4E48\uFF1F",id:"12-\u7EBF\u7A0B\u6C60\u4E2D-shutdown-\u4E0E-shutdownnow-\u7684\u533A\u522B\u662F\u4EC0\u4E48",level:3},{value:"13. \u7EBF\u7A0B\u6C60\u5185\u90E8\u4EFB\u52A1\u51FA\u5F02\u5E38\u540E\uFF0C\u5982\u4F55\u77E5\u9053\u662F\u54EA\u4E2A\u7EBF\u7A0B\u51FA\u4E86\u5F02\u5E38\uFF1F",id:"13-\u7EBF\u7A0B\u6C60\u5185\u90E8\u4EFB\u52A1\u51FA\u5F02\u5E38\u540E\u5982\u4F55\u77E5\u9053\u662F\u54EA\u4E2A\u7EBF\u7A0B\u51FA\u4E86\u5F02\u5E38",level:3},{value:"14. Java \u4E2D\u7684 DelayQueue \u548C ScheduledThreadPool \u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"14-java-\u4E2D\u7684-delayqueue-\u548C-scheduledthreadpool-\u6709\u4EC0\u4E48\u533A\u522B",level:3},{value:"15. \u4EC0\u4E48\u662F Java \u7684 Timer\uFF1F",id:"15-\u4EC0\u4E48\u662F-java-\u7684-timer",level:3},{value:"16. \u4F60\u4E86\u89E3\u65F6\u95F4\u8F6E\uFF08Time Wheel\uFF09\u5417\uFF1F\u6709\u54EA\u4E9B\u5E94\u7528\u573A\u666F\uFF1F",id:"16-\u4F60\u4E86\u89E3\u65F6\u95F4\u8F6Etime-wheel\u5417\u6709\u54EA\u4E9B\u5E94\u7528\u573A\u666F",level:3},{value:"17. \u4F60\u4F7F\u7528\u8FC7\u54EA\u4E9B Java \u5E76\u53D1\u5DE5\u5177\u7C7B\uFF1F",id:"17-\u4F60\u4F7F\u7528\u8FC7\u54EA\u4E9B-java-\u5E76\u53D1\u5DE5\u5177\u7C7B",level:3},{value:"18. \u4EC0\u4E48\u662F Java \u7684 Semaphore\uFF1F",id:"18-\u4EC0\u4E48\u662F-java-\u7684-semaphore",level:3},{value:"19. \u4EC0\u4E48\u662F Java \u7684 CyclicBarrier\uFF1F",id:"19-\u4EC0\u4E48\u662F-java-\u7684-cyclicbarrier",level:3},{value:"20. \u4EC0\u4E48\u662F Java \u7684 CountDownLatch\uFF1F",id:"20-\u4EC0\u4E48\u662F-java-\u7684-countdownlatch",level:3},{value:"21. \u4EC0\u4E48\u662F Java \u7684 StampedLock\uFF1F",id:"21-\u4EC0\u4E48\u662F-java-\u7684-stampedlock",level:3},{value:"22. \u4EC0\u4E48\u662F Java \u7684 CompletableFuture\uFF1F",id:"22-\u4EC0\u4E48\u662F-java-\u7684-completablefuture",level:3},{value:"23. \u4EC0\u4E48\u662F Java \u7684 ForkJoinPool\uFF1F",id:"23-\u4EC0\u4E48\u662F-java-\u7684-forkjoinpool",level:3},{value:"24. \u5982\u4F55\u5728 Java \u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F\uFF1F",id:"24-\u5982\u4F55\u5728-java-\u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F",level:3},{value:"25. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217\uFF1F",id:"25-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217",level:3},{value:"26. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B\uFF1F",id:"26-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B",level:3},{value:"27. \u4F60\u4F7F\u7528\u8FC7 Java \u7684\u7D2F\u52A0\u5668\u5417\uFF1F",id:"27-\u4F60\u4F7F\u7528\u8FC7-java-\u7684\u7D2F\u52A0\u5668\u5417",level:3},{value:"28. \u4EC0\u4E48\u662F Java \u7684 CAS\uFF08Compare-And-Swap\uFF09\u64CD\u4F5C\uFF1F",id:"28-\u4EC0\u4E48\u662F-java-\u7684-cascompare-and-swap\u64CD\u4F5C",level:3},{value:"29. \u8BF4\u8BF4 AQS \u5427\uFF1F",id:"29-\u8BF4\u8BF4-aqs-\u5427",level:3},{value:"30. Java \u4E2D ReentrantLock \u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F",id:"30-java-\u4E2D-reentrantlock-\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48",level:3},{value:"31. Java \u7684 synchronized \u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F",id:"31-java-\u7684-synchronized-\u662F\u600E\u4E48\u5B9E\u73B0\u7684",level:3},{value:"32. Synchronized \u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"32-synchronized-\u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B",level:3},{value:"33. Java \u4E2D\u7684 synchronized \u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB\uFF1F",id:"33-java-\u4E2D\u7684-synchronized-\u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB",level:3},{value:"34. Synchronized \u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\uFF1F",id:"34-synchronized-\u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F",level:3},{value:"35. \u5F53 Java \u7684 synchronized \u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\uFF0C\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\uFF0C\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417\uFF1F",id:"35-\u5F53-java-\u7684-synchronized-\u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417",level:3},{value:"36. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB\uFF1F",id:"36-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB",level:3},{value:"37. Synchronized \u548C ReentrantLock \u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"37-synchronized-\u548C-reentrantlock-\u6709\u4EC0\u4E48\u533A\u522B",level:3},{value:"38. Volatile \u4E0E Synchronized \u7684\u533A\u522B\u662F\u4EC0\u4E48\uFF1F",id:"38-volatile-\u4E0E-synchronized-\u7684\u533A\u522B\u662F\u4EC0\u4E48",level:3},{value:"39. \u5982\u4F55\u4F18\u5316 Java \u4E2D\u7684\u9501\u7684\u4F7F\u7528\uFF1F",id:"39-\u5982\u4F55\u4F18\u5316-java-\u4E2D\u7684\u9501\u7684\u4F7F\u7528",level:3},{value:"40. \u4F60\u4E86\u89E3 Java \u4E2D\u7684\u8BFB\u5199\u9501\u5417\uFF1F",id:"40-\u4F60\u4E86\u89E3-java-\u4E2D\u7684\u8BFB\u5199\u9501\u5417",level:3},{value:"41. \u4EC0\u4E48\u662F Java \u5185\u5B58\u6A21\u578B\uFF08JMM\uFF09\uFF1F",id:"41-\u4EC0\u4E48\u662F-java-\u5185\u5B58\u6A21\u578Bjmm",level:3},{value:"42. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF1F",id:"42-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u539F\u5B50\u6027\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027",level:3},{value:"43. \u4EC0\u4E48\u662F Java \u7684 happens-before \u89C4\u5219\uFF1F",id:"43-\u4EC0\u4E48\u662F-java-\u7684-happens-before-\u89C4\u5219",level:3},{value:"44. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u6307\u4EE4\u91CD\u6392\uFF1F",id:"44-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u6307\u4EE4\u91CD\u6392",level:3},{value:"45. Java \u4E2D\u7684 final \u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027\uFF1F",id:"45-java-\u4E2D\u7684-final-\u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027",level:3},{value:"46. \u4E3A\u4EC0\u4E48\u5728 Java \u4E2D\u9700\u8981\u4F7F\u7528 ThreadLocal\uFF1F",id:"46-\u4E3A\u4EC0\u4E48\u5728-java-\u4E2D\u9700\u8981\u4F7F\u7528-threadlocal",level:3},{value:"47. Java \u4E2D\u7684 ThreadLocal \u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684\uFF1F",id:"47-java-\u4E2D\u7684-threadlocal-\u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684",level:3},{value:"48. \u4E3A\u4EC0\u4E48 Java \u4E2D\u7684 ThreadLocal \u5BF9 key \u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528\uFF1F",id:"48-\u4E3A\u4EC0\u4E48-java-\u4E2D\u7684-threadlocal-\u5BF9-key-\u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528",level:3},{value:"49. Java \u4E2D\u4F7F\u7528 ThreadLocal \u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48\uFF1F",id:"49-java-\u4E2D\u4F7F\u7528-threadlocal-\u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48",level:3},{value:"50. Java \u4E2D\u7684 InheritableThreadLocal \u662F\u4EC0\u4E48\uFF1F",id:"50-java-\u4E2D\u7684-inheritablethreadlocal-\u662F\u4EC0\u4E48",level:3},{value:"51. ThreadLocal \u7684\u7F3A\u70B9\uFF1F",id:"51-threadlocal-\u7684\u7F3A\u70B9",level:3},{value:"52. \u4E3A\u4EC0\u4E48 Netty \u4E0D\u4F7F\u7528 ThreadLocal \u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A FastThreadLocal \uFF1F",id:"52-\u4E3A\u4EC0\u4E48-netty-\u4E0D\u4F7F\u7528-threadlocal-\u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A-fastthreadlocal-",level:3},{value:"53. \u4EC0\u4E48\u662F Java \u7684 TransmittableThreadLocal\uFF1F",id:"53-\u4EC0\u4E48\u662F-java-\u7684-transmittablethreadlocal",level:3},{value:"54. Java \u4E2D Thread.sleep \u548C Thread.yield \u7684\u533A\u522B\uFF1F",id:"54-java-\u4E2D-threadsleep-\u548C-threadyield-\u7684\u533A\u522B",level:3},{value:"55. Java \u4E2D Thread.sleep(0) \u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F",id:"55-java-\u4E2D-threadsleep0-\u7684\u4F5C\u7528\u662F\u4EC0\u4E48",level:3},{value:"56. Java \u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\uFF1F\u5982\u4F55\u907F\u514D\uFF1F",id:"56-java-\u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\u5982\u4F55\u907F\u514D",level:3},{value:"57. Java \u4E2D volatile \u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F",id:"57-java-\u4E2D-volatile-\u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48",level:3},{value:"58. \u4EC0\u4E48\u662F Java \u4E2D\u7684 ABA \u95EE\u9898\uFF1F",id:"58-\u4EC0\u4E48\u662F-java-\u4E2D\u7684-aba-\u95EE\u9898",level:3},{value:"59. \u5728 Java \u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F\uFF1F",id:"59-\u5728-java-\u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F",level:3},{value:"60. \u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F",id:"60-\u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F",level:3},{value:"61. \u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B?",id:"61-\u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B",level:3},{value:"62. Java \u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F",id:"62-java-\u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F",level:3},{value:"\u5B66\u4E60\u6307\u5357",id:"\u5B66\u4E60\u6307\u5357",level:2},{value:"21. \u4EC0\u4E48\u662F Java \u7684 StampedLock\uFF1F",id:"21-\u4EC0\u4E48\u662F-java-\u7684-stampedlock-1",level:3},{value:"22. \u4EC0\u4E48\u662F Java \u7684 CompletableFuture\uFF1F",id:"22-\u4EC0\u4E48\u662F-java-\u7684-completablefuture-1",level:3},{value:"23. \u4EC0\u4E48\u662F Java \u7684 ForkJoinPool\uFF1F",id:"23-\u4EC0\u4E48\u662F-java-\u7684-forkjoinpool-1",level:3},{value:"24. \u5982\u4F55\u5728 Java \u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F\uFF1F",id:"24-\u5982\u4F55\u5728-java-\u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F-1",level:3},{value:"25. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217\uFF1F",id:"25-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217-1",level:3},{value:"26. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B\uFF1F",id:"26-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B-1",level:3},{value:"27. \u4F60\u4F7F\u7528\u8FC7 Java \u7684\u7D2F\u52A0\u5668\u5417\uFF1F",id:"27-\u4F60\u4F7F\u7528\u8FC7-java-\u7684\u7D2F\u52A0\u5668\u5417-1",level:3},{value:"28. \u4EC0\u4E48\u662F Java \u7684 CAS\uFF08Compare-And-Swap\uFF09\u64CD\u4F5C\uFF1F",id:"28-\u4EC0\u4E48\u662F-java-\u7684-cascompare-and-swap\u64CD\u4F5C-1",level:3},{value:"29. \u8BF4\u8BF4 AQS \u5427\uFF1F",id:"29-\u8BF4\u8BF4-aqs-\u5427-1",level:3},{value:"30. Java \u4E2D ReentrantLock \u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F",id:"30-java-\u4E2D-reentrantlock-\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48-1",level:3},{value:"31. Java \u7684 synchronized \u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F",id:"31-java-\u7684-synchronized-\u662F\u600E\u4E48\u5B9E\u73B0\u7684-1",level:3},{value:"32. Synchronized \u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"32-synchronized-\u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B-1",level:3},{value:"33. Java \u4E2D\u7684 synchronized \u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB\uFF1F",id:"33-java-\u4E2D\u7684-synchronized-\u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB-1",level:3},{value:"34. Synchronized \u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\uFF1F",id:"34-synchronized-\u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F-1",level:3},{value:"35. \u5F53 Java \u7684 synchronized \u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\uFF0C\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\uFF0C\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417\uFF1F",id:"35-\u5F53-java-\u7684-synchronized-\u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417-1",level:3},{value:"36. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB\uFF1F",id:"36-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB-1",level:3},{value:"37. Synchronized \u548C ReentrantLock \u6709\u4EC0\u4E48\u533A\u522B\uFF1F",id:"37-synchronized-\u548C-reentrantlock-\u6709\u4EC0\u4E48\u533A\u522B-1",level:3},{value:"38. Volatile \u4E0E Synchronized \u7684\u533A\u522B\u662F\u4EC0\u4E48\uFF1F",id:"38-volatile-\u4E0E-synchronized-\u7684\u533A\u522B\u662F\u4EC0\u4E48-1",level:3},{value:"39. \u5982\u4F55\u4F18\u5316 Java \u4E2D\u7684\u9501\u7684\u4F7F\u7528\uFF1F",id:"39-\u5982\u4F55\u4F18\u5316-java-\u4E2D\u7684\u9501\u7684\u4F7F\u7528-1",level:3},{value:"40. \u4F60\u4E86\u89E3 Java \u4E2D\u7684\u8BFB\u5199\u9501\u5417\uFF1F",id:"40-\u4F60\u4E86\u89E3-java-\u4E2D\u7684\u8BFB\u5199\u9501\u5417-1",level:3},{value:"41. \u4EC0\u4E48\u662F Java \u5185\u5B58\u6A21\u578B\uFF08JMM\uFF09\uFF1F",id:"41-\u4EC0\u4E48\u662F-java-\u5185\u5B58\u6A21\u578Bjmm-1",level:3},{value:"42. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF1F",id:"42-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u539F\u5B50\u6027\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027-1",level:3},{value:"43. \u4EC0\u4E48\u662F Java \u7684 happens-before \u89C4\u5219\uFF1F",id:"43-\u4EC0\u4E48\u662F-java-\u7684-happens-before-\u89C4\u5219-1",level:3},{value:"44. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u6307\u4EE4\u91CD\u6392\uFF1F",id:"44-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u6307\u4EE4\u91CD\u6392-1",level:3},{value:"45. Java \u4E2D\u7684 final \u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027\uFF1F",id:"45-java-\u4E2D\u7684-final-\u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027-1",level:3},{value:"46. \u4E3A\u4EC0\u4E48\u5728 Java \u4E2D\u9700\u8981\u4F7F\u7528 ThreadLocal\uFF1F",id:"46-\u4E3A\u4EC0\u4E48\u5728-java-\u4E2D\u9700\u8981\u4F7F\u7528-threadlocal-1",level:3},{value:"47. Java \u4E2D\u7684 ThreadLocal \u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684\uFF1F",id:"47-java-\u4E2D\u7684-threadlocal-\u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684-1",level:3},{value:"48. \u4E3A\u4EC0\u4E48 Java \u4E2D\u7684 ThreadLocal \u5BF9 key \u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528\uFF1F",id:"48-\u4E3A\u4EC0\u4E48-java-\u4E2D\u7684-threadlocal-\u5BF9-key-\u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528-1",level:3},{value:"49. Java \u4E2D\u4F7F\u7528 ThreadLocal \u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48\uFF1F",id:"49-java-\u4E2D\u4F7F\u7528-threadlocal-\u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48-1",level:3},{value:"50. Java \u4E2D\u7684 InheritableThreadLocal \u662F\u4EC0\u4E48\uFF1F",id:"50-java-\u4E2D\u7684-inheritablethreadlocal-\u662F\u4EC0\u4E48-1",level:3},{value:"51. ThreadLocal \u7684\u7F3A\u70B9\uFF1F",id:"51-threadlocal-\u7684\u7F3A\u70B9-1",level:3},{value:"52. \u4E3A\u4EC0\u4E48 Netty \u4E0D\u4F7F\u7528 ThreadLocal \u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A FastThreadLocal\uFF1F",id:"52-\u4E3A\u4EC0\u4E48-netty-\u4E0D\u4F7F\u7528-threadlocal-\u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A-fastthreadlocal",level:3},{value:"53. \u4EC0\u4E48\u662F Java \u7684 TransmittableThreadLocal\uFF1F",id:"53-\u4EC0\u4E48\u662F-java-\u7684-transmittablethreadlocal-1",level:3},{value:"54. Java \u4E2D Thread.sleep \u548C Thread.yield \u7684\u533A\u522B\uFF1F",id:"54-java-\u4E2D-threadsleep-\u548C-threadyield-\u7684\u533A\u522B-1",level:3},{value:"55. Java \u4E2D Thread.sleep(0) \u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F",id:"55-java-\u4E2D-threadsleep0-\u7684\u4F5C\u7528\u662F\u4EC0\u4E48-1",level:3},{value:"56. Java \u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\uFF1F\u5982\u4F55\u907F\u514D\uFF1F",id:"56-java-\u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\u5982\u4F55\u907F\u514D-1",level:3},{value:"57. Java \u4E2D volatile \u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F",id:"57-java-\u4E2D-volatile-\u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48-1",level:3},{value:"58. \u4EC0\u4E48\u662F Java \u4E2D\u7684 ABA \u95EE\u9898\uFF1F",id:"58-\u4EC0\u4E48\u662F-java-\u4E2D\u7684-aba-\u95EE\u9898-1",level:3},{value:"59. \u5728 Java \u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F\uFF1F",id:"59-\u5728-java-\u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F-1",level:3},{value:"60. \u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F",id:"60-\u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F-1",level:3},{value:"61. \u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B\uFF1F",id:"61-\u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B-1",level:3},{value:"62. Java \u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F",id:"62-java-\u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F-1",level:3},{value:"\u603B\u7ED3",id:"\u603B\u7ED3",level:2}];function h(n){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"java-\u5E76\u53D1\u9762\u8BD5\u9898\u96C6",children:"Java \u5E76\u53D1\u9762\u8BD5\u9898\u96C6"})}),"\n",(0,i.jsxs)(e.blockquote,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u603B\u9898\u6570"}),": 62\u9053 |  ",(0,i.jsx)(e.strong,{children:"\u91CD\u70B9\u9886\u57DF"}),": \u7EBF\u7A0B\u3001\u9501\u3001\u5E76\u53D1\u5BB9\u5668\u3001JMM |  ",(0,i.jsx)(e.strong,{children:"\u96BE\u5EA6\u5206\u5E03"}),": \u4E2D\u7EA7\u5230\u9AD8\u7EA7"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u672C\u6587\u6863\u6574\u7406\u4E86 Java \u5E76\u53D1\u7684\u5B8C\u657462\u9053\u9762\u8BD5\u9898\u76EE\uFF0C\u6DB5\u76D6\u7EBF\u7A0B\u57FA\u7840\u3001\u9501\u673A\u5236\u3001\u5E76\u53D1\u5BB9\u5668\u3001\u5185\u5B58\u6A21\u578B\u7B49\u5404\u4E2A\u65B9\u9762\u3002"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u9762\u8BD5\u9898\u76EE\u5217\u8868",children:"\u9762\u8BD5\u9898\u76EE\u5217\u8868"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u7EBF\u7A0B\u540C\u6B65",children:"1. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u7EBF\u7A0B\u540C\u6B65\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u7EBF\u7A0B\u540C\u6B65\u662F\u6307\u534F\u8C03\u591A\u4E2A\u7EBF\u7A0B\u5BF9\u5171\u4EAB\u8D44\u6E90\u7684\u8BBF\u95EE\uFF0C\u786E\u4FDD\u5728\u540C\u4E00\u65F6\u523B\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u80FD\u591F\u8BBF\u95EE\u7279\u5B9A\u7684\u8D44\u6E90\uFF0C\u4ECE\u800C\u907F\u514D\u6570\u636E\u4E0D\u4E00\u81F4\u548C\u7ADE\u6001\u6761\u4EF6\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E3B\u8981\u540C\u6B65\u673A\u5236\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"synchronized \u5173\u952E\u5B57"}),"\uFF1A\u63D0\u4F9B\u4E92\u65A5\u9501\u673A\u5236"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Lock \u63A5\u53E3"}),"\uFF1A\u63D0\u4F9B\u66F4\u7075\u6D3B\u7684\u9501\u64CD\u4F5C\uFF08ReentrantLock\u3001ReadWriteLock\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"volatile \u5173\u952E\u5B57"}),"\uFF1A\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"wait/notify \u673A\u5236"}),"\uFF1A\u7EBF\u7A0B\u95F4\u7684\u534F\u4F5C\u901A\u4FE1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5E76\u53D1\u5DE5\u5177\u7C7B"}),"\uFF1ASemaphore\u3001CountDownLatch\u3001CyclicBarrier \u7B49"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized \u540C\u6B65\u793A\u4F8B\npublic class Counter {\n    private int count = 0;\n    \n    public synchronized void increment() {\n        count++;\n    }\n    \n    public synchronized int getCount() {\n        return count;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-java-\u4E2D\u7684\u7EBF\u7A0B\u5B89\u5168\u662F\u4EC0\u4E48\u610F\u601D",children:"2. Java \u4E2D\u7684\u7EBF\u7A0B\u5B89\u5168\u662F\u4EC0\u4E48\u610F\u601D\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u7EBF\u7A0B\u5B89\u5168\u662F\u6307\u5F53\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BBF\u95EE\u67D0\u4E2A\u7C7B\u3001\u5BF9\u8C61\u6216\u65B9\u6CD5\u65F6\uFF0C\u8FD9\u4E2A\u7C7B\u3001\u5BF9\u8C61\u6216\u65B9\u6CD5\u59CB\u7EC8\u80FD\u8868\u73B0\u51FA\u6B63\u786E\u7684\u884C\u4E3A\uFF0C\u4E0D\u4F1A\u51FA\u73B0\u6570\u636E\u4E0D\u4E00\u81F4\u6216\u4E0D\u53EF\u9884\u671F\u7684\u7ED3\u679C\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u5B89\u5168\u7684\u5B9E\u73B0\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E92\u65A5\u540C\u6B65\uFF08\u60B2\u89C2\u9501\uFF09"}),"\uFF1Asynchronized\u3001ReentrantLock"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u975E\u963B\u585E\u540C\u6B65\uFF08\u4E50\u89C2\u9501\uFF09"}),"\uFF1ACAS \u64CD\u4F5C\u3001\u539F\u5B50\u7C7B"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u65E0\u540C\u6B65\u65B9\u6848"}),"\uFF1A","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6808\u5C01\u95ED\uFF08\u5C40\u90E8\u53D8\u91CF\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"ThreadLocal"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u53EF\u53D8\u5BF9\u8C61\uFF08final\u3001String\uFF09"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u5B89\u5168\u7EA7\u522B\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E0D\u53EF\u53D8"}),"\uFF1AString\u3001Integer \u7B49"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EDD\u5BF9\u7EBF\u7A0B\u5B89\u5168"}),"\uFF1A\u6240\u6709\u64CD\u4F5C\u90FD\u662F\u7EBF\u7A0B\u5B89\u5168\u7684"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u76F8\u5BF9\u7EBF\u7A0B\u5B89\u5168"}),"\uFF1A\u5355\u6B21\u64CD\u4F5C\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\uFF0C\u5982 Vector\u3001HashTable"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u517C\u5BB9"}),"\uFF1A\u9700\u8981\u5916\u90E8\u540C\u6B65\uFF0C\u5982 ArrayList\u3001HashMap"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u5BF9\u7ACB"}),"\uFF1A\u65E0\u6CD5\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4F7F\u7528"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B\u5B89\u5168\u7684\u5355\u4F8B\u6A21\u5F0F\npublic class Singleton {\n    private static volatile Singleton instance;\n    \n    private Singleton() {}\n    \n    public static Singleton getInstance() {\n        if (instance == null) {\n            synchronized (Singleton.class) {\n                if (instance == null) {\n                    instance = new Singleton();\n                }\n            }\n        }\n        return instance;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u4EC0\u4E48\u662F\u534F\u7A0Bjava-\u652F\u6301\u534F\u7A0B\u5417",children:"3. \u4EC0\u4E48\u662F\u534F\u7A0B\uFF1FJava \u652F\u6301\u534F\u7A0B\u5417\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u534F\u7A0B\uFF08Coroutine\uFF09"})," \u662F\u4E00\u79CD\u8F7B\u91CF\u7EA7\u7684\u7528\u6237\u6001\u7EBF\u7A0B\uFF0C\u7531\u7A0B\u5E8F\u81EA\u5DF1\u63A7\u5236\u8C03\u5EA6\uFF0C\u4E0D\u9700\u8981\u64CD\u4F5C\u7CFB\u7EDF\u5185\u6838\u53C2\u4E0E\u3002\u534F\u7A0B\u7684\u5207\u6362\u5F00\u9500\u8FDC\u5C0F\u4E8E\u7EBF\u7A0B\u5207\u6362\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u534F\u7A0B\u7684\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8F7B\u91CF\u7EA7\uFF1A\u5360\u7528\u5185\u5B58\u5C0F\uFF0C\u521B\u5EFA\u9500\u6BC1\u5FEB"}),"\n",(0,i.jsx)(e.li,{children:"\u7528\u6237\u6001\u8C03\u5EA6\uFF1A\u4E0D\u9700\u8981\u5185\u6838\u6001\u5207\u6362"}),"\n",(0,i.jsx)(e.li,{children:"\u534F\u4F5C\u5F0F\u8C03\u5EA6\uFF1A\u7531\u7A0B\u5E8F\u63A7\u5236\u4F55\u65F6\u6302\u8D77\u548C\u6062\u590D"}),"\n",(0,i.jsx)(e.li,{children:"\u9AD8\u5E76\u53D1\uFF1A\u53EF\u4EE5\u521B\u5EFA\u5927\u91CF\u534F\u7A0B"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Java \u5BF9\u534F\u7A0B\u7684\u652F\u6301\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u4F20\u7EDF Java\uFF08Java 8-18\uFF09\u4E0D\u76F4\u63A5\u652F\u6301\u534F\u7A0B\uFF0C\u4F46\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u65B9\u5F0F\u5B9E\u73B0\u7C7B\u4F3C\u529F\u80FD\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Quasar \u5E93"}),"\uFF1A\u63D0\u4F9B Fiber\uFF08\u7EA4\u7A0B\uFF09\u5B9E\u73B0"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Kotlin \u534F\u7A0B"}),"\uFF1A\u5728 JVM \u4E0A\u8FD0\u884C\u7684\u534F\u7A0B"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Project Loom"}),"\uFF1AJava 19+ \u5F15\u5165\u7684\u865A\u62DF\u7EBF\u7A0B\uFF08Virtual Threads\uFF09"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Java 19+ \u865A\u62DF\u7EBF\u7A0B\u793A\u4F8B\ntry (var executor = Executors.newVirtualThreadPerTaskExecutor()) {\n    IntStream.range(0, 10_000).forEach(i -> {\n        executor.submit(() -> {\n            Thread.sleep(Duration.ofSeconds(1));\n            return i;\n        });\n    });\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u7EBF\u7A0B\u7684\u751F\u547D\u5468\u671F\u5728-java-\u4E2D\u662F\u5982\u4F55\u5B9A\u4E49\u7684",children:"4. \u7EBF\u7A0B\u7684\u751F\u547D\u5468\u671F\u5728 Java \u4E2D\u662F\u5982\u4F55\u5B9A\u4E49\u7684\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsxs)(e.p,{children:["Java \u7EBF\u7A0B\u6709 6 \u79CD\u72B6\u6001\uFF0C\u5B9A\u4E49\u5728 ",(0,i.jsx)(e.code,{children:"Thread.State"})," \u679A\u4E3E\u4E2D\uFF1A"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. NEW\uFF08\u65B0\u5EFA\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u88AB\u521B\u5EFA\u4F46\u8FD8\u672A\u8C03\u7528 start() \u65B9\u6CD5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. RUNNABLE\uFF08\u53EF\u8FD0\u884C\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8C03\u7528 start() \u540E\uFF0C\u7EBF\u7A0B\u53EF\u80FD\u6B63\u5728\u8FD0\u884C\u6216\u7B49\u5F85 CPU \u65F6\u95F4\u7247"}),"\n",(0,i.jsx)(e.li,{children:"\u5305\u542B\u64CD\u4F5C\u7CFB\u7EDF\u7684 Ready \u548C Running \u72B6\u6001"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. BLOCKED\uFF08\u963B\u585E\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u7B49\u5F85\u83B7\u53D6\u76D1\u89C6\u5668\u9501\uFF08synchronized\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. WAITING\uFF08\u7B49\u5F85\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u65E0\u9650\u671F\u7B49\u5F85\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\u7279\u5B9A\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u89E6\u53D1\u6761\u4EF6\uFF1AObject.wait()\u3001Thread.join()\u3001LockSupport.park()"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. TIMED_WAITING\uFF08\u8BA1\u65F6\u7B49\u5F85\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B49\u5F85\u6307\u5B9A\u65F6\u95F4\u540E\u81EA\u52A8\u8FD4\u56DE"}),"\n",(0,i.jsx)(e.li,{children:"\u89E6\u53D1\u6761\u4EF6\uFF1AThread.sleep()\u3001Object.wait(timeout)\u3001Thread.join(timeout)"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. TERMINATED\uFF08\u7EC8\u6B62\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u6267\u884C\u5B8C\u6210\u6216\u5F02\u5E38\u9000\u51FA"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u72B6\u6001\u8F6C\u6362\u793A\u4F8B\npublic class ThreadStateDemo {\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread = new Thread(() -> {\n            try {\n                Thread.sleep(1000); // TIMED_WAITING\n                synchronized (ThreadStateDemo.class) {\n                    ThreadStateDemo.class.wait(); // WAITING\n                }\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n        \n        System.out.println("NEW: " + thread.getState()); // NEW\n        thread.start();\n        Thread.sleep(100);\n        System.out.println("RUNNABLE: " + thread.getState()); // RUNNABLE\n        Thread.sleep(1000);\n        System.out.println("TIMED_WAITING: " + thread.getState()); // TIMED_WAITING\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"5-java-\u4E2D\u7EBF\u7A0B\u4E4B\u95F4\u5982\u4F55\u8FDB\u884C\u901A\u4FE1",children:"5. Java \u4E2D\u7EBF\u7A0B\u4E4B\u95F4\u5982\u4F55\u8FDB\u884C\u901A\u4FE1\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u63D0\u4F9B\u4E86\u591A\u79CD\u7EBF\u7A0B\u95F4\u901A\u4FE1\u673A\u5236\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. wait/notify/notifyAll \u673A\u5236"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class WaitNotifyDemo {\n    private static final Object lock = new Object();\n    \n    public void producer() throws InterruptedException {\n        synchronized (lock) {\n            System.out.println("\u751F\u4EA7\u6570\u636E");\n            lock.notify(); // \u5524\u9192\u7B49\u5F85\u7EBF\u7A0B\n        }\n    }\n    \n    public void consumer() throws InterruptedException {\n        synchronized (lock) {\n            lock.wait(); // \u7B49\u5F85\u901A\u77E5\n            System.out.println("\u6D88\u8D39\u6570\u636E");\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. volatile \u5171\u4EAB\u53D8\u91CF"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"private volatile boolean flag = false;\n\n// \u7EBF\u7A0B1\nflag = true;\n\n// \u7EBF\u7A0B2\nwhile (!flag) {\n    // \u7B49\u5F85\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. CountDownLatch"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"CountDownLatch latch = new CountDownLatch(3);\n// \u7EBF\u7A0B\u5B8C\u6210\u540E\u8C03\u7528\nlatch.countDown();\n// \u4E3B\u7EBF\u7A0B\u7B49\u5F85\nlatch.await();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. CyclicBarrier"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CyclicBarrier barrier = new CyclicBarrier(3, () -> {\n    System.out.println("\u6240\u6709\u7EBF\u7A0B\u5230\u8FBE\u5C4F\u969C");\n});\nbarrier.await();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. Semaphore \u4FE1\u53F7\u91CF"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"Semaphore semaphore = new Semaphore(3);\nsemaphore.acquire(); // \u83B7\u53D6\u8BB8\u53EF\nsemaphore.release(); // \u91CA\u653E\u8BB8\u53EF\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. BlockingQueue \u963B\u585E\u961F\u5217"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'BlockingQueue<String> queue = new LinkedBlockingQueue<>();\nqueue.put("data"); // \u751F\u4EA7\u8005\nString data = queue.take(); // \u6D88\u8D39\u8005\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. Condition \u6761\u4EF6\u53D8\u91CF"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"Lock lock = new ReentrantLock();\nCondition condition = lock.newCondition();\ncondition.await(); // \u7B49\u5F85\ncondition.signal(); // \u5524\u9192\n"})}),"\n",(0,i.jsx)(e.h3,{id:"6-java-\u4E2D\u5982\u4F55\u521B\u5EFA\u591A\u7EBF\u7A0B",children:"6. Java \u4E2D\u5982\u4F55\u521B\u5EFA\u591A\u7EBF\u7A0B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u521B\u5EFA\u7EBF\u7A0B\u6709 4 \u79CD\u4E3B\u8981\u65B9\u5F0F\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7EE7\u627F Thread \u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class MyThread extends Thread {\n    @Override\n    public void run() {\n        System.out.println("Thread running");\n    }\n}\n\n// \u4F7F\u7528\nMyThread thread = new MyThread();\nthread.start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5B9E\u73B0 Runnable \u63A5\u53E3"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class MyRunnable implements Runnable {\n    @Override\n    public void run() {\n        System.out.println("Runnable running");\n    }\n}\n\n// \u4F7F\u7528\nThread thread = new Thread(new MyRunnable());\nthread.start();\n\n// Lambda \u65B9\u5F0F\nnew Thread(() -> System.out.println("Lambda")).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u5B9E\u73B0 Callable \u63A5\u53E3\uFF08\u6709\u8FD4\u56DE\u503C\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class MyCallable implements Callable<String> {\n    @Override\n    public String call() throws Exception {\n        return "Callable result";\n    }\n}\n\n// \u4F7F\u7528\nFutureTask<String> futureTask = new FutureTask<>(new MyCallable());\nnew Thread(futureTask).start();\nString result = futureTask.get(); // \u83B7\u53D6\u8FD4\u56DE\u503C\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F7F\u7528\u7EBF\u7A0B\u6C60"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ExecutorService executor = Executors.newFixedThreadPool(5);\n\n// \u63D0\u4EA4 Runnable\nexecutor.submit(() -> System.out.println("Task"));\n\n// \u63D0\u4EA4 Callable\nFuture<String> future = executor.submit(() -> "Result");\nString result = future.get();\n\nexecutor.shutdown();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u63A8\u8350\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0 Runnable/Callable \u63A5\u53E3\uFF08\u907F\u514D\u5355\u7EE7\u627F\u9650\u5236\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u7EBF\u7A0B\u6C60\uFF08\u66F4\u597D\u7684\u8D44\u6E90\u7BA1\u7406\u548C\u6027\u80FD\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"7-\u4F60\u4E86\u89E3-java-\u7EBF\u7A0B\u6C60\u7684\u539F\u7406\u5417",children:"7. \u4F60\u4E86\u89E3 Java \u7EBF\u7A0B\u6C60\u7684\u539F\u7406\u5417\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u6C60\u6838\u5FC3\u53C2\u6570\uFF08ThreadPoolExecutor\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public ThreadPoolExecutor(\n    int corePoolSize,        // \u6838\u5FC3\u7EBF\u7A0B\u6570\n    int maximumPoolSize,     // \u6700\u5927\u7EBF\u7A0B\u6570\n    long keepAliveTime,      // \u7A7A\u95F2\u7EBF\u7A0B\u5B58\u6D3B\u65F6\u95F4\n    TimeUnit unit,           // \u65F6\u95F4\u5355\u4F4D\n    BlockingQueue<Runnable> workQueue,  // \u4EFB\u52A1\u961F\u5217\n    ThreadFactory threadFactory,        // \u7EBF\u7A0B\u5DE5\u5382\n    RejectedExecutionHandler handler    // \u62D2\u7EDD\u7B56\u7565\n)\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6267\u884C\u6D41\u7A0B\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u63D0\u4EA4\u4EFB\u52A1\u65F6\uFF0C\u5982\u679C\u7EBF\u7A0B\u6570 < corePoolSize\uFF0C\u521B\u5EFA\u65B0\u7EBF\u7A0B\u6267\u884C"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u7EBF\u7A0B\u6570 >= corePoolSize\uFF0C\u4EFB\u52A1\u653E\u5165\u961F\u5217"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u961F\u5217\u6EE1\u4E86\u4E14\u7EBF\u7A0B\u6570 < maximumPoolSize\uFF0C\u521B\u5EFA\u65B0\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u7EBF\u7A0B\u6570 >= maximumPoolSize \u4E14\u961F\u5217\u6EE1\u4E86\uFF0C\u6267\u884C\u62D2\u7EDD\u7B56\u7565"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u63D0\u4EA4\u4EFB\u52A1\n   \u2193\n\u7EBF\u7A0B\u6570 < corePoolSize? \u2192 \u662F \u2192 \u521B\u5EFA\u6838\u5FC3\u7EBF\u7A0B\u6267\u884C\n   \u2193 \u5426\n\u961F\u5217\u672A\u6EE1? \u2192 \u662F \u2192 \u52A0\u5165\u961F\u5217\u7B49\u5F85\n   \u2193 \u5426\n\u7EBF\u7A0B\u6570 < maximumPoolSize? \u2192 \u662F \u2192 \u521B\u5EFA\u975E\u6838\u5FC3\u7EBF\u7A0B\u6267\u884C\n   \u2193 \u5426\n\u6267\u884C\u62D2\u7EDD\u7B56\u7565\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ThreadPoolExecutor executor = new ThreadPoolExecutor(\n    5,                          // \u6838\u5FC3\u7EBF\u7A0B\u6570\n    10,                         // \u6700\u5927\u7EBF\u7A0B\u6570\n    60L,                        // \u7A7A\u95F2\u7EBF\u7A0B\u5B58\u6D3B\u65F6\u95F4\n    TimeUnit.SECONDS,\n    new LinkedBlockingQueue<>(100),  // \u961F\u5217\u5BB9\u91CF\n    Executors.defaultThreadFactory(),\n    new ThreadPoolExecutor.AbortPolicy()  // \u62D2\u7EDD\u7B56\u7565\n);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u6C60\u72B6\u6001\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"RUNNING\uFF1A\u63A5\u53D7\u65B0\u4EFB\u52A1\u5E76\u5904\u7406\u961F\u5217\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"SHUTDOWN\uFF1A\u4E0D\u63A5\u53D7\u65B0\u4EFB\u52A1\uFF0C\u4F46\u5904\u7406\u961F\u5217\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"STOP\uFF1A\u4E0D\u63A5\u53D7\u65B0\u4EFB\u52A1\uFF0C\u4E0D\u5904\u7406\u961F\u5217\u4EFB\u52A1\uFF0C\u4E2D\u65AD\u6B63\u5728\u6267\u884C\u7684\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"TIDYING\uFF1A\u6240\u6709\u4EFB\u52A1\u5DF2\u7EC8\u6B62"}),"\n",(0,i.jsx)(e.li,{children:"TERMINATED\uFF1Aterminated() \u65B9\u6CD5\u6267\u884C\u5B8C\u6210"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"8-\u5982\u4F55\u5408\u7406\u5730\u8BBE\u7F6E-java-\u7EBF\u7A0B\u6C60\u7684\u7EBF\u7A0B\u6570",children:"8. \u5982\u4F55\u5408\u7406\u5730\u8BBE\u7F6E Java \u7EBF\u7A0B\u6C60\u7684\u7EBF\u7A0B\u6570\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u7EBF\u7A0B\u6570\u8BBE\u7F6E\u9700\u8981\u6839\u636E\u4EFB\u52A1\u7C7B\u578B\u548C\u7CFB\u7EDF\u8D44\u6E90\u6765\u51B3\u5B9A\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. CPU \u5BC6\u96C6\u578B\u4EFB\u52A1"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u5927\u91CF\u8BA1\u7B97\uFF0C\u5F88\u5C11 I/O \u64CD\u4F5C"}),"\n",(0,i.jsxs)(e.li,{children:["\u63A8\u8350\u7EBF\u7A0B\u6570\uFF1A",(0,i.jsx)(e.strong,{children:"CPU \u6838\u5FC3\u6570 + 1"})]}),"\n",(0,i.jsx)(e.li,{children:"\u539F\u56E0\uFF1A\u907F\u514D\u8FC7\u591A\u7EBF\u7A0B\u5207\u6362\u5F00\u9500"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"int cpuCount = Runtime.getRuntime().availableProcessors();\nint threadCount = cpuCount + 1;\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. I/O \u5BC6\u96C6\u578B\u4EFB\u52A1"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u5927\u91CF\u7F51\u7EDC\u3001\u78C1\u76D8 I/O \u64CD\u4F5C"}),"\n",(0,i.jsxs)(e.li,{children:["\u63A8\u8350\u7EBF\u7A0B\u6570\uFF1A",(0,i.jsx)(e.strong,{children:"CPU \u6838\u5FC3\u6570 \xd7 2"})," \u6216 ",(0,i.jsx)(e.strong,{children:"CPU \u6838\u5FC3\u6570 / (1 - \u963B\u585E\u7CFB\u6570)"})]}),"\n",(0,i.jsx)(e.li,{children:"\u963B\u585E\u7CFB\u6570\uFF1A0.8-0.9 \u4E4B\u95F4"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"int cpuCount = Runtime.getRuntime().availableProcessors();\n// \u65B9\u5F0F1\nint threadCount = cpuCount * 2;\n\n// \u65B9\u5F0F2\uFF08\u66F4\u7CBE\u786E\uFF09\ndouble blockingCoefficient = 0.9; // I/O \u65F6\u95F4\u5360\u6BD4\nint threadCount = (int) (cpuCount / (1 - blockingCoefficient));\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6DF7\u5408\u578B\u4EFB\u52A1"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF\u4EE5\u62C6\u5206\u4E3A CPU \u5BC6\u96C6\u548C I/O \u5BC6\u96C6\uFF0C\u5206\u522B\u4F7F\u7528\u4E0D\u540C\u7EBF\u7A0B\u6C60"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u5B9E\u9645\u8003\u8651\u56E0\u7D20\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7CFB\u7EDF\u5185\u5B58\u5927\u5C0F\uFF08\u6BCF\u4E2A\u7EBF\u7A0B\u5360\u7528\u5185\u5B58\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4EFB\u52A1\u6267\u884C\u65F6\u95F4"}),"\n",(0,i.jsx)(e.li,{children:"\u4EFB\u52A1\u4F18\u5148\u7EA7"}),"\n",(0,i.jsx)(e.li,{children:"\u7CFB\u7EDF\u8D1F\u8F7D\u60C5\u51B5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u52A8\u6001\u8C03\u6574\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ThreadPoolExecutor executor = new ThreadPoolExecutor(\n    10, 50, 60L, TimeUnit.SECONDS,\n    new LinkedBlockingQueue<>(1000)\n);\n\n// \u8FD0\u884C\u65F6\u52A8\u6001\u8C03\u6574\nexecutor.setCorePoolSize(20);\nexecutor.setMaximumPoolSize(100);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u901A\u8FC7\u538B\u6D4B\u786E\u5B9A\u6700\u4F18\u503C"}),"\n",(0,i.jsx)(e.li,{children:"\u76D1\u63A7\u7EBF\u7A0B\u6C60\u8FD0\u884C\u72B6\u6001\uFF08\u6D3B\u8DC3\u7EBF\u7A0B\u6570\u3001\u961F\u5217\u5927\u5C0F\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u6839\u636E\u5B9E\u9645\u60C5\u51B5\u52A8\u6001\u8C03\u6574"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"9-java-\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u62D2\u7EDD\u7B56\u7565",children:"9. Java \u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u62D2\u7EDD\u7B56\u7565\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u63D0\u4F9B\u4E86 4 \u79CD\u5185\u7F6E\u62D2\u7EDD\u7B56\u7565\uFF08RejectedExecutionHandler\uFF09\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. AbortPolicy\uFF08\u9ED8\u8BA4\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u76F4\u63A5\u629B\u51FA RejectedExecutionException \u5F02\u5E38"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u5173\u952E\u4EFB\u52A1\uFF0C\u4E0D\u5141\u8BB8\u4E22\u5931"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"new ThreadPoolExecutor.AbortPolicy()\n// \u629B\u51FA\u5F02\u5E38\uFF0C\u8C03\u7528\u8005\u9700\u8981\u5904\u7406\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. CallerRunsPolicy"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7531\u8C03\u7528\u7EBF\u7A0B\uFF08\u63D0\u4EA4\u4EFB\u52A1\u7684\u7EBF\u7A0B\uFF09\u6267\u884C\u8BE5\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u4E0D\u5141\u8BB8\u4EFB\u52A1\u4E22\u5931\uFF0C\u4E14\u53EF\u4EE5\u964D\u4F4E\u63D0\u4EA4\u901F\u5EA6\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"new ThreadPoolExecutor.CallerRunsPolicy()\n// \u4E3B\u7EBF\u7A0B\u6267\u884C\u4EFB\u52A1\uFF0C\u964D\u4F4E\u63D0\u4EA4\u901F\u5EA6\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. DiscardPolicy"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9759\u9ED8\u4E22\u5F03\u4EFB\u52A1\uFF0C\u4E0D\u629B\u51FA\u5F02\u5E38"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u5141\u8BB8\u4EFB\u52A1\u4E22\u5931\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"new ThreadPoolExecutor.DiscardPolicy()\n// \u76F4\u63A5\u4E22\u5F03\uFF0C\u4E0D\u505A\u4EFB\u4F55\u5904\u7406\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. DiscardOldestPolicy"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E22\u5F03\u961F\u5217\u4E2D\u6700\u8001\u7684\u4EFB\u52A1\uFF0C\u7136\u540E\u91CD\u65B0\u63D0\u4EA4\u5F53\u524D\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u4EFB\u52A1\u6709\u65F6\u6548\u6027\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"new ThreadPoolExecutor.DiscardOldestPolicy()\n// \u4E22\u5F03\u961F\u5217\u5934\u90E8\u4EFB\u52A1\uFF0C\u91CD\u8BD5\u5F53\u524D\u4EFB\u52A1\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u62D2\u7EDD\u7B56\u7565\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class CustomRejectedHandler implements RejectedExecutionHandler {\n    @Override\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {\n        // \u8BB0\u5F55\u65E5\u5FD7\n        log.warn("Task rejected: {}", r.toString());\n        \n        // \u4FDD\u5B58\u5230\u6570\u636E\u5E93\u6216\u6D88\u606F\u961F\u5217\n        saveToDatabase(r);\n        \n        // \u6216\u8005\u4F7F\u7528\u5907\u7528\u7EBF\u7A0B\u6C60\n        backupExecutor.execute(r);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5173\u952E\u4E1A\u52A1\uFF1AAbortPolicy + \u5F02\u5E38\u5904\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u964D\u7EA7\u4E1A\u52A1\uFF1ACallerRunsPolicy"}),"\n",(0,i.jsx)(e.li,{children:"\u5141\u8BB8\u4E22\u5931\uFF1ADiscardPolicy"}),"\n",(0,i.jsx)(e.li,{children:"\u65F6\u6548\u6027\u4EFB\u52A1\uFF1ADiscardOldestPolicy"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"10-java-\u5E76\u53D1\u5E93\u4E2D\u63D0\u4F9B\u4E86\u54EA\u4E9B\u7EBF\u7A0B\u6C60\u5B9E\u73B0\u5B83\u4EEC\u6709\u4EC0\u4E48\u533A\u522B",children:"10. Java \u5E76\u53D1\u5E93\u4E2D\u63D0\u4F9B\u4E86\u54EA\u4E9B\u7EBF\u7A0B\u6C60\u5B9E\u73B0\uFF1F\u5B83\u4EEC\u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Executors \u5DE5\u5382\u7C7B\u63D0\u4F9B\u4E86\u51E0\u79CD\u5E38\u7528\u7EBF\u7A0B\u6C60\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. FixedThreadPool\uFF08\u56FA\u5B9A\u5927\u5C0F\u7EBF\u7A0B\u6C60\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ExecutorService executor = Executors.newFixedThreadPool(5);\n// \u7B49\u4EF7\u4E8E\nnew ThreadPoolExecutor(5, 5, 0L, TimeUnit.MILLISECONDS,\n    new LinkedBlockingQueue<Runnable>());\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6838\u5FC3\u7EBF\u7A0B\u6570 = \u6700\u5927\u7EBF\u7A0B\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u65E0\u754C\u961F\u5217 LinkedBlockingQueue"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u8D1F\u8F7D\u8F83\u91CD\u7684\u670D\u52A1\u5668\uFF0C\u9650\u5236\u7EBF\u7A0B\u6570"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. CachedThreadPool\uFF08\u7F13\u5B58\u7EBF\u7A0B\u6C60\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ExecutorService executor = Executors.newCachedThreadPool();\n// \u7B49\u4EF7\u4E8E\nnew ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS,\n    new SynchronousQueue<Runnable>());\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6838\u5FC3\u7EBF\u7A0B\u6570\u4E3A 0\uFF0C\u6700\u5927\u7EBF\u7A0B\u6570\u65E0\u9650"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 SynchronousQueue\uFF08\u4E0D\u5B58\u50A8\u5143\u7D20\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u7A7A\u95F2 60 \u79D2\u540E\u56DE\u6536"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u6267\u884C\u5927\u91CF\u77ED\u671F\u5F02\u6B65\u4EFB\u52A1"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. SingleThreadExecutor\uFF08\u5355\u7EBF\u7A0B\u7EBF\u7A0B\u6C60\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ExecutorService executor = Executors.newSingleThreadExecutor();\n// \u7B49\u4EF7\u4E8E\nnew ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS,\n    new LinkedBlockingQueue<Runnable>());\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u4FDD\u8BC1\u4EFB\u52A1\u6309\u987A\u5E8F\u6267\u884C"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u9700\u8981\u987A\u5E8F\u6267\u884C\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. ScheduledThreadPool\uFF08\u5B9A\u65F6\u4EFB\u52A1\u7EBF\u7A0B\u6C60\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ScheduledExecutorService executor = Executors.newScheduledThreadPool(5);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u5B9A\u65F6\u548C\u5468\u671F\u6027\u4EFB\u52A1\u6267\u884C"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 DelayedWorkQueue"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5EF6\u8FDF\u6267\u884C\nexecutor.schedule(task, 5, TimeUnit.SECONDS);\n\n// \u56FA\u5B9A\u9891\u7387\u6267\u884C\nexecutor.scheduleAtFixedRate(task, 0, 1, TimeUnit.SECONDS);\n\n// \u56FA\u5B9A\u5EF6\u8FDF\u6267\u884C\nexecutor.scheduleWithFixedDelay(task, 0, 1, TimeUnit.SECONDS);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. WorkStealingPool\uFF08\u5DE5\u4F5C\u7A83\u53D6\u7EBF\u7A0B\u6C60\uFF0CJava 8+\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ExecutorService executor = Executors.newWorkStealingPool();\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E ForkJoinPool \u5B9E\u73B0"}),"\n",(0,i.jsx)(e.li,{children:"\u6BCF\u4E2A\u7EBF\u7A0B\u6709\u81EA\u5DF1\u7684\u4EFB\u52A1\u961F\u5217"}),"\n",(0,i.jsx)(e.li,{children:'\u7A7A\u95F2\u7EBF\u7A0B\u53EF\u4EE5"\u7A83\u53D6"\u5176\u4ED6\u7EBF\u7A0B\u7684\u4EFB\u52A1'}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u4EFB\u52A1\u6267\u884C\u65F6\u95F4\u4E0D\u5747\u5300\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u6838\u5FC3\u7EBF\u7A0B\u6570"}),(0,i.jsx)(e.th,{children:"\u6700\u5927\u7EBF\u7A0B\u6570"}),(0,i.jsx)(e.th,{children:"\u961F\u5217"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"FixedThreadPool"}),(0,i.jsx)(e.td,{children:"n"}),(0,i.jsx)(e.td,{children:"n"}),(0,i.jsx)(e.td,{children:"\u65E0\u754C\u961F\u5217"}),(0,i.jsx)(e.td,{children:"\u8D1F\u8F7D\u8F83\u91CD\u7684\u670D\u52A1\u5668"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"CachedThreadPool"}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"\u65E0\u9650"}),(0,i.jsx)(e.td,{children:"SynchronousQueue"}),(0,i.jsx)(e.td,{children:"\u5927\u91CF\u77ED\u671F\u4EFB\u52A1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"SingleThreadExecutor"}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"\u65E0\u754C\u961F\u5217"}),(0,i.jsx)(e.td,{children:"\u987A\u5E8F\u6267\u884C\u4EFB\u52A1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ScheduledThreadPool"}),(0,i.jsx)(e.td,{children:"n"}),(0,i.jsx)(e.td,{children:"Integer.MAX_VALUE"}),(0,i.jsx)(e.td,{children:"DelayedWorkQueue"}),(0,i.jsx)(e.td,{children:"\u5B9A\u65F6\u4EFB\u52A1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"WorkStealingPool"}),(0,i.jsx)(e.td,{children:"CPU\u6838\u5FC3\u6570"}),(0,i.jsx)(e.td,{children:"-"}),(0,i.jsx)(e.td,{children:"\u591A\u961F\u5217"}),(0,i.jsx)(e.td,{children:"\u4EFB\u52A1\u65F6\u95F4\u4E0D\u5747"})]})]})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6CE8\u610F\uFF1A"})," \u963F\u91CC\u5DF4\u5DF4\u5F00\u53D1\u624B\u518C\u4E0D\u63A8\u8350\u4F7F\u7528 Executors \u521B\u5EFA\u7EBF\u7A0B\u6C60\uFF0C\u5EFA\u8BAE\u624B\u52A8\u521B\u5EFA ThreadPoolExecutor\uFF0C\u660E\u786E\u53C2\u6570\uFF0C\u907F\u514D\u8D44\u6E90\u8017\u5C3D\u98CE\u9669\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"11-java-\u7EBF\u7A0B\u6C60\u6838\u5FC3\u7EBF\u7A0B\u6570\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u80FD\u4FEE\u6539\u5417\u5982\u4F55\u4FEE\u6539",children:"11. Java \u7EBF\u7A0B\u6C60\u6838\u5FC3\u7EBF\u7A0B\u6570\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u80FD\u4FEE\u6539\u5417\uFF1F\u5982\u4F55\u4FEE\u6539\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u53EF\u4EE5\u4FEE\u6539\u3002ThreadPoolExecutor \u63D0\u4F9B\u4E86\u52A8\u6001\u8C03\u6574\u7EBF\u7A0B\u6C60\u53C2\u6570\u7684\u65B9\u6CD5\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FEE\u6539\u6838\u5FC3\u7EBF\u7A0B\u6570\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ThreadPoolExecutor executor = new ThreadPoolExecutor(\n    5, 10, 60L, TimeUnit.SECONDS,\n    new LinkedBlockingQueue<>(100)\n);\n\n// \u52A8\u6001\u4FEE\u6539\u6838\u5FC3\u7EBF\u7A0B\u6570\nexecutor.setCorePoolSize(10);\n\n// \u83B7\u53D6\u5F53\u524D\u6838\u5FC3\u7EBF\u7A0B\u6570\nint coreSize = executor.getCorePoolSize();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FEE\u6539\u6700\u5927\u7EBF\u7A0B\u6570\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"executor.setMaximumPoolSize(20);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FEE\u6539\u7A7A\u95F2\u7EBF\u7A0B\u5B58\u6D3B\u65F6\u95F4\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"executor.setKeepAliveTime(120L, TimeUnit.SECONDS);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6CE8\u610F\u4E8B\u9879\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u589E\u52A0\u6838\u5FC3\u7EBF\u7A0B\u6570"}),"\uFF1A\u4F1A\u7ACB\u5373\u521B\u5EFA\u65B0\u7EBF\u7A0B\uFF08\u5982\u679C\u6709\u4EFB\u52A1\u5728\u7B49\u5F85\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u51CF\u5C11\u6838\u5FC3\u7EBF\u7A0B\u6570"}),"\uFF1A\u591A\u4F59\u7684\u6838\u5FC3\u7EBF\u7A0B\u4F1A\u5728\u7A7A\u95F2\u540E\u88AB\u56DE\u6536"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6700\u5927\u7EBF\u7A0B\u6570\u5FC5\u987B >= \u6838\u5FC3\u7EBF\u7A0B\u6570"}),"\uFF1A\u5426\u5219\u629B\u51FA IllegalArgumentException"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u52A8\u6001\u8C03\u6574\u573A\u666F\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class DynamicThreadPool {\n    private ThreadPoolExecutor executor;\n    \n    public void adjustByLoad() {\n        int queueSize = executor.getQueue().size();\n        int activeCount = executor.getActiveCount();\n        \n        // \u6839\u636E\u961F\u5217\u5927\u5C0F\u548C\u6D3B\u8DC3\u7EBF\u7A0B\u6570\u52A8\u6001\u8C03\u6574\n        if (queueSize > 100 && activeCount < executor.getMaximumPoolSize()) {\n            executor.setCorePoolSize(executor.getCorePoolSize() + 5);\n        } else if (queueSize < 10 && executor.getCorePoolSize() > 5) {\n            executor.setCorePoolSize(executor.getCorePoolSize() - 5);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u76D1\u63A7\u7EBF\u7A0B\u6C60\u72B6\u6001\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5F53\u524D\u7EBF\u7A0B\u6C60\u5927\u5C0F\nint poolSize = executor.getPoolSize();\n\n// \u6D3B\u8DC3\u7EBF\u7A0B\u6570\nint activeCount = executor.getActiveCount();\n\n// \u961F\u5217\u4E2D\u4EFB\u52A1\u6570\nint queueSize = executor.getQueue().size();\n\n// \u5DF2\u5B8C\u6210\u4EFB\u52A1\u6570\nlong completedTaskCount = executor.getCompletedTaskCount();\n\n// \u603B\u4EFB\u52A1\u6570\nlong taskCount = executor.getTaskCount();\n"})}),"\n",(0,i.jsx)(e.h3,{id:"12-\u7EBF\u7A0B\u6C60\u4E2D-shutdown-\u4E0E-shutdownnow-\u7684\u533A\u522B\u662F\u4EC0\u4E48",children:"12. \u7EBF\u7A0B\u6C60\u4E2D shutdown \u4E0E shutdownNow \u7684\u533A\u522B\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"shutdown() \u65B9\u6CD5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6E29\u548C\u5173\u95ED\uFF0C\u4E0D\u63A5\u53D7\u65B0\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u7EE7\u7EED\u6267\u884C\u961F\u5217\u4E2D\u7684\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u7B49\u5F85\u6240\u6709\u4EFB\u52A1\u6267\u884C\u5B8C\u6210"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u4F1A\u4E2D\u65AD\u6B63\u5728\u6267\u884C\u7684\u4EFB\u52A1"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"executor.shutdown();\n\n// \u7B49\u5F85\u6240\u6709\u4EFB\u52A1\u5B8C\u6210\ntry {\n    if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {\n        executor.shutdownNow(); // \u8D85\u65F6\u540E\u5F3A\u5236\u5173\u95ED\n    }\n} catch (InterruptedException e) {\n    executor.shutdownNow();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"shutdownNow() \u65B9\u6CD5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7ACB\u5373\u5173\u95ED\uFF0C\u4E0D\u63A5\u53D7\u65B0\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u5C1D\u8BD5\u505C\u6B62\u6240\u6709\u6B63\u5728\u6267\u884C\u7684\u4EFB\u52A1\uFF08\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u518D\u6267\u884C\u961F\u5217\u4E2D\u7B49\u5F85\u7684\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u8FD4\u56DE\u7B49\u5F85\u6267\u884C\u7684\u4EFB\u52A1\u5217\u8868"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'List<Runnable> notExecutedTasks = executor.shutdownNow();\nSystem.out.println("\u672A\u6267\u884C\u7684\u4EFB\u52A1\u6570: " + notExecutedTasks.size());\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u8868\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"shutdown()"}),(0,i.jsx)(e.th,{children:"shutdownNow()"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u63A5\u53D7\u65B0\u4EFB\u52A1"}),(0,i.jsx)(e.td,{children:"\u5426"}),(0,i.jsx)(e.td,{children:"\u5426"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6267\u884C\u961F\u5217\u4EFB\u52A1"}),(0,i.jsx)(e.td,{children:"\u662F"}),(0,i.jsx)(e.td,{children:"\u5426"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4E2D\u65AD\u8FD0\u884C\u4EFB\u52A1"}),(0,i.jsx)(e.td,{children:"\u5426"}),(0,i.jsx)(e.td,{children:"\u662F\uFF08\u53D1\u9001\u4E2D\u65AD\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8FD4\u56DE\u503C"}),(0,i.jsx)(e.td,{children:"void"}),(0,i.jsx)(e.td,{children:"List<Runnable>"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5173\u95ED\u901F\u5EA6"}),(0,i.jsx)(e.td,{children:"\u6162\uFF08\u7B49\u5F85\u5B8C\u6210\uFF09"}),(0,i.jsx)(e.td,{children:"\u5FEB\uFF08\u7ACB\u5373\u505C\u6B62\uFF09"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B8C\u6574\u5173\u95ED\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public void shutdownGracefully(ExecutorService executor) {\n    executor.shutdown(); // \u7981\u6B62\u65B0\u4EFB\u52A1\u63D0\u4EA4\n    \n    try {\n        // \u7B49\u5F85 60 \u79D2\u8BA9\u4EFB\u52A1\u5B8C\u6210\n        if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {\n            // \u8D85\u65F6\u540E\u5F3A\u5236\u5173\u95ED\n            List<Runnable> droppedTasks = executor.shutdownNow();\n            System.out.println("\u5F3A\u5236\u5173\u95ED\uFF0C\u4E22\u5F03\u4EFB\u52A1: " + droppedTasks.size());\n            \n            // \u518D\u7B49\u5F85 60 \u79D2\n            if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {\n                System.err.println("\u7EBF\u7A0B\u6C60\u672A\u80FD\u6B63\u5E38\u5173\u95ED");\n            }\n        }\n    } catch (InterruptedException e) {\n        // \u5F53\u524D\u7EBF\u7A0B\u88AB\u4E2D\u65AD\uFF0C\u5F3A\u5236\u5173\u95ED\u7EBF\u7A0B\u6C60\n        executor.shutdownNow();\n        Thread.currentThread().interrupt();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6CE8\u610F\u4E8B\u9879\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"shutdownNow() \u4E0D\u4FDD\u8BC1\u80FD\u505C\u6B62\u6B63\u5728\u6267\u884C\u7684\u4EFB\u52A1\uFF08\u4EFB\u52A1\u9700\u8981\u54CD\u5E94\u4E2D\u65AD\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4EFB\u52A1\u5E94\u8BE5\u6B63\u786E\u5904\u7406 InterruptedException"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 awaitTermination() \u7B49\u5F85\u7EBF\u7A0B\u6C60\u771F\u6B63\u7EC8\u6B62"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"13-\u7EBF\u7A0B\u6C60\u5185\u90E8\u4EFB\u52A1\u51FA\u5F02\u5E38\u540E\u5982\u4F55\u77E5\u9053\u662F\u54EA\u4E2A\u7EBF\u7A0B\u51FA\u4E86\u5F02\u5E38",children:"13. \u7EBF\u7A0B\u6C60\u5185\u90E8\u4EFB\u52A1\u51FA\u5F02\u5E38\u540E\uFF0C\u5982\u4F55\u77E5\u9053\u662F\u54EA\u4E2A\u7EBF\u7A0B\u51FA\u4E86\u5F02\u5E38\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u7EBF\u7A0B\u6C60\u4EFB\u52A1\u5F02\u5E38\u5904\u7406\u6709\u591A\u79CD\u65B9\u5F0F\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4F7F\u7528 Future.get() \u6355\u83B7\u5F02\u5E38"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ExecutorService executor = Executors.newFixedThreadPool(5);\n\nFuture<?> future = executor.submit(() -> {\n    throw new RuntimeException("\u4EFB\u52A1\u5F02\u5E38");\n});\n\ntry {\n    future.get(); // \u4F1A\u629B\u51FA ExecutionException\n} catch (ExecutionException e) {\n    Throwable cause = e.getCause();\n    System.out.println("\u4EFB\u52A1\u5F02\u5E38: " + cause.getMessage());\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5728\u4EFB\u52A1\u5185\u90E8\u6355\u83B7\u5F02\u5E38"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'executor.submit(() -> {\n    try {\n        // \u4EFB\u52A1\u903B\u8F91\n        int result = 1 / 0;\n    } catch (Exception e) {\n        System.out.println("\u7EBF\u7A0B: " + Thread.currentThread().getName() \n            + " \u5F02\u5E38: " + e.getMessage());\n        // \u8BB0\u5F55\u65E5\u5FD7\u6216\u4E0A\u62A5\n    }\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u81EA\u5B9A\u4E49 ThreadFactory \u8BBE\u7F6E UncaughtExceptionHandler"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ThreadFactory factory = new ThreadFactory() {\n    private AtomicInteger threadNumber = new AtomicInteger(1);\n    \n    @Override\n    public Thread newThread(Runnable r) {\n        Thread thread = new Thread(r);\n        thread.setName("MyPool-" + threadNumber.getAndIncrement());\n        \n        // \u8BBE\u7F6E\u672A\u6355\u83B7\u5F02\u5E38\u5904\u7406\u5668\n        thread.setUncaughtExceptionHandler((t, e) -> {\n            System.out.println("\u7EBF\u7A0B " + t.getName() + " \u5F02\u5E38: " + e.getMessage());\n            // \u8BB0\u5F55\u65E5\u5FD7\u3001\u53D1\u9001\u544A\u8B66\n        });\n        \n        return thread;\n    }\n};\n\nThreadPoolExecutor executor = new ThreadPoolExecutor(\n    5, 10, 60L, TimeUnit.SECONDS,\n    new LinkedBlockingQueue<>(),\n    factory\n);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u91CD\u5199 ThreadPoolExecutor.afterExecute() \u65B9\u6CD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class CustomThreadPoolExecutor extends ThreadPoolExecutor {\n    \n    public CustomThreadPoolExecutor(int corePoolSize, int maximumPoolSize,\n            long keepAliveTime, TimeUnit unit, BlockingQueue<Runnable> workQueue) {\n        super(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue);\n    }\n    \n    @Override\n    protected void afterExecute(Runnable r, Throwable t) {\n        super.afterExecute(r, t);\n        \n        if (t == null && r instanceof Future<?>) {\n            try {\n                Future<?> future = (Future<?>) r;\n                if (future.isDone()) {\n                    future.get();\n                }\n            } catch (ExecutionException e) {\n                t = e.getCause();\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n        }\n        \n        if (t != null) {\n            System.out.println("\u4EFB\u52A1\u6267\u884C\u5F02\u5E38: " + t.getMessage());\n            // \u8BB0\u5F55\u65E5\u5FD7\u3001\u53D1\u9001\u544A\u8B66\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u4F7F\u7528 CompletableFuture \u5904\u7406\u5F02\u5E38"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CompletableFuture.supplyAsync(() -> {\n    // \u4EFB\u52A1\u903B\u8F91\n    return 1 / 0;\n}, executor).exceptionally(ex -> {\n    System.out.println("\u5F02\u5E38\u5904\u7406: " + ex.getMessage());\n    return null;\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"submit() \u63D0\u4EA4\u7684\u4EFB\u52A1\u4F7F\u7528 Future.get() \u83B7\u53D6\u5F02\u5E38"}),"\n",(0,i.jsx)(e.li,{children:"execute() \u63D0\u4EA4\u7684\u4EFB\u52A1\u4F7F\u7528 UncaughtExceptionHandler"}),"\n",(0,i.jsx)(e.li,{children:"\u91CD\u8981\u4EFB\u52A1\u5728\u5185\u90E8 try-catch \u5904\u7406\u5F02\u5E38"}),"\n",(0,i.jsx)(e.li,{children:"\u8BB0\u5F55\u8BE6\u7EC6\u7684\u5F02\u5E38\u4FE1\u606F\uFF08\u7EBF\u7A0B\u540D\u3001\u65F6\u95F4\u3001\u5806\u6808\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"14-java-\u4E2D\u7684-delayqueue-\u548C-scheduledthreadpool-\u6709\u4EC0\u4E48\u533A\u522B",children:"14. Java \u4E2D\u7684 DelayQueue \u548C ScheduledThreadPool \u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"DelayQueue\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u662F\u4E00\u4E2A\u963B\u585E\u961F\u5217\uFF0C\u5B58\u50A8 Delayed \u5143\u7D20"}),"\n",(0,i.jsx)(e.li,{children:"\u53EA\u6709\u5230\u671F\u7684\u5143\u7D20\u624D\u80FD\u88AB\u53D6\u51FA"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u624B\u52A8\u4ECE\u961F\u5217\u4E2D\u53D6\u5143\u7D20\u5E76\u5904\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u66F4\u7075\u6D3B\uFF0C\u53EF\u4EE5\u81EA\u5B9A\u4E49\u5904\u7406\u903B\u8F91"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class DelayedTask implements Delayed {\n    private String name;\n    private long delayTime; // \u5EF6\u8FDF\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\n    private long expire;    // \u5230\u671F\u65F6\u95F4\n    \n    public DelayedTask(String name, long delayTime) {\n        this.name = name;\n        this.delayTime = delayTime;\n        this.expire = System.currentTimeMillis() + delayTime;\n    }\n    \n    @Override\n    public long getDelay(TimeUnit unit) {\n        return unit.convert(expire - System.currentTimeMillis(), \n            TimeUnit.MILLISECONDS);\n    }\n    \n    @Override\n    public int compareTo(Delayed o) {\n        return Long.compare(this.expire, ((DelayedTask) o).expire);\n    }\n}\n\n// \u4F7F\u7528\nDelayQueue<DelayedTask> queue = new DelayQueue<>();\nqueue.put(new DelayedTask("task1", 5000)); // 5\u79D2\u540E\u5230\u671F\n\n// \u624B\u52A8\u53D6\u51FA\u5E76\u5904\u7406\nDelayedTask task = queue.take(); // \u963B\u585E\u76F4\u5230\u6709\u5143\u7D20\u5230\u671F\nSystem.out.println("\u6267\u884C\u4EFB\u52A1: " + task.getName());\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"ScheduledThreadPool\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u662F\u4E00\u4E2A\u7EBF\u7A0B\u6C60\uFF0C\u4E13\u95E8\u7528\u4E8E\u6267\u884C\u5B9A\u65F6\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u81EA\u52A8\u8C03\u5EA6\u548C\u6267\u884C\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u56FA\u5B9A\u5EF6\u8FDF\u548C\u56FA\u5B9A\u9891\u7387\u6267\u884C"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u90E8\u4F7F\u7528 DelayedWorkQueue"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(5);\n\n// \u5EF6\u8FDF\u6267\u884C\uFF08\u4E00\u6B21\u6027\uFF09\nscheduler.schedule(() -> {\n    System.out.println("5\u79D2\u540E\u6267\u884C");\n}, 5, TimeUnit.SECONDS);\n\n// \u56FA\u5B9A\u9891\u7387\u6267\u884C\uFF08\u5468\u671F\u6027\uFF09\nscheduler.scheduleAtFixedRate(() -> {\n    System.out.println("\u6BCF\u79D2\u6267\u884C\u4E00\u6B21");\n}, 0, 1, TimeUnit.SECONDS);\n\n// \u56FA\u5B9A\u5EF6\u8FDF\u6267\u884C\uFF08\u5468\u671F\u6027\uFF09\nscheduler.scheduleWithFixedDelay(() -> {\n    System.out.println("\u4E0A\u6B21\u6267\u884C\u5B8C\u6210\u540E\u5EF6\u8FDF1\u79D2\u518D\u6267\u884C");\n}, 0, 1, TimeUnit.SECONDS);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E3B\u8981\u533A\u522B\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"DelayQueue"}),(0,i.jsx)(e.th,{children:"ScheduledThreadPool"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7C7B\u578B"}),(0,i.jsx)(e.td,{children:"\u963B\u585E\u961F\u5217"}),(0,i.jsx)(e.td,{children:"\u7EBF\u7A0B\u6C60"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u81EA\u52A8\u6267\u884C"}),(0,i.jsx)(e.td,{children:"\u5426\uFF0C\u9700\u624B\u52A8\u53D6\u51FA"}),(0,i.jsx)(e.td,{children:"\u662F\uFF0C\u81EA\u52A8\u8C03\u5EA6\u6267\u884C"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5468\u671F\u4EFB\u52A1"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7EBF\u7A0B\u7BA1\u7406"}),(0,i.jsx)(e.td,{children:"\u9700\u81EA\u5DF1\u7BA1\u7406"}),(0,i.jsx)(e.td,{children:"\u81EA\u52A8\u7BA1\u7406"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F7F\u7528\u590D\u6742\u5EA6"}),(0,i.jsx)(e.td,{children:"\u8F83\u9AD8"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7075\u6D3B\u6027"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E2D"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u81EA\u5B9A\u4E49\u8C03\u5EA6\u903B\u8F91"}),(0,i.jsx)(e.td,{children:"\u6807\u51C6\u5B9A\u65F6\u4EFB\u52A1"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"scheduleAtFixedRate vs scheduleWithFixedDelay\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// scheduleAtFixedRate: \u56FA\u5B9A\u9891\u7387\n// \u5982\u679C\u4EFB\u52A1\u6267\u884C\u65F6\u95F4 < \u95F4\u9694\u65F6\u95F4\uFF0C\u6309\u56FA\u5B9A\u9891\u7387\u6267\u884C\n// \u5982\u679C\u4EFB\u52A1\u6267\u884C\u65F6\u95F4 > \u95F4\u9694\u65F6\u95F4\uFF0C\u4EFB\u52A1\u6267\u884C\u5B8C\u7ACB\u5373\u5F00\u59CB\u4E0B\u4E00\u6B21\nscheduler.scheduleAtFixedRate(task, 0, 1, TimeUnit.SECONDS);\n// 0s -> 1s -> 2s -> 3s (\u7406\u60F3\u60C5\u51B5)\n\n// scheduleWithFixedDelay: \u56FA\u5B9A\u5EF6\u8FDF\n// \u4E0A\u6B21\u4EFB\u52A1\u6267\u884C\u5B8C\u6210\u540E\uFF0C\u5EF6\u8FDF\u6307\u5B9A\u65F6\u95F4\u518D\u6267\u884C\nscheduler.scheduleWithFixedDelay(task, 0, 1, TimeUnit.SECONDS);\n// 0s -> \u4EFB\u52A1\u5B8C\u6210(0.5s) -> 1.5s -> \u4EFB\u52A1\u5B8C\u6210(2s) -> 3s\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B80\u5355\u5B9A\u65F6\u4EFB\u52A1\uFF1A\u4F7F\u7528 ScheduledThreadPool"}),"\n",(0,i.jsx)(e.li,{children:"\u590D\u6742\u8C03\u5EA6\u903B\u8F91\uFF1A\u4F7F\u7528 DelayQueue"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u5468\u671F\u6267\u884C\uFF1A\u4F7F\u7528 ScheduledThreadPool"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u52A8\u6001\u8C03\u6574\u5EF6\u8FDF\uFF1A\u4F7F\u7528 DelayQueue"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"15-\u4EC0\u4E48\u662F-java-\u7684-timer",children:"15. \u4EC0\u4E48\u662F Java \u7684 Timer\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Timer \u662F Java \u65E9\u671F\u63D0\u4F9B\u7684\u5B9A\u65F6\u4EFB\u52A1\u5DE5\u5177\u7C7B\uFF0C\u4F7F\u7528\u5355\u7EBF\u7A0B\u6267\u884C\u6240\u6709\u5B9A\u65F6\u4EFB\u52A1\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'Timer timer = new Timer();\n\n// \u5EF6\u8FDF\u6267\u884C\ntimer.schedule(new TimerTask() {\n    @Override\n    public void run() {\n        System.out.println("5\u79D2\u540E\u6267\u884C");\n    }\n}, 5000);\n\n// \u5468\u671F\u6267\u884C\ntimer.scheduleAtFixedRate(new TimerTask() {\n    @Override\n    public void run() {\n        System.out.println("\u6BCF\u79D2\u6267\u884C");\n    }\n}, 0, 1000);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Timer \u7684\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5355\u7EBF\u7A0B\u6267\u884C"}),"\uFF1A\u6240\u6709\u4EFB\u52A1\u4E32\u884C\u6267\u884C\uFF0C\u4E00\u4E2A\u4EFB\u52A1\u5EF6\u8FDF\u4F1A\u5F71\u54CD\u5176\u4ED6\u4EFB\u52A1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5F02\u5E38\u5904\u7406\u5DEE"}),"\uFF1A\u4EFB\u52A1\u629B\u51FA\u5F02\u5E38\u4F1A\u5BFC\u81F4\u6574\u4E2A Timer \u7EC8\u6B62"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E0D\u652F\u6301\u7EDD\u5BF9\u65F6\u95F4"}),"\uFF1A\u57FA\u4E8E\u76F8\u5BF9\u65F6\u95F4\uFF0C\u7CFB\u7EDF\u65F6\u95F4\u6539\u53D8\u4F1A\u5F71\u54CD\u8C03\u5EA6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u529F\u80FD\u6709\u9650"}),"\uFF1A\u4E0D\u652F\u6301\u7EBF\u7A0B\u6C60\u3001\u8FD4\u56DE\u503C\u7B49"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u95EE\u9898\u793A\u4F8B\uFF1A\u4E00\u4E2A\u4EFB\u52A1\u5F02\u5E38\u5BFC\u81F4 Timer \u7EC8\u6B62\nTimer timer = new Timer();\ntimer.schedule(new TimerTask() {\n    @Override\n    public void run() {\n        throw new RuntimeException("\u5F02\u5E38");\n    }\n}, 1000);\n\ntimer.schedule(new TimerTask() {\n    @Override\n    public void run() {\n        System.out.println("\u8FD9\u4E2A\u4EFB\u52A1\u4E0D\u4F1A\u6267\u884C");\n    }\n}, 2000);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u66FF\u4EE3\u65B9\u6848\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 ScheduledExecutorService\uFF08\u63A8\u8350\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 Quartz \u7B49\u4E13\u4E1A\u8C03\u5EA6\u6846\u67B6"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 Spring \u7684 @Scheduled \u6CE8\u89E3"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"16-\u4F60\u4E86\u89E3\u65F6\u95F4\u8F6Etime-wheel\u5417\u6709\u54EA\u4E9B\u5E94\u7528\u573A\u666F",children:"16. \u4F60\u4E86\u89E3\u65F6\u95F4\u8F6E\uFF08Time Wheel\uFF09\u5417\uFF1F\u6709\u54EA\u4E9B\u5E94\u7528\u573A\u666F\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u65F6\u95F4\u8F6E\uFF08Time Wheel\uFF09"})," \u662F\u4E00\u79CD\u9AD8\u6548\u7684\u5B9A\u65F6\u5668\u7B97\u6CD5\uFF0C\u7528\u4E8E\u7BA1\u7406\u5927\u91CF\u5B9A\u65F6\u4EFB\u52A1\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7C7B\u4F3C\u65F6\u949F\uFF0C\u5C06\u65F6\u95F4\u5206\u6210\u591A\u4E2A\u69FD\u4F4D\uFF08slot\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u6BCF\u4E2A\u69FD\u4F4D\u5B58\u50A8\u8BE5\u65F6\u95F4\u70B9\u8981\u6267\u884C\u7684\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u6307\u9488\u6309\u56FA\u5B9A\u9891\u7387\u79FB\u52A8\uFF0C\u6267\u884C\u5F53\u524D\u69FD\u4F4D\u7684\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u591A\u5C42\u65F6\u95F4\u8F6E\uFF08\u79D2\u3001\u5206\u3001\u65F6\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u65F6\u95F4\u8F6E\u793A\u610F\u56FE\uFF1A\n     0\n  7     1\n6         2\n  5     3\n     4\n\n\u6BCF\u4E2A\u69FD\u4F4D\u5B58\u50A8\u4EFB\u52A1\u94FE\u8868\n\u6307\u9488\u6BCF\u79D2\u79FB\u52A8\u4E00\u683C\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B80\u5355\u5B9E\u73B0\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class SimpleTimeWheel {\n    private List<Set<Task>> wheel;\n    private int tickDuration;  // \u6BCF\u683C\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\n    private int wheelSize;     // \u8F6E\u5B50\u5927\u5C0F\n    private int currentTick;   // \u5F53\u524D\u6307\u9488\u4F4D\u7F6E\n    \n    public SimpleTimeWheel(int tickDuration, int wheelSize) {\n        this.tickDuration = tickDuration;\n        this.wheelSize = wheelSize;\n        this.wheel = new ArrayList<>(wheelSize);\n        for (int i = 0; i < wheelSize; i++) {\n            wheel.add(new HashSet<>());\n        }\n    }\n    \n    public void addTask(Task task, long delayMs) {\n        int ticks = (int) (delayMs / tickDuration);\n        int index = (currentTick + ticks) % wheelSize;\n        wheel.get(index).add(task);\n    }\n    \n    public void tick() {\n        Set<Task> tasks = wheel.get(currentTick);\n        tasks.forEach(Task::run);\n        tasks.clear();\n        currentTick = (currentTick + 1) % wheelSize;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6DFB\u52A0/\u5220\u9664\u4EFB\u52A1\u65F6\u95F4\u590D\u6742\u5EA6 O(1)"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u5927\u91CF\u5B9A\u65F6\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u5B58\u5360\u7528\u53EF\u63A7"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7CBE\u5EA6\u53D7\u9650\u4E8E tick \u95F4\u9694"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u9002\u5408\u957F\u65F6\u95F4\u5EF6\u8FDF\uFF08\u9700\u8981\u591A\u5C42\u65F6\u95F4\u8F6E\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Netty \u7684 HashedWheelTimer"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'HashedWheelTimer timer = new HashedWheelTimer(\n    100, TimeUnit.MILLISECONDS,  // tick \u95F4\u9694\n    512                          // \u8F6E\u5B50\u5927\u5C0F\n);\n\ntimer.newTimeout(timeout -> {\n    System.out.println("\u4EFB\u52A1\u6267\u884C");\n}, 5, TimeUnit.SECONDS);\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Kafka \u7684\u5EF6\u8FDF\u64CD\u4F5C"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Dubbo \u7684\u8D85\u65F6\u68C0\u6D4B"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u8FDE\u63A5\u8D85\u65F6\u7BA1\u7406"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u4F1A\u8BDD\u8FC7\u671F\u68C0\u6D4B"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E0E\u5176\u4ED6\u5B9A\u65F6\u5668\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u65B9\u6848"}),(0,i.jsx)(e.th,{children:"\u6DFB\u52A0\u4EFB\u52A1"}),(0,i.jsx)(e.th,{children:"\u5220\u9664\u4EFB\u52A1"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Timer"}),(0,i.jsx)(e.td,{children:"O(log n)"}),(0,i.jsx)(e.td,{children:"O(n)"}),(0,i.jsx)(e.td,{children:"\u5C11\u91CF\u4EFB\u52A1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ScheduledThreadPool"}),(0,i.jsx)(e.td,{children:"O(log n)"}),(0,i.jsx)(e.td,{children:"O(log n)"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49\u4EFB\u52A1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u65F6\u95F4\u8F6E"}),(0,i.jsx)(e.td,{children:"O(1)"}),(0,i.jsx)(e.td,{children:"O(1)"}),(0,i.jsx)(e.td,{children:"\u5927\u91CF\u4EFB\u52A1"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"17-\u4F60\u4F7F\u7528\u8FC7\u54EA\u4E9B-java-\u5E76\u53D1\u5DE5\u5177\u7C7B",children:"17. \u4F60\u4F7F\u7528\u8FC7\u54EA\u4E9B Java \u5E76\u53D1\u5DE5\u5177\u7C7B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u5E76\u53D1\u5305\uFF08java.util.concurrent\uFF09\u63D0\u4F9B\u4E86\u4E30\u5BCC\u7684\u5E76\u53D1\u5DE5\u5177\u7C7B\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u540C\u6B65\u5DE5\u5177\u7C7B"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CountDownLatch\uFF08\u5012\u8BA1\u6570\u95E8\u6813\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CountDownLatch latch = new CountDownLatch(3);\n\n// \u5DE5\u4F5C\u7EBF\u7A0B\nnew Thread(() -> {\n    System.out.println("\u4EFB\u52A11\u5B8C\u6210");\n    latch.countDown();\n}).start();\n\n// \u4E3B\u7EBF\u7A0B\u7B49\u5F85\nlatch.await(); // \u7B49\u5F85\u8BA1\u6570\u5F52\u96F6\nSystem.out.println("\u6240\u6709\u4EFB\u52A1\u5B8C\u6210");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CyclicBarrier\uFF08\u5FAA\u73AF\u6805\u680F\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CyclicBarrier barrier = new CyclicBarrier(3, () -> {\n    System.out.println("\u6240\u6709\u7EBF\u7A0B\u5230\u8FBE\u5C4F\u969C");\n});\n\n// \u6BCF\u4E2A\u7EBF\u7A0B\nbarrier.await(); // \u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Semaphore\uFF08\u4FE1\u53F7\u91CF\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"Semaphore semaphore = new Semaphore(3); // 3\u4E2A\u8BB8\u53EF\n\nsemaphore.acquire(); // \u83B7\u53D6\u8BB8\u53EF\ntry {\n    // \u6267\u884C\u4EFB\u52A1\n} finally {\n    semaphore.release(); // \u91CA\u653E\u8BB8\u53EF\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Exchanger\uFF08\u4EA4\u6362\u5668\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'Exchanger<String> exchanger = new Exchanger<>();\n\n// \u7EBF\u7A0B1\nString data1 = exchanger.exchange("\u6570\u636E1");\n\n// \u7EBF\u7A0B2\nString data2 = exchanger.exchange("\u6570\u636E2");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5E76\u53D1\u5BB9\u5668"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B\u5B89\u5168\u7684 Map\nConcurrentHashMap<String, String> map = new ConcurrentHashMap<>();\n\n// \u7EBF\u7A0B\u5B89\u5168\u7684 List\uFF08\u8BFB\u591A\u5199\u5C11\uFF09\nCopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<>();\n\n// \u7EBF\u7A0B\u5B89\u5168\u7684 Set\nCopyOnWriteArraySet<String> set = new CopyOnWriteArraySet<>();\n\n// \u963B\u585E\u961F\u5217\nBlockingQueue<String> queue = new LinkedBlockingQueue<>();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u539F\u5B50\u6574\u6570\nAtomicInteger count = new AtomicInteger(0);\ncount.incrementAndGet();\n\n// \u539F\u5B50\u5F15\u7528\nAtomicReference<User> userRef = new AtomicReference<>();\nuserRef.compareAndSet(oldUser, newUser);\n\n// \u539F\u5B50\u6570\u7EC4\nAtomicIntegerArray array = new AtomicIntegerArray(10);\n\n// \u539F\u5B50\u5B57\u6BB5\u66F4\u65B0\u5668\nAtomicIntegerFieldUpdater<User> updater = \n    AtomicIntegerFieldUpdater.newUpdater(User.class, "age");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u9501"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u53EF\u91CD\u5165\u9501\nReentrantLock lock = new ReentrantLock();\n\n// \u8BFB\u5199\u9501\nReadWriteLock rwLock = new ReentrantReadWriteLock();\n\n// \u90AE\u6233\u9501\uFF08Java 8+\uFF09\nStampedLock stampedLock = new StampedLock();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u5F02\u6B65\u7F16\u7A0B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// CompletableFuture\nCompletableFuture<String> future = CompletableFuture\n    .supplyAsync(() -> "Hello")\n    .thenApply(s -> s + " World");\n\n// ForkJoinPool\nForkJoinPool pool = new ForkJoinPool();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u7EBF\u7A0B\u6C60"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u6807\u51C6\u7EBF\u7A0B\u6C60\nExecutorService executor = Executors.newFixedThreadPool(5);\n\n// \u5B9A\u65F6\u7EBF\u7A0B\u6C60\nScheduledExecutorService scheduler = \n    Executors.newScheduledThreadPool(5);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E38\u7528\u573A\u666F\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B49\u5F85\u591A\u4E2A\u4EFB\u52A1\u5B8C\u6210\uFF1ACountDownLatch"}),"\n",(0,i.jsx)(e.li,{children:"\u591A\u7EBF\u7A0B\u534F\u540C\u5DE5\u4F5C\uFF1ACyclicBarrier"}),"\n",(0,i.jsx)(e.li,{children:"\u9650\u6D41\u63A7\u5236\uFF1ASemaphore"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u5B89\u5168\u96C6\u5408\uFF1AConcurrentHashMap\u3001CopyOnWriteArrayList"}),"\n",(0,i.jsx)(e.li,{children:"\u539F\u5B50\u64CD\u4F5C\uFF1AAtomicInteger\u3001AtomicReference"}),"\n",(0,i.jsx)(e.li,{children:"\u5F02\u6B65\u7F16\u7A0B\uFF1ACompletableFuture"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"18-\u4EC0\u4E48\u662F-java-\u7684-semaphore",children:"18. \u4EC0\u4E48\u662F Java \u7684 Semaphore\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Semaphore\uFF08\u4FE1\u53F7\u91CF\uFF09\u662F\u4E00\u4E2A\u8BA1\u6570\u4FE1\u53F7\u91CF\uFF0C\u7528\u4E8E\u63A7\u5236\u540C\u65F6\u8BBF\u95EE\u7279\u5B9A\u8D44\u6E90\u7684\u7EBF\u7A0B\u6570\u91CF\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u65B9\u6CD5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"acquire()"}),"\uFF1A\u83B7\u53D6\u8BB8\u53EF\uFF0C\u5982\u679C\u6CA1\u6709\u53EF\u7528\u8BB8\u53EF\u5219\u963B\u585E"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"release()"}),"\uFF1A\u91CA\u653E\u8BB8\u53EF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"tryAcquire()"}),"\uFF1A\u5C1D\u8BD5\u83B7\u53D6\u8BB8\u53EF\uFF0C\u7ACB\u5373\u8FD4\u56DE"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"availablePermits()"}),"\uFF1A\u8FD4\u56DE\u53EF\u7528\u8BB8\u53EF\u6570"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u672C\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u521B\u5EFA3\u4E2A\u8BB8\u53EF\u7684\u4FE1\u53F7\u91CF\nSemaphore semaphore = new Semaphore(3);\n\npublic void accessResource() {\n    try {\n        semaphore.acquire(); // \u83B7\u53D6\u8BB8\u53EF\n        System.out.println(Thread.currentThread().getName() + " \u8BBF\u95EE\u8D44\u6E90");\n        Thread.sleep(2000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    } finally {\n        semaphore.release(); // \u91CA\u653E\u8BB8\u53EF\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u9650\u6D41\u63A7\u5236"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class RateLimiter {\n    private Semaphore semaphore;\n    \n    public RateLimiter(int maxConcurrent) {\n        this.semaphore = new Semaphore(maxConcurrent);\n    }\n    \n    public void execute(Runnable task) {\n        try {\n            semaphore.acquire();\n            task.run();\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            semaphore.release();\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u6570\u636E\u5E93\u8FDE\u63A5\u6C60"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ConnectionPool {\n    private Semaphore semaphore;\n    private List<Connection> connections;\n    \n    public ConnectionPool(int size) {\n        this.semaphore = new Semaphore(size);\n        this.connections = new ArrayList<>(size);\n        // \u521D\u59CB\u5316\u8FDE\u63A5\n    }\n    \n    public Connection getConnection() throws InterruptedException {\n        semaphore.acquire();\n        return connections.remove(0);\n    }\n    \n    public void releaseConnection(Connection conn) {\n        connections.add(conn);\n        semaphore.release();\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u6027\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u975E\u516C\u5E73\u6A21\u5F0F\uFF08\u9ED8\u8BA4\uFF09\uFF1A\u6027\u80FD\u66F4\u597D\nSemaphore semaphore = new Semaphore(3);\n\n// \u516C\u5E73\u6A21\u5F0F\uFF1A\u6309\u7167\u8BF7\u6C42\u987A\u5E8F\u83B7\u53D6\u8BB8\u53EF\nSemaphore fairSemaphore = new Semaphore(3, true);\n"})}),"\n",(0,i.jsx)(e.h3,{id:"19-\u4EC0\u4E48\u662F-java-\u7684-cyclicbarrier",children:"19. \u4EC0\u4E48\u662F Java \u7684 CyclicBarrier\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"CyclicBarrier\uFF08\u5FAA\u73AF\u6805\u680F\uFF09\u662F\u4E00\u4E2A\u540C\u6B65\u8F85\u52A9\u7C7B\uFF0C\u8BA9\u4E00\u7EC4\u7EBF\u7A0B\u76F8\u4E92\u7B49\u5F85\uFF0C\u76F4\u5230\u6240\u6709\u7EBF\u7A0B\u90FD\u5230\u8FBE\u67D0\u4E2A\u516C\u5171\u5C4F\u969C\u70B9\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF\u5FAA\u73AF\u4F7F\u7528\uFF08Cyclic\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u6240\u6709\u7EBF\u7A0B\u5230\u8FBE\u5C4F\u969C\u70B9\u540E\uFF0C\u53EF\u4EE5\u6267\u884C\u4E00\u4E2A\u53EF\u9009\u7684\u5C4F\u969C\u52A8\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u591A\u7EBF\u7A0B\u534F\u540C\u5DE5\u4F5C\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u672C\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CyclicBarrier barrier = new CyclicBarrier(3, () -> {\n    System.out.println("\u6240\u6709\u7EBF\u7A0B\u90FD\u5230\u8FBE\u5C4F\u969C\uFF0C\u6267\u884C\u6C47\u603B\u64CD\u4F5C");\n});\n\n// \u6BCF\u4E2A\u7EBF\u7A0B\npublic void doWork() {\n    try {\n        System.out.println(Thread.currentThread().getName() + " \u5F00\u59CB\u5DE5\u4F5C");\n        Thread.sleep(1000);\n        System.out.println(Thread.currentThread().getName() + " \u5B8C\u6210\u5DE5\u4F5C\uFF0C\u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B");\n        \n        barrier.await(); // \u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\n        \n        System.out.println(Thread.currentThread().getName() + " \u7EE7\u7EED\u6267\u884C");\n    } catch (InterruptedException | BrokenBarrierException e) {\n        e.printStackTrace();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u591A\u7EBF\u7A0B\u8BA1\u7B97\u540E\u6C47\u603B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class ParallelCalculation {\n    private CyclicBarrier barrier;\n    private int[] results;\n    \n    public ParallelCalculation(int threadCount) {\n        this.results = new int[threadCount];\n        this.barrier = new CyclicBarrier(threadCount, () -> {\n            // \u6240\u6709\u7EBF\u7A0B\u8BA1\u7B97\u5B8C\u6210\uFF0C\u6C47\u603B\u7ED3\u679C\n            int sum = Arrays.stream(results).sum();\n            System.out.println("\u603B\u548C: " + sum);\n        });\n    }\n    \n    public void calculate(int index) {\n        try {\n            // \u6267\u884C\u8BA1\u7B97\n            results[index] = index * 10;\n            \n            // \u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\n            barrier.await();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u591A\u9636\u6BB5\u4EFB\u52A1"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CyclicBarrier barrier = new CyclicBarrier(3);\n\nfor (int phase = 0; phase < 3; phase++) {\n    final int currentPhase = phase;\n    for (int i = 0; i < 3; i++) {\n        new Thread(() -> {\n            System.out.println("\u9636\u6BB5" + currentPhase + " \u6267\u884C");\n            try {\n                barrier.await(); // \u7B49\u5F85\u672C\u9636\u6BB5\u6240\u6709\u7EBF\u7A0B\u5B8C\u6210\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u8981\u65B9\u6CD5\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\nbarrier.await();\n\n// \u5E26\u8D85\u65F6\u7684\u7B49\u5F85\nbarrier.await(10, TimeUnit.SECONDS);\n\n// \u91CD\u7F6E\u5C4F\u969C\nbarrier.reset();\n\n// \u83B7\u53D6\u7B49\u5F85\u7EBF\u7A0B\u6570\nint waiting = barrier.getNumberWaiting();\n\n// \u68C0\u67E5\u5C4F\u969C\u662F\u5426\u88AB\u7834\u574F\nboolean broken = barrier.isBroken();\n"})}),"\n",(0,i.jsx)(e.h3,{id:"20-\u4EC0\u4E48\u662F-java-\u7684-countdownlatch",children:"20. \u4EC0\u4E48\u662F Java \u7684 CountDownLatch\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"CountDownLatch\uFF08\u5012\u8BA1\u6570\u95E8\u6813\uFF09\u662F\u4E00\u4E2A\u540C\u6B65\u8F85\u52A9\u7C7B\uFF0C\u5141\u8BB8\u4E00\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\u5B8C\u6210\u64CD\u4F5C\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E\u8BA1\u6570\u5668\uFF0C\u521D\u59CB\u5316\u65F6\u8BBE\u7F6E\u8BA1\u6570\u503C"}),"\n",(0,i.jsxs)(e.li,{children:["\u8C03\u7528 ",(0,i.jsx)(e.code,{children:"countDown()"})," \u51CF\u5C11\u8BA1\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8C03\u7528 ",(0,i.jsx)(e.code,{children:"await()"})," \u963B\u585E\u76F4\u5230\u8BA1\u6570\u5F52\u96F6"]}),"\n",(0,i.jsx)(e.li,{children:"\u4E00\u6B21\u6027\u4F7F\u7528\uFF0C\u4E0D\u80FD\u91CD\u7F6E"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u672C\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CountDownLatch latch = new CountDownLatch(3);\n\n// \u5DE5\u4F5C\u7EBF\u7A0B\nfor (int i = 0; i < 3; i++) {\n    new Thread(() -> {\n        System.out.println(Thread.currentThread().getName() + " \u6267\u884C\u4EFB\u52A1");\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        latch.countDown(); // \u8BA1\u6570\u51CF1\n    }).start();\n}\n\n// \u4E3B\u7EBF\u7A0B\u7B49\u5F85\nlatch.await(); // \u963B\u585E\u76F4\u5230\u8BA1\u6570\u5F52\u96F6\nSystem.out.println("\u6240\u6709\u4EFB\u52A1\u5B8C\u6210");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7B49\u5F85\u591A\u4E2A\u7EBF\u7A0B\u5B8C\u6210\u521D\u59CB\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class ApplicationStartup {\n    private CountDownLatch latch;\n    \n    public void start() throws InterruptedException {\n        latch = new CountDownLatch(3);\n        \n        // \u521D\u59CB\u5316\u6570\u636E\u5E93\n        new Thread(() -> {\n            System.out.println("\u521D\u59CB\u5316\u6570\u636E\u5E93");\n            latch.countDown();\n        }).start();\n        \n        // \u521D\u59CB\u5316\u7F13\u5B58\n        new Thread(() -> {\n            System.out.println("\u521D\u59CB\u5316\u7F13\u5B58");\n            latch.countDown();\n        }).start();\n        \n        // \u521D\u59CB\u5316\u914D\u7F6E\n        new Thread(() -> {\n            System.out.println("\u521D\u59CB\u5316\u914D\u7F6E");\n            latch.countDown();\n        }).start();\n        \n        // \u7B49\u5F85\u6240\u6709\u521D\u59CB\u5316\u5B8C\u6210\n        latch.await();\n        System.out.println("\u5E94\u7528\u542F\u52A8\u5B8C\u6210");\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5E76\u884C\u4EFB\u52A1\u6267\u884C"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ParallelTask {\n    public void executeParallel(List<Runnable> tasks) throws InterruptedException {\n        CountDownLatch latch = new CountDownLatch(tasks.size());\n        \n        for (Runnable task : tasks) {\n            new Thread(() -> {\n                try {\n                    task.run();\n                } finally {\n                    latch.countDown();\n                }\n            }).start();\n        }\n        \n        latch.await(); // \u7B49\u5F85\u6240\u6709\u4EFB\u52A1\u5B8C\u6210\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6A21\u62DF\u5E76\u53D1\u6D4B\u8BD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class ConcurrencyTest {\n    public void testConcurrency(int threadCount) throws InterruptedException {\n        CountDownLatch startLatch = new CountDownLatch(1);\n        CountDownLatch endLatch = new CountDownLatch(threadCount);\n        \n        for (int i = 0; i < threadCount; i++) {\n            new Thread(() -> {\n                try {\n                    startLatch.await(); // \u7B49\u5F85\u5F00\u59CB\u4FE1\u53F7\n                    // \u6267\u884C\u6D4B\u8BD5\n                    System.out.println("\u6267\u884C\u6D4B\u8BD5");\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                } finally {\n                    endLatch.countDown();\n                }\n            }).start();\n        }\n        \n        startLatch.countDown(); // \u53D1\u51FA\u5F00\u59CB\u4FE1\u53F7\uFF0C\u6240\u6709\u7EBF\u7A0B\u540C\u65F6\u5F00\u59CB\n        endLatch.await(); // \u7B49\u5F85\u6240\u6709\u7EBF\u7A0B\u5B8C\u6210\n        System.out.println("\u6D4B\u8BD5\u5B8C\u6210");\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CountDownLatch vs CyclicBarrier\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"CountDownLatch"}),(0,i.jsx)(e.th,{children:"CyclicBarrier"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u91CD\u7528\u6027"}),(0,i.jsx)(e.td,{children:"\u4E0D\u53EF\u91CD\u7528"}),(0,i.jsx)(e.td,{children:"\u53EF\u91CD\u7528"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7B49\u5F85\u65B9\u5F0F"}),(0,i.jsx)(e.td,{children:"\u4E00\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u7B49\u5F85"}),(0,i.jsx)(e.td,{children:"\u6240\u6709\u7EBF\u7A0B\u76F8\u4E92\u7B49\u5F85"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8BA1\u6570\u65B9\u5F0F"}),(0,i.jsx)(e.td,{children:"\u9012\u51CF\u52300"}),(0,i.jsx)(e.td,{children:"\u9012\u589E\u5230N"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5C4F\u969C\u52A8\u4F5C"}),(0,i.jsx)(e.td,{children:"\u65E0"}),(0,i.jsx)(e.td,{children:"\u6709"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F7F\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u4E3B\u7EBF\u7A0B\u7B49\u5F85\u5B50\u7EBF\u7A0B"}),(0,i.jsx)(e.td,{children:"\u591A\u7EBF\u7A0B\u534F\u540C"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"21-\u4EC0\u4E48\u662F-java-\u7684-stampedlock",children:"21. \u4EC0\u4E48\u662F Java \u7684 StampedLock\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"22-\u4EC0\u4E48\u662F-java-\u7684-completablefuture",children:"22. \u4EC0\u4E48\u662F Java \u7684 CompletableFuture\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"23-\u4EC0\u4E48\u662F-java-\u7684-forkjoinpool",children:"23. \u4EC0\u4E48\u662F Java \u7684 ForkJoinPool\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"24-\u5982\u4F55\u5728-java-\u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F",children:"24. \u5982\u4F55\u5728 Java \u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"25-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217",children:"25. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"26-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B",children:"26. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u63D0\u4F9B\u4E86 java.util.concurrent.atomic \u5305\uFF0C\u5305\u542B\u591A\u79CD\u539F\u5B50\u7C7B\uFF0C\u4FDD\u8BC1\u64CD\u4F5C\u7684\u539F\u5B50\u6027\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u57FA\u672C\u7C7B\u578B\u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// AtomicInteger\nAtomicInteger count = new AtomicInteger(0);\ncount.incrementAndGet();  // i++\ncount.getAndIncrement();  // ++i\ncount.addAndGet(5);       // i += 5\ncount.compareAndSet(0, 1); // CAS\u64CD\u4F5C\n\n// AtomicLong\nAtomicLong longValue = new AtomicLong(0L);\n\n// AtomicBoolean\nAtomicBoolean flag = new AtomicBoolean(false);\nflag.compareAndSet(false, true);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u6570\u7EC4\u7C7B\u578B\u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// AtomicIntegerArray\nAtomicIntegerArray array = new AtomicIntegerArray(10);\narray.incrementAndGet(0);  // \u6570\u7EC4\u7D22\u5F150\u7684\u5143\u7D20+1\narray.compareAndSet(0, 1, 2); // CAS\u64CD\u4F5C\n\n// AtomicLongArray\nAtomicLongArray longArray = new AtomicLongArray(10);\n\n// AtomicReferenceArray\nAtomicReferenceArray<String> refArray = new AtomicReferenceArray<>(10);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// AtomicReference\nAtomicReference<User> userRef = new AtomicReference<>();\nUser oldUser = new User("\u5F20\u4E09");\nUser newUser = new User("\u674E\u56DB");\nuserRef.compareAndSet(oldUser, newUser);\n\n// AtomicStampedReference\uFF08\u89E3\u51B3ABA\u95EE\u9898\uFF09\nAtomicStampedReference<String> stampedRef = \n    new AtomicStampedReference<>("\u521D\u59CB\u503C", 0);\nint stamp = stampedRef.getStamp();\nstampedRef.compareAndSet("\u521D\u59CB\u503C", "\u65B0\u503C", stamp, stamp + 1);\n\n// AtomicMarkableReference\uFF08\u6807\u8BB0\u662F\u5426\u88AB\u4FEE\u6539\u8FC7\uFF09\nAtomicMarkableReference<String> markableRef = \n    new AtomicMarkableReference<>("\u521D\u59CB\u503C", false);\nmarkableRef.compareAndSet("\u521D\u59CB\u503C", "\u65B0\u503C", false, true);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u5B57\u6BB5\u66F4\u65B0\u5668"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'class User {\n    volatile int age;\n    volatile String name;\n}\n\n// AtomicIntegerFieldUpdater\nAtomicIntegerFieldUpdater<User> ageUpdater = \n    AtomicIntegerFieldUpdater.newUpdater(User.class, "age");\nUser user = new User();\nageUpdater.incrementAndGet(user);\n\n// AtomicReferenceFieldUpdater\nAtomicReferenceFieldUpdater<User, String> nameUpdater = \n    AtomicReferenceFieldUpdater.newUpdater(User.class, String.class, "name");\nnameUpdater.compareAndSet(user, "\u65E7\u540D\u5B57", "\u65B0\u540D\u5B57");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u8BA1\u6570\u5668\npublic class Counter {\n    private AtomicInteger count = new AtomicInteger(0);\n    \n    public void increment() {\n        count.incrementAndGet();\n    }\n    \n    public int getCount() {\n        return count.get();\n    }\n}\n\n// 2. \u5355\u4F8B\u6A21\u5F0F\npublic class Singleton {\n    private static final AtomicReference<Singleton> INSTANCE = \n        new AtomicReference<>();\n    \n    public static Singleton getInstance() {\n        while (true) {\n            Singleton current = INSTANCE.get();\n            if (current != null) {\n                return current;\n            }\n            current = new Singleton();\n            if (INSTANCE.compareAndSet(null, current)) {\n                return current;\n            }\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"27-\u4F60\u4F7F\u7528\u8FC7-java-\u7684\u7D2F\u52A0\u5668\u5417",children:"27. \u4F60\u4F7F\u7528\u8FC7 Java \u7684\u7D2F\u52A0\u5668\u5417\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java 8 \u5F15\u5165\u4E86\u7D2F\u52A0\u5668\uFF08Accumulator\uFF09\uFF0C\u5728\u9AD8\u5E76\u53D1\u573A\u666F\u4E0B\u6027\u80FD\u4F18\u4E8E\u539F\u5B50\u7C7B\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. LongAdder\uFF08\u957F\u6574\u578B\u7D2F\u52A0\u5668\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"LongAdder adder = new LongAdder();\n\n// \u591A\u7EBF\u7A0B\u7D2F\u52A0\nfor (int i = 0; i < 10; i++) {\n    new Thread(() -> {\n        for (int j = 0; j < 1000; j++) {\n            adder.increment(); // \u52A01\n            adder.add(5);      // \u52A05\n        }\n    }).start();\n}\n\n// \u83B7\u53D6\u7ED3\u679C\nlong sum = adder.sum();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. LongAccumulator\uFF08\u957F\u6574\u578B\u7D2F\u79EF\u5668\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u81EA\u5B9A\u4E49\u7D2F\u79EF\u51FD\u6570\uFF08\u6C42\u6700\u5927\u503C\uFF09\nLongAccumulator accumulator = new LongAccumulator(Long::max, Long.MIN_VALUE);\n\naccumulator.accumulate(100);\naccumulator.accumulate(200);\naccumulator.accumulate(50);\n\nlong max = accumulator.get(); // 200\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. DoubleAdder \u548C DoubleAccumulator"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"DoubleAdder doubleAdder = new DoubleAdder();\ndoubleAdder.add(1.5);\ndouble sum = doubleAdder.sum();\n\nDoubleAccumulator doubleAccumulator = \n    new DoubleAccumulator(Double::sum, 0.0);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// AtomicLong vs LongAdder \u6027\u80FD\u6D4B\u8BD5\npublic class PerformanceTest {\n    public static void testAtomicLong() {\n        AtomicLong atomicLong = new AtomicLong(0);\n        long start = System.currentTimeMillis();\n        \n        // 10\u4E2A\u7EBF\u7A0B\uFF0C\u6BCF\u4E2A\u7D2F\u52A0100\u4E07\u6B21\n        for (int i = 0; i < 10; i++) {\n            new Thread(() -> {\n                for (int j = 0; j < 1000000; j++) {\n                    atomicLong.incrementAndGet();\n                }\n            }).start();\n        }\n        \n        // AtomicLong: \u7EA62000ms\n    }\n    \n    public static void testLongAdder() {\n        LongAdder longAdder = new LongAdder();\n        long start = System.currentTimeMillis();\n        \n        for (int i = 0; i < 10; i++) {\n            new Thread(() -> {\n                for (int j = 0; j < 1000000; j++) {\n                    longAdder.increment();\n                }\n            }).start();\n        }\n        \n        // LongAdder: \u7EA6500ms\uFF08\u5FEB4\u500D\uFF09\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"AtomicLong\uFF1A\u6240\u6709\u7EBF\u7A0B\u7ADE\u4E89\u540C\u4E00\u4E2A\u53D8\u91CF\uFF0CCAS \u51B2\u7A81\u591A"}),"\n",(0,i.jsx)(e.li,{children:"LongAdder\uFF1A\u6BCF\u4E2A\u7EBF\u7A0B\u7EF4\u62A4\u81EA\u5DF1\u7684\u8BA1\u6570\u5668\uFF08Cell\uFF09\uFF0C\u6700\u540E\u6C47\u603B\uFF0C\u51CF\u5C11\u7ADE\u4E89"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u90E8\u7ED3\u6784\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"LongAdder\n\u251C\u2500\u2500 base (\u57FA\u7840\u503C)\n\u2514\u2500\u2500 cells[] (Cell\u6570\u7EC4)\n    \u251C\u2500\u2500 Cell[0] (\u7EBF\u7A0B1\u7684\u8BA1\u6570)\n    \u251C\u2500\u2500 Cell[1] (\u7EBF\u7A0B2\u7684\u8BA1\u6570)\n    \u2514\u2500\u2500 Cell[2] (\u7EBF\u7A0B3\u7684\u8BA1\u6570)\n\nsum() = base + Cell[0] + Cell[1] + Cell[2] + ...\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F4E\u5E76\u53D1\u573A\u666F\uFF1AAtomicLong\uFF08\u66F4\u7B80\u5355\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u9AD8\u5E76\u53D1\u7D2F\u52A0\uFF1ALongAdder\uFF08\u6027\u80FD\u66F4\u597D\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981 CAS \u64CD\u4F5C\uFF1AAtomicLong"}),"\n",(0,i.jsx)(e.li,{children:"\u53EA\u9700\u8981\u7D2F\u52A0\uFF1ALongAdder"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"28-\u4EC0\u4E48\u662F-java-\u7684-cascompare-and-swap\u64CD\u4F5C",children:"28. \u4EC0\u4E48\u662F Java \u7684 CAS\uFF08Compare-And-Swap\uFF09\u64CD\u4F5C\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"CAS\uFF08Compare-And-Swap\uFF09\u662F\u4E00\u79CD\u65E0\u9501\u7684\u539F\u5B50\u64CD\u4F5C\uFF0C\u7528\u4E8E\u5B9E\u73B0\u5E76\u53D1\u63A7\u5236\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"}),"\nCAS \u5305\u542B\u4E09\u4E2A\u64CD\u4F5C\u6570\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"V\uFF1A\u5185\u5B58\u4F4D\u7F6E\uFF08\u53D8\u91CF\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"E\uFF1A\u9884\u671F\u503C\uFF08Expected\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"N\uFF1A\u65B0\u503C\uFF08New\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u53EA\u6709\u5F53 V \u7684\u503C\u7B49\u4E8E E \u65F6\uFF0C\u624D\u5C06 V \u7684\u503C\u8BBE\u7F6E\u4E3A N\uFF0C\u5426\u5219\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C\u3002\u6574\u4E2A\u8FC7\u7A0B\u662F\u539F\u5B50\u7684\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F2A\u4EE3\u7801\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"boolean compareAndSwap(Variable V, int E, int N) {\n    if (V == E) {\n        V = N;\n        return true;\n    }\n    return false;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Java \u4E2D\u7684 CAS\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"AtomicInteger count = new AtomicInteger(0);\n\n// CAS \u64CD\u4F5C\nboolean success = count.compareAndSet(0, 1);\n// \u5982\u679C\u5F53\u524D\u503C\u662F0\uFF0C\u5219\u8BBE\u7F6E\u4E3A1\uFF0C\u8FD4\u56DEtrue\n// \u5982\u679C\u5F53\u524D\u503C\u4E0D\u662F0\uFF0C\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C\uFF0C\u8FD4\u56DEfalse\n\n// \u81EA\u65CB CAS\npublic void increment() {\n    int oldValue;\n    int newValue;\n    do {\n        oldValue = count.get();\n        newValue = oldValue + 1;\n    } while (!count.compareAndSet(oldValue, newValue));\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E95\u5C42\u5B9E\u73B0\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Unsafe \u7C7B\u63D0\u4F9B\u7684 CAS \u65B9\u6CD5\npublic final native boolean compareAndSwapInt(\n    Object o,      // \u5BF9\u8C61\n    long offset,   // \u5B57\u6BB5\u504F\u79FB\u91CF\n    int expected,  // \u9884\u671F\u503C\n    int x          // \u65B0\u503C\n);\n\n// CPU \u6307\u4EE4\uFF08x86\uFF09\nlock cmpxchg [\u5185\u5B58\u5730\u5740], \u65B0\u503C\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CAS \u7684\u4F18\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u65E0\u9501\uFF0C\u907F\u514D\u7EBF\u7A0B\u963B\u585E\u548C\u4E0A\u4E0B\u6587\u5207\u6362"}),"\n",(0,i.jsx)(e.li,{children:"\u6027\u80FD\u9AD8\u4E8E synchronized"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u4F4E\u5E76\u53D1\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CAS \u7684\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. ABA \u95EE\u9898"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B1\uFF1A\u8BFB\u53D6\u503CA\nint value = atomicInt.get(); // A\n\n// \u7EBF\u7A0B2\uFF1AA -> B -> A\natomicInt.compareAndSet(A, B);\natomicInt.compareAndSet(B, A);\n\n// \u7EBF\u7A0B1\uFF1ACAS\u6210\u529F\uFF0C\u4F46\u503C\u5DF2\u7ECF\u88AB\u4FEE\u6539\u8FC7\natomicInt.compareAndSet(A, C); // \u6210\u529F\uFF0C\u4F46\u4E0D\u77E5\u9053\u4E2D\u95F4\u53D8\u5316\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u4F7F\u7528\u7248\u672C\u53F7\nAtomicStampedReference<Integer> stampedRef = \n    new AtomicStampedReference<>(A, 0);\nint stamp = stampedRef.getStamp();\nstampedRef.compareAndSet(A, C, stamp, stamp + 1);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5FAA\u73AF\u65F6\u95F4\u957F\u5F00\u9500\u5927"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9AD8\u5E76\u53D1\u4E0B\uFF0CCAS \u5931\u8D25\u6B21\u6570\u591A\uFF0CCPU \u5F00\u9500\u5927\npublic void increment() {\n    int oldValue;\n    int newValue;\n    do {\n        oldValue = count.get();\n        newValue = oldValue + 1;\n        // \u9AD8\u5E76\u53D1\u4E0B\u53EF\u80FD\u5FAA\u73AF\u5F88\u591A\u6B21\n    } while (!count.compareAndSet(oldValue, newValue));\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u4F7F\u7528 LongAdder \u6216\u52A0\u9501\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u53EA\u80FD\u4FDD\u8BC1\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF\u7684\u539F\u5B50\u64CD\u4F5C"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u80FD\u540C\u65F6 CAS \u591A\u4E2A\u53D8\u91CF\n// \u89E3\u51B3\u65B9\u6848\uFF1A\n// 1. \u4F7F\u7528 AtomicReference \u5305\u88C5\u591A\u4E2A\u53D8\u91CF\nclass Pair {\n    int a;\n    int b;\n}\nAtomicReference<Pair> pairRef = new AtomicReference<>(new Pair());\n\n// 2. \u4F7F\u7528\u9501\nsynchronized (lock) {\n    a++;\n    b++;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u539F\u5B50\u7C7B\uFF08AtomicInteger\u3001AtomicReference\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u5E76\u53D1\u5BB9\u5668\uFF08ConcurrentHashMap\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"AQS\uFF08AbstractQueuedSynchronizer\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4E50\u89C2\u9501\u5B9E\u73B0"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"29-\u8BF4\u8BF4-aqs-\u5427",children:"29. \u8BF4\u8BF4 AQS \u5427\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"AQS\uFF08AbstractQueuedSynchronizer\uFF09\u662F Java \u5E76\u53D1\u5305\u7684\u6838\u5FC3\u57FA\u7840\u6846\u67B6\uFF0C\u7528\u4E8E\u6784\u5EFA\u9501\u548C\u540C\u6B65\u5668\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u601D\u60F3\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u4E00\u4E2A int \u7C7B\u578B\u7684 state \u53D8\u91CF\u8868\u793A\u540C\u6B65\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 FIFO \u961F\u5217\u7BA1\u7406\u7B49\u5F85\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B\u72EC\u5360\u6A21\u5F0F\u548C\u5171\u4EAB\u6A21\u5F0F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u7EC4\u4EF6\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u540C\u6B65\u72B6\u6001\uFF08state\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"private volatile int state;\n\n// \u83B7\u53D6\u72B6\u6001\nprotected final int getState()\n\n// \u8BBE\u7F6E\u72B6\u6001\nprotected final void setState(int newState)\n\n// CAS \u8BBE\u7F6E\u72B6\u6001\nprotected final boolean compareAndSetState(int expect, int update)\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u7B49\u5F85\u961F\u5217\uFF08CLH \u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"head -> Node1 -> Node2 -> Node3 -> tail\n        (\u7B49\u5F85)   (\u7B49\u5F85)   (\u7B49\u5F85)\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6BCF\u4E2A Node \u5305\u542B\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"thread\uFF1A\u7B49\u5F85\u7684\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"waitStatus\uFF1A\u7B49\u5F85\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"prev/next\uFF1A\u524D\u9A71/\u540E\u7EE7\u8282\u70B9"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5DE5\u4F5C\u6D41\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u72EC\u5360\u6A21\u5F0F\uFF08\u5982 ReentrantLock\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u5C1D\u8BD5\u83B7\u53D6\u9501\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) &&  // \u5C1D\u8BD5\u83B7\u53D6\uFF08\u5B50\u7C7B\u5B9E\u73B0\uFF09\n        acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) {  // \u52A0\u5165\u961F\u5217\u7B49\u5F85\n        selfInterrupt();\n    }\n}\n\n// 2. \u91CA\u653E\u9501\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {  // \u5C1D\u8BD5\u91CA\u653E\uFF08\u5B50\u7C7B\u5B9E\u73B0\uFF09\n        Node h = head;\n        if (h != null && h.waitStatus != 0)\n            unparkSuccessor(h);  // \u5524\u9192\u540E\u7EE7\u8282\u70B9\n        return true;\n    }\n    return false;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5171\u4EAB\u6A21\u5F0F\uFF08\u5982 Semaphore\u3001CountDownLatch\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u83B7\u53D6\u5171\u4EAB\u9501\npublic final void acquireShared(int arg) {\n    if (tryAcquireShared(arg) < 0)  // \u5C1D\u8BD5\u83B7\u53D6\n        doAcquireShared(arg);  // \u52A0\u5165\u961F\u5217\u7B49\u5F85\n}\n\n// \u91CA\u653E\u5171\u4EAB\u9501\npublic final boolean releaseShared(int arg) {\n    if (tryReleaseShared(arg)) {  // \u5C1D\u8BD5\u91CA\u653E\n        doReleaseShared();  // \u5524\u9192\u540E\u7EE7\u8282\u70B9\n        return true;\n    }\n    return false;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u540C\u6B65\u5668\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u81EA\u5B9A\u4E49\u4E92\u65A5\u9501\npublic class Mutex implements Lock {\n    private static class Sync extends AbstractQueuedSynchronizer {\n        // \u5C1D\u8BD5\u83B7\u53D6\u9501\n        @Override\n        protected boolean tryAcquire(int arg) {\n            return compareAndSetState(0, 1);\n        }\n        \n        // \u5C1D\u8BD5\u91CA\u653E\u9501\n        @Override\n        protected boolean tryRelease(int arg) {\n            setState(0);\n            return true;\n        }\n        \n        // \u662F\u5426\u88AB\u72EC\u5360\n        @Override\n        protected boolean isHeldExclusively() {\n            return getState() == 1;\n        }\n        \n        Condition newCondition() {\n            return new ConditionObject();\n        }\n    }\n    \n    private final Sync sync = new Sync();\n    \n    @Override\n    public void lock() {\n        sync.acquire(1);\n    }\n    \n    @Override\n    public void unlock() {\n        sync.release(1);\n    }\n    \n    // \u5176\u4ED6\u65B9\u6CD5\u5B9E\u73B0...\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u4E8E AQS \u7684\u540C\u6B65\u5668\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ReentrantLock\uFF1A\u72EC\u5360\u9501"}),"\n",(0,i.jsx)(e.li,{children:"ReentrantReadWriteLock\uFF1A\u8BFB\u5199\u9501"}),"\n",(0,i.jsx)(e.li,{children:"Semaphore\uFF1A\u4FE1\u53F7\u91CF"}),"\n",(0,i.jsx)(e.li,{children:"CountDownLatch\uFF1A\u5012\u8BA1\u6570\u95E8\u6813"}),"\n",(0,i.jsx)(e.li,{children:"CyclicBarrier\uFF1A\u5FAA\u73AF\u6805\u680F\uFF08\u57FA\u4E8E ReentrantLock\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"AQS \u7684\u4F18\u52BF\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B\u7EDF\u4E00\u7684\u6846\u67B6\uFF0C\u7B80\u5316\u540C\u6B65\u5668\u5B9E\u73B0"}),"\n",(0,i.jsx)(e.li,{children:"\u9AD8\u6548\u7684\u7B49\u5F85\u961F\u5217\u7BA1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u53EF\u4E2D\u65AD\u3001\u8D85\u65F6\u3001\u516C\u5E73/\u975E\u516C\u5E73"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B Condition \u652F\u6301"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"30-java-\u4E2D-reentrantlock-\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48",children:"30. Java \u4E2D ReentrantLock \u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"ReentrantLock \u662F\u57FA\u4E8E AQS \u5B9E\u73B0\u7684\u53EF\u91CD\u5165\u72EC\u5360\u9501\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u7279\u6027\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF\u91CD\u5165\uFF1A\u540C\u4E00\u7EBF\u7A0B\u53EF\u4EE5\u591A\u6B21\u83B7\u53D6\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u516C\u5E73/\u975E\u516C\u5E73\uFF1A\u652F\u6301\u4E24\u79CD\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u4E2D\u65AD\uFF1A\u652F\u6301\u4E2D\u65AD\u7B49\u5F85"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u8D85\u65F6\uFF1A\u652F\u6301\u8D85\u65F6\u83B7\u53D6\u9501"}),"\n",(0,i.jsx)(e.li,{children:"Condition \u652F\u6301\uFF1A\u652F\u6301\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u90E8\u7ED3\u6784\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ReentrantLock implements Lock {\n    private final Sync sync;\n    \n    // \u62BD\u8C61\u540C\u6B65\u5668\n    abstract static class Sync extends AbstractQueuedSynchronizer {\n        // state \u8868\u793A\u91CD\u5165\u6B21\u6570\n    }\n    \n    // \u975E\u516C\u5E73\u540C\u6B65\u5668\n    static final class NonfairSync extends Sync {\n        final void lock() {\n            // \u76F4\u63A5\u5C1D\u8BD5 CAS \u83B7\u53D6\u9501\n            if (compareAndSetState(0, 1))\n                setExclusiveOwnerThread(Thread.currentThread());\n            else\n                acquire(1);\n        }\n    }\n    \n    // \u516C\u5E73\u540C\u6B65\u5668\n    static final class FairSync extends Sync {\n        final void lock() {\n            // \u5FC5\u987B\u6392\u961F\n            acquire(1);\n        }\n        \n        protected final boolean tryAcquire(int acquires) {\n            // \u68C0\u67E5\u961F\u5217\u4E2D\u662F\u5426\u6709\u7B49\u5F85\u7EBF\u7A0B\n            if (hasQueuedPredecessors())\n                return false;\n            // ...\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u52A0\u9501\u6D41\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u975E\u516C\u5E73\u9501\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void lock() {\n    // 1. \u76F4\u63A5\u5C1D\u8BD5 CAS \u83B7\u53D6\u9501\n    if (compareAndSetState(0, 1)) {\n        setExclusiveOwnerThread(Thread.currentThread());\n        return;\n    }\n    \n    // 2. CAS \u5931\u8D25\uFF0C\u8C03\u7528 AQS \u7684 acquire\n    acquire(1);\n        // 2.1 tryAcquire\uFF1A\u518D\u6B21\u5C1D\u8BD5\u83B7\u53D6\n        // 2.2 \u5931\u8D25\u5219\u52A0\u5165\u7B49\u5F85\u961F\u5217\n        // 2.3 park \u963B\u585E\u7EBF\u7A0B\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u9501\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void lock() {\n    acquire(1);\n        // 1. tryAcquire\uFF1A\u68C0\u67E5\u961F\u5217\u662F\u5426\u6709\u7B49\u5F85\u7EBF\u7A0B\n        // 2. \u6709\u7B49\u5F85\u7EBF\u7A0B\u5219\u76F4\u63A5\u5931\u8D25\n        // 3. \u6CA1\u6709\u7B49\u5F85\u7EBF\u7A0B\u5219\u5C1D\u8BD5 CAS \u83B7\u53D6\n        // 4. \u5931\u8D25\u5219\u52A0\u5165\u961F\u5217\u7B49\u5F85\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u5165\u5B9E\u73B0\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'protected final boolean tryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    int c = getState();\n    \n    if (c == 0) {\n        // \u9501\u7A7A\u95F2\uFF0C\u5C1D\u8BD5\u83B7\u53D6\n        if (compareAndSetState(0, acquires)) {\n            setExclusiveOwnerThread(current);\n            return true;\n        }\n    } else if (current == getExclusiveOwnerThread()) {\n        // \u5F53\u524D\u7EBF\u7A0B\u5DF2\u6301\u6709\u9501\uFF0C\u91CD\u5165\n        int nextc = c + acquires;\n        if (nextc < 0) // \u6EA2\u51FA\u68C0\u67E5\n            throw new Error("Maximum lock count exceeded");\n        setState(nextc);  // \u589E\u52A0\u91CD\u5165\u6B21\u6570\n        return true;\n    }\n    return false;\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89E3\u9501\u6D41\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void unlock() {\n    release(1);\n}\n\nprotected final boolean tryRelease(int releases) {\n    int c = getState() - releases;\n    if (Thread.currentThread() != getExclusiveOwnerThread())\n        throw new IllegalMonitorStateException();\n    \n    boolean free = false;\n    if (c == 0) {\n        // \u91CD\u5165\u6B21\u6570\u5F52\u96F6\uFF0C\u5B8C\u5168\u91CA\u653E\u9501\n        free = true;\n        setExclusiveOwnerThread(null);\n    }\n    setState(c);  // \u51CF\u5C11\u91CD\u5165\u6B21\u6570\n    return free;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ReentrantLock lock = new ReentrantLock();\n\n// \u57FA\u672C\u4F7F\u7528\nlock.lock();\ntry {\n    // \u4E34\u754C\u533A\u4EE3\u7801\n} finally {\n    lock.unlock();\n}\n\n// \u53EF\u4E2D\u65AD\ntry {\n    lock.lockInterruptibly();\n    // \u4E34\u754C\u533A\u4EE3\u7801\n} catch (InterruptedException e) {\n    // \u5904\u7406\u4E2D\u65AD\n} finally {\n    lock.unlock();\n}\n\n// \u8D85\u65F6\u83B7\u53D6\nif (lock.tryLock(1, TimeUnit.SECONDS)) {\n    try {\n        // \u4E34\u754C\u533A\u4EE3\u7801\n    } finally {\n        lock.unlock();\n    }\n} else {\n    // \u83B7\u53D6\u9501\u5931\u8D25\n}\n\n// Condition \u4F7F\u7528\nCondition condition = lock.newCondition();\nlock.lock();\ntry {\n    condition.await();  // \u7B49\u5F85\n    condition.signal(); // \u5524\u9192\n} finally {\n    lock.unlock();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u9501 vs \u975E\u516C\u5E73\u9501\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u516C\u5E73\u9501"}),(0,i.jsx)(e.th,{children:"\u975E\u516C\u5E73\u9501"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u83B7\u53D6\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u6309\u6392\u961F\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u53EF\u63D2\u961F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u8F83\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u541E\u5410\u91CF"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u8F83\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7EBF\u7A0B\u5207\u6362"}),(0,i.jsx)(e.td,{children:"\u66F4\u591A"}),(0,i.jsx)(e.td,{children:"\u66F4\u5C11"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u9700\u8981\u516C\u5E73\u6027"}),(0,i.jsx)(e.td,{children:"\u8FFD\u6C42\u6027\u80FD"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9ED8\u8BA4\u4F7F\u7528\u975E\u516C\u5E73\u9501\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u975E\u516C\u5E73\u9501\uFF08\u9ED8\u8BA4\uFF09\nReentrantLock lock = new ReentrantLock();\n\n// \u516C\u5E73\u9501\nReentrantLock fairLock = new ReentrantLock(true);\n"})}),"\n",(0,i.jsx)(e.h3,{id:"31-java-\u7684-synchronized-\u662F\u600E\u4E48\u5B9E\u73B0\u7684",children:"31. Java \u7684 synchronized \u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"synchronized \u662F Java \u63D0\u4F9B\u7684\u5185\u7F6E\u9501\u673A\u5236\uFF0C\u57FA\u4E8E\u5BF9\u8C61\u76D1\u89C6\u5668\uFF08Monitor\uFF09\u5B9E\u73B0\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u5C42\u6B21\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u5B57\u8282\u7801\u5C42\u9762"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void syncMethod() {\n    synchronized (this) {\n        // \u4E34\u754C\u533A\u4EE3\u7801\n    }\n}\n\n// \u5B57\u8282\u7801\nmonitorenter  // \u8FDB\u5165\u76D1\u89C6\u5668\uFF08\u83B7\u53D6\u9501\uFF09\n// \u4E34\u754C\u533A\u4EE3\u7801\nmonitorexit   // \u9000\u51FA\u76D1\u89C6\u5668\uFF08\u91CA\u653E\u9501\uFF09\nmonitorexit   // \u5F02\u5E38\u60C5\u51B5\u7684\u91CA\u653E\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5BF9\u8C61\u5934\uFF08Mark Word\uFF09"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u5BF9\u8C61\u5728\u5185\u5B58\u4E2D\u7684\u5E03\u5C40\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"|--------------------------------------------------------------|\n| Object Header (\u5BF9\u8C61\u5934)                                        |\n|--------------------------------------------------------------|\n| Mark Word (\u6807\u8BB0\u5B57\u6BB5\uFF0C8\u5B57\u8282)                                    |\n| Class Pointer (\u7C7B\u578B\u6307\u9488\uFF0C4/8\u5B57\u8282)                              |\n|--------------------------------------------------------------|\n| Instance Data (\u5B9E\u4F8B\u6570\u636E)                                      |\n|--------------------------------------------------------------|\n| Padding (\u5BF9\u9F50\u586B\u5145)                                            |\n|--------------------------------------------------------------|\n"})}),"\n",(0,i.jsx)(e.p,{children:"Mark Word \u5B58\u50A8\u9501\u4FE1\u606F\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"|----------|---------------------------|\n| \u9501\u72B6\u6001    | Mark Word \u5185\u5BB9             |\n|----------|---------------------------|\n| \u65E0\u9501     | hashCode | age | 0 | 01   |\n| \u504F\u5411\u9501   | threadID | epoch | 1 | 01 |\n| \u8F7B\u91CF\u7EA7\u9501 | \u6808\u4E2D\u9501\u8BB0\u5F55\u6307\u9488 | 00        |\n| \u91CD\u91CF\u7EA7\u9501 | Monitor \u6307\u9488 | 10          |\n| GC\u6807\u8BB0   | \u7A7A | 11                      |\n|----------|---------------------------|\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u9501\u5347\u7EA7\u8FC7\u7A0B"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u9501 \u2192 \u504F\u5411\u9501 \u2192 \u8F7B\u91CF\u7EA7\u9501 \u2192 \u91CD\u91CF\u7EA7\u9501"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u504F\u5411\u9501\uFF08Biased Locking\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7B2C\u4E00\u6B21\u83B7\u53D6\u9501\n// 1. \u68C0\u67E5 Mark Word \u662F\u5426\u4E3A\u53EF\u504F\u5411\u72B6\u6001\n// 2. CAS \u5C06\u7EBF\u7A0B ID \u5199\u5165 Mark Word\n// 3. \u6210\u529F\u5219\u83B7\u53D6\u504F\u5411\u9501\n\n// \u518D\u6B21\u83B7\u53D6\u9501\uFF08\u540C\u4E00\u7EBF\u7A0B\uFF09\n// 1. \u68C0\u67E5 Mark Word \u4E2D\u7684\u7EBF\u7A0B ID\n// 2. \u5982\u679C\u662F\u5F53\u524D\u7EBF\u7A0B\uFF0C\u76F4\u63A5\u6267\u884C\uFF08\u65E0\u9700 CAS\uFF09\n\n// \u5176\u4ED6\u7EBF\u7A0B\u7ADE\u4E89\n// 1. \u64A4\u9500\u504F\u5411\u9501\n// 2. \u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8F7B\u91CF\u7EA7\u9501\uFF08Lightweight Locking\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u83B7\u53D6\u9501\n// 1. \u5728\u6808\u5E27\u4E2D\u521B\u5EFA\u9501\u8BB0\u5F55\uFF08Lock Record\uFF09\n// 2. \u590D\u5236 Mark Word \u5230\u9501\u8BB0\u5F55\n// 3. CAS \u5C06\u5BF9\u8C61\u5934\u7684 Mark Word \u66FF\u6362\u4E3A\u6307\u5411\u9501\u8BB0\u5F55\u7684\u6307\u9488\n// 4. \u6210\u529F\u5219\u83B7\u53D6\u8F7B\u91CF\u7EA7\u9501\n// 5. \u5931\u8D25\u5219\u81EA\u65CB\u91CD\u8BD5\n// 6. \u81EA\u65CB\u4E00\u5B9A\u6B21\u6570\u540E\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\n\n// \u91CA\u653E\u9501\n// 1. CAS \u5C06\u9501\u8BB0\u5F55\u4E2D\u7684 Mark Word \u66FF\u6362\u56DE\u5BF9\u8C61\u5934\n// 2. \u6210\u529F\u5219\u91CA\u653E\u9501\n// 3. \u5931\u8D25\u5219\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u91CF\u7EA7\u9501\uFF08Heavyweight Locking\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u83B7\u53D6\u9501\n// 1. \u5BF9\u8C61\u5934\u6307\u5411 Monitor \u5BF9\u8C61\n// 2. \u7EBF\u7A0B\u8FDB\u5165 Monitor \u7684 EntryList\n// 3. \u7ADE\u4E89 Monitor \u7684 owner\n// 4. \u83B7\u53D6\u5931\u8D25\u5219\u963B\u585E\uFF08park\uFF09\n\n// Monitor \u7ED3\u6784\nObjectMonitor {\n    _owner;      // \u6301\u6709\u9501\u7684\u7EBF\u7A0B\n    _EntryList;  // \u7B49\u5F85\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u961F\u5217\n    _WaitSet;    // \u8C03\u7528 wait() \u7684\u7EBF\u7A0B\u961F\u5217\n    _count;      // \u91CD\u5165\u6B21\u6570\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B8C\u6574\u6D41\u7A0B\u56FE\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u5BF9\u8C61\u521B\u5EFA\n   \u2193\n\u65E0\u9501\u72B6\u6001\uFF08001\uFF09\n   \u2193 \u7EBF\u7A0B1\u8BBF\u95EE\n\u504F\u5411\u9501\uFF08101\uFF09- \u7EBF\u7A0BID = \u7EBF\u7A0B1\n   \u2193 \u7EBF\u7A0B2\u7ADE\u4E89\n\u8F7B\u91CF\u7EA7\u9501\uFF0800\uFF09- \u81EA\u65CB\u83B7\u53D6\n   \u2193 \u81EA\u65CB\u5931\u8D25/\u7ADE\u4E89\u6FC0\u70C8\n\u91CD\u91CF\u7EA7\u9501\uFF0810\uFF09- \u963B\u585E\u7B49\u5F85\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4EE3\u7801\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class SynchronizedDemo {\n    private Object lock = new Object();\n    \n    // \u540C\u6B65\u4EE3\u7801\u5757\n    public void method1() {\n        synchronized (lock) {\n            // \u4E34\u754C\u533A\n        }\n    }\n    \n    // \u540C\u6B65\u5B9E\u4F8B\u65B9\u6CD5\uFF08\u9501\u662F this\uFF09\n    public synchronized void method2() {\n        // \u4E34\u754C\u533A\n    }\n    \n    // \u540C\u6B65\u9759\u6001\u65B9\u6CD5\uFF08\u9501\u662F Class \u5BF9\u8C61\uFF09\n    public static synchronized void method3() {\n        // \u4E34\u754C\u533A\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F18\u5316\u6280\u672F\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u6D88\u9664"}),"\uFF1AJIT \u7F16\u8BD1\u5668\u68C0\u6D4B\u5230\u4E0D\u53EF\u80FD\u5B58\u5728\u7ADE\u4E89\uFF0C\u6D88\u9664\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u7C97\u5316"}),"\uFF1A\u591A\u4E2A\u8FDE\u7EED\u7684\u52A0\u9501\u89E3\u9501\u64CD\u4F5C\u5408\u5E76\u4E3A\u4E00\u6B21"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u9002\u5E94\u81EA\u65CB"}),"\uFF1A\u6839\u636E\u5386\u53F2\u81EA\u65CB\u6210\u529F\u7387\u52A8\u6001\u8C03\u6574\u81EA\u65CB\u6B21\u6570"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"32-synchronized-\u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B",children:"32. Synchronized \u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u4E3B\u8981\u533A\u522B\u5728\u4E8E\u9501\u7684\u5BF9\u8C61\u4E0D\u540C\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4FEE\u9970\u666E\u901A\u65B9\u6CD5\uFF08\u5B9E\u4F8B\u65B9\u6CD5\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class MyClass {\n    // \u9501\u5BF9\u8C61\u662F this\uFF08\u5F53\u524D\u5B9E\u4F8B\uFF09\n    public synchronized void instanceMethod() {\n        // \u4E34\u754C\u533A\n    }\n    \n    // \u7B49\u4EF7\u4E8E\n    public void instanceMethod2() {\n        synchronized (this) {\n            // \u4E34\u754C\u533A\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9501\u5BF9\u8C61\u662F\u5F53\u524D\u5B9E\u4F8B\uFF08this\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u540C\u5B9E\u4F8B\u4E4B\u95F4\u4E0D\u4E92\u65A5"}),"\n",(0,i.jsx)(e.li,{children:"\u540C\u4E00\u5B9E\u4F8B\u7684\u591A\u4E2A\u540C\u6B65\u65B9\u6CD5\u4E92\u65A5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"MyClass obj1 = new MyClass();\nMyClass obj2 = new MyClass();\n\n// \u7EBF\u7A0B1\u548C\u7EBF\u7A0B2\u4E0D\u4E92\u65A5\uFF08\u4E0D\u540C\u5B9E\u4F8B\uFF09\nnew Thread(() -> obj1.instanceMethod()).start();\nnew Thread(() -> obj2.instanceMethod()).start();\n\n// \u7EBF\u7A0B3\u548C\u7EBF\u7A0B4\u4E92\u65A5\uFF08\u540C\u4E00\u5B9E\u4F8B\uFF09\nnew Thread(() -> obj1.instanceMethod()).start();\nnew Thread(() -> obj1.instanceMethod()).start();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u4FEE\u9970\u9759\u6001\u65B9\u6CD5\uFF08\u7C7B\u65B9\u6CD5\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class MyClass {\n    // \u9501\u5BF9\u8C61\u662F MyClass.class\uFF08\u7C7B\u5BF9\u8C61\uFF09\n    public static synchronized void staticMethod() {\n        // \u4E34\u754C\u533A\n    }\n    \n    // \u7B49\u4EF7\u4E8E\n    public static void staticMethod2() {\n        synchronized (MyClass.class) {\n            // \u4E34\u754C\u533A\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9501\u5BF9\u8C61\u662F Class \u5BF9\u8C61\uFF08MyClass.class\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u6240\u6709\u5B9E\u4F8B\u5171\u4EAB\u540C\u4E00\u4E2A\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u7C7B\u7684\u6240\u6709\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u4E92\u65A5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"MyClass obj1 = new MyClass();\nMyClass obj2 = new MyClass();\n\n// \u7EBF\u7A0B1\u548C\u7EBF\u7A0B2\u4E92\u65A5\uFF08\u5171\u4EAB\u7C7B\u9501\uFF09\nnew Thread(() -> MyClass.staticMethod()).start();\nnew Thread(() -> MyClass.staticMethod()).start();\n\n// \u7EBF\u7A0B3\u548C\u7EBF\u7A0B4\u4E5F\u4E92\u65A5\uFF08\u5171\u4EAB\u7C7B\u9501\uFF09\nnew Thread(() -> obj1.staticMethod()).start();\nnew Thread(() -> obj2.staticMethod()).start();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6DF7\u5408\u4F7F\u7528"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class MyClass {\n    // \u5B9E\u4F8B\u9501\n    public synchronized void instanceMethod() {\n        System.out.println("\u5B9E\u4F8B\u65B9\u6CD5");\n    }\n    \n    // \u7C7B\u9501\n    public static synchronized void staticMethod() {\n        System.out.println("\u9759\u6001\u65B9\u6CD5");\n    }\n}\n\n// \u4E0D\u4E92\u65A5\uFF08\u9501\u5BF9\u8C61\u4E0D\u540C\uFF09\nnew Thread(() -> new MyClass().instanceMethod()).start();\nnew Thread(() -> MyClass.staticMethod()).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u4FEE\u9970\u5B9E\u4F8B\u65B9\u6CD5"}),(0,i.jsx)(e.th,{children:"\u4FEE\u9970\u9759\u6001\u65B9\u6CD5"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9501\u5BF9\u8C61"}),(0,i.jsx)(e.td,{children:"this\uFF08\u5B9E\u4F8B\u5BF9\u8C61\uFF09"}),(0,i.jsx)(e.td,{children:"Class \u5BF9\u8C61"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F5C\u7528\u8303\u56F4"}),(0,i.jsx)(e.td,{children:"\u5F53\u524D\u5B9E\u4F8B"}),(0,i.jsx)(e.td,{children:"\u6240\u6709\u5B9E\u4F8B"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4E92\u65A5\u8303\u56F4"}),(0,i.jsx)(e.td,{children:"\u540C\u4E00\u5B9E\u4F8B\u7684\u540C\u6B65\u65B9\u6CD5"}),(0,i.jsx)(e.td,{children:"\u6240\u6709\u9759\u6001\u540C\u6B65\u65B9\u6CD5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F7F\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u5B9E\u4F8B\u53D8\u91CF\u4FDD\u62A4"}),(0,i.jsx)(e.td,{children:"\u9759\u6001\u53D8\u91CF\u4FDD\u62A4"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Counter {\n    private int instanceCount = 0;\n    private static int staticCount = 0;\n    \n    // \u4FDD\u62A4\u5B9E\u4F8B\u53D8\u91CF\n    public synchronized void incrementInstance() {\n        instanceCount++;\n    }\n    \n    // \u4FDD\u62A4\u9759\u6001\u53D8\u91CF\n    public static synchronized void incrementStatic() {\n        staticCount++;\n    }\n    \n    // \u6216\u8005\u4F7F\u7528\u663E\u5F0F\u9501\u5BF9\u8C61\n    private final Object instanceLock = new Object();\n    private static final Object staticLock = new Object();\n    \n    public void increment() {\n        synchronized (instanceLock) {\n            instanceCount++;\n        }\n    }\n    \n    public static void incrementStatic2() {\n        synchronized (staticLock) {\n            staticCount++;\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"33-java-\u4E2D\u7684-synchronized-\u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB",children:"33. Java \u4E2D\u7684 synchronized \u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u662F\u7684\uFF0C\u8F7B\u91CF\u7EA7\u9501\u4F1A\u8FDB\u884C\u81EA\u65CB\uFF0C\u4F46\u6709\u6761\u4EF6\u9650\u5236\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7684\u539F\u56E0\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u7EBF\u7A0B\u963B\u585E\u548C\u5524\u9192\u7684\u5F00\u9500"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u9501\u6301\u6709\u65F6\u95F4\u77ED\u7684\u573A\u666F"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u5728\u7528\u6237\u6001\u81EA\u65CB\uFF0C\u4E0D\u8FDB\u5165\u5185\u6838\u6001"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u8FC7\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u8F7B\u91CF\u7EA7\u9501\u83B7\u53D6\u6D41\u7A0B\nwhile (true) {\n    // 1. \u5C1D\u8BD5 CAS \u83B7\u53D6\u9501\n    if (CAS\u6210\u529F) {\n        \u83B7\u53D6\u9501\u6210\u529F;\n        break;\n    }\n    \n    // 2. CAS \u5931\u8D25\uFF0C\u81EA\u65CB\u91CD\u8BD5\n    if (\u81EA\u65CB\u6B21\u6570 < \u6700\u5927\u81EA\u65CB\u6B21\u6570) {\n        \u81EA\u65CB\u6B21\u6570++;\n        continue; // \u7EE7\u7EED\u81EA\u65CB\n    } else {\n        // 3. \u81EA\u65CB\u5931\u8D25\uFF0C\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\n        \u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501();\n        \u963B\u585E\u7B49\u5F85();\n        break;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7B56\u7565\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u56FA\u5B9A\u6B21\u6570\u81EA\u65CB\uFF08JDK 1.6 \u4E4B\u524D\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9ED8\u8BA4\u81EA\u65CB10\u6B21\n-XX:PreBlockSpin=10\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u81EA\u9002\u5E94\u81EA\u65CB\uFF08JDK 1.6+\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u6839\u636E\u5386\u53F2\u81EA\u65CB\u6210\u529F\u7387\u52A8\u6001\u8C03\u6574\nif (\u4E0A\u6B21\u81EA\u65CB\u6210\u529F) {\n    \u5141\u8BB8\u66F4\u591A\u6B21\u81EA\u65CB;\n} else {\n    \u51CF\u5C11\u81EA\u65CB\u6B21\u6570;\n}\n\n// \u5982\u679C\u67D0\u4E2A\u9501\u81EA\u65CB\u5F88\u5C11\u6210\u529F\uFF0C\u53EF\u80FD\u76F4\u63A5\u7701\u7565\u81EA\u65CB\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7684\u6761\u4EF6\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CPU \u6838\u5FC3\u6570 > 1"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5355\u6838 CPU \u81EA\u65CB\u65E0\u610F\u4E49\uFF08\u6301\u6709\u9501\u7684\u7EBF\u7A0B\u65E0\u6CD5\u91CA\u653E\uFF09"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9501\u6301\u6709\u65F6\u95F4\u77ED"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u81EA\u65CB\u65F6\u95F4 < \u7EBF\u7A0B\u963B\u585E/\u5524\u9192\u65F6\u95F4"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7ADE\u4E89\u4E0D\u6FC0\u70C8"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7ADE\u4E89\u6FC0\u70C8\u65F6\u76F4\u63A5\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u4F18\u5316\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class SpinLockDemo {\n    private AtomicReference<Thread> owner = new AtomicReference<>();\n    \n    public void lock() {\n        Thread current = Thread.currentThread();\n        \n        // \u81EA\u65CB\u83B7\u53D6\u9501\n        while (!owner.compareAndSet(null, current)) {\n            // \u81EA\u65CB\u7B49\u5F85\n            // CPU \u7A7A\u8F6C\uFF0C\u4E0D\u91CA\u653E CPU\n        }\n    }\n    \n    public void unlock() {\n        Thread current = Thread.currentThread();\n        owner.compareAndSet(current, null);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7684\u4F18\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u7EBF\u7A0B\u963B\u585E\u548C\u4E0A\u4E0B\u6587\u5207\u6362"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u9501\u6301\u6709\u65F6\u95F4\u77ED\u7684\u573A\u666F"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u9AD8\u5E76\u53D1\u6027\u80FD"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5360\u7528 CPU \u8D44\u6E90"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u6301\u6709\u65F6\u95F4\u957F\u65F6\u6D6A\u8D39 CPU"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u80FD\u5BFC\u81F4 CPU \u4F7F\u7528\u7387\u9AD8"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"JVM \u53C2\u6570\u63A7\u5236\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5F00\u542F/\u5173\u95ED\u81EA\u65CB\u9501\u4F18\u5316\uFF08\u9ED8\u8BA4\u5F00\u542F\uFF09\n-XX:+UseSpinning\n-XX:-UseSpinning\n\n# \u8BBE\u7F6E\u81EA\u65CB\u6B21\u6570\uFF08JDK 1.6 \u4E4B\u524D\uFF09\n-XX:PreBlockSpin=10\n\n# \u5F00\u542F\u81EA\u9002\u5E94\u81EA\u65CB\uFF08JDK 1.6+ \u9ED8\u8BA4\u5F00\u542F\uFF09\n-XX:+UseAdaptiveSpinning\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9501\u5347\u7EA7\u4E0E\u81EA\u65CB\u7684\u5173\u7CFB\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u504F\u5411\u9501\n   \u2193 \u6709\u7ADE\u4E89\n\u8F7B\u91CF\u7EA7\u9501\uFF08\u81EA\u65CB\u83B7\u53D6\uFF09\n   \u2193 \u81EA\u65CB\u5931\u8D25\n\u91CD\u91CF\u7EA7\u9501\uFF08\u963B\u585E\u7B49\u5F85\uFF09\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u5E94\u7528\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9501\u6301\u6709\u65F6\u95F4\u77ED\uFF08\u51E0\u5341\u4E2A\u6307\u4EE4\uFF09\uFF1A\u81EA\u65CB\u6709\u6548"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u6301\u6709\u65F6\u95F4\u957F\uFF1A\u81EA\u65CB\u6D6A\u8D39 CPU\uFF0C\u5E94\u76F4\u63A5\u963B\u585E"}),"\n",(0,i.jsx)(e.li,{children:"\u9AD8\u5E76\u53D1\u573A\u666F\uFF1A\u8003\u8651\u4F7F\u7528 ReentrantLock \u6216\u65E0\u9501\u65B9\u6848"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"34-synchronized-\u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F",children:"34. Synchronized \u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"35-\u5F53-java-\u7684-synchronized-\u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417",children:"35. \u5F53 Java \u7684 synchronized \u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\uFF0C\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\uFF0C\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"36-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB",children:"36. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"37-synchronized-\u548C-reentrantlock-\u6709\u4EC0\u4E48\u533A\u522B",children:"37. Synchronized \u548C ReentrantLock \u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"38-volatile-\u4E0E-synchronized-\u7684\u533A\u522B\u662F\u4EC0\u4E48",children:"38. Volatile \u4E0E Synchronized \u7684\u533A\u522B\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"39-\u5982\u4F55\u4F18\u5316-java-\u4E2D\u7684\u9501\u7684\u4F7F\u7528",children:"39. \u5982\u4F55\u4F18\u5316 Java \u4E2D\u7684\u9501\u7684\u4F7F\u7528\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"40-\u4F60\u4E86\u89E3-java-\u4E2D\u7684\u8BFB\u5199\u9501\u5417",children:"40. \u4F60\u4E86\u89E3 Java \u4E2D\u7684\u8BFB\u5199\u9501\u5417\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"41-\u4EC0\u4E48\u662F-java-\u5185\u5B58\u6A21\u578Bjmm",children:"41. \u4EC0\u4E48\u662F Java \u5185\u5B58\u6A21\u578B\uFF08JMM\uFF09\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"42-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u539F\u5B50\u6027\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027",children:"42. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"43-\u4EC0\u4E48\u662F-java-\u7684-happens-before-\u89C4\u5219",children:"43. \u4EC0\u4E48\u662F Java \u7684 happens-before \u89C4\u5219\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"44-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u6307\u4EE4\u91CD\u6392",children:"44. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u6307\u4EE4\u91CD\u6392\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"45-java-\u4E2D\u7684-final-\u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027",children:"45. Java \u4E2D\u7684 final \u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"46-\u4E3A\u4EC0\u4E48\u5728-java-\u4E2D\u9700\u8981\u4F7F\u7528-threadlocal",children:"46. \u4E3A\u4EC0\u4E48\u5728 Java \u4E2D\u9700\u8981\u4F7F\u7528 ThreadLocal\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"47-java-\u4E2D\u7684-threadlocal-\u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684",children:"47. Java \u4E2D\u7684 ThreadLocal \u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"48-\u4E3A\u4EC0\u4E48-java-\u4E2D\u7684-threadlocal-\u5BF9-key-\u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528",children:"48. \u4E3A\u4EC0\u4E48 Java \u4E2D\u7684 ThreadLocal \u5BF9 key \u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"49-java-\u4E2D\u4F7F\u7528-threadlocal-\u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48",children:"49. Java \u4E2D\u4F7F\u7528 ThreadLocal \u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"50-java-\u4E2D\u7684-inheritablethreadlocal-\u662F\u4EC0\u4E48",children:"50. Java \u4E2D\u7684 InheritableThreadLocal \u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"51-threadlocal-\u7684\u7F3A\u70B9",children:"51. ThreadLocal \u7684\u7F3A\u70B9\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"52-\u4E3A\u4EC0\u4E48-netty-\u4E0D\u4F7F\u7528-threadlocal-\u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A-fastthreadlocal-",children:"52. \u4E3A\u4EC0\u4E48 Netty \u4E0D\u4F7F\u7528 ThreadLocal \u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A FastThreadLocal \uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"53-\u4EC0\u4E48\u662F-java-\u7684-transmittablethreadlocal",children:"53. \u4EC0\u4E48\u662F Java \u7684 TransmittableThreadLocal\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"54-java-\u4E2D-threadsleep-\u548C-threadyield-\u7684\u533A\u522B",children:"54. Java \u4E2D Thread.sleep \u548C Thread.yield \u7684\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"55-java-\u4E2D-threadsleep0-\u7684\u4F5C\u7528\u662F\u4EC0\u4E48",children:"55. Java \u4E2D Thread.sleep(0) \u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"56-java-\u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\u5982\u4F55\u907F\u514D",children:"56. Java \u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\uFF1F\u5982\u4F55\u907F\u514D\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"57-java-\u4E2D-volatile-\u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48",children:"57. Java \u4E2D volatile \u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"58-\u4EC0\u4E48\u662F-java-\u4E2D\u7684-aba-\u95EE\u9898",children:"58. \u4EC0\u4E48\u662F Java \u4E2D\u7684 ABA \u95EE\u9898\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"59-\u5728-java-\u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F",children:"59. \u5728 Java \u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"60-\u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F",children:"60. \u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F"}),"\n",(0,i.jsx)(e.h3,{id:"61-\u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B",children:"61. \u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B?"}),"\n",(0,i.jsx)(e.h3,{id:"62-java-\u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F",children:"62. Java \u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u5B66\u4E60\u6307\u5357",children:"\u5B66\u4E60\u6307\u5357"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u8981\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Java \u7EBF\u7A0B\u751F\u547D\u5468\u671F\u548C\u72B6\u6001\u8F6C\u6362"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u673A\u5236\u548C\u5E76\u53D1\u63A7\u5236\u539F\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u5E76\u53D1\u5BB9\u5668\u548C\u539F\u5B50\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u5185\u5B58\u6A21\u578B\u548C\u53EF\u89C1\u6027\u4FDD\u8BC1"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u638C\u63E1 Java \u7EBF\u7A0B\u57FA\u7840\u548C\u751F\u547D\u5468\u671F"}),"\n",(0,i.jsx)(e.li,{children:"\u6DF1\u5165\u7406\u89E3\u9501\u673A\u5236\u548C AQS \u539F\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u719F\u6089\u5E76\u53D1\u5BB9\u5668\u548C\u539F\u5B50\u7C7B"}),"\n",(0,i.jsx)(e.li,{children:"\u638C\u63E1 JMM \u548C\u5E76\u53D1\u7F16\u7A0B\u6700\u4F73\u5B9E\u8DF5"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"21-\u4EC0\u4E48\u662F-java-\u7684-stampedlock-1",children:"21. \u4EC0\u4E48\u662F Java \u7684 StampedLock\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"StampedLock \u662F Java 8 \u5F15\u5165\u7684\u4E00\u79CD\u9501\uFF0C\u63D0\u4F9B\u4E86\u4E09\u79CD\u6A21\u5F0F\u7684\u8BFB\u5199\u63A7\u5236\uFF0C\u6027\u80FD\u4F18\u4E8E ReadWriteLock\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E09\u79CD\u9501\u6A21\u5F0F\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5199\u9501\uFF08Writing\uFF09"}),"\uFF1A\u72EC\u5360\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u60B2\u89C2\u8BFB\u9501\uFF08Reading\uFF09"}),"\uFF1A\u5171\u4EAB\u9501\uFF0C\u4E0D\u5141\u8BB8\u5199"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E50\u89C2\u8BFB\uFF08Optimistic Reading\uFF09"}),"\uFF1A\u4E0D\u52A0\u9501\uFF0C\u901A\u8FC7\u7248\u672C\u53F7\u9A8C\u8BC1"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u672C\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Point {\n    private double x, y;\n    private final StampedLock lock = new StampedLock();\n    \n    // \u5199\u64CD\u4F5C\n    public void move(double deltaX, double deltaY) {\n        long stamp = lock.writeLock(); // \u83B7\u53D6\u5199\u9501\n        try {\n            x += deltaX;\n            y += deltaY;\n        } finally {\n            lock.unlockWrite(stamp); // \u91CA\u653E\u5199\u9501\n        }\n    }\n    \n    // \u4E50\u89C2\u8BFB\n    public double distanceFromOrigin() {\n        long stamp = lock.tryOptimisticRead(); // \u4E50\u89C2\u8BFB\n        double currentX = x;\n        double currentY = y;\n        \n        if (!lock.validate(stamp)) { // \u9A8C\u8BC1\u662F\u5426\u6709\u5199\u64CD\u4F5C\n            stamp = lock.readLock(); // \u5347\u7EA7\u4E3A\u60B2\u89C2\u8BFB\u9501\n            try {\n                currentX = x;\n                currentY = y;\n            } finally {\n                lock.unlockRead(stamp);\n            }\n        }\n        \n        return Math.sqrt(currentX * currentX + currentY * currentY);\n    }\n    \n    // \u60B2\u89C2\u8BFB\n    public double getX() {\n        long stamp = lock.readLock();\n        try {\n            return x;\n        } finally {\n            lock.unlockRead(stamp);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9501\u5347\u7EA7\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u8BFB\u9501\u5347\u7EA7\u4E3A\u5199\u9501\nlong stamp = lock.readLock();\ntry {\n    // \u8BFB\u53D6\u6570\u636E\n    long writeStamp = lock.tryConvertToWriteLock(stamp);\n    if (writeStamp != 0L) {\n        stamp = writeStamp;\n        // \u6267\u884C\u5199\u64CD\u4F5C\n    } else {\n        lock.unlockRead(stamp);\n        stamp = lock.writeLock();\n        // \u6267\u884C\u5199\u64CD\u4F5C\n    }\n} finally {\n    lock.unlock(stamp);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E50\u89C2\u8BFB\u4E0D\u963B\u585E\u5199\u64CD\u4F5C\uFF0C\u6027\u80FD\u66F4\u597D"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u652F\u6301\u91CD\u5165"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u652F\u6301 Condition"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u8BFB\u591A\u5199\u5C11\u7684\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E0E ReadWriteLock \u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"StampedLock"}),(0,i.jsx)(e.th,{children:"ReadWriteLock"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4E50\u89C2\u8BFB"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u66F4\u9AD8"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u91CD\u5165"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Condition"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"22-\u4EC0\u4E48\u662F-java-\u7684-completablefuture-1",children:"22. \u4EC0\u4E48\u662F Java \u7684 CompletableFuture\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"CompletableFuture \u662F Java 8 \u5F15\u5165\u7684\u5F02\u6B65\u7F16\u7A0B\u5DE5\u5177\uFF0C\u5B9E\u73B0\u4E86 Future \u548C CompletionStage \u63A5\u53E3\uFF0C\u652F\u6301\u94FE\u5F0F\u8C03\u7528\u548C\u7EC4\u5408\u64CD\u4F5C\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u521B\u5EFA CompletableFuture\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// 1. \u65E0\u8FD4\u56DE\u503C\u5F02\u6B65\u4EFB\u52A1\nCompletableFuture<Void> future1 = CompletableFuture.runAsync(() -> {\n    System.out.println("\u5F02\u6B65\u4EFB\u52A1");\n});\n\n// 2. \u6709\u8FD4\u56DE\u503C\u5F02\u6B65\u4EFB\u52A1\nCompletableFuture<String> future2 = CompletableFuture.supplyAsync(() -> {\n    return "\u7ED3\u679C";\n});\n\n// 3. \u624B\u52A8\u5B8C\u6210\nCompletableFuture<String> future3 = new CompletableFuture<>();\nfuture3.complete("\u624B\u52A8\u8BBE\u7F6E\u7ED3\u679C");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u94FE\u5F0F\u8C03\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CompletableFuture.supplyAsync(() -> {\n    return "Hello";\n})\n.thenApply(s -> s + " World")           // \u8F6C\u6362\u7ED3\u679C\n.thenApply(String::toUpperCase)         // \u7EE7\u7EED\u8F6C\u6362\n.thenAccept(System.out::println)        // \u6D88\u8D39\u7ED3\u679C\n.thenRun(() -> System.out.println("\u5B8C\u6210")); // \u6267\u884C\u52A8\u4F5C\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7EC4\u5408\u64CD\u4F5C\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// 1. \u4E24\u4E2A\u4EFB\u52A1\u90FD\u5B8C\u6210\u540E\u6267\u884C\nCompletableFuture<String> future1 = CompletableFuture.supplyAsync(() -> "Hello");\nCompletableFuture<String> future2 = CompletableFuture.supplyAsync(() -> "World");\n\nCompletableFuture<String> combined = future1.thenCombine(future2, (s1, s2) -> {\n    return s1 + " " + s2;\n});\n\n// 2. \u4EFB\u610F\u4E00\u4E2A\u5B8C\u6210\u540E\u6267\u884C\nCompletableFuture<String> fastest = future1.applyToEither(future2, s -> s);\n\n// 3. \u6240\u6709\u4EFB\u52A1\u5B8C\u6210\nCompletableFuture<Void> allOf = CompletableFuture.allOf(future1, future2);\n\n// 4. \u4EFB\u610F\u4EFB\u52A1\u5B8C\u6210\nCompletableFuture<Object> anyOf = CompletableFuture.anyOf(future1, future2);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5F02\u5E38\u5904\u7406\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CompletableFuture.supplyAsync(() -> {\n    if (true) throw new RuntimeException("\u9519\u8BEF");\n    return "\u7ED3\u679C";\n})\n.exceptionally(ex -> {\n    System.out.println("\u5F02\u5E38\u5904\u7406: " + ex.getMessage());\n    return "\u9ED8\u8BA4\u503C";\n})\n.handle((result, ex) -> {\n    if (ex != null) {\n        return "\u5F02\u5E38: " + ex.getMessage();\n    }\n    return result;\n})\n.whenComplete((result, ex) -> {\n    if (ex != null) {\n        System.out.println("\u5931\u8D25: " + ex.getMessage());\n    } else {\n        System.out.println("\u6210\u529F: " + result);\n    }\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5E76\u884C\u8C03\u7528\u591A\u4E2A\u670D\u52A1\npublic CompletableFuture<OrderInfo> getOrderInfo(String orderId) {\n    CompletableFuture<Order> orderFuture = \n        CompletableFuture.supplyAsync(() -> orderService.getOrder(orderId));\n    \n    CompletableFuture<User> userFuture = \n        CompletableFuture.supplyAsync(() -> userService.getUser(orderId));\n    \n    CompletableFuture<Product> productFuture = \n        CompletableFuture.supplyAsync(() -> productService.getProduct(orderId));\n    \n    return orderFuture.thenCombine(userFuture, (order, user) -> {\n        return new OrderInfo(order, user);\n    }).thenCombine(productFuture, (orderInfo, product) -> {\n        orderInfo.setProduct(product);\n        return orderInfo;\n    });\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E38\u7528\u65B9\u6CD5\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"thenApply"}),"\uFF1A\u8F6C\u6362\u7ED3\u679C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"thenAccept"}),"\uFF1A\u6D88\u8D39\u7ED3\u679C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"thenRun"}),"\uFF1A\u6267\u884C\u52A8\u4F5C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"thenCompose"}),"\uFF1A\u6241\u5E73\u5316\u5D4C\u5957 Future"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"thenCombine"}),"\uFF1A\u7EC4\u5408\u4E24\u4E2A Future"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"exceptionally"}),"\uFF1A\u5F02\u5E38\u5904\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"handle"}),"\uFF1A\u7ED3\u679C\u548C\u5F02\u5E38\u7EDF\u4E00\u5904\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"whenComplete"}),"\uFF1A\u5B8C\u6210\u65F6\u56DE\u8C03"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"23-\u4EC0\u4E48\u662F-java-\u7684-forkjoinpool-1",children:"23. \u4EC0\u4E48\u662F Java \u7684 ForkJoinPool\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:'ForkJoinPool \u662F Java 7 \u5F15\u5165\u7684\u7EBF\u7A0B\u6C60\uFF0C\u4E13\u95E8\u7528\u4E8E\u6267\u884C\u53EF\u4EE5\u9012\u5F52\u5206\u89E3\u7684\u4EFB\u52A1\uFF0C\u91C7\u7528"\u5206\u800C\u6CBB\u4E4B"\u7684\u7B56\u7565\u548C\u5DE5\u4F5C\u7A83\u53D6\u7B97\u6CD5\u3002'}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u6982\u5FF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fork\uFF08\u5206\u89E3\uFF09"}),"\uFF1A\u5C06\u5927\u4EFB\u52A1\u5206\u89E3\u4E3A\u5C0F\u4EFB\u52A1"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Join\uFF08\u5408\u5E76\uFF09"}),"\uFF1A\u5408\u5E76\u5C0F\u4EFB\u52A1\u7684\u7ED3\u679C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Work Stealing\uFF08\u5DE5\u4F5C\u7A83\u53D6\uFF09"}),"\uFF1A\u7A7A\u95F2\u7EBF\u7A0B\u4ECE\u5176\u4ED6\u7EBF\u7A0B\u7684\u961F\u5217\u4E2D\u7A83\u53D6\u4EFB\u52A1"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. RecursiveTask\uFF08\u6709\u8FD4\u56DE\u503C\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class SumTask extends RecursiveTask<Long> {\n    private static final int THRESHOLD = 10000;\n    private long[] array;\n    private int start;\n    private int end;\n    \n    public SumTask(long[] array, int start, int end) {\n        this.array = array;\n        this.start = start;\n        this.end = end;\n    }\n    \n    @Override\n    protected Long compute() {\n        if (end - start <= THRESHOLD) {\n            // \u4EFB\u52A1\u8DB3\u591F\u5C0F\uFF0C\u76F4\u63A5\u8BA1\u7B97\n            long sum = 0;\n            for (int i = start; i < end; i++) {\n                sum += array[i];\n            }\n            return sum;\n        } else {\n            // \u4EFB\u52A1\u592A\u5927\uFF0C\u5206\u89E3\u4E3A\u4E24\u4E2A\u5B50\u4EFB\u52A1\n            int middle = (start + end) / 2;\n            SumTask leftTask = new SumTask(array, start, middle);\n            SumTask rightTask = new SumTask(array, middle, end);\n            \n            // Fork\uFF1A\u5F02\u6B65\u6267\u884C\u5B50\u4EFB\u52A1\n            leftTask.fork();\n            rightTask.fork();\n            \n            // Join\uFF1A\u7B49\u5F85\u5B50\u4EFB\u52A1\u5B8C\u6210\u5E76\u5408\u5E76\u7ED3\u679C\n            long leftResult = leftTask.join();\n            long rightResult = rightTask.join();\n            \n            return leftResult + rightResult;\n        }\n    }\n}\n\n// \u4F7F\u7528\nForkJoinPool pool = new ForkJoinPool();\nlong[] array = new long[100000];\nSumTask task = new SumTask(array, 0, array.length);\nlong result = pool.invoke(task);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. RecursiveAction\uFF08\u65E0\u8FD4\u56DE\u503C\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class PrintTask extends RecursiveAction {\n    private static final int THRESHOLD = 50;\n    private int start;\n    private int end;\n    \n    public PrintTask(int start, int end) {\n        this.start = start;\n        this.end = end;\n    }\n    \n    @Override\n    protected void compute() {\n        if (end - start <= THRESHOLD) {\n            for (int i = start; i < end; i++) {\n                System.out.println(i);\n            }\n        } else {\n            int middle = (start + end) / 2;\n            PrintTask leftTask = new PrintTask(start, middle);\n            PrintTask rightTask = new PrintTask(middle, end);\n            \n            invokeAll(leftTask, rightTask); // \u6267\u884C\u6240\u6709\u5B50\u4EFB\u52A1\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5DE5\u4F5C\u7A83\u53D6\u7B97\u6CD5\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u7EBF\u7A0B1\u961F\u5217: [Task1, Task2, Task3]  \u2190 \u4ECE\u5C3E\u90E8\u53D6\u4EFB\u52A1\n\u7EBF\u7A0B2\u961F\u5217: [Task4, Task5]         \u2190 \u4ECE\u5C3E\u90E8\u53D6\u4EFB\u52A1\n\u7EBF\u7A0B3\u961F\u5217: []                     \u2190 \u7A7A\u95F2\uFF0C\u4ECE\u5176\u4ED6\u961F\u5217\u5934\u90E8\u7A83\u53D6\u4EFB\u52A1\n\n\u7EBF\u7A0B3\u7A83\u53D6 \u2192 \u4ECE\u7EBF\u7A0B1\u961F\u5217\u5934\u90E8\u53D6 Task1\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u8BA1\u7B97\u5BC6\u96C6\u578B\u4EFB\u52A1"}),"\n",(0,i.jsx)(e.li,{children:"\u81EA\u52A8\u8D1F\u8F7D\u5747\u8861\uFF08\u5DE5\u4F5C\u7A83\u53D6\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u51CF\u5C11\u7EBF\u7A0B\u7ADE\u4E89\uFF08\u6BCF\u4E2A\u7EBF\u7A0B\u6709\u81EA\u5DF1\u7684\u961F\u5217\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u9ED8\u8BA4\u7EBF\u7A0B\u6570\u7B49\u4E8E CPU \u6838\u5FC3\u6570"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5927\u6570\u7EC4\u6392\u5E8F\u3001\u6C42\u548C"}),"\n",(0,i.jsx)(e.li,{children:"\u5E76\u884C\u6D41\uFF08Stream.parallel()\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u9012\u5F52\u7B97\u6CD5\u5E76\u884C\u5316"}),"\n",(0,i.jsx)(e.li,{children:"\u56FE\u50CF\u5904\u7406\u3001\u6570\u636E\u5206\u6790"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E0E\u666E\u901A\u7EBF\u7A0B\u6C60\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"ForkJoinPool"}),(0,i.jsx)(e.th,{children:"ThreadPoolExecutor"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4EFB\u52A1\u7C7B\u578B"}),(0,i.jsx)(e.td,{children:"\u53EF\u5206\u89E3\u7684\u9012\u5F52\u4EFB\u52A1"}),(0,i.jsx)(e.td,{children:"\u72EC\u7ACB\u4EFB\u52A1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u961F\u5217"}),(0,i.jsx)(e.td,{children:"\u53CC\u7AEF\u961F\u5217\uFF08\u6BCF\u7EBF\u7A0B\uFF09"}),(0,i.jsx)(e.td,{children:"\u5355\u4E00\u961F\u5217"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8D1F\u8F7D\u5747\u8861"}),(0,i.jsx)(e.td,{children:"\u5DE5\u4F5C\u7A83\u53D6"}),(0,i.jsx)(e.td,{children:"\u65E0"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u8BA1\u7B97\u5BC6\u96C6\u578B"}),(0,i.jsx)(e.td,{children:"\u901A\u7528"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"24-\u5982\u4F55\u5728-java-\u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F-1",children:"24. \u5982\u4F55\u5728 Java \u4E2D\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u63D0\u4F9B\u4E86\u591A\u79CD\u65B9\u5F0F\u63A7\u5236\u7EBF\u7A0B\u6267\u884C\u987A\u5E8F\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4F7F\u7528 join() \u65B9\u6CD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'Thread t1 = new Thread(() -> System.out.println("\u7EBF\u7A0B1"));\nThread t2 = new Thread(() -> System.out.println("\u7EBF\u7A0B2"));\nThread t3 = new Thread(() -> System.out.println("\u7EBF\u7A0B3"));\n\nt1.start();\nt1.join(); // \u7B49\u5F85 t1 \u5B8C\u6210\n\nt2.start();\nt2.join(); // \u7B49\u5F85 t2 \u5B8C\u6210\n\nt3.start();\nt3.join(); // \u7B49\u5F85 t3 \u5B8C\u6210\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u4F7F\u7528 CountDownLatch"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CountDownLatch latch1 = new CountDownLatch(1);\nCountDownLatch latch2 = new CountDownLatch(1);\n\nnew Thread(() -> {\n    System.out.println("\u7EBF\u7A0B1");\n    latch1.countDown();\n}).start();\n\nnew Thread(() -> {\n    try {\n        latch1.await(); // \u7B49\u5F85\u7EBF\u7A0B1\u5B8C\u6210\n        System.out.println("\u7EBF\u7A0B2");\n        latch2.countDown();\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n\nnew Thread(() -> {\n    try {\n        latch2.await(); // \u7B49\u5F85\u7EBF\u7A0B2\u5B8C\u6210\n        System.out.println("\u7EBF\u7A0B3");\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u4F7F\u7528 CyclicBarrier"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CyclicBarrier barrier = new CyclicBarrier(3);\n\n// \u6240\u6709\u7EBF\u7A0B\u540C\u65F6\u5F00\u59CB\nfor (int i = 0; i < 3; i++) {\n    final int id = i;\n    new Thread(() -> {\n        try {\n            System.out.println("\u7EBF\u7A0B" + id + " \u51C6\u5907");\n            barrier.await(); // \u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\n            System.out.println("\u7EBF\u7A0B" + id + " \u5F00\u59CB\u6267\u884C");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }).start();\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F7F\u7528 Semaphore"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'Semaphore semaphore1 = new Semaphore(1);\nSemaphore semaphore2 = new Semaphore(0);\nSemaphore semaphore3 = new Semaphore(0);\n\nnew Thread(() -> {\n    try {\n        semaphore1.acquire();\n        System.out.println("\u7EBF\u7A0B1");\n        semaphore2.release();\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n\nnew Thread(() -> {\n    try {\n        semaphore2.acquire();\n        System.out.println("\u7EBF\u7A0B2");\n        semaphore3.release();\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n\nnew Thread(() -> {\n    try {\n        semaphore3.acquire();\n        System.out.println("\u7EBF\u7A0B3");\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u4F7F\u7528 wait/notify"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class SequentialExecution {\n    private int flag = 1;\n    private final Object lock = new Object();\n    \n    public void thread1() {\n        synchronized (lock) {\n            while (flag != 1) {\n                try {\n                    lock.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println("\u7EBF\u7A0B1");\n            flag = 2;\n            lock.notifyAll();\n        }\n    }\n    \n    public void thread2() {\n        synchronized (lock) {\n            while (flag != 2) {\n                try {\n                    lock.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            System.out.println("\u7EBF\u7A0B2");\n            flag = 3;\n            lock.notifyAll();\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u4F7F\u7528 CompletableFuture"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CompletableFuture.runAsync(() -> {\n    System.out.println("\u7EBF\u7A0B1");\n})\n.thenRun(() -> {\n    System.out.println("\u7EBF\u7A0B2");\n})\n.thenRun(() -> {\n    System.out.println("\u7EBF\u7A0B3");\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. \u4F7F\u7528\u5355\u7EBF\u7A0B\u7EBF\u7A0B\u6C60"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ExecutorService executor = Executors.newSingleThreadExecutor();\n\nexecutor.submit(() -> System.out.println("\u4EFB\u52A11"));\nexecutor.submit(() -> System.out.println("\u4EFB\u52A12"));\nexecutor.submit(() -> System.out.println("\u4EFB\u52A13"));\n\nexecutor.shutdown();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B80\u5355\u987A\u5E8F\u6267\u884C\uFF1Ajoin() \u6216\u5355\u7EBF\u7A0B\u7EBF\u7A0B\u6C60"}),"\n",(0,i.jsx)(e.li,{children:"\u590D\u6742\u4F9D\u8D56\u5173\u7CFB\uFF1ACountDownLatch \u6216 CompletableFuture"}),"\n",(0,i.jsx)(e.li,{children:"\u5FAA\u73AF\u6267\u884C\uFF1ACyclicBarrier"}),"\n",(0,i.jsx)(e.li,{children:"\u7CBE\u786E\u63A7\u5236\uFF1ASemaphore \u6216 wait/notify"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"25-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217-1",children:"25. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u963B\u585E\u961F\u5217\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u5E76\u53D1\u5305\u63D0\u4F9B\u4E86\u591A\u79CD\u963B\u585E\u961F\u5217\uFF08BlockingQueue\uFF09\uFF0C\u7528\u4E8E\u751F\u4EA7\u8005-\u6D88\u8D39\u8005\u6A21\u5F0F\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. ArrayBlockingQueue\uFF08\u6709\u754C\u6570\u7EC4\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u521B\u5EFA\u5BB9\u91CF\u4E3A10\u7684\u961F\u5217\nBlockingQueue<String> queue = new ArrayBlockingQueue<>(10);\n\n// \u6DFB\u52A0\u5143\u7D20\nqueue.put("element"); // \u961F\u5217\u6EE1\u65F6\u963B\u585E\nqueue.offer("element", 1, TimeUnit.SECONDS); // \u8D85\u65F6\u8FD4\u56DEfalse\n\n// \u83B7\u53D6\u5143\u7D20\nString element = queue.take(); // \u961F\u5217\u7A7A\u65F6\u963B\u585E\nString element2 = queue.poll(1, TimeUnit.SECONDS); // \u8D85\u65F6\u8FD4\u56DEnull\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E\u6570\u7EC4\u5B9E\u73B0"}),"\n",(0,i.jsx)(e.li,{children:"\u6709\u754C\u961F\u5217\uFF0C\u5FC5\u987B\u6307\u5B9A\u5BB9\u91CF"}),"\n",(0,i.jsx)(e.li,{children:"FIFO \u987A\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u516C\u5E73/\u975E\u516C\u5E73\u9501"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. LinkedBlockingQueue\uFF08\u6709\u754C\u94FE\u8868\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u65E0\u754C\u961F\u5217\uFF08\u6700\u5927\u5BB9\u91CF Integer.MAX_VALUE\uFF09\nBlockingQueue<String> queue1 = new LinkedBlockingQueue<>();\n\n// \u6709\u754C\u961F\u5217\nBlockingQueue<String> queue2 = new LinkedBlockingQueue<>(100);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E\u94FE\u8868\u5B9E\u73B0"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u9009\u6709\u754C/\u65E0\u754C"}),"\n",(0,i.jsx)(e.li,{children:"FIFO \u987A\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u541E\u5410\u91CF\u901A\u5E38\u9AD8\u4E8E ArrayBlockingQueue"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. PriorityBlockingQueue\uFF08\u4F18\u5148\u7EA7\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"BlockingQueue<Task> queue = new PriorityBlockingQueue<>();\n\nclass Task implements Comparable<Task> {\n    private int priority;\n    \n    @Override\n    public int compareTo(Task other) {\n        return Integer.compare(this.priority, other.priority);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u57FA\u4E8E\u5806\u5B9E\u73B0"}),"\n",(0,i.jsx)(e.li,{children:"\u65E0\u754C\u961F\u5217"}),"\n",(0,i.jsx)(e.li,{children:"\u6309\u4F18\u5148\u7EA7\u6392\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u4FDD\u8BC1\u540C\u4F18\u5148\u7EA7\u7684\u987A\u5E8F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. DelayQueue\uFF08\u5EF6\u8FDF\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"BlockingQueue<DelayedTask> queue = new DelayQueue<>();\n\nclass DelayedTask implements Delayed {\n    private long delayTime;\n    private long expire;\n    \n    @Override\n    public long getDelay(TimeUnit unit) {\n        return unit.convert(expire - System.currentTimeMillis(), \n            TimeUnit.MILLISECONDS);\n    }\n    \n    @Override\n    public int compareTo(Delayed o) {\n        return Long.compare(this.expire, ((DelayedTask) o).expire);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5143\u7D20\u5FC5\u987B\u5B9E\u73B0 Delayed \u63A5\u53E3"}),"\n",(0,i.jsx)(e.li,{children:"\u53EA\u6709\u5230\u671F\u7684\u5143\u7D20\u624D\u80FD\u88AB\u53D6\u51FA"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u5B9A\u65F6\u4EFB\u52A1\u3001\u7F13\u5B58\u8FC7\u671F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. SynchronousQueue\uFF08\u540C\u6B65\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'BlockingQueue<String> queue = new SynchronousQueue<>();\n\n// \u751F\u4EA7\u8005\nnew Thread(() -> {\n    try {\n        queue.put("data"); // \u963B\u585E\u76F4\u5230\u6709\u6D88\u8D39\u8005\u53D6\u8D70\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n\n// \u6D88\u8D39\u8005\nnew Thread(() -> {\n    try {\n        String data = queue.take(); // \u963B\u585E\u76F4\u5230\u6709\u751F\u4EA7\u8005\u653E\u5165\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E0D\u5B58\u50A8\u5143\u7D20"}),"\n",(0,i.jsx)(e.li,{children:"\u6BCF\u4E2A put \u5FC5\u987B\u7B49\u5F85\u4E00\u4E2A take"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u4F20\u9012\u6027\u573A\u666F"}),"\n",(0,i.jsx)(e.li,{children:"CachedThreadPool \u4F7F\u7528\u6B64\u961F\u5217"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. LinkedTransferQueue\uFF08\u4F20\u8F93\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'TransferQueue<String> queue = new LinkedTransferQueue<>();\n\n// \u751F\u4EA7\u8005\nqueue.transfer("data"); // \u963B\u585E\u76F4\u5230\u6D88\u8D39\u8005\u63A5\u6536\n\n// \u6D88\u8D39\u8005\nString data = queue.take();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u65E0\u754C\u961F\u5217"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301 transfer \u65B9\u6CD5\uFF08\u76F4\u63A5\u4F20\u9012\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u6027\u80FD\u4F18\u4E8E LinkedBlockingQueue"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. LinkedBlockingDeque\uFF08\u53CC\u7AEF\u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'BlockingDeque<String> deque = new LinkedBlockingDeque<>();\n\n// \u53EF\u4EE5\u4ECE\u4E24\u7AEF\u64CD\u4F5C\ndeque.putFirst("first");\ndeque.putLast("last");\nString first = deque.takeFirst();\nString last = deque.takeLast();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53CC\u7AEF\u961F\u5217"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u4EE5\u4ECE\u5934\u5C3E\u4E24\u7AEF\u64CD\u4F5C"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u5DE5\u4F5C\u7A83\u53D6\u6A21\u5F0F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u961F\u5217\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u6709\u754C\u6027"}),(0,i.jsx)(e.th,{children:"\u6570\u636E\u7ED3\u6784"}),(0,i.jsx)(e.th,{children:"\u7279\u70B9"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"ArrayBlockingQueue"}),(0,i.jsx)(e.td,{children:"\u6709\u754C"}),(0,i.jsx)(e.td,{children:"\u6570\u7EC4"}),(0,i.jsx)(e.td,{children:"\u56FA\u5B9A\u5BB9\u91CF"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"LinkedBlockingQueue"}),(0,i.jsx)(e.td,{children:"\u53EF\u9009"}),(0,i.jsx)(e.td,{children:"\u94FE\u8868"}),(0,i.jsx)(e.td,{children:"\u9AD8\u541E\u5410\u91CF"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"PriorityBlockingQueue"}),(0,i.jsx)(e.td,{children:"\u65E0\u754C"}),(0,i.jsx)(e.td,{children:"\u5806"}),(0,i.jsx)(e.td,{children:"\u4F18\u5148\u7EA7\u6392\u5E8F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"DelayQueue"}),(0,i.jsx)(e.td,{children:"\u65E0\u754C"}),(0,i.jsx)(e.td,{children:"\u5806"}),(0,i.jsx)(e.td,{children:"\u5EF6\u8FDF\u83B7\u53D6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"SynchronousQueue"}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"\u65E0"}),(0,i.jsx)(e.td,{children:"\u76F4\u63A5\u4F20\u9012"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"LinkedTransferQueue"}),(0,i.jsx)(e.td,{children:"\u65E0\u754C"}),(0,i.jsx)(e.td,{children:"\u94FE\u8868"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\u4F20\u8F93"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"LinkedBlockingDeque"}),(0,i.jsx)(e.td,{children:"\u53EF\u9009"}),(0,i.jsx)(e.td,{children:"\u94FE\u8868"}),(0,i.jsx)(e.td,{children:"\u53CC\u7AEF\u64CD\u4F5C"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u56FA\u5B9A\u5BB9\u91CF\u9650\u6D41\uFF1AArrayBlockingQueue"}),"\n",(0,i.jsx)(e.li,{children:"\u751F\u4EA7\u8005-\u6D88\u8D39\u8005\uFF1ALinkedBlockingQueue"}),"\n",(0,i.jsx)(e.li,{children:"\u4EFB\u52A1\u4F18\u5148\u7EA7\uFF1APriorityBlockingQueue"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u65F6\u4EFB\u52A1\uFF1ADelayQueue"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u6C60\u4EFB\u52A1\u4F20\u9012\uFF1ASynchronousQueue"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"26-\u4F60\u4F7F\u7528\u8FC7-java-\u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B-1",children:"26. \u4F60\u4F7F\u7528\u8FC7 Java \u4E2D\u7684\u54EA\u4E9B\u539F\u5B50\u7C7B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u63D0\u4F9B\u4E86 java.util.concurrent.atomic \u5305\uFF0C\u5305\u542B\u591A\u79CD\u539F\u5B50\u7C7B\uFF0C\u4FDD\u8BC1\u64CD\u4F5C\u7684\u539F\u5B50\u6027\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u57FA\u672C\u7C7B\u578B\u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// AtomicInteger\nAtomicInteger count = new AtomicInteger(0);\ncount.incrementAndGet();  // i++\ncount.getAndIncrement();  // ++i\ncount.addAndGet(5);       // i += 5\ncount.compareAndSet(0, 1); // CAS\u64CD\u4F5C\n\n// AtomicLong\nAtomicLong longValue = new AtomicLong(0L);\n\n// AtomicBoolean\nAtomicBoolean flag = new AtomicBoolean(false);\nflag.compareAndSet(false, true);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u6570\u7EC4\u7C7B\u578B\u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// AtomicIntegerArray\nAtomicIntegerArray array = new AtomicIntegerArray(10);\narray.incrementAndGet(0);  // \u6570\u7EC4\u7D22\u5F150\u7684\u5143\u7D20+1\narray.compareAndSet(0, 1, 2); // CAS\u64CD\u4F5C\n\n// AtomicLongArray\nAtomicLongArray longArray = new AtomicLongArray(10);\n\n// AtomicReferenceArray\nAtomicReferenceArray<String> refArray = new AtomicReferenceArray<>(10);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// AtomicReference\nAtomicReference<User> userRef = new AtomicReference<>();\nUser oldUser = new User("\u5F20\u4E09");\nUser newUser = new User("\u674E\u56DB");\nuserRef.compareAndSet(oldUser, newUser);\n\n// AtomicStampedReference\uFF08\u89E3\u51B3ABA\u95EE\u9898\uFF09\nAtomicStampedReference<String> stampedRef = \n    new AtomicStampedReference<>("\u521D\u59CB\u503C", 0);\nint stamp = stampedRef.getStamp();\nstampedRef.compareAndSet("\u521D\u59CB\u503C", "\u65B0\u503C", stamp, stamp + 1);\n\n// AtomicMarkableReference\uFF08\u6807\u8BB0\u662F\u5426\u88AB\u4FEE\u6539\u8FC7\uFF09\nAtomicMarkableReference<String> markableRef = \n    new AtomicMarkableReference<>("\u521D\u59CB\u503C", false);\nmarkableRef.compareAndSet("\u521D\u59CB\u503C", "\u65B0\u503C", false, true);\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u5B57\u6BB5\u66F4\u65B0\u5668"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'class User {\n    volatile int age;\n    volatile String name;\n}\n\n// AtomicIntegerFieldUpdater\nAtomicIntegerFieldUpdater<User> ageUpdater = \n    AtomicIntegerFieldUpdater.newUpdater(User.class, "age");\nUser user = new User();\nageUpdater.incrementAndGet(user);\n\n// AtomicReferenceFieldUpdater\nAtomicReferenceFieldUpdater<User, String> nameUpdater = \n    AtomicReferenceFieldUpdater.newUpdater(User.class, String.class, "name");\nnameUpdater.compareAndSet(user, "\u65E7\u540D\u5B57", "\u65B0\u540D\u5B57");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u8BA1\u6570\u5668\npublic class Counter {\n    private AtomicInteger count = new AtomicInteger(0);\n    \n    public void increment() {\n        count.incrementAndGet();\n    }\n    \n    public int getCount() {\n        return count.get();\n    }\n}\n\n// 2. \u5355\u4F8B\u6A21\u5F0F\npublic class Singleton {\n    private static final AtomicReference<Singleton> INSTANCE = \n        new AtomicReference<>();\n    \n    public static Singleton getInstance() {\n        while (true) {\n            Singleton current = INSTANCE.get();\n            if (current != null) {\n                return current;\n            }\n            current = new Singleton();\n            if (INSTANCE.compareAndSet(null, current)) {\n                return current;\n            }\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"27-\u4F60\u4F7F\u7528\u8FC7-java-\u7684\u7D2F\u52A0\u5668\u5417-1",children:"27. \u4F60\u4F7F\u7528\u8FC7 Java \u7684\u7D2F\u52A0\u5668\u5417\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java 8 \u5F15\u5165\u4E86\u7D2F\u52A0\u5668\uFF08Accumulator\uFF09\uFF0C\u5728\u9AD8\u5E76\u53D1\u573A\u666F\u4E0B\u6027\u80FD\u4F18\u4E8E\u539F\u5B50\u7C7B\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. LongAdder\uFF08\u957F\u6574\u578B\u7D2F\u52A0\u5668\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"LongAdder adder = new LongAdder();\n\n// \u591A\u7EBF\u7A0B\u7D2F\u52A0\nfor (int i = 0; i < 10; i++) {\n    new Thread(() -> {\n        for (int j = 0; j < 1000; j++) {\n            adder.increment(); // \u52A01\n            adder.add(5);      // \u52A05\n        }\n    }).start();\n}\n\n// \u83B7\u53D6\u7ED3\u679C\nlong sum = adder.sum();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. LongAccumulator\uFF08\u957F\u6574\u578B\u7D2F\u79EF\u5668\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u81EA\u5B9A\u4E49\u7D2F\u79EF\u51FD\u6570\uFF08\u6C42\u6700\u5927\u503C\uFF09\nLongAccumulator accumulator = new LongAccumulator(Long::max, Long.MIN_VALUE);\n\naccumulator.accumulate(100);\naccumulator.accumulate(200);\naccumulator.accumulate(50);\n\nlong max = accumulator.get(); // 200\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. DoubleAdder \u548C DoubleAccumulator"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"DoubleAdder doubleAdder = new DoubleAdder();\ndoubleAdder.add(1.5);\ndouble sum = doubleAdder.sum();\n\nDoubleAccumulator doubleAccumulator = \n    new DoubleAccumulator(Double::sum, 0.0);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// AtomicLong vs LongAdder \u6027\u80FD\u6D4B\u8BD5\npublic class PerformanceTest {\n    public static void testAtomicLong() {\n        AtomicLong atomicLong = new AtomicLong(0);\n        // 10\u4E2A\u7EBF\u7A0B\uFF0C\u6BCF\u4E2A\u7D2F\u52A0100\u4E07\u6B21\n        // AtomicLong: \u7EA62000ms\n    }\n    \n    public static void testLongAdder() {\n        LongAdder longAdder = new LongAdder();\n        // 10\u4E2A\u7EBF\u7A0B\uFF0C\u6BCF\u4E2A\u7D2F\u52A0100\u4E07\u6B21\n        // LongAdder: \u7EA6500ms\uFF08\u5FEB4\u500D\uFF09\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"AtomicLong\uFF1A\u6240\u6709\u7EBF\u7A0B\u7ADE\u4E89\u540C\u4E00\u4E2A\u53D8\u91CF\uFF0CCAS \u51B2\u7A81\u591A"}),"\n",(0,i.jsx)(e.li,{children:"LongAdder\uFF1A\u6BCF\u4E2A\u7EBF\u7A0B\u7EF4\u62A4\u81EA\u5DF1\u7684\u8BA1\u6570\u5668\uFF08Cell\uFF09\uFF0C\u6700\u540E\u6C47\u603B\uFF0C\u51CF\u5C11\u7ADE\u4E89"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u90E8\u7ED3\u6784\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"LongAdder\n\u251C\u2500\u2500 base (\u57FA\u7840\u503C)\n\u2514\u2500\u2500 cells[] (Cell\u6570\u7EC4)\n    \u251C\u2500\u2500 Cell[0] (\u7EBF\u7A0B1\u7684\u8BA1\u6570)\n    \u251C\u2500\u2500 Cell[1] (\u7EBF\u7A0B2\u7684\u8BA1\u6570)\n    \u2514\u2500\u2500 Cell[2] (\u7EBF\u7A0B3\u7684\u8BA1\u6570)\n\nsum() = base + Cell[0] + Cell[1] + Cell[2] + ...\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F4E\u5E76\u53D1\u573A\u666F\uFF1AAtomicLong\uFF08\u66F4\u7B80\u5355\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u9AD8\u5E76\u53D1\u7D2F\u52A0\uFF1ALongAdder\uFF08\u6027\u80FD\u66F4\u597D\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981 CAS \u64CD\u4F5C\uFF1AAtomicLong"}),"\n",(0,i.jsx)(e.li,{children:"\u53EA\u9700\u8981\u7D2F\u52A0\uFF1ALongAdder"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"28-\u4EC0\u4E48\u662F-java-\u7684-cascompare-and-swap\u64CD\u4F5C-1",children:"28. \u4EC0\u4E48\u662F Java \u7684 CAS\uFF08Compare-And-Swap\uFF09\u64CD\u4F5C\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"CAS\uFF08Compare-And-Swap\uFF09\u662F\u4E00\u79CD\u65E0\u9501\u7684\u539F\u5B50\u64CD\u4F5C\uFF0C\u7528\u4E8E\u5B9E\u73B0\u5E76\u53D1\u63A7\u5236\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"}),"\nCAS \u5305\u542B\u4E09\u4E2A\u64CD\u4F5C\u6570\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"V\uFF1A\u5185\u5B58\u4F4D\u7F6E\uFF08\u53D8\u91CF\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"E\uFF1A\u9884\u671F\u503C\uFF08Expected\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"N\uFF1A\u65B0\u503C\uFF08New\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u53EA\u6709\u5F53 V \u7684\u503C\u7B49\u4E8E E \u65F6\uFF0C\u624D\u5C06 V \u7684\u503C\u8BBE\u7F6E\u4E3A N\uFF0C\u5426\u5219\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C\u3002\u6574\u4E2A\u8FC7\u7A0B\u662F\u539F\u5B50\u7684\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F2A\u4EE3\u7801\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"boolean compareAndSwap(Variable V, int E, int N) {\n    if (V == E) {\n        V = N;\n        return true;\n    }\n    return false;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Java \u4E2D\u7684 CAS\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"AtomicInteger count = new AtomicInteger(0);\n\n// CAS \u64CD\u4F5C\nboolean success = count.compareAndSet(0, 1);\n// \u5982\u679C\u5F53\u524D\u503C\u662F0\uFF0C\u5219\u8BBE\u7F6E\u4E3A1\uFF0C\u8FD4\u56DEtrue\n// \u5982\u679C\u5F53\u524D\u503C\u4E0D\u662F0\uFF0C\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C\uFF0C\u8FD4\u56DEfalse\n\n// \u81EA\u65CB CAS\npublic void increment() {\n    int oldValue;\n    int newValue;\n    do {\n        oldValue = count.get();\n        newValue = oldValue + 1;\n    } while (!count.compareAndSet(oldValue, newValue));\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E95\u5C42\u5B9E\u73B0\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Unsafe \u7C7B\u63D0\u4F9B\u7684 CAS \u65B9\u6CD5\npublic final native boolean compareAndSwapInt(\n    Object o,      // \u5BF9\u8C61\n    long offset,   // \u5B57\u6BB5\u504F\u79FB\u91CF\n    int expected,  // \u9884\u671F\u503C\n    int x          // \u65B0\u503C\n);\n\n// CPU \u6307\u4EE4\uFF08x86\uFF09\nlock cmpxchg [\u5185\u5B58\u5730\u5740], \u65B0\u503C\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CAS \u7684\u4F18\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u65E0\u9501\uFF0C\u907F\u514D\u7EBF\u7A0B\u963B\u585E\u548C\u4E0A\u4E0B\u6587\u5207\u6362"}),"\n",(0,i.jsx)(e.li,{children:"\u6027\u80FD\u9AD8\u4E8E synchronized"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u5408\u4F4E\u5E76\u53D1\u573A\u666F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"CAS \u7684\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. ABA \u95EE\u9898"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B1\uFF1A\u8BFB\u53D6\u503CA\nint value = atomicInt.get(); // A\n\n// \u7EBF\u7A0B2\uFF1AA -> B -> A\natomicInt.compareAndSet(A, B);\natomicInt.compareAndSet(B, A);\n\n// \u7EBF\u7A0B1\uFF1ACAS\u6210\u529F\uFF0C\u4F46\u503C\u5DF2\u7ECF\u88AB\u4FEE\u6539\u8FC7\natomicInt.compareAndSet(A, C); // \u6210\u529F\uFF0C\u4F46\u4E0D\u77E5\u9053\u4E2D\u95F4\u53D8\u5316\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u4F7F\u7528\u7248\u672C\u53F7\nAtomicStampedReference<Integer> stampedRef = \n    new AtomicStampedReference<>(A, 0);\nint stamp = stampedRef.getStamp();\nstampedRef.compareAndSet(A, C, stamp, stamp + 1);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5FAA\u73AF\u65F6\u95F4\u957F\u5F00\u9500\u5927"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9AD8\u5E76\u53D1\u4E0B\uFF0CCAS \u5931\u8D25\u6B21\u6570\u591A\uFF0CCPU \u5F00\u9500\u5927\npublic void increment() {\n    int oldValue;\n    int newValue;\n    do {\n        oldValue = count.get();\n        newValue = oldValue + 1;\n        // \u9AD8\u5E76\u53D1\u4E0B\u53EF\u80FD\u5FAA\u73AF\u5F88\u591A\u6B21\n    } while (!count.compareAndSet(oldValue, newValue));\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u4F7F\u7528 LongAdder \u6216\u52A0\u9501\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u53EA\u80FD\u4FDD\u8BC1\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF\u7684\u539F\u5B50\u64CD\u4F5C"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u80FD\u540C\u65F6 CAS \u591A\u4E2A\u53D8\u91CF\n// \u89E3\u51B3\u65B9\u6848\uFF1A\n// 1. \u4F7F\u7528 AtomicReference \u5305\u88C5\u591A\u4E2A\u53D8\u91CF\nclass Pair {\n    int a;\n    int b;\n}\nAtomicReference<Pair> pairRef = new AtomicReference<>(new Pair());\n\n// 2. \u4F7F\u7528\u9501\nsynchronized (lock) {\n    a++;\n    b++;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u539F\u5B50\u7C7B\uFF08AtomicInteger\u3001AtomicReference\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u5E76\u53D1\u5BB9\u5668\uFF08ConcurrentHashMap\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"AQS\uFF08AbstractQueuedSynchronizer\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4E50\u89C2\u9501\u5B9E\u73B0"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"29-\u8BF4\u8BF4-aqs-\u5427-1",children:"29. \u8BF4\u8BF4 AQS \u5427\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"AQS\uFF08AbstractQueuedSynchronizer\uFF09\u662F Java \u5E76\u53D1\u5305\u7684\u6838\u5FC3\u57FA\u7840\u6846\u67B6\uFF0C\u7528\u4E8E\u6784\u5EFA\u9501\u548C\u540C\u6B65\u5668\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u601D\u60F3\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u4E00\u4E2A int \u7C7B\u578B\u7684 state \u53D8\u91CF\u8868\u793A\u540C\u6B65\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 FIFO \u961F\u5217\u7BA1\u7406\u7B49\u5F85\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B\u72EC\u5360\u6A21\u5F0F\u548C\u5171\u4EAB\u6A21\u5F0F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u7EC4\u4EF6\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u540C\u6B65\u72B6\u6001\uFF08state\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"private volatile int state;\n\n// \u83B7\u53D6\u72B6\u6001\nprotected final int getState()\n\n// \u8BBE\u7F6E\u72B6\u6001\nprotected final void setState(int newState)\n\n// CAS \u8BBE\u7F6E\u72B6\u6001\nprotected final boolean compareAndSetState(int expect, int update)\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u7B49\u5F85\u961F\u5217\uFF08CLH \u961F\u5217\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"head -> Node1 -> Node2 -> Node3 -> tail\n        (\u7B49\u5F85)   (\u7B49\u5F85)   (\u7B49\u5F85)\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u6BCF\u4E2A Node \u5305\u542B\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"thread\uFF1A\u7B49\u5F85\u7684\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"waitStatus\uFF1A\u7B49\u5F85\u72B6\u6001"}),"\n",(0,i.jsx)(e.li,{children:"prev/next\uFF1A\u524D\u9A71/\u540E\u7EE7\u8282\u70B9"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5DE5\u4F5C\u6D41\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u72EC\u5360\u6A21\u5F0F\uFF08\u5982 ReentrantLock\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u5C1D\u8BD5\u83B7\u53D6\u9501\npublic final void acquire(int arg) {\n    if (!tryAcquire(arg) &&  // \u5C1D\u8BD5\u83B7\u53D6\uFF08\u5B50\u7C7B\u5B9E\u73B0\uFF09\n        acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) {  // \u52A0\u5165\u961F\u5217\u7B49\u5F85\n        selfInterrupt();\n    }\n}\n\n// 2. \u91CA\u653E\u9501\npublic final boolean release(int arg) {\n    if (tryRelease(arg)) {  // \u5C1D\u8BD5\u91CA\u653E\uFF08\u5B50\u7C7B\u5B9E\u73B0\uFF09\n        Node h = head;\n        if (h != null && h.waitStatus != 0)\n            unparkSuccessor(h);  // \u5524\u9192\u540E\u7EE7\u8282\u70B9\n        return true;\n    }\n    return false;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5171\u4EAB\u6A21\u5F0F\uFF08\u5982 Semaphore\u3001CountDownLatch\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u83B7\u53D6\u5171\u4EAB\u9501\npublic final void acquireShared(int arg) {\n    if (tryAcquireShared(arg) < 0)  // \u5C1D\u8BD5\u83B7\u53D6\n        doAcquireShared(arg);  // \u52A0\u5165\u961F\u5217\u7B49\u5F85\n}\n\n// \u91CA\u653E\u5171\u4EAB\u9501\npublic final boolean releaseShared(int arg) {\n    if (tryReleaseShared(arg)) {  // \u5C1D\u8BD5\u91CA\u653E\n        doReleaseShared();  // \u5524\u9192\u540E\u7EE7\u8282\u70B9\n        return true;\n    }\n    return false;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u540C\u6B65\u5668\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u81EA\u5B9A\u4E49\u4E92\u65A5\u9501\npublic class Mutex implements Lock {\n    private static class Sync extends AbstractQueuedSynchronizer {\n        // \u5C1D\u8BD5\u83B7\u53D6\u9501\n        @Override\n        protected boolean tryAcquire(int arg) {\n            return compareAndSetState(0, 1);\n        }\n        \n        // \u5C1D\u8BD5\u91CA\u653E\u9501\n        @Override\n        protected boolean tryRelease(int arg) {\n            setState(0);\n            return true;\n        }\n        \n        // \u662F\u5426\u88AB\u72EC\u5360\n        @Override\n        protected boolean isHeldExclusively() {\n            return getState() == 1;\n        }\n        \n        Condition newCondition() {\n            return new ConditionObject();\n        }\n    }\n    \n    private final Sync sync = new Sync();\n    \n    @Override\n    public void lock() {\n        sync.acquire(1);\n    }\n    \n    @Override\n    public void unlock() {\n        sync.release(1);\n    }\n    \n    // \u5176\u4ED6\u65B9\u6CD5\u5B9E\u73B0...\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u4E8E AQS \u7684\u540C\u6B65\u5668\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ReentrantLock\uFF1A\u72EC\u5360\u9501"}),"\n",(0,i.jsx)(e.li,{children:"ReentrantReadWriteLock\uFF1A\u8BFB\u5199\u9501"}),"\n",(0,i.jsx)(e.li,{children:"Semaphore\uFF1A\u4FE1\u53F7\u91CF"}),"\n",(0,i.jsx)(e.li,{children:"CountDownLatch\uFF1A\u5012\u8BA1\u6570\u95E8\u6813"}),"\n",(0,i.jsx)(e.li,{children:"CyclicBarrier\uFF1A\u5FAA\u73AF\u6805\u680F\uFF08\u57FA\u4E8E ReentrantLock\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"AQS \u7684\u4F18\u52BF\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B\u7EDF\u4E00\u7684\u6846\u67B6\uFF0C\u7B80\u5316\u540C\u6B65\u5668\u5B9E\u73B0"}),"\n",(0,i.jsx)(e.li,{children:"\u9AD8\u6548\u7684\u7B49\u5F85\u961F\u5217\u7BA1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u652F\u6301\u53EF\u4E2D\u65AD\u3001\u8D85\u65F6\u3001\u516C\u5E73/\u975E\u516C\u5E73"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u4F9B Condition \u652F\u6301"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"30-java-\u4E2D-reentrantlock-\u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48-1",children:"30. Java \u4E2D ReentrantLock \u7684\u5B9E\u73B0\u539F\u7406\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"ReentrantLock \u662F\u57FA\u4E8E AQS \u5B9E\u73B0\u7684\u53EF\u91CD\u5165\u72EC\u5360\u9501\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u7279\u6027\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF\u91CD\u5165\uFF1A\u540C\u4E00\u7EBF\u7A0B\u53EF\u4EE5\u591A\u6B21\u83B7\u53D6\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u516C\u5E73/\u975E\u516C\u5E73\uFF1A\u652F\u6301\u4E24\u79CD\u6A21\u5F0F"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u4E2D\u65AD\uFF1A\u652F\u6301\u4E2D\u65AD\u7B49\u5F85"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u8D85\u65F6\uFF1A\u652F\u6301\u8D85\u65F6\u83B7\u53D6\u9501"}),"\n",(0,i.jsx)(e.li,{children:"Condition \u652F\u6301\uFF1A\u652F\u6301\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u5165\u5B9E\u73B0\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'protected final boolean tryAcquire(int acquires) {\n    final Thread current = Thread.currentThread();\n    int c = getState();\n    \n    if (c == 0) {\n        // \u9501\u7A7A\u95F2\uFF0C\u5C1D\u8BD5\u83B7\u53D6\n        if (compareAndSetState(0, acquires)) {\n            setExclusiveOwnerThread(current);\n            return true;\n        }\n    } else if (current == getExclusiveOwnerThread()) {\n        // \u5F53\u524D\u7EBF\u7A0B\u5DF2\u6301\u6709\u9501\uFF0C\u91CD\u5165\n        int nextc = c + acquires;\n        if (nextc < 0) // \u6EA2\u51FA\u68C0\u67E5\n            throw new Error("Maximum lock count exceeded");\n        setState(nextc);  // \u589E\u52A0\u91CD\u5165\u6B21\u6570\n        return true;\n    }\n    return false;\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89E3\u9501\u6D41\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"protected final boolean tryRelease(int releases) {\n    int c = getState() - releases;\n    if (Thread.currentThread() != getExclusiveOwnerThread())\n        throw new IllegalMonitorStateException();\n    \n    boolean free = false;\n    if (c == 0) {\n        // \u91CD\u5165\u6B21\u6570\u5F52\u96F6\uFF0C\u5B8C\u5168\u91CA\u653E\u9501\n        free = true;\n        setExclusiveOwnerThread(null);\n    }\n    setState(c);  // \u51CF\u5C11\u91CD\u5165\u6B21\u6570\n    return free;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ReentrantLock lock = new ReentrantLock();\n\n// \u57FA\u672C\u4F7F\u7528\nlock.lock();\ntry {\n    // \u4E34\u754C\u533A\u4EE3\u7801\n} finally {\n    lock.unlock();\n}\n\n// \u53EF\u4E2D\u65AD\ntry {\n    lock.lockInterruptibly();\n    // \u4E34\u754C\u533A\u4EE3\u7801\n} catch (InterruptedException e) {\n    // \u5904\u7406\u4E2D\u65AD\n} finally {\n    lock.unlock();\n}\n\n// \u8D85\u65F6\u83B7\u53D6\nif (lock.tryLock(1, TimeUnit.SECONDS)) {\n    try {\n        // \u4E34\u754C\u533A\u4EE3\u7801\n    } finally {\n        lock.unlock();\n    }\n} else {\n    // \u83B7\u53D6\u9501\u5931\u8D25\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u9501 vs \u975E\u516C\u5E73\u9501\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u516C\u5E73\u9501"}),(0,i.jsx)(e.th,{children:"\u975E\u516C\u5E73\u9501"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u83B7\u53D6\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u6309\u6392\u961F\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u53EF\u63D2\u961F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u8F83\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u541E\u5410\u91CF"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u8F83\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7EBF\u7A0B\u5207\u6362"}),(0,i.jsx)(e.td,{children:"\u66F4\u591A"}),(0,i.jsx)(e.td,{children:"\u66F4\u5C11"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u9700\u8981\u516C\u5E73\u6027"}),(0,i.jsx)(e.td,{children:"\u8FFD\u6C42\u6027\u80FD"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"31-java-\u7684-synchronized-\u662F\u600E\u4E48\u5B9E\u73B0\u7684-1",children:"31. Java \u7684 synchronized \u662F\u600E\u4E48\u5B9E\u73B0\u7684\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"synchronized \u662F Java \u63D0\u4F9B\u7684\u5185\u7F6E\u9501\u673A\u5236\uFF0C\u57FA\u4E8E\u5BF9\u8C61\u76D1\u89C6\u5668\uFF08Monitor\uFF09\u5B9E\u73B0\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u5C42\u6B21\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u5B57\u8282\u7801\u5C42\u9762"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void syncMethod() {\n    synchronized (this) {\n        // \u4E34\u754C\u533A\u4EE3\u7801\n    }\n}\n\n// \u5B57\u8282\u7801\nmonitorenter  // \u8FDB\u5165\u76D1\u89C6\u5668\uFF08\u83B7\u53D6\u9501\uFF09\n// \u4E34\u754C\u533A\u4EE3\u7801\nmonitorexit   // \u9000\u51FA\u76D1\u89C6\u5668\uFF08\u91CA\u653E\u9501\uFF09\nmonitorexit   // \u5F02\u5E38\u60C5\u51B5\u7684\u91CA\u653E\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5BF9\u8C61\u5934\uFF08Mark Word\uFF09"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u5BF9\u8C61\u5728\u5185\u5B58\u4E2D\u7684\u5E03\u5C40\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"|--------------------------------------------------------------|\n| Object Header (\u5BF9\u8C61\u5934)                                        |\n|--------------------------------------------------------------|\n| Mark Word (\u6807\u8BB0\u5B57\u6BB5\uFF0C8\u5B57\u8282)                                    |\n| Class Pointer (\u7C7B\u578B\u6307\u9488\uFF0C4/8\u5B57\u8282)                              |\n|--------------------------------------------------------------|\n| Instance Data (\u5B9E\u4F8B\u6570\u636E)                                      |\n|--------------------------------------------------------------|\n| Padding (\u5BF9\u9F50\u586B\u5145)                                            |\n|--------------------------------------------------------------|\n"})}),"\n",(0,i.jsx)(e.p,{children:"Mark Word \u5B58\u50A8\u9501\u4FE1\u606F\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"|----------|---------------------------|\n| \u9501\u72B6\u6001    | Mark Word \u5185\u5BB9             |\n|----------|---------------------------|\n| \u65E0\u9501     | hashCode | age | 0 | 01   |\n| \u504F\u5411\u9501   | threadID | epoch | 1 | 01 |\n| \u8F7B\u91CF\u7EA7\u9501 | \u6808\u4E2D\u9501\u8BB0\u5F55\u6307\u9488 | 00        |\n| \u91CD\u91CF\u7EA7\u9501 | Monitor \u6307\u9488 | 10          |\n| GC\u6807\u8BB0   | \u7A7A | 11                      |\n|----------|---------------------------|\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u9501\u5347\u7EA7\u8FC7\u7A0B"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u9501 \u2192 \u504F\u5411\u9501 \u2192 \u8F7B\u91CF\u7EA7\u9501 \u2192 \u91CD\u91CF\u7EA7\u9501"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u504F\u5411\u9501\uFF08Biased Locking\uFF09\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B2C\u4E00\u6B21\u83B7\u53D6\u9501\u65F6\uFF0CCAS \u5C06\u7EBF\u7A0B ID \u5199\u5165 Mark Word"}),"\n",(0,i.jsx)(e.li,{children:"\u518D\u6B21\u83B7\u53D6\u9501\uFF08\u540C\u4E00\u7EBF\u7A0B\uFF09\uFF0C\u76F4\u63A5\u6267\u884C\uFF08\u65E0\u9700 CAS\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u5176\u4ED6\u7EBF\u7A0B\u7ADE\u4E89\u65F6\uFF0C\u64A4\u9500\u504F\u5411\u9501\uFF0C\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8F7B\u91CF\u7EA7\u9501\uFF08Lightweight Locking\uFF09\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5728\u6808\u5E27\u4E2D\u521B\u5EFA\u9501\u8BB0\u5F55\uFF08Lock Record\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"CAS \u5C06\u5BF9\u8C61\u5934\u7684 Mark Word \u66FF\u6362\u4E3A\u6307\u5411\u9501\u8BB0\u5F55\u7684\u6307\u9488"}),"\n",(0,i.jsx)(e.li,{children:"\u6210\u529F\u5219\u83B7\u53D6\u8F7B\u91CF\u7EA7\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u5931\u8D25\u5219\u81EA\u65CB\u91CD\u8BD5"}),"\n",(0,i.jsx)(e.li,{children:"\u81EA\u65CB\u4E00\u5B9A\u6B21\u6570\u540E\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u91CF\u7EA7\u9501\uFF08Heavyweight Locking\uFF09\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5BF9\u8C61\u5934\u6307\u5411 Monitor \u5BF9\u8C61"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u8FDB\u5165 Monitor \u7684 EntryList"}),"\n",(0,i.jsx)(e.li,{children:"\u7ADE\u4E89 Monitor \u7684 owner"}),"\n",(0,i.jsx)(e.li,{children:"\u83B7\u53D6\u5931\u8D25\u5219\u963B\u585E\uFF08park\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Monitor \u7ED3\u6784\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ObjectMonitor {\n    _owner;      // \u6301\u6709\u9501\u7684\u7EBF\u7A0B\n    _EntryList;  // \u7B49\u5F85\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u961F\u5217\n    _WaitSet;    // \u8C03\u7528 wait() \u7684\u7EBF\u7A0B\u961F\u5217\n    _count;      // \u91CD\u5165\u6B21\u6570\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B8C\u6574\u6D41\u7A0B\u56FE\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u5BF9\u8C61\u521B\u5EFA\n   \u2193\n\u65E0\u9501\u72B6\u6001\uFF08001\uFF09\n   \u2193 \u7EBF\u7A0B1\u8BBF\u95EE\n\u504F\u5411\u9501\uFF08101\uFF09- \u7EBF\u7A0BID = \u7EBF\u7A0B1\n   \u2193 \u7EBF\u7A0B2\u7ADE\u4E89\n\u8F7B\u91CF\u7EA7\u9501\uFF0800\uFF09- \u81EA\u65CB\u83B7\u53D6\n   \u2193 \u81EA\u65CB\u5931\u8D25/\u7ADE\u4E89\u6FC0\u70C8\n\u91CD\u91CF\u7EA7\u9501\uFF0810\uFF09- \u963B\u585E\u7B49\u5F85\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F18\u5316\u6280\u672F\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u6D88\u9664"}),"\uFF1AJIT \u7F16\u8BD1\u5668\u68C0\u6D4B\u5230\u4E0D\u53EF\u80FD\u5B58\u5728\u7ADE\u4E89\uFF0C\u6D88\u9664\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u7C97\u5316"}),"\uFF1A\u591A\u4E2A\u8FDE\u7EED\u7684\u52A0\u9501\u89E3\u9501\u64CD\u4F5C\u5408\u5E76\u4E3A\u4E00\u6B21"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u9002\u5E94\u81EA\u65CB"}),"\uFF1A\u6839\u636E\u5386\u53F2\u81EA\u65CB\u6210\u529F\u7387\u52A8\u6001\u8C03\u6574\u81EA\u65CB\u6B21\u6570"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"32-synchronized-\u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B-1",children:"32. Synchronized \u4FEE\u9970\u9759\u6001\u65B9\u6CD5\u548C\u4FEE\u9970\u666E\u901A\u65B9\u6CD5\u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u4E3B\u8981\u533A\u522B\u5728\u4E8E\u9501\u7684\u5BF9\u8C61\u4E0D\u540C\uFF1A"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4FEE\u9970\u666E\u901A\u65B9\u6CD5\uFF08\u5B9E\u4F8B\u65B9\u6CD5\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class MyClass {\n    // \u9501\u5BF9\u8C61\u662F this\uFF08\u5F53\u524D\u5B9E\u4F8B\uFF09\n    public synchronized void instanceMethod() {\n        // \u4E34\u754C\u533A\n    }\n    \n    // \u7B49\u4EF7\u4E8E\n    public void instanceMethod2() {\n        synchronized (this) {\n            // \u4E34\u754C\u533A\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9501\u5BF9\u8C61\u662F\u5F53\u524D\u5B9E\u4F8B\uFF08this\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u540C\u5B9E\u4F8B\u4E4B\u95F4\u4E0D\u4E92\u65A5"}),"\n",(0,i.jsx)(e.li,{children:"\u540C\u4E00\u5B9E\u4F8B\u7684\u591A\u4E2A\u540C\u6B65\u65B9\u6CD5\u4E92\u65A5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u4FEE\u9970\u9759\u6001\u65B9\u6CD5\uFF08\u7C7B\u65B9\u6CD5\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class MyClass {\n    // \u9501\u5BF9\u8C61\u662F MyClass.class\uFF08\u7C7B\u5BF9\u8C61\uFF09\n    public static synchronized void staticMethod() {\n        // \u4E34\u754C\u533A\n    }\n    \n    // \u7B49\u4EF7\u4E8E\n    public static void staticMethod2() {\n        synchronized (MyClass.class) {\n            // \u4E34\u754C\u533A\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9501\u5BF9\u8C61\u662F Class \u5BF9\u8C61\uFF08MyClass.class\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u6240\u6709\u5B9E\u4F8B\u5171\u4EAB\u540C\u4E00\u4E2A\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u7C7B\u7684\u6240\u6709\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u4E92\u65A5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u4FEE\u9970\u5B9E\u4F8B\u65B9\u6CD5"}),(0,i.jsx)(e.th,{children:"\u4FEE\u9970\u9759\u6001\u65B9\u6CD5"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9501\u5BF9\u8C61"}),(0,i.jsx)(e.td,{children:"this\uFF08\u5B9E\u4F8B\u5BF9\u8C61\uFF09"}),(0,i.jsx)(e.td,{children:"Class \u5BF9\u8C61"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F5C\u7528\u8303\u56F4"}),(0,i.jsx)(e.td,{children:"\u5F53\u524D\u5B9E\u4F8B"}),(0,i.jsx)(e.td,{children:"\u6240\u6709\u5B9E\u4F8B"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4E92\u65A5\u8303\u56F4"}),(0,i.jsx)(e.td,{children:"\u540C\u4E00\u5B9E\u4F8B\u7684\u540C\u6B65\u65B9\u6CD5"}),(0,i.jsx)(e.td,{children:"\u6240\u6709\u9759\u6001\u540C\u6B65\u65B9\u6CD5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F7F\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u5B9E\u4F8B\u53D8\u91CF\u4FDD\u62A4"}),(0,i.jsx)(e.td,{children:"\u9759\u6001\u53D8\u91CF\u4FDD\u62A4"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"33-java-\u4E2D\u7684-synchronized-\u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB-1",children:"33. Java \u4E2D\u7684 synchronized \u8F7B\u91CF\u7EA7\u9501\u662F\u5426\u4F1A\u8FDB\u884C\u81EA\u65CB\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u662F\u7684\uFF0C\u8F7B\u91CF\u7EA7\u9501\u4F1A\u8FDB\u884C\u81EA\u65CB\uFF0C\u4F46\u6709\u6761\u4EF6\u9650\u5236\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7684\u539F\u56E0\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u7EBF\u7A0B\u963B\u585E\u548C\u5524\u9192\u7684\u5F00\u9500"}),"\n",(0,i.jsx)(e.li,{children:"\u9002\u7528\u4E8E\u9501\u6301\u6709\u65F6\u95F4\u77ED\u7684\u573A\u666F"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u5728\u7528\u6237\u6001\u81EA\u65CB\uFF0C\u4E0D\u8FDB\u5165\u5185\u6838\u6001"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u8FC7\u7A0B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u8F7B\u91CF\u7EA7\u9501\u83B7\u53D6\u6D41\u7A0B\nwhile (true) {\n    // 1. \u5C1D\u8BD5 CAS \u83B7\u53D6\u9501\n    if (CAS\u6210\u529F) {\n        \u83B7\u53D6\u9501\u6210\u529F;\n        break;\n    }\n    \n    // 2. CAS \u5931\u8D25\uFF0C\u81EA\u65CB\u91CD\u8BD5\n    if (\u81EA\u65CB\u6B21\u6570 < \u6700\u5927\u81EA\u65CB\u6B21\u6570) {\n        \u81EA\u65CB\u6B21\u6570++;\n        continue; // \u7EE7\u7EED\u81EA\u65CB\n    } else {\n        // 3. \u81EA\u65CB\u5931\u8D25\uFF0C\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\n        \u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501();\n        \u963B\u585E\u7B49\u5F85();\n        break;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7B56\u7565\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u56FA\u5B9A\u6B21\u6570\u81EA\u65CB\uFF08JDK 1.6 \u4E4B\u524D\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9ED8\u8BA4\u81EA\u65CB10\u6B21\n-XX:PreBlockSpin=10\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u81EA\u9002\u5E94\u81EA\u65CB\uFF08JDK 1.6+\uFF09"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6839\u636E\u5386\u53F2\u81EA\u65CB\u6210\u529F\u7387\u52A8\u6001\u8C03\u6574"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u4E0A\u6B21\u81EA\u65CB\u6210\u529F\uFF0C\u5141\u8BB8\u66F4\u591A\u6B21\u81EA\u65CB"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u67D0\u4E2A\u9501\u81EA\u65CB\u5F88\u5C11\u6210\u529F\uFF0C\u53EF\u80FD\u76F4\u63A5\u7701\u7565\u81EA\u65CB"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u65CB\u7684\u6761\u4EF6\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"CPU \u6838\u5FC3\u6570 > 1"}),"\uFF08\u5355\u6838 CPU \u81EA\u65CB\u65E0\u610F\u4E49\uFF09"]}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u9501\u6301\u6709\u65F6\u95F4\u77ED"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u7ADE\u4E89\u4E0D\u6FC0\u70C8"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"JVM \u53C2\u6570\u63A7\u5236\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5F00\u542F/\u5173\u95ED\u81EA\u65CB\u9501\u4F18\u5316\uFF08\u9ED8\u8BA4\u5F00\u542F\uFF09\n-XX:+UseSpinning\n-XX:-UseSpinning\n\n# \u8BBE\u7F6E\u81EA\u65CB\u6B21\u6570\uFF08JDK 1.6 \u4E4B\u524D\uFF09\n-XX:PreBlockSpin=10\n\n# \u5F00\u542F\u81EA\u9002\u5E94\u81EA\u65CB\uFF08JDK 1.6+ \u9ED8\u8BA4\u5F00\u542F\uFF09\n-XX:+UseAdaptiveSpinning\n"})}),"\n",(0,i.jsx)(e.h3,{id:"34-synchronized-\u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F-1",children:"34. Synchronized \u80FD\u4E0D\u80FD\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u80FD\u3002synchronized \u53EF\u4EE5\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\uFF0C\u4FDD\u8BC1\u6709\u5E8F\u6027\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u7406\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"synchronized \u901A\u8FC7\u4EE5\u4E0B\u673A\u5236\u4FDD\u8BC1\u6709\u5E8F\u6027\uFF1A"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"happens-before \u89C4\u5219"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5BF9\u4E00\u4E2A\u9501\u7684\u89E3\u9501 happens-before \u4E8E\u540E\u7EED\u5BF9\u8FD9\u4E2A\u9501\u7684\u52A0\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u4FDD\u8BC1\u89E3\u9501\u524D\u7684\u6240\u6709\u64CD\u4F5C\u5BF9\u52A0\u9501\u540E\u7684\u64CD\u4F5C\u53EF\u89C1"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u5C4F\u969C"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8FDB\u5165 synchronized \u5757\u65F6\u63D2\u5165 Load \u5C4F\u969C"}),"\n",(0,i.jsx)(e.li,{children:"\u9000\u51FA synchronized \u5757\u65F6\u63D2\u5165 Store \u5C4F\u969C"}),"\n",(0,i.jsx)(e.li,{children:"\u9632\u6B62\u4E34\u754C\u533A\u5185\u7684\u6307\u4EE4\u91CD\u6392\u5230\u4E34\u754C\u533A\u5916"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class SynchronizedOrdering {\n    private int a = 0;\n    private int b = 0;\n    \n    public synchronized void method1() {\n        a = 1;  // \u64CD\u4F5C1\n        b = 2;  // \u64CD\u4F5C2\n    }\n    \n    public synchronized void method2() {\n        int x = b;  // \u64CD\u4F5C3\n        int y = a;  // \u64CD\u4F5C4\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FDD\u8BC1\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u64CD\u4F5C1\u548C\u64CD\u4F5C2\u4E0D\u4F1A\u91CD\u6392\u5230 synchronized \u5757\u5916"}),"\n",(0,i.jsx)(e.li,{children:"\u64CD\u4F5C3\u548C\u64CD\u4F5C4\u4E0D\u4F1A\u91CD\u6392\u5230 synchronized \u5757\u5916"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u7EBF\u7A0B1\u5148\u6267\u884C method1\uFF0C\u7EBF\u7A0B2\u540E\u6267\u884C method2\uFF0C\u5219\u7EBF\u7A0B2\u4E00\u5B9A\u80FD\u770B\u5230 a=1, b=2"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E0E volatile \u7684\u533A\u522B\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"synchronized"}),(0,i.jsx)(e.th,{children:"volatile"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u539F\u5B50\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"}),(0,i.jsx)(e.td,{children:"\u4E0D\u4FDD\u8BC1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u89C1\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6709\u5E8F\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u8F83\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u590D\u5408\u64CD\u4F5C"}),(0,i.jsx)(e.td,{children:"\u5355\u4E2A\u53D8\u91CF"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"35-\u5F53-java-\u7684-synchronized-\u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417-1",children:"35. \u5F53 Java \u7684 synchronized \u5347\u7EA7\u5230\u91CD\u91CF\u7EA7\u9501\u540E\uFF0C\u6240\u6709\u7EBF\u7A0B\u90FD\u91CA\u653E\u9501\u4E86\uFF0C\u6B64\u65F6\u5B83\u8FD8\u662F\u91CD\u91CF\u7EA7\u9501\u5417\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u662F\u7684\uFF0C\u9501\u5347\u7EA7\u662F\u5355\u5411\u7684\uFF0C\u4E0D\u4F1A\u964D\u7EA7\uFF08\u5728\u5927\u591A\u6570 JVM \u5B9E\u73B0\u4E2D\uFF09\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u56E0\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u8003\u8651"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9501\u964D\u7EA7\u9700\u8981\u989D\u5916\u7684\u68C0\u6D4B\u548C\u5904\u7406\u903B\u8F91"}),"\n",(0,i.jsx)(e.li,{children:"\u964D\u7EA7\u8FC7\u7A0B\u672C\u8EAB\u6709\u5F00\u9500"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u9891\u7E41\u5347\u7EA7\u964D\u7EA7\uFF0C\u53CD\u800C\u964D\u4F4E\u6027\u80FD"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u590D\u6742\u5EA6"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u5224\u65AD\u4F55\u65F6\u964D\u7EA7"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u5904\u7406\u964D\u7EA7\u8FC7\u7A0B\u4E2D\u7684\u5E76\u53D1\u95EE\u9898"}),"\n",(0,i.jsx)(e.li,{children:"\u589E\u52A0 JVM \u5B9E\u73B0\u590D\u6742\u5EA6"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u573A\u666F"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E00\u65E6\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\uFF0C\u8BF4\u660E\u5B58\u5728\u7ADE\u4E89"}),"\n",(0,i.jsx)(e.li,{children:"\u7ADE\u4E89\u53EF\u80FD\u518D\u6B21\u53D1\u751F"}),"\n",(0,i.jsx)(e.li,{children:"\u4FDD\u6301\u91CD\u91CF\u7EA7\u9501\u72B6\u6001\u66F4\u5408\u7406"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9501\u5347\u7EA7\u8DEF\u5F84\uFF08\u5355\u5411\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u65E0\u9501 \u2192 \u504F\u5411\u9501 \u2192 \u8F7B\u91CF\u7EA7\u9501 \u2192 \u91CD\u91CF\u7EA7\u9501\n      \u2193        \u2193          \u2193\n      \u4E0D\u53EF\u9006    \u4E0D\u53EF\u9006      \u4E0D\u53EF\u9006\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u6B8A\u60C5\u51B5\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u67D0\u4E9B JVM \u5B9E\u73B0\uFF08\u5982 JDK 15+ \u7684 ZGC\uFF09\u5728 GC \u65F6\u53EF\u80FD\u4F1A\u91CD\u7F6E\u9501\u72B6\u6001\uFF0C\u4F46\u8FD9\u4E0D\u662F\u5E38\u89C4\u7684\u9501\u964D\u7EA7\u673A\u5236\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"JVM \u53C2\u6570\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u7981\u7528\u504F\u5411\u9501\uFF08\u76F4\u63A5\u4ECE\u65E0\u9501\u5230\u8F7B\u91CF\u7EA7\u9501\uFF09\n-XX:-UseBiasedLocking\n\n# \u504F\u5411\u9501\u5EF6\u8FDF\u542F\u52A8\u65F6\u95F4\uFF08\u9ED8\u8BA44\u79D2\uFF09\n-XX:BiasedLockingStartupDelay=0\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u4E0D\u5FC5\u8981\u7684\u9501\u7ADE\u4E89"}),"\n",(0,i.jsx)(e.li,{children:"\u51CF\u5C11\u9501\u6301\u6709\u65F6\u95F4"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u5408\u9002\u7684\u5E76\u53D1\u5DE5\u5177\u7C7B"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u4F7F\u7528 ReentrantLock\uFF08\u53EF\u4EE5\u66F4\u7075\u6D3B\u5730\u63A7\u5236\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"36-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB-1",children:"36. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u9501\u81EA\u9002\u5E94\u81EA\u65CB\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u9501\u81EA\u9002\u5E94\u81EA\u65CB\u662F JDK 1.6 \u5F15\u5165\u7684\u4F18\u5316\u6280\u672F\uFF0C\u6839\u636E\u5386\u53F2\u81EA\u65CB\u6210\u529F\u7387\u52A8\u6001\u8C03\u6574\u81EA\u65CB\u6B21\u6570\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F20\u7EDF\u81EA\u65CB\uFF08\u56FA\u5B9A\u6B21\u6570\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// JDK 1.6 \u4E4B\u524D\uFF0C\u56FA\u5B9A\u81EA\u65CB10\u6B21\nfor (int i = 0; i < 10; i++) {\n    if (tryAcquireLock()) {\n        return; // \u83B7\u53D6\u6210\u529F\n    }\n}\n// \u81EA\u65CB\u5931\u8D25\uFF0C\u963B\u585E\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u9002\u5E94\u81EA\u65CB\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u6839\u636E\u5386\u53F2\u8BB0\u5F55\u52A8\u6001\u8C03\u6574\nif (\u4E0A\u6B21\u5728\u8FD9\u4E2A\u9501\u4E0A\u81EA\u65CB\u6210\u529F) {\n    \u5141\u8BB8\u66F4\u957F\u65F6\u95F4\u7684\u81EA\u65CB;\n} else if (\u4E0A\u6B21\u81EA\u65CB\u5931\u8D25) {\n    \u51CF\u5C11\u81EA\u65CB\u65F6\u95F4\u6216\u76F4\u63A5\u963B\u585E;\n}\n\n// \u5982\u679C\u67D0\u4E2A\u9501\u5F88\u5C11\u81EA\u65CB\u6210\u529F\uFF0C\u53EF\u80FD\u76F4\u63A5\u8DF3\u8FC7\u81EA\u65CB\nif (\u8FD9\u4E2A\u9501\u5386\u53F2\u4E0A\u81EA\u65CB\u6210\u529F\u7387\u5F88\u4F4E) {\n    \u76F4\u63A5\u963B\u585E\uFF0C\u4E0D\u81EA\u65CB;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u9002\u5E94\u7B56\u7565\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u4E8E\u9501\u7684\u5386\u53F2"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8BB0\u5F55\u6BCF\u4E2A\u9501\u7684\u81EA\u65CB\u6210\u529F\u7387"}),"\n",(0,i.jsx)(e.li,{children:"\u6210\u529F\u7387\u9AD8\u7684\u9501\u5141\u8BB8\u66F4\u591A\u81EA\u65CB"}),"\n",(0,i.jsx)(e.li,{children:"\u6210\u529F\u7387\u4F4E\u7684\u9501\u51CF\u5C11\u6216\u8DF3\u8FC7\u81EA\u65CB"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u4E8E\u7EBF\u7A0B\u7684\u5386\u53F2"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u7EBF\u7A0B\u6700\u8FD1\u81EA\u65CB\u6210\u529F\u8FC7\uFF0C\u5141\u8BB8\u66F4\u591A\u81EA\u65CB"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u7EBF\u7A0B\u6700\u8FD1\u81EA\u65CB\u603B\u662F\u5931\u8D25\uFF0C\u51CF\u5C11\u81EA\u65CB"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u4E8E\u6301\u6709\u9501\u7684\u7EBF\u7A0B\u72B6\u6001"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u6301\u6709\u9501\u7684\u7EBF\u7A0B\u6B63\u5728\u8FD0\u884C\uFF0C\u81EA\u65CB\u7B49\u5F85"}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679C\u6301\u6709\u9501\u7684\u7EBF\u7A0B\u5DF2\u88AB\u6302\u8D77\uFF0C\u76F4\u63A5\u963B\u585E"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u66F4\u667A\u80FD\u7684\u81EA\u65CB\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u51CF\u5C11\u65E0\u6548\u81EA\u65CB\uFF0C\u964D\u4F4E CPU \u6D6A\u8D39"}),"\n",(0,i.jsx)(e.li,{children:"\u63D0\u9AD8\u9501\u7684\u6574\u4F53\u6027\u80FD"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"JVM \u53C2\u6570\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5F00\u542F\u81EA\u9002\u5E94\u81EA\u65CB\uFF08JDK 1.6+ \u9ED8\u8BA4\u5F00\u542F\uFF09\n-XX:+UseAdaptiveSpinning\n\n# \u5173\u95ED\u81EA\u9002\u5E94\u81EA\u65CB\n-XX:-UseAdaptiveSpinning\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u573A\u666F1\uFF1A\u9501\u6301\u6709\u65F6\u95F4\u77ED\uFF0C\u7ADE\u4E89\u5C11\n// \u81EA\u9002\u5E94\u81EA\u65CB\u4F1A\u589E\u52A0\u81EA\u65CB\u6B21\u6570\uFF0C\u63D0\u9AD8\u6027\u80FD\n\n// \u573A\u666F2\uFF1A\u9501\u6301\u6709\u65F6\u95F4\u957F\uFF0C\u7ADE\u4E89\u6FC0\u70C8\n// \u81EA\u9002\u5E94\u81EA\u65CB\u4F1A\u51CF\u5C11\u81EA\u65CB\u6B21\u6570\uFF0C\u907F\u514D CPU \u6D6A\u8D39\n\n// \u573A\u666F3\uFF1A\u67D0\u4E2A\u9501\u4ECE\u4E0D\u81EA\u65CB\u6210\u529F\n// \u81EA\u9002\u5E94\u81EA\u65CB\u4F1A\u8DF3\u8FC7\u81EA\u65CB\uFF0C\u76F4\u63A5\u963B\u585E\n"})}),"\n",(0,i.jsx)(e.h3,{id:"37-synchronized-\u548C-reentrantlock-\u6709\u4EC0\u4E48\u533A\u522B-1",children:"37. Synchronized \u548C ReentrantLock \u6709\u4EC0\u4E48\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"synchronized"}),(0,i.jsx)(e.th,{children:"ReentrantLock"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5B9E\u73B0\u5C42\u9762"}),(0,i.jsx)(e.td,{children:"JVM \u5185\u7F6E\uFF08\u5173\u952E\u5B57\uFF09"}),(0,i.jsx)(e.td,{children:"JDK \u5B9E\u73B0\uFF08\u7C7B\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9501\u7684\u83B7\u53D6/\u91CA\u653E"}),(0,i.jsx)(e.td,{children:"\u81EA\u52A8"}),(0,i.jsx)(e.td,{children:"\u624B\u52A8\uFF08\u9700\u8981 try-finally\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u4E2D\u65AD"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\uFF08lockInterruptibly\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8D85\u65F6\u83B7\u53D6"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\uFF08tryLock(timeout)\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u516C\u5E73\u9501"}),(0,i.jsx)(e.td,{children:"\u975E\u516C\u5E73"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\u516C\u5E73/\u975E\u516C\u5E73"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6761\u4EF6\u53D8\u91CF"}),(0,i.jsx)(e.td,{children:"\u5355\u4E2A\uFF08wait/notify\uFF09"}),(0,i.jsx)(e.td,{children:"\u591A\u4E2A\uFF08Condition\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u91CD\u5165"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9501\u72B6\u6001\u67E5\u8BE2"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\uFF08isLocked\u3001getHoldCount\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"JDK 1.6+ \u4F18\u5316\u540E\u76F8\u5F53"}),(0,i.jsx)(e.td,{children:"\u76F8\u5F53"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4F7F\u7528\u65B9\u5F0F"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized\uFF1A\u81EA\u52A8\u91CA\u653E\npublic synchronized void method() {\n    // \u4E34\u754C\u533A\n}\n\n// ReentrantLock\uFF1A\u624B\u52A8\u91CA\u653E\nReentrantLock lock = new ReentrantLock();\nlock.lock();\ntry {\n    // \u4E34\u754C\u533A\n} finally {\n    lock.unlock(); // \u5FC5\u987B\u5728 finally \u4E2D\u91CA\u653E\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u53EF\u4E2D\u65AD"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized\uFF1A\u4E0D\u53EF\u4E2D\u65AD\nsynchronized (lock) {\n    // \u65E0\u6CD5\u54CD\u5E94\u4E2D\u65AD\n}\n\n// ReentrantLock\uFF1A\u53EF\u4E2D\u65AD\ntry {\n    lock.lockInterruptibly();\n    // \u53EF\u4EE5\u54CD\u5E94\u4E2D\u65AD\n} catch (InterruptedException e) {\n    // \u5904\u7406\u4E2D\u65AD\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u8D85\u65F6\u83B7\u53D6"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized\uFF1A\u4E0D\u652F\u6301\u8D85\u65F6\n\n// ReentrantLock\uFF1A\u652F\u6301\u8D85\u65F6\nif (lock.tryLock(1, TimeUnit.SECONDS)) {\n    try {\n        // \u83B7\u53D6\u9501\u6210\u529F\n    } finally {\n        lock.unlock();\n    }\n} else {\n    // \u83B7\u53D6\u9501\u8D85\u65F6\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u516C\u5E73\u9501"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized\uFF1A\u53EA\u652F\u6301\u975E\u516C\u5E73\u9501\n\n// ReentrantLock\uFF1A\u652F\u6301\u516C\u5E73\u9501\nReentrantLock fairLock = new ReentrantLock(true);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u6761\u4EF6\u53D8\u91CF"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized\uFF1A\u5355\u4E2A\u6761\u4EF6\u53D8\u91CF\nsynchronized (lock) {\n    lock.wait();\n    lock.notify();\n}\n\n// ReentrantLock\uFF1A\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF\nCondition condition1 = lock.newCondition();\nCondition condition2 = lock.newCondition();\ncondition1.await();\ncondition1.signal();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u9501\u72B6\u6001\u67E5\u8BE2"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized\uFF1A\u4E0D\u652F\u6301\n\n// ReentrantLock\uFF1A\u652F\u6301\nboolean isLocked = lock.isLocked();\nint holdCount = lock.getHoldCount();\nboolean hasQueuedThreads = lock.hasQueuedThreads();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7B80\u5355\u573A\u666F\uFF1A\u4F7F\u7528 synchronized\uFF08\u4EE3\u7801\u7B80\u6D01\uFF09"}),"\n",(0,i.jsxs)(e.li,{children:["\u9700\u8981\u9AD8\u7EA7\u529F\u80FD\uFF1A\u4F7F\u7528 ReentrantLock","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF\u4E2D\u65AD"}),"\n",(0,i.jsx)(e.li,{children:"\u8D85\u65F6\u83B7\u53D6"}),"\n",(0,i.jsx)(e.li,{children:"\u516C\u5E73\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u72B6\u6001\u67E5\u8BE2"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"38-volatile-\u4E0E-synchronized-\u7684\u533A\u522B\u662F\u4EC0\u4E48-1",children:"38. Volatile \u4E0E Synchronized \u7684\u533A\u522B\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"volatile"}),(0,i.jsx)(e.th,{children:"synchronized"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u7C7B\u578B"}),(0,i.jsx)(e.td,{children:"\u5173\u952E\u5B57\uFF08\u53D8\u91CF\u4FEE\u9970\u7B26\uFF09"}),(0,i.jsx)(e.td,{children:"\u5173\u952E\u5B57\uFF08\u65B9\u6CD5/\u4EE3\u7801\u5757\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u539F\u5B50\u6027"}),(0,i.jsx)(e.td,{children:"\u4E0D\u4FDD\u8BC1"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u89C1\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6709\u5E8F\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1\uFF08\u7981\u6B62\u91CD\u6392\uFF09"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u963B\u585E"}),(0,i.jsx)(e.td,{children:"\u4E0D\u963B\u585E"}),(0,i.jsx)(e.td,{children:"\u53EF\u80FD\u963B\u585E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u8F83\u4F4E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u5355\u4E2A\u53D8\u91CF"}),(0,i.jsx)(e.td,{children:"\u590D\u5408\u64CD\u4F5C"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u539F\u5B50\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile\uFF1A\u4E0D\u4FDD\u8BC1\u539F\u5B50\u6027\nprivate volatile int count = 0;\n\npublic void increment() {\n    count++; // \u975E\u539F\u5B50\u64CD\u4F5C\uFF0C\u7EBF\u7A0B\u4E0D\u5B89\u5168\n}\n\n// synchronized\uFF1A\u4FDD\u8BC1\u539F\u5B50\u6027\nprivate int count = 0;\n\npublic synchronized void increment() {\n    count++; // \u539F\u5B50\u64CD\u4F5C\uFF0C\u7EBF\u7A0B\u5B89\u5168\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u53EF\u89C1\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile\uFF1A\u4FDD\u8BC1\u53EF\u89C1\u6027\nprivate volatile boolean flag = false;\n\n// \u7EBF\u7A0B1\nflag = true; // \u7ACB\u5373\u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1\n\n// \u7EBF\u7A0B2\nwhile (!flag) {\n    // \u80FD\u7ACB\u5373\u770B\u5230 flag \u7684\u53D8\u5316\n}\n\n// synchronized\uFF1A\u4E5F\u4FDD\u8BC1\u53EF\u89C1\u6027\nprivate boolean flag = false;\n\nsynchronized (lock) {\n    flag = true; // \u89E3\u9501\u65F6\u5237\u65B0\u5230\u4E3B\u5185\u5B58\n}\n\nsynchronized (lock) {\n    if (flag) { // \u52A0\u9501\u65F6\u4ECE\u4E3B\u5185\u5B58\u8BFB\u53D6\n        // ...\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6709\u5E8F\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile\uFF1A\u7981\u6B62\u6307\u4EE4\u91CD\u6392\nprivate volatile boolean initialized = false;\nprivate int value;\n\n// \u7EBF\u7A0B1\nvalue = 10;\ninitialized = true; // \u4E0D\u4F1A\u91CD\u6392\u5230 value = 10 \u4E4B\u524D\n\n// \u7EBF\u7A0B2\nif (initialized) {\n    int x = value; // \u4E00\u5B9A\u80FD\u770B\u5230 value = 10\n}\n\n// synchronized\uFF1A\u4E5F\u7981\u6B62\u6307\u4EE4\u91CD\u6392\nsynchronized (lock) {\n    value = 10;\n    initialized = true;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F7F\u7528\u573A\u666F"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"volatile \u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u72B6\u6001\u6807\u5FD7\nprivate volatile boolean running = true;\n\npublic void stop() {\n    running = false;\n}\n\npublic void run() {\n    while (running) {\n        // \u6267\u884C\u4EFB\u52A1\n    }\n}\n\n// 2. \u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\uFF08DCL\uFF09\nprivate volatile static Singleton instance;\n\npublic static Singleton getInstance() {\n    if (instance == null) {\n        synchronized (Singleton.class) {\n            if (instance == null) {\n                instance = new Singleton();\n            }\n        }\n    }\n    return instance;\n}\n\n// 3. \u72EC\u7ACB\u89C2\u5BDF\nprivate volatile long lastUpdateTime;\n\npublic void update() {\n    // \u66F4\u65B0\u6570\u636E\n    lastUpdateTime = System.currentTimeMillis();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"synchronized \u9002\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u590D\u5408\u64CD\u4F5C\nprivate int count = 0;\n\npublic synchronized void increment() {\n    count++; // \u8BFB-\u6539-\u5199\n}\n\n// 2. \u591A\u4E2A\u53D8\u91CF\u7684\u4E00\u81F4\u6027\nprivate int a = 0;\nprivate int b = 0;\n\npublic synchronized void update() {\n    a++;\n    b++; // \u4FDD\u8BC1 a \u548C b \u540C\u65F6\u66F4\u65B0\n}\n\n// 3. \u7B49\u5F85/\u901A\u77E5\u673A\u5236\nsynchronized (lock) {\n    while (!condition) {\n        lock.wait();\n    }\n    // \u6267\u884C\u64CD\u4F5C\n    lock.notify();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"volatile\uFF1A\u8BFB\u5199\u64CD\u4F5C\u51E0\u4E4E\u65E0\u5F00\u9500"}),"\n",(0,i.jsx)(e.li,{children:"synchronized\uFF1A\u6709\u9501\u7ADE\u4E89\u65F6\u5F00\u9500\u8F83\u5927"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5EFA\u8BAE\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5355\u4E2A\u53D8\u91CF\u7684\u53EF\u89C1\u6027\uFF1Avolatile"}),"\n",(0,i.jsx)(e.li,{children:"\u590D\u5408\u64CD\u4F5C\uFF1Asynchronized \u6216 Lock"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u7B49\u5F85/\u901A\u77E5\uFF1Asynchronized \u6216 Lock + Condition"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"39-\u5982\u4F55\u4F18\u5316-java-\u4E2D\u7684\u9501\u7684\u4F7F\u7528-1",children:"39. \u5982\u4F55\u4F18\u5316 Java \u4E2D\u7684\u9501\u7684\u4F7F\u7528\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u51CF\u5C11\u9501\u7684\u6301\u6709\u65F6\u95F4"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\npublic synchronized void method() {\n    // \u5927\u91CF\u975E\u4E34\u754C\u533A\u4EE3\u7801\n    doSomething();\n    // \u4E34\u754C\u533A\u4EE3\u7801\n    criticalSection();\n    // \u66F4\u591A\u975E\u4E34\u754C\u533A\u4EE3\u7801\n    doMore();\n}\n\n// \u4F18\u5316\u540E\npublic void method() {\n    doSomething();\n    \n    synchronized (lock) {\n        // \u53EA\u9501\u4E34\u754C\u533A\n        criticalSection();\n    }\n    \n    doMore();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u51CF\u5C0F\u9501\u7684\u7C92\u5EA6"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u9501\u6574\u4E2A\u5BF9\u8C61\npublic class UserService {\n    private synchronized void updateUser() { }\n    private synchronized void updateOrder() { }\n}\n\n// \u4F18\u5316\u540E\uFF1A\u4F7F\u7528\u4E0D\u540C\u7684\u9501\npublic class UserService {\n    private final Object userLock = new Object();\n    private final Object orderLock = new Object();\n    \n    public void updateUser() {\n        synchronized (userLock) { }\n    }\n    \n    public void updateOrder() {\n        synchronized (orderLock) { }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u9501\u5206\u6BB5\uFF08Lock Striping\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// ConcurrentHashMap \u7684\u5B9E\u73B0\u601D\u60F3\npublic class StripedMap {\n    private static final int N_LOCKS = 16;\n    private final Node[] buckets;\n    private final Object[] locks;\n    \n    public StripedMap(int numBuckets) {\n        buckets = new Node[numBuckets];\n        locks = new Object[N_LOCKS];\n        for (int i = 0; i < N_LOCKS; i++) {\n            locks[i] = new Object();\n        }\n    }\n    \n    private final int hash(Object key) {\n        return Math.abs(key.hashCode() % buckets.length);\n    }\n    \n    public Object get(Object key) {\n        int hash = hash(key);\n        synchronized (locks[hash % N_LOCKS]) {\n            // \u8BBF\u95EE buckets[hash]\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F7F\u7528\u8BFB\u5199\u9501"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u8BFB\u5199\u90FD\u7528\u540C\u4E00\u4E2A\u9501\nprivate final Object lock = new Object();\n\npublic Object read() {\n    synchronized (lock) {\n        return data;\n    }\n}\n\npublic void write(Object newData) {\n    synchronized (lock) {\n        data = newData;\n    }\n}\n\n// \u4F18\u5316\u540E\uFF1A\u4F7F\u7528\u8BFB\u5199\u9501\nprivate final ReadWriteLock rwLock = new ReentrantReadWriteLock();\n\npublic Object read() {\n    rwLock.readLock().lock();\n    try {\n        return data;\n    } finally {\n        rwLock.readLock().unlock();\n    }\n}\n\npublic void write(Object newData) {\n    rwLock.writeLock().lock();\n    try {\n        data = newData;\n    } finally {\n        rwLock.writeLock().unlock();\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u4F7F\u7528\u65E0\u9501\u6570\u636E\u7ED3\u6784"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u4F7F\u7528\u9501\nprivate int count = 0;\n\npublic synchronized void increment() {\n    count++;\n}\n\n// \u4F18\u5316\u540E\uFF1A\u4F7F\u7528\u539F\u5B50\u7C7B\nprivate AtomicInteger count = new AtomicInteger(0);\n\npublic void increment() {\n    count.incrementAndGet();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u907F\u514D\u9501\u5D4C\u5957"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u53EF\u80FD\u6B7B\u9501\npublic synchronized void method1() {\n    synchronized (lock2) {\n        // ...\n    }\n}\n\npublic synchronized void method2() {\n    synchronized (lock1) {\n        // ...\n    }\n}\n\n// \u4F18\u5316\u540E\uFF1A\u7EDF\u4E00\u52A0\u9501\u987A\u5E8F\u6216\u907F\u514D\u5D4C\u5957\npublic void method1() {\n    synchronized (lock1) {\n        synchronized (lock2) {\n            // ...\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. \u4F7F\u7528 ConcurrentHashMap \u66FF\u4EE3 Hashtable"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\nMap<String, String> map = new Hashtable<>();\n\n// \u4F18\u5316\u540E\nMap<String, String> map = new ConcurrentHashMap<>();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"8. \u4F7F\u7528 ThreadLocal"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u5171\u4EAB\u53D8\u91CF\u9700\u8981\u540C\u6B65\nprivate SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-DD");\n\npublic synchronized String format(Date date) {\n    return sdf.format(date);\n}\n\n// \u4F18\u5316\u540E\uFF1A\u6BCF\u4E2A\u7EBF\u7A0B\u72EC\u7ACB\nprivate ThreadLocal<SimpleDateFormat> sdf = ThreadLocal.withInitial(\n    () -> new SimpleDateFormat("yyyy-MM-DD")\n);\n\npublic String format(Date date) {\n    return sdf.get().format(date);\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"9. \u4F7F\u7528 StampedLock\uFF08\u8BFB\u591A\u5199\u5C11\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528\u4E50\u89C2\u8BFB\nprivate final StampedLock lock = new StampedLock();\n\npublic double read() {\n    long stamp = lock.tryOptimisticRead();\n    double value = this.value;\n    \n    if (!lock.validate(stamp)) {\n        stamp = lock.readLock();\n        try {\n            value = this.value;\n        } finally {\n            lock.unlockRead(stamp);\n        }\n    }\n    \n    return value;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"10. \u9501\u7C97\u5316\uFF08\u9002\u5F53\u60C5\u51B5\u4E0B\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u597D\u7684\u505A\u6CD5\uFF1A\u9891\u7E41\u52A0\u9501\u89E3\u9501\nfor (int i = 0; i < 1000; i++) {\n    synchronized (lock) {\n        // \u64CD\u4F5C\n    }\n}\n\n// \u4F18\u5316\u540E\uFF1A\u9501\u7C97\u5316\nsynchronized (lock) {\n    for (int i = 0; i < 1000; i++) {\n        // \u64CD\u4F5C\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"40-\u4F60\u4E86\u89E3-java-\u4E2D\u7684\u8BFB\u5199\u9501\u5417-1",children:"40. \u4F60\u4E86\u89E3 Java \u4E2D\u7684\u8BFB\u5199\u9501\u5417\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u8BFB\u5199\u9501\uFF08ReadWriteLock\uFF09\u5141\u8BB8\u591A\u4E2A\u8BFB\u7EBF\u7A0B\u540C\u65F6\u8BBF\u95EE\uFF0C\u4F46\u5199\u7EBF\u7A0B\u8BBF\u95EE\u65F6\u4F1A\u963B\u585E\u6240\u6709\u8BFB\u5199\u7EBF\u7A0B\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u601D\u60F3\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8BFB-\u8BFB\uFF1A\u4E0D\u4E92\u65A5"}),"\n",(0,i.jsx)(e.li,{children:"\u8BFB-\u5199\uFF1A\u4E92\u65A5"}),"\n",(0,i.jsx)(e.li,{children:"\u5199-\u5199\uFF1A\u4E92\u65A5"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u672C\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Cache {\n    private final Map<String, Object> cache = new HashMap<>();\n    private final ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    private final Lock readLock = rwLock.readLock();\n    private final Lock writeLock = rwLock.writeLock();\n    \n    // \u8BFB\u64CD\u4F5C\n    public Object get(String key) {\n        readLock.lock();\n        try {\n            return cache.get(key);\n        } finally {\n            readLock.unlock();\n        }\n    }\n    \n    // \u5199\u64CD\u4F5C\n    public void put(String key, Object value) {\n        writeLock.lock();\n        try {\n            cache.put(key, value);\n        } finally {\n            writeLock.unlock();\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7279\u6027\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u516C\u5E73\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u975E\u516C\u5E73\u9501\uFF08\u9ED8\u8BA4\uFF09\nReadWriteLock rwLock = new ReentrantReadWriteLock();\n\n// \u516C\u5E73\u9501\nReadWriteLock fairRwLock = new ReentrantReadWriteLock(true);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u53EF\u91CD\u5165"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u540C\u4E00\u7EBF\u7A0B\u53EF\u4EE5\u591A\u6B21\u83B7\u53D6\u8BFB\u9501\u6216\u5199\u9501\nreadLock.lock();\nreadLock.lock(); // \u53EF\u91CD\u5165\ntry {\n    // ...\n} finally {\n    readLock.unlock();\n    readLock.unlock();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u9501\u964D\u7EA7"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u652F\u6301\u5199\u9501\u964D\u7EA7\u4E3A\u8BFB\u9501\nwriteLock.lock();\ntry {\n    // \u5199\u64CD\u4F5C\n    \n    readLock.lock(); // \u83B7\u53D6\u8BFB\u9501\n} finally {\n    writeLock.unlock(); // \u91CA\u653E\u5199\u9501\uFF0C\u964D\u7EA7\u4E3A\u8BFB\u9501\n}\n\ntry {\n    // \u8BFB\u64CD\u4F5C\n} finally {\n    readLock.unlock();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4E0D\u652F\u6301\u9501\u5347\u7EA7"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4E0D\u652F\u6301\u8BFB\u9501\u5347\u7EA7\u4E3A\u5199\u9501\nreadLock.lock();\ntry {\n    writeLock.lock(); // \u4F1A\u6B7B\u9501\uFF01\n    // ...\n} finally {\n    readLock.unlock();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7F13\u5B58\u7CFB\u7EDF"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class DataCache {\n    private Map<String, Data> cache = new HashMap<>();\n    private ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    \n    public Data getData(String key) {\n        rwLock.readLock().lock();\n        try {\n            Data data = cache.get(key);\n            if (data == null) {\n                rwLock.readLock().unlock();\n                rwLock.writeLock().lock();\n                try {\n                    // \u53CC\u91CD\u68C0\u67E5\n                    data = cache.get(key);\n                    if (data == null) {\n                        data = loadFromDatabase(key);\n                        cache.put(key, data);\n                    }\n                    rwLock.readLock().lock();\n                } finally {\n                    rwLock.writeLock().unlock();\n                }\n            }\n            return data;\n        } finally {\n            rwLock.readLock().unlock();\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u914D\u7F6E\u7BA1\u7406"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ConfigManager {\n    private Properties config = new Properties();\n    private ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    \n    public String getProperty(String key) {\n        rwLock.readLock().lock();\n        try {\n            return config.getProperty(key);\n        } finally {\n            rwLock.readLock().unlock();\n        }\n    }\n    \n    public void reload() {\n        rwLock.writeLock().lock();\n        try {\n            config = loadConfig();\n        } finally {\n            rwLock.writeLock().unlock();\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u573A\u666F"}),(0,i.jsx)(e.th,{children:"synchronized"}),(0,i.jsx)(e.th,{children:"ReadWriteLock"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8BFB\u591A\u5199\u5C11"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8BFB\u5C11\u5199\u591A"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u76F8\u5F53"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u76F8\u5F53"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EA\u8BFB"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u8F83\u4F4E"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u9AD8"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8BFB\u591A\u5199\u5C11\u573A\u666F\u4F7F\u7528\u8BFB\u5199\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u8BFB\u5199\u6BD4\u4F8B\u76F8\u5F53\u65F6\u4F7F\u7528\u666E\u901A\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u4F7F\u7528 StampedLock\uFF08\u6027\u80FD\u66F4\u597D\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"41-\u4EC0\u4E48\u662F-java-\u5185\u5B58\u6A21\u578Bjmm-1",children:"41. \u4EC0\u4E48\u662F Java \u5185\u5B58\u6A21\u578B\uFF08JMM\uFF09\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Java \u5185\u5B58\u6A21\u578B\uFF08Java Memory Model\uFF0CJMM\uFF09\u662F\u4E00\u79CD\u89C4\u8303\uFF0C\u5B9A\u4E49\u4E86 Java \u7A0B\u5E8F\u4E2D\u5404\u4E2A\u53D8\u91CF\u7684\u8BBF\u95EE\u89C4\u5219\uFF0C\u4EE5\u53CA\u5728 JVM \u4E2D\u5C06\u53D8\u91CF\u5B58\u50A8\u5230\u5185\u5B58\u548C\u4ECE\u5185\u5B58\u4E2D\u8BFB\u53D6\u53D8\u91CF\u7684\u5E95\u5C42\u7EC6\u8282\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u6982\u5FF5\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4E3B\u5185\u5B58\u4E0E\u5DE5\u4F5C\u5185\u5B58"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u7EBF\u7A0B1                \u7EBF\u7A0B2                \u7EBF\u7A0B3\n\u5DE5\u4F5C\u5185\u5B58              \u5DE5\u4F5C\u5185\u5B58              \u5DE5\u4F5C\u5185\u5B58\n  \u2193\u2191                  \u2193\u2191                  \u2193\u2191\n  \u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2190\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\u2192\n                    \u4E3B\u5185\u5B58\n            \uFF08\u5171\u4EAB\u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E\uFF09\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E3B\u5185\u5B58"}),"\uFF1A\u6240\u6709\u7EBF\u7A0B\u5171\u4EAB\uFF0C\u5B58\u50A8\u5171\u4EAB\u53D8\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5DE5\u4F5C\u5185\u5B58"}),"\uFF1A\u6BCF\u4E2A\u7EBF\u7A0B\u79C1\u6709\uFF0C\u5B58\u50A8\u4E3B\u5185\u5B58\u53D8\u91CF\u7684\u526F\u672C"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5185\u5B58\u4EA4\u4E92\u64CD\u4F5C"})}),"\n",(0,i.jsx)(e.p,{children:"8 \u79CD\u539F\u5B50\u64CD\u4F5C\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"lock\uFF08\u9501\u5B9A\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u6807\u8BC6\u53D8\u91CF\u4E3A\u7EBF\u7A0B\u72EC\u5360"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"unlock\uFF08\u89E3\u9501\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u91CA\u653E\u9501\u5B9A\u7684\u53D8\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"read\uFF08\u8BFB\u53D6\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u628A\u53D8\u91CF\u503C\u4F20\u8F93\u5230\u5DE5\u4F5C\u5185\u5B58"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"load\uFF08\u8F7D\u5165\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u628A read \u7684\u503C\u653E\u5165\u5DE5\u4F5C\u5185\u5B58\u526F\u672C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"use\uFF08\u4F7F\u7528\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u628A\u503C\u4F20\u9012\u7ED9\u6267\u884C\u5F15\u64CE"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"assign\uFF08\u8D4B\u503C\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u628A\u6267\u884C\u5F15\u64CE\u7684\u503C\u8D4B\u7ED9\u5DE5\u4F5C\u5185\u5B58\u53D8\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"store\uFF08\u5B58\u50A8\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u628A\u503C\u4F20\u9001\u5230\u4E3B\u5185\u5B58"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"write\uFF08\u5199\u5165\uFF09"}),"\uFF1A\u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u628A store \u7684\u503C\u5199\u5165\u4E3B\u5185\u5B58\u53D8\u91CF"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. JMM \u4E09\u5927\u7279\u6027"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u5B50\u6027\uFF08Atomicity\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u539F\u5B50\u64CD\u4F5C\nint a = 10;        // \u539F\u5B50\na = b;             // \u975E\u539F\u5B50\uFF08\u8BFBb + \u5199a\uFF09\na++;               // \u975E\u539F\u5B50\uFF08\u8BFBa + \u52A01 + \u5199a\uFF09\na = a + 1;         // \u975E\u539F\u5B50\n\n// \u4FDD\u8BC1\u539F\u5B50\u6027\nsynchronized (lock) {\n    a++;\n}\n\nAtomicInteger count = new AtomicInteger(0);\ncount.incrementAndGet();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u53EF\u89C1\u6027\uFF08Visibility\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u95EE\u9898\uFF1A\u7EBF\u7A0B2\u53EF\u80FD\u770B\u4E0D\u5230\u7EBF\u7A0B1\u7684\u4FEE\u6539\nprivate boolean flag = false;\n\n// \u7EBF\u7A0B1\nflag = true;\n\n// \u7EBF\u7A0B2\nwhile (!flag) {\n    // \u53EF\u80FD\u4E00\u76F4\u5FAA\u73AF\n}\n\n// \u89E3\u51B3\u65B9\u68481\uFF1Avolatile\nprivate volatile boolean flag = false;\n\n// \u89E3\u51B3\u65B9\u68482\uFF1Asynchronized\nsynchronized (lock) {\n    flag = true;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6709\u5E8F\u6027\uFF08Ordering\uFF09\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u53EF\u80FD\u53D1\u751F\u6307\u4EE4\u91CD\u6392\nint a = 0;\nboolean flag = false;\n\n// \u7EBF\u7A0B1\na = 1;           // \u64CD\u4F5C1\nflag = true;     // \u64CD\u4F5C2\uFF08\u53EF\u80FD\u91CD\u6392\u5230\u64CD\u4F5C1\u4E4B\u524D\uFF09\n\n// \u7EBF\u7A0B2\nif (flag) {\n    int b = a;   // \u53EF\u80FD b = 0\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1Avolatile \u7981\u6B62\u91CD\u6392\nprivate volatile boolean flag = false;\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. happens-before \u89C4\u5219"})}),"\n",(0,i.jsx)(e.p,{children:"\u5982\u679C\u64CD\u4F5C A happens-before \u64CD\u4F5C B\uFF0C\u5219 A \u7684\u7ED3\u679C\u5BF9 B \u53EF\u89C1\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89C4\u5219\u5217\u8868\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219"}),"\uFF1A\u5355\u7EBF\u7A0B\u5185\uFF0C\u524D\u9762\u7684\u64CD\u4F5C happens-before \u540E\u9762\u7684\u64CD\u4F5C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u89C4\u5219"}),"\uFF1Aunlock happens-before \u540E\u7EED\u5BF9\u540C\u4E00\u4E2A\u9501\u7684 lock"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"volatile \u89C4\u5219"}),"\uFF1Avolatile \u5199 happens-before \u540E\u7EED\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4F20\u9012\u6027"}),"\uFF1AA happens-before B\uFF0CB happens-before C\uFF0C\u5219 A happens-before C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u542F\u52A8\u89C4\u5219"}),"\uFF1AThread.start() happens-before \u7EBF\u7A0B\u5185\u7684\u6240\u6709\u64CD\u4F5C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u7EC8\u6B62\u89C4\u5219"}),"\uFF1A\u7EBF\u7A0B\u5185\u6240\u6709\u64CD\u4F5C happens-before Thread.join() \u8FD4\u56DE"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E2D\u65AD\u89C4\u5219"}),"\uFF1Ainterrupt() happens-before \u68C0\u6D4B\u5230\u4E2D\u65AD\u4E8B\u4EF6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5BF9\u8C61\u7EC8\u7ED3\u89C4\u5219"}),"\uFF1A\u6784\u9020\u51FD\u6570\u7ED3\u675F happens-before finalize() \u65B9\u6CD5"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\nint a = 1;  // \u64CD\u4F5C1\nint b = 2;  // \u64CD\u4F5C2 happens-before \u64CD\u4F5C1\n\n// \u9501\u89C4\u5219\nsynchronized (lock) {\n    a = 1;  // \u64CD\u4F5C1\n}\n// unlock happens-before \u4E0B\u4E00\u4E2A lock\n\nsynchronized (lock) {\n    int b = a;  // \u80FD\u770B\u5230 a = 1\n}\n\n// volatile \u89C4\u5219\nvolatile boolean flag = false;\nint a = 0;\n\n// \u7EBF\u7A0B1\na = 1;\nflag = true;  // volatile \u5199\n\n// \u7EBF\u7A0B2\nif (flag) {  // volatile \u8BFB\n    int b = a;  // \u4E00\u5B9A\u80FD\u770B\u5230 a = 1\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u5185\u5B58\u5C4F\u969C"})}),"\n",(0,i.jsx)(e.p,{children:"JMM \u901A\u8FC7\u5185\u5B58\u5C4F\u969C\uFF08Memory Barrier\uFF09\u5B9E\u73B0\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"LoadLoad \u5C4F\u969C"}),"\uFF1ALoad1; LoadLoad; Load2\uFF08\u786E\u4FDD Load1 \u5148\u4E8E Load2\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"StoreStore \u5C4F\u969C"}),"\uFF1AStore1; StoreStore; Store2\uFF08\u786E\u4FDD Store1 \u5148\u4E8E Store2\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"LoadStore \u5C4F\u969C"}),"\uFF1ALoad1; LoadStore; Store2\uFF08\u786E\u4FDD Load1 \u5148\u4E8E Store2\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"StoreLoad \u5C4F\u969C"}),"\uFF1AStore1; StoreLoad; Load2\uFF08\u786E\u4FDD Store1 \u5148\u4E8E Load2\uFF09"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"volatile \u7684\u5185\u5B58\u5C4F\u969C\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile \u5199\nStoreStore \u5C4F\u969C\nvolatile \u5199\u64CD\u4F5C\nStoreLoad \u5C4F\u969C\n\n// volatile \u8BFB\nvolatile \u8BFB\u64CD\u4F5C\nLoadLoad \u5C4F\u969C\nLoadStore \u5C4F\u969C\n"})}),"\n",(0,i.jsx)(e.h3,{id:"42-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u539F\u5B50\u6027\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027-1",children:"42. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u8FD9\u662F\u5E76\u53D1\u7F16\u7A0B\u7684\u4E09\u5927\u7279\u6027\uFF0CJMM \u7684\u6838\u5FC3\u5185\u5BB9\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u539F\u5B50\u6027\uFF08Atomicity\uFF09"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B9A\u4E49\uFF1A"})," \u4E00\u4E2A\u64CD\u4F5C\u6216\u591A\u4E2A\u64CD\u4F5C\u8981\u4E48\u5168\u90E8\u6267\u884C\u6210\u529F\uFF0C\u8981\u4E48\u5168\u90E8\u4E0D\u6267\u884C\uFF0C\u4E2D\u95F4\u4E0D\u4F1A\u88AB\u6253\u65AD\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u5B50\u64CD\u4F5C\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u539F\u5B50\u64CD\u4F5C\nint a = 10;              // \u8D4B\u503C\u64CD\u4F5C\nint b = a;               // \u975E\u539F\u5B50\uFF08\u8BFBa + \u5199b\uFF09\na++;                     // \u975E\u539F\u5B50\uFF08\u8BFBa + \u52A01 + \u5199a\uFF09\nlong c = 0L;             // \u975E\u539F\u5B50\uFF0864\u4F4D\uFF0C\u5206\u4E24\u6B21\u5199\u5165\uFF09\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FDD\u8BC1\u539F\u5B50\u6027\u7684\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. synchronized\nprivate int count = 0;\n\npublic synchronized void increment() {\n    count++;  // \u4FDD\u8BC1\u539F\u5B50\u6027\n}\n\n// 2. Lock\nprivate final Lock lock = new ReentrantLock();\n\npublic void increment() {\n    lock.lock();\n    try {\n        count++;\n    } finally {\n        lock.unlock();\n    }\n}\n\n// 3. \u539F\u5B50\u7C7B\nprivate AtomicInteger count = new AtomicInteger(0);\n\npublic void increment() {\n    count.incrementAndGet();  // \u539F\u5B50\u64CD\u4F5C\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u53EF\u89C1\u6027\uFF08Visibility\uFF09"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B9A\u4E49\uFF1A"})," \u5F53\u4E00\u4E2A\u7EBF\u7A0B\u4FEE\u6539\u4E86\u5171\u4EAB\u53D8\u91CF\u7684\u503C\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u80FD\u591F\u7ACB\u5373\u5F97\u77E5\u8FD9\u4E2A\u4FEE\u6539\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u53EF\u89C1\u6027\u95EE\u9898\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B1\nprivate boolean flag = false;\n\npublic void writer() {\n    flag = true;  // \u5199\u5165\u5DE5\u4F5C\u5185\u5B58\uFF0C\u53EF\u80FD\u4E0D\u4F1A\u7ACB\u5373\u5237\u65B0\u5230\u4E3B\u5185\u5B58\n}\n\n// \u7EBF\u7A0B2\npublic void reader() {\n    while (!flag) {  // \u4ECE\u5DE5\u4F5C\u5185\u5B58\u8BFB\u53D6\uFF0C\u53EF\u80FD\u8BFB\u5230\u65E7\u503C\n        // \u53EF\u80FD\u4E00\u76F4\u5FAA\u73AF\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FDD\u8BC1\u53EF\u89C1\u6027\u7684\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. volatile\nprivate volatile boolean flag = false;\n\n// 2. synchronized\nprivate boolean flag = false;\n\npublic synchronized void writer() {\n    flag = true;  // \u89E3\u9501\u65F6\u5237\u65B0\u5230\u4E3B\u5185\u5B58\n}\n\npublic synchronized void reader() {\n    if (flag) {  // \u52A0\u9501\u65F6\u4ECE\u4E3B\u5185\u5B58\u8BFB\u53D6\n        // ...\n    }\n}\n\n// 3. final\nprivate final int value = 10;  // final \u53D8\u91CF\u4FDD\u8BC1\u53EF\u89C1\u6027\n\n// 4. Lock\nprivate final Lock lock = new ReentrantLock();\n\npublic void writer() {\n    lock.lock();\n    try {\n        flag = true;\n    } finally {\n        lock.unlock();  // \u89E3\u9501\u65F6\u5237\u65B0\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6709\u5E8F\u6027\uFF08Ordering\uFF09"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B9A\u4E49\uFF1A"})," \u7A0B\u5E8F\u6267\u884C\u7684\u987A\u5E8F\u6309\u7167\u4EE3\u7801\u7684\u5148\u540E\u987A\u5E8F\u6267\u884C\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6307\u4EE4\u91CD\u6392\u95EE\u9898\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5355\u4F8B\u6A21\u5F0F\u7684\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\npublic class Singleton {\n    private static Singleton instance;\n    \n    public static Singleton getInstance() {\n        if (instance == null) {  // \u7B2C\u4E00\u6B21\u68C0\u67E5\n            synchronized (Singleton.class) {\n                if (instance == null) {  // \u7B2C\u4E8C\u6B21\u68C0\u67E5\n                    instance = new Singleton();  // \u53EF\u80FD\u53D1\u751F\u6307\u4EE4\u91CD\u6392\n                    // 1. \u5206\u914D\u5185\u5B58\n                    // 2. \u521D\u59CB\u5316\u5BF9\u8C61\n                    // 3. \u5C06 instance \u6307\u5411\u5185\u5B58\n                    // \u53EF\u80FD\u91CD\u6392\u4E3A\uFF1A1 -> 3 -> 2\n                }\n            }\n        }\n        return instance;\n    }\n}\n\n// \u95EE\u9898\uFF1A\u7EBF\u7A0BA\u6267\u884C\u52303\uFF0C\u7EBF\u7A0BB\u770B\u5230 instance != null\uFF0C\u4F46\u5BF9\u8C61\u672A\u521D\u59CB\u5316\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4FDD\u8BC1\u6709\u5E8F\u6027\u7684\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. volatile\uFF08\u7981\u6B62\u6307\u4EE4\u91CD\u6392\uFF09\nprivate static volatile Singleton instance;\n\n// 2. synchronized\uFF08happens-before \u89C4\u5219\uFF09\nsynchronized (lock) {\n    a = 1;\n    b = 2;  // \u4E0D\u4F1A\u91CD\u6392\u5230 synchronized \u5757\u5916\n}\n\n// 3. happens-before \u89C4\u5219\n// \u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\u3001\u9501\u89C4\u5219\u3001volatile \u89C4\u5219\u7B49\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E09\u8005\u5173\u7CFB\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"volatile"}),(0,i.jsx)(e.th,{children:"synchronized"}),(0,i.jsx)(e.th,{children:"Lock"}),(0,i.jsx)(e.th,{children:"Atomic"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u539F\u5B50\u6027"}),(0,i.jsx)(e.td,{children:"\u2717"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u89C1\u6027"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6709\u5E8F\u6027"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"}),(0,i.jsx)(e.td,{children:"\u2713"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u5E94\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Counter {\n    // \u53EF\u89C1\u6027\uFF1Avolatile\n    private volatile boolean running = true;\n    \n    // \u539F\u5B50\u6027\uFF1AAtomicInteger\n    private AtomicInteger count = new AtomicInteger(0);\n    \n    // \u6709\u5E8F\u6027 + \u539F\u5B50\u6027\uFF1Asynchronized\n    private int value = 0;\n    \n    public synchronized void updateValue() {\n        value++;  // \u4FDD\u8BC1\u539F\u5B50\u6027\u548C\u6709\u5E8F\u6027\n    }\n    \n    public void stop() {\n        running = false;  // \u4FDD\u8BC1\u53EF\u89C1\u6027\n    }\n    \n    public void increment() {\n        count.incrementAndGet();  // \u4FDD\u8BC1\u539F\u5B50\u6027\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"43-\u4EC0\u4E48\u662F-java-\u7684-happens-before-\u89C4\u5219-1",children:"43. \u4EC0\u4E48\u662F Java \u7684 happens-before \u89C4\u5219\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"happens-before \u662F JMM \u4E2D\u5B9A\u4E49\u7684\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u7684\u504F\u5E8F\u5173\u7CFB\uFF0C\u7528\u4E8E\u4FDD\u8BC1\u5185\u5B58\u53EF\u89C1\u6027\u3002"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5B9A\u4E49\uFF1A"}),"\n\u5982\u679C\u64CD\u4F5C A happens-before \u64CD\u4F5C B\uFF0C\u90A3\u4E48 A \u7684\u6267\u884C\u7ED3\u679C\u5BF9 B \u53EF\u89C1\uFF0C\u4E14 A \u7684\u6267\u884C\u987A\u5E8F\u5728 B \u4E4B\u524D\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"8 \u5927 happens-before \u89C4\u5219\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF08Program Order Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5355\u7EBF\u7A0B\u5185\uFF0C\u524D\u9762\u7684\u64CD\u4F5C happens-before \u540E\u9762\u7684\u64CD\u4F5C\nint a = 1;  // \u64CD\u4F5C1\nint b = 2;  // \u64CD\u4F5C2 happens-before \u64CD\u4F5C1\nint c = a + b;  // \u80FD\u770B\u5230 a=1, b=2\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u9501\u89C4\u5219\uFF08Monitor Lock Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5BF9\u4E00\u4E2A\u9501\u7684\u89E3\u9501 happens-before \u540E\u7EED\u5BF9\u8FD9\u4E2A\u9501\u7684\u52A0\u9501\nsynchronized (lock) {\n    a = 1;  // \u64CD\u4F5C1\n}  // unlock\n\n// \u53E6\u4E00\u4E2A\u7EBF\u7A0B\nsynchronized (lock) {  // lock\n    int b = a;  // \u64CD\u4F5C2\uFF0C\u80FD\u770B\u5230 a=1\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. volatile \u53D8\u91CF\u89C4\u5219\uFF08Volatile Variable Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile \u5199 happens-before \u540E\u7EED\u5BF9\u8BE5\u53D8\u91CF\u7684\u8BFB\nvolatile boolean flag = false;\nint a = 0;\n\n// \u7EBF\u7A0B1\na = 1;  // \u64CD\u4F5C1\nflag = true;  // volatile \u5199\uFF0C\u64CD\u4F5C2\n\n// \u7EBF\u7A0B2\nif (flag) {  // volatile \u8BFB\uFF0C\u64CD\u4F5C3\n    int b = a;  // \u64CD\u4F5C4\uFF0C\u80FD\u770B\u5230 a=1\n}\n// \u64CD\u4F5C2 happens-before \u64CD\u4F5C3\n// \u64CD\u4F5C1 happens-before \u64CD\u4F5C2\uFF08\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF09\n// \u64CD\u4F5C3 happens-before \u64CD\u4F5C4\uFF08\u7A0B\u5E8F\u987A\u5E8F\u89C4\u5219\uFF09\n// \u56E0\u6B64\u64CD\u4F5C1 happens-before \u64CD\u4F5C4\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F20\u9012\u6027\u89C4\u5219\uFF08Transitivity\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// A happens-before B\uFF0CB happens-before C\n// \u5219 A happens-before C\nint a = 1;  // \u64CD\u4F5CA\nint b = a;  // \u64CD\u4F5CB\nint c = b;  // \u64CD\u4F5CC\n// A happens-before B happens-before C\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u7EBF\u7A0B\u542F\u52A8\u89C4\u5219\uFF08Thread Start Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Thread.start() happens-before \u7EBF\u7A0B\u5185\u7684\u6240\u6709\u64CD\u4F5C\nint a = 1;  // \u64CD\u4F5C1\n\nThread thread = new Thread(() -> {\n    int b = a;  // \u64CD\u4F5C2\uFF0C\u80FD\u770B\u5230 a=1\n});\n\nthread.start();  // happens-before \u64CD\u4F5C2\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u7EBF\u7A0B\u7EC8\u6B62\u89C4\u5219\uFF08Thread Termination Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B\u5185\u6240\u6709\u64CD\u4F5C happens-before Thread.join() \u8FD4\u56DE\nThread thread = new Thread(() -> {\n    a = 1;  // \u64CD\u4F5C1\n});\n\nthread.start();\nthread.join();  // \u7B49\u5F85\u7EBF\u7A0B\u7ED3\u675F\n\nint b = a;  // \u64CD\u4F5C2\uFF0C\u80FD\u770B\u5230 a=1\n// \u64CD\u4F5C1 happens-before join() \u8FD4\u56DE\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. \u7EBF\u7A0B\u4E2D\u65AD\u89C4\u5219\uFF08Thread Interruption Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// interrupt() happens-before \u68C0\u6D4B\u5230\u4E2D\u65AD\u4E8B\u4EF6\nThread thread = new Thread(() -> {\n    while (!Thread.interrupted()) {  // \u64CD\u4F5C2\n        // \u80FD\u68C0\u6D4B\u5230\u4E2D\u65AD\n    }\n});\n\nthread.start();\nthread.interrupt();  // \u64CD\u4F5C1 happens-before \u64CD\u4F5C2\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"8. \u5BF9\u8C61\u7EC8\u7ED3\u89C4\u5219\uFF08Finalizer Rule\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5BF9\u8C61\u7684\u6784\u9020\u51FD\u6570\u7ED3\u675F happens-before finalize() \u65B9\u6CD5\npublic class MyObject {\n    private int value;\n    \n    public MyObject() {\n        value = 10;  // \u64CD\u4F5C1\n    }  // \u6784\u9020\u51FD\u6570\u7ED3\u675F\n    \n    @Override\n    protected void finalize() {\n        int a = value;  // \u64CD\u4F5C2\uFF0C\u80FD\u770B\u5230 value=10\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u5E94\u7528\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\uFF08DCL\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Singleton {\n    private static volatile Singleton instance;\n    \n    public static Singleton getInstance() {\n        if (instance == null) {\n            synchronized (Singleton.class) {\n                if (instance == null) {\n                    instance = new Singleton();\n                    // volatile \u5199 happens-before \u540E\u7EED\u8BFB\n                }\n            }\n        }\n        return instance;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u751F\u4EA7\u8005-\u6D88\u8D39\u8005"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ProducerConsumer {\n    private volatile boolean ready = false;\n    private int data;\n    \n    // \u751F\u4EA7\u8005\n    public void produce() {\n        data = 42;  // \u64CD\u4F5C1\n        ready = true;  // volatile \u5199\uFF0C\u64CD\u4F5C2\n    }\n    \n    // \u6D88\u8D39\u8005\n    public void consume() {\n        if (ready) {  // volatile \u8BFB\uFF0C\u64CD\u4F5C3\n            int value = data;  // \u64CD\u4F5C4\uFF0C\u80FD\u770B\u5230 data=42\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u7EBF\u7A0B\u5B89\u5168\u7684\u5EF6\u8FDF\u521D\u59CB\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class LazyInit {\n    private volatile Helper helper;\n    \n    public Helper getHelper() {\n        Helper h = helper;\n        if (h == null) {\n            synchronized (this) {\n                h = helper;\n                if (h == null) {\n                    h = new Helper();\n                    helper = h;  // volatile \u5199\n                }\n            }\n        }\n        return h;  // volatile \u8BFB\uFF0C\u80FD\u770B\u5230\u5B8C\u6574\u521D\u59CB\u5316\u7684\u5BF9\u8C61\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"happens-before \u4FDD\u8BC1\u5185\u5B58\u53EF\u89C1\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u9700\u8981\u663E\u5F0F\u540C\u6B65\u4E5F\u80FD\u4FDD\u8BC1\u53EF\u89C1\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u662F JMM \u7684\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,i.jsx)(e.li,{children:"\u7406\u89E3 happens-before \u6709\u52A9\u4E8E\u7F16\u5199\u6B63\u786E\u7684\u5E76\u53D1\u4EE3\u7801"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"44-\u4EC0\u4E48\u662F-java-\u4E2D\u7684\u6307\u4EE4\u91CD\u6392-1",children:"44. \u4EC0\u4E48\u662F Java \u4E2D\u7684\u6307\u4EE4\u91CD\u6392\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u6307\u4EE4\u91CD\u6392\u662F\u6307\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E3A\u4E86\u4F18\u5316\u7A0B\u5E8F\u6027\u80FD\u800C\u5BF9\u6307\u4EE4\u5E8F\u5217\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F\u7684\u4E00\u79CD\u624B\u6BB5\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E09\u79CD\u91CD\u6392\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7F16\u8BD1\u5668\u4F18\u5316\u91CD\u6392"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u539F\u59CB\u4EE3\u7801\nint a = 1;\nint b = 2;\nint c = a + b;\n\n// \u7F16\u8BD1\u5668\u53EF\u80FD\u91CD\u6392\u4E3A\nint b = 2;\nint a = 1;\nint c = a + b;\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u6307\u4EE4\u7EA7\u5E76\u884C\u91CD\u6392"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// CPU \u53EF\u80FD\u5E76\u884C\u6267\u884C\u4E0D\u76F8\u5173\u7684\u6307\u4EE4\nint a = 1;  // \u6307\u4EE41\nint b = 2;  // \u6307\u4EE42\uFF08\u53EF\u80FD\u4E0E\u6307\u4EE41\u5E76\u884C\uFF09\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u5185\u5B58\u7CFB\u7EDF\u91CD\u6392"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5199\u7F13\u51B2\u533A\u53EF\u80FD\u5BFC\u81F4\u5199\u64CD\u4F5C\u91CD\u6392\na = 1;  // \u5199\u5165\u7F13\u51B2\u533A\nb = 2;  // \u53EF\u80FD\u5148\u5237\u65B0\u5230\u5185\u5B58\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u6392\u7684\u539F\u5219\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"as-if-serial \u8BED\u4E49\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5355\u7EBF\u7A0B\u5185\uFF0C\u91CD\u6392\u540E\u7684\u6267\u884C\u7ED3\u679C\u4E0E\u987A\u5E8F\u6267\u884C\u7684\u7ED3\u679C\u4E00\u81F4"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u4F1A\u5BF9\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u7684\u64CD\u4F5C\u8FDB\u884C\u91CD\u6392"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u6709\u6570\u636E\u4F9D\u8D56\uFF0C\u4E0D\u4F1A\u91CD\u6392\nint a = 1;\nint b = a + 1;  // \u4F9D\u8D56 a\uFF0C\u4E0D\u4F1A\u91CD\u6392\u5230 a=1 \u4E4B\u524D\n\n// \u65E0\u6570\u636E\u4F9D\u8D56\uFF0C\u53EF\u80FD\u91CD\u6392\nint a = 1;\nint b = 2;  // \u53EF\u80FD\u91CD\u6392\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u91CD\u6392\u5BFC\u81F4\u7684\u95EE\u9898\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\u95EE\u9898"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Singleton {\n    private static Singleton instance;\n    \n    public static Singleton getInstance() {\n        if (instance == null) {\n            synchronized (Singleton.class) {\n                if (instance == null) {\n                    instance = new Singleton();\n                    // \u6B63\u5E38\u987A\u5E8F\uFF1A\n                    // 1. \u5206\u914D\u5185\u5B58\n                    // 2. \u521D\u59CB\u5316\u5BF9\u8C61\n                    // 3. instance \u6307\u5411\u5185\u5B58\n                    \n                    // \u91CD\u6392\u540E\u53EF\u80FD\uFF1A\n                    // 1. \u5206\u914D\u5185\u5B58\n                    // 3. instance \u6307\u5411\u5185\u5B58\n                    // 2. \u521D\u59CB\u5316\u5BF9\u8C61\n                }\n            }\n        }\n        return instance;  // \u53EF\u80FD\u8FD4\u56DE\u672A\u521D\u59CB\u5316\u7684\u5BF9\u8C61\n    }\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1Avolatile\nprivate static volatile Singleton instance;\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u53EF\u89C1\u6027\u95EE\u9898"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EBF\u7A0B1\nint a = 0;\nboolean flag = false;\n\npublic void writer() {\n    a = 1;  // \u64CD\u4F5C1\n    flag = true;  // \u64CD\u4F5C2\uFF08\u53EF\u80FD\u91CD\u6392\u5230\u64CD\u4F5C1\u4E4B\u524D\uFF09\n}\n\n// \u7EBF\u7A0B2\npublic void reader() {\n    if (flag) {  // \u53EF\u80FD\u770B\u5230 flag=true\n        int b = a;  // \u4F46 a \u53EF\u80FD\u8FD8\u662F 0\n    }\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1Avolatile\nprivate volatile boolean flag = false;\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u521D\u59CB\u5316\u5B89\u5168\u95EE\u9898"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class UnsafeInit {\n    private int value;\n    private boolean initialized;\n    \n    public UnsafeInit() {\n        value = 10;  // \u64CD\u4F5C1\n        initialized = true;  // \u64CD\u4F5C2\uFF08\u53EF\u80FD\u91CD\u6392\u5230\u64CD\u4F5C1\u4E4B\u524D\uFF09\n    }\n    \n    public int getValue() {\n        if (initialized) {  // \u53EF\u80FD\u770B\u5230 initialized=true\n            return value;  // \u4F46 value \u53EF\u80FD\u8FD8\u662F 0\n        }\n        return -1;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7981\u6B62\u91CD\u6392\u7684\u65B9\u5F0F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. volatile"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile \u5199\u4E4B\u524D\u7684\u64CD\u4F5C\u4E0D\u4F1A\u91CD\u6392\u5230 volatile \u5199\u4E4B\u540E\n// volatile \u8BFB\u4E4B\u540E\u7684\u64CD\u4F5C\u4E0D\u4F1A\u91CD\u6392\u5230 volatile \u8BFB\u4E4B\u524D\nprivate volatile boolean flag = false;\n\npublic void writer() {\n    a = 1;  // \u4E0D\u4F1A\u91CD\u6392\u5230 flag=true \u4E4B\u540E\n    flag = true;  // volatile \u5199\n}\n\npublic void reader() {\n    if (flag) {  // volatile \u8BFB\n        int b = a;  // \u4E0D\u4F1A\u91CD\u6392\u5230 flag \u8BFB\u4E4B\u524D\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. synchronized"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// synchronized \u5757\u5185\u7684\u64CD\u4F5C\u4E0D\u4F1A\u91CD\u6392\u5230\u5757\u5916\nsynchronized (lock) {\n    a = 1;\n    b = 2;  // \u4E0D\u4F1A\u91CD\u6392\u5230 synchronized \u5757\u5916\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. final"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// final \u5B57\u6BB5\u7684\u521D\u59CB\u5316\u4E0D\u4F1A\u91CD\u6392\u5230\u6784\u9020\u51FD\u6570\u4E4B\u5916\npublic class FinalExample {\n    private final int value;\n    \n    public FinalExample() {\n        value = 10;  // \u4E0D\u4F1A\u91CD\u6392\u5230\u6784\u9020\u51FD\u6570\u4E4B\u5916\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. happens-before \u89C4\u5219"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9075\u5FAA happens-before \u89C4\u5219\u7684\u64CD\u4F5C\u4E0D\u4F1A\u91CD\u6392\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u5C4F\u969C\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"JVM \u901A\u8FC7\u63D2\u5165\u5185\u5B58\u5C4F\u969C\u6307\u4EE4\u6765\u7981\u6B62\u91CD\u6392\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// volatile \u5199\nStoreStore \u5C4F\u969C  // \u7981\u6B62\u524D\u9762\u7684\u5199\u4E0E volatile \u5199\u91CD\u6392\nvolatile \u5199\nStoreLoad \u5C4F\u969C   // \u7981\u6B62 volatile \u5199\u4E0E\u540E\u9762\u7684\u8BFB/\u5199\u91CD\u6392\n\n// volatile \u8BFB\nvolatile \u8BFB\nLoadLoad \u5C4F\u969C    // \u7981\u6B62 volatile \u8BFB\u4E0E\u540E\u9762\u7684\u8BFB\u91CD\u6392\nLoadStore \u5C4F\u969C   // \u7981\u6B62 volatile \u8BFB\u4E0E\u540E\u9762\u7684\u5199\u91CD\u6392\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 volatile \u4FDD\u8BC1\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528 synchronized \u6216 Lock \u4FDD\u8BC1\u539F\u5B50\u6027\u548C\u6709\u5E8F\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u7406\u89E3 happens-before \u89C4\u5219"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u4F9D\u8D56\u6307\u4EE4\u6267\u884C\u987A\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u4E0D\u53EF\u53D8\u5BF9\u8C61"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"45-java-\u4E2D\u7684-final-\u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027-1",children:"45. Java \u4E2D\u7684 final \u5173\u952E\u5B57\u662F\u5426\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"\u662F\u7684\uFF0Cfinal \u5173\u952E\u5B57\u80FD\u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027\uFF0C\u4F46\u6709\u7279\u5B9A\u7684\u6761\u4EF6\u548C\u9650\u5236\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"final \u7684\u53EF\u89C1\u6027\u4FDD\u8BC1\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. final \u5B57\u6BB5\u7684\u521D\u59CB\u5316\u5B89\u5168"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class FinalExample {\n    private final int value;\n    private final String name;\n    \n    public FinalExample() {\n        value = 10;\n        name = "test";\n        // \u6784\u9020\u51FD\u6570\u7ED3\u675F\u65F6\uFF0Cfinal \u5B57\u6BB5\u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1\n    }\n}\n\n// \u7EBF\u7A0B1\nFinalExample obj = new FinalExample();\n\n// \u7EBF\u7A0B2\nint v = obj.value;  // \u4E00\u5B9A\u80FD\u770B\u5230 value=10\nString n = obj.name;  // \u4E00\u5B9A\u80FD\u770B\u5230 name="test"\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. final \u7684 happens-before \u89C4\u5219"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5BF9\u8C61\u7684\u6784\u9020\u51FD\u6570\u4E2D\u5BF9 final \u5B57\u6BB5\u7684\u5199\u5165\n// happens-before\n// \u5728\u6784\u9020\u51FD\u6570\u5916\u5BF9\u8BE5\u5BF9\u8C61\u7684 final \u5B57\u6BB5\u7684\u8BFB\u53D6\n\npublic class SafePublication {\n    private final int value;\n    \n    public SafePublication() {\n        value = 42;  // final \u5199\n    }  // \u6784\u9020\u51FD\u6570\u7ED3\u675F\n    \n    public int getValue() {\n        return value;  // final \u8BFB\uFF0C\u4E00\u5B9A\u80FD\u770B\u5230 42\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. final \u5F15\u7528\u5BF9\u8C61\u7684\u53EF\u89C1\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class FinalReference {\n    private final int[] array;\n    \n    public FinalReference() {\n        array = new int[10];\n        array[0] = 1;  // \u5BF9 final \u5F15\u7528\u5BF9\u8C61\u7684\u4FEE\u6539\u4E5F\u53EF\u89C1\n    }\n    \n    public int getFirst() {\n        return array[0];  // \u4E00\u5B9A\u80FD\u770B\u5230 array[0]=1\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"final \u7684\u9650\u5236\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4E0D\u4FDD\u8BC1\u975E final \u5B57\u6BB5\u7684\u53EF\u89C1\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class MixedFields {\n    private final int finalValue;\n    private int normalValue;\n    \n    public MixedFields() {\n        finalValue = 10;  // \u4FDD\u8BC1\u53EF\u89C1\n        normalValue = 20;  // \u4E0D\u4FDD\u8BC1\u53EF\u89C1\n    }\n}\n\n// \u5176\u4ED6\u7EBF\u7A0B\u53EF\u80FD\u770B\u5230 finalValue=10\uFF0C\u4F46 normalValue=0\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u4E0D\u4FDD\u8BC1 final \u5B57\u6BB5\u4FEE\u6539\u540E\u7684\u53EF\u89C1\u6027"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class MutableFinal {\n    private final List<String> list = new ArrayList<>();\n    \n    public void add(String item) {\n        list.add(item);  // \u4FEE\u6539 final \u5F15\u7528\u7684\u5BF9\u8C61\uFF0C\u4E0D\u4FDD\u8BC1\u53EF\u89C1\u6027\n    }\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u4F7F\u7528 volatile \u6216\u540C\u6B65\nprivate final List<String> list = new CopyOnWriteArrayList<>();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6784\u9020\u51FD\u6570\u4E2D\u7684 this \u9003\u9038"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9519\u8BEF\u793A\u4F8B\uFF1Athis \u9003\u9038\npublic class ThisEscape {\n    private final int value;\n    \n    public ThisEscape() {\n        // \u5728\u6784\u9020\u51FD\u6570\u4E2D\u5C06 this \u4F20\u9012\u51FA\u53BB\n        EventListener listener = new EventListener() {\n            public void onEvent(Event e) {\n                doSomething(e);\n            }\n        };\n        \n        source.registerListener(listener);  // this \u9003\u9038\n        \n        value = 42;  // final \u5B57\u6BB5\u7684\u53EF\u89C1\u6027\u4FDD\u8BC1\u5931\u6548\n    }\n}\n\n// \u6B63\u786E\u505A\u6CD5\uFF1A\u6784\u9020\u51FD\u6570\u5B8C\u6210\u540E\u518D\u6CE8\u518C\npublic class SafeConstruction {\n    private final int value;\n    \n    private SafeConstruction() {\n        value = 42;\n    }\n    \n    public static SafeConstruction newInstance() {\n        SafeConstruction obj = new SafeConstruction();\n        source.registerListener(obj);  // \u6784\u9020\u5B8C\u6210\u540E\u6CE8\u518C\n        return obj;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"final \u4E0E volatile \u7684\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"final"}),(0,i.jsx)(e.th,{children:"volatile"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u89C1\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1\uFF08\u521D\u59CB\u5316\uFF09"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1\uFF08\u6240\u6709\u64CD\u4F5C\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6709\u5E8F\u6027"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1\uFF08\u521D\u59CB\u5316\uFF09"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1\uFF08\u6240\u6709\u64CD\u4F5C\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u53EF\u4FEE\u6539"}),(0,i.jsx)(e.td,{children:"\u4E0D\u53EF\u4FEE\u6539"}),(0,i.jsx)(e.td,{children:"\u53EF\u4FEE\u6539"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u65E0\u5F00\u9500"}),(0,i.jsx)(e.td,{children:"\u6709\u8F7B\u5FAE\u5F00\u9500"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u4E0D\u53EF\u53D8\u5B57\u6BB5"}),(0,i.jsx)(e.td,{children:"\u53EF\u53D8\u72B6\u6001\u6807\u5FD7"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u9645\u5E94\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4E0D\u53EF\u53D8\u5BF9\u8C61"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public final class ImmutablePoint {\n    private final int x;\n    private final int y;\n    \n    public ImmutablePoint(int x, int y) {\n        this.x = x;\n        this.y = y;\n    }\n    \n    public int getX() { return x; }\n    public int getY() { return y; }\n}\n// \u7EBF\u7A0B\u5B89\u5168\uFF0C\u65E0\u9700\u540C\u6B65\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5B89\u5168\u53D1\u5E03"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class SafePublisher {\n    private final Map<String, String> config;\n    \n    public SafePublisher() {\n        Map<String, String> temp = new HashMap<>();\n        temp.put("key1", "value1");\n        temp.put("key2", "value2");\n        config = Collections.unmodifiableMap(temp);\n        // final \u4FDD\u8BC1 config \u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u5355\u4F8B\u6A21\u5F0F"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Singleton {\n    private static final Singleton INSTANCE = new Singleton();\n    \n    private Singleton() {\n        // \u521D\u59CB\u5316\n    }\n    \n    public static Singleton getInstance() {\n        return INSTANCE;  // final \u4FDD\u8BC1\u53EF\u89C1\u6027\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5C3D\u53EF\u80FD\u4F7F\u7528 final \u4FEE\u9970\u4E0D\u53EF\u53D8\u5B57\u6BB5"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u6784\u9020\u51FD\u6570\u4E2D\u7684 this \u9003\u9038"}),"\n",(0,i.jsx)(e.li,{children:"final \u5F15\u7528\u7684\u53EF\u53D8\u5BF9\u8C61\u4ECD\u9700\u540C\u6B65"}),"\n",(0,i.jsx)(e.li,{children:"\u7ED3\u5408\u4E0D\u53EF\u53D8\u6A21\u5F0F\u4F7F\u7528"}),"\n",(0,i.jsx)(e.li,{children:"\u7406\u89E3 final \u7684\u53EF\u89C1\u6027\u4FDD\u8BC1\u8303\u56F4"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"46-\u4E3A\u4EC0\u4E48\u5728-java-\u4E2D\u9700\u8981\u4F7F\u7528-threadlocal-1",children:"46. \u4E3A\u4EC0\u4E48\u5728 Java \u4E2D\u9700\u8981\u4F7F\u7528 ThreadLocal\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"ThreadLocal \u63D0\u4F9B\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u81EA\u5DF1\u72EC\u7ACB\u7684\u53D8\u91CF\u526F\u672C\uFF0C\u4E92\u4E0D\u5E72\u6270\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7EBF\u7A0B\u5B89\u5168\u7684\u65E5\u671F\u683C\u5F0F\u5316"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u95EE\u9898\uFF1ASimpleDateFormat \u4E0D\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\nprivate static final SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");\n\npublic String format(Date date) {\n    return sdf.format(date); // \u591A\u7EBF\u7A0B\u4E0B\u4F1A\u51FA\u9519\n}\n\n// \u89E3\u51B3\u65B9\u6848\uFF1AThreadLocal\nprivate static final ThreadLocal<SimpleDateFormat> sdf = \n    ThreadLocal.withInitial(() -> new SimpleDateFormat("yyyy-MM-dd"));\n\npublic String format(Date date) {\n    return sdf.get().format(date); // \u6BCF\u4E2A\u7EBF\u7A0B\u72EC\u7ACB\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u6570\u636E\u5E93\u8FDE\u63A5\u7BA1\u7406"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ConnectionManager {\n    private static final ThreadLocal<Connection> connectionHolder = \n        new ThreadLocal<>();\n    \n    public static Connection getConnection() {\n        Connection conn = connectionHolder.get();\n        if (conn == null) {\n            conn = DriverManager.getConnection(url, user, password);\n            connectionHolder.set(conn);\n        }\n        return conn;\n    }\n    \n    public static void closeConnection() {\n        Connection conn = connectionHolder.get();\n        if (conn != null) {\n            conn.close();\n            connectionHolder.remove(); // \u6E05\u7406\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u7528\u6237\u4E0A\u4E0B\u6587\u4F20\u9012"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class UserContext {\n    private static final ThreadLocal<User> currentUser = new ThreadLocal<>();\n    \n    public static void setUser(User user) {\n        currentUser.set(user);\n    }\n    \n    public static User getUser() {\n        return currentUser.get();\n    }\n    \n    public static void clear() {\n        currentUser.remove();\n    }\n}\n\n// \u5728\u8FC7\u6EE4\u5668\u4E2D\u8BBE\u7F6E\npublic class AuthFilter implements Filter {\n    public void doFilter(ServletRequest request, ServletResponse response, \n                        FilterChain chain) {\n        User user = authenticate(request);\n        UserContext.setUser(user);\n        try {\n            chain.doFilter(request, response);\n        } finally {\n            UserContext.clear(); // \u6E05\u7406\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4E8B\u52A1\u7BA1\u7406"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class TransactionManager {\n    private static final ThreadLocal<Transaction> transactionHolder = \n        new ThreadLocal<>();\n    \n    public static void beginTransaction() {\n        Transaction tx = new Transaction();\n        transactionHolder.set(tx);\n    }\n    \n    public static Transaction getCurrentTransaction() {\n        return transactionHolder.get();\n    }\n    \n    public static void commit() {\n        Transaction tx = transactionHolder.get();\n        if (tx != null) {\n            tx.commit();\n            transactionHolder.remove();\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F18\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u5B89\u5168\uFF0C\u65E0\u9700\u540C\u6B65"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u53C2\u6570\u4F20\u9012"}),"\n",(0,i.jsx)(e.li,{children:"\u6027\u80FD\u597D\uFF0C\u65E0\u9501\u7ADE\u4E89"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7F3A\u70B9\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5185\u5B58\u6CC4\u6F0F\u98CE\u9669\uFF08\u9700\u8981\u624B\u52A8\u6E05\u7406\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u9002\u5408\u7EBF\u7A0B\u6C60\u573A\u666F\uFF08\u7EBF\u7A0B\u590D\u7528\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u589E\u52A0\u5185\u5B58\u5F00\u9500"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"47-java-\u4E2D\u7684-threadlocal-\u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684-1",children:"47. Java \u4E2D\u7684 ThreadLocal \u662F\u5982\u4F55\u5B9E\u73B0\u7EBF\u7A0B\u8D44\u6E90\u9694\u79BB\u7684\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"ThreadLocal \u901A\u8FC7\u5728\u6BCF\u4E2A\u7EBF\u7A0B\u5185\u90E8\u7EF4\u62A4\u4E00\u4E2A Map \u6765\u5B9E\u73B0\u8D44\u6E90\u9694\u79BB\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u539F\u7406\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u6570\u636E\u7ED3\u6784"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Thread \u7C7B\u4E2D\u7684\u5B57\u6BB5\npublic class Thread {\n    ThreadLocal.ThreadLocalMap threadLocals = null;\n}\n\n// ThreadLocalMap \u662F ThreadLocal \u7684\u5185\u90E8\u7C7B\nstatic class ThreadLocalMap {\n    static class Entry extends WeakReference<ThreadLocal<?>> {\n        Object value;\n        \n        Entry(ThreadLocal<?> k, Object v) {\n            super(k);\n            value = v;\n        }\n    }\n    \n    private Entry[] table; // \u54C8\u5E0C\u8868\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. set \u65B9\u6CD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void set(T value) {\n    Thread t = Thread.currentThread(); // \u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\n    ThreadLocalMap map = getMap(t);    // \u83B7\u53D6\u7EBF\u7A0B\u7684 Map\n    if (map != null)\n        map.set(this, value);          // \u4EE5 ThreadLocal \u4E3A key\n    else\n        createMap(t, value);           // \u521B\u5EFA Map\n}\n\nThreadLocalMap getMap(Thread t) {\n    return t.threadLocals;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. get \u65B9\u6CD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this);\n        if (e != null) {\n            return (T)e.value;\n        }\n    }\n    return setInitialValue(); // \u521D\u59CB\u5316\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. remove \u65B9\u6CD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public void remove() {\n    ThreadLocalMap m = getMap(Thread.currentThread());\n    if (m != null)\n        m.remove(this);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u7ED3\u6784\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"Thread-1\n  \u2514\u2500\u2500 threadLocals (ThreadLocalMap)\n        \u251C\u2500\u2500 Entry[0]: ThreadLocal1 -> Value1\n        \u251C\u2500\u2500 Entry[1]: ThreadLocal2 -> Value2\n        \u2514\u2500\u2500 Entry[2]: null\n\nThread-2\n  \u2514\u2500\u2500 threadLocals (ThreadLocalMap)\n        \u251C\u2500\u2500 Entry[0]: ThreadLocal1 -> Value3\n        \u2514\u2500\u2500 Entry[1]: ThreadLocal2 -> Value4\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u54C8\u5E0C\u51B2\u7A81\u89E3\u51B3\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528\u7EBF\u6027\u63A2\u6D4B\u6CD5\nprivate void set(ThreadLocal<?> key, Object value) {\n    Entry[] tab = table;\n    int len = tab.length;\n    int i = key.threadLocalHashCode & (len-1); // \u8BA1\u7B97\u7D22\u5F15\n    \n    for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) {\n        ThreadLocal<?> k = e.get();\n        \n        if (k == key) {\n            e.value = value; // \u66F4\u65B0\n            return;\n        }\n        \n        if (k == null) {\n            replaceStaleEntry(key, value, i); // \u66FF\u6362\u8FC7\u671F Entry\n            return;\n        }\n    }\n    \n    tab[i] = new Entry(key, value); // \u63D2\u5165\u65B0 Entry\n    int sz = ++size;\n    if (!cleanSomeSlots(i, sz) && sz >= threshold)\n        rehash(); // \u6269\u5BB9\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class ThreadLocalDemo {\n    private static ThreadLocal<Integer> threadLocal = new ThreadLocal<>();\n    \n    public static void main(String[] args) {\n        // \u7EBF\u7A0B1\n        new Thread(() -> {\n            threadLocal.set(100);\n            System.out.println("Thread-1: " + threadLocal.get()); // 100\n        }).start();\n        \n        // \u7EBF\u7A0B2\n        new Thread(() -> {\n            threadLocal.set(200);\n            System.out.println("Thread-2: " + threadLocal.get()); // 200\n        }).start();\n        \n        // \u4E3B\u7EBF\u7A0B\n        threadLocal.set(300);\n        System.out.println("Main: " + threadLocal.get()); // 300\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"48-\u4E3A\u4EC0\u4E48-java-\u4E2D\u7684-threadlocal-\u5BF9-key-\u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528-1",children:"48. \u4E3A\u4EC0\u4E48 Java \u4E2D\u7684 ThreadLocal \u5BF9 key \u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"ThreadLocal \u4F7F\u7528\u5F31\u5F15\u7528\u4F5C\u4E3A key \u662F\u4E3A\u4E86\u907F\u514D\u5185\u5B58\u6CC4\u6F0F\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5F31\u5F15\u7528\u7684\u5B9A\u4E49\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"static class Entry extends WeakReference<ThreadLocal<?>> {\n    Object value;\n    \n    Entry(ThreadLocal<?> k, Object v) {\n        super(k); // ThreadLocal \u4F5C\u4E3A\u5F31\u5F15\u7528\n        value = v; // value \u662F\u5F3A\u5F15\u7528\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5F15\u7528\u5173\u7CFB\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\u6808\u4E2D\u7684\u5F15\u7528 \u2192 ThreadLocal \u5BF9\u8C61 \u2190 \u5F31\u5F15\u7528 \u2190 Entry\n                                        \u2193\n                                      Value\uFF08\u5F3A\u5F15\u7528\uFF09\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E3A\u4EC0\u4E48\u4F7F\u7528\u5F31\u5F15\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u907F\u514D ThreadLocal \u5BF9\u8C61\u65E0\u6CD5\u56DE\u6536"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u5982\u679C\u4F7F\u7528\u5F3A\u5F15\u7528\npublic void method() {\n    ThreadLocal<String> local = new ThreadLocal<>();\n    local.set("value");\n    // method \u7ED3\u675F\u540E\uFF0Clocal \u53D8\u91CF\u88AB\u56DE\u6536\n    // \u4F46\u5982\u679C Entry \u6301\u6709 ThreadLocal \u7684\u5F3A\u5F15\u7528\n    // ThreadLocal \u5BF9\u8C61\u65E0\u6CD5\u88AB GC \u56DE\u6536\n}\n\n// \u4F7F\u7528\u5F31\u5F15\u7528\n// method \u7ED3\u675F\u540E\uFF0Clocal \u53D8\u91CF\u88AB\u56DE\u6536\n// ThreadLocal \u5BF9\u8C61\u6CA1\u6709\u5F3A\u5F15\u7528\uFF0C\u53EF\u4EE5\u88AB GC \u56DE\u6536\n// Entry \u7684 key \u53D8\u4E3A null\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u81EA\u52A8\u6E05\u7406\u673A\u5236"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// ThreadLocalMap \u5728\u64CD\u4F5C\u65F6\u4F1A\u6E05\u7406 key \u4E3A null \u7684 Entry\nprivate int expungeStaleEntry(int staleSlot) {\n    Entry[] tab = table;\n    int len = tab.length;\n    \n    // \u6E05\u7406\u5F53\u524D\u4F4D\u7F6E\n    tab[staleSlot].value = null;\n    tab[staleSlot] = null;\n    size--;\n    \n    // \u6E05\u7406\u540E\u7EED\u4F4D\u7F6E\u7684\u8FC7\u671F Entry\n    Entry e;\n    int i;\n    for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; \n         i = nextIndex(i, len)) {\n        ThreadLocal<?> k = e.get();\n        if (k == null) {\n            e.value = null;\n            tab[i] = null;\n            size--;\n        } else {\n            // rehash\n        }\n    }\n    return i;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u6CC4\u6F0F\u95EE\u9898\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95EE\u9898\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// ThreadLocal \u88AB\u56DE\u6536\uFF0Ckey \u53D8\u4E3A null\n// \u4F46 value \u4ECD\u7136\u88AB Entry \u5F3A\u5F15\u7528\n// \u5982\u679C\u7EBF\u7A0B\u957F\u671F\u5B58\u6D3B\uFF08\u5982\u7EBF\u7A0B\u6C60\uFF09\uFF0Cvalue \u65E0\u6CD5\u56DE\u6536\n\nThreadLocal<byte[]> local = new ThreadLocal<>();\nlocal.set(new byte[1024 * 1024]); // 1MB\nlocal = null; // ThreadLocal \u88AB\u56DE\u6536\n\n// Entry: key=null, value=1MB \u6570\u636E\n// value \u65E0\u6CD5\u88AB\u56DE\u6536\uFF0C\u9020\u6210\u5185\u5B58\u6CC4\u6F0F\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// 1. \u624B\u52A8\u8C03\u7528 remove()\nThreadLocal<String> local = new ThreadLocal<>();\ntry {\n    local.set("value");\n    // \u4F7F\u7528 local\n} finally {\n    local.remove(); // \u6E05\u7406\n}\n\n// 2. \u4F7F\u7528 try-with-resources\uFF08\u81EA\u5B9A\u4E49\uFF09\npublic class AutoCleanThreadLocal<T> implements AutoCloseable {\n    private ThreadLocal<T> threadLocal = new ThreadLocal<>();\n    \n    public void set(T value) {\n        threadLocal.set(value);\n    }\n    \n    public T get() {\n        return threadLocal.get();\n    }\n    \n    @Override\n    public void close() {\n        threadLocal.remove();\n    }\n}\n\n// \u4F7F\u7528\ntry (AutoCleanThreadLocal<String> local = new AutoCleanThreadLocal<>()) {\n    local.set("value");\n    // \u4F7F\u7528 local\n} // \u81EA\u52A8\u6E05\u7406\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5F15\u7528\u7C7B\u578B\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5F15\u7528\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u56DE\u6536\u65F6\u673A"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5F3A\u5F15\u7528"}),(0,i.jsx)(e.td,{children:"\u6C38\u4E0D\u56DE\u6536"}),(0,i.jsx)(e.td,{children:"\u6B63\u5E38\u5BF9\u8C61"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u8F6F\u5F15\u7528"}),(0,i.jsx)(e.td,{children:"\u5185\u5B58\u4E0D\u8DB3\u65F6"}),(0,i.jsx)(e.td,{children:"\u7F13\u5B58"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5F31\u5F15\u7528"}),(0,i.jsx)(e.td,{children:"GC \u65F6"}),(0,i.jsx)(e.td,{children:"ThreadLocal key"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u865A\u5F15\u7528"}),(0,i.jsx)(e.td,{children:"GC \u65F6"}),(0,i.jsx)(e.td,{children:"\u56DE\u6536\u901A\u77E5"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"49-java-\u4E2D\u4F7F\u7528-threadlocal-\u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48-1",children:"49. Java \u4E2D\u4F7F\u7528 ThreadLocal \u7684\u6700\u4F73\u5B9E\u8DF5\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4F7F\u7528 static final \u4FEE\u9970"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u63A8\u8350\uFF1Astatic final\nprivate static final ThreadLocal<SimpleDateFormat> sdf = \n    ThreadLocal.withInitial(() -> new SimpleDateFormat("yyyy-MM-dd"));\n\n// \u4E0D\u63A8\u8350\uFF1A\u5B9E\u4F8B\u53D8\u91CF\nprivate ThreadLocal<SimpleDateFormat> sdf = new ThreadLocal<>();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u539F\u56E0\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ThreadLocal \u901A\u5E38\u4F5C\u4E3A\u5168\u5C40\u53D8\u91CF\u4F7F\u7528"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u521B\u5EFA\u591A\u4E2A ThreadLocal \u5B9E\u4F8B"}),"\n",(0,i.jsx)(e.li,{children:"\u51CF\u5C11\u5185\u5B58\u5F00\u9500"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u53CA\u65F6\u6E05\u7406\uFF08remove\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u63A8\u8350\uFF1A\u4F7F\u7528 try-finally\nThreadLocal<Connection> connectionHolder = new ThreadLocal<>();\n\npublic void doWork() {\n    try {\n        Connection conn = getConnection();\n        connectionHolder.set(conn);\n        // \u6267\u884C\u4E1A\u52A1\u903B\u8F91\n    } finally {\n        connectionHolder.remove(); // \u6E05\u7406\n    }\n}\n\n// \u5728\u8FC7\u6EE4\u5668\u4E2D\u4F7F\u7528\npublic class RequestContextFilter implements Filter {\n    private static final ThreadLocal<RequestContext> contextHolder = \n        new ThreadLocal<>();\n    \n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response,\n                        FilterChain chain) throws IOException, ServletException {\n        try {\n            contextHolder.set(new RequestContext(request));\n            chain.doFilter(request, response);\n        } finally {\n            contextHolder.remove(); // \u6E05\u7406\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u4F7F\u7528 initialValue \u6216 withInitial"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u65B9\u5F0F1\uFF1A\u91CD\u5199 initialValue\nprivate static final ThreadLocal<SimpleDateFormat> sdf = \n    new ThreadLocal<SimpleDateFormat>() {\n        @Override\n        protected SimpleDateFormat initialValue() {\n            return new SimpleDateFormat("yyyy-MM-dd");\n        }\n    };\n\n// \u65B9\u5F0F2\uFF1A\u4F7F\u7528 withInitial\uFF08\u63A8\u8350\uFF09\nprivate static final ThreadLocal<SimpleDateFormat> sdf = \n    ThreadLocal.withInitial(() -> new SimpleDateFormat("yyyy-MM-dd"));\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u907F\u514D\u5728\u7EBF\u7A0B\u6C60\u4E2D\u4F7F\u7528"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u95EE\u9898\uFF1A\u7EBF\u7A0B\u6C60\u4E2D\u7EBF\u7A0B\u590D\u7528\uFF0CThreadLocal \u6570\u636E\u53EF\u80FD\u6C61\u67D3\nExecutorService executor = Executors.newFixedThreadPool(10);\n\nexecutor.submit(() -> {\n    threadLocal.set("value1");\n    // \u4EFB\u52A1\u6267\u884C\u5B8C\uFF0C\u7EBF\u7A0B\u8FD4\u56DE\u7EBF\u7A0B\u6C60\n    // threadLocal \u4E2D\u7684\u6570\u636E\u4ECD\u7136\u5B58\u5728\n});\n\nexecutor.submit(() -> {\n    String value = threadLocal.get(); // \u53EF\u80FD\u83B7\u53D6\u5230\u4E0A\u4E00\u4E2A\u4EFB\u52A1\u7684\u6570\u636E\n});\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u6BCF\u6B21\u4F7F\u7528\u524D\u6E05\u7406\nexecutor.submit(() -> {\n    try {\n        threadLocal.remove(); // \u6E05\u7406\u65E7\u6570\u636E\n        threadLocal.set("value");\n        // \u6267\u884C\u4EFB\u52A1\n    } finally {\n        threadLocal.remove(); // \u6E05\u7406\n    }\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u4E0D\u8981\u5B58\u50A8\u5927\u5BF9\u8C61"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u4E0D\u63A8\u8350\uFF1A\u5B58\u50A8\u5927\u5BF9\u8C61\nprivate static final ThreadLocal<byte[]> largeData = new ThreadLocal<>();\nlargeData.set(new byte[10 * 1024 * 1024]); // 10MB\n\n// \u63A8\u8350\uFF1A\u5B58\u50A8\u5F15\u7528\u6216\u5C0F\u5BF9\u8C61\nprivate static final ThreadLocal<String> userId = new ThreadLocal<>();\nuserId.set("user123");\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u6587\u6863\u5316\u4F7F\u7528\u573A\u666F"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"/**\n * \u5B58\u50A8\u5F53\u524D\u8BF7\u6C42\u7684\u7528\u6237\u4FE1\u606F\n * \u6CE8\u610F\uFF1A\u5FC5\u987B\u5728\u8BF7\u6C42\u7ED3\u675F\u65F6\u8C03\u7528 clear() \u6E05\u7406\n */\nprivate static final ThreadLocal<User> currentUser = new ThreadLocal<>();\n\npublic static void setUser(User user) {\n    currentUser.set(user);\n}\n\npublic static User getUser() {\n    return currentUser.get();\n}\n\n/**\n * \u6E05\u7406\u5F53\u524D\u7EBF\u7A0B\u7684\u7528\u6237\u4FE1\u606F\n * \u5FC5\u987B\u5728\u8BF7\u6C42\u7ED3\u675F\u65F6\u8C03\u7528\n */\npublic static void clear() {\n    currentUser.remove();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. \u76D1\u63A7\u548C\u68C0\u6D4B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class ThreadLocalMonitor {\n    private static final ThreadLocal<Long> startTime = new ThreadLocal<>();\n    \n    public static void start() {\n        startTime.set(System.currentTimeMillis());\n    }\n    \n    public static void end() {\n        Long start = startTime.get();\n        if (start != null) {\n            long duration = System.currentTimeMillis() - start;\n            System.out.println("Duration: " + duration + "ms");\n            startTime.remove(); // \u6E05\u7406\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"8. \u4F7F\u7528\u5305\u88C5\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class ThreadLocalContext<T> {\n    private final ThreadLocal<T> threadLocal;\n    \n    public ThreadLocalContext(Supplier<T> supplier) {\n        this.threadLocal = ThreadLocal.withInitial(supplier);\n    }\n    \n    public T get() {\n        return threadLocal.get();\n    }\n    \n    public void set(T value) {\n        threadLocal.set(value);\n    }\n    \n    public void remove() {\n        threadLocal.remove();\n    }\n    \n    // \u81EA\u52A8\u6E05\u7406\n    public void execute(Consumer<T> action) {\n        try {\n            action.accept(get());\n        } finally {\n            remove();\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"50-java-\u4E2D\u7684-inheritablethreadlocal-\u662F\u4EC0\u4E48-1",children:"50. Java \u4E2D\u7684 InheritableThreadLocal \u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"InheritableThreadLocal \u662F ThreadLocal \u7684\u5B50\u7C7B\uFF0C\u5141\u8BB8\u5B50\u7EBF\u7A0B\u7EE7\u627F\u7236\u7EBF\u7A0B\u7684 ThreadLocal \u503C\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u57FA\u672C\u4F7F\u7528\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// ThreadLocal\uFF1A\u5B50\u7EBF\u7A0B\u65E0\u6CD5\u8BBF\u95EE\u7236\u7EBF\u7A0B\u7684\u503C\nprivate static ThreadLocal<String> threadLocal = new ThreadLocal<>();\n\npublic static void main(String[] args) {\n    threadLocal.set("\u7236\u7EBF\u7A0B\u7684\u503C");\n    \n    new Thread(() -> {\n        System.out.println(threadLocal.get()); // null\n    }).start();\n}\n\n// InheritableThreadLocal\uFF1A\u5B50\u7EBF\u7A0B\u53EF\u4EE5\u8BBF\u95EE\u7236\u7EBF\u7A0B\u7684\u503C\nprivate static InheritableThreadLocal<String> inheritableThreadLocal = \n    new InheritableThreadLocal<>();\n\npublic static void main(String[] args) {\n    inheritableThreadLocal.set("\u7236\u7EBF\u7A0B\u7684\u503C");\n    \n    new Thread(() -> {\n        System.out.println(inheritableThreadLocal.get()); // \u7236\u7EBF\u7A0B\u7684\u503C\n    }).start();\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u539F\u7406\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Thread \u7C7B\u4E2D\u7684\u5B57\u6BB5\npublic class Thread {\n    ThreadLocal.ThreadLocalMap threadLocals = null;\n    ThreadLocal.ThreadLocalMap inheritableThreadLocals = null; // \u53EF\u7EE7\u627F\u7684\n}\n\n// Thread \u6784\u9020\u51FD\u6570\nprivate void init(ThreadGroup g, Runnable target, String name, \n                 long stackSize, AccessControlContext acc, \n                 boolean inheritThreadLocals) {\n    Thread parent = currentThread();\n    \n    // \u5982\u679C\u7236\u7EBF\u7A0B\u6709 inheritableThreadLocals\uFF0C\u590D\u5236\u7ED9\u5B50\u7EBF\u7A0B\n    if (inheritThreadLocals && parent.inheritableThreadLocals != null)\n        this.inheritableThreadLocals = \n            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u7EE7\u627F\u903B\u8F91\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u91CD\u5199 childValue \u65B9\u6CD5\nprivate static InheritableThreadLocal<List<String>> inheritableThreadLocal = \n    new InheritableThreadLocal<List<String>>() {\n        @Override\n        protected List<String> childValue(List<String> parentValue) {\n            // \u8FD4\u56DE\u7236\u7EBF\u7A0B\u503C\u7684\u526F\u672C\uFF0C\u907F\u514D\u5171\u4EAB\n            return new ArrayList<>(parentValue);\n        }\n    };\n\npublic static void main(String[] args) {\n    List<String> list = new ArrayList<>();\n    list.add("item1");\n    inheritableThreadLocal.set(list);\n    \n    new Thread(() -> {\n        List<String> childList = inheritableThreadLocal.get();\n        childList.add("item2"); // \u4E0D\u5F71\u54CD\u7236\u7EBF\u7A0B\u7684 list\n        System.out.println(childList); // [item1, item2]\n    }).start();\n    \n    Thread.sleep(100);\n    System.out.println(list); // [item1]\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u94FE\u8DEF\u8FFD\u8E2A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class TraceContext {\n    private static final InheritableThreadLocal<String> traceId = \n        new InheritableThreadLocal<>();\n    \n    public static void setTraceId(String id) {\n        traceId.set(id);\n    }\n    \n    public static String getTraceId() {\n        return traceId.get();\n    }\n}\n\n// \u4E3B\u7EBF\u7A0B\nTraceContext.setTraceId("trace-123");\n\n// \u5B50\u7EBF\u7A0B\u81EA\u52A8\u7EE7\u627F\nnew Thread(() -> {\n    System.out.println(TraceContext.getTraceId()); // trace-123\n    // \u6267\u884C\u4E1A\u52A1\u903B\u8F91\n}).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u7528\u6237\u4E0A\u4E0B\u6587\u4F20\u9012"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class UserContext {\n    private static final InheritableThreadLocal<User> currentUser = \n        new InheritableThreadLocal<>();\n    \n    public static void setUser(User user) {\n        currentUser.set(user);\n    }\n    \n    public static User getUser() {\n        return currentUser.get();\n    }\n}\n\n// \u4E3B\u7EBF\u7A0B\u8BBE\u7F6E\u7528\u6237\nUserContext.setUser(new User("\u5F20\u4E09"));\n\n// \u5F02\u6B65\u4EFB\u52A1\u81EA\u52A8\u7EE7\u627F\nCompletableFuture.runAsync(() -> {\n    User user = UserContext.getUser(); // \u5F20\u4E09\n    // \u6267\u884C\u5F02\u6B65\u4EFB\u52A1\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5C40\u9650\u6027\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7EBF\u7A0B\u6C60\u95EE\u9898"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u95EE\u9898\uFF1A\u7EBF\u7A0B\u6C60\u4E2D\u7EBF\u7A0B\u590D\u7528\uFF0C\u7EE7\u627F\u7684\u503C\u4E0D\u4F1A\u66F4\u65B0\nExecutorService executor = Executors.newFixedThreadPool(10);\n\ninheritableThreadLocal.set("value1");\nexecutor.submit(() -> {\n    System.out.println(inheritableThreadLocal.get()); // value1\n});\n\ninheritableThreadLocal.set("value2");\nexecutor.submit(() -> {\n    // \u5982\u679C\u590D\u7528\u4E86\u4E4B\u524D\u7684\u7EBF\u7A0B\uFF0C\u4ECD\u7136\u662F value1\n    System.out.println(inheritableThreadLocal.get()); // value1\uFF08\u9519\u8BEF\uFF09\n});\n\n// \u89E3\u51B3\u65B9\u6848\uFF1A\u4F7F\u7528 TransmittableThreadLocal\uFF08\u963F\u91CC\u5F00\u6E90\uFF09\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5185\u5B58\u6CC4\u6F0F"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5B50\u7EBF\u7A0B\u7EE7\u627F\u7236\u7EBF\u7A0B\u7684\u503C\uFF0C\u589E\u52A0\u5185\u5B58\u5360\u7528\n// \u9700\u8981\u53CA\u65F6\u6E05\u7406\ntry {\n    inheritableThreadLocal.set(value);\n    // \u521B\u5EFA\u5B50\u7EBF\u7A0B\n} finally {\n    inheritableThreadLocal.remove();\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5BF9\u6BD4\u603B\u7ED3\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"ThreadLocal"}),(0,i.jsx)(e.th,{children:"InheritableThreadLocal"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5B50\u7EBF\u7A0B\u7EE7\u627F"}),(0,i.jsx)(e.td,{children:"\u5426"}),(0,i.jsx)(e.td,{children:"\u662F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u8F83\u597D"}),(0,i.jsx)(e.td,{children:"\u7A0D\u5DEE\uFF08\u9700\u8981\u590D\u5236\uFF09"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5185\u5B58\u5360\u7528"}),(0,i.jsx)(e.td,{children:"\u8F83\u5C0F"}),(0,i.jsx)(e.td,{children:"\u8F83\u5927"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9002\u7528\u573A\u666F"}),(0,i.jsx)(e.td,{children:"\u7EBF\u7A0B\u9694\u79BB"}),(0,i.jsx)(e.td,{children:"\u7236\u5B50\u7EBF\u7A0B\u4F20\u9012"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"51-threadlocal-\u7684\u7F3A\u70B9-1",children:"51. ThreadLocal \u7684\u7F3A\u70B9\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u5185\u5B58\u6CC4\u6F0F\u98CE\u9669"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Entry \u7684 key \u662F\u5F31\u5F15\u7528\uFF0C\u4F46 value \u662F\u5F3A\u5F15\u7528"}),"\n",(0,i.jsx)(e.li,{children:"ThreadLocal \u88AB\u56DE\u6536\u540E\uFF0Cvalue \u4ECD\u7136\u5B58\u5728"}),"\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u957F\u671F\u5B58\u6D3B\uFF08\u5982\u7EBF\u7A0B\u6C60\uFF09\u4F1A\u5BFC\u81F4\u5185\u5B58\u6CC4\u6F0F"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u7EBF\u7A0B\u6C60\u573A\u666F\u4E0B\u7684\u95EE\u9898"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u7EBF\u7A0B\u590D\u7528\u5BFC\u81F4\u6570\u636E\u6C61\u67D3"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0A\u4E00\u4E2A\u4EFB\u52A1\u7684\u6570\u636E\u53EF\u80FD\u5F71\u54CD\u4E0B\u4E00\u4E2A\u4EFB\u52A1"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u589E\u52A0\u5185\u5B58\u5F00\u9500"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u72EC\u7ACB\u7684\u526F\u672C"}),"\n",(0,i.jsx)(e.li,{children:"\u5927\u5BF9\u8C61\u4F1A\u5360\u7528\u5927\u91CF\u5185\u5B58"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4E0D\u9002\u5408\u7236\u5B50\u7EBF\u7A0B\u4F20\u9012"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u666E\u901A ThreadLocal \u65E0\u6CD5\u4F20\u9012\u7ED9\u5B50\u7EBF\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"InheritableThreadLocal \u5728\u7EBF\u7A0B\u6C60\u4E2D\u5931\u6548"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u8C03\u8BD5\u56F0\u96BE"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6570\u636E\u9690\u85CF\u5728\u7EBF\u7A0B\u5185\u90E8"}),"\n",(0,i.jsx)(e.li,{children:"\u96BE\u4EE5\u8FFD\u8E2A\u6570\u636E\u6D41\u5411"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u5BB9\u6613\u88AB\u6EE5\u7528"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8FC7\u5EA6\u4F7F\u7528\u5BFC\u81F4\u4EE3\u7801\u96BE\u4EE5\u7406\u89E3"}),"\n",(0,i.jsx)(e.li,{children:"\u9690\u5F0F\u4F9D\u8D56\u589E\u52A0\u8026\u5408"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"52-\u4E3A\u4EC0\u4E48-netty-\u4E0D\u4F7F\u7528-threadlocal-\u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A-fastthreadlocal",children:"52. \u4E3A\u4EC0\u4E48 Netty \u4E0D\u4F7F\u7528 ThreadLocal \u800C\u662F\u81EA\u5B9A\u4E49\u4E86\u4E00\u4E2A FastThreadLocal\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Netty \u7684 FastThreadLocal \u89E3\u51B3\u4E86 ThreadLocal \u7684\u6027\u80FD\u95EE\u9898\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"ThreadLocal \u7684\u6027\u80FD\u95EE\u9898\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u7EBF\u6027\u63A2\u6D4B\u6CD5\u89E3\u51B3\u54C8\u5E0C\u51B2\u7A81\uFF0C\u6027\u80FD\u8F83\u5DEE"}),"\n",(0,i.jsx)(e.li,{children:"\u9700\u8981\u6E05\u7406\u8FC7\u671F Entry\uFF0C\u589E\u52A0\u5F00\u9500"}),"\n",(0,i.jsx)(e.li,{children:"\u54C8\u5E0C\u8BA1\u7B97\u6709\u5F00\u9500"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"FastThreadLocal \u7684\u4F18\u5316\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4F7F\u7528\u6570\u7EC4\u4EE3\u66FF\u54C8\u5E0C\u8868"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// ThreadLocal\uFF1A\u4F7F\u7528\u54C8\u5E0C\u8868\nThreadLocalMap {\n    Entry[] table; // \u54C8\u5E0C\u8868\n    // \u9700\u8981\u8BA1\u7B97\u54C8\u5E0C\u503C\uFF0C\u5904\u7406\u51B2\u7A81\n}\n\n// FastThreadLocal\uFF1A\u4F7F\u7528\u6570\u7EC4\nInternalThreadLocalMap {\n    Object[] indexedVariables; // \u76F4\u63A5\u6570\u7EC4\u8BBF\u95EE\n    // \u6BCF\u4E2A FastThreadLocal \u6709\u56FA\u5B9A\u7D22\u5F15\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u76F4\u63A5\u7D22\u5F15\u8BBF\u95EE"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// FastThreadLocal \u6709\u56FA\u5B9A\u7D22\u5F15\npublic class FastThreadLocal<V> {\n    private final int index; // \u56FA\u5B9A\u7D22\u5F15\n    \n    public final V get() {\n        return get(InternalThreadLocalMap.get());\n    }\n    \n    public final V get(InternalThreadLocalMap threadLocalMap) {\n        Object v = threadLocalMap.indexedVariable(index); // \u76F4\u63A5\u8BBF\u95EE\n        if (v != InternalThreadLocalMap.UNSET) {\n            return (V) v;\n        }\n        return initialize(threadLocalMap);\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u914D\u5408 FastThreadLocalThread \u4F7F\u7528"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Netty \u7684\u7EBF\u7A0B\u7C7B\npublic class FastThreadLocalThread extends Thread {\n    private InternalThreadLocalMap threadLocalMap;\n    \n    public final InternalThreadLocalMap threadLocalMap() {\n        return threadLocalMap;\n    }\n    \n    public final void setThreadLocalMap(InternalThreadLocalMap threadLocalMap) {\n        this.threadLocalMap = threadLocalMap;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u5BF9\u6BD4\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"ThreadLocal\uFF1AO(n) \u6700\u574F\u60C5\u51B5\uFF08\u7EBF\u6027\u63A2\u6D4B\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"FastThreadLocal\uFF1AO(1) \u76F4\u63A5\u8BBF\u95EE"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u5B9A\u4E49 FastThreadLocal\nprivate static final FastThreadLocal<String> context = \n    new FastThreadLocal<String>() {\n        @Override\n        protected String initialValue() {\n            return "default";\n        }\n    };\n\n// \u4F7F\u7528\ncontext.set("value");\nString value = context.get();\ncontext.remove();\n'})}),"\n",(0,i.jsx)(e.h3,{id:"53-\u4EC0\u4E48\u662F-java-\u7684-transmittablethreadlocal-1",children:"53. \u4EC0\u4E48\u662F Java \u7684 TransmittableThreadLocal\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"TransmittableThreadLocal\uFF08TTL\uFF09\u662F\u963F\u91CC\u5F00\u6E90\u7684 ThreadLocal \u589E\u5F3A\u5E93\uFF0C\u89E3\u51B3\u7EBF\u7A0B\u6C60\u573A\u666F\u4E0B\u7684\u4E0A\u4E0B\u6587\u4F20\u9012\u95EE\u9898\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95EE\u9898\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// InheritableThreadLocal \u5728\u7EBF\u7A0B\u6C60\u4E2D\u5931\u6548\nInheritableThreadLocal<String> context = new InheritableThreadLocal<>();\n\ncontext.set("value1");\nexecutor.submit(() -> {\n    System.out.println(context.get()); // value1\n});\n\ncontext.set("value2");\nexecutor.submit(() -> {\n    // \u5982\u679C\u590D\u7528\u4E86\u4E4B\u524D\u7684\u7EBF\u7A0B\uFF0C\u4ECD\u7136\u662F value1\n    System.out.println(context.get()); // value1\uFF08\u9519\u8BEF\uFF09\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"TTL \u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u4F7F\u7528 TransmittableThreadLocal\nTransmittableThreadLocal<String> context = \n    new TransmittableThreadLocal<>();\n\n// \u5305\u88C5\u7EBF\u7A0B\u6C60\nExecutorService executor = TtlExecutors.getTtlExecutorService(\n    Executors.newFixedThreadPool(10)\n);\n\ncontext.set("value1");\nexecutor.submit(() -> {\n    System.out.println(context.get()); // value1\n});\n\ncontext.set("value2");\nexecutor.submit(() -> {\n    System.out.println(context.get()); // value2\uFF08\u6B63\u786E\uFF09\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u539F\u7406\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5728\u4EFB\u52A1\u63D0\u4EA4\u65F6\u6355\u83B7\u5F53\u524D\u7EBF\u7A0B\u7684 TTL \u503C"}),"\n",(0,i.jsx)(e.li,{children:"\u5728\u4EFB\u52A1\u6267\u884C\u524D\u6062\u590D TTL \u503C"}),"\n",(0,i.jsx)(e.li,{children:"\u5728\u4EFB\u52A1\u6267\u884C\u540E\u6E05\u7406 TTL \u503C"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5E94\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5206\u5E03\u5F0F\u94FE\u8DEF\u8FFD\u8E2A"}),"\n",(0,i.jsx)(e.li,{children:"\u65E5\u5FD7 MDC \u4F20\u9012"}),"\n",(0,i.jsx)(e.li,{children:"\u7528\u6237\u4E0A\u4E0B\u6587\u4F20\u9012"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"54-java-\u4E2D-threadsleep-\u548C-threadyield-\u7684\u533A\u522B-1",children:"54. Java \u4E2D Thread.sleep \u548C Thread.yield \u7684\u533A\u522B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"Thread.sleep"}),(0,i.jsx)(e.th,{children:"Thread.yield"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4F5C\u7528"}),(0,i.jsx)(e.td,{children:"\u8BA9\u7EBF\u7A0B\u4F11\u7720\u6307\u5B9A\u65F6\u95F4"}),(0,i.jsx)(e.td,{children:"\u8BA9\u51FA CPU \u65F6\u95F4\u7247"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u72B6\u6001"}),(0,i.jsx)(e.td,{children:"TIMED_WAITING"}),(0,i.jsx)(e.td,{children:"RUNNABLE"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u9501"}),(0,i.jsx)(e.td,{children:"\u4E0D\u91CA\u653E\u9501"}),(0,i.jsx)(e.td,{children:"\u4E0D\u91CA\u653E\u9501"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u65F6\u95F4"}),(0,i.jsx)(e.td,{children:"\u6307\u5B9A\u4F11\u7720\u65F6\u95F4"}),(0,i.jsx)(e.td,{children:"\u7ACB\u5373\u8FD4\u56DE"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1"}),(0,i.jsx)(e.td,{children:"\u81F3\u5C11\u4F11\u7720\u6307\u5B9A\u65F6\u95F4"}),(0,i.jsx)(e.td,{children:"\u4E0D\u4FDD\u8BC1\u8BA9\u51FA"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5F02\u5E38"}),(0,i.jsx)(e.td,{children:"InterruptedException"}),(0,i.jsx)(e.td,{children:"\u65E0"})]})]})]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Thread.sleep\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public static void sleep(long millis) throws InterruptedException\n\n// \u4F7F\u7528\ntry {\n    Thread.sleep(1000); // \u4F11\u77201\u79D2\n} catch (InterruptedException e) {\n    // \u5904\u7406\u4E2D\u65AD\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Thread.yield\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public static native void yield();\n\n// \u4F7F\u7528\nThread.yield(); // \u5EFA\u8BAE\u8BA9\u51FA CPU\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"sleep\uFF1A\u9700\u8981\u6682\u505C\u6267\u884C\u4E00\u6BB5\u65F6\u95F4"}),"\n",(0,i.jsx)(e.li,{children:"yield\uFF1A\u964D\u4F4E\u7EBF\u7A0B\u4F18\u5148\u7EA7\uFF0C\u8BA9\u5176\u4ED6\u7EBF\u7A0B\u6267\u884C"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"55-java-\u4E2D-threadsleep0-\u7684\u4F5C\u7528\u662F\u4EC0\u4E48-1",children:"55. Java \u4E2D Thread.sleep(0) \u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"Thread.sleep(0) \u4F1A\u89E6\u53D1\u64CD\u4F5C\u7CFB\u7EDF\u91CD\u65B0\u8C03\u5EA6\u7EBF\u7A0B\uFF0C\u4F46\u4E0D\u4F1A\u8BA9\u7EBF\u7A0B\u8FDB\u5165\u4F11\u7720\u72B6\u6001\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F5C\u7528\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u8BA9\u51FA\u5F53\u524D\u65F6\u95F4\u7247"}),"\n",(0,i.jsx)(e.li,{children:"\u89E6\u53D1\u7EBF\u7A0B\u8C03\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"\u7ED9\u5176\u4ED6\u7EBF\u7A0B\u6267\u884C\u673A\u4F1A"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E0E yield \u7684\u533A\u522B\uFF1A"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"sleep(0)\uFF1A\u89E6\u53D1\u64CD\u4F5C\u7CFB\u7EDF\u8C03\u5EA6"}),"\n",(0,i.jsx)(e.li,{children:"yield()\uFF1A\u4EC5\u5EFA\u8BAE JVM \u8C03\u5EA6"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5728\u957F\u65F6\u95F4\u5FAA\u73AF\u4E2D\u7ED9\u5176\u4ED6\u7EBF\u7A0B\u673A\u4F1A\nwhile (running) {\n    // \u6267\u884C\u4EFB\u52A1\n    doWork();\n    \n    // \u907F\u514D\u72EC\u5360 CPU\n    Thread.sleep(0);\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"56-java-\u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\u5982\u4F55\u907F\u514D-1",children:"56. Java \u4E2D\u4EC0\u4E48\u60C5\u51B5\u4F1A\u5BFC\u81F4\u6B7B\u9501\uFF1F\u5982\u4F55\u907F\u514D\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6B7B\u9501\u7684\u56DB\u4E2A\u5FC5\u8981\u6761\u4EF6\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4E92\u65A5\uFF1A\u8D44\u6E90\u4E0D\u80FD\u88AB\u5171\u4EAB"}),"\n",(0,i.jsx)(e.li,{children:"\u6301\u6709\u5E76\u7B49\u5F85\uFF1A\u6301\u6709\u8D44\u6E90\u7684\u540C\u65F6\u7B49\u5F85\u5176\u4ED6\u8D44\u6E90"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u53EF\u5265\u593A\uFF1A\u8D44\u6E90\u4E0D\u80FD\u88AB\u5F3A\u5236\u91CA\u653E"}),"\n",(0,i.jsx)(e.li,{children:"\u5FAA\u73AF\u7B49\u5F85\uFF1A\u5B58\u5728\u8D44\u6E90\u7684\u5FAA\u73AF\u7B49\u5F85\u94FE"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u6B7B\u9501\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class DeadlockDemo {\n    private static Object lock1 = new Object();\n    private static Object lock2 = new Object();\n    \n    public static void main(String[] args) {\n        // \u7EBF\u7A0B1\uFF1A\u5148\u9501 lock1\uFF0C\u518D\u9501 lock2\n        new Thread(() -> {\n            synchronized (lock1) {\n                System.out.println("Thread1 \u83B7\u53D6 lock1");\n                try { Thread.sleep(100); } catch (InterruptedException e) {}\n                synchronized (lock2) {\n                    System.out.println("Thread1 \u83B7\u53D6 lock2");\n                }\n            }\n        }).start();\n        \n        // \u7EBF\u7A0B2\uFF1A\u5148\u9501 lock2\uFF0C\u518D\u9501 lock1\n        new Thread(() -> {\n            synchronized (lock2) {\n                System.out.println("Thread2 \u83B7\u53D6 lock2");\n                try { Thread.sleep(100); } catch (InterruptedException e) {}\n                synchronized (lock1) {\n                    System.out.println("Thread2 \u83B7\u53D6 lock1");\n                }\n            }\n        }).start();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u907F\u514D\u6B7B\u9501\u7684\u65B9\u6CD5\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u56FA\u5B9A\u52A0\u9501\u987A\u5E8F"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u7EDF\u4E00\u52A0\u9501\u987A\u5E8F\npublic void transfer(Account from, Account to, int amount) {\n    Account first = from.id < to.id ? from : to;\n    Account second = from.id < to.id ? to : from;\n    \n    synchronized (first) {\n        synchronized (second) {\n            from.debit(amount);\n            to.credit(amount);\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u4F7F\u7528\u8D85\u65F6"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"Lock lock1 = new ReentrantLock();\nLock lock2 = new ReentrantLock();\n\npublic void method() {\n    try {\n        if (lock1.tryLock(1, TimeUnit.SECONDS)) {\n            try {\n                if (lock2.tryLock(1, TimeUnit.SECONDS)) {\n                    try {\n                        // \u6267\u884C\u64CD\u4F5C\n                    } finally {\n                        lock2.unlock();\n                    }\n                }\n            } finally {\n                lock1.unlock();\n            }\n        }\n    } catch (InterruptedException e) {\n        // \u5904\u7406\u4E2D\u65AD\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6B7B\u9501\u68C0\u6D4B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528 JMX \u68C0\u6D4B\u6B7B\u9501\nThreadMXBean tmx = ManagementFactory.getThreadMXBean();\nlong[] deadlockedThreads = tmx.findDeadlockedThreads();\nif (deadlockedThreads != null) {\n    ThreadInfo[] threadInfos = tmx.getThreadInfo(deadlockedThreads);\n    // \u5904\u7406\u6B7B\u9501\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"57-java-\u4E2D-volatile-\u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48-1",children:"57. Java \u4E2D volatile \u5173\u952E\u5B57\u7684\u4F5C\u7528\u662F\u4EC0\u4E48\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"volatile \u4FDD\u8BC1\u53D8\u91CF\u7684\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF0C\u4F46\u4E0D\u4FDD\u8BC1\u539F\u5B50\u6027\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F5C\u7528\uFF1A"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u4FDD\u8BC1\u53EF\u89C1\u6027\uFF1A\u4FEE\u6539\u7ACB\u5373\u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1"}),"\n",(0,i.jsx)(e.li,{children:"\u7981\u6B62\u6307\u4EE4\u91CD\u6392\uFF1A\u4FDD\u8BC1\u6709\u5E8F\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u4E0D\u4FDD\u8BC1\u539F\u5B50\u6027\uFF1A\u590D\u5408\u64CD\u4F5C\u4E0D\u662F\u539F\u5B50\u7684"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4F7F\u7528\u573A\u666F\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// 1. \u72B6\u6001\u6807\u5FD7\nprivate volatile boolean running = true;\n\npublic void stop() {\n    running = false;\n}\n\n// 2. \u53CC\u91CD\u68C0\u67E5\u9501\u5B9A\nprivate volatile static Singleton instance;\n\n// 3. \u72EC\u7ACB\u89C2\u5BDF\nprivate volatile long lastUpdateTime;\n"})}),"\n",(0,i.jsx)(e.h3,{id:"58-\u4EC0\u4E48\u662F-java-\u4E2D\u7684-aba-\u95EE\u9898-1",children:"58. \u4EC0\u4E48\u662F Java \u4E2D\u7684 ABA \u95EE\u9898\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:"ABA \u95EE\u9898\u662F\u6307\u4E00\u4E2A\u503C\u4ECE A \u53D8\u6210 B\uFF0C\u518D\u53D8\u56DE A\uFF0CCAS \u64CD\u4F5C\u65E0\u6CD5\u68C0\u6D4B\u5230\u8FD9\u4E2A\u53D8\u5316\u3002"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u95EE\u9898\u793A\u4F8B\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"AtomicInteger value = new AtomicInteger(100);\n\n// \u7EBF\u7A0B1\uFF1A\u8BFB\u53D6\u503C 100\nint oldValue = value.get(); // 100\n\n// \u7EBF\u7A0B2\uFF1A100 -> 200 -> 100\nvalue.compareAndSet(100, 200);\nvalue.compareAndSet(200, 100);\n\n// \u7EBF\u7A0B1\uFF1ACAS \u6210\u529F\uFF0C\u4F46\u503C\u5DF2\u7ECF\u88AB\u4FEE\u6539\u8FC7\nvalue.compareAndSet(oldValue, 101); // \u6210\u529F\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4F7F\u7528 AtomicStampedReference\uFF08\u7248\u672C\u53F7\uFF09\nAtomicStampedReference<Integer> ref = \n    new AtomicStampedReference<>(100, 0);\n\nint stamp = ref.getStamp();\nref.compareAndSet(100, 101, stamp, stamp + 1);\n"})}),"\n",(0,i.jsx)(e.h3,{id:"59-\u5728-java-\u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F-1",children:"59. \u5728 Java \u4E2D\u4E3B\u7EBF\u7A0B\u5982\u4F55\u77E5\u6653\u521B\u5EFA\u7684\u5B50\u7EBF\u7A0B\u662F\u5426\u6267\u884C\u6210\u529F\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u4F7F\u7528 join()"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"Thread thread = new Thread(() -> {\n    // \u6267\u884C\u4EFB\u52A1\n});\nthread.start();\nthread.join(); // \u7B49\u5F85\u7EBF\u7A0B\u7ED3\u675F\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u4F7F\u7528 Future"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ExecutorService executor = Executors.newSingleThreadExecutor();\nFuture<String> future = executor.submit(() -> {\n    return "\u7ED3\u679C";\n});\n\ntry {\n    String result = future.get(); // \u83B7\u53D6\u7ED3\u679C\n    System.out.println("\u6210\u529F: " + result);\n} catch (ExecutionException e) {\n    System.out.println("\u5931\u8D25: " + e.getCause());\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u4F7F\u7528 CompletableFuture"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CompletableFuture.supplyAsync(() -> {\n    return "\u7ED3\u679C";\n}).whenComplete((result, ex) -> {\n    if (ex != null) {\n        System.out.println("\u5931\u8D25: " + ex);\n    } else {\n        System.out.println("\u6210\u529F: " + result);\n    }\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F7F\u7528 CountDownLatch"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CountDownLatch latch = new CountDownLatch(1);\nAtomicBoolean success = new AtomicBoolean(false);\n\nnew Thread(() -> {\n    try {\n        // \u6267\u884C\u4EFB\u52A1\n        success.set(true);\n    } finally {\n        latch.countDown();\n    }\n}).start();\n\nlatch.await();\nSystem.out.println("\u6210\u529F: " + success.get());\n'})}),"\n",(0,i.jsx)(e.h3,{id:"60-\u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F-1",children:"60. \u521B\u5EFA\u7EBF\u7A0B\u6C60\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. Executors \u5DE5\u5382\u65B9\u6CD5"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ExecutorService executor1 = Executors.newFixedThreadPool(5);\nExecutorService executor2 = Executors.newCachedThreadPool();\nExecutorService executor3 = Executors.newSingleThreadExecutor();\nScheduledExecutorService executor4 = Executors.newScheduledThreadPool(5);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. ThreadPoolExecutor \u6784\u9020\u51FD\u6570\uFF08\u63A8\u8350\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"ThreadPoolExecutor executor = new ThreadPoolExecutor(\n    5,                          // \u6838\u5FC3\u7EBF\u7A0B\u6570\n    10,                         // \u6700\u5927\u7EBF\u7A0B\u6570\n    60L,                        // \u7A7A\u95F2\u7EBF\u7A0B\u5B58\u6D3B\u65F6\u95F4\n    TimeUnit.SECONDS,\n    new LinkedBlockingQueue<>(100),\n    Executors.defaultThreadFactory(),\n    new ThreadPoolExecutor.AbortPolicy()\n);\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. Spring \u914D\u7F6E"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class ThreadPoolConfig {\n    @Bean\n    public Executor taskExecutor() {\n        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n        executor.setCorePoolSize(5);\n        executor.setMaxPoolSize(10);\n        executor.setQueueCapacity(100);\n        executor.setThreadNamePrefix("async-");\n        executor.initialize();\n        return executor;\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"61-\u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B-1",children:"61. \u7EBF\u7A0B\u5B89\u5168\u7684\u96C6\u5408\u6709\u54EA\u4E9B\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u540C\u6B65\u96C6\u5408\uFF08synchronized\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"Vector<String> vector = new Vector<>();\nHashtable<String, String> hashtable = new Hashtable<>();\nStack<String> stack = new Stack<>();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5E76\u53D1\u96C6\u5408\uFF08java.util.concurrent\uFF09"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// Map\nConcurrentHashMap<String, String> map = new ConcurrentHashMap<>();\n\n// List\nCopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<>();\n\n// Set\nCopyOnWriteArraySet<String> set = new CopyOnWriteArraySet<>();\nConcurrentSkipListSet<String> sortedSet = new ConcurrentSkipListSet<>();\n\n// Queue\nConcurrentLinkedQueue<String> queue = new ConcurrentLinkedQueue<>();\nLinkedBlockingQueue<String> blockingQueue = new LinkedBlockingQueue<>();\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. Collections \u5DE5\u5177\u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"List<String> syncList = Collections.synchronizedList(new ArrayList<>());\nSet<String> syncSet = Collections.synchronizedSet(new HashSet<>());\nMap<String, String> syncMap = Collections.synchronizedMap(new HashMap<>());\n"})}),"\n",(0,i.jsx)(e.h3,{id:"62-java-\u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F-1",children:"62. Java \u521B\u5EFA\u7EBF\u7A0B\u6709\u54EA\u4E9B\u65B9\u5F0F\uFF1F"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u7B54\u6848\uFF1A"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u7EE7\u627F Thread \u7C7B"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'class MyThread extends Thread {\n    @Override\n    public void run() {\n        System.out.println("Thread running");\n    }\n}\n\nnew MyThread().start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5B9E\u73B0 Runnable \u63A5\u53E3"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'class MyRunnable implements Runnable {\n    @Override\n    public void run() {\n        System.out.println("Runnable running");\n    }\n}\n\nnew Thread(new MyRunnable()).start();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u5B9E\u73B0 Callable \u63A5\u53E3"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'class MyCallable implements Callable<String> {\n    @Override\n    public String call() throws Exception {\n        return "Callable result";\n    }\n}\n\nFutureTask<String> task = new FutureTask<>(new MyCallable());\nnew Thread(task).start();\nString result = task.get();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"4. \u4F7F\u7528\u7EBF\u7A0B\u6C60"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ExecutorService executor = Executors.newFixedThreadPool(5);\nexecutor.submit(() -> System.out.println("Task"));\nexecutor.shutdown();\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"5. \u4F7F\u7528 CompletableFuture"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'CompletableFuture.runAsync(() -> {\n    System.out.println("Async task");\n});\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"6. \u4F7F\u7528 ForkJoinPool"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'ForkJoinPool pool = new ForkJoinPool();\npool.submit(() -> System.out.println("ForkJoin task"));\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"7. \u4F7F\u7528 Timer"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'Timer timer = new Timer();\ntimer.schedule(new TimerTask() {\n    @Override\n    public void run() {\n        System.out.println("Timer task");\n    }\n}, 1000);\n'})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\u603B\u7ED3",children:"\u603B\u7ED3"}),"\n",(0,i.jsx)(e.p,{children:"\u672C\u6587\u6863\u6DB5\u76D6\u4E86 Java \u5E76\u53D1\u7F16\u7A0B\u7684 62 \u4E2A\u6838\u5FC3\u9762\u8BD5\u9898\uFF0C\u5305\u62EC\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u57FA\u7840"}),"\uFF1A\u7EBF\u7A0B\u521B\u5EFA\u3001\u751F\u547D\u5468\u671F\u3001\u901A\u4FE1\u673A\u5236"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7EBF\u7A0B\u6C60"}),"\uFF1A\u539F\u7406\u3001\u53C2\u6570\u914D\u7F6E\u3001\u62D2\u7EDD\u7B56\u7565"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u673A\u5236"}),"\uFF1Asynchronized\u3001ReentrantLock\u3001\u8BFB\u5199\u9501\u3001AQS"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5E76\u53D1\u5DE5\u5177"}),"\uFF1ACountDownLatch\u3001CyclicBarrier\u3001Semaphore"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5E76\u53D1\u5BB9\u5668"}),"\uFF1AConcurrentHashMap\u3001\u963B\u585E\u961F\u5217"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u539F\u5B50\u7C7B"}),"\uFF1AAtomicInteger\u3001LongAdder\u3001CAS"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u6A21\u578B"}),"\uFF1AJMM\u3001happens-before\u3001\u6307\u4EE4\u91CD\u6392"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ThreadLocal"}),"\uFF1A\u539F\u7406\u3001\u4F7F\u7528\u3001\u6700\u4F73\u5B9E\u8DF5"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u638C\u63E1\u8FD9\u4E9B\u77E5\u8BC6\u70B9\uFF0C\u80FD\u591F\u5E2E\u52A9\u4F60\u5728\u9762\u8BD5\u4E2D\u8131\u9896\u800C\u51FA\uFF0C\u5728\u5B9E\u9645\u5DE5\u4F5C\u4E2D\u7F16\u5199\u9AD8\u8D28\u91CF\u7684\u5E76\u53D1\u4EE3\u7801\u3002"})]})}function o(n={}){let{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},28453:function(n,e,r){r.d(e,{R:()=>c,x:()=>a});var l=r(96540);let i={},s=l.createContext(i);function c(n){let e=l.useContext(s);return l.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),l.createElement(s.Provider,{value:e},n.children)}}}]);