"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["28377"],{68263:function(n,e,t){t.r(e),t.d(e,{metadata:()=>r,default:()=>j,frontMatter:()=>o,contentTitle:()=>d,toc:()=>u,assets:()=>h});var r=JSON.parse('{"id":"backend/concurrency/locks","title":"Java\u9501\u673A\u5236\u8BE6\u89E3","description":"\u5168\u9762\u4ECB\u7ECDJava\u9501\u673A\u5236\u3001synchronized\u3001Lock\u63A5\u53E3\u3001\u8BFB\u5199\u9501\u4E0E\u6700\u4F73\u5B9E\u8DF5","source":"@site/docs/backend/concurrency/locks.mdx","sourceDirName":"backend/concurrency","slug":"/backend/concurrency/locks","permalink":"/docs/backend/concurrency/locks","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/concurrency/locks.mdx","tags":[],"version":"current","lastUpdatedBy":"Laby","lastUpdatedAt":1736208000000,"sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Java\u9501\u673A\u5236\u8BE6\u89E3","description":"\u5168\u9762\u4ECB\u7ECDJava\u9501\u673A\u5236\u3001synchronized\u3001Lock\u63A5\u53E3\u3001\u8BFB\u5199\u9501\u4E0E\u6700\u4F73\u5B9E\u8DF5","authors":["Laby"],"last_update":{"date":"2025-01-07T00:00:00.000Z","author":"Laby"}},"sidebar":"tutorialSidebar","previous":{"title":"Java ThreadLocal\u8BE6\u89E3","permalink":"/docs/backend/concurrency/threadlocal"},"next":{"title":"Java\u5E76\u53D1\u5BB9\u5668\u8BE6\u89E3","permalink":"/docs/backend/concurrency/concurrent-containers"}}'),i=t(74848),c=t(28453),l=t(78010),a=t(57250),s=t(19007);let o={sidebar_position:6,title:"Java\u9501\u673A\u5236\u8BE6\u89E3",description:"\u5168\u9762\u4ECB\u7ECDJava\u9501\u673A\u5236\u3001synchronized\u3001Lock\u63A5\u53E3\u3001\u8BFB\u5199\u9501\u4E0E\u6700\u4F73\u5B9E\u8DF5",authors:["Laby"],last_update:{date:new Date("2025-01-07T00:00:00.000Z"),author:"Laby"}},d="Java \u9501\u673A\u5236\u8BE6\u89E3",h={},u=[{value:"1. \u9501\u673A\u5236\u6982\u8FF0",id:"1-\u9501\u673A\u5236\u6982\u8FF0",level:2},{value:"1.1 \u4EC0\u4E48\u662F\u9501\uFF1F",id:"11-\u4EC0\u4E48\u662F\u9501",level:3},{value:"1.2 \u9501\u7684\u5206\u7C7B",id:"12-\u9501\u7684\u5206\u7C7B",level:3},{value:"1.3 \u9501\u7684\u6027\u80FD\u7279\u6027",id:"13-\u9501\u7684\u6027\u80FD\u7279\u6027",level:3},{value:"2. synchronized \u5173\u952E\u5B57",id:"2-synchronized-\u5173\u952E\u5B57",level:2},{value:"2.1 synchronized \u57FA\u672C\u7528\u6CD5",id:"21-synchronized-\u57FA\u672C\u7528\u6CD5",level:3},{value:"2.2 synchronized \u7684\u7279\u6027",id:"22-synchronized-\u7684\u7279\u6027",level:3},{value:"2.3 synchronized \u7684\u5C40\u9650\u6027",id:"23-synchronized-\u7684\u5C40\u9650\u6027",level:3},{value:"3. Lock \u63A5\u53E3",id:"3-lock-\u63A5\u53E3",level:2},{value:"3.1 Lock \u63A5\u53E3\u57FA\u672C\u7528\u6CD5",id:"31-lock-\u63A5\u53E3\u57FA\u672C\u7528\u6CD5",level:3},{value:"3.2 ReentrantLock \u9AD8\u7EA7\u7279\u6027",id:"32-reentrantlock-\u9AD8\u7EA7\u7279\u6027",level:3},{value:"4. \u8BFB\u5199\u9501 (ReadWriteLock)",id:"4-\u8BFB\u5199\u9501-readwritelock",level:2},{value:"4.1 \u8BFB\u5199\u9501\u57FA\u672C\u7528\u6CD5",id:"41-\u8BFB\u5199\u9501\u57FA\u672C\u7528\u6CD5",level:3},{value:"4.2 \u8BFB\u5199\u9501\u7684\u6027\u80FD\u7279\u6027",id:"42-\u8BFB\u5199\u9501\u7684\u6027\u80FD\u7279\u6027",level:3},{value:"5. \u9501\u7684\u6700\u4F73\u5B9E\u8DF5",id:"5-\u9501\u7684\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"5.1 \u9501\u7684\u9009\u62E9\u7B56\u7565",id:"51-\u9501\u7684\u9009\u62E9\u7B56\u7565",level:3},{value:"5.2 \u907F\u514D\u6B7B\u9501",id:"52-\u907F\u514D\u6B7B\u9501",level:3},{value:"5.3 \u6027\u80FD\u4F18\u5316\u6280\u5DE7",id:"53-\u6027\u80FD\u4F18\u5316\u6280\u5DE7",level:3},{value:"6. \u603B\u7ED3",id:"6-\u603B\u7ED3",level:2},{value:"6.1 \u5173\u952E\u8981\u70B9",id:"61-\u5173\u952E\u8981\u70B9",level:3},{value:"6.2 \u9009\u62E9\u5EFA\u8BAE",id:"62-\u9009\u62E9\u5EFA\u8BAE",level:3},{value:"6.3 \u5B66\u4E60\u5EFA\u8BAE",id:"63-\u5B66\u4E60\u5EFA\u8BAE",level:3}];function x(n){let e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...n.components},{Details:t}=e;return t||function(n,e){throw Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"java-\u9501\u673A\u5236\u8BE6\u89E3",children:"Java \u9501\u673A\u5236\u8BE6\u89E3"})}),"\n",(0,i.jsx)(e.p,{children:"\u9501\u662FJava\u5E76\u53D1\u7F16\u7A0B\u4E2D\u5B9E\u73B0\u7EBF\u7A0B\u540C\u6B65\u7684\u6838\u5FC3\u673A\u5236\uFF0C\u7406\u89E3\u5404\u79CD\u9501\u7684\u7279\u6027\u548C\u4F7F\u7528\u573A\u666F\u5BF9\u4E8E\u6784\u5EFA\u9AD8\u6027\u80FD\u7684\u5E76\u53D1\u5E94\u7528\u81F3\u5173\u91CD\u8981\u3002\u672C\u6587\u5C06\u8BE6\u7EC6\u4ECB\u7ECDJava\u4E2D\u7684\u5404\u79CD\u9501\u673A\u5236\u3002"}),"\n",(0,i.jsx)(e.admonition,{title:"\u672C\u6587\u5185\u5BB9\u6982\u89C8",type:"info",children:(0,i.jsx)(s.A,{toc:u})}),"\n",(0,i.jsxs)(e.admonition,{title:"\u6838\u5FC3\u4EF7\u503C",type:"tip",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Java\u9501\u673A\u5236 = \u7EBF\u7A0B\u540C\u6B65 + \u8D44\u6E90\u4FDD\u62A4 + \u6267\u884C\u987A\u5E8F\u63A7\u5236 + \u5185\u5B58\u53EF\u89C1\u6027"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u{1F512} ",(0,i.jsx)(e.strong,{children:"\u540C\u6B65\u8BBF\u95EE"}),"\uFF1A\u786E\u4FDD\u5171\u4EAB\u8D44\u6E90\u7684\u4E92\u65A5\u8BBF\u95EE"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F6E1}\uFE0F ",(0,i.jsx)(e.strong,{children:"\u6570\u636E\u4FDD\u62A4"}),"\uFF1A\u907F\u514D\u6570\u636E\u7ADE\u4E89\u548C\u72B6\u6001\u4E0D\u4E00\u81F4"]}),"\n",(0,i.jsxs)(e.li,{children:["\u26A1 ",(0,i.jsx)(e.strong,{children:"\u9AD8\u6027\u80FD"}),"\uFF1A\u901A\u8FC7\u4E0D\u540C\u9501\u7B56\u7565\u4F18\u5316\u5E76\u53D1\u6027\u80FD"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F504} ",(0,i.jsx)(e.strong,{children:"\u6267\u884C\u63A7\u5236"}),"\uFF1A\u7BA1\u7406\u7EBF\u7A0B\u7684\u6267\u884C\u987A\u5E8F\u548C\u65F6\u5E8F\u5173\u7CFB"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F441}\uFE0F ",(0,i.jsx)(e.strong,{children:"\u53EF\u89C1\u6027"}),"\uFF1A\u786E\u4FDD\u7EBF\u7A0B\u95F4\u6570\u636E\u4FEE\u6539\u7684\u53EF\u89C1\u6027"]}),"\n"]})]}),"\n",(0,i.jsx)(e.h2,{id:"1-\u9501\u673A\u5236\u6982\u8FF0",children:"1. \u9501\u673A\u5236\u6982\u8FF0"}),"\n",(0,i.jsx)(e.h3,{id:"11-\u4EC0\u4E48\u662F\u9501",children:"1.1 \u4EC0\u4E48\u662F\u9501\uFF1F"}),"\n",(0,i.jsx)(e.mermaid,{value:"graph TD\n    A[\u9501\u673A\u5236] --\x3e B[\u540C\u6B65\u8BBF\u95EE]\n    A --\x3e C[\u4E92\u65A5\u6027]\n    A --\x3e D[\u53EF\u89C1\u6027]\n    A --\x3e E[\u539F\u5B50\u6027]\n    \n    B --\x3e B1[\u63A7\u5236\u591A\u7EBF\u7A0B\u8BBF\u95EE\u5171\u4EAB\u8D44\u6E90]\n    C --\x3e C1[\u786E\u4FDD\u4E00\u6B21\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6301\u6709\u9501]\n    D --\x3e D1[\u4FDD\u8BC1\u7EBF\u7A0B\u95F4\u6570\u636E\u4FEE\u6539\u7684\u53EF\u89C1\u6027]\n    E --\x3e E1[\u786E\u4FDD\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u4E2D\u65AD]\n    \n    style A fill:#f9f,stroke:#333,stroke-width:2px\n    style B fill:#bbf,stroke:#333\n    style C fill:#bbf,stroke:#333\n    style D fill:#bbf,stroke:#333\n    style E fill:#bbf,stroke:#333"}),"\n",(0,i.jsx)(e.admonition,{title:"\u6838\u5FC3\u6982\u5FF5",type:"tip",children:(0,i.jsx)(e.p,{children:"\u9501\u662F\u4E00\u79CD\u540C\u6B65\u673A\u5236\uFF0C\u7528\u4E8E\u63A7\u5236\u591A\u4E2A\u7EBF\u7A0B\u5BF9\u5171\u4EAB\u8D44\u6E90\u7684\u8BBF\u95EE\u3002\u9501\u786E\u4FDD\u5728\u4EFB\u610F\u65F6\u523B\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u80FD\u591F\u8BBF\u95EE\u88AB\u4FDD\u62A4\u7684\u8D44\u6E90\uFF0C\u4ECE\u800C\u4FDD\u8BC1\u6570\u636E\u7684\u4E00\u81F4\u6027\u548C\u5B8C\u6574\u6027\u3002"})}),"\n",(0,i.jsx)(e.h3,{id:"12-\u9501\u7684\u5206\u7C7B",children:"1.2 \u9501\u7684\u5206\u7C7B"}),"\n",(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("div",{className:"card__body",children:(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5206\u7C7B\u7EF4\u5EA6"}),(0,i.jsx)(e.th,{children:"\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u7279\u70B9"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u573A\u666F"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u73B0\u65B9\u5F0F"})}),(0,i.jsx)(e.td,{children:"synchronized"}),(0,i.jsx)(e.td,{children:"\u5185\u7F6E\u9501\uFF0C\u81EA\u52A8\u7BA1\u7406"}),(0,i.jsx)(e.td,{children:"\u7B80\u5355\u540C\u6B65\u9700\u6C42"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"Lock\u63A5\u53E3"}),(0,i.jsx)(e.td,{children:"\u663E\u5F0F\u9501\uFF0C\u624B\u52A8\u7BA1\u7406"}),(0,i.jsx)(e.td,{children:"\u590D\u6742\u540C\u6B65\u9700\u6C42"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u6027"})}),(0,i.jsx)(e.td,{children:"\u975E\u516C\u5E73\u9501"}),(0,i.jsx)(e.td,{children:"\u6027\u80FD\u9AD8\uFF0C\u4E0D\u4FDD\u8BC1\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u4E00\u822C\u573A\u666F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"\u516C\u5E73\u9501"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1FIFO\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u9700\u8981\u516C\u5E73\u6027\u573A\u666F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u53EF\u91CD\u5165\u6027"})}),(0,i.jsx)(e.td,{children:"\u53EF\u91CD\u5165\u9501"}),(0,i.jsx)(e.td,{children:"\u540C\u4E00\u7EBF\u7A0B\u53EF\u591A\u6B21\u83B7\u53D6"}),(0,i.jsx)(e.td,{children:"\u9012\u5F52\u8C03\u7528\u573A\u666F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"\u4E0D\u53EF\u91CD\u5165\u9501"}),(0,i.jsx)(e.td,{children:"\u540C\u4E00\u7EBF\u7A0B\u53EA\u80FD\u83B7\u53D6\u4E00\u6B21"}),(0,i.jsx)(e.td,{children:"\u7B80\u5355\u573A\u666F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u8BFB\u5199\u7279\u6027"})}),(0,i.jsx)(e.td,{children:"\u72EC\u5360\u9501"}),(0,i.jsx)(e.td,{children:"\u53EA\u5141\u8BB8\u4E00\u4E2A\u7EBF\u7A0B\u8BBF\u95EE"}),(0,i.jsx)(e.td,{children:"\u5199\u64CD\u4F5C"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"\u8BFB\u5199\u9501"}),(0,i.jsx)(e.td,{children:"\u5141\u8BB8\u591A\u4E2A\u8BFB\uFF0C\u5355\u4E2A\u5199"}),(0,i.jsx)(e.td,{children:"\u8BFB\u591A\u5199\u5C11\u573A\u666F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4E50\u89C2/\u60B2\u89C2"})}),(0,i.jsx)(e.td,{children:"\u60B2\u89C2\u9501"}),(0,i.jsx)(e.td,{children:"\u5047\u8BBE\u4F1A\u53D1\u751F\u51B2\u7A81\uFF0C\u5148\u83B7\u53D6\u9501"}),(0,i.jsx)(e.td,{children:"\u9AD8\u5E76\u53D1\u5199\u64CD\u4F5C"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{}),(0,i.jsx)(e.td,{children:"\u4E50\u89C2\u9501"}),(0,i.jsx)(e.td,{children:"\u5047\u8BBE\u4E0D\u4F1A\u53D1\u751F\u51B2\u7A81\uFF0C\u68C0\u6D4B\u66F4\u65B0"}),(0,i.jsx)(e.td,{children:"\u8BFB\u591A\u5199\u5C11\u573A\u666F"})]})]})]})})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:"\u9501\u5206\u7C7B\u8BE6\u7EC6\u56FE"})}),(0,i.jsx)(e.mermaid,{value:"classDiagram\n    class Java\u9501 {\n        <<interface>>\n    }\n    \n    class \u5B9E\u73B0\u65B9\u5F0F {\n        \u5185\u7F6E\u9501\n        \u663E\u5F0F\u9501\n    }\n    \n    class \u5185\u7F6E\u9501 {\n        synchronized\u5173\u952E\u5B57\n        \u81EA\u52A8\u83B7\u53D6\u91CA\u653E\n        JVM\u5C42\u9762\u5B9E\u73B0\n    }\n    \n    class \u663E\u5F0F\u9501 {\n        Lock\u63A5\u53E3\n        \u624B\u52A8\u83B7\u53D6\u91CA\u653E\n        JDK\u5C42\u9762\u5B9E\u73B0\n    }\n    \n    class \u516C\u5E73\u6027 {\n        \u516C\u5E73\u9501\n        \u975E\u516C\u5E73\u9501\n    }\n    \n    class \u516C\u5E73\u9501 {\n        FIFO\u987A\u5E8F\n        \u7B49\u5F85\u65F6\u95F4\u957F\u7684\u4F18\u5148\u83B7\u5F97\u9501\n    }\n    \n    class \u975E\u516C\u5E73\u9501 {\n        \u968F\u673A\u6216\u5C31\u8FD1\u539F\u5219\n        \u6027\u80FD\u8F83\u9AD8\n    }\n    \n    class \u53EF\u91CD\u5165\u6027 {\n        \u53EF\u91CD\u5165\u9501\n        \u4E0D\u53EF\u91CD\u5165\u9501\n    }\n    \n    class \u53EF\u91CD\u5165\u9501 {\n        \u540C\u4E00\u7EBF\u7A0B\u53EF\u91CD\u590D\u83B7\u53D6\n        \u9501\u8BA1\u6570\u5668\u673A\u5236\n    }\n    \n    class \u4E0D\u53EF\u91CD\u5165\u9501 {\n        \u540C\u4E00\u7EBF\u7A0B\u4E0D\u53EF\u91CD\u590D\u83B7\u53D6\n        \u7B80\u5355\u5B9E\u73B0\n    }\n    \n    class \u8BFB\u5199\u7279\u6027 {\n        \u72EC\u5360\u9501\n        \u5171\u4EAB\u9501\n    }\n    \n    class \u72EC\u5360\u9501 {\n        \u6392\u4ED6\u9501\n        \u540C\u4E00\u65F6\u523B\u4EC5\u4E00\u4E2A\u7EBF\u7A0B\n        ReentrantLock\n    }\n    \n    class \u5171\u4EAB\u9501 {\n        \u540C\u4E00\u65F6\u523B\u591A\u4E2A\u7EBF\u7A0B\n        ReadWriteLock\n        Semaphore\n    }\n    \n    Java\u9501 --\x3e \u5B9E\u73B0\u65B9\u5F0F\n    \u5B9E\u73B0\u65B9\u5F0F --\x3e \u5185\u7F6E\u9501\n    \u5B9E\u73B0\u65B9\u5F0F --\x3e \u663E\u5F0F\u9501\n    Java\u9501 --\x3e \u516C\u5E73\u6027\n    \u516C\u5E73\u6027 --\x3e \u516C\u5E73\u9501\n    \u516C\u5E73\u6027 --\x3e \u975E\u516C\u5E73\u9501\n    Java\u9501 --\x3e \u53EF\u91CD\u5165\u6027\n    \u53EF\u91CD\u5165\u6027 --\x3e \u53EF\u91CD\u5165\u9501\n    \u53EF\u91CD\u5165\u6027 --\x3e \u4E0D\u53EF\u91CD\u5165\u9501\n    Java\u9501 --\x3e \u8BFB\u5199\u7279\u6027\n    \u8BFB\u5199\u7279\u6027 --\x3e \u72EC\u5360\u9501\n    \u8BFB\u5199\u7279\u6027 --\x3e \u5171\u4EAB\u9501"})]}),"\n",(0,i.jsx)(e.h3,{id:"13-\u9501\u7684\u6027\u80FD\u7279\u6027",children:"1.3 \u9501\u7684\u6027\u80FD\u7279\u6027"}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"comparison",label:"\u9501\u7C7B\u578B\u6027\u80FD\u5BF9\u6BD4",default:!0,children:(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("div",{className:"card__body",children:(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u9501\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u6027\u80FD"}),(0,i.jsx)(e.th,{children:"\u529F\u80FD"}),(0,i.jsx)(e.th,{children:"\u4F7F\u7528\u590D\u6742\u5EA6"}),(0,i.jsx)(e.th,{children:"\u6B7B\u9501\u98CE\u9669"}),(0,i.jsx)(e.th,{children:"\u6D3B\u8DC3\u6027"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"synchronized"})}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u57FA\u7840\u529F\u80FD"}),(0,i.jsx)(e.td,{children:"\u7B80\u5355"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u4E0D\u53EF\u4E2D\u65AD"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ReentrantLock"})}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E30\u5BCC"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u4F4E\uFF08\u53EF\u8D85\u65F6\uFF09"}),(0,i.jsx)(e.td,{children:"\u53EF\u4E2D\u65AD"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"ReadWriteLock"})}),(0,i.jsx)(e.td,{children:"\u8BFB\u591A\u5199\u5C11\u573A\u666F\u9AD8"}),(0,i.jsx)(e.td,{children:"\u5206\u79BB\u8BFB\u5199"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u53EF\u4E2D\u65AD"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"StampedLock"})}),(0,i.jsx)(e.td,{children:"\u975E\u5E38\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E50\u89C2\u8BFB"}),(0,i.jsx)(e.td,{children:"\u590D\u6742"}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4E50\u89C2\u9501(CAS)"})}),(0,i.jsx)(e.td,{children:"\u4F4E\u7ADE\u4E89\u4E0B\u9AD8"}),(0,i.jsx)(e.td,{children:"\u65E0\u963B\u585E"}),(0,i.jsx)(e.td,{children:"\u590D\u6742"}),(0,i.jsx)(e.td,{children:"\u65E0"}),(0,i.jsx)(e.td,{children:"\u9AD8"})]})]})]})})})}),(0,i.jsx)(a.A,{value:"metrics",label:"\u5173\u952E\u6027\u80FD\u6307\u6807",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u9501\u7684\u6027\u80FD\u8861\u91CF\u6307\u6807\uFF1A"})}),(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u7ADE\u4E89\u5F00\u9500"}),"\uFF1A\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BF7\u6C42\u9501\u65F6\u7684\u6027\u80FD\u635F\u5931"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u6301\u6709\u65F6\u95F4"}),"\uFF1A\u83B7\u53D6\u9501\u5230\u91CA\u653E\u9501\u7684\u5E73\u5747\u65F6\u95F4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7B49\u5F85\u961F\u5217\u957F\u5EA6"}),"\uFF1A\u7B49\u5F85\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u6570\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4E0A\u4E0B\u6587\u5207\u6362\u6B21\u6570"}),"\uFF1A\u7EBF\u7A0B\u56E0\u4E3A\u9501\u800C\u88AB\u6302\u8D77\u548C\u6062\u590D\u7684\u6B21\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u5F00\u9500"}),"\uFF1A\u9501\u673A\u5236\u6240\u9700\u7684\u5185\u5B58\u7A7A\u95F4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"CPU\u5229\u7528\u7387"}),"\uFF1A\u9501\u5B9E\u73B0\u673A\u5236\u5BF9CPU\u7684\u4F7F\u7528\u7387"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u53EF\u4F38\u7F29\u6027"}),"\uFF1A\u968F\u7740\u7EBF\u7A0B\u6570\u589E\u52A0\uFF0C\u6027\u80FD\u7684\u53D8\u5316\u8D8B\u52BF"]}),"\n"]})]})})}),(0,i.jsx)(a.A,{value:"scenarios",label:"\u6700\u4F73\u573A\u666F",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("div",{className:"card__body",children:(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u573A\u666F"}),(0,i.jsx)(e.th,{children:"\u63A8\u8350\u9501"}),(0,i.jsx)(e.th,{children:"\u539F\u56E0"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u7B80\u5355\u540C\u6B65"})}),(0,i.jsx)(e.td,{children:"synchronized"}),(0,i.jsx)(e.td,{children:"\u7B80\u5355\u6613\u7528\uFF0C\u81EA\u52A8\u7BA1\u7406"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u9700\u8981\u4E2D\u65AD/\u8D85\u65F6"})}),(0,i.jsx)(e.td,{children:"ReentrantLock"}),(0,i.jsx)(e.td,{children:"\u652F\u6301lockInterruptibly()\u548CtryLock()"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u8BFB\u591A\u5199\u5C11"})}),(0,i.jsx)(e.td,{children:"ReadWriteLock"}),(0,i.jsx)(e.td,{children:"\u5141\u8BB8\u5E76\u53D1\u8BFB\uFF0C\u63D0\u9AD8\u541E\u5410\u91CF"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u9AD8\u6027\u80FD\u8BFB\u573A\u666F"})}),(0,i.jsx)(e.td,{children:"StampedLock"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\u4E50\u89C2\u8BFB\uFF0C\u65E0\u9501\u8BBF\u95EE"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4F4E\u7ADE\u4E89\u73AF\u5883"})}),(0,i.jsx)(e.td,{children:"CAS\u64CD\u4F5C"}),(0,i.jsx)(e.td,{children:"\u907F\u514D\u7EBF\u7A0B\u963B\u585E\uFF0C\u6027\u80FD\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u6027\u8981\u6C42"})}),(0,i.jsx)(e.td,{children:"ReentrantLock(true)"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\u516C\u5E73\u8C03\u5EA6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u53EF\u4E2D\u65AD\u4EFB\u52A1"})}),(0,i.jsx)(e.td,{children:"ReentrantLock"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\u4E2D\u65AD\u7B49\u5F85"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u9012\u5F52\u8C03\u7528"})}),(0,i.jsx)(e.td,{children:"synchronized/ReentrantLock"}),(0,i.jsx)(e.td,{children:"\u652F\u6301\u91CD\u5165"})]})]})]})})})})]}),"\n",(0,i.jsx)(e.h2,{id:"2-synchronized-\u5173\u952E\u5B57",children:"2. synchronized \u5173\u952E\u5B57"}),"\n",(0,i.jsx)(e.h3,{id:"21-synchronized-\u57FA\u672C\u7528\u6CD5",children:"2.1 synchronized \u57FA\u672C\u7528\u6CD5"}),"\n",(0,i.jsx)(e.mermaid,{value:"graph TD\n    A[synchronized\u5E94\u7528\u65B9\u5F0F] --\x3e B[\u5B9E\u4F8B\u65B9\u6CD5\u540C\u6B65]\n    A --\x3e C[\u9759\u6001\u65B9\u6CD5\u540C\u6B65]\n    A --\x3e D[\u4EE3\u7801\u5757\u540C\u6B65]\n    \n    B --\x3e|\u9501\u5BF9\u8C61| B1[\u5F53\u524D\u5BF9\u8C61this]\n    C --\x3e|\u9501\u5BF9\u8C61| C1[\u7C7B\u5BF9\u8C61ClassName.class]\n    D --\x3e|\u9501\u5BF9\u8C61| D1[\u6307\u5B9A\u7684\u5BF9\u8C61]\n    \n    B1 --\x3e E[\u591A\u7EBF\u7A0B\u8BBF\u95EE<br>\u540C\u4E00\u5B9E\u4F8B\u7684\u540C\u6B65\u65B9\u6CD5]\n    C1 --\x3e F[\u591A\u7EBF\u7A0B\u8BBF\u95EE<br>\u540C\u4E00\u7C7B\u7684\u9759\u6001\u540C\u6B65\u65B9\u6CD5]\n    D1 --\x3e G[\u7CBE\u786E\u63A7\u5236<br>\u540C\u6B65\u8303\u56F4]"}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"instance_method",label:"\u5B9E\u4F8B\u65B9\u6CD5\u540C\u6B65",default:!0,children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Counter {\n    private int count = 0;\n    \n    // \u5B9E\u4F8B\u65B9\u6CD5\u540C\u6B65 - \u9501\u662F\u5F53\u524D\u5B9E\u4F8B(this)\n    public synchronized void increment() {\n        count++;\n    }\n    \n    public synchronized int getCount() {\n        return count;\n    }\n}\n\n// \u4F7F\u7528\u65B9\u5F0F\nCounter counter = new Counter();\n// \u591A\u4E2A\u7EBF\u7A0B\u8C03\u7528\u540C\u4E00\u5B9E\u4F8B\u7684\u65B9\u6CD5\ncounter.increment(); // \u7EBF\u7A0B\u5B89\u5168\n\n// \u6CE8\u610F: \u4E0D\u540C\u5B9E\u4F8B\u4E4B\u95F4\u7684\u65B9\u6CD5\u8C03\u7528\u4E0D\u53D7\u5F71\u54CD\nCounter counter1 = new Counter();\nCounter counter2 = new Counter();\n// \u8FD9\u4E24\u4E2A\u8C03\u7528\u53EF\u4EE5\u5E76\u53D1\u6267\u884C\uFF0C\u4E92\u4E0D\u5E72\u6270\ncounter1.increment();\ncounter2.increment();\n"})})}),(0,i.jsx)(a.A,{value:"static_method",label:"\u9759\u6001\u65B9\u6CD5\u540C\u6B65",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class StaticCounter {\n    private static int count = 0;\n    \n    // \u9759\u6001\u65B9\u6CD5\u540C\u6B65 - \u9501\u662F\u7C7B\u5BF9\u8C61(StaticCounter.class)\n    public static synchronized void increment() {\n        count++;\n    }\n    \n    public static synchronized int getCount() {\n        return count;\n    }\n}\n\n// \u4F7F\u7528\u65B9\u5F0F\n// \u591A\u4E2A\u7EBF\u7A0B\u8C03\u7528\u540C\u4E00\u4E2A\u7C7B\u7684\u9759\u6001\u65B9\u6CD5\nStaticCounter.increment(); // \u7EBF\u7A0B\u5B89\u5168\n\n// \u6CE8\u610F: \u6240\u6709\u7EBF\u7A0B\u90FD\u4F1A\u7ADE\u4E89\u540C\u4E00\u4E2A\u9501(\u7C7B\u9501)\uFF0C\n// \u5373\u4F7F\u662F\u4E0D\u540C\u5B9E\u4F8B\u7684\u8C03\u7528\u4E5F\u4F1A\u76F8\u4E92\u5F71\u54CD\nnew Thread(() -> StaticCounter.increment()).start();\nnew Thread(() -> StaticCounter.increment()).start();\n"})})}),(0,i.jsx)(a.A,{value:"synchronized_block",label:"\u4EE3\u7801\u5757\u540C\u6B65",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class BlockSynchronization {\n    private int count = 0;\n    private final Object lock = new Object(); // \u663E\u5F0F\u9501\u5BF9\u8C61\n    \n    public void increment() {\n        // \u53EA\u540C\u6B65\u5173\u952E\u4EE3\u7801\u5757\uFF0C\u4F7F\u7528\u81EA\u5B9A\u4E49\u9501\u5BF9\u8C61\n        synchronized (lock) {\n            count++;\n        }\n        \n        // \u8FD9\u91CC\u662F\u975E\u540C\u6B65\u4EE3\u7801\n        System.out.println("Current count: " + count);\n    }\n    \n    public void otherMethod() {\n        // \u4F7F\u7528this\u4F5C\u4E3A\u9501\u5BF9\u8C61\n        synchronized (this) {\n            // \u8FD9\u91CC\u7684\u540C\u6B65\u4E0Esynchronized\u5B9E\u4F8B\u65B9\u6CD5\u6548\u679C\u76F8\u540C\n            System.out.println("Using this as lock");\n        }\n        \n        // \u4F7F\u7528\u7C7B\u5BF9\u8C61\u4F5C\u4E3A\u9501\n        synchronized (BlockSynchronization.class) {\n            // \u8FD9\u91CC\u7684\u540C\u6B65\u4E0Esynchronized\u9759\u6001\u65B9\u6CD5\u6548\u679C\u76F8\u540C\n            System.out.println("Using class object as lock");\n        }\n    }\n    \n    // \u7279\u5B9A\u5BF9\u8C61\u9501\u7684\u4F18\u70B9\n    // 1. \u66F4\u7EC6\u7C92\u5EA6\u7684\u9501\u63A7\u5236\n    // 2. \u907F\u514D\u9501\u5B9A\u6574\u4E2A\u5BF9\u8C61\n    // 3. \u53EF\u4EE5\u4F7F\u7528\u591A\u4E2A\u4E0D\u540C\u7684\u9501\u5BF9\u8C61\u63A7\u5236\u4E0D\u540C\u7684\u8D44\u6E90\n    \n    private final Object resourceALock = new Object();\n    private final Object resourceBLock = new Object();\n    \n    public void updateResourceA() {\n        synchronized (resourceALock) {\n            // \u66F4\u65B0\u8D44\u6E90A\n        }\n    }\n    \n    public void updateResourceB() {\n        synchronized (resourceBLock) {\n            // \u66F4\u65B0\u8D44\u6E90B\n        }\n    }\n    // \u8D44\u6E90A\u548CB\u53EF\u4EE5\u5E76\u53D1\u8BBF\u95EE\uFF0C\u4E92\u4E0D\u5F71\u54CD\n}\n'})})}),(0,i.jsx)(a.A,{value:"double_check",label:"\u53CC\u91CD\u68C0\u67E5\u9501\u5B9A",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class Singleton {\n    // volatile\u786E\u4FDD\u591A\u7EBF\u7A0B\u53EF\u89C1\u6027\u548C\u9632\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\n    private volatile static Singleton instance;\n    \n    private Singleton() {}\n    \n    public static Singleton getInstance() {\n        // \u7B2C\u4E00\u6B21\u68C0\u67E5 - \u4E0D\u9700\u8981\u540C\u6B65\n        if (instance == null) {\n            // \u540C\u6B65\u5757 - \u53EA\u6709\u9700\u8981\u521B\u5EFA\u5B9E\u4F8B\u65F6\u624D\u540C\u6B65\n            synchronized (Singleton.class) {\n                // \u7B2C\u4E8C\u6B21\u68C0\u67E5 - \u9632\u6B62\u591A\u4E2A\u7EBF\u7A0B\u90FD\u901A\u8FC7\u4E86\u7B2C\u4E00\u6B21\u68C0\u67E5\n                if (instance == null) {\n                    instance = new Singleton();\n                }\n            }\n        }\n        return instance;\n    }\n    \n    /* \n     * \u4E3A\u4EC0\u4E48\u9700\u8981volatile?\n     * \u9632\u6B62\u6307\u4EE4\u91CD\u6392\u5E8F\u5BFC\u81F4\u7684\u90E8\u5206\u521D\u59CB\u5316\u5BF9\u8C61\u95EE\u9898:\n     * 1. \u5206\u914D\u5185\u5B58\u7A7A\u95F4\n     * 2. \u521D\u59CB\u5316\u5BF9\u8C61\n     * 3. \u5C06\u5F15\u7528\u6307\u5411\u5185\u5B58\u7A7A\u95F4\n     * \n     * \u5982\u679C\u53D1\u751F2\u548C3\u7684\u91CD\u6392\u5E8F\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u53EF\u80FD\u4F1A\u770B\u5230\u4E00\u4E2A\u672A\u5B8C\u5168\u521D\u59CB\u5316\u7684\u5BF9\u8C61\n     */\n}\n"})})})]}),"\n",(0,i.jsx)(e.h3,{id:"22-synchronized-\u7684\u7279\u6027",children:"2.2 synchronized \u7684\u7279\u6027"}),"\n",(0,i.jsx)(e.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e \u83B7\u53D6\u9501\n    \u83B7\u53D6\u9501 --\x3e \u6267\u884C\u540C\u6B65\u4EE3\u7801\n    \u6267\u884C\u540C\u6B65\u4EE3\u7801 --\x3e \u91CA\u653E\u9501: \u6B63\u5E38\u6267\u884C\u5B8C\u6210\n    \u6267\u884C\u540C\u6B65\u4EE3\u7801 --\x3e \u91CA\u653E\u9501: \u629B\u51FA\u5F02\u5E38\n    \u91CA\u653E\u9501 --\x3e [*]\n    \n    note right of \u83B7\u53D6\u9501: \u540C\u4E00\u7EBF\u7A0B\u53EF\u91CD\u5165\n    note left of \u91CA\u653E\u9501: \u81EA\u52A8\u91CA\u653E\uFF0C\u4E0D\u9700\u8981\u663E\u5F0F\u5904\u7406"}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"reentrant",label:"\u53EF\u91CD\u5165\u6027",default:!0,children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u53EF\u91CD\u5165\u6027\uFF08Reentrancy\uFF09\u662F\u6307\u540C\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u591A\u6B21\u83B7\u53D6\u540C\u4E00\u628A\u9501\u3002"})}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class ReentrantExample {\n    // \u53EF\u91CD\u5165\u6027\u793A\u4F8B\n    public synchronized void outer() {\n        System.out.println("Entering outer method");\n        // \u540C\u4E00\u7EBF\u7A0B\u53EF\u4EE5\u518D\u6B21\u83B7\u53D6\u76F8\u540C\u7684\u9501\n        inner();\n        System.out.println("Exiting outer method");\n    }\n    \n    public synchronized void inner() {\n        System.out.println("Executing inner method");\n    }\n}\n\n// \u6267\u884C\u7ED3\u679C:\n// Entering outer method\n// Executing inner method  <-- \u53EF\u4EE5\u91CD\u5165\u83B7\u53D6\u9501\n// Exiting outer method\n'})})]})})}),(0,i.jsx)(a.A,{value:"auto_release",label:"\u81EA\u52A8\u91CA\u653E",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"synchronized \u4F1A\u5728\u4EE5\u4E0B\u60C5\u51B5\u81EA\u52A8\u91CA\u653E\u9501:"})}),(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u540C\u6B65\u4EE3\u7801\u5757\u6267\u884C\u5B8C\u6210"}),"\n",(0,i.jsx)(e.li,{children:"\u540C\u6B65\u65B9\u6CD5\u8FD4\u56DE"}),"\n",(0,i.jsx)(e.li,{children:"\u540C\u6B65\u4EE3\u7801\u5757/\u65B9\u6CD5\u4E2D\u629B\u51FA\u672A\u6355\u83B7\u7684\u5F02\u5E38"}),"\n"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public synchronized void safeMethod() {\n    try {\n        // \u53EF\u80FD\u629B\u51FA\u5F02\u5E38\u7684\u4EE3\u7801\n        if (Math.random() < 0.5) {\n            throw new RuntimeException("\u793A\u4F8B\u5F02\u5E38");\n        }\n        System.out.println("\u64CD\u4F5C\u6210\u529F");\n    } catch (Exception e) {\n        System.out.println("\u6355\u83B7\u5230\u5F02\u5E38: " + e.getMessage());\n        // \u5373\u4F7F\u629B\u51FA\u5F02\u5E38\uFF0C\u9501\u4E5F\u4F1A\u88AB\u6B63\u786E\u91CA\u653E\n    }\n    // \u65E0\u9700\u624B\u52A8\u91CA\u653E\u9501\n}\n'})})]})})}),(0,i.jsx)(a.A,{value:"memory",label:"\u5185\u5B58\u53EF\u89C1\u6027",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"synchronized \u4FDD\u8BC1\u4E86\u5185\u5B58\u53EF\u89C1\u6027\uFF0C\u786E\u4FDD\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u4FEE\u6539\u5BF9\u5176\u4ED6\u7EBF\u7A0B\u53EF\u89C1\u3002"})}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'public class MemoryVisibility {\n    private int counter = 0;\n    private boolean flag = false;\n    \n    public synchronized void write() {\n        counter = 42;\n        flag = true;\n        // \u9000\u51FA\u540C\u6B65\u5757\u65F6\uFF0C\u4FEE\u6539\u4F1A\u5237\u65B0\u5230\u4E3B\u5185\u5B58\n    }\n    \n    public synchronized void read() {\n        // \u8FDB\u5165\u540C\u6B65\u5757\u65F6\uFF0C\u4F1A\u4ECE\u4E3B\u5185\u5B58\u8BFB\u53D6\u6700\u65B0\u503C\n        if (flag) {\n            // \u4E00\u5B9A\u80FD\u770B\u5230counter\u7684\u6700\u65B0\u503C(42)\n            System.out.println("Counter: " + counter);\n        }\n    }\n}\n'})}),(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u5DE5\u4F5C\u539F\u7406:"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u83B7\u53D6\u9501\u65F6\uFF0C\u6E05\u7A7A\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u5171\u4EAB\u53D8\u91CF\uFF0C\u4ECE\u4E3B\u5185\u5B58\u91CD\u65B0\u52A0\u8F7D"}),"\n",(0,i.jsx)(e.li,{children:"\u91CA\u653E\u9501\u65F6\uFF0C\u5C06\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u4FEE\u6539\u5237\u65B0\u5230\u4E3B\u5185\u5B58"}),"\n"]})]})})}),(0,i.jsx)(a.A,{value:"atomicity",label:"\u539F\u5B50\u6027",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"synchronized \u786E\u4FDD\u4E86\u591A\u4E2A\u64CD\u4F5C\u4F5C\u4E3A\u4E00\u4E2A\u539F\u5B50\u5355\u5143\u6267\u884C\uFF0C\u4E0D\u4F1A\u88AB\u5176\u4ED6\u7EBF\u7A0B\u4E2D\u65AD\u3002"})}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"public class AtomicityExample {\n    private int counter = 0;\n    private int total = 0;\n    \n    // \u975E\u539F\u5B50\u64CD\u4F5C\u53D8\u6210\u4E86\u539F\u5B50\u64CD\u4F5C\n    public synchronized void increment() {\n        // counter++ \u5B9E\u9645\u4E0A\u662F\u4E09\u4E2A\u64CD\u4F5C:\n        // 1. \u8BFB\u53D6counter\u7684\u503C\n        // 2. \u52A01\n        // 3. \u5C06\u7ED3\u679C\u5199\u56DEcounter\n        counter++;\n        total += counter;\n        \n        // \u6574\u4E2A\u65B9\u6CD5\u4F5C\u4E3A\u4E00\u4E2A\u539F\u5B50\u5355\u5143\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u65E0\u6CD5\u5728\u4E2D\u95F4\u89C2\u5BDF\u5230\u90E8\u5206\u66F4\u65B0\u7684\u72B6\u6001\n    }\n    \n    public synchronized int[] getValues() {\n        // \u539F\u5B50\u5730\u8FD4\u56DE\u5F53\u524D\u72B6\u6001\u7684\u5FEB\u7167\n        return new int[] { counter, total };\n    }\n}\n"})})]})})})]}),"\n",(0,i.jsx)(e.h3,{id:"23-synchronized-\u7684\u5C40\u9650\u6027",children:"2.3 synchronized \u7684\u5C40\u9650\u6027"}),"\n",(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card__header",children:(0,i.jsx)("h4",{children:"synchronized \u5C40\u9650\u6027\u6982\u89C8"})}),(0,i.jsx)("div",{className:"card__body",children:(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5C40\u9650\u6027"}),(0,i.jsx)(e.th,{children:"\u63CF\u8FF0"}),(0,i.jsx)(e.th,{children:"\u89E3\u51B3\u65B9\u6848"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u6CD5\u4E2D\u65AD\u7B49\u5F85"})}),(0,i.jsx)(e.td,{children:"\u7EBF\u7A0B\u7B49\u5F85\u9501\u65F6\u65E0\u6CD5\u54CD\u5E94\u4E2D\u65AD"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528 ReentrantLock.lockInterruptibly()"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u6CD5\u8BBE\u7F6E\u8D85\u65F6"})}),(0,i.jsx)(e.td,{children:"\u65E0\u6CD5\u8BBE\u7F6E\u83B7\u53D6\u9501\u7684\u8D85\u65F6\u65F6\u95F4"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528 ReentrantLock.tryLock(time, unit)"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u6CD5\u5B9E\u73B0\u516C\u5E73\u6027"})}),(0,i.jsx)(e.td,{children:"\u65E0\u6CD5\u4FDD\u8BC1FIFO\u987A\u5E8F"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528 ReentrantLock(true) \u521B\u5EFA\u516C\u5E73\u9501"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u6CD5\u5B9E\u73B0\u8BFB\u5199\u5206\u79BB"})}),(0,i.jsx)(e.td,{children:"\u65E0\u6CD5\u8BA9\u591A\u4E2A\u8BFB\u7EBF\u7A0B\u5E76\u884C\u8BBF\u95EE"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528 ReadWriteLock \u8BFB\u5199\u9501"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u65E0\u6CD5\u77E5\u9053\u9501\u72B6\u6001"})}),(0,i.jsx)(e.td,{children:"\u65E0\u6CD5\u67E5\u8BE2\u9501\u662F\u5426\u88AB\u5360\u7528"}),(0,i.jsx)(e.td,{children:"\u4F7F\u7528 Lock \u63A5\u53E3\u7684\u76F8\u5173\u65B9\u6CD5"})]})]})]})})]}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"non_interruptible",label:"\u65E0\u6CD5\u4E2D\u65AD\u7B49\u5F85",default:!0,children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class InterruptionExample {\n    private final Object syncLock = new Object();\n    private final Lock interruptibleLock = new ReentrantLock();\n    \n    public void synchronizedMethod() {\n        // synchronized \u4E0D\u54CD\u5E94\u4E2D\u65AD\n        synchronized (syncLock) {\n            try {\n                System.out.println("\u83B7\u53D6synchronized\u9501");\n                Thread.sleep(10000); // \u6301\u6709\u950110\u79D2\n            } catch (InterruptedException e) {\n                System.out.println("\u5373\u4F7F\u7EBF\u7A0B\u88AB\u4E2D\u65AD\uFF0Csynchronized\u4E5F\u4F1A\u7EE7\u7EED\u6267\u884C\u5230\u5B8C\u6210");\n                Thread.currentThread().interrupt();\n            }\n        }\n    }\n    \n    public void interruptibleMethod() {\n        try {\n            // ReentrantLock \u53EF\u4EE5\u54CD\u5E94\u4E2D\u65AD\n            interruptibleLock.lockInterruptibly();\n            try {\n                System.out.println("\u83B7\u53D6\u53EF\u4E2D\u65AD\u9501");\n                Thread.sleep(10000); // \u5C1D\u8BD5\u6301\u6709\u950110\u79D2\n            } finally {\n                interruptibleLock.unlock();\n            }\n        } catch (InterruptedException e) {\n            System.out.println("\u9501\u7B49\u5F85\u88AB\u4E2D\u65AD\uFF0C\u53EF\u4EE5\u6267\u884C\u5176\u4ED6\u64CD\u4F5C");\n        }\n    }\n    \n    public static void main(String[] args) throws InterruptedException {\n        InterruptionExample example = new InterruptionExample();\n        \n        // \u5148\u5360\u7528\u9501\n        Thread blocker = new Thread(() -> {\n            example.synchronizedMethod();\n        });\n        blocker.start();\n        Thread.sleep(100); // \u786E\u4FDDblocker\u83B7\u5F97\u9501\n        \n        // \u5C1D\u8BD5\u83B7\u53D6\u9501\u5E76\u4E2D\u65AD\n        Thread waiter = new Thread(() -> {\n            try {\n                System.out.println("\u7B49\u5F85\u9501...");\n                example.synchronizedMethod(); // \u8FD9\u91CC\u4F1A\u88AB\u963B\u585E\n            } finally {\n                System.out.println("waiter\u7EBF\u7A0B\u7ED3\u675F");\n            }\n        });\n        \n        waiter.start();\n        Thread.sleep(1000); // \u8BA9waiter\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\n        \n        System.out.println("\u5C1D\u8BD5\u4E2D\u65ADwaiter\u7EBF\u7A0B");\n        waiter.interrupt(); // \u4E2D\u65ADwaiter\u7EBF\u7A0B\n        \n        // \u6CE8\u610F: waiter\u7EBF\u7A0B\u4F1A\u4E00\u76F4\u7B49\u5F85\uFF0C\u76F4\u5230blocker\u91CA\u653E\u9501\n        // synchronized\u4E0D\u54CD\u5E94\u4E2D\u65AD\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"no_timeout",label:"\u65E0\u6CD5\u8BBE\u7F6E\u8D85\u65F6",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.TimeUnit;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class TimeoutExample {\n    private final Object syncLock = new Object();\n    private final Lock timeoutLock = new ReentrantLock();\n    \n    public void synchronizedMethod() {\n        // synchronized \u65E0\u6CD5\u8BBE\u7F6E\u8D85\u65F6\n        synchronized (syncLock) {\n            System.out.println("\u83B7\u53D6synchronized\u9501");\n            sleep(5000); // \u6301\u6709\u95015\u79D2\n        }\n    }\n    \n    public boolean timeoutMethod(long timeout) {\n        try {\n            // ReentrantLock \u652F\u6301\u8D85\u65F6\u83B7\u53D6\u9501\n            if (timeoutLock.tryLock(timeout, TimeUnit.MILLISECONDS)) {\n                try {\n                    System.out.println("\u5728\u8D85\u65F6\u65F6\u95F4\u5185\u83B7\u53D6\u5230\u9501");\n                    return true;\n                } finally {\n                    timeoutLock.unlock();\n                }\n            } else {\n                System.out.println("\u83B7\u53D6\u9501\u8D85\u65F6");\n                return false;\n            }\n        } catch (InterruptedException e) {\n            System.out.println("\u7B49\u5F85\u9501\u65F6\u88AB\u4E2D\u65AD");\n            return false;\n        }\n    }\n    \n    private void sleep(long millis) {\n        try {\n            Thread.sleep(millis);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"no_fairness",label:"\u65E0\u6CD5\u5B9E\u73B0\u516C\u5E73\u6027",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class FairnessExample {\n    // synchronized \u65E0\u6CD5\u8BBE\u7F6E\u516C\u5E73\u6027\n    private final Object syncLock = new Object();\n    \n    // ReentrantLock \u53EF\u4EE5\u521B\u5EFA\u516C\u5E73\u9501\n    private final Lock fairLock = new ReentrantLock(true);\n    private final Lock unfairLock = new ReentrantLock(false);\n    \n    public void testFairness() {\n        // \u521B\u5EFA\u591A\u4E2A\u7EBF\u7A0B\u7ADE\u4E89\u9501\n        for (int i = 0; i < 5; i++) {\n            final int threadId = i;\n            new Thread(() -> {\n                for (int j = 0; j < 3; j++) {\n                    // \u4F7F\u7528\u516C\u5E73\u9501\n                    fairLock.lock();\n                    try {\n                        System.out.println("\u7EBF\u7A0B " + threadId + \n                            " \u83B7\u53D6\u516C\u5E73\u9501\uFF0C\u5C1D\u8BD5\u6B21\u6570 " + j);\n                        sleep(100);\n                    } finally {\n                        fairLock.unlock();\n                    }\n                }\n            }).start();\n        }\n    }\n    \n    // \u516C\u5E73\u9501\u4E0E\u975E\u516C\u5E73\u9501\u7684\u533A\u522B:\n    // 1. \u516C\u5E73\u9501: \u6309\u7167FIFO\u987A\u5E8F\u83B7\u53D6\u9501\uFF0C\u7B49\u5F85\u65F6\u95F4\u6700\u957F\u7684\u7EBF\u7A0B\u4F18\u5148\u83B7\u53D6\n    // 2. \u975E\u516C\u5E73\u9501: \u5141\u8BB8"\u63D2\u961F"\uFF0C\u65B0\u5230\u8FBE\u7684\u7EBF\u7A0B\u53EF\u80FD\u6BD4\u7B49\u5F85\u4E2D\u7684\u7EBF\u7A0B\u5148\u83B7\u53D6\u9501\n    // 3. synchronized \u9ED8\u8BA4\u662F\u975E\u516C\u5E73\u7684\uFF0C\u4E14\u65E0\u6CD5\u914D\u7F6E\u4E3A\u516C\u5E73\u6A21\u5F0F\n    \n    private void sleep(long millis) {\n        try {\n            Thread.sleep(millis);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h2,{id:"3-lock-\u63A5\u53E3",children:"3. Lock \u63A5\u53E3"}),"\n",(0,i.jsx)(e.h3,{id:"31-lock-\u63A5\u53E3\u57FA\u672C\u7528\u6CD5",children:"3.1 Lock \u63A5\u53E3\u57FA\u672C\u7528\u6CD5"}),"\n",(0,i.jsx)(e.mermaid,{value:"classDiagram\n    class Lock {\n        <<interface>>\n        +lock() void\n        +lockInterruptibly() void\n        +tryLock() boolean\n        +tryLock(long, TimeUnit) boolean\n        +unlock() void\n        +newCondition() Condition\n    }\n    \n    class ReentrantLock {\n        -sync AbstractQueuedSynchronizer\n        +ReentrantLock()\n        +ReentrantLock(boolean fair)\n        +isHeldByCurrentThread() boolean\n        +getHoldCount() int\n        +isLocked() boolean\n        +isFair() boolean\n        +hasQueuedThreads() boolean\n        +getQueueLength() int\n    }\n    \n    Lock <|-- ReentrantLock"}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"basic_lock",label:"\u57FA\u672C\u7528\u6CD5",default:!0,children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class LockBasicExample {\n    private final Lock lock = new ReentrantLock();\n    private int counter = 0;\n    \n    public void increment() {\n        // \u83B7\u53D6\u9501\n        lock.lock();\n        try {\n            // \u4E34\u754C\u533A - \u53D7\u9501\u4FDD\u62A4\u7684\u4EE3\u7801\n            counter++;\n        } finally {\n            // \u5FC5\u987B\u5728finally\u5757\u4E2D\u91CA\u653E\u9501\n            lock.unlock();\n        }\n    }\n    \n    public int getCount() {\n        lock.lock();\n        try {\n            return counter;\n        } finally {\n            lock.unlock();\n        }\n    }\n    \n    public static void main(String[] args) {\n        LockBasicExample example = new LockBasicExample();\n        \n        // \u521B\u5EFA\u591A\u4E2A\u7EBF\u7A0B\u5E76\u53D1\u589E\u52A0\u8BA1\u6570\u5668\n        for (int i = 0; i < 10; i++) {\n            new Thread(() -> {\n                for (int j = 0; j < 1000; j++) {\n                    example.increment();\n                }\n            }).start();\n        }\n        \n        // \u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u540E\u67E5\u770B\u7ED3\u679C\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        System.out.println("\u8BA1\u6570\u5668\u6700\u7EC8\u503C: " + example.getCount());\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"interruptible_lock",label:"\u53EF\u4E2D\u65AD\u9501",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class InterruptibleLockExample {\n    private final Lock lock = new ReentrantLock();\n    \n    public void methodWithInterruptibleLock() {\n        System.out.println(Thread.currentThread().getName() + " \u5C1D\u8BD5\u83B7\u53D6\u9501");\n        \n        try {\n            // \u53EF\u4E2D\u65AD\u7684\u83B7\u53D6\u9501\uFF0C\u5141\u8BB8\u54CD\u5E94\u4E2D\u65AD\n            lock.lockInterruptibly();\n            try {\n                System.out.println(Thread.currentThread().getName() + " \u83B7\u53D6\u5230\u9501");\n                // \u6A21\u62DF\u957F\u65F6\u95F4\u64CD\u4F5C\n                Thread.sleep(5000);\n            } finally {\n                lock.unlock();\n                System.out.println(Thread.currentThread().getName() + " \u91CA\u653E\u4E86\u9501");\n            }\n        } catch (InterruptedException e) {\n            System.out.println(Thread.currentThread().getName() + " \u5728\u7B49\u5F85\u9501\u7684\u8FC7\u7A0B\u4E2D\u88AB\u4E2D\u65AD");\n        }\n    }\n    \n    public static void main(String[] args) throws InterruptedException {\n        InterruptibleLockExample example = new InterruptibleLockExample();\n        \n        // \u7EBF\u7A0B1\u5148\u83B7\u53D6\u9501\n        Thread t1 = new Thread(example::methodWithInterruptibleLock, "Thread-1");\n        t1.start();\n        Thread.sleep(100); // \u786E\u4FDD\u7EBF\u7A0B1\u83B7\u53D6\u5230\u9501\n        \n        // \u7EBF\u7A0B2\u5C1D\u8BD5\u83B7\u53D6\u5DF2\u7ECF\u88AB\u5360\u7528\u7684\u9501\n        Thread t2 = new Thread(example::methodWithInterruptibleLock, "Thread-2");\n        t2.start();\n        Thread.sleep(1000); // \u8BA9\u7EBF\u7A0B2\u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\n        \n        // \u4E2D\u65AD\u7EBF\u7A0B2\n        System.out.println("\u4E3B\u7EBF\u7A0B\u4E2D\u65AD Thread-2");\n        t2.interrupt();\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"timeout_lock",label:"\u8D85\u65F6\u9501",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.TimeUnit;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class TimeoutLockExample {\n    private final Lock lock = new ReentrantLock();\n    \n    public void methodWithTimeout(long timeout, TimeUnit unit) {\n        System.out.println(Thread.currentThread().getName() + \n            " \u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C\u8D85\u65F6\u65F6\u95F4: " + timeout + " " + unit);\n        \n        try {\n            // \u5C1D\u8BD5\u5728\u6307\u5B9A\u65F6\u95F4\u5185\u83B7\u53D6\u9501\n            boolean acquired = lock.tryLock(timeout, unit);\n            if (acquired) {\n                try {\n                    System.out.println(Thread.currentThread().getName() + " \u83B7\u53D6\u5230\u9501");\n                    // \u6A21\u62DF\u64CD\u4F5C\n                    Thread.sleep(unit.toMillis(timeout / 2));\n                } finally {\n                    lock.unlock();\n                    System.out.println(Thread.currentThread().getName() + " \u91CA\u653E\u4E86\u9501");\n                }\n            } else {\n                System.out.println(Thread.currentThread().getName() + " \u83B7\u53D6\u9501\u8D85\u65F6");\n                // \u6267\u884C\u66FF\u4EE3\u903B\u8F91\n                performAlternativeAction();\n            }\n        } catch (InterruptedException e) {\n            System.out.println(Thread.currentThread().getName() + " \u88AB\u4E2D\u65AD");\n        }\n    }\n    \n    private void performAlternativeAction() {\n        System.out.println(Thread.currentThread().getName() + " \u6267\u884C\u66FF\u4EE3\u64CD\u4F5C");\n    }\n    \n    public static void main(String[] args) throws InterruptedException {\n        TimeoutLockExample example = new TimeoutLockExample();\n        \n        // \u7EBF\u7A0B1\u83B7\u53D6\u9501\u5E76\u957F\u65F6\u95F4\u6301\u6709\n        Thread t1 = new Thread(() -> {\n            example.methodWithTimeout(10, TimeUnit.SECONDS);\n        }, "Thread-1");\n        \n        // \u7EBF\u7A0B2\u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C\u4F46\u8BBE\u7F6E\u8F83\u77ED\u7684\u8D85\u65F6\u65F6\u95F4\n        Thread t2 = new Thread(() -> {\n            example.methodWithTimeout(2, TimeUnit.SECONDS);\n        }, "Thread-2");\n        \n        t1.start();\n        Thread.sleep(100); // \u786E\u4FDD\u7EBF\u7A0B1\u83B7\u53D6\u5230\u9501\n        t2.start(); // \u7EBF\u7A0B2\u5C1D\u8BD5\u83B7\u53D6\u9501\u4F46\u4F1A\u8D85\u65F6\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"fair_lock",label:"\u516C\u5E73\u9501",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class FairLockExample {\n    // \u521B\u5EFA\u516C\u5E73\u9501 - \u6309\u7167FIFO\u987A\u5E8F\u83B7\u53D6\n    private final Lock fairLock = new ReentrantLock(true);\n    \n    // \u521B\u5EFA\u975E\u516C\u5E73\u9501(\u9ED8\u8BA4) - \u4E0D\u4FDD\u8BC1\u83B7\u53D6\u987A\u5E8F\n    private final Lock unfairLock = new ReentrantLock(false);\n    \n    public void useFairLock(int id) {\n        fairLock.lock();\n        try {\n            System.out.println("\u7EBF\u7A0B " + id + " \u83B7\u53D6\u5230\u516C\u5E73\u9501");\n            // \u77ED\u6682\u6301\u6709\u9501\n            Thread.sleep(100);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            fairLock.unlock();\n        }\n    }\n    \n    public void useUnfairLock(int id) {\n        unfairLock.lock();\n        try {\n            System.out.println("\u7EBF\u7A0B " + id + " \u83B7\u53D6\u5230\u975E\u516C\u5E73\u9501");\n            // \u77ED\u6682\u6301\u6709\u9501\n            Thread.sleep(100);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            unfairLock.unlock();\n        }\n    }\n    \n    // \u516C\u5E73\u9501\u7279\u70B9:\n    // 1. \u6309\u7167\u8BF7\u6C42\u9501\u7684\u987A\u5E8F\u83B7\u5F97\u9501(FIFO)\n    // 2. \u7B49\u5F85\u65F6\u95F4\u957F\u7684\u7EBF\u7A0B\u4F18\u5148\u83B7\u5F97\u9501\n    // 3. \u6027\u80FD\u6BD4\u975E\u516C\u5E73\u9501\u7565\u4F4E\uFF0C\u4F46\u907F\u514D\u4E86"\u9965\u997F"\u95EE\u9898\n}\n'})})})]}),"\n",(0,i.jsx)(e.h3,{id:"32-reentrantlock-\u9AD8\u7EA7\u7279\u6027",children:"3.2 ReentrantLock \u9AD8\u7EA7\u7279\u6027"}),"\n",(0,i.jsx)(e.mermaid,{value:"classDiagram\n    class ReentrantLock {\n        -sync AbstractQueuedSynchronizer\n        +ReentrantLock()\n        +ReentrantLock(boolean fair)\n        +isHeldByCurrentThread() boolean\n        +getHoldCount() int\n        +isLocked() boolean\n        +isFair() boolean\n        +hasQueuedThreads() boolean\n        +getQueueLength() int\n    }\n    \n    class Condition {\n        <<interface>>\n        +await() void\n        +signal() void\n        +signalAll() void\n    }\n    \n    ReentrantLock --\x3e Condition"}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"lock_info",label:"\u83B7\u53D6\u9501\u4FE1\u606F",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class LockInfoExample {\n    private final ReentrantLock lock = new ReentrantLock();\n    \n    public void methodWithInfo() {\n        lock.lock();\n        try {\n            System.out.println("\u5F53\u524D\u7EBF\u7A0B: " + Thread.currentThread().getName());\n            System.out.println("\u6301\u6709\u9501\u7684\u7EBF\u7A0B: " + lock.getOwner());\n            System.out.println("\u7B49\u5F85\u961F\u5217\u957F\u5EA6: " + lock.getQueueLength());\n            System.out.println("\u662F\u5426\u6709\u7EBF\u7A0B\u7B49\u5F85: " + lock.hasQueuedThreads());\n            System.out.println("\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u5728\u7B49\u5F85\u961F\u5217\u4E2D: " + lock.hasQueuedThread(Thread.currentThread()));\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"condition",label:"\u6761\u4EF6\u53D8\u91CF",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\nimport java.util.concurrent.locks.Condition;\n\npublic class ConditionExample {\n    private final ReentrantLock lock = new ReentrantLock();\n    private final Condition condition = lock.newCondition();\n    private boolean flag = false;\n    \n    public void await() {\n        lock.lock();\n        try {\n            while (!flag) {\n                System.out.println("\u7B49\u5F85\u6761\u4EF6\u6EE1\u8DB3");\n                condition.await(); // \u7B49\u5F85\u6761\u4EF6\n            }\n            System.out.println("\u6761\u4EF6\u6EE1\u8DB3\uFF0C\u7EE7\u7EED\u6267\u884C");\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            lock.unlock();\n        }\n    }\n    \n    public void signal() {\n        lock.lock();\n        try {\n            flag = true;\n            System.out.println("\u8BBE\u7F6E\u6761\u4EF6\u5E76\u901A\u77E5");\n            condition.signal(); // \u901A\u77E5\u7B49\u5F85\u7684\u7EBF\u7A0B\n        } finally {\n            lock.unlock();\n        }\n    }\n    \n    public void signalAll() {\n        lock.lock();\n        try {\n            flag = true;\n            System.out.println("\u8BBE\u7F6E\u6761\u4EF6\u5E76\u901A\u77E5\u6240\u6709\u7B49\u5F85\u7EBF\u7A0B");\n            condition.signalAll(); // \u901A\u77E5\u6240\u6709\u7B49\u5F85\u7684\u7EBF\u7A0B\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"multiple_conditions",label:"\u591A\u4E2A\u6761\u4EF6\u53D8\u91CF",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\nimport java.util.concurrent.locks.Condition;\nimport java.util.Queue;\nimport java.util.LinkedList;\n\npublic class MultipleConditionExample {\n    private final ReentrantLock lock = new ReentrantLock();\n    private final Condition notEmpty = lock.newCondition();\n    private final Condition notFull = lock.newCondition();\n    private final int capacity = 10;\n    private int count = 0;\n    private final Queue<String> queue = new LinkedList<>();\n    \n    public void put(String item) {\n        lock.lock();\n        try {\n            while (queue.size() >= capacity) {\n                System.out.println("\u961F\u5217\u5DF2\u6EE1\uFF0C\u7B49\u5F85\u6D88\u8D39");\n                notFull.await();\n            }\n            queue.offer(item);\n            System.out.println("\u751F\u4EA7\u4E00\u4E2A\u5143\u7D20\uFF0C\u5F53\u524D\u6570\u91CF: " + count);\n            notEmpty.signal(); // \u901A\u77E5\u6D88\u8D39\u8005\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            lock.unlock();\n        }\n    }\n    \n    public void take() {\n        lock.lock();\n        try {\n            while (queue.isEmpty()) {\n                System.out.println("\u961F\u5217\u4E3A\u7A7A\uFF0C\u7B49\u5F85\u751F\u4EA7");\n                notEmpty.await(); // \u7B49\u5F85\u800C\u4E0D\u662F\u5FD9\u7B49\u5F85\n            }\n            String item = queue.poll();\n            System.out.println("\u6D88\u8D39\u4E00\u4E2A\u5143\u7D20\uFF0C\u5F53\u524D\u6570\u91CF: " + count);\n            notFull.signal(); // \u901A\u77E5\u751F\u4EA7\u8005\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h2,{id:"4-\u8BFB\u5199\u9501-readwritelock",children:"4. \u8BFB\u5199\u9501 (ReadWriteLock)"}),"\n",(0,i.jsx)(e.h3,{id:"41-\u8BFB\u5199\u9501\u57FA\u672C\u7528\u6CD5",children:"4.1 \u8BFB\u5199\u9501\u57FA\u672C\u7528\u6CD5"}),"\n",(0,i.jsx)(e.mermaid,{value:"classDiagram\n    class ReadWriteLock {\n        <<interface>>\n        +readLock() Lock\n        +writeLock() Lock\n    }\n    \n    class ReentrantReadWriteLock {\n        -sync AbstractQueuedSynchronizer\n        -readerLock ReadLock\n        -writerLock WriteLock\n        +ReentrantReadWriteLock()\n        +ReentrantReadWriteLock(boolean fair)\n        +getReadLockCount() int\n        +isWriteLocked() boolean\n        +getWriteHoldCount() int\n        +getReadHoldCount() int\n    }\n    \n    ReadWriteLock <|-- ReentrantReadWriteLock"}),"\n",(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("div",{className:"card__header",children:(0,i.jsx)("h4",{children:"\u8BFB\u5199\u9501\u539F\u7406\u4E0E\u7279\u6027"})}),(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8BFB\u5199\u9501\u5141\u8BB8\u5E76\u53D1\u8BFB\u53D6\u4F46\u4E92\u65A5\u5199\u5165\uFF0C\u9002\u5408\u8BFB\u591A\u5199\u5C11\u573A\u666F\uFF1A"})}),(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8BFB\u9501\u5171\u4EAB"}),"\uFF1A\u591A\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u540C\u65F6\u6301\u6709\u8BFB\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5199\u9501\u72EC\u5360"}),"\uFF1A\u5199\u9501\u662F\u6392\u4ED6\u7684\uFF0C\u4E00\u6B21\u53EA\u80FD\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6301\u6709"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8BFB\u5199\u4E92\u65A5"}),"\uFF1A\u6301\u6709\u5199\u9501\u65F6\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u65E0\u6CD5\u83B7\u53D6\u8BFB\u9501\uFF1B\u6301\u6709\u8BFB\u9501\u65F6\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u65E0\u6CD5\u83B7\u53D6\u5199\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5199\u9501\u4F18\u5148\u7EA7"}),'\uFF1A\u5728\u4E00\u4E9B\u5B9E\u73B0\u4E2D\uFF0C\u5199\u9501\u4F18\u5148\u7EA7\u9AD8\u4E8E\u8BFB\u9501\uFF0C\u9632\u6B62\u5199\u5165\u7EBF\u7A0B"\u9965\u997F"']}),"\n"]}),(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"ReentrantReadWriteLock\u5177\u6709\u4EE5\u4E0B\u7279\u6027\uFF1A"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u53EF\u91CD\u5165\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u53EF\u9009\u62E9\u516C\u5E73/\u975E\u516C\u5E73\u9501"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u964D\u7EA7\uFF08\u5199\u9501\u2192\u8BFB\u9501\uFF09\u652F\u6301"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u5347\u7EA7\uFF08\u8BFB\u9501\u2192\u5199\u9501\uFF09\u4E0D\u652F\u6301"}),"\n"]})]})]}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"basic_rwlock",label:"\u57FA\u672C\u7528\u6CD5",default:!0,children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\nimport java.util.concurrent.locks.Lock;\n\npublic class ReadWriteLockBasic {\n    private final ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    private final Lock readLock = rwLock.readLock();\n    private final Lock writeLock = rwLock.writeLock();\n    \n    private String data = "\u521D\u59CB\u6570\u636E";\n    \n    // \u8BFB\u64CD\u4F5C - \u5141\u8BB8\u5E76\u53D1\u8BFB\u53D6\n    public String read() {\n        readLock.lock(); // \u83B7\u53D6\u8BFB\u9501\n        try {\n            System.out.println(Thread.currentThread().getName() + " \u8BFB\u53D6\u6570\u636E: " + data);\n            // \u6A21\u62DF\u8BFB\u53D6\u64CD\u4F5C\u8017\u65F6\n            Thread.sleep(100);\n            return data;\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return null;\n        } finally {\n            readLock.unlock(); // \u91CA\u653E\u8BFB\u9501\n        }\n    }\n    \n    // \u5199\u64CD\u4F5C - \u72EC\u5360\u8BBF\u95EE\n    public void write(String newData) {\n        writeLock.lock(); // \u83B7\u53D6\u5199\u9501\n        try {\n            System.out.println(Thread.currentThread().getName() + " \u5199\u5165\u6570\u636E: " + newData);\n            // \u6A21\u62DF\u5199\u5165\u64CD\u4F5C\u8017\u65F6\n            Thread.sleep(200);\n            data = newData;\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            writeLock.unlock(); // \u91CA\u653E\u5199\u9501\n        }\n    }\n    \n    public static void main(String[] args) {\n        final ReadWriteLockBasic example = new ReadWriteLockBasic();\n        \n        // \u521B\u5EFA\u591A\u4E2A\u8BFB\u7EBF\u7A0B\n        for (int i = 0; i < 5; i++) {\n            new Thread(example::read, "Reader-" + i).start();\n        }\n        \n        // \u521B\u5EFA\u5199\u7EBF\u7A0B\n        new Thread(() -> example.write("\u65B0\u6570\u636E"), "Writer-1").start();\n        \n        // \u518D\u521B\u5EFA\u8BFB\u7EBF\u7A0B\n        for (int i = 5; i < 10; i++) {\n            new Thread(example::read, "Reader-" + i).start();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"cache_implementation",label:"\u7F13\u5B58\u5B9E\u73B0",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\nimport java.util.concurrent.locks.Lock;\n\n/**\n * \u4F7F\u7528\u8BFB\u5199\u9501\u5B9E\u73B0\u7EBF\u7A0B\u5B89\u5168\u7684\u7F13\u5B58\n */\npublic class ReadWriteLockCache<K, V> {\n    private final Map<K, V> cache = new HashMap<>();\n    private final ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    private final Lock readLock = rwLock.readLock();\n    private final Lock writeLock = rwLock.writeLock();\n    \n    /**\n     * \u83B7\u53D6\u7F13\u5B58\u503C\n     * \u5982\u679C\u7F13\u5B58\u672A\u547D\u4E2D\uFF0C\u5219\u52A0\u8F7D\u6570\u636E\n     */\n    public V get(K key) {\n        V value = null;\n        \n        // \u5148\u5C1D\u8BD5\u4ECE\u7F13\u5B58\u4E2D\u8BFB\u53D6\uFF0C\u4F7F\u7528\u8BFB\u9501\n        readLock.lock();\n        try {\n            value = cache.get(key);\n            if (value != null) {\n                System.out.println("\u7F13\u5B58\u547D\u4E2D: " + key + " = " + value);\n                return value;\n            }\n        } finally {\n            readLock.unlock();\n        }\n        \n        // \u7F13\u5B58\u672A\u547D\u4E2D\uFF0C\u9700\u8981\u52A0\u8F7D\u6570\u636E\u5E76\u5199\u5165\u7F13\u5B58\uFF0C\u4F7F\u7528\u5199\u9501\n        writeLock.lock();\n        try {\n            // \u53CC\u91CD\u68C0\u67E5\uFF0C\u9632\u6B62\u5176\u4ED6\u7EBF\u7A0B\u5DF2\u7ECF\u52A0\u8F7D\n            value = cache.get(key);\n            if (value == null) {\n                // \u4ECE\u6570\u636E\u6E90\u52A0\u8F7D\u6570\u636E\n                value = loadFromDataSource(key);\n                cache.put(key, value);\n                System.out.println("\u7F13\u5B58\u5199\u5165: " + key + " = " + value);\n            }\n            return value;\n        } finally {\n            writeLock.unlock();\n        }\n    }\n    \n    /**\n     * \u76F4\u63A5\u66F4\u65B0\u7F13\u5B58\n     */\n    public void put(K key, V value) {\n        writeLock.lock();\n        try {\n            cache.put(key, value);\n            System.out.println("\u7F13\u5B58\u66F4\u65B0: " + key + " = " + value);\n        } finally {\n            writeLock.unlock();\n        }\n    }\n    \n    /**\n     * \u5220\u9664\u7F13\u5B58\u9879\n     */\n    public V remove(K key) {\n        writeLock.lock();\n        try {\n            V value = cache.remove(key);\n            System.out.println("\u7F13\u5B58\u79FB\u9664: " + key);\n            return value;\n        } finally {\n            writeLock.unlock();\n        }\n    }\n    \n    /**\n     * \u6E05\u7A7A\u7F13\u5B58\n     */\n    public void clear() {\n        writeLock.lock();\n        try {\n            cache.clear();\n            System.out.println("\u7F13\u5B58\u5DF2\u6E05\u7A7A");\n        } finally {\n            writeLock.unlock();\n        }\n    }\n    \n    /**\n     * \u83B7\u53D6\u7F13\u5B58\u5927\u5C0F\n     */\n    public int size() {\n        readLock.lock();\n        try {\n            return cache.size();\n        } finally {\n            readLock.unlock();\n        }\n    }\n    \n    /**\n     * \u6A21\u62DF\u4ECE\u6570\u636E\u6E90\u52A0\u8F7D\u6570\u636E\n     */\n    @SuppressWarnings("unchecked")\n    private V loadFromDataSource(K key) {\n        System.out.println("\u4ECE\u6570\u636E\u6E90\u52A0\u8F7D\u6570\u636E: " + key);\n        // \u6A21\u62DF\u6570\u636E\u6E90\u8BBF\u95EE\u5EF6\u8FDF\n        try {\n            Thread.sleep(200);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        // \u6A21\u62DF\u6570\u636E\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u5E94\u8BE5\u662F\u771F\u5B9E\u6570\u636E\u6E90\n        return (V) ("Data_" + key);\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"lock_downgrade",label:"\u9501\u964D\u7EA7",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\nimport java.util.concurrent.locks.Lock;\n\n/**\n * \u9501\u964D\u7EA7\u793A\u4F8B - \u4ECE\u5199\u9501\u964D\u7EA7\u5230\u8BFB\u9501\n */\npublic class LockDowngradeExample {\n    private final ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    private final Lock readLock = rwLock.readLock();\n    private final Lock writeLock = rwLock.writeLock();\n    \n    private int data = 0;\n    private boolean updated = false;\n    \n    /**\n     * \u9501\u964D\u7EA7 - \u6B63\u786E\u793A\u4F8B\n     * \u5199\u9501 -> \u83B7\u53D6\u8BFB\u9501 -> \u91CA\u653E\u5199\u9501 -> \u4F7F\u7528\u8BFB\u9501\n     */\n    public void processDataWithDowngrade() {\n        // \u9996\u5148\u83B7\u53D6\u5199\u9501\n        writeLock.lock();\n        try {\n            System.out.println("\u83B7\u53D6\u5199\u9501\uFF0C\u51C6\u5907\u66F4\u65B0\u6570\u636E");\n            // \u66F4\u65B0\u6570\u636E\n            data = (int)(Math.random() * 100);\n            updated = true;\n            \n            // \u5728\u91CA\u653E\u5199\u9501\u4E4B\u524D\uFF0C\u5148\u83B7\u53D6\u8BFB\u9501\n            // \u8FD9\u662F\u9501\u964D\u7EA7\u7684\u5173\u952E\u6B65\u9AA4\n            readLock.lock();\n            System.out.println("\u83B7\u53D6\u8BFB\u9501\uFF0C\u8FDB\u884C\u9501\u964D\u7EA7");\n        } finally {\n            // \u91CA\u653E\u5199\u9501\uFF0C\u4F46\u4ECD\u6301\u6709\u8BFB\u9501\n            writeLock.unlock();\n            System.out.println("\u91CA\u653E\u5199\u9501\uFF0C\u5B8C\u6210\u9501\u964D\u7EA7");\n        }\n        \n        // \u8FD9\u91CC\u53EA\u6301\u6709\u8BFB\u9501\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u53EF\u4EE5\u83B7\u53D6\u8BFB\u9501\uFF0C\u4F46\u4E0D\u80FD\u83B7\u53D6\u5199\u9501\n        try {\n            // \u4F7F\u7528\u5DF2\u66F4\u65B0\u7684\u6570\u636E\n            if (updated) {\n                System.out.println("\u4F7F\u7528\u5DF2\u66F4\u65B0\u7684\u6570\u636E: " + data);\n            }\n        } finally {\n            // \u6700\u540E\u91CA\u653E\u8BFB\u9501\n            readLock.unlock();\n            System.out.println("\u91CA\u653E\u8BFB\u9501");\n        }\n    }\n    \n    /**\n     * \u4E3A\u4EC0\u4E48\u9700\u8981\u9501\u964D\u7EA7\uFF1F\n     * 1. \u4FDD\u8BC1\u6570\u636E\u53EF\u89C1\u6027 - \u5F53\u7EBF\u7A0B\u5B8C\u6210\u5199\u64CD\u4F5C\u540E\uFF0C\u53EF\u80FD\u9700\u8981\u8BFB\u53D6\u521A\u5199\u5165\u7684\u6570\u636E\n     * 2. \u907F\u514D\u6570\u636E\u4E0D\u4E00\u81F4 - \u5982\u679C\u76F4\u63A5\u91CA\u653E\u5199\u9501\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u53EF\u80FD\u4FEE\u6539\u6570\u636E\n     * 3. \u63D0\u9AD8\u5E76\u53D1\u6027\u80FD - \u9501\u964D\u7EA7\u5141\u8BB8\u5176\u4ED6\u8BFB\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u63D0\u9AD8\u5E76\u53D1\u6027\n     */\n    \n    /**\n     * \u9501\u5347\u7EA7\u662F\u4E0D\u5141\u8BB8\u7684\n     * \u8BFB\u9501 -> \u5199\u9501 \u4F1A\u5BFC\u81F4\u6B7B\u9501\n     */\n    public void attemptLockUpgrade() {\n        readLock.lock();\n        try {\n            System.out.println("\u83B7\u53D6\u8BFB\u9501");\n            \n            // \u5C1D\u8BD5\u83B7\u53D6\u5199\u9501 - \u8FD9\u4F1A\u5BFC\u81F4\u6B7B\u9501\n            boolean acquired = false;\n            try {\n                System.out.println("\u5C1D\u8BD5\u83B7\u53D6\u5199\u9501\uFF08\u8FD9\u4F1A\u5BFC\u81F4\u6B7B\u9501\uFF09");\n                \n                // tryLock()\u53EF\u4EE5\u907F\u514D\u6B7B\u9501\uFF0C\u4F46\u4F1A\u83B7\u53D6\u5931\u8D25\n                acquired = writeLock.tryLock();\n                \n                if (acquired) {\n                    try {\n                        System.out.println("\u6210\u529F\u83B7\u53D6\u5199\u9501\uFF08\u5B9E\u9645\u4E0A\u8FD9\u884C\u4EE3\u7801\u4E0D\u4F1A\u6267\u884C\uFF09");\n                        data = 999;\n                    } finally {\n                        writeLock.unlock();\n                    }\n                } else {\n                    System.out.println("\u65E0\u6CD5\u83B7\u53D6\u5199\u9501\uFF0C\u56E0\u4E3A\u5DF2\u7ECF\u6301\u6709\u8BFB\u9501");\n                }\n            } finally {\n                if (acquired) {\n                    writeLock.unlock();\n                }\n            }\n        } finally {\n            readLock.unlock();\n            System.out.println("\u91CA\u653E\u8BFB\u9501");\n        }\n    }\n    \n    public static void main(String[] args) {\n        LockDowngradeExample example = new LockDowngradeExample();\n        \n        System.out.println("=== \u9501\u964D\u7EA7\u793A\u4F8B ===");\n        example.processDataWithDowngrade();\n        \n        System.out.println("\\n=== \u5C1D\u8BD5\u9501\u5347\u7EA7\u793A\u4F8B ===");\n        example.attemptLockUpgrade();\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h3,{id:"42-\u8BFB\u5199\u9501\u7684\u6027\u80FD\u7279\u6027",children:"4.2 \u8BFB\u5199\u9501\u7684\u6027\u80FD\u7279\u6027"}),"\n",(0,i.jsx)(e.mermaid,{value:"graph TD\n    A[\u8BFB\u5199\u9501\u6027\u80FD\u7279\u70B9] --\x3e B[\u9AD8\u5E76\u53D1\u8BFB\u53D6]\n    A --\x3e C[\u5199\u64CD\u4F5C\u72EC\u5360]\n    A --\x3e D[\u8BFB\u5199\u4E92\u65A5]\n    A --\x3e E[\u53EF\u80FD\u5199\u9965\u997F]\n    \n    B --\x3e B1[\u591A\u4E2A\u8BFB\u7EBF\u7A0B\u53EF\u5E76\u53D1\u8BBF\u95EE]\n    C --\x3e C1[\u5199\u7EBF\u7A0B\u72EC\u5360\u8BBF\u95EE]\n    D --\x3e D1[\u8BFB\u5199\u4E0D\u80FD\u540C\u65F6\u8FDB\u884C]\n    E --\x3e E1[\u5927\u91CF\u8BFB\u7EBF\u7A0B\u53EF\u80FD\u5BFC\u81F4\u5199\u7EBF\u7A0B\u4E00\u76F4\u7B49\u5F85]\n    \n    style A fill:#f9f,stroke:#333,stroke-width:2px\n    style B fill:#bbf,stroke:#333\n    style C fill:#bbf,stroke:#333\n    style D fill:#bbf,stroke:#333\n    style E fill:#bbf,stroke:#333"}),"\n",(0,i.jsxs)(l.A,{children:[(0,i.jsx)(a.A,{value:"perf_test",label:"\u6027\u80FD\u6D4B\u8BD5",default:!0,children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.TimeUnit;\nimport java.util.concurrent.atomic.AtomicInteger;\nimport java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\n/**\n * \u8BFB\u5199\u9501\u4E0E\u72EC\u5360\u9501\u6027\u80FD\u5BF9\u6BD4\u6D4B\u8BD5\n */\npublic class ReadWriteLockPerformanceTest {\n    // \u6D4B\u8BD5\u6570\u636E\n    private int sharedData = 0;\n    \n    // \u8BA1\u6570\u5668\n    private final AtomicInteger readCount = new AtomicInteger(0);\n    private final AtomicInteger writeCount = new AtomicInteger(0);\n    \n    // \u8BFB\u5199\u9501\n    private final ReadWriteLock readWriteLock = new ReentrantReadWriteLock();\n    private final Lock readLock = readWriteLock.readLock();\n    private final Lock writeLock = readWriteLock.writeLock();\n    \n    // \u72EC\u5360\u9501\n    private final Lock exclusiveLock = new ReentrantLock();\n    \n    /**\n     * \u4F7F\u7528\u8BFB\u5199\u9501\u8BFB\u53D6\u6570\u636E\n     */\n    public int readWithReadWriteLock() {\n        readLock.lock();\n        try {\n            // \u6A21\u62DF\u8BFB\u53D6\u64CD\u4F5C\n            Thread.sleep(1);\n            readCount.incrementAndGet();\n            return sharedData;\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return 0;\n        } finally {\n            readLock.unlock();\n        }\n    }\n    \n    /**\n     * \u4F7F\u7528\u8BFB\u5199\u9501\u5199\u5165\u6570\u636E\n     */\n    public void writeWithReadWriteLock(int value) {\n        writeLock.lock();\n        try {\n            // \u6A21\u62DF\u5199\u5165\u64CD\u4F5C\n            Thread.sleep(5);\n            sharedData = value;\n            writeCount.incrementAndGet();\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            writeLock.unlock();\n        }\n    }\n    \n    /**\n     * \u4F7F\u7528\u72EC\u5360\u9501\u8BFB\u53D6\u6570\u636E\n     */\n    public int readWithExclusiveLock() {\n        exclusiveLock.lock();\n        try {\n            // \u6A21\u62DF\u8BFB\u53D6\u64CD\u4F5C\n            Thread.sleep(1);\n            readCount.incrementAndGet();\n            return sharedData;\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            return 0;\n        } finally {\n            exclusiveLock.unlock();\n        }\n    }\n    \n    /**\n     * \u4F7F\u7528\u72EC\u5360\u9501\u5199\u5165\u6570\u636E\n     */\n    public void writeWithExclusiveLock(int value) {\n        exclusiveLock.lock();\n        try {\n            // \u6A21\u62DF\u5199\u5165\u64CD\u4F5C\n            Thread.sleep(5);\n            sharedData = value;\n            writeCount.incrementAndGet();\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            exclusiveLock.unlock();\n        }\n    }\n    \n    /**\n     * \u6027\u80FD\u6D4B\u8BD5\n     */\n    public void performanceTest(int threadCount, int duration, boolean useReadWriteLock) {\n        System.out.println("\u5F00\u59CB\u6D4B\u8BD5 " + \n            (useReadWriteLock ? "ReadWriteLock" : "ReentrantLock") + \n            " \u7EBF\u7A0B\u6570: " + threadCount);\n        \n        // \u91CD\u7F6E\u8BA1\u6570\u5668\n        readCount.set(0);\n        writeCount.set(0);\n        \n        ExecutorService executor = Executors.newFixedThreadPool(threadCount);\n        \n        // \u5F00\u59CB\u6D4B\u8BD5\n        long startTime = System.currentTimeMillis();\n        \n        // \u63D0\u4EA4\u6D4B\u8BD5\u4EFB\u52A1\n        for (int i = 0; i < threadCount; i++) {\n            final int threadId = i;\n            executor.submit(() -> {\n                try {\n                    while (System.currentTimeMillis() - startTime < duration) {\n                        // 90%\u7684\u6982\u7387\u8FDB\u884C\u8BFB\u64CD\u4F5C\uFF0C10%\u7684\u6982\u7387\u8FDB\u884C\u5199\u64CD\u4F5C\n                        if (Math.random() < 0.9) {\n                            // \u8BFB\u64CD\u4F5C\n                            if (useReadWriteLock) {\n                                readWithReadWriteLock();\n                            } else {\n                                readWithExclusiveLock();\n                            }\n                        } else {\n                            // \u5199\u64CD\u4F5C\n                            if (useReadWriteLock) {\n                                writeWithReadWriteLock(threadId);\n                            } else {\n                                writeWithExclusiveLock(threadId);\n                            }\n                        }\n                    }\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n        \n        // \u7B49\u5F85\u6D4B\u8BD5\u5B8C\u6210\n        executor.shutdown();\n        try {\n            executor.awaitTermination(duration + 1000, TimeUnit.MILLISECONDS);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        // \u6D4B\u8BD5\u7ED3\u679C\n        long endTime = System.currentTimeMillis();\n        long totalTime = endTime - startTime;\n        \n        System.out.println("\u6D4B\u8BD5\u5B8C\u6210\uFF0C\u7528\u65F6: " + totalTime + "ms");\n        System.out.println("\u8BFB\u64CD\u4F5C\u6B21\u6570: " + readCount.get() + ", \u8BFB\u64CD\u4F5C\u6BCF\u79D2: " + \n            (readCount.get() * 1000 / totalTime));\n        System.out.println("\u5199\u64CD\u4F5C\u6B21\u6570: " + writeCount.get() + ", \u5199\u64CD\u4F5C\u6BCF\u79D2: " + \n            (writeCount.get() * 1000 / totalTime));\n        System.out.println("\u603B\u64CD\u4F5C\u6B21\u6570: " + (readCount.get() + writeCount.get()) + \n            ", \u603B\u64CD\u4F5C\u6BCF\u79D2: " + ((readCount.get() + writeCount.get()) * 1000 / totalTime));\n        System.out.println("--------------------------------------");\n    }\n    \n    /**\n     * \u4E3B\u6D4B\u8BD5\u65B9\u6CD5\n     */\n    public static void main(String[] args) {\n        ReadWriteLockPerformanceTest test = new ReadWriteLockPerformanceTest();\n        \n        // \u6D4B\u8BD5\u53C2\u6570\n        int[] threadCounts = {4, 8, 16, 32};\n        int testDuration = 5000; // \u6D4B\u8BD5\u65F6\u95F45\u79D2\n        \n        System.out.println("===== ReadWriteLock vs ReentrantLock \u6027\u80FD\u6D4B\u8BD5 =====");\n        System.out.println("\u8BFB\u5199\u6BD4\u4F8B: 90% \u8BFB, 10% \u5199");\n        System.out.println("\u6D4B\u8BD5\u65F6\u95F4: " + testDuration + "ms");\n        System.out.println("--------------------------------------");\n        \n        // \u8FDB\u884C\u6D4B\u8BD5\n        for (int threadCount : threadCounts) {\n            // \u6D4B\u8BD5\u72EC\u5360\u9501\n            test.performanceTest(threadCount, testDuration, false);\n            \n            // \u6D4B\u8BD5\u8BFB\u5199\u9501\n            test.performanceTest(threadCount, testDuration, true);\n            \n            System.out.println();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"use_cases",label:"\u9002\u7528\u573A\u666F",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card__body",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"ReadWriteLock\u6700\u9002\u5408\u4EE5\u4E0B\u573A\u666F:"})}),(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8BFB\u591A\u5199\u5C11\u7684\u5E94\u7528"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u6570\u636E\u7F13\u5B58"}),"\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E\u7BA1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u72B6\u6001\u76D1\u63A7"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u8BFB\u64CD\u4F5C\u8017\u65F6\u8F83\u957F"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u590D\u6742\u8BA1\u7B97"}),"\n",(0,i.jsx)(e.li,{children:"\u5927\u6570\u636E\u96C6\u904D\u5386"}),"\n",(0,i.jsx)(e.li,{children:"\u8D44\u6E90\u5BC6\u96C6\u578B\u64CD\u4F5C"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4E0D\u9002\u5408\u7684\u573A\u666F"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5199\u64CD\u4F5C\u9891\u7E41\u7684\u5E94\u7528"}),"\n",(0,i.jsx)(e.li,{children:"\u8BFB\u5199\u64CD\u4F5C\u6B21\u6570\u63A5\u8FD1\u7684\u573A\u666F"}),"\n",(0,i.jsx)(e.li,{children:"\u9501\u6301\u6709\u65F6\u95F4\u975E\u5E38\u77ED\u7684\u60C5\u51B5"}),"\n"]}),"\n"]}),"\n"]})]})})}),(0,i.jsx)(a.A,{value:"comparison",label:"\u9501\u7C7B\u578B\u5BF9\u6BD4",children:(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("div",{className:"card__body",children:(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"synchronized"}),(0,i.jsx)(e.th,{children:"ReentrantLock"}),(0,i.jsx)(e.th,{children:"ReadWriteLock"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5E76\u53D1\u8BFB\u53D6"})}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u9501\u83B7\u53D6\u65B9\u5F0F"})}),(0,i.jsx)(e.td,{children:"\u963B\u585E\u5F0F"}),(0,i.jsx)(e.td,{children:"\u53EF\u4E2D\u65AD/\u8D85\u65F6/\u963B\u585E"}),(0,i.jsx)(e.td,{children:"\u53EF\u4E2D\u65AD/\u8D85\u65F6/\u963B\u585E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u516C\u5E73\u6027"})}),(0,i.jsx)(e.td,{children:"\u4E0D\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"}),(0,i.jsx)(e.td,{children:"\u652F\u6301"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD(\u8BFB\u591A\u5199\u5C11)"})}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u4E2D"}),(0,i.jsx)(e.td,{children:"\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD(\u5199\u591A\u8BFB\u5C11)"})}),(0,i.jsx)(e.td,{children:"\u4E2D"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E2D"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u7F16\u7A0B\u590D\u6742\u5EA6"})}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u4E2D"}),(0,i.jsx)(e.td,{children:"\u9AD8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u9501\u7C92\u5EA6\u63A7\u5236"})}),(0,i.jsx)(e.td,{children:"\u7C97\u7C92\u5EA6"}),(0,i.jsx)(e.td,{children:"\u7EC6\u7C92\u5EA6"}),(0,i.jsx)(e.td,{children:"\u66F4\u7EC6\u7C92\u5EA6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u907F\u514D\u6B7B\u9501\u80FD\u529B"})}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u9AD8"})]})]})]})})})})]}),"\n",(0,i.jsx)(e.h2,{id:"5-\u9501\u7684\u6700\u4F73\u5B9E\u8DF5",children:"5. \u9501\u7684\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.h3,{id:"51-\u9501\u7684\u9009\u62E9\u7B56\u7565",children:"5.1 \u9501\u7684\u9009\u62E9\u7B56\u7565"}),"\n",(0,i.jsxs)(e.admonition,{title:"\u6838\u5FC3\u539F\u5219",type:"tip",children:[(0,i.jsx)(e.p,{children:"\u9009\u62E9\u5408\u9002\u7684\u9501\u673A\u5236\u9700\u8981\u8003\u8651\u4EE5\u4E0B\u56E0\u7D20\uFF1A"}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7B80\u5355\u573A\u666F"}),"\uFF1A\u4F18\u5148\u4F7F\u7528synchronized"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u590D\u6742\u9700\u6C42"}),"\uFF1A\u4F7F\u7528Lock\u63A5\u53E3\uFF08\u4E2D\u65AD\u3001\u8D85\u65F6\u3001\u516C\u5E73\u6027\uFF09"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8BFB\u591A\u5199\u5C11"}),"\uFF1A\u4F7F\u7528\u8BFB\u5199\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u8981\u6C42"}),"\uFF1A\u8003\u8651\u65E0\u9501\u6570\u636E\u7ED3\u6784"]}),"\n"]})]}),"\n",(0,i.jsx)(e.h3,{id:"52-\u907F\u514D\u6B7B\u9501",children:"5.2 \u907F\u514D\u6B7B\u9501"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u907F\u514D\u6B7B\u9501\u793A\u4F8B"',children:'public class DeadlockPrevention {\n    \n    /**\n     * 1. \u56FA\u5B9A\u9501\u987A\u5E8F\n     */\n    public static class FixedLockOrder {\n        private final Object lock1 = new Object();\n        private final Object lock2 = new Object();\n        \n        public void method1() {\n            synchronized (lock1) {\n                synchronized (lock2) {\n                    System.out.println("method1 \u6267\u884C");\n                }\n            }\n        }\n        \n        public void method2() {\n            // \u4F7F\u7528\u76F8\u540C\u7684\u9501\u987A\u5E8F\n            synchronized (lock1) {\n                synchronized (lock2) {\n                    System.out.println("method2 \u6267\u884C");\n                }\n            }\n        }\n    }\n    \n    /**\n     * 2. \u4F7F\u7528\u8D85\u65F6\u673A\u5236\n     */\n    public static class TimeoutPrevention {\n        private final ReentrantLock lock1 = new ReentrantLock();\n        private final ReentrantLock lock2 = new ReentrantLock();\n        \n        public void method1() {\n            if (lock1.tryLock()) {\n                try {\n                    if (lock2.tryLock(5, TimeUnit.SECONDS)) {\n                        try {\n                            System.out.println("method1 \u6267\u884C");\n                        } finally {\n                            lock2.unlock();\n                        }\n                    } else {\n                        System.out.println("method1 \u83B7\u53D6\u95012\u8D85\u65F6");\n                    }\n                } catch (InterruptedException e) {\n                    Thread.currentThread().interrupt();\n                } finally {\n                    lock1.unlock();\n                }\n            }\n        }\n        \n        public void method2() {\n            if (lock2.tryLock()) {\n                try {\n                    if (lock1.tryLock(5, TimeUnit.SECONDS)) {\n                        try {\n                            System.out.println("method2 \u6267\u884C");\n                        } finally {\n                            lock1.unlock();\n                        }\n                    } else {\n                        System.out.println("method2 \u83B7\u53D6\u95011\u8D85\u65F6");\n                    }\n                } catch (InterruptedException e) {\n                    Thread.currentThread().interrupt();\n                } finally {\n                    lock2.unlock();\n                }\n            }\n        }\n    }\n    \n    /**\n     * 3. \u4F7F\u7528\u9501\u7684\u5C42\u6B21\u7ED3\u6784\n     */\n    public static class LockHierarchy {\n        private final Object lock1 = new Object();\n        private final Object lock2 = new Object();\n        private final Object lock3 = new Object();\n        \n        public void method1() {\n            synchronized (lock1) {\n                synchronized (lock2) {\n                    synchronized (lock3) {\n                        System.out.println("method1 \u6267\u884C");\n                    }\n                }\n            }\n        }\n        \n        public void method2() {\n            synchronized (lock1) {\n                synchronized (lock2) {\n                    System.out.println("method2 \u6267\u884C");\n                }\n            }\n        }\n        \n        public void method3() {\n            synchronized (lock1) {\n                System.out.println("method3 \u6267\u884C");\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"53-\u6027\u80FD\u4F18\u5316\u6280\u5DE7",children:"5.3 \u6027\u80FD\u4F18\u5316\u6280\u5DE7"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u9501\u6027\u80FD\u4F18\u5316\u793A\u4F8B"',children:"public class LockPerformanceOptimization {\n    \n    /**\n     * 1. \u51CF\u5C11\u9501\u7684\u7C92\u5EA6\n     */\n    public static class FineGrainedLocking {\n        private final Object[] locks = new Object[16];\n        private final int[] counters = new int[16];\n        \n        public FineGrainedLocking() {\n            for (int i = 0; i < locks.length; i++) {\n                locks[i] = new Object();\n            }\n        }\n        \n        public void increment(int key) {\n            int index = Math.abs(key % locks.length);\n            synchronized (locks[index]) {\n                counters[index]++;\n            }\n        }\n        \n        public int getTotal() {\n            int total = 0;\n            for (int i = 0; i < locks.length; i++) {\n                synchronized (locks[i]) {\n                    total += counters[i];\n                }\n            }\n            return total;\n        }\n    }\n    \n    /**\n     * 2. \u4F7F\u7528\u8BFB\u5199\u9501\u63D0\u9AD8\u5E76\u53D1\u6027\n     */\n    public static class ReadWriteOptimization {\n        private final ReadWriteLock lock = new ReentrantReadWriteLock();\n        private final Lock readLock = lock.readLock();\n        private final Lock writeLock = lock.writeLock();\n        private final Map<String, String> data = new HashMap<>();\n        \n        public String get(String key) {\n            readLock.lock();\n            try {\n                return data.get(key);\n            } finally {\n                readLock.unlock();\n            }\n        }\n        \n        public void put(String key, String value) {\n            writeLock.lock();\n            try {\n                data.put(key, value);\n            } finally {\n                writeLock.unlock();\n            }\n        }\n        \n        public void putAll(Map<String, String> map) {\n            writeLock.lock();\n            try {\n                data.putAll(map);\n            } finally {\n                writeLock.unlock();\n            }\n        }\n    }\n    \n    /**\n     * 3. \u4F7F\u7528\u6761\u4EF6\u53D8\u91CF\u907F\u514D\u5FD9\u7B49\u5F85\n     */\n    public static class ConditionOptimization {\n        private final ReentrantLock lock = new ReentrantLock();\n        private final Condition notEmpty = lock.newCondition();\n        private final Condition notFull = lock.newCondition();\n        private final Queue<String> queue = new LinkedList<>();\n        private final int capacity = 10;\n        \n        public void put(String item) {\n            lock.lock();\n            try {\n                while (queue.size() >= capacity) {\n                    notFull.await(); // \u7B49\u5F85\u800C\u4E0D\u662F\u5FD9\u7B49\u5F85\n                }\n                queue.offer(item);\n                notEmpty.signal();\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            } finally {\n                lock.unlock();\n            }\n        }\n        \n        public String take() {\n            lock.lock();\n            try {\n                while (queue.isEmpty()) {\n                    notEmpty.await(); // \u7B49\u5F85\u800C\u4E0D\u662F\u5FD9\u7B49\u5F85\n                }\n                String item = queue.poll();\n                notFull.signal();\n                return item;\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                return null;\n            } finally {\n                lock.unlock();\n            }\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"6-\u603B\u7ED3",children:"6. \u603B\u7ED3"}),"\n",(0,i.jsx)(e.p,{children:"Java\u9501\u673A\u5236\u662F\u5E76\u53D1\u7F16\u7A0B\u7684\u6838\u5FC3\uFF0C\u638C\u63E1\u5404\u79CD\u9501\u7684\u7279\u6027\u548C\u4F7F\u7528\u573A\u666F\u5BF9\u4E8E\u6784\u5EFA\u9AD8\u6027\u80FD\u7684\u5E76\u53D1\u5E94\u7528\u81F3\u5173\u91CD\u8981\u3002"}),"\n",(0,i.jsx)(e.h3,{id:"61-\u5173\u952E\u8981\u70B9",children:"6.1 \u5173\u952E\u8981\u70B9"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u7684\u7C7B\u578B"}),"\uFF1Asynchronized\u3001Lock\u63A5\u53E3\u3001\u8BFB\u5199\u9501"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9501\u7684\u7279\u6027"}),"\uFF1A\u53EF\u91CD\u5165\u6027\u3001\u516C\u5E73\u6027\u3001\u4E2D\u65AD\u6027\u3001\u8D85\u65F6\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u907F\u514D\u6B7B\u9501"}),"\uFF1A\u56FA\u5B9A\u9501\u987A\u5E8F\u3001\u8D85\u65F6\u673A\u5236\u3001\u5C42\u6B21\u7ED3\u6784"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5316"}),"\uFF1A\u51CF\u5C11\u9501\u7C92\u5EA6\u3001\u8BFB\u5199\u5206\u79BB\u3001\u6761\u4EF6\u53D8\u91CF"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"62-\u9009\u62E9\u5EFA\u8BAE",children:"6.2 \u9009\u62E9\u5EFA\u8BAE"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u573A\u666F"}),(0,i.jsx)(e.th,{children:"\u63A8\u8350\u9501\u7C7B\u578B"}),(0,i.jsx)(e.th,{children:"\u539F\u56E0"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u7B80\u5355\u540C\u6B65"})}),(0,i.jsx)(e.td,{children:"synchronized"}),(0,i.jsx)(e.td,{children:"\u7B80\u5355\u6613\u7528\uFF0C\u81EA\u52A8\u7BA1\u7406"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u590D\u6742\u9700\u6C42"})}),(0,i.jsx)(e.td,{children:"ReentrantLock"}),(0,i.jsx)(e.td,{children:"\u529F\u80FD\u4E30\u5BCC\uFF0C\u652F\u6301\u4E2D\u65AD\u548C\u8D85\u65F6"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u8BFB\u591A\u5199\u5C11"})}),(0,i.jsx)(e.td,{children:"ReadWriteLock"}),(0,i.jsx)(e.td,{children:"\u63D0\u9AD8\u5E76\u53D1\u6027\u80FD"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u9AD8\u6027\u80FD\u8981\u6C42"})}),(0,i.jsx)(e.td,{children:"\u65E0\u9501\u6570\u636E\u7ED3\u6784"}),(0,i.jsx)(e.td,{children:"\u907F\u514D\u9501\u7ADE\u4E89"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"63-\u5B66\u4E60\u5EFA\u8BAE",children:"6.3 \u5B66\u4E60\u5EFA\u8BAE"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7406\u89E3\u539F\u7406"}),"\uFF1A\u6DF1\u5165\u7406\u89E3\u5404\u79CD\u9501\u7684\u5DE5\u4F5C\u539F\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5B9E\u8DF5\u9A8C\u8BC1"}),"\uFF1A\u901A\u8FC7\u7F16\u5199\u4EE3\u7801\u9A8C\u8BC1\u4E0D\u540C\u9501\u7684\u6548\u679C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u6D4B\u8BD5"}),"\uFF1A\u5BF9\u6BD4\u4E0D\u540C\u9501\u7684\u6027\u80FD\u5DEE\u5F02"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A\u9075\u5FAA\u9501\u4F7F\u7528\u7684\u6700\u4F73\u5B9E\u8DF5"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u901A\u8FC7\u6DF1\u5165\u7406\u89E3\u548C\u719F\u7EC3\u8FD0\u7528\u8FD9\u4E9B\u9501\u673A\u5236\uFF0C\u6211\u4EEC\u80FD\u591F\u6784\u5EFA\u51FA\u66F4\u52A0\u9AD8\u6548\u3001\u5065\u58EE\u548C\u53EF\u7EF4\u62A4\u7684Java\u5E76\u53D1\u5E94\u7528\u7A0B\u5E8F\u3002"})]})}function j(n={}){let{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(x,{...n})}):x(n)}}}]);