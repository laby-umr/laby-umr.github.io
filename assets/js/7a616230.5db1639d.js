"use strict";(self.webpackChunkfullstack_dev_blog=self.webpackChunkfullstack_dev_blog||[]).push([["69266"],{74066:function(n,e,t){t.r(e),t.d(e,{metadata:()=>r,default:()=>g,frontMatter:()=>c,contentTitle:()=>l,toc:()=>d,assets:()=>p});var r=JSON.parse('{"id":"backend/message-queues/kafka","title":"Apache Kafka\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3Kafka\u67B6\u6784\u539F\u7406\u3001\u6838\u5FC3\u7EC4\u4EF6\u3001\u6027\u80FD\u4F18\u5316\u4E0E\u5B9E\u6218\u5E94\u7528\uFF0C\u5305\u542B\u8BE6\u7EC6\u7684\u6280\u672F\u89E3\u6790\u548C\u6700\u4F73\u5B9E\u8DF5","source":"@site/docs/backend/message-queues/kafka.mdx","sourceDirName":"backend/message-queues","slug":"/backend/message-queues/kafka","permalink":"/docs/backend/message-queues/kafka","draft":false,"unlisted":false,"editUrl":"https://github.com/MasterLiu93/blog-web/tree/main/docs/backend/message-queues/kafka.mdx","tags":[{"inline":true,"label":"Kafka","permalink":"/docs/tags/kafka"},{"inline":true,"label":"\u6D88\u606F\u961F\u5217","permalink":"/docs/tags/\u6D88\u606F\u961F\u5217"},{"inline":true,"label":"\u5206\u5E03\u5F0F\u7CFB\u7EDF","permalink":"/docs/tags/\u5206\u5E03\u5F0F\u7CFB\u7EDF"},{"inline":true,"label":"\u6D41\u5904\u7406","permalink":"/docs/tags/\u6D41\u5904\u7406"},{"inline":true,"label":"\u9AD8\u5E76\u53D1","permalink":"/docs/tags/\u9AD8\u5E76\u53D1"},{"inline":true,"label":"\u5927\u6570\u636E","permalink":"/docs/tags/\u5927\u6570\u636E"},{"inline":true,"label":"\u4E8B\u4EF6\u9A71\u52A8","permalink":"/docs/tags/\u4E8B\u4EF6\u9A71\u52A8"}],"version":"current","lastUpdatedBy":"Laby","lastUpdatedAt":1754956800000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Apache Kafka\u8BE6\u89E3","description":"\u6DF1\u5165\u7406\u89E3Kafka\u67B6\u6784\u539F\u7406\u3001\u6838\u5FC3\u7EC4\u4EF6\u3001\u6027\u80FD\u4F18\u5316\u4E0E\u5B9E\u6218\u5E94\u7528\uFF0C\u5305\u542B\u8BE6\u7EC6\u7684\u6280\u672F\u89E3\u6790\u548C\u6700\u4F73\u5B9E\u8DF5","authors":["Laby"],"tags":["Kafka","\u6D88\u606F\u961F\u5217","\u5206\u5E03\u5F0F\u7CFB\u7EDF","\u6D41\u5904\u7406","\u9AD8\u5E76\u53D1","\u5927\u6570\u636E","\u4E8B\u4EF6\u9A71\u52A8"],"last_update":{"date":"2025-08-12T00:00:00.000Z","author":"Laby"}},"sidebar":"tutorialSidebar","previous":{"title":"\u5206\u5E03\u5F0F\u641C\u7D22\u5F15\u64CE\u8BE6\u89E3","permalink":"/docs/backend/distributed-systems/distributed-search"},"next":{"title":"RabbitMQ\u6D88\u606F\u961F\u5217\u8BE6\u89E3","permalink":"/docs/backend/message-queues/rabbitmq"}}'),i=t(74848),s=t(28453),o=t(78010),a=t(57250);t(25591);let c={sidebar_position:1,title:"Apache Kafka\u8BE6\u89E3",description:"\u6DF1\u5165\u7406\u89E3Kafka\u67B6\u6784\u539F\u7406\u3001\u6838\u5FC3\u7EC4\u4EF6\u3001\u6027\u80FD\u4F18\u5316\u4E0E\u5B9E\u6218\u5E94\u7528\uFF0C\u5305\u542B\u8BE6\u7EC6\u7684\u6280\u672F\u89E3\u6790\u548C\u6700\u4F73\u5B9E\u8DF5",authors:["Laby"],tags:["Kafka","\u6D88\u606F\u961F\u5217","\u5206\u5E03\u5F0F\u7CFB\u7EDF","\u6D41\u5904\u7406","\u9AD8\u5E76\u53D1","\u5927\u6570\u636E","\u4E8B\u4EF6\u9A71\u52A8"],last_update:{date:new Date("2025-08-12T00:00:00.000Z"),author:"Laby"}},l="Apache Kafka\u5206\u5E03\u5F0F\u6D41\u5904\u7406\u5E73\u53F0\u8BE6\u89E3",p={},d=[{value:"1. Kafka\u57FA\u7840\u67B6\u6784\u4E0E\u8BBE\u8BA1\u7406\u5FF5",id:"1-kafka\u57FA\u7840\u67B6\u6784\u4E0E\u8BBE\u8BA1\u7406\u5FF5",level:2},{value:"1.1 Kafka\u6838\u5FC3\u8BBE\u8BA1\u54F2\u5B66",id:"11-kafka\u6838\u5FC3\u8BBE\u8BA1\u54F2\u5B66",level:3},{value:"\u8BBE\u8BA1\u539F\u5219\u8BE6\u89E3",id:"\u8BBE\u8BA1\u539F\u5219\u8BE6\u89E3",level:4},{value:"1.2 Kafka\u5E94\u7528\u573A\u666F\u5168\u666F\u56FE",id:"12-kafka\u5E94\u7528\u573A\u666F\u5168\u666F\u56FE",level:3},{value:"2.1 Broker\uFF08\u4EE3\u7406\u670D\u52A1\u5668\uFF09- \u96C6\u7FA4\u7684\u57FA\u77F3",id:"21-broker\u4EE3\u7406\u670D\u52A1\u5668--\u96C6\u7FA4\u7684\u57FA\u77F3",level:3},{value:"2.2 Topic\uFF08\u4E3B\u9898\uFF09- \u6D88\u606F\u5206\u7C7B\u7684\u903B\u8F91\u5BB9\u5668",id:"22-topic\u4E3B\u9898--\u6D88\u606F\u5206\u7C7B\u7684\u903B\u8F91\u5BB9\u5668",level:2},{value:"2.3 Partition\uFF08\u5206\u533A\uFF09- \u5E76\u884C\u5904\u7406\u7684\u57FA\u7840",id:"23-partition\u5206\u533A--\u5E76\u884C\u5904\u7406\u7684\u57FA\u7840",level:3},{value:"3.1 Producer\uFF08\u751F\u4EA7\u8005\uFF09- \u9AD8\u6027\u80FD\u6D88\u606F\u53D1\u9001",id:"31-producer\u751F\u4EA7\u8005--\u9AD8\u6027\u80FD\u6D88\u606F\u53D1\u9001",level:3},{value:"3.2 Consumer\uFF08\u6D88\u8D39\u8005\uFF09- \u9AD8\u6548\u6D88\u606F\u6D88\u8D39",id:"32-consumer\u6D88\u8D39\u8005--\u9AD8\u6548\u6D88\u606F\u6D88\u8D39",level:3},{value:"4. Kafka Streams\u6D41\u5904\u7406\u6846\u67B6",id:"4-kafka-streams\u6D41\u5904\u7406\u6846\u67B6",level:2},{value:"4.1 Kafka Streams\u6838\u5FC3\u6982\u5FF5",id:"41-kafka-streams\u6838\u5FC3\u6982\u5FF5",level:3},{value:"4.2 \u72B6\u6001\u5B58\u50A8\u4E0E\u5BB9\u9519\u673A\u5236",id:"42-\u72B6\u6001\u5B58\u50A8\u4E0E\u5BB9\u9519\u673A\u5236",level:3},{value:"5. Kafka\u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7",id:"5-kafka\u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7",level:2},{value:"5.1 \u6027\u80FD\u4F18\u5316\u7B56\u7565",id:"51-\u6027\u80FD\u4F18\u5316\u7B56\u7565",level:3},{value:"6. Kafka\u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u6DF1\u5EA6\u89E3\u6790",id:"6-kafka\u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u6DF1\u5EA6\u89E3\u6790",level:2},{value:"6.1 \u57FA\u7840\u6982\u5FF5\u4E0E\u67B6\u6784\u9898",id:"61-\u57FA\u7840\u6982\u5FF5\u4E0E\u67B6\u6784\u9898",level:3},{value:"6.2 \u6027\u80FD\u4F18\u5316\u4E0E\u8C03\u4F18\u9898",id:"62-\u6027\u80FD\u4F18\u5316\u4E0E\u8C03\u4F18\u9898",level:3},{value:"6.3 \u67B6\u6784\u8BBE\u8BA1\u4E0E\u5B9E\u6218\u9898",id:"63-\u67B6\u6784\u8BBE\u8BA1\u4E0E\u5B9E\u6218\u9898",level:3},{value:"6.4 \u6545\u969C\u6392\u67E5\u4E0E\u8FD0\u7EF4\u9898",id:"64-\u6545\u969C\u6392\u67E5\u4E0E\u8FD0\u7EF4\u9898",level:3},{value:"7. Kafka\u5B9E\u6218\u9879\u76EE\u6848\u4F8B",id:"7-kafka\u5B9E\u6218\u9879\u76EE\u6848\u4F8B",level:2},{value:"7.1 \u7535\u5546\u8BA2\u5355\u5904\u7406\u7CFB\u7EDF",id:"71-\u7535\u5546\u8BA2\u5355\u5904\u7406\u7CFB\u7EDF",level:3},{value:"7.1.1 \u7CFB\u7EDF\u67B6\u6784\u8BBE\u8BA1",id:"711-\u7CFB\u7EDF\u67B6\u6784\u8BBE\u8BA1",level:4},{value:"7.1.2 \u9879\u76EE\u7ED3\u6784",id:"712-\u9879\u76EE\u7ED3\u6784",level:4},{value:"7.1.3 \u6838\u5FC3\u4EE3\u7801\u5B9E\u73B0",id:"713-\u6838\u5FC3\u4EE3\u7801\u5B9E\u73B0",level:4},{value:"7.1.4 \u914D\u7F6E\u7BA1\u7406",id:"714-\u914D\u7F6E\u7BA1\u7406",level:4},{value:"7.1.5 Docker\u90E8\u7F72\u914D\u7F6E",id:"715-docker\u90E8\u7F72\u914D\u7F6E",level:4},{value:"7.1.6 \u76D1\u63A7\u548C\u544A\u8B66",id:"716-\u76D1\u63A7\u548C\u544A\u8B66",level:4},{value:"7.2 \u6027\u80FD\u6D4B\u8BD5\u5B9E\u8DF5",id:"72-\u6027\u80FD\u6D4B\u8BD5\u5B9E\u8DF5",level:3},{value:"7.2.1 \u538B\u529B\u6D4B\u8BD5\u811A\u672C",id:"721-\u538B\u529B\u6D4B\u8BD5\u811A\u672C",level:4},{value:"7.2.2 JMeter\u6D4B\u8BD5\u8BA1\u5212",id:"722-jmeter\u6D4B\u8BD5\u8BA1\u5212",level:4},{value:"7.3 \u751F\u4EA7\u73AF\u5883\u90E8\u7F72\u6307\u5357",id:"73-\u751F\u4EA7\u73AF\u5883\u90E8\u7F72\u6307\u5357",level:3},{value:"7.3.1 \u96C6\u7FA4\u89C4\u5212",id:"731-\u96C6\u7FA4\u89C4\u5212",level:4},{value:"7.3.2 \u914D\u7F6E\u6587\u4EF6\u4F18\u5316",id:"732-\u914D\u7F6E\u6587\u4EF6\u4F18\u5316",level:4},{value:"7.3.3 \u5B89\u5168\u914D\u7F6E",id:"733-\u5B89\u5168\u914D\u7F6E",level:4},{value:"7.3.4 \u76D1\u63A7\u914D\u7F6E",id:"734-\u76D1\u63A7\u914D\u7F6E",level:4},{value:"7.4 \u8FD0\u7EF4\u7BA1\u7406\u5B9E\u8DF5",id:"74-\u8FD0\u7EF4\u7BA1\u7406\u5B9E\u8DF5",level:3},{value:"7.4.1 \u65E5\u5E38\u8FD0\u7EF4\u811A\u672C",id:"741-\u65E5\u5E38\u8FD0\u7EF4\u811A\u672C",level:4},{value:"7.4.2 \u6545\u969C\u6392\u67E5\u6307\u5357",id:"742-\u6545\u969C\u6392\u67E5\u6307\u5357",level:4},{value:"7.4.3 \u6027\u80FD\u8C03\u4F18\u5B9E\u8DF5",id:"743-\u6027\u80FD\u8C03\u4F18\u5B9E\u8DF5",level:4},{value:"7.5 \u4E0E\u5176\u4ED6\u6280\u672F\u6808\u96C6\u6210",id:"75-\u4E0E\u5176\u4ED6\u6280\u672F\u6808\u96C6\u6210",level:3},{value:"7.5.1 Spring Boot\u96C6\u6210",id:"751-spring-boot\u96C6\u6210",level:4},{value:"7.5.2 \u4E0E\u6570\u636E\u5E93\u96C6\u6210",id:"752-\u4E0E\u6570\u636E\u5E93\u96C6\u6210",level:4},{value:"7.5.3 \u4E0EElasticsearch\u96C6\u6210",id:"753-\u4E0Eelasticsearch\u96C6\u6210",level:4},{value:"7.6 \u9AD8\u7EA7\u9519\u8BEF\u5904\u7406\u4E0E\u5BB9\u9519\u673A\u5236",id:"76-\u9AD8\u7EA7\u9519\u8BEF\u5904\u7406\u4E0E\u5BB9\u9519\u673A\u5236",level:3},{value:"7.6.1 \u751F\u4EA7\u8005\u9519\u8BEF\u5904\u7406",id:"761-\u751F\u4EA7\u8005\u9519\u8BEF\u5904\u7406",level:4},{value:"7.6.2 \u6D88\u8D39\u8005\u9519\u8BEF\u5904\u7406",id:"762-\u6D88\u8D39\u8005\u9519\u8BEF\u5904\u7406",level:4},{value:"7.6.3 \u6D88\u606F\u53BB\u91CD\u4E0E\u5E42\u7B49\u6027",id:"763-\u6D88\u606F\u53BB\u91CD\u4E0E\u5E42\u7B49\u6027",level:4},{value:"7.6.4 \u6D88\u606F\u987A\u5E8F\u4FDD\u8BC1",id:"764-\u6D88\u606F\u987A\u5E8F\u4FDD\u8BC1",level:4},{value:"7.6.5 \u76D1\u63A7\u4E0E\u544A\u8B66",id:"765-\u76D1\u63A7\u4E0E\u544A\u8B66",level:4},{value:"7.7 \u6027\u80FD\u6D4B\u8BD5\u4E0E\u8C03\u4F18\u5B9E\u8DF5",id:"77-\u6027\u80FD\u6D4B\u8BD5\u4E0E\u8C03\u4F18\u5B9E\u8DF5",level:3},{value:"7.7.1 \u6027\u80FD\u57FA\u51C6\u6D4B\u8BD5",id:"771-\u6027\u80FD\u57FA\u51C6\u6D4B\u8BD5",level:4},{value:"7.7.2 \u6027\u80FD\u8C03\u4F18\u7B56\u7565",id:"772-\u6027\u80FD\u8C03\u4F18\u7B56\u7565",level:4},{value:"7.7.3 \u7CFB\u7EDF\u7EA7\u4F18\u5316",id:"773-\u7CFB\u7EDF\u7EA7\u4F18\u5316",level:4},{value:"7.7.4 \u76D1\u63A7\u6307\u6807\u5206\u6790",id:"774-\u76D1\u63A7\u6307\u6807\u5206\u6790",level:4},{value:"7.7.5 \u538B\u529B\u6D4B\u8BD5\u573A\u666F",id:"775-\u538B\u529B\u6D4B\u8BD5\u573A\u666F",level:4},{value:"8. Kafka\u6700\u4F73\u5B9E\u8DF5\u4E0E\u603B\u7ED3",id:"8-kafka\u6700\u4F73\u5B9E\u8DF5\u4E0E\u603B\u7ED3",level:2},{value:"8.1 \u8BBE\u8BA1\u539F\u5219\u4E0E\u6700\u4F73\u5B9E\u8DF5",id:"81-\u8BBE\u8BA1\u539F\u5219\u4E0E\u6700\u4F73\u5B9E\u8DF5",level:3},{value:"7.2 \u6280\u672F\u9009\u578B\u5EFA\u8BAE",id:"72-\u6280\u672F\u9009\u578B\u5EFA\u8BAE",level:3},{value:"7.3 \u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE",id:"73-\u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE",level:3}];function u(n){let e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"apache-kafka\u5206\u5E03\u5F0F\u6D41\u5904\u7406\u5E73\u53F0\u8BE6\u89E3",children:"Apache Kafka\u5206\u5E03\u5F0F\u6D41\u5904\u7406\u5E73\u53F0\u8BE6\u89E3"})}),"\n",(0,i.jsx)(e.p,{children:"Apache Kafka\u662F\u4E00\u4E2A\u5F00\u6E90\u7684\u5206\u5E03\u5F0F\u4E8B\u4EF6\u6D41\u5904\u7406\u5E73\u53F0\uFF0C\u7531LinkedIn\u5F00\u53D1\u5E76\u8D21\u732E\u7ED9Apache\u8F6F\u4EF6\u57FA\u91D1\u4F1A\u3002Kafka\u4EE5\u5176\u9AD8\u541E\u5410\u91CF\u3001\u4F4E\u5EF6\u8FDF\u3001\u9AD8\u53EF\u9760\u6027\u548C\u6C34\u5E73\u6269\u5C55\u80FD\u529B\u8457\u79F0\uFF0C\u5DF2\u6210\u4E3A\u73B0\u4EE3\u6570\u636E\u67B6\u6784\u4E2D\u4E0D\u53EF\u6216\u7F3A\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0C\u5E7F\u6CDB\u5E94\u7528\u4E8E\u5B9E\u65F6\u6570\u636E\u7BA1\u9053\u3001\u6D41\u5904\u7406\u5E94\u7528\u3001\u4E8B\u4EF6\u9A71\u52A8\u67B6\u6784\u7B49\u573A\u666F\u3002"}),"\n",(0,i.jsxs)(e.admonition,{title:"\u6838\u5FC3\u4EF7\u503C",type:"tip",children:[(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Kafka = \u9AD8\u541E\u5410\u91CF\u6D41\u5904\u7406 + \u5206\u5E03\u5F0F\u6301\u4E45\u5316 + \u5B9E\u65F6\u6570\u636E\u7BA1\u9053 + \u4E8B\u4EF6\u9A71\u52A8\u67B6\u6784"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u{1F680} ",(0,i.jsx)(e.strong,{children:"\u6781\u81F4\u6027\u80FD"}),"\uFF1A\u5355\u673A\u767E\u4E07\u7EA7TPS\uFF0C\u96C6\u7FA4\u53EF\u8FBE\u5343\u4E07\u7EA7\u6D88\u606F\u5904\u7406\u80FD\u529B"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F4CA} ",(0,i.jsx)(e.strong,{children:"\u6D41\u5F0F\u67B6\u6784"}),"\uFF1A\u7EDF\u4E00\u7684\u6D41\u5904\u7406\u548C\u6279\u5904\u7406\u5E73\u53F0\uFF0C\u652F\u6301\u5B9E\u65F6\u548C\u5386\u53F2\u6570\u636E\u5206\u6790"]}),"\n",(0,i.jsxs)(e.li,{children:["\uFFFD ",(0,i.jsx)(e.strong,{children:"\u6301\u6301\u4E45\u5316\u5B58\u50A8"}),"\uFF1A\u6D88\u606F\u6301\u4E45\u5316\u5230\u78C1\u76D8\uFF0C\u652F\u6301\u6570\u636E\u56DE\u6EAF\u548C\u91CD\u653E"]}),"\n",(0,i.jsxs)(e.li,{children:["\u{1F310} ",(0,i.jsx)(e.strong,{children:"\u5206\u5E03\u5F0F\u8BBE\u8BA1"}),"\uFF1A\u5929\u7136\u652F\u6301\u6C34\u5E73\u6269\u5C55\u548C\u9AD8\u53EF\u7528\u67B6\u6784"]}),"\n",(0,i.jsxs)(e.li,{children:["\uFFFD ",(0,i.jsx)(e.strong,{children:"\u751F\u6001\u5B8C\u6574"}),"*\uFF1A\u4E30\u5BCC\u7684\u8FDE\u63A5\u5668\u3001\u6D41\u5904\u7406\u6846\u67B6\u548C\u76D1\u63A7\u5DE5\u5177"]}),"\n"]})]}),"\n",(0,i.jsx)(e.h2,{id:"1-kafka\u57FA\u7840\u67B6\u6784\u4E0E\u8BBE\u8BA1\u7406\u5FF5",children:"1. Kafka\u57FA\u7840\u67B6\u6784\u4E0E\u8BBE\u8BA1\u7406\u5FF5"}),"\n",(0,i.jsx)(e.h3,{id:"11-kafka\u6838\u5FC3\u8BBE\u8BA1\u54F2\u5B66",children:"1.1 Kafka\u6838\u5FC3\u8BBE\u8BA1\u54F2\u5B66"}),"\n",(0,i.jsx)(e.p,{children:"Kafka\u7684\u8BBE\u8BA1\u9075\u5FAA\u4EE5\u4E0B\u6838\u5FC3\u7406\u5FF5\uFF0C\u8FD9\u4E9B\u7406\u5FF5\u51B3\u5B9A\u4E86\u5176\u5728\u5927\u6570\u636E\u548C\u5B9E\u65F6\u5904\u7406\u9886\u57DF\u7684\u72EC\u7279\u5730\u4F4D\uFF1A"}),"\n",(0,i.jsx)(e.mermaid,{value:"graph TB\n    A[Kafka\u8BBE\u8BA1\u7406\u5FF5] --\x3e B[\u9AD8\u541E\u5410\u91CF\u4F18\u5148]\n    A --\x3e C[\u5206\u5E03\u5F0F\u67B6\u6784]\n    A --\x3e D[\u6301\u4E45\u5316\u5B58\u50A8]\n    A --\x3e E[\u6D41\u5F0F\u5904\u7406]\n    A --\x3e F[\u5BB9\u9519\u673A\u5236]\n    \n    B --\x3e B1[\u987A\u5E8FI/O]\n    B --\x3e B2[\u96F6\u62F7\u8D1D\u6280\u672F]\n    B --\x3e B3[\u6279\u91CF\u5904\u7406]\n    B --\x3e B4[\u538B\u7F29\u4F18\u5316]\n    \n    C --\x3e C1[\u6C34\u5E73\u6269\u5C55]\n    C --\x3e C2[\u5206\u533A\u673A\u5236]\n    C --\x3e C3[\u526F\u672C\u7B56\u7565]\n    C --\x3e C4[\u8D1F\u8F7D\u5747\u8861]\n    \n    D --\x3e D1[\u65E5\u5FD7\u7ED3\u6784]\n    D --\x3e D2[\u6BB5\u6587\u4EF6\u7BA1\u7406]\n    D --\x3e D3[\u7D22\u5F15\u673A\u5236]\n    D --\x3e D4[\u6E05\u7406\u7B56\u7565]\n    \n    E --\x3e E1[\u4E8B\u4EF6\u6EAF\u6E90]\n    E --\x3e E2[\u6D41\u8868\u5BF9\u5076]\n    E --\x3e E3[\u65F6\u95F4\u7A97\u53E3]\n    E --\x3e E4[\u72B6\u6001\u7BA1\u7406]\n    \n    F --\x3e F1[\u526F\u672C\u673A\u5236]\n    F --\x3e F2[Leader\u9009\u4E3E]\n    F --\x3e F3[\u6545\u969C\u68C0\u6D4B]\n    F --\x3e F4[\u81EA\u52A8\u6062\u590D]"}),"\n",(0,i.jsx)(e.h4,{id:"\u8BBE\u8BA1\u539F\u5219\u8BE6\u89E3",children:"\u8BBE\u8BA1\u539F\u5219\u8BE6\u89E3"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"1. \u9AD8\u6027\u80FD\u4F18\u5148\u539F\u5219"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u987A\u5E8FI/O"}),"\uFF1A\u5229\u7528\u78C1\u76D8\u987A\u5E8F\u8BFB\u5199\u7684\u9AD8\u6027\u80FD\u7279\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u96F6\u62F7\u8D1D"}),"\uFF1A\u51CF\u5C11\u6570\u636E\u5728\u5185\u6838\u6001\u548C\u7528\u6237\u6001\u4E4B\u95F4\u7684\u62F7\u8D1D"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6279\u91CF\u64CD\u4F5C"}),"\uFF1A\u901A\u8FC7\u6279\u5904\u7406\u63D0\u9AD8\u541E\u5410\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9875\u7F13\u5B58"}),"\uFF1A\u5145\u5206\u5229\u7528\u64CD\u4F5C\u7CFB\u7EDF\u7684\u9875\u7F13\u5B58\u673A\u5236"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"2. \u5206\u5E03\u5F0F\u67B6\u6784\u539F\u5219"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u65E0\u72B6\u6001\u8BBE\u8BA1"}),"\uFF1ABroker\u8282\u70B9\u65E0\u72B6\u6001\uFF0C\u4FBF\u4E8E\u6269\u5C55"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u533A\u5E76\u884C"}),"\uFF1A\u901A\u8FC7\u5206\u533A\u5B9E\u73B0\u5E76\u884C\u5904\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u526F\u672C\u5197\u4F59"}),"\uFF1A\u591A\u526F\u672C\u4FDD\u8BC1\u6570\u636E\u5B89\u5168"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5F39\u6027\u6269\u5C55"}),"\uFF1A\u652F\u6301\u52A8\u6001\u6DFB\u52A0\u8282\u70B9"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"3. \u6301\u4E45\u5316\u5B58\u50A8\u539F\u5219"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u65E5\u5FD7\u7ED3\u6784"}),"\uFF1A\u91C7\u7528\u53EA\u8FFD\u52A0\u7684\u65E5\u5FD7\u7ED3\u6784"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u6BB5\u5B58\u50A8"}),"\uFF1A\u5C06\u65E5\u5FD7\u5206\u6BB5\u5B58\u50A8\uFF0C\u4FBF\u4E8E\u7BA1\u7406"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u538B\u7F29\u5B58\u50A8"}),"\uFF1A\u652F\u6301\u591A\u79CD\u538B\u7F29\u7B97\u6CD5"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6E05\u7406\u7B56\u7565"}),"\uFF1A\u652F\u6301\u57FA\u4E8E\u65F6\u95F4\u548C\u5927\u5C0F\u7684\u6E05\u7406"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"12-kafka\u5E94\u7528\u573A\u666F\u5168\u666F\u56FE",children:"1.2 Kafka\u5E94\u7528\u573A\u666F\u5168\u666F\u56FE"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u5E94\u7528\u573A\u666F"}),(0,i.jsx)(e.th,{children:"\u4F20\u7EDF\u89E3\u51B3\u65B9\u6848"}),(0,i.jsx)(e.th,{children:"Kafka\u89E3\u51B3\u65B9\u6848"}),(0,i.jsx)(e.th,{children:"\u6838\u5FC3\u4F18\u52BF"}),(0,i.jsx)(e.th,{children:"\u9002\u7528\u89C4\u6A21"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5B9E\u65F6\u6570\u636E\u7BA1\u9053"})}),(0,i.jsx)(e.td,{children:"ETL\u5DE5\u5177 + \u6570\u636E\u5E93"}),(0,i.jsx)(e.td,{children:"Kafka Connect + Streams"}),(0,i.jsx)(e.td,{children:"\u5B9E\u65F6\u6027\u3001\u53EF\u6269\u5C55\u6027"}),(0,i.jsx)(e.td,{children:"\u5927\u89C4\u6A21\u6570\u636E\u6D41"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4E8B\u4EF6\u9A71\u52A8\u67B6\u6784"})}),(0,i.jsx)(e.td,{children:"\u6D88\u606F\u961F\u5217 + \u4E8B\u4EF6\u603B\u7EBF"}),(0,i.jsx)(e.td,{children:"Kafka + Schema Registry"}),(0,i.jsx)(e.td,{children:"\u89E3\u8026\u3001\u53EF\u8FFD\u6EAF"}),(0,i.jsx)(e.td,{children:"\u5FAE\u670D\u52A1\u67B6\u6784"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u65E5\u5FD7\u805A\u5408"})}),(0,i.jsx)(e.td,{children:"\u6587\u4EF6\u7CFB\u7EDF + \u65E5\u5FD7\u6536\u96C6\u5668"}),(0,i.jsx)(e.td,{children:"Kafka + ELK Stack"}),(0,i.jsx)(e.td,{children:"\u7EDF\u4E00\u6536\u96C6\u3001\u5B9E\u65F6\u5206\u6790"}),(0,i.jsx)(e.td,{children:"\u5206\u5E03\u5F0F\u7CFB\u7EDF"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6D41\u5904\u7406"})}),(0,i.jsx)(e.td,{children:"Storm/Spark Streaming"}),(0,i.jsx)(e.td,{children:"Kafka Streams"}),(0,i.jsx)(e.td,{children:"\u7B80\u5316\u67B6\u6784\u3001\u4F4E\u5EF6\u8FDF"}),(0,i.jsx)(e.td,{children:"\u5B9E\u65F6\u8BA1\u7B97\u573A\u666F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6307\u6807\u76D1\u63A7"})}),(0,i.jsx)(e.td,{children:"\u65F6\u5E8F\u6570\u636E\u5E93"}),(0,i.jsx)(e.td,{children:"Kafka + InfluxDB"}),(0,i.jsx)(e.td,{children:"\u9AD8\u541E\u5410\u3001\u5B9E\u65F6\u544A\u8B66"}),(0,i.jsx)(e.td,{children:"\u76D1\u63A7\u7CFB\u7EDF"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"CQRS/\u4E8B\u4EF6\u6EAF\u6E90"})}),(0,i.jsx)(e.td,{children:"\u6570\u636E\u5E93 + \u4E8B\u4EF6\u8868"}),(0,i.jsx)(e.td,{children:"Kafka + \u5FEB\u7167\u5B58\u50A8"}),(0,i.jsx)(e.td,{children:"\u9AD8\u6027\u80FD\u3001\u6613\u6269\u5C55"}),(0,i.jsx)(e.td,{children:"\u590D\u6742\u4E1A\u52A1\u7CFB\u7EDF"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:""}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"Kafka\u6838\u5FC3\u7EC4\u4EF6\u6DF1\u5EA6\u89E3\u6790"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"21-broker\u4EE3\u7406\u670D\u52A1\u5668--\u96C6\u7FA4\u7684\u57FA\u77F3",children:"2.1 Broker\uFF08\u4EE3\u7406\u670D\u52A1\u5668\uFF09- \u96C6\u7FA4\u7684\u57FA\u77F3"}),"\n",(0,i.jsx)(e.p,{children:"Broker\u662FKafka\u96C6\u7FA4\u4E2D\u7684\u6838\u5FC3\u670D\u52A1\u8282\u70B9\uFF0C\u6BCF\u4E2ABroker\u90FD\u662F\u4E00\u4E2A\u72EC\u7ACB\u7684Kafka\u670D\u52A1\u5668\u5B9E\u4F8B\uFF0C\u8D1F\u8D23\u5B58\u50A8\u6570\u636E\u3001\u5904\u7406\u5BA2\u6237\u7AEF\u8BF7\u6C42\u548C\u53C2\u4E0E\u96C6\u7FA4\u534F\u8C03\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"architecture",label:"Broker\u67B6\u6784",children:(0,i.jsx)(e.mermaid,{value:'graph TB\n    subgraph "Kafka Broker\u5185\u90E8\u67B6\u6784"\n        A[\u7F51\u7EDC\u5C42] --\x3e B[API\u5C42]\n        B --\x3e C[\u65E5\u5FD7\u7BA1\u7406\u5668]\n        B --\x3e D[\u526F\u672C\u7BA1\u7406\u5668]\n        B --\x3e E[\u63A7\u5236\u5668]\n        B --\x3e F[\u7EC4\u534F\u8C03\u5668]\n        \n        C --\x3e C1[\u65E5\u5FD7\u6BB5]\n        C --\x3e C2[\u7D22\u5F15\u6587\u4EF6]\n        C --\x3e C3[\u65F6\u95F4\u7D22\u5F15]\n        \n        D --\x3e D1[Leader\u526F\u672C]\n        D --\x3e D2[Follower\u526F\u672C]\n        D --\x3e D3[ISR\u7BA1\u7406]\n        \n        E --\x3e E1[\u5206\u533A\u5206\u914D]\n        E --\x3e E2[Leader\u9009\u4E3E]\n        E --\x3e E3[\u5143\u6570\u636E\u7BA1\u7406]\n        \n        F --\x3e F1[\u6D88\u8D39\u8005\u7EC4\u7BA1\u7406]\n        F --\x3e F2[\u4F4D\u79FB\u7BA1\u7406]\n        F --\x3e F3[\u91CD\u5E73\u8861\u534F\u8C03]\n    end'})}),(0,i.jsx)(a.A,{value:"config",label:"Broker\u914D\u7F6E\u8BE6\u89E3",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",metastring:'title="server.properties - Broker\u6838\u5FC3\u914D\u7F6E"',children:"############################# \u57FA\u7840\u914D\u7F6E #############################\n# Broker\u5728\u96C6\u7FA4\u4E2D\u7684\u552F\u4E00\u6807\u8BC6\uFF0C\u5FC5\u987B\u4E3A\u6B63\u6574\u6570\u4E14\u96C6\u7FA4\u5185\u552F\u4E00\nbroker.id=0\n\n# Broker\u76D1\u542C\u7684\u7F51\u7EDC\u63A5\u53E3\u548C\u7AEF\u53E3\u914D\u7F6E\n# PLAINTEXT: \u660E\u6587\u4F20\u8F93\u534F\u8BAE\n# SSL: \u52A0\u5BC6\u4F20\u8F93\u534F\u8BAE  \n# SASL_PLAINTEXT: SASL\u8BA4\u8BC1 + \u660E\u6587\u4F20\u8F93\n# SASL_SSL: SASL\u8BA4\u8BC1 + \u52A0\u5BC6\u4F20\u8F93\nlisteners=PLAINTEXT://localhost:9092\n\n# \u5916\u90E8\u5BA2\u6237\u7AEF\u8FDE\u63A5\u7684\u5730\u5740\uFF0C\u7528\u4E8E\u5BA2\u6237\u7AEF\u53D1\u73B0\nadvertised.listeners=PLAINTEXT://localhost:9092\n\n# \u7F51\u7EDC\u7EBF\u7A0B\u6570\uFF0C\u5904\u7406\u7F51\u7EDC\u8BF7\u6C42\n# \u5EFA\u8BAE\u8BBE\u7F6E\u4E3ACPU\u6838\u6570\uFF0C\u9AD8\u5E76\u53D1\u573A\u666F\u53EF\u9002\u5F53\u589E\u52A0\nnum.network.threads=8\n\n# I/O\u7EBF\u7A0B\u6570\uFF0C\u5904\u7406\u78C1\u76D8\u8BFB\u5199\n# \u5EFA\u8BAE\u8BBE\u7F6E\u4E3A\u78C1\u76D8\u6570\u91CF\u76842-3\u500D\nnum.io.threads=16\n\n# Socket\u53D1\u9001\u7F13\u51B2\u533A\u5927\u5C0F\uFF08\u5B57\u8282\uFF09\nsocket.send.buffer.bytes=102400\n\n# Socket\u63A5\u6536\u7F13\u51B2\u533A\u5927\u5C0F\uFF08\u5B57\u8282\uFF09\nsocket.receive.buffer.bytes=102400\n\n# \u5355\u4E2A\u8BF7\u6C42\u7684\u6700\u5927\u5927\u5C0F\uFF08\u5B57\u8282\uFF09\nsocket.request.max.bytes=104857600\n\n############################# \u65E5\u5FD7\u914D\u7F6E #############################\n# \u65E5\u5FD7\u6587\u4EF6\u5B58\u50A8\u76EE\u5F55\uFF0C\u652F\u6301\u591A\u4E2A\u76EE\u5F55\u4EE5\u9017\u53F7\u5206\u9694\n# \u591A\u76EE\u5F55\u53EF\u4EE5\u5206\u6563I/O\u8D1F\u8F7D\uFF0C\u63D0\u9AD8\u6027\u80FD\nlog.dirs=/var/kafka-logs-1,/var/kafka-logs-2,/var/kafka-logs-3\n\n# \u6BCF\u4E2ATopic\u7684\u9ED8\u8BA4\u5206\u533A\u6570\nnum.partitions=3\n\n# \u65E5\u5FD7\u4FDD\u7559\u65F6\u95F4\uFF08\u5C0F\u65F6\uFF09\uFF0C\u9ED8\u8BA47\u5929\nlog.retention.hours=168\n\n# \u65E5\u5FD7\u6BB5\u6587\u4EF6\u5927\u5C0F\uFF08\u5B57\u8282\uFF09\uFF0C\u9ED8\u8BA41GB\nlog.segment.bytes=1073741824\n\n# \u65E5\u5FD7\u6BB5\u6EDA\u52A8\u65F6\u95F4\u95F4\u9694\uFF08\u6BEB\u79D2\uFF09\uFF0C\u9ED8\u8BA47\u5929\nlog.roll.hours=168\n\n# \u65E5\u5FD7\u6E05\u7406\u68C0\u67E5\u95F4\u9694\uFF08\u6BEB\u79D2\uFF09\nlog.retention.check.interval.ms=300000\n\n############################# \u526F\u672C\u914D\u7F6E #############################\n# \u9ED8\u8BA4\u526F\u672C\u56E0\u5B50\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u4E3A3\ndefault.replication.factor=3\n\n# \u6700\u5C0F\u540C\u6B65\u526F\u672C\u6570\uFF0C\u5EFA\u8BAE\u8BBE\u7F6E\u4E3A\u526F\u672C\u56E0\u5B50-1\nmin.insync.replicas=2\n\n# \u526F\u672C\u62C9\u53D6\u7B49\u5F85\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\nreplica.fetch.wait.max.ms=500\n\n# \u526F\u672C\u62C9\u53D6\u6700\u5927\u5B57\u8282\u6570\nreplica.fetch.max.bytes=1048576\n\n############################# ZooKeeper\u914D\u7F6E #############################\n# ZooKeeper\u8FDE\u63A5\u5B57\u7B26\u4E32\nzookeeper.connect=localhost:2181\n\n# ZooKeeper\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\nzookeeper.connection.timeout.ms=18000\n\n# ZooKeeper\u4F1A\u8BDD\u8D85\u65F6\u65F6\u95F4\uFF08\u6BEB\u79D2\uFF09\nzookeeper.session.timeout.ms=18000\n\n############################# \u6027\u80FD\u4F18\u5316\u914D\u7F6E #############################\n# \u6D88\u606F\u6700\u5927\u5927\u5C0F\uFF08\u5B57\u8282\uFF09\nmessage.max.bytes=1000000\n\n# \u526F\u672C\u62C9\u53D6\u6D88\u606F\u6700\u5927\u5927\u5C0F\uFF08\u5B57\u8282\uFF09\nreplica.fetch.max.bytes=1048576\n\n# \u751F\u4EA7\u8005\u8BF7\u6C42\u961F\u5217\u6700\u5927\u5927\u5C0F\nqueued.max.requests=500\n\n# \u81EA\u52A8\u521B\u5EFATopic\u5F00\u5173\uFF0C\u751F\u4EA7\u73AF\u5883\u5EFA\u8BAE\u5173\u95ED\nauto.create.topics.enable=false\n\n# \u5220\u9664Topic\u5F00\u5173\ndelete.topic.enable=true\n\n# \u538B\u7F29\u7C7B\u578B\uFF1Anone, gzip, snappy, lz4, zstd\ncompression.type=lz4\n\n# \u65E5\u5FD7\u5237\u76D8\u7B56\u7565\nlog.flush.interval.messages=10000\nlog.flush.interval.ms=1000\n\n# \u540E\u53F0\u7EBF\u7A0B\u6570\nbackground.threads=10\n"})})}),(0,i.jsx)(a.A,{value:"monitoring",label:"Broker\u76D1\u63A7",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Broker\u72B6\u6001\u76D1\u63A7\u5B9E\u73B0"',children:'import org.apache.kafka.clients.admin.*;\nimport org.apache.kafka.common.Node;\nimport java.util.*;\nimport java.util.concurrent.ExecutionException;\n\n/**\n * Kafka Broker\u76D1\u63A7\u5DE5\u5177\u7C7B\n * \u63D0\u4F9B\u96C6\u7FA4\u72B6\u6001\u3001\u8282\u70B9\u4FE1\u606F\u3001\u6027\u80FD\u6307\u6807\u7B49\u76D1\u63A7\u529F\u80FD\n */\npublic class KafkaBrokerMonitor {\n    \n    private final AdminClient adminClient;\n    \n    public KafkaBrokerMonitor(String bootstrapServers) {\n        Properties props = new Properties();\n        props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, 30000);\n        props.put(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, 60000);\n        this.adminClient = AdminClient.create(props);\n    }\n    \n    /**\n     * \u83B7\u53D6\u96C6\u7FA4\u57FA\u672C\u4FE1\u606F\n     */\n    public ClusterInfo getClusterInfo() {\n        try {\n            DescribeClusterResult clusterResult = adminClient.describeCluster();\n            \n            // \u83B7\u53D6\u96C6\u7FA4ID\n            String clusterId = clusterResult.clusterId().get();\n            \n            // \u83B7\u53D6Controller\u8282\u70B9\n            Node controller = clusterResult.controller().get();\n            \n            // \u83B7\u53D6\u6240\u6709\u8282\u70B9\n            Collection<Node> nodes = clusterResult.nodes().get();\n            \n            return new ClusterInfo(clusterId, controller, nodes);\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u83B7\u53D6\u96C6\u7FA4\u4FE1\u606F\u5931\u8D25", e);\n        }\n    }\n    \n    /**\n     * \u68C0\u67E5Broker\u5065\u5EB7\u72B6\u6001\n     */\n    public Map<Integer, BrokerHealth> checkBrokerHealth() {\n        Map<Integer, BrokerHealth> healthMap = new HashMap<>();\n        \n        try {\n            ClusterInfo clusterInfo = getClusterInfo();\n            \n            for (Node node : clusterInfo.getNodes()) {\n                BrokerHealth health = new BrokerHealth();\n                health.setBrokerId(node.id());\n                health.setHost(node.host());\n                health.setPort(node.port());\n                health.setIsController(node.id() == clusterInfo.getController().id());\n                \n                // \u68C0\u67E5\u8282\u70B9\u662F\u5426\u5728\u7EBF\n                health.setOnline(isNodeOnline(node));\n                \n                // \u83B7\u53D6\u8282\u70B9\u8D1F\u8F7D\u4FE1\u606F\n                health.setPartitionCount(getPartitionCount(node.id()));\n                health.setLeaderCount(getLeaderCount(node.id()));\n                \n                healthMap.put(node.id(), health);\n            }\n            \n        } catch (Exception e) {\n            System.err.println("\u68C0\u67E5Broker\u5065\u5EB7\u72B6\u6001\u5931\u8D25: " + e.getMessage());\n        }\n        \n        return healthMap;\n    }\n    \n    /**\n     * \u68C0\u67E5\u8282\u70B9\u662F\u5426\u5728\u7EBF\n     */\n    private boolean isNodeOnline(Node node) {\n        try {\n            // \u901A\u8FC7\u63CF\u8FF0\u96C6\u7FA4\u6765\u68C0\u67E5\u8282\u70B9\u662F\u5426\u54CD\u5E94\n            DescribeClusterOptions options = new DescribeClusterOptions()\n                .timeoutMs(5000);\n            adminClient.describeCluster(options).nodes().get();\n            return true;\n        } catch (Exception e) {\n            return false;\n        }\n    }\n    \n    /**\n     * \u83B7\u53D6\u6307\u5B9ABroker\u7684\u5206\u533A\u6570\u91CF\n     */\n    private int getPartitionCount(int brokerId) {\n        try {\n            ListTopicsResult topicsResult = adminClient.listTopics();\n            Set<String> topicNames = topicsResult.names().get();\n            \n            DescribeTopicsResult describeResult = adminClient.describeTopics(topicNames);\n            Map<String, TopicDescription> topicDescriptions = describeResult.all().get();\n            \n            int partitionCount = 0;\n            for (TopicDescription description : topicDescriptions.values()) {\n                for (TopicPartitionInfo partition : description.partitions()) {\n                    // \u68C0\u67E5\u8BE5\u5206\u533A\u7684\u526F\u672C\u662F\u5426\u5728\u6307\u5B9ABroker\u4E0A\n                    for (Node replica : partition.replicas()) {\n                        if (replica.id() == brokerId) {\n                            partitionCount++;\n                            break;\n                        }\n                    }\n                }\n            }\n            \n            return partitionCount;\n        } catch (Exception e) {\n            return -1;\n        }\n    }\n    \n    /**\n     * \u83B7\u53D6\u6307\u5B9ABroker\u4F5C\u4E3ALeader\u7684\u5206\u533A\u6570\u91CF\n     */\n    private int getLeaderCount(int brokerId) {\n        try {\n            ListTopicsResult topicsResult = adminClient.listTopics();\n            Set<String> topicNames = topicsResult.names().get();\n            \n            DescribeTopicsResult describeResult = adminClient.describeTopics(topicNames);\n            Map<String, TopicDescription> topicDescriptions = describeResult.all().get();\n            \n            int leaderCount = 0;\n            for (TopicDescription description : topicDescriptions.values()) {\n                for (TopicPartitionInfo partition : description.partitions()) {\n                    if (partition.leader() != null && partition.leader().id() == brokerId) {\n                        leaderCount++;\n                    }\n                }\n            }\n            \n            return leaderCount;\n        } catch (Exception e) {\n            return -1;\n        }\n    }\n    \n    /**\n     * \u6253\u5370\u96C6\u7FA4\u72B6\u6001\u62A5\u544A\n     */\n    public void printClusterReport() {\n        System.out.println("=== Kafka\u96C6\u7FA4\u72B6\u6001\u62A5\u544A ===");\n        \n        ClusterInfo clusterInfo = getClusterInfo();\n        System.out.println("\u96C6\u7FA4ID: " + clusterInfo.getClusterId());\n        System.out.println("Controller: Broker-" + clusterInfo.getController().id() + \n                         " (" + clusterInfo.getController().host() + ":" + \n                         clusterInfo.getController().port() + ")");\n        System.out.println("\u8282\u70B9\u603B\u6570: " + clusterInfo.getNodes().size());\n        \n        System.out.println("\\n=== Broker\u5065\u5EB7\u72B6\u6001 ===");\n        Map<Integer, BrokerHealth> healthMap = checkBrokerHealth();\n        \n        for (BrokerHealth health : healthMap.values()) {\n            System.out.printf("Broker-%d [%s:%d] - %s%s - \u5206\u533A\u6570: %d, Leader\u6570: %d%n",\n                health.getBrokerId(),\n                health.getHost(),\n                health.getPort(),\n                health.isOnline() ? "\u5728\u7EBF" : "\u79BB\u7EBF",\n                health.isController() ? " (Controller)" : "",\n                health.getPartitionCount(),\n                health.getLeaderCount()\n            );\n        }\n    }\n    \n    public void close() {\n        adminClient.close();\n    }\n    \n    // \u5185\u90E8\u7C7B\u5B9A\u4E49\n    public static class ClusterInfo {\n        private String clusterId;\n        private Node controller;\n        private Collection<Node> nodes;\n        \n        public ClusterInfo(String clusterId, Node controller, Collection<Node> nodes) {\n            this.clusterId = clusterId;\n            this.controller = controller;\n            this.nodes = nodes;\n        }\n        \n        // Getters\n        public String getClusterId() { return clusterId; }\n        public Node getController() { return controller; }\n        public Collection<Node> getNodes() { return nodes; }\n    }\n    \n    public static class BrokerHealth {\n        private int brokerId;\n        private String host;\n        private int port;\n        private boolean online;\n        private boolean isController;\n        private int partitionCount;\n        private int leaderCount;\n        \n        // Getters and Setters\n        public int getBrokerId() { return brokerId; }\n        public void setBrokerId(int brokerId) { this.brokerId = brokerId; }\n        \n        public String getHost() { return host; }\n        public void setHost(String host) { this.host = host; }\n        \n        public int getPort() { return port; }\n        public void setPort(int port) { this.port = port; }\n        \n        public boolean isOnline() { return online; }\n        public void setOnline(boolean online) { this.online = online; }\n        \n        public boolean isController() { return isController; }\n        public void setIsController(boolean isController) { this.isController = isController; }\n        \n        public int getPartitionCount() { return partitionCount; }\n        public void setPartitionCount(int partitionCount) { this.partitionCount = partitionCount; }\n        \n        public int getLeaderCount() { return leaderCount; }\n        public void setLeaderCount(int leaderCount) { this.leaderCount = leaderCount; }\n    }\n}\n\n// \u4F7F\u7528\u793A\u4F8B\npublic class BrokerMonitorExample {\n    public static void main(String[] args) {\n        KafkaBrokerMonitor monitor = new KafkaBrokerMonitor("localhost:9092");\n        \n        try {\n            // \u6253\u5370\u96C6\u7FA4\u72B6\u6001\u62A5\u544A\n            monitor.printClusterReport();\n            \n            // \u5B9A\u671F\u76D1\u63A7\uFF08\u6BCF30\u79D2\u68C0\u67E5\u4E00\u6B21\uFF09\n            Timer timer = new Timer();\n            timer.scheduleAtFixedRate(new TimerTask() {\n                @Override\n                public void run() {\n                    System.out.println("\\n" + new Date() + " - \u96C6\u7FA4\u5065\u5EB7\u68C0\u67E5");\n                    monitor.printClusterReport();\n                }\n            }, 0, 30000);\n            \n        } finally {\n            // \u7A0B\u5E8F\u9000\u51FA\u65F6\u5173\u95ED\u76D1\u63A7\n            Runtime.getRuntime().addShutdownHook(new Thread(() -> {\n                monitor.close();\n            }));\n        }\n    }\n}\n'})})})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Broker\u6838\u5FC3\u804C\u8D23"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6570\u636E\u5B58\u50A8"}),"\uFF1A\u7BA1\u7406Topic\u5206\u533A\u7684\u65E5\u5FD7\u6587\u4EF6\u548C\u7D22\u5F15"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8BF7\u6C42\u5904\u7406"}),"\uFF1A\u5904\u7406\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u7684\u8BFB\u5199\u8BF7\u6C42"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u526F\u672C\u7BA1\u7406"}),"\uFF1A\u7EF4\u62A4\u5206\u533A\u526F\u672C\u7684\u540C\u6B65\u72B6\u6001"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u96C6\u7FA4\u534F\u8C03"}),"\uFF1A\u53C2\u4E0ELeader\u9009\u4E3E\u548C\u5143\u6570\u636E\u540C\u6B65"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5BA2\u6237\u7AEF\u670D\u52A1"}),"\uFF1A\u63D0\u4F9B\u5143\u6570\u636E\u4FE1\u606F\u548C\u8DEF\u7531\u670D\u52A1#"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"22-topic\u4E3B\u9898--\u6D88\u606F\u5206\u7C7B\u7684\u903B\u8F91\u5BB9\u5668",children:"2.2 Topic\uFF08\u4E3B\u9898\uFF09- \u6D88\u606F\u5206\u7C7B\u7684\u903B\u8F91\u5BB9\u5668"}),"\n",(0,i.jsx)(e.p,{children:"Topic\u662FKafka\u4E2D\u6D88\u606F\u7684\u903B\u8F91\u5206\u7C7B\u5355\u5143\uFF0C\u7C7B\u4F3C\u4E8E\u6570\u636E\u5E93\u4E2D\u7684\u8868\u6216\u6587\u4EF6\u7CFB\u7EDF\u4E2D\u7684\u6587\u4EF6\u5939\u3002\u6BCF\u4E2ATopic\u53EF\u4EE5\u6709\u591A\u4E2A\u751F\u4EA7\u8005\u5199\u5165\u6570\u636E\uFF0C\u591A\u4E2A\u6D88\u8D39\u8005\u8BFB\u53D6\u6570\u636E\uFF0C\u662FKafka\u6D88\u606F\u7CFB\u7EDF\u7684\u6838\u5FC3\u62BD\u8C61\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"concept",label:"Topic\u6982\u5FF5\u6A21\u578B",children:(0,i.jsx)(e.mermaid,{value:'graph TB\n    subgraph "Topic\u903B\u8F91\u7ED3\u6784"\n        T[Topic: user-events] --\x3e P0[Partition 0]\n        T --\x3e P1[Partition 1] \n        T --\x3e P2[Partition 2]\n        \n        P0 --\x3e P0R0[Replica 0 - Leader]\n        P0 --\x3e P0R1[Replica 1 - Follower]\n        P0 --\x3e P0R2[Replica 2 - Follower]\n        \n        P1 --\x3e P1R0[Replica 0 - Follower]\n        P1 --\x3e P1R1[Replica 1 - Leader]\n        P1 --\x3e P1R2[Replica 2 - Follower]\n        \n        P2 --\x3e P2R0[Replica 0 - Follower]\n        P2 --\x3e P2R1[Replica 1 - Follower]\n        P2 --\x3e P2R2[Replica 2 - Leader]\n    end\n    \n    subgraph "\u6D88\u606F\u6D41\u5411"\n        Producer1[Producer 1] --\x3e T\n        Producer2[Producer 2] --\x3e T\n        Producer3[Producer 3] --\x3e T\n        \n        T --\x3e Consumer1[Consumer Group A]\n        T --\x3e Consumer2[Consumer Group B]\n    end'})}),(0,i.jsx)(a.A,{value:"management",label:"Topic\u7BA1\u7406",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Topic\u7BA1\u7406\u5B8C\u6574\u5B9E\u73B0"',children:'import org.apache.kafka.clients.admin.*;\nimport org.apache.kafka.common.config.ConfigResource;\nimport java.util.*;\nimport java.util.concurrent.ExecutionException;\n\n/**\n * Kafka Topic\u7BA1\u7406\u5DE5\u5177\u7C7B\n * \u63D0\u4F9BTopic\u7684\u521B\u5EFA\u3001\u5220\u9664\u3001\u914D\u7F6E\u3001\u76D1\u63A7\u7B49\u5B8C\u6574\u529F\u80FD\n */\npublic class KafkaTopicManager {\n    \n    private final AdminClient adminClient;\n    \n    public KafkaTopicManager(String bootstrapServers) {\n        Properties props = new Properties();\n        props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, 30000);\n        this.adminClient = AdminClient.create(props);\n    }\n    \n    /**\n     * \u521B\u5EFATopic\uFF08\u5E26\u5B8C\u6574\u914D\u7F6E\uFF09\n     */\n    public void createTopic(String topicName, int partitions, short replicationFactor, \n                           Map<String, String> configs) {\n        try {\n            // \u68C0\u67E5Topic\u662F\u5426\u5DF2\u5B58\u5728\n            if (topicExists(topicName)) {\n                System.out.println("Topic \'" + topicName + "\' \u5DF2\u5B58\u5728");\n                return;\n            }\n            \n            // \u521B\u5EFANewTopic\u5BF9\u8C61\n            NewTopic newTopic = new NewTopic(topicName, partitions, replicationFactor);\n            \n            // \u8BBE\u7F6ETopic\u914D\u7F6E\n            if (configs != null && !configs.isEmpty()) {\n                newTopic.configs(configs);\n            }\n            \n            // \u6267\u884C\u521B\u5EFA\u64CD\u4F5C\n            CreateTopicsResult result = adminClient.createTopics(Arrays.asList(newTopic));\n            result.all().get(); // \u7B49\u5F85\u521B\u5EFA\u5B8C\u6210\n            \n            System.out.println("Topic \'" + topicName + "\' \u521B\u5EFA\u6210\u529F");\n            System.out.println("  \u5206\u533A\u6570: " + partitions);\n            System.out.println("  \u526F\u672C\u56E0\u5B50: " + replicationFactor);\n            if (configs != null) {\n                System.out.println("  \u914D\u7F6E\u9879: " + configs);\n            }\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u521B\u5EFATopic\u5931\u8D25: " + topicName, e);\n        }\n    }\n    \n    /**\n     * \u521B\u5EFA\u4E1A\u52A1Topic\u7684\u4FBF\u6377\u65B9\u6CD5\n     */\n    public void createBusinessTopic(String topicName, TopicType type) {\n        Map<String, String> configs = new HashMap<>();\n        int partitions;\n        short replicationFactor = 3;\n        \n        switch (type) {\n            case HIGH_THROUGHPUT:\n                // \u9AD8\u541E\u5410\u91CFTopic\u914D\u7F6E\n                partitions = 12;\n                configs.put("compression.type", "lz4");\n                configs.put("min.insync.replicas", "2");\n                configs.put("retention.ms", "604800000"); // 7\u5929\n                configs.put("segment.ms", "86400000");    // 1\u5929\n                break;\n                \n            case LOW_LATENCY:\n                // \u4F4E\u5EF6\u8FDFTopic\u914D\u7F6E\n                partitions = 6;\n                configs.put("compression.type", "none");\n                configs.put("min.insync.replicas", "2");\n                configs.put("retention.ms", "259200000"); // 3\u5929\n                configs.put("segment.ms", "3600000");     // 1\u5C0F\u65F6\n                break;\n                \n            case LONG_RETENTION:\n                // \u957F\u671F\u4FDD\u7559Topic\u914D\u7F6E\n                partitions = 6;\n                configs.put("compression.type", "gzip");\n                configs.put("min.insync.replicas", "2");\n                configs.put("retention.ms", "2592000000"); // 30\u5929\n                configs.put("segment.ms", "604800000");     // 7\u5929\n                configs.put("cleanup.policy", "delete");\n                break;\n                \n            case COMPACTED:\n                // \u538B\u7F29Topic\u914D\u7F6E\uFF08\u9002\u7528\u4E8E\u72B6\u6001\u5B58\u50A8\uFF09\n                partitions = 6;\n                configs.put("cleanup.policy", "compact");\n                configs.put("compression.type", "snappy");\n                configs.put("min.cleanable.dirty.ratio", "0.1");\n                configs.put("segment.ms", "86400000"); // 1\u5929\n                break;\n                \n            default:\n                // \u9ED8\u8BA4\u914D\u7F6E\n                partitions = 3;\n                configs.put("retention.ms", "604800000"); // 7\u5929\n        }\n        \n        createTopic(topicName, partitions, replicationFactor, configs);\n    }\n    \n    /**\n     * \u68C0\u67E5Topic\u662F\u5426\u5B58\u5728\n     */\n    public boolean topicExists(String topicName) {\n        try {\n            ListTopicsResult result = adminClient.listTopics();\n            Set<String> topicNames = result.names().get();\n            return topicNames.contains(topicName);\n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u68C0\u67E5Topic\u5B58\u5728\u6027\u5931\u8D25", e);\n        }\n    }\n    \n    /**\n     * \u83B7\u53D6Topic\u8BE6\u7EC6\u4FE1\u606F\n     */\n    public TopicInfo getTopicInfo(String topicName) {\n        try {\n            // \u83B7\u53D6Topic\u63CF\u8FF0\u4FE1\u606F\n            DescribeTopicsResult describeResult = adminClient.describeTopics(Arrays.asList(topicName));\n            TopicDescription description = describeResult.all().get().get(topicName);\n            \n            // \u83B7\u53D6Topic\u914D\u7F6E\u4FE1\u606F\n            ConfigResource configResource = new ConfigResource(ConfigResource.Type.TOPIC, topicName);\n            DescribeConfigsResult configResult = adminClient.describeConfigs(Arrays.asList(configResource));\n            Config config = configResult.all().get().get(configResource);\n            \n            return new TopicInfo(description, config);\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u83B7\u53D6Topic\u4FE1\u606F\u5931\u8D25: " + topicName, e);\n        }\n    }\n    \n    /**\n     * \u5217\u51FA\u6240\u6709Topic\n     */\n    public List<String> listTopics() {\n        try {\n            ListTopicsResult result = adminClient.listTopics();\n            return new ArrayList<>(result.names().get());\n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u5217\u51FATopic\u5931\u8D25", e);\n        }\n    }\n    \n    /**\n     * \u5220\u9664Topic\n     */\n    public void deleteTopic(String topicName) {\n        try {\n            if (!topicExists(topicName)) {\n                System.out.println("Topic \'" + topicName + "\' \u4E0D\u5B58\u5728");\n                return;\n            }\n            \n            DeleteTopicsResult result = adminClient.deleteTopics(Arrays.asList(topicName));\n            result.all().get(); // \u7B49\u5F85\u5220\u9664\u5B8C\u6210\n            \n            System.out.println("Topic \'" + topicName + "\' \u5220\u9664\u6210\u529F");\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u5220\u9664Topic\u5931\u8D25: " + topicName, e);\n        }\n    }\n    \n    /**\n     * \u4FEE\u6539Topic\u914D\u7F6E\n     */\n    public void updateTopicConfig(String topicName, Map<String, String> configUpdates) {\n        try {\n            ConfigResource resource = new ConfigResource(ConfigResource.Type.TOPIC, topicName);\n            \n            // \u6784\u5EFA\u914D\u7F6E\u66F4\u65B0\u64CD\u4F5C\n            Map<ConfigResource, Collection<AlterConfigOp>> configs = new HashMap<>();\n            Collection<AlterConfigOp> ops = new ArrayList<>();\n            \n            for (Map.Entry<String, String> entry : configUpdates.entrySet()) {\n                ops.add(new AlterConfigOp(\n                    new ConfigEntry(entry.getKey(), entry.getValue()),\n                    AlterConfigOp.OpType.SET\n                ));\n            }\n            \n            configs.put(resource, ops);\n            \n            // \u6267\u884C\u914D\u7F6E\u66F4\u65B0\n            AlterConfigsResult result = adminClient.incrementalAlterConfigs(configs);\n            result.all().get(); // \u7B49\u5F85\u66F4\u65B0\u5B8C\u6210\n            \n            System.out.println("Topic \'" + topicName + "\' \u914D\u7F6E\u66F4\u65B0\u6210\u529F: " + configUpdates);\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u66F4\u65B0Topic\u914D\u7F6E\u5931\u8D25: " + topicName, e);\n        }\n    }\n    \n    /**\n     * \u589E\u52A0Topic\u5206\u533A\u6570\n     */\n    public void increasePartitions(String topicName, int newPartitionCount) {\n        try {\n            // \u83B7\u53D6\u5F53\u524D\u5206\u533A\u6570\n            TopicInfo topicInfo = getTopicInfo(topicName);\n            int currentPartitions = topicInfo.getPartitionCount();\n            \n            if (newPartitionCount <= currentPartitions) {\n                System.out.println("\u65B0\u5206\u533A\u6570\u5FC5\u987B\u5927\u4E8E\u5F53\u524D\u5206\u533A\u6570 " + currentPartitions);\n                return;\n            }\n            \n            // \u521B\u5EFA\u5206\u533A\u589E\u52A0\u8BF7\u6C42\n            Map<String, NewPartitions> partitionUpdates = new HashMap<>();\n            partitionUpdates.put(topicName, NewPartitions.increaseTo(newPartitionCount));\n            \n            // \u6267\u884C\u5206\u533A\u589E\u52A0\u64CD\u4F5C\n            CreatePartitionsResult result = adminClient.createPartitions(partitionUpdates);\n            result.all().get(); // \u7B49\u5F85\u64CD\u4F5C\u5B8C\u6210\n            \n            System.out.println("Topic \'" + topicName + "\' \u5206\u533A\u6570\u4ECE " + currentPartitions + \n                             " \u589E\u52A0\u5230 " + newPartitionCount);\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u589E\u52A0Topic\u5206\u533A\u5931\u8D25: " + topicName, e);\n        }\n    }\n    \n    /**\n     * \u6253\u5370Topic\u8BE6\u7EC6\u62A5\u544A\n     */\n    public void printTopicReport(String topicName) {\n        TopicInfo info = getTopicInfo(topicName);\n        \n        System.out.println("=== Topic\u8BE6\u7EC6\u4FE1\u606F: " + topicName + " ===");\n        System.out.println("\u5206\u533A\u6570: " + info.getPartitionCount());\n        System.out.println("\u526F\u672C\u56E0\u5B50: " + info.getReplicationFactor());\n        System.out.println("\u662F\u5426\u4E3A\u5185\u90E8Topic: " + info.isInternal());\n        \n        System.out.println("\\n--- \u5206\u533A\u5206\u5E03 ---");\n        for (TopicPartitionInfo partition : info.getPartitions()) {\n            System.out.printf("\u5206\u533A %d: Leader=%d, ISR=%s, Replicas=%s%n",\n                partition.partition(),\n                partition.leader().id(),\n                partition.isr().stream().map(n -> String.valueOf(n.id())).collect(Collectors.joining(",")),\n                partition.replicas().stream().map(n -> String.valueOf(n.id())).collect(Collectors.joining(","))\n            );\n        }\n        \n        System.out.println("\\n--- \u914D\u7F6E\u4FE1\u606F ---");\n        Map<String, String> configs = info.getConfigs();\n        configs.entrySet().stream()\n            .filter(entry -> !entry.getValue().isEmpty())\n            .forEach(entry -> System.out.println(entry.getKey() + " = " + entry.getValue()));\n    }\n    \n    public void close() {\n        adminClient.close();\n    }\n    \n    // Topic\u7C7B\u578B\u679A\u4E3E\n    public enum TopicType {\n        HIGH_THROUGHPUT,    // \u9AD8\u541E\u5410\u91CF\n        LOW_LATENCY,        // \u4F4E\u5EF6\u8FDF\n        LONG_RETENTION,     // \u957F\u671F\u4FDD\u7559\n        COMPACTED          // \u538B\u7F29\u5B58\u50A8\n    }\n    \n    // Topic\u4FE1\u606F\u5C01\u88C5\u7C7B\n    public static class TopicInfo {\n        private final TopicDescription description;\n        private final Config config;\n        \n        public TopicInfo(TopicDescription description, Config config) {\n            this.description = description;\n            this.config = config;\n        }\n        \n        public String getName() { return description.name(); }\n        public int getPartitionCount() { return description.partitions().size(); }\n        public boolean isInternal() { return description.isInternal(); }\n        public List<TopicPartitionInfo> getPartitions() { return description.partitions(); }\n        \n        public short getReplicationFactor() {\n            return description.partitions().isEmpty() ? 0 : \n                   (short) description.partitions().get(0).replicas().size();\n        }\n        \n        public Map<String, String> getConfigs() {\n            Map<String, String> configMap = new HashMap<>();\n            for (ConfigEntry entry : config.entries()) {\n                configMap.put(entry.name(), entry.value());\n            }\n            return configMap;\n        }\n    }\n}\n\n// \u4F7F\u7528\u793A\u4F8B\npublic class TopicManagerExample {\n    public static void main(String[] args) {\n        KafkaTopicManager manager = new KafkaTopicManager("localhost:9092");\n        \n        try {\n            // \u521B\u5EFA\u4E0D\u540C\u7C7B\u578B\u7684\u4E1A\u52A1Topic\n            manager.createBusinessTopic("user-events", KafkaTopicManager.TopicType.HIGH_THROUGHPUT);\n            manager.createBusinessTopic("user-profiles", KafkaTopicManager.TopicType.COMPACTED);\n            manager.createBusinessTopic("audit-logs", KafkaTopicManager.TopicType.LONG_RETENTION);\n            \n            // \u5217\u51FA\u6240\u6709Topic\n            System.out.println("\u5F53\u524DTopic\u5217\u8868: " + manager.listTopics());\n            \n            // \u67E5\u770BTopic\u8BE6\u7EC6\u4FE1\u606F\n            manager.printTopicReport("user-events");\n            \n            // \u589E\u52A0\u5206\u533A\u6570\n            manager.increasePartitions("user-events", 18);\n            \n            // \u66F4\u65B0Topic\u914D\u7F6E\n            Map<String, String> configUpdates = new HashMap<>();\n            configUpdates.put("retention.ms", "1209600000"); // 14\u5929\n            manager.updateTopicConfig("user-events", configUpdates);\n            \n        } finally {\n            manager.close();\n        }\n    }\n}\n'})})}),(0,i.jsxs)(a.A,{value:"naming",label:"\u547D\u540D\u89C4\u8303",children:[(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Topic\u547D\u540D\u6700\u4F73\u5B9E\u8DF5"}),"\uFF1A"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",metastring:'title="Topic\u547D\u540D\u89C4\u8303\u793A\u4F8B"',children:"# 1. \u57FA\u7840\u547D\u540D\u89C4\u8303\n# \u683C\u5F0F\uFF1A<\u4E1A\u52A1\u57DF>.<\u6570\u636E\u7C7B\u578B>.<\u7248\u672C>\nuser.events.v1              # \u7528\u6237\u4E8B\u4EF6\u6D41\norder.transactions.v2       # \u8BA2\u5355\u4EA4\u6613\u6D41\ninventory.updates.v1        # \u5E93\u5B58\u66F4\u65B0\u6D41\n\n# 2. \u6309\u73AF\u5883\u533A\u5206\n# \u683C\u5F0F\uFF1A<\u73AF\u5883>.<\u4E1A\u52A1\u57DF>.<\u6570\u636E\u7C7B\u578B>\ndev.user.events            # \u5F00\u53D1\u73AF\u5883\u7528\u6237\u4E8B\u4EF6\nstaging.order.transactions # \u6D4B\u8BD5\u73AF\u5883\u8BA2\u5355\u4EA4\u6613\nprod.inventory.updates     # \u751F\u4EA7\u73AF\u5883\u5E93\u5B58\u66F4\u65B0\n\n# 3. \u6309\u6570\u636E\u6D41\u5411\u533A\u5206\n# \u683C\u5F0F\uFF1A<\u6E90\u7CFB\u7EDF>-to-<\u76EE\u6807\u7CFB\u7EDF>.<\u6570\u636E\u7C7B\u578B>\nmysql-to-elasticsearch.users    # MySQL\u5230ES\u7684\u7528\u6237\u6570\u636E\napp-to-analytics.clickstream    # \u5E94\u7528\u5230\u5206\u6790\u7CFB\u7EDF\u7684\u70B9\u51FB\u6D41\ncrm-to-warehouse.customers      # CRM\u5230\u6570\u4ED3\u7684\u5BA2\u6237\u6570\u636E\n\n# 4. \u6309\u4E1A\u52A1\u529F\u80FD\u533A\u5206\nuser-registration-events        # \u7528\u6237\u6CE8\u518C\u4E8B\u4EF6\npayment-processing-commands     # \u652F\u4ED8\u5904\u7406\u547D\u4EE4\nnotification-delivery-status    # \u901A\u77E5\u6295\u9012\u72B6\u6001\n\n# 5. \u5185\u90E8\u7CFB\u7EDFTopic\n_consumer_offsets              # Kafka\u5185\u90E8\u4F4D\u79FBTopic\n_transaction_state             # \u4E8B\u52A1\u72B6\u6001Topic\n__schema_registry_schemas      # Schema Registry\u5185\u90E8Topic\n"})}),(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u547D\u540D\u89C4\u8303\u8981\u70B9"}),"\uFF1A"]}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u5C0F\u5199\u5B57\u6BCD\u548C\u8FDE\u5B57\u7B26"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u4F7F\u7528\u4E0B\u5212\u7EBF\u5F00\u5934\uFF08\u7CFB\u7EDF\u4FDD\u7559\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u540D\u79F0\u8981\u6709\u4E1A\u52A1\u542B\u4E49\uFF0C\u4FBF\u4E8E\u7406\u89E3"}),"\n",(0,i.jsx)(e.li,{children:"\u8003\u8651\u7248\u672C\u7BA1\u7406\u548C\u73AF\u5883\u9694\u79BB"}),"\n",(0,i.jsx)(e.li,{children:"\u957F\u5EA6\u9002\u4E2D\uFF0C\u907F\u514D\u8FC7\u957F\u6216\u8FC7\u77ED"}),"\n"]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"23-partition\u5206\u533A--\u5E76\u884C\u5904\u7406\u7684\u57FA\u7840",children:"2.3 Partition\uFF08\u5206\u533A\uFF09- \u5E76\u884C\u5904\u7406\u7684\u57FA\u7840"}),"\n",(0,i.jsx)(e.p,{children:"\u5206\u533A\u662FTopic\u7684\u7269\u7406\u5206\u5272\u5355\u5143\uFF0C\u6BCF\u4E2A\u5206\u533A\u662F\u4E00\u4E2A\u6709\u5E8F\u3001\u4E0D\u53EF\u53D8\u7684\u6D88\u606F\u5E8F\u5217\u3002\u5206\u533A\u673A\u5236\u662FKafka\u5B9E\u73B0\u9AD8\u5E76\u53D1\u3001\u9AD8\u541E\u5410\u91CF\u7684\u6838\u5FC3\u8BBE\u8BA1\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"structure",label:"\u5206\u533A\u7ED3\u6784",children:(0,i.jsx)(e.mermaid,{value:'graph TB\n    subgraph "\u5206\u533A\u5185\u90E8\u7ED3\u6784"\n        P[Partition 0] --\x3e S1[Segment 0<br/>0-999]\n        P --\x3e S2[Segment 1<br/>1000-1999]\n        P --\x3e S3[Segment 2<br/>2000-2999]\n        P --\x3e S4[Active Segment<br/>3000-...]\n        \n        S1 --\x3e L1[Log File<br/>00000000000000000000.log]\n        S1 --\x3e I1[Index File<br/>00000000000000000000.index]\n        S1 --\x3e T1[Time Index<br/>00000000000000000000.timeindex]\n        \n        S2 --\x3e L2[Log File<br/>00000000000000001000.log]\n        S2 --\x3e I2[Index File<br/>00000000000000001000.index]\n        S2 --\x3e T2[Time Index<br/>00000000000000001000.timeindex]\n    end\n    \n    subgraph "\u6D88\u606F\u5B58\u50A8\u683C\u5F0F"\n        M[Message] --\x3e MO[Offset]\n        M --\x3e MT[Timestamp]\n        M --\x3e MK[Key]\n        M --\x3e MV[Value]\n        M --\x3e MH[Headers]\n    end'})}),(0,i.jsx)(a.A,{value:"partitioner",label:"\u5206\u533A\u7B56\u7565",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u81EA\u5B9A\u4E49\u5206\u533A\u5668\u5B9E\u73B0"',children:'import org.apache.kafka.clients.producer.Partitioner;\nimport org.apache.kafka.common.Cluster;\nimport org.apache.kafka.common.PartitionInfo;\nimport org.apache.kafka.common.utils.Utils;\nimport java.util.*;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ThreadLocalRandom;\n\n/**\n * \u81EA\u5B9A\u4E49\u5206\u533A\u5668\u5B9E\u73B0\n * \u652F\u6301\u591A\u79CD\u5206\u533A\u7B56\u7565\uFF0C\u53EF\u6839\u636E\u4E1A\u52A1\u9700\u6C42\u7075\u6D3B\u9009\u62E9\n */\npublic class CustomPartitioner implements Partitioner {\n    \n    private final Map<String, Integer> stickyPartitionCache = new ConcurrentHashMap<>();\n    \n    @Override\n    public int partition(String topic, Object key, byte[] keyBytes, \n                        Object value, byte[] valueBytes, Cluster cluster) {\n        \n        List<PartitionInfo> partitions = cluster.partitionsForTopic(topic);\n        int numPartitions = partitions.size();\n        \n        if (keyBytes == null) {\n            // \u65E0key\u65F6\u4F7F\u7528\u7C98\u6027\u5206\u533A\u7B56\u7565\n            return getStickyPartition(topic, cluster);\n        }\n        \n        // \u6709key\u65F6\u6839\u636Ekey\u7C7B\u578B\u9009\u62E9\u5206\u533A\u7B56\u7565\n        if (key instanceof String) {\n            return partitionByString((String) key, numPartitions);\n        } else if (key instanceof Integer) {\n            return partitionByInteger((Integer) key, numPartitions);\n        } else if (key instanceof Long) {\n            return partitionByLong((Long) key, numPartitions);\n        } else {\n            // \u9ED8\u8BA4\u4F7F\u7528hash\u5206\u533A\n            return Utils.toPositive(Utils.murmur2(keyBytes)) % numPartitions;\n        }\n    }\n    \n    /**\n     * \u5B57\u7B26\u4E32key\u5206\u533A\u7B56\u7565\n     * \u652F\u6301\u4E1A\u52A1\u89C4\u5219\u5206\u533A\n     */\n    private int partitionByString(String key, int numPartitions) {\n        // \u7528\u6237ID\u5206\u533A\uFF1Auser:123 -> \u6839\u636E\u7528\u6237ID\u5206\u533A\n        if (key.startsWith("user:")) {\n            String userId = key.substring(5);\n            return Math.abs(userId.hashCode()) % numPartitions;\n        }\n        \n        // \u5730\u533A\u5206\u533A\uFF1Aregion:beijing -> \u6839\u636E\u5730\u533A\u5206\u533A\n        if (key.startsWith("region:")) {\n            String region = key.substring(7);\n            return getRegionPartition(region, numPartitions);\n        }\n        \n        // \u65F6\u95F4\u5206\u533A\uFF1Adate:2025-01-01 -> \u6839\u636E\u65E5\u671F\u5206\u533A\n        if (key.startsWith("date:")) {\n            String date = key.substring(5);\n            return Math.abs(date.hashCode()) % numPartitions;\n        }\n        \n        // \u9ED8\u8BA4hash\u5206\u533A\n        return Math.abs(key.hashCode()) % numPartitions;\n    }\n    \n    /**\n     * \u6574\u6570key\u5206\u533A\u7B56\u7565\n     */\n    private int partitionByInteger(Integer key, int numPartitions) {\n        // \u5076\u6570\u5206\u533A\u7B56\u7565\uFF1A\u5076\u6570key\u5206\u914D\u5230\u524D\u534A\u90E8\u5206\u5206\u533A\n        if (key % 2 == 0) {\n            return key % (numPartitions / 2);\n        } else {\n            return (numPartitions / 2) + (key % (numPartitions - numPartitions / 2));\n        }\n    }\n    \n    /**\n     * \u957F\u6574\u6570key\u5206\u533A\u7B56\u7565\n     */\n    private int partitionByLong(Long key, int numPartitions) {\n        // \u65F6\u95F4\u6233\u5206\u533A\uFF1A\u6839\u636E\u65F6\u95F4\u6233\u7684\u5C0F\u65F6\u90E8\u5206\u5206\u533A\n        if (key > 1000000000000L) { // \u5047\u8BBE\u662F\u65F6\u95F4\u6233\n            long hour = (key / 1000 / 3600) % 24;\n            return (int) (hour % numPartitions);\n        }\n        \n        return (int) (Math.abs(key) % numPartitions);\n    }\n    \n    /**\n     * \u5730\u533A\u5206\u533A\u6620\u5C04\n     */\n    private int getRegionPartition(String region, int numPartitions) {\n        Map<String, Integer> regionMap = new HashMap<>();\n        regionMap.put("beijing", 0);\n        regionMap.put("shanghai", 1);\n        regionMap.put("guangzhou", 2);\n        regionMap.put("shenzhen", 3);\n        \n        return regionMap.getOrDefault(region.toLowerCase(), \n                                    Math.abs(region.hashCode()) % numPartitions);\n    }\n    \n    /**\n     * \u7C98\u6027\u5206\u533A\u7B56\u7565\uFF08\u65E0key\u65F6\u4F7F\u7528\uFF09\n     * \u51CF\u5C11\u5206\u533A\u5207\u6362\uFF0C\u63D0\u9AD8\u6279\u5904\u7406\u6548\u7387\n     */\n    private int getStickyPartition(String topic, Cluster cluster) {\n        Integer partition = stickyPartitionCache.get(topic);\n        if (partition == null) {\n            List<PartitionInfo> partitions = cluster.partitionsForTopic(topic);\n            partition = ThreadLocalRandom.current().nextInt(partitions.size());\n            stickyPartitionCache.put(topic, partition);\n        }\n        return partition;\n    }\n    \n    @Override\n    public void close() {\n        stickyPartitionCache.clear();\n    }\n    \n    @Override\n    public void configure(Map<String, ?> configs) {\n        // \u53EF\u4EE5\u4ECE\u914D\u7F6E\u4E2D\u8BFB\u53D6\u5206\u533A\u7B56\u7565\u53C2\u6570\n    }\n}\n\n/**\n * \u5206\u533A\u7B56\u7565\u6D4B\u8BD5\u548C\u5206\u6790\u5DE5\u5177\n */\npublic class PartitionAnalyzer {\n    \n    /**\n     * \u5206\u6790\u5206\u533A\u5206\u5E03\u5747\u5300\u6027\n     */\n    public static void analyzePartitionDistribution(String topic, List<String> keys, \n                                                   Partitioner partitioner, int numPartitions) {\n        Map<Integer, Integer> partitionCounts = new HashMap<>();\n        \n        // \u6A21\u62DF\u96C6\u7FA4\u4FE1\u606F\n        Cluster cluster = createMockCluster(topic, numPartitions);\n        \n        // \u7EDF\u8BA1\u6BCF\u4E2A\u5206\u533A\u7684\u6D88\u606F\u6570\u91CF\n        for (String key : keys) {\n            byte[] keyBytes = key != null ? key.getBytes() : null;\n            int partition = partitioner.partition(topic, key, keyBytes, null, null, cluster);\n            partitionCounts.put(partition, partitionCounts.getOrDefault(partition, 0) + 1);\n        }\n        \n        // \u6253\u5370\u5206\u5E03\u7EDF\u8BA1\n        System.out.println("=== \u5206\u533A\u5206\u5E03\u5206\u6790 ===");\n        System.out.println("\u603B\u6D88\u606F\u6570: " + keys.size());\n        System.out.println("\u5206\u533A\u6570: " + numPartitions);\n        System.out.println("\u5E73\u5747\u6BCF\u5206\u533A: " + (keys.size() / numPartitions));\n        \n        for (int i = 0; i < numPartitions; i++) {\n            int count = partitionCounts.getOrDefault(i, 0);\n            double percentage = (double) count / keys.size() * 100;\n            System.out.printf("\u5206\u533A %d: %d \u6761\u6D88\u606F (%.2f%%)%n", i, count, percentage);\n        }\n        \n        // \u8BA1\u7B97\u5206\u5E03\u5747\u5300\u6027\n        double variance = calculateVariance(partitionCounts, numPartitions, keys.size());\n        System.out.printf("\u5206\u5E03\u65B9\u5DEE: %.2f (\u8D8A\u5C0F\u8D8A\u5747\u5300)%n", variance);\n    }\n    \n    private static double calculateVariance(Map<Integer, Integer> counts, int numPartitions, int totalMessages) {\n        double mean = (double) totalMessages / numPartitions;\n        double sumSquaredDiff = 0;\n        \n        for (int i = 0; i < numPartitions; i++) {\n            int count = counts.getOrDefault(i, 0);\n            sumSquaredDiff += Math.pow(count - mean, 2);\n        }\n        \n        return sumSquaredDiff / numPartitions;\n    }\n    \n    private static Cluster createMockCluster(String topic, int numPartitions) {\n        List<PartitionInfo> partitions = new ArrayList<>();\n        for (int i = 0; i < numPartitions; i++) {\n            partitions.add(new PartitionInfo(topic, i, null, null, null));\n        }\n        return new Cluster("test-cluster", Collections.emptyList(), partitions, \n                          Collections.emptySet(), Collections.emptySet());\n    }\n    \n    public static void main(String[] args) {\n        // \u751F\u6210\u6D4B\u8BD5\u6570\u636E\n        List<String> testKeys = new ArrayList<>();\n        \n        // \u7528\u6237ID\u6D4B\u8BD5\u6570\u636E\n        for (int i = 1; i <= 1000; i++) {\n            testKeys.add("user:" + i);\n        }\n        \n        // \u5730\u533A\u6D4B\u8BD5\u6570\u636E\n        String[] regions = {"beijing", "shanghai", "guangzhou", "shenzhen", "hangzhou"};\n        for (int i = 0; i < 500; i++) {\n            testKeys.add("region:" + regions[i % regions.length]);\n        }\n        \n        // \u65E5\u671F\u6D4B\u8BD5\u6570\u636E\n        for (int i = 1; i <= 31; i++) {\n            testKeys.add("date:2025-01-" + String.format("%02d", i));\n        }\n        \n        // \u5206\u6790\u81EA\u5B9A\u4E49\u5206\u533A\u5668\u7684\u5206\u5E03\n        CustomPartitioner partitioner = new CustomPartitioner();\n        analyzePartitionDistribution("test-topic", testKeys, partitioner, 6);\n    }\n}\n'})})}),(0,i.jsxs)(a.A,{value:"optimization",label:"\u5206\u533A\u4F18\u5316",children:[(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u533A\u6570\u91CF\u9009\u62E9\u6307\u5357"}),"\uFF1A"]}),(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u8003\u8651\u56E0\u7D20"}),(0,i.jsx)(e.th,{children:"\u5EFA\u8BAE"}),(0,i.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u541E\u5410\u91CF\u9700\u6C42"})}),(0,i.jsx)(e.td,{children:"\u5355\u5206\u533A10-30MB/s"}),(0,i.jsx)(e.td,{children:"\u6839\u636E\u4E1A\u52A1\u5CF0\u503C\u6D41\u91CF\u8BA1\u7B97\u6240\u9700\u5206\u533A\u6570"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u6570\u91CF"})}),(0,i.jsx)(e.td,{children:"\u5206\u533A\u6570 \u2265 \u6D88\u8D39\u8005\u6570"}),(0,i.jsx)(e.td,{children:"\u4FDD\u8BC1\u6BCF\u4E2A\u6D88\u8D39\u8005\u90FD\u6709\u5206\u533A\u53EF\u6D88\u8D39"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5B58\u50A8\u5BB9\u91CF"})}),(0,i.jsx)(e.td,{children:"\u8003\u8651\u5355\u5206\u533A\u5927\u5C0F"}),(0,i.jsx)(e.td,{children:"\u907F\u514D\u5355\u5206\u533A\u8FC7\u5927\u5F71\u54CD\u6027\u80FD"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u7F51\u7EDC\u5F00\u9500"})}),(0,i.jsx)(e.td,{children:"\u907F\u514D\u5206\u533A\u8FC7\u591A"}),(0,i.jsx)(e.td,{children:"\u5206\u533A\u8FC7\u591A\u4F1A\u589E\u52A0\u7F51\u7EDC\u548C\u5185\u5B58\u5F00\u9500"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6545\u969C\u6062\u590D"})}),(0,i.jsx)(e.td,{children:"\u5E73\u8861\u53EF\u7528\u6027\u548C\u6027\u80FD"}),(0,i.jsx)(e.td,{children:"\u5206\u533A\u591A\u6062\u590D\u5FEB\uFF0C\u4F46\u8D44\u6E90\u6D88\u8017\u5927"})]})]})]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u5206\u533A\u6570\u91CF\u8BA1\u7B97\u5DE5\u5177"',children:'/**\n * \u5206\u533A\u6570\u91CF\u8BA1\u7B97\u548C\u4F18\u5316\u5EFA\u8BAE\u5DE5\u5177\n */\npublic class PartitionCalculator {\n    \n    /**\n     * \u6839\u636E\u541E\u5410\u91CF\u9700\u6C42\u8BA1\u7B97\u5206\u533A\u6570\n     */\n    public static int calculatePartitionsByThroughput(\n            long targetThroughputMBps,      // \u76EE\u6807\u541E\u5410\u91CF MB/s\n            long singlePartitionThroughput, // \u5355\u5206\u533A\u541E\u5410\u91CF MB/s\n            double safetyFactor             // \u5B89\u5168\u7CFB\u6570\n    ) {\n        int basePartitions = (int) Math.ceil((double) targetThroughputMBps / singlePartitionThroughput);\n        return (int) Math.ceil(basePartitions * safetyFactor);\n    }\n    \n    /**\n     * \u6839\u636E\u6D88\u8D39\u8005\u6570\u91CF\u8BA1\u7B97\u5206\u533A\u6570\n     */\n    public static int calculatePartitionsByConsumers(\n            int maxConsumers,               // \u6700\u5927\u6D88\u8D39\u8005\u6570\u91CF\n            double parallelismFactor        // \u5E76\u884C\u5EA6\u7CFB\u6570\n    ) {\n        return (int) Math.ceil(maxConsumers * parallelismFactor);\n    }\n    \n    /**\n     * \u6839\u636E\u6570\u636E\u91CF\u8BA1\u7B97\u5206\u533A\u6570\n     */\n    public static int calculatePartitionsByDataSize(\n            long dailyDataSizeGB,           // \u6BCF\u65E5\u6570\u636E\u91CF GB\n            int retentionDays,              // \u4FDD\u7559\u5929\u6570\n            long maxPartitionSizeGB         // \u5355\u5206\u533A\u6700\u5927\u5927\u5C0F GB\n    ) {\n        long totalDataSize = dailyDataSizeGB * retentionDays;\n        return (int) Math.ceil((double) totalDataSize / maxPartitionSizeGB);\n    }\n    \n    /**\n     * \u7EFC\u5408\u8BA1\u7B97\u63A8\u8350\u5206\u533A\u6570\n     */\n    public static PartitionRecommendation recommendPartitions(\n            long targetThroughputMBps,\n            int maxConsumers,\n            long dailyDataSizeGB,\n            int retentionDays\n    ) {\n        // \u57FA\u4E8E\u4E0D\u540C\u56E0\u7D20\u8BA1\u7B97\u5206\u533A\u6570\n        int throughputPartitions = calculatePartitionsByThroughput(targetThroughputMBps, 20, 1.5);\n        int consumerPartitions = calculatePartitionsByConsumers(maxConsumers, 1.2);\n        int dataSizePartitions = calculatePartitionsByDataSize(dailyDataSizeGB, retentionDays, 50);\n        \n        // \u53D6\u6700\u5927\u503C\u4F5C\u4E3A\u63A8\u8350\u503C\n        int recommendedPartitions = Math.max(Math.max(throughputPartitions, consumerPartitions), dataSizePartitions);\n        \n        // \u8C03\u6574\u4E3A2\u7684\u5E42\u6B21\u65B9\uFF08\u53EF\u9009\uFF0C\u4FBF\u4E8E\u8D1F\u8F7D\u5747\u8861\uFF09\n        int powerOfTwoPartitions = nextPowerOfTwo(recommendedPartitions);\n        \n        return new PartitionRecommendation(\n            recommendedPartitions,\n            powerOfTwoPartitions,\n            throughputPartitions,\n            consumerPartitions,\n            dataSizePartitions\n        );\n    }\n    \n    private static int nextPowerOfTwo(int n) {\n        if (n <= 1) return 1;\n        return Integer.highestOneBit(n - 1) << 1;\n    }\n    \n    /**\n     * \u5206\u533A\u63A8\u8350\u7ED3\u679C\n     */\n    public static class PartitionRecommendation {\n        private final int recommended;\n        private final int powerOfTwo;\n        private final int byThroughput;\n        private final int byConsumers;\n        private final int byDataSize;\n        \n        public PartitionRecommendation(int recommended, int powerOfTwo, \n                                     int byThroughput, int byConsumers, int byDataSize) {\n            this.recommended = recommended;\n            this.powerOfTwo = powerOfTwo;\n            this.byThroughput = byThroughput;\n            this.byConsumers = byConsumers;\n            this.byDataSize = byDataSize;\n        }\n        \n        public void printReport() {\n            System.out.println("=== \u5206\u533A\u6570\u91CF\u63A8\u8350\u62A5\u544A ===");\n            System.out.println("\u57FA\u4E8E\u541E\u5410\u91CF: " + byThroughput + " \u4E2A\u5206\u533A");\n            System.out.println("\u57FA\u4E8E\u6D88\u8D39\u8005\u6570\u91CF: " + byConsumers + " \u4E2A\u5206\u533A");\n            System.out.println("\u57FA\u4E8E\u6570\u636E\u5927\u5C0F: " + byDataSize + " \u4E2A\u5206\u533A");\n            System.out.println("\u63A8\u8350\u5206\u533A\u6570: " + recommended + " \u4E2A\u5206\u533A");\n            System.out.println("2\u7684\u5E42\u6B21\u65B9: " + powerOfTwo + " \u4E2A\u5206\u533A");\n            System.out.println("\\n\u5EFA\u8BAE\u4F7F\u7528 " + Math.max(recommended, powerOfTwo) + " \u4E2A\u5206\u533A");\n        }\n        \n        // Getters\n        public int getRecommended() { return recommended; }\n        public int getPowerOfTwo() { return powerOfTwo; }\n        public int getByThroughput() { return byThroughput; }\n        public int getByConsumers() { return byConsumers; }\n        public int getByDataSize() { return byDataSize; }\n    }\n    \n    public static void main(String[] args) {\n        // \u793A\u4F8B\uFF1A\u8BA1\u7B97\u7535\u5546\u8BA2\u5355Topic\u7684\u5206\u533A\u6570\n        PartitionRecommendation recommendation = recommendPartitions(\n            100,    // \u76EE\u6807\u541E\u5410\u91CF 100MB/s\n            20,     // \u6700\u592720\u4E2A\u6D88\u8D39\u8005\n            10,     // \u6BCF\u65E510GB\u6570\u636E\n            30      // \u4FDD\u755930\u5929\n        );\n        \n        recommendation.printReport();\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(e.h1,{id:"3-kafka\u751F\u4EA7\u8005\u4E0E\u6D88\u8D39\u8005\u6DF1\u5EA6\u5B9E\u6218",children:"3. Kafka\u751F\u4EA7\u8005\u4E0E\u6D88\u8D39\u8005\u6DF1\u5EA6\u5B9E\u6218"}),"\n",(0,i.jsx)(e.h3,{id:"31-producer\u751F\u4EA7\u8005--\u9AD8\u6027\u80FD\u6D88\u606F\u53D1\u9001",children:"3.1 Producer\uFF08\u751F\u4EA7\u8005\uFF09- \u9AD8\u6027\u80FD\u6D88\u606F\u53D1\u9001"}),"\n",(0,i.jsx)(e.p,{children:"\u751F\u4EA7\u8005\u662F\u5411Kafka\u96C6\u7FA4\u53D1\u9001\u6D88\u606F\u7684\u5BA2\u6237\u7AEF\u5E94\u7528\u7A0B\u5E8F\u3002Kafka\u751F\u4EA7\u8005\u5177\u6709\u9AD8\u5EA6\u7684\u53EF\u914D\u7F6E\u6027\uFF0C\u652F\u6301\u540C\u6B65/\u5F02\u6B65\u53D1\u9001\u3001\u6279\u5904\u7406\u3001\u538B\u7F29\u3001\u4E8B\u52A1\u7B49\u591A\u79CD\u7279\u6027\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"basic",label:"\u57FA\u7840\u751F\u4EA7\u8005",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Kafka\u751F\u4EA7\u8005\u57FA\u7840\u5B9E\u73B0"',children:'import org.apache.kafka.clients.producer.*;\nimport org.apache.kafka.common.serialization.StringSerializer;\nimport java.util.Properties;\nimport java.util.concurrent.Future;\n\n/**\n * Kafka\u751F\u4EA7\u8005\u57FA\u7840\u5B9E\u73B0\n * \u5C55\u793A\u540C\u6B65\u548C\u5F02\u6B65\u53D1\u9001\u7684\u5B8C\u6574\u7528\u6CD5\n */\npublic class KafkaProducerBasic {\n    \n    private final KafkaProducer<String, String> producer;\n    private final String topicName;\n    \n    public KafkaProducerBasic(String bootstrapServers, String topicName) {\n        this.topicName = topicName;\n        this.producer = createProducer(bootstrapServers);\n    }\n    \n    /**\n     * \u521B\u5EFA\u751F\u4EA7\u8005\u5B9E\u4F8B\n     */\n    private KafkaProducer<String, String> createProducer(String bootstrapServers) {\n        Properties props = new Properties();\n        \n        // \u57FA\u7840\u8FDE\u63A5\u914D\u7F6E\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        \n        // \u53EF\u9760\u6027\u914D\u7F6E\n        props.put(ProducerConfig.ACKS_CONFIG, "all");                    // \u7B49\u5F85\u6240\u6709\u526F\u672C\u786E\u8BA4\n        props.put(ProducerConfig.RETRIES_CONFIG, 3);                     // \u91CD\u8BD53\u6B21\n        props.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, 1000);         // \u91CD\u8BD5\u95F4\u96941\u79D2\n        props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);       // \u542F\u7528\u5E42\u7B49\u6027\n        \n        // \u6027\u80FD\u4F18\u5316\u914D\u7F6E\n        props.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);              // \u6279\u6B21\u5927\u5C0F16KB\n        props.put(ProducerConfig.LINGER_MS_CONFIG, 10);                  // \u7B49\u5F8510ms\u6536\u96C6\u66F4\u591A\u6D88\u606F\n        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);        // \u7F13\u51B2\u533A32MB\n        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");        // LZ4\u538B\u7F29\n        \n        // \u7F51\u7EDC\u914D\u7F6E\n        props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 5);\n        props.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, 30000);      // \u8BF7\u6C42\u8D85\u65F630\u79D2\n        props.put(ProducerConfig.DELIVERY_TIMEOUT_MS_CONFIG, 120000);    // \u6295\u9012\u8D85\u65F62\u5206\u949F\n        \n        return new KafkaProducer<>(props);\n    }\n    \n    /**\n     * \u540C\u6B65\u53D1\u9001\u6D88\u606F\n     */\n    public RecordMetadata sendSync(String key, String value) {\n        ProducerRecord<String, String> record = new ProducerRecord<>(topicName, key, value);\n        \n        try {\n            // \u540C\u6B65\u53D1\u9001\uFF0C\u4F1A\u963B\u585E\u76F4\u5230\u6536\u5230\u54CD\u5E94\n            RecordMetadata metadata = producer.send(record).get();\n            \n            System.out.printf("\u540C\u6B65\u53D1\u9001\u6210\u529F: topic=%s, partition=%d, offset=%d, timestamp=%d%n",\n                metadata.topic(), metadata.partition(), metadata.offset(), metadata.timestamp());\n            \n            return metadata;\n            \n        } catch (Exception e) {\n            System.err.println("\u540C\u6B65\u53D1\u9001\u5931\u8D25: " + e.getMessage());\n            throw new RuntimeException("\u53D1\u9001\u6D88\u606F\u5931\u8D25", e);\n        }\n    }\n    \n    /**\n     * \u5F02\u6B65\u53D1\u9001\u6D88\u606F\n     */\n    public Future<RecordMetadata> sendAsync(String key, String value) {\n        ProducerRecord<String, String> record = new ProducerRecord<>(topicName, key, value);\n        \n        // \u5F02\u6B65\u53D1\u9001\uFF0C\u7ACB\u5373\u8FD4\u56DEFuture\n        return producer.send(record, new Callback() {\n            @Override\n            public void onCompletion(RecordMetadata metadata, Exception exception) {\n                if (exception == null) {\n                    System.out.printf("\u5F02\u6B65\u53D1\u9001\u6210\u529F: topic=%s, partition=%d, offset=%d%n",\n                        metadata.topic(), metadata.partition(), metadata.offset());\n                } else {\n                    System.err.println("\u5F02\u6B65\u53D1\u9001\u5931\u8D25: " + exception.getMessage());\n                }\n            }\n        });\n    }\n    \n    /**\n     * \u53D1\u9001\u5E26\u5934\u90E8\u4FE1\u606F\u7684\u6D88\u606F\n     */\n    public void sendWithHeaders(String key, String value, Map<String, String> headers) {\n        ProducerRecord<String, String> record = new ProducerRecord<>(topicName, key, value);\n        \n        // \u6DFB\u52A0\u5934\u90E8\u4FE1\u606F\n        if (headers != null) {\n            for (Map.Entry<String, String> entry : headers.entrySet()) {\n                record.headers().add(entry.getKey(), entry.getValue().getBytes());\n            }\n        }\n        \n        producer.send(record, (metadata, exception) -> {\n            if (exception == null) {\n                System.out.println("\u5E26\u5934\u90E8\u6D88\u606F\u53D1\u9001\u6210\u529F: " + metadata.offset());\n            } else {\n                System.err.println("\u5E26\u5934\u90E8\u6D88\u606F\u53D1\u9001\u5931\u8D25: " + exception.getMessage());\n            }\n        });\n    }\n    \n    /**\n     * \u6279\u91CF\u53D1\u9001\u6D88\u606F\n     */\n    public void sendBatch(List<MessageData> messages) {\n        List<Future<RecordMetadata>> futures = new ArrayList<>();\n        \n        // \u6279\u91CF\u63D0\u4EA4\u6D88\u606F\n        for (MessageData msg : messages) {\n            ProducerRecord<String, String> record = \n                new ProducerRecord<>(topicName, msg.getKey(), msg.getValue());\n            \n            Future<RecordMetadata> future = producer.send(record);\n            futures.add(future);\n        }\n        \n        // \u7B49\u5F85\u6240\u6709\u6D88\u606F\u53D1\u9001\u5B8C\u6210\n        for (int i = 0; i < futures.size(); i++) {\n            try {\n                RecordMetadata metadata = futures.get(i).get();\n                System.out.println("\u6279\u91CF\u6D88\u606F " + i + " \u53D1\u9001\u6210\u529F: " + metadata.offset());\n            } catch (Exception e) {\n                System.err.println("\u6279\u91CF\u6D88\u606F " + i + " \u53D1\u9001\u5931\u8D25: " + e.getMessage());\n            }\n        }\n    }\n    \n    /**\n     * \u5237\u65B0\u7F13\u51B2\u533A\uFF0C\u786E\u4FDD\u6240\u6709\u6D88\u606F\u90FD\u53D1\u9001\n     */\n    public void flush() {\n        producer.flush();\n        System.out.println("\u751F\u4EA7\u8005\u7F13\u51B2\u533A\u5DF2\u5237\u65B0");\n    }\n    \n    /**\n     * \u5173\u95ED\u751F\u4EA7\u8005\n     */\n    public void close() {\n        producer.close();\n        System.out.println("\u751F\u4EA7\u8005\u5DF2\u5173\u95ED");\n    }\n    \n    // \u6D88\u606F\u6570\u636E\u5C01\u88C5\u7C7B\n    public static class MessageData {\n        private String key;\n        private String value;\n        \n        public MessageData(String key, String value) {\n            this.key = key;\n            this.value = value;\n        }\n        \n        public String getKey() { return key; }\n        public String getValue() { return value; }\n    }\n}\n\n// \u751F\u4EA7\u8005\u4F7F\u7528\u793A\u4F8B\npublic class ProducerExample {\n    public static void main(String[] args) {\n        KafkaProducerBasic producer = new KafkaProducerBasic("localhost:9092", "user-events");\n        \n        try {\n            // \u540C\u6B65\u53D1\u9001\n            producer.sendSync("user-123", "login");\n            \n            // \u5F02\u6B65\u53D1\u9001\n            producer.sendAsync("user-456", "logout");\n            \n            // \u5E26\u5934\u90E8\u4FE1\u606F\u53D1\u9001\n            Map<String, String> headers = new HashMap<>();\n            headers.put("source", "mobile-app");\n            headers.put("version", "1.0");\n            producer.sendWithHeaders("user-789", "purchase", headers);\n            \n            // \u6279\u91CF\u53D1\u9001\n            List<KafkaProducerBasic.MessageData> batch = Arrays.asList(\n                new KafkaProducerBasic.MessageData("user-001", "view_product"),\n                new KafkaProducerBasic.MessageData("user-002", "add_to_cart"),\n                new KafkaProducerBasic.MessageData("user-003", "checkout")\n            );\n            producer.sendBatch(batch);\n            \n            // \u786E\u4FDD\u6240\u6709\u6D88\u606F\u53D1\u9001\u5B8C\u6210\n            producer.flush();\n            \n        } finally {\n            producer.close();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"advanced",label:"\u9AD8\u7EA7\u751F\u4EA7\u8005",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u9AD8\u7EA7\u751F\u4EA7\u8005\u5B9E\u73B0 - \u652F\u6301\u4E8B\u52A1\u548C\u76D1\u63A7"',children:'import org.apache.kafka.clients.producer.*;\nimport org.apache.kafka.common.errors.ProducerFencedException;\nimport org.apache.kafka.common.errors.OutOfOrderSequenceException;\nimport org.apache.kafka.common.errors.AuthorizationException;\nimport java.util.concurrent.atomic.AtomicLong;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ScheduledExecutorService;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * \u9AD8\u7EA7Kafka\u751F\u4EA7\u8005\u5B9E\u73B0\n * \u652F\u6301\u4E8B\u52A1\u3001\u76D1\u63A7\u3001\u91CD\u8BD5\u7B56\u7565\u3001\u6545\u969C\u5904\u7406\u7B49\u9AD8\u7EA7\u7279\u6027\n */\npublic class KafkaProducerAdvanced {\n    \n    private final KafkaProducer<String, String> producer;\n    private final String topicName;\n    private final boolean transactionalEnabled;\n    private final ProducerMetrics metrics;\n    private final ScheduledExecutorService scheduler;\n    \n    // \u6027\u80FD\u6307\u6807\n    private final AtomicLong totalSent = new AtomicLong(0);\n    private final AtomicLong totalFailed = new AtomicLong(0);\n    private final AtomicLong totalBytes = new AtomicLong(0);\n    \n    public KafkaProducerAdvanced(String bootstrapServers, String topicName, boolean enableTransactions) {\n        this.topicName = topicName;\n        this.transactionalEnabled = enableTransactions;\n        this.producer = createAdvancedProducer(bootstrapServers, enableTransactions);\n        this.metrics = new ProducerMetrics();\n        this.scheduler = Executors.newScheduledThreadPool(1);\n        \n        // \u542F\u52A8\u4E8B\u52A1\uFF08\u5982\u679C\u542F\u7528\uFF09\n        if (transactionalEnabled) {\n            producer.initTransactions();\n        }\n        \n        // \u542F\u52A8\u6307\u6807\u76D1\u63A7\n        startMetricsReporting();\n    }\n    \n    /**\n     * \u521B\u5EFA\u9AD8\u7EA7\u751F\u4EA7\u8005\u914D\u7F6E\n     */\n    private KafkaProducer<String, String> createAdvancedProducer(String bootstrapServers, boolean enableTransactions) {\n        Properties props = new Properties();\n        \n        // \u57FA\u7840\u914D\u7F6E\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        \n        // \u9AD8\u53EF\u9760\u6027\u914D\u7F6E\n        props.put(ProducerConfig.ACKS_CONFIG, "all");\n        props.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE);     // \u65E0\u9650\u91CD\u8BD5\n        props.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, 1000);\n        props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n        props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 1); // \u4FDD\u8BC1\u987A\u5E8F\n        \n        // \u4E8B\u52A1\u914D\u7F6E\n        if (enableTransactions) {\n            props.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, "producer-" + System.currentTimeMillis());\n        }\n        \n        // \u9AD8\u6027\u80FD\u914D\u7F6E\n        props.put(ProducerConfig.BATCH_SIZE_CONFIG, 32768);              // 32KB\u6279\u6B21\n        props.put(ProducerConfig.LINGER_MS_CONFIG, 20);                  // \u7B49\u5F8520ms\n        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 67108864);        // 64MB\u7F13\u51B2\u533A\n        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");\n        \n        // \u8D85\u65F6\u914D\u7F6E\n        props.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, 30000);\n        props.put(ProducerConfig.DELIVERY_TIMEOUT_MS_CONFIG, 300000);    // 5\u5206\u949F\u6295\u9012\u8D85\u65F6\n        \n        // \u76D1\u63A7\u914D\u7F6E\n        props.put(ProducerConfig.METRIC_REPORTERS_CONFIG, "");\n        props.put(ProducerConfig.METRICS_SAMPLE_WINDOW_MS_CONFIG, 30000);\n        props.put(ProducerConfig.METRICS_NUM_SAMPLES_CONFIG, 2);\n        \n        return new KafkaProducer<>(props);\n    }\n    \n    /**\n     * \u4E8B\u52A1\u6027\u53D1\u9001\u6D88\u606F\n     */\n    public void sendTransactional(List<MessageData> messages) {\n        if (!transactionalEnabled) {\n            throw new IllegalStateException("\u4E8B\u52A1\u672A\u542F\u7528");\n        }\n        \n        try {\n            // \u5F00\u59CB\u4E8B\u52A1\n            producer.beginTransaction();\n            \n            // \u53D1\u9001\u6D88\u606F\n            for (MessageData msg : messages) {\n                ProducerRecord<String, String> record = \n                    new ProducerRecord<>(topicName, msg.getKey(), msg.getValue());\n                producer.send(record);\n            }\n            \n            // \u63D0\u4EA4\u4E8B\u52A1\n            producer.commitTransaction();\n            \n            totalSent.addAndGet(messages.size());\n            System.out.println("\u4E8B\u52A1\u63D0\u4EA4\u6210\u529F\uFF0C\u53D1\u9001 " + messages.size() + " \u6761\u6D88\u606F");\n            \n        } catch (ProducerFencedException | OutOfOrderSequenceException | AuthorizationException e) {\n            // \u4E0D\u53EF\u6062\u590D\u7684\u5F02\u5E38\uFF0C\u5173\u95ED\u751F\u4EA7\u8005\n            System.err.println("\u4E0D\u53EF\u6062\u590D\u7684\u4E8B\u52A1\u5F02\u5E38: " + e.getMessage());\n            close();\n            throw e;\n        } catch (Exception e) {\n            // \u53EF\u6062\u590D\u7684\u5F02\u5E38\uFF0C\u4E2D\u6B62\u4E8B\u52A1\n            System.err.println("\u4E8B\u52A1\u5F02\u5E38\uFF0C\u6B63\u5728\u4E2D\u6B62: " + e.getMessage());\n            producer.abortTransaction();\n            totalFailed.addAndGet(messages.size());\n            throw e;\n        }\n    }\n    \n    /**\n     * \u5E26\u91CD\u8BD5\u7B56\u7565\u7684\u53D1\u9001\n     */\n    public void sendWithRetry(String key, String value, int maxRetries) {\n        ProducerRecord<String, String> record = new ProducerRecord<>(topicName, key, value);\n        \n        sendWithRetry(record, maxRetries, 0);\n    }\n    \n    private void sendWithRetry(ProducerRecord<String, String> record, int maxRetries, int attempt) {\n        producer.send(record, (metadata, exception) -> {\n            if (exception == null) {\n                // \u53D1\u9001\u6210\u529F\n                totalSent.incrementAndGet();\n                totalBytes.addAndGet(record.value().getBytes().length);\n                metrics.recordSuccess(System.currentTimeMillis() - record.timestamp());\n                \n                System.out.printf("\u6D88\u606F\u53D1\u9001\u6210\u529F (\u5C1D\u8BD5 %d): offset=%d%n", attempt + 1, metadata.offset());\n                \n            } else {\n                // \u53D1\u9001\u5931\u8D25\n                totalFailed.incrementAndGet();\n                metrics.recordFailure();\n                \n                if (attempt < maxRetries) {\n                    // \u91CD\u8BD5\n                    System.out.printf("\u6D88\u606F\u53D1\u9001\u5931\u8D25\uFF0C\u6B63\u5728\u91CD\u8BD5 (%d/%d): %s%n", \n                        attempt + 1, maxRetries, exception.getMessage());\n                    \n                    // \u5EF6\u8FDF\u91CD\u8BD5\n                    scheduler.schedule(() -> {\n                        sendWithRetry(record, maxRetries, attempt + 1);\n                    }, (attempt + 1) * 1000, TimeUnit.MILLISECONDS);\n                    \n                } else {\n                    // \u91CD\u8BD5\u6B21\u6570\u7528\u5C3D\n                    System.err.printf("\u6D88\u606F\u53D1\u9001\u6700\u7EC8\u5931\u8D25 (%d \u6B21\u5C1D\u8BD5): %s%n", \n                        maxRetries + 1, exception.getMessage());\n                }\n            }\n        });\n    }\n    \n    /**\n     * \u5F02\u6B65\u53D1\u9001\u5E26\u56DE\u8C03\n     */\n    public void sendAsyncWithCallback(String key, String value, MessageCallback callback) {\n        ProducerRecord<String, String> record = new ProducerRecord<>(topicName, key, value);\n        \n        producer.send(record, (metadata, exception) -> {\n            if (exception == null) {\n                totalSent.incrementAndGet();\n                totalBytes.addAndGet(record.value().getBytes().length);\n                \n                if (callback != null) {\n                    callback.onSuccess(metadata);\n                }\n            } else {\n                totalFailed.incrementAndGet();\n                \n                if (callback != null) {\n                    callback.onFailure(exception);\n                }\n            }\n        });\n    }\n    \n    /**\n     * \u83B7\u53D6\u751F\u4EA7\u8005\u6307\u6807\n     */\n    public ProducerStats getStats() {\n        return new ProducerStats(\n            totalSent.get(),\n            totalFailed.get(),\n            totalBytes.get(),\n            metrics.getAverageLatency(),\n            metrics.getSuccessRate()\n        );\n    }\n    \n    /**\n     * \u542F\u52A8\u6307\u6807\u76D1\u63A7\n     */\n    private void startMetricsReporting() {\n        scheduler.scheduleAtFixedRate(() -> {\n            ProducerStats stats = getStats();\n            System.out.printf("\u751F\u4EA7\u8005\u6307\u6807 - \u6210\u529F: %d, \u5931\u8D25: %d, \u5B57\u8282\u6570: %d, \u5E73\u5747\u5EF6\u8FDF: %.2fms, \u6210\u529F\u7387: %.2f%%%n",\n                stats.getTotalSent(), stats.getTotalFailed(), stats.getTotalBytes(),\n                stats.getAverageLatency(), stats.getSuccessRate() * 100);\n        }, 30, 30, TimeUnit.SECONDS);\n    }\n    \n    /**\n     * \u4F18\u96C5\u5173\u95ED\n     */\n    public void close() {\n        try {\n            // \u5237\u65B0\u7F13\u51B2\u533A\n            producer.flush();\n            \n            // \u5173\u95ED\u751F\u4EA7\u8005\n            producer.close(Duration.ofSeconds(10));\n            \n            // \u5173\u95ED\u8C03\u5EA6\u5668\n            scheduler.shutdown();\n            \n            System.out.println("\u751F\u4EA7\u8005\u5DF2\u4F18\u96C5\u5173\u95ED");\n            \n        } catch (Exception e) {\n            System.err.println("\u5173\u95ED\u751F\u4EA7\u8005\u65F6\u53D1\u751F\u5F02\u5E38: " + e.getMessage());\n        }\n    }\n    \n    // \u6D88\u606F\u56DE\u8C03\u63A5\u53E3\n    public interface MessageCallback {\n        void onSuccess(RecordMetadata metadata);\n        void onFailure(Exception exception);\n    }\n    \n    // \u751F\u4EA7\u8005\u6307\u6807\u7C7B\n    private static class ProducerMetrics {\n        private final AtomicLong totalLatency = new AtomicLong(0);\n        private final AtomicLong successCount = new AtomicLong(0);\n        private final AtomicLong failureCount = new AtomicLong(0);\n        \n        public void recordSuccess(long latency) {\n            totalLatency.addAndGet(latency);\n            successCount.incrementAndGet();\n        }\n        \n        public void recordFailure() {\n            failureCount.incrementAndGet();\n        }\n        \n        public double getAverageLatency() {\n            long count = successCount.get();\n            return count > 0 ? (double) totalLatency.get() / count : 0.0;\n        }\n        \n        public double getSuccessRate() {\n            long total = successCount.get() + failureCount.get();\n            return total > 0 ? (double) successCount.get() / total : 0.0;\n        }\n    }\n    \n    // \u751F\u4EA7\u8005\u7EDF\u8BA1\u4FE1\u606F\n    public static class ProducerStats {\n        private final long totalSent;\n        private final long totalFailed;\n        private final long totalBytes;\n        private final double averageLatency;\n        private final double successRate;\n        \n        public ProducerStats(long totalSent, long totalFailed, long totalBytes, \n                           double averageLatency, double successRate) {\n            this.totalSent = totalSent;\n            this.totalFailed = totalFailed;\n            this.totalBytes = totalBytes;\n            this.averageLatency = averageLatency;\n            this.successRate = successRate;\n        }\n        \n        // Getters\n        public long getTotalSent() { return totalSent; }\n        public long getTotalFailed() { return totalFailed; }\n        public long getTotalBytes() { return totalBytes; }\n        public double getAverageLatency() { return averageLatency; }\n        public double getSuccessRate() { return successRate; }\n    }\n    \n    // \u6D88\u606F\u6570\u636E\u7C7B\n    public static class MessageData {\n        private String key;\n        private String value;\n        \n        public MessageData(String key, String value) {\n            this.key = key;\n            this.value = value;\n        }\n        \n        public String getKey() { return key; }\n        public String getValue() { return value; }\n    }\n}\n\n// \u9AD8\u7EA7\u751F\u4EA7\u8005\u4F7F\u7528\u793A\u4F8B\npublic class AdvancedProducerExample {\n    public static void main(String[] args) {\n        KafkaProducerAdvanced producer = new KafkaProducerAdvanced(\n            "localhost:9092", "user-events", true);\n        \n        try {\n            // \u4E8B\u52A1\u6027\u53D1\u9001\n            List<KafkaProducerAdvanced.MessageData> transactionalMessages = Arrays.asList(\n                new KafkaProducerAdvanced.MessageData("user-001", "login"),\n                new KafkaProducerAdvanced.MessageData("user-001", "view_product"),\n                new KafkaProducerAdvanced.MessageData("user-001", "purchase")\n            );\n            producer.sendTransactional(transactionalMessages);\n            \n            // \u5E26\u91CD\u8BD5\u7684\u53D1\u9001\n            producer.sendWithRetry("user-002", "important_event", 3);\n            \n            // \u5F02\u6B65\u53D1\u9001\u5E26\u56DE\u8C03\n            producer.sendAsyncWithCallback("user-003", "callback_event", \n                new KafkaProducerAdvanced.MessageCallback() {\n                    @Override\n                    public void onSuccess(RecordMetadata metadata) {\n                        System.out.println("\u56DE\u8C03\u6210\u529F: " + metadata.offset());\n                    }\n                    \n                    @Override\n                    public void onFailure(Exception exception) {\n                        System.err.println("\u56DE\u8C03\u5931\u8D25: " + exception.getMessage());\n                    }\n                });\n            \n            // \u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\u67E5\u770B\u6307\u6807\n            Thread.sleep(60000);\n            \n            // \u6253\u5370\u6700\u7EC8\u7EDF\u8BA1\n            KafkaProducerAdvanced.ProducerStats stats = producer.getStats();\n            System.out.println("\u6700\u7EC8\u7EDF\u8BA1: " + stats.getTotalSent() + " \u6210\u529F, " + \n                             stats.getTotalFailed() + " \u5931\u8D25");\n            \n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            producer.close();\n        }\n    }\n}\n'})})}),(0,i.jsxs)(a.A,{value:"performance",label:"\u6027\u80FD\u4F18\u5316",children:[(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u6027\u80FD\u4F18\u5316\u914D\u7F6E\u5BF9\u6BD4"}),"\uFF1A"]}),(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u914D\u7F6E\u9879"}),(0,i.jsx)(e.th,{children:"\u9AD8\u541E\u5410\u91CF\u914D\u7F6E"}),(0,i.jsx)(e.th,{children:"\u4F4E\u5EF6\u8FDF\u914D\u7F6E"}),(0,i.jsx)(e.th,{children:"\u9AD8\u53EF\u9760\u6027\u914D\u7F6E"}),(0,i.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"acks"})}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"all"}),(0,i.jsx)(e.td,{children:"\u786E\u8BA4\u7EA7\u522B"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"batch.size"})}),(0,i.jsx)(e.td,{children:"65536 (64KB)"}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"16384 (16KB)"}),(0,i.jsx)(e.td,{children:"\u6279\u6B21\u5927\u5C0F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"linger.ms"})}),(0,i.jsx)(e.td,{children:"100"}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"10"}),(0,i.jsx)(e.td,{children:"\u7B49\u5F85\u65F6\u95F4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"compression.type"})}),(0,i.jsx)(e.td,{children:"lz4"}),(0,i.jsx)(e.td,{children:"none"}),(0,i.jsx)(e.td,{children:"gzip"}),(0,i.jsx)(e.td,{children:"\u538B\u7F29\u7B97\u6CD5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"buffer.memory"})}),(0,i.jsx)(e.td,{children:"134217728 (128MB)"}),(0,i.jsx)(e.td,{children:"33554432 (32MB)"}),(0,i.jsx)(e.td,{children:"67108864 (64MB)"}),(0,i.jsx)(e.td,{children:"\u7F13\u51B2\u533A\u5927\u5C0F"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"retries"})}),(0,i.jsx)(e.td,{children:"5"}),(0,i.jsx)(e.td,{children:"0"}),(0,i.jsx)(e.td,{children:"Integer.MAX_VALUE"}),(0,i.jsx)(e.td,{children:"\u91CD\u8BD5\u6B21\u6570"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"max.in.flight.requests"})}),(0,i.jsx)(e.td,{children:"5"}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"1"}),(0,i.jsx)(e.td,{children:"\u5E76\u53D1\u8BF7\u6C42\u6570"})]})]})]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177"',children:'/**\n * Kafka\u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177\n * \u7528\u4E8E\u6D4B\u8BD5\u4E0D\u540C\u914D\u7F6E\u4E0B\u7684\u751F\u4EA7\u8005\u6027\u80FD\n */\npublic class ProducerPerformanceTest {\n    \n    /**\n     * \u6027\u80FD\u6D4B\u8BD5\u914D\u7F6E\n     */\n    public enum PerformanceProfile {\n        HIGH_THROUGHPUT,    // \u9AD8\u541E\u5410\u91CF\n        LOW_LATENCY,        // \u4F4E\u5EF6\u8FDF\n        HIGH_RELIABILITY    // \u9AD8\u53EF\u9760\u6027\n    }\n    \n    /**\n     * \u521B\u5EFA\u6027\u80FD\u6D4B\u8BD5\u751F\u4EA7\u8005\n     */\n    public static KafkaProducer<String, String> createPerformanceProducer(\n            String bootstrapServers, PerformanceProfile profile) {\n        \n        Properties props = new Properties();\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        \n        switch (profile) {\n            case HIGH_THROUGHPUT:\n                // \u9AD8\u541E\u5410\u91CF\u914D\u7F6E\n                props.put(ProducerConfig.ACKS_CONFIG, "1");\n                props.put(ProducerConfig.BATCH_SIZE_CONFIG, 65536);\n                props.put(ProducerConfig.LINGER_MS_CONFIG, 100);\n                props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");\n                props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 134217728);\n                props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 5);\n                break;\n                \n            case LOW_LATENCY:\n                // \u4F4E\u5EF6\u8FDF\u914D\u7F6E\n                props.put(ProducerConfig.ACKS_CONFIG, "1");\n                props.put(ProducerConfig.BATCH_SIZE_CONFIG, 0);\n                props.put(ProducerConfig.LINGER_MS_CONFIG, 0);\n                props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "none");\n                props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);\n                props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 1);\n                break;\n                \n            case HIGH_RELIABILITY:\n                // \u9AD8\u53EF\u9760\u6027\u914D\u7F6E\n                props.put(ProducerConfig.ACKS_CONFIG, "all");\n                props.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);\n                props.put(ProducerConfig.LINGER_MS_CONFIG, 10);\n                props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "gzip");\n                props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 67108864);\n                props.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE);\n                props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n                props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 1);\n                break;\n        }\n        \n        return new KafkaProducer<>(props);\n    }\n    \n    /**\n     * \u6267\u884C\u6027\u80FD\u6D4B\u8BD5\n     */\n    public static TestResult runPerformanceTest(String bootstrapServers, String topic,\n                                              PerformanceProfile profile, int messageCount, int messageSize) {\n        \n        KafkaProducer<String, String> producer = createPerformanceProducer(bootstrapServers, profile);\n        \n        // \u751F\u6210\u6D4B\u8BD5\u6D88\u606F\n        String messageValue = generateMessage(messageSize);\n        \n        long startTime = System.currentTimeMillis();\n        AtomicLong successCount = new AtomicLong(0);\n        AtomicLong failureCount = new AtomicLong(0);\n        List<Long> latencies = Collections.synchronizedList(new ArrayList<>());\n        \n        CountDownLatch latch = new CountDownLatch(messageCount);\n        \n        // \u53D1\u9001\u6D88\u606F\n        for (int i = 0; i < messageCount; i++) {\n            String key = "key-" + i;\n            ProducerRecord<String, String> record = new ProducerRecord<>(topic, key, messageValue);\n            \n            long sendTime = System.nanoTime();\n            producer.send(record, (metadata, exception) -> {\n                long latency = (System.nanoTime() - sendTime) / 1_000_000; // \u8F6C\u6362\u4E3A\u6BEB\u79D2\n                \n                if (exception == null) {\n                    successCount.incrementAndGet();\n                    latencies.add(latency);\n                } else {\n                    failureCount.incrementAndGet();\n                }\n                \n                latch.countDown();\n            });\n        }\n        \n        try {\n            // \u7B49\u5F85\u6240\u6709\u6D88\u606F\u53D1\u9001\u5B8C\u6210\n            latch.await(5, TimeUnit.MINUTES);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        long endTime = System.currentTimeMillis();\n        producer.close();\n        \n        // \u8BA1\u7B97\u7EDF\u8BA1\u4FE1\u606F\n        long totalTime = endTime - startTime;\n        double throughput = (double) successCount.get() / totalTime * 1000; // \u6D88\u606F/\u79D2\n        double avgLatency = latencies.stream().mapToLong(Long::longValue).average().orElse(0.0);\n        double p95Latency = calculatePercentile(latencies, 0.95);\n        double p99Latency = calculatePercentile(latencies, 0.99);\n        \n        return new TestResult(profile, messageCount, messageSize, totalTime,\n                            successCount.get(), failureCount.get(), throughput,\n                            avgLatency, p95Latency, p99Latency);\n    }\n    \n    private static String generateMessage(int size) {\n        StringBuilder sb = new StringBuilder(size);\n        for (int i = 0; i < size; i++) {\n            sb.append(\'a\');\n        }\n        return sb.toString();\n    }\n    \n    private static double calculatePercentile(List<Long> values, double percentile) {\n        if (values.isEmpty()) return 0.0;\n        \n        List<Long> sorted = new ArrayList<>(values);\n        Collections.sort(sorted);\n        \n        int index = (int) Math.ceil(percentile * sorted.size()) - 1;\n        return sorted.get(Math.max(0, index));\n    }\n    \n    // \u6D4B\u8BD5\u7ED3\u679C\u7C7B\n    public static class TestResult {\n        private final PerformanceProfile profile;\n        private final int messageCount;\n        private final int messageSize;\n        private final long totalTime;\n        private final long successCount;\n        private final long failureCount;\n        private final double throughput;\n        private final double avgLatency;\n        private final double p95Latency;\n        private final double p99Latency;\n        \n        public TestResult(PerformanceProfile profile, int messageCount, int messageSize,\n                         long totalTime, long successCount, long failureCount,\n                         double throughput, double avgLatency, double p95Latency, double p99Latency) {\n            this.profile = profile;\n            this.messageCount = messageCount;\n            this.messageSize = messageSize;\n            this.totalTime = totalTime;\n            this.successCount = successCount;\n            this.failureCount = failureCount;\n            this.throughput = throughput;\n            this.avgLatency = avgLatency;\n            this.p95Latency = p95Latency;\n            this.p99Latency = p99Latency;\n        }\n        \n        public void printReport() {\n            System.out.println("=== \u6027\u80FD\u6D4B\u8BD5\u62A5\u544A ===");\n            System.out.println("\u914D\u7F6E\u7C7B\u578B: " + profile);\n            System.out.println("\u6D88\u606F\u6570\u91CF: " + messageCount);\n            System.out.println("\u6D88\u606F\u5927\u5C0F: " + messageSize + " \u5B57\u8282");\n            System.out.println("\u603B\u8017\u65F6: " + totalTime + " ms");\n            System.out.println("\u6210\u529F\u6570\u91CF: " + successCount);\n            System.out.println("\u5931\u8D25\u6570\u91CF: " + failureCount);\n            System.out.printf("\u541E\u5410\u91CF: %.2f \u6D88\u606F/\u79D2%n", throughput);\n            System.out.printf("\u5E73\u5747\u5EF6\u8FDF: %.2f ms%n", avgLatency);\n            System.out.printf("P95\u5EF6\u8FDF: %.2f ms%n", p95Latency);\n            System.out.printf("P99\u5EF6\u8FDF: %.2f ms%n", p99Latency);\n            System.out.println();\n        }\n        \n        // Getters\n        public PerformanceProfile getProfile() { return profile; }\n        public double getThroughput() { return throughput; }\n        public double getAvgLatency() { return avgLatency; }\n        public double getP95Latency() { return p95Latency; }\n        public double getP99Latency() { return p99Latency; }\n    }\n    \n    public static void main(String[] args) {\n        String bootstrapServers = "localhost:9092";\n        String topic = "performance-test";\n        int messageCount = 10000;\n        int messageSize = 1024; // 1KB\n        \n        // \u6D4B\u8BD5\u4E0D\u540C\u914D\u7F6E\u7684\u6027\u80FD\n        for (PerformanceProfile profile : PerformanceProfile.values()) {\n            System.out.println("\u5F00\u59CB\u6D4B\u8BD5\u914D\u7F6E: " + profile);\n            TestResult result = runPerformanceTest(bootstrapServers, topic, profile, messageCount, messageSize);\n            result.printReport();\n        }\n    }\n}\n'})})]})]}),"\n",(0,i.jsx)(e.h3,{id:"32-consumer\u6D88\u8D39\u8005--\u9AD8\u6548\u6D88\u606F\u6D88\u8D39",children:"3.2 Consumer\uFF08\u6D88\u8D39\u8005\uFF09- \u9AD8\u6548\u6D88\u606F\u6D88\u8D39"}),"\n",(0,i.jsx)(e.p,{children:"Kafka\u6D88\u8D39\u8005\u8D1F\u8D23\u4ECETopic\u4E2D\u8BFB\u53D6\u6D88\u606F\u3002\u6D88\u8D39\u8005\u53EF\u4EE5\u5355\u72EC\u5DE5\u4F5C\uFF0C\u4E5F\u53EF\u4EE5\u4F5C\u4E3A\u6D88\u8D39\u8005\u7EC4\u7684\u4E00\u90E8\u5206\u534F\u540C\u5DE5\u4F5C\uFF0C\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861\u548C\u6545\u969C\u8F6C\u79FB\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"basic",label:"\u57FA\u7840\u6D88\u8D39\u8005",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Kafka\u6D88\u8D39\u8005\u57FA\u7840\u5B9E\u73B0"',children:'import org.apache.kafka.clients.consumer.*;\nimport org.apache.kafka.common.TopicPartition;\nimport org.apache.kafka.common.serialization.StringDeserializer;\nimport java.time.Duration;\nimport java.util.*;\n\n/**\n * Kafka\u6D88\u8D39\u8005\u57FA\u7840\u5B9E\u73B0\n * \u5C55\u793A\u81EA\u52A8\u63D0\u4EA4\u3001\u624B\u52A8\u63D0\u4EA4\u3001\u6307\u5B9A\u5206\u533A\u6D88\u8D39\u7B49\u529F\u80FD\n */\npublic class KafkaConsumerBasic {\n    \n    private final KafkaConsumer<String, String> consumer;\n    private final List<String> topics;\n    private volatile boolean running = false;\n    \n    public KafkaConsumerBasic(String bootstrapServers, String groupId, List<String> topics) {\n        this.topics = topics;\n        this.consumer = createConsumer(bootstrapServers, groupId);\n    }\n    \n    /**\n     * \u521B\u5EFA\u6D88\u8D39\u8005\u5B9E\u4F8B\n     */\n    private KafkaConsumer<String, String> createConsumer(String bootstrapServers, String groupId) {\n        Properties props = new Properties();\n        \n        // \u57FA\u7840\u8FDE\u63A5\u914D\u7F6E\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        \n        // \u4F4D\u79FB\u7BA1\u7406\u914D\u7F6E\n        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);      // \u7981\u7528\u81EA\u52A8\u63D0\u4EA4\n        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");  // \u4ECE\u6700\u65E9\u4F4D\u79FB\u5F00\u59CB\n        \n        // \u62C9\u53D6\u914D\u7F6E\n        props.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 1024);          // \u6700\u5C0F\u62C9\u53D61KB\n        props.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, 500);         // \u6700\u5927\u7B49\u5F85500ms\n        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 500);          // \u6BCF\u6B21\u6700\u591A\u62C9\u53D6500\u6761\n        props.put(ConsumerConfig.MAX_PARTITION_FETCH_BYTES_CONFIG, 1048576); // \u6BCF\u5206\u533A\u6700\u59271MB\n        \n        // \u4F1A\u8BDD\u914D\u7F6E\n        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, 30000);      // \u4F1A\u8BDD\u8D85\u65F630\u79D2\n        props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 10000);   // \u5FC3\u8DF3\u95F4\u969410\u79D2\n        props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, 300000);   // \u6700\u5927poll\u95F4\u96945\u5206\u949F\n        \n        return new KafkaConsumer<>(props);\n    }\n    \n    /**\n     * \u81EA\u52A8\u63D0\u4EA4\u6A21\u5F0F\u6D88\u8D39\n     */\n    public void consumeWithAutoCommit() {\n        // \u91CD\u65B0\u914D\u7F6E\u4E3A\u81EA\u52A8\u63D0\u4EA4\n        consumer.close();\n        Properties props = new Properties();\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, "auto-commit-group");\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true);       // \u542F\u7528\u81EA\u52A8\u63D0\u4EA4\n        props.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, 5000);  // 5\u79D2\u81EA\u52A8\u63D0\u4EA4\u4E00\u6B21\n        \n        KafkaConsumer<String, String> autoCommitConsumer = new KafkaConsumer<>(props);\n        autoCommitConsumer.subscribe(topics);\n        \n        System.out.println("\u5F00\u59CB\u81EA\u52A8\u63D0\u4EA4\u6A21\u5F0F\u6D88\u8D39...");\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = autoCommitConsumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    System.out.printf("\u81EA\u52A8\u63D0\u4EA4\u6D88\u8D39: topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                        record.topic(), record.partition(), record.offset(), record.key(), record.value());\n                    \n                    // \u5904\u7406\u6D88\u606F\n                    processMessage(record);\n                }\n                \n                // \u81EA\u52A8\u63D0\u4EA4\u4F1A\u5728\u540E\u53F0\u5B9A\u671F\u6267\u884C\n            }\n        } finally {\n            autoCommitConsumer.close();\n        }\n    }\n    \n    /**\n     * \u624B\u52A8\u540C\u6B65\u63D0\u4EA4\u6A21\u5F0F\u6D88\u8D39\n     */\n    public void consumeWithSyncCommit() {\n        consumer.subscribe(topics);\n        running = true;\n        \n        System.out.println("\u5F00\u59CB\u624B\u52A8\u540C\u6B65\u63D0\u4EA4\u6A21\u5F0F\u6D88\u8D39...");\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    System.out.printf("\u540C\u6B65\u63D0\u4EA4\u6D88\u8D39: topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                        record.topic(), record.partition(), record.offset(), record.key(), record.value());\n                    \n                    // \u5904\u7406\u6D88\u606F\n                    processMessage(record);\n                }\n                \n                if (!records.isEmpty()) {\n                    try {\n                        // \u540C\u6B65\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u4F1A\u963B\u585E\u76F4\u5230\u63D0\u4EA4\u6210\u529F\u6216\u5931\u8D25\n                        consumer.commitSync();\n                        System.out.println("\u4F4D\u79FB\u540C\u6B65\u63D0\u4EA4\u6210\u529F");\n                    } catch (CommitFailedException e) {\n                        System.err.println("\u4F4D\u79FB\u63D0\u4EA4\u5931\u8D25: " + e.getMessage());\n                    }\n                }\n            }\n        } finally {\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u624B\u52A8\u5F02\u6B65\u63D0\u4EA4\u6A21\u5F0F\u6D88\u8D39\n     */\n    public void consumeWithAsyncCommit() {\n        consumer.subscribe(topics);\n        running = true;\n        \n        System.out.println("\u5F00\u59CB\u624B\u52A8\u5F02\u6B65\u63D0\u4EA4\u6A21\u5F0F\u6D88\u8D39...");\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    System.out.printf("\u5F02\u6B65\u63D0\u4EA4\u6D88\u8D39: topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                        record.topic(), record.partition(), record.offset(), record.key(), record.value());\n                    \n                    // \u5904\u7406\u6D88\u606F\n                    processMessage(record);\n                }\n                \n                if (!records.isEmpty()) {\n                    // \u5F02\u6B65\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u4E0D\u4F1A\u963B\u585E\n                    consumer.commitAsync(new OffsetCommitCallback() {\n                        @Override\n                        public void onComplete(Map<TopicPartition, OffsetAndMetadata> offsets, Exception exception) {\n                            if (exception == null) {\n                                System.out.println("\u4F4D\u79FB\u5F02\u6B65\u63D0\u4EA4\u6210\u529F: " + offsets);\n                            } else {\n                                System.err.println("\u4F4D\u79FB\u5F02\u6B65\u63D0\u4EA4\u5931\u8D25: " + exception.getMessage());\n                            }\n                        }\n                    });\n                }\n            }\n        } finally {\n            // \u5173\u95ED\u524D\u8FDB\u884C\u6700\u540E\u4E00\u6B21\u540C\u6B65\u63D0\u4EA4\n            try {\n                consumer.commitSync();\n            } catch (Exception e) {\n                System.err.println("\u6700\u7EC8\u540C\u6B65\u63D0\u4EA4\u5931\u8D25: " + e.getMessage());\n            }\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u6307\u5B9A\u5206\u533A\u6D88\u8D39\n     */\n    public void consumeSpecificPartitions(String topic, List<Integer> partitions) {\n        // \u6784\u5EFATopicPartition\u5217\u8868\n        List<TopicPartition> topicPartitions = new ArrayList<>();\n        for (Integer partition : partitions) {\n            topicPartitions.add(new TopicPartition(topic, partition));\n        }\n        \n        // \u5206\u914D\u6307\u5B9A\u5206\u533A\uFF08\u4E0D\u4F7F\u7528subscribe\uFF09\n        consumer.assign(topicPartitions);\n        \n        // \u53EF\u9009\uFF1A\u6307\u5B9A\u8D77\u59CB\u4F4D\u79FB\n        consumer.seekToBeginning(topicPartitions); // \u4ECE\u5934\u5F00\u59CB\n        // consumer.seekToEnd(topicPartitions);    // \u4ECE\u672B\u5C3E\u5F00\u59CB\n        \n        running = true;\n        System.out.println("\u5F00\u59CB\u6307\u5B9A\u5206\u533A\u6D88\u8D39: " + topicPartitions);\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    System.out.printf("\u6307\u5B9A\u5206\u533A\u6D88\u8D39: topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                        record.topic(), record.partition(), record.offset(), record.key(), record.value());\n                    \n                    // \u5904\u7406\u6D88\u606F\n                    processMessage(record);\n                }\n                \n                // \u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\n                if (!records.isEmpty()) {\n                    consumer.commitSync();\n                }\n            }\n        } finally {\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u6309\u65F6\u95F4\u6233\u6D88\u8D39\n     */\n    public void consumeFromTimestamp(String topic, long timestamp) {\n        // \u83B7\u53D6Topic\u7684\u6240\u6709\u5206\u533A\n        List<PartitionInfo> partitionInfos = consumer.partitionsFor(topic);\n        List<TopicPartition> topicPartitions = new ArrayList<>();\n        \n        for (PartitionInfo partitionInfo : partitionInfos) {\n            topicPartitions.add(new TopicPartition(topic, partitionInfo.partition()));\n        }\n        \n        // \u5206\u914D\u5206\u533A\n        consumer.assign(topicPartitions);\n        \n        // \u6784\u5EFA\u65F6\u95F4\u6233\u67E5\u8BE2\u6620\u5C04\n        Map<TopicPartition, Long> timestampsToSearch = new HashMap<>();\n        for (TopicPartition tp : topicPartitions) {\n            timestampsToSearch.put(tp, timestamp);\n        }\n        \n        // \u6839\u636E\u65F6\u95F4\u6233\u67E5\u627E\u4F4D\u79FB\n        Map<TopicPartition, OffsetAndTimestamp> offsetsForTimes = consumer.offsetsForTimes(timestampsToSearch);\n        \n        // \u8BBE\u7F6E\u8D77\u59CB\u4F4D\u79FB\n        for (TopicPartition tp : topicPartitions) {\n            OffsetAndTimestamp offsetAndTimestamp = offsetsForTimes.get(tp);\n            if (offsetAndTimestamp != null) {\n                consumer.seek(tp, offsetAndTimestamp.offset());\n                System.out.println("\u5206\u533A " + tp.partition() + " \u4ECE\u4F4D\u79FB " + offsetAndTimestamp.offset() + " \u5F00\u59CB\u6D88\u8D39");\n            } else {\n                // \u5982\u679C\u6CA1\u6709\u627E\u5230\u5BF9\u5E94\u65F6\u95F4\u6233\u7684\u4F4D\u79FB\uFF0C\u4ECE\u672B\u5C3E\u5F00\u59CB\n                consumer.seekToEnd(Arrays.asList(tp));\n                System.out.println("\u5206\u533A " + tp.partition() + " \u6CA1\u6709\u627E\u5230\u5BF9\u5E94\u65F6\u95F4\u6233\u7684\u4F4D\u79FB\uFF0C\u4ECE\u672B\u5C3E\u5F00\u59CB");\n            }\n        }\n        \n        running = true;\n        System.out.println("\u5F00\u59CB\u4ECE\u65F6\u95F4\u6233 " + new Date(timestamp) + " \u6D88\u8D39");\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    System.out.printf("\u65F6\u95F4\u6233\u6D88\u8D39: topic=%s, partition=%d, offset=%d, timestamp=%s, key=%s, value=%s%n",\n                        record.topic(), record.partition(), record.offset(), \n                        new Date(record.timestamp()), record.key(), record.value());\n                    \n                    // \u5904\u7406\u6D88\u606F\n                    processMessage(record);\n                }\n                \n                if (!records.isEmpty()) {\n                    consumer.commitSync();\n                }\n            }\n        } finally {\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u6279\u91CF\u5904\u7406\u6D88\u606F\n     */\n    public void consumeInBatches(int batchSize) {\n        consumer.subscribe(topics);\n        running = true;\n        \n        List<ConsumerRecord<String, String>> batch = new ArrayList<>();\n        \n        System.out.println("\u5F00\u59CB\u6279\u91CF\u6D88\u8D39\uFF0C\u6279\u6B21\u5927\u5C0F: " + batchSize);\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    batch.add(record);\n                    \n                    // \u5F53\u6279\u6B21\u8FBE\u5230\u6307\u5B9A\u5927\u5C0F\u65F6\u5904\u7406\n                    if (batch.size() >= batchSize) {\n                        processBatch(batch);\n                        batch.clear();\n                        \n                        // \u63D0\u4EA4\u4F4D\u79FB\n                        consumer.commitSync();\n                    }\n                }\n            }\n            \n            // \u5904\u7406\u5269\u4F59\u7684\u6D88\u606F\n            if (!batch.isEmpty()) {\n                processBatch(batch);\n                consumer.commitSync();\n            }\n            \n        } finally {\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u5904\u7406\u5355\u6761\u6D88\u606F\n     */\n    private void processMessage(ConsumerRecord<String, String> record) {\n        try {\n            // \u6A21\u62DF\u6D88\u606F\u5904\u7406\n            Thread.sleep(10);\n            \n            // \u8FD9\u91CC\u53EF\u4EE5\u6DFB\u52A0\u5177\u4F53\u7684\u4E1A\u52A1\u903B\u8F91\n            // \u4F8B\u5982\uFF1A\u4FDD\u5B58\u5230\u6570\u636E\u5E93\u3001\u53D1\u9001\u5230\u5176\u4ED6\u7CFB\u7EDF\u7B49\n            \n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n            System.err.println("\u6D88\u606F\u5904\u7406\u88AB\u4E2D\u65AD");\n        } catch (Exception e) {\n            System.err.println("\u5904\u7406\u6D88\u606F\u5931\u8D25: " + e.getMessage());\n            // \u53EF\u4EE5\u9009\u62E9\u91CD\u8BD5\u3001\u8BB0\u5F55\u9519\u8BEF\u65E5\u5FD7\u6216\u53D1\u9001\u5230\u6B7B\u4FE1\u961F\u5217\n        }\n    }\n    \n    /**\n     * \u6279\u91CF\u5904\u7406\u6D88\u606F\n     */\n    private void processBatch(List<ConsumerRecord<String, String>> batch) {\n        System.out.println("\u5904\u7406\u6279\u6B21\uFF0C\u5305\u542B " + batch.size() + " \u6761\u6D88\u606F");\n        \n        try {\n            // \u6279\u91CF\u5904\u7406\u903B\u8F91\n            for (ConsumerRecord<String, String> record : batch) {\n                // \u5904\u7406\u5355\u6761\u6D88\u606F\n                processMessage(record);\n            }\n            \n            System.out.println("\u6279\u6B21\u5904\u7406\u5B8C\u6210");\n            \n        } catch (Exception e) {\n            System.err.println("\u6279\u6B21\u5904\u7406\u5931\u8D25: " + e.getMessage());\n            // \u53EF\u4EE5\u9009\u62E9\u91CD\u8BD5\u6574\u4E2A\u6279\u6B21\u6216\u5355\u72EC\u5904\u7406\u5931\u8D25\u7684\u6D88\u606F\n        }\n    }\n    \n    /**\n     * \u505C\u6B62\u6D88\u8D39\n     */\n    public void stop() {\n        running = false;\n        System.out.println("\u6B63\u5728\u505C\u6B62\u6D88\u8D39\u8005...");\n    }\n    \n    /**\n     * \u83B7\u53D6\u6D88\u8D39\u8005\u6307\u6807\n     */\n    public void printConsumerMetrics() {\n        Map<MetricName, ? extends Metric> metrics = consumer.metrics();\n        \n        System.out.println("=== \u6D88\u8D39\u8005\u6307\u6807 ===");\n        for (Map.Entry<MetricName, ? extends Metric> entry : metrics.entrySet()) {\n            MetricName name = entry.getKey();\n            Metric metric = entry.getValue();\n            \n            // \u53EA\u6253\u5370\u91CD\u8981\u6307\u6807\n            if (name.name().contains("records-consumed") || \n                name.name().contains("bytes-consumed") ||\n                name.name().contains("fetch-latency")) {\n                System.out.printf("%s.%s: %.2f%n", name.group(), name.name(), metric.metricValue());\n            }\n        }\n    }\n}\n\n// \u6D88\u8D39\u8005\u4F7F\u7528\u793A\u4F8B\npublic class ConsumerExample {\n    public static void main(String[] args) {\n        List<String> topics = Arrays.asList("user-events", "order-events");\n        KafkaConsumerBasic consumer = new KafkaConsumerBasic("localhost:9092", "example-group", topics);\n        \n        // \u521B\u5EFA\u6D88\u8D39\u7EBF\u7A0B\n        Thread consumerThread = new Thread(() -> {\n            // \u9009\u62E9\u4E0D\u540C\u7684\u6D88\u8D39\u6A21\u5F0F\n            // consumer.consumeWithAutoCommit();\n            // consumer.consumeWithSyncCommit();\n            consumer.consumeWithAsyncCommit();\n            // consumer.consumeSpecificPartitions("user-events", Arrays.asList(0, 1));\n            // consumer.consumeFromTimestamp("user-events", System.currentTimeMillis() - 3600000); // 1\u5C0F\u65F6\u524D\n            // consumer.consumeInBatches(10);\n        });\n        \n        consumerThread.start();\n        \n        // \u8FD0\u884C\u4E00\u6BB5\u65F6\u95F4\u540E\u505C\u6B62\n        try {\n            Thread.sleep(60000); // \u8FD0\u884C1\u5206\u949F\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        consumer.stop();\n        \n        try {\n            consumerThread.join();\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        // \u6253\u5370\u6D88\u8D39\u8005\u6307\u6807\n        consumer.printConsumerMetrics();\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"consumer-group",label:"\u6D88\u8D39\u8005\u7EC4",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u6D88\u8D39\u8005\u7EC4\u7BA1\u7406\u548C\u76D1\u63A7"',children:'import org.apache.kafka.clients.admin.*;\nimport org.apache.kafka.clients.consumer.*;\nimport org.apache.kafka.common.TopicPartition;\nimport java.util.*;\nimport java.util.concurrent.ExecutionException;\n\n/**\n * Kafka\u6D88\u8D39\u8005\u7EC4\u7BA1\u7406\u5DE5\u5177\n * \u63D0\u4F9B\u6D88\u8D39\u8005\u7EC4\u7684\u521B\u5EFA\u3001\u76D1\u63A7\u3001\u91CD\u5E73\u8861\u7B49\u529F\u80FD\n */\npublic class ConsumerGroupManager {\n    \n    private final AdminClient adminClient;\n    \n    public ConsumerGroupManager(String bootstrapServers) {\n        Properties props = new Properties();\n        props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        this.adminClient = AdminClient.create(props);\n    }\n    \n    /**\n     * \u5217\u51FA\u6240\u6709\u6D88\u8D39\u8005\u7EC4\n     */\n    public List<String> listConsumerGroups() {\n        try {\n            ListConsumerGroupsResult result = adminClient.listConsumerGroups();\n            return result.all().get().stream()\n                .map(ConsumerGroupListing::groupId)\n                .collect(Collectors.toList());\n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u5217\u51FA\u6D88\u8D39\u8005\u7EC4\u5931\u8D25", e);\n        }\n    }\n    \n    /**\n     * \u83B7\u53D6\u6D88\u8D39\u8005\u7EC4\u8BE6\u7EC6\u4FE1\u606F\n     */\n    public ConsumerGroupInfo getConsumerGroupInfo(String groupId) {\n        try {\n            // \u83B7\u53D6\u6D88\u8D39\u8005\u7EC4\u63CF\u8FF0\n            DescribeConsumerGroupsResult describeResult = \n                adminClient.describeConsumerGroups(Arrays.asList(groupId));\n            ConsumerGroupDescription description = describeResult.all().get().get(groupId);\n            \n            // \u83B7\u53D6\u6D88\u8D39\u8005\u7EC4\u4F4D\u79FB\u4FE1\u606F\n            ListConsumerGroupOffsetsResult offsetsResult = \n                adminClient.listConsumerGroupOffsets(groupId);\n            Map<TopicPartition, OffsetAndMetadata> offsets = offsetsResult.partitionsToOffsetAndMetadata().get();\n            \n            return new ConsumerGroupInfo(description, offsets);\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u83B7\u53D6\u6D88\u8D39\u8005\u7EC4\u4FE1\u606F\u5931\u8D25: " + groupId, e);\n        }\n    }\n    \n    /**\n     * \u91CD\u7F6E\u6D88\u8D39\u8005\u7EC4\u4F4D\u79FB\n     */\n    public void resetConsumerGroupOffsets(String groupId, String topic, OffsetResetStrategy strategy) {\n        try {\n            // \u9996\u5148\u68C0\u67E5\u6D88\u8D39\u8005\u7EC4\u72B6\u6001\n            ConsumerGroupInfo groupInfo = getConsumerGroupInfo(groupId);\n            if (groupInfo.getState() != ConsumerGroupState.Empty) {\n                throw new IllegalStateException("\u6D88\u8D39\u8005\u7EC4\u5FC5\u987B\u4E3A\u7A7A\u72B6\u6001\u624D\u80FD\u91CD\u7F6E\u4F4D\u79FB\uFF0C\u5F53\u524D\u72B6\u6001: " + groupInfo.getState());\n            }\n            \n            // \u83B7\u53D6Topic\u5206\u533A\u4FE1\u606F\n            DescribeTopicsResult topicsResult = adminClient.describeTopics(Arrays.asList(topic));\n            TopicDescription topicDescription = topicsResult.all().get().get(topic);\n            \n            Map<TopicPartition, OffsetAndMetadata> offsetsToReset = new HashMap<>();\n            \n            for (TopicPartitionInfo partitionInfo : topicDescription.partitions()) {\n                TopicPartition tp = new TopicPartition(topic, partitionInfo.partition());\n                \n                long newOffset;\n                switch (strategy) {\n                    case EARLIEST:\n                        // \u91CD\u7F6E\u5230\u6700\u65E9\u4F4D\u79FB\n                        newOffset = getEarliestOffset(tp);\n                        break;\n                    case LATEST:\n                        // \u91CD\u7F6E\u5230\u6700\u65B0\u4F4D\u79FB\n                        newOffset = getLatestOffset(tp);\n                        break;\n                    default:\n                        throw new IllegalArgumentException("\u4E0D\u652F\u6301\u7684\u91CD\u7F6E\u7B56\u7565: " + strategy);\n                }\n                \n                offsetsToReset.put(tp, new OffsetAndMetadata(newOffset));\n            }\n            \n            // \u6267\u884C\u4F4D\u79FB\u91CD\u7F6E\n            AlterConsumerGroupOffsetsResult alterResult = \n                adminClient.alterConsumerGroupOffsets(groupId, offsetsToReset);\n            alterResult.all().get();\n            \n            System.out.println("\u6D88\u8D39\u8005\u7EC4 " + groupId + " \u7684\u4F4D\u79FB\u91CD\u7F6E\u6210\u529F\uFF0C\u7B56\u7565: " + strategy);\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u91CD\u7F6E\u6D88\u8D39\u8005\u7EC4\u4F4D\u79FB\u5931\u8D25: " + groupId, e);\n        }\n    }\n    \n    /**\n     * \u5220\u9664\u6D88\u8D39\u8005\u7EC4\n     */\n    public void deleteConsumerGroup(String groupId) {\n        try {\n            // \u68C0\u67E5\u6D88\u8D39\u8005\u7EC4\u72B6\u6001\n            ConsumerGroupInfo groupInfo = getConsumerGroupInfo(groupId);\n            if (groupInfo.getState() != ConsumerGroupState.Empty) {\n                throw new IllegalStateException("\u53EA\u80FD\u5220\u9664\u7A7A\u7684\u6D88\u8D39\u8005\u7EC4\uFF0C\u5F53\u524D\u72B6\u6001: " + groupInfo.getState());\n            }\n            \n            DeleteConsumerGroupsResult result = adminClient.deleteConsumerGroups(Arrays.asList(groupId));\n            result.all().get();\n            \n            System.out.println("\u6D88\u8D39\u8005\u7EC4 " + groupId + " \u5220\u9664\u6210\u529F");\n            \n        } catch (InterruptedException | ExecutionException e) {\n            throw new RuntimeException("\u5220\u9664\u6D88\u8D39\u8005\u7EC4\u5931\u8D25: " + groupId, e);\n        }\n    }\n    \n    /**\n     * \u76D1\u63A7\u6D88\u8D39\u8005\u7EC4\u5EF6\u8FDF\n     */\n    public ConsumerGroupLag getConsumerGroupLag(String groupId) {\n        try {\n            ConsumerGroupInfo groupInfo = getConsumerGroupInfo(groupId);\n            Map<TopicPartition, OffsetAndMetadata> currentOffsets = groupInfo.getOffsets();\n            \n            // \u83B7\u53D6\u6BCF\u4E2A\u5206\u533A\u7684\u6700\u65B0\u4F4D\u79FB\n            Map<TopicPartition, Long> endOffsets = getEndOffsets(currentOffsets.keySet());\n            \n            Map<TopicPartition, Long> lagMap = new HashMap<>();\n            long totalLag = 0;\n            \n            for (Map.Entry<TopicPartition, OffsetAndMetadata> entry : currentOffsets.entrySet()) {\n                TopicPartition tp = entry.getKey();\n                long currentOffset = entry.getValue().offset();\n                long endOffset = endOffsets.getOrDefault(tp, currentOffset);\n                \n                long lag = Math.max(0, endOffset - currentOffset);\n                lagMap.put(tp, lag);\n                totalLag += lag;\n            }\n            \n            return new ConsumerGroupLag(groupId, lagMap, totalLag);\n            \n        } catch (Exception e) {\n            throw new RuntimeException("\u83B7\u53D6\u6D88\u8D39\u8005\u7EC4\u5EF6\u8FDF\u5931\u8D25: " + groupId, e);\n        }\n    }\n    \n    /**\n     * \u6253\u5370\u6D88\u8D39\u8005\u7EC4\u8BE6\u7EC6\u62A5\u544A\n     */\n    public void printConsumerGroupReport(String groupId) {\n        ConsumerGroupInfo info = getConsumerGroupInfo(groupId);\n        ConsumerGroupLag lag = getConsumerGroupLag(groupId);\n        \n        System.out.println("=== \u6D88\u8D39\u8005\u7EC4\u8BE6\u7EC6\u62A5\u544A: " + groupId + " ===");\n        System.out.println("\u72B6\u6001: " + info.getState());\n        System.out.println("\u534F\u8C03\u5668: " + info.getCoordinator().host() + ":" + info.getCoordinator().port());\n        System.out.println("\u5206\u533A\u5206\u914D\u7B56\u7565: " + info.getPartitionAssignor());\n        System.out.println("\u6210\u5458\u6570\u91CF: " + info.getMembers().size());\n        System.out.println("\u603B\u5EF6\u8FDF: " + lag.getTotalLag() + " \u6761\u6D88\u606F");\n        \n        System.out.println("\\n--- \u6210\u5458\u4FE1\u606F ---");\n        for (MemberDescription member : info.getMembers()) {\n            System.out.printf("\u6210\u5458ID: %s, \u5BA2\u6237\u7AEFID: %s, \u4E3B\u673A: %s%n",\n                member.consumerId(), member.clientId(), member.host());\n            System.out.println("  \u5206\u914D\u7684\u5206\u533A: " + member.assignment().topicPartitions());\n        }\n        \n        System.out.println("\\n--- \u5206\u533A\u4F4D\u79FB\u548C\u5EF6\u8FDF ---");\n        for (Map.Entry<TopicPartition, Long> entry : lag.getPartitionLags().entrySet()) {\n            TopicPartition tp = entry.getKey();\n            long partitionLag = entry.getValue();\n            long currentOffset = info.getOffsets().get(tp).offset();\n            \n            System.out.printf("%s-%d: \u5F53\u524D\u4F4D\u79FB=%d, \u5EF6\u8FDF=%d%n",\n                tp.topic(), tp.partition(), currentOffset, partitionLag);\n        }\n    }\n    \n    private long getEarliestOffset(TopicPartition tp) {\n        // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u8BE5\u4F7F\u7528Consumer.beginningOffsets()\n        return 0L;\n    }\n    \n    private long getLatestOffset(TopicPartition tp) {\n        // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u8BE5\u4F7F\u7528Consumer.endOffsets()\n        return Long.MAX_VALUE;\n    }\n    \n    private Map<TopicPartition, Long> getEndOffsets(Set<TopicPartition> partitions) {\n        // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u8BE5\u4F7F\u7528Consumer.endOffsets()\n        Map<TopicPartition, Long> endOffsets = new HashMap<>();\n        for (TopicPartition tp : partitions) {\n            endOffsets.put(tp, 1000L); // \u6A21\u62DF\u503C\n        }\n        return endOffsets;\n    }\n    \n    public void close() {\n        adminClient.close();\n    }\n    \n    // \u4F4D\u79FB\u91CD\u7F6E\u7B56\u7565\u679A\u4E3E\n    public enum OffsetResetStrategy {\n        EARLIEST,   // \u91CD\u7F6E\u5230\u6700\u65E9\n        LATEST      // \u91CD\u7F6E\u5230\u6700\u65B0\n    }\n    \n    // \u6D88\u8D39\u8005\u7EC4\u4FE1\u606F\u5C01\u88C5\u7C7B\n    public static class ConsumerGroupInfo {\n        private final ConsumerGroupDescription description;\n        private final Map<TopicPartition, OffsetAndMetadata> offsets;\n        \n        public ConsumerGroupInfo(ConsumerGroupDescription description, \n                               Map<TopicPartition, OffsetAndMetadata> offsets) {\n            this.description = description;\n            this.offsets = offsets;\n        }\n        \n        public String getGroupId() { return description.groupId(); }\n        public ConsumerGroupState getState() { return description.state(); }\n        public Node getCoordinator() { return description.coordinator(); }\n        public String getPartitionAssignor() { return description.partitionAssignor(); }\n        public Collection<MemberDescription> getMembers() { return description.members(); }\n        public Map<TopicPartition, OffsetAndMetadata> getOffsets() { return offsets; }\n    }\n    \n    // \u6D88\u8D39\u8005\u7EC4\u5EF6\u8FDF\u4FE1\u606F\n    public static class ConsumerGroupLag {\n        private final String groupId;\n        private final Map<TopicPartition, Long> partitionLags;\n        private final long totalLag;\n        \n        public ConsumerGroupLag(String groupId, Map<TopicPartition, Long> partitionLags, long totalLag) {\n            this.groupId = groupId;\n            this.partitionLags = partitionLags;\n            this.totalLag = totalLag;\n        }\n        \n        public String getGroupId() { return groupId; }\n        public Map<TopicPartition, Long> getPartitionLags() { return partitionLags; }\n        public long getTotalLag() { return totalLag; }\n    }\n}\n\n/**\n * \u591A\u7EBF\u7A0B\u6D88\u8D39\u8005\u7EC4\u5B9E\u73B0\n * \u6F14\u793A\u5982\u4F55\u5728\u4E00\u4E2A\u5E94\u7528\u4E2D\u542F\u52A8\u591A\u4E2A\u6D88\u8D39\u8005\u5B9E\u4F8B\n */\npublic class MultiThreadConsumerGroup {\n    \n    private final String bootstrapServers;\n    private final String groupId;\n    private final List<String> topics;\n    private final int consumerCount;\n    private final List<Thread> consumerThreads;\n    private volatile boolean running = false;\n    \n    public MultiThreadConsumerGroup(String bootstrapServers, String groupId, \n                                  List<String> topics, int consumerCount) {\n        this.bootstrapServers = bootstrapServers;\n        this.groupId = groupId;\n        this.topics = topics;\n        this.consumerCount = consumerCount;\n        this.consumerThreads = new ArrayList<>();\n    }\n    \n    /**\n     * \u542F\u52A8\u591A\u4E2A\u6D88\u8D39\u8005\u7EBF\u7A0B\n     */\n    public void start() {\n        running = true;\n        \n        for (int i = 0; i < consumerCount; i++) {\n            final int consumerId = i;\n            Thread consumerThread = new Thread(() -> {\n                runConsumer(consumerId);\n            }, "Consumer-" + i);\n            \n            consumerThreads.add(consumerThread);\n            consumerThread.start();\n        }\n        \n        System.out.println("\u542F\u52A8\u4E86 " + consumerCount + " \u4E2A\u6D88\u8D39\u8005\u7EBF\u7A0B");\n    }\n    \n    /**\n     * \u8FD0\u884C\u5355\u4E2A\u6D88\u8D39\u8005\n     */\n    private void runConsumer(int consumerId) {\n        Properties props = new Properties();\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);\n        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest");\n        \n        // \u4E3A\u6BCF\u4E2A\u6D88\u8D39\u8005\u8BBE\u7F6E\u552F\u4E00\u7684\u5BA2\u6237\u7AEFID\n        props.put(ConsumerConfig.CLIENT_ID_CONFIG, "consumer-" + consumerId);\n        \n        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);\n        \n        try {\n            consumer.subscribe(topics, new ConsumerRebalanceListener() {\n                @Override\n                public void onPartitionsRevoked(Collection<TopicPartition> partitions) {\n                    System.out.println("Consumer-" + consumerId + " \u5206\u533A\u88AB\u64A4\u9500: " + partitions);\n                    // \u5728\u5206\u533A\u88AB\u64A4\u9500\u524D\u63D0\u4EA4\u4F4D\u79FB\n                    consumer.commitSync();\n                }\n                \n                @Override\n                public void onPartitionsAssigned(Collection<TopicPartition> partitions) {\n                    System.out.println("Consumer-" + consumerId + " \u5206\u533A\u88AB\u5206\u914D: " + partitions);\n                }\n            });\n            \n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    System.out.printf("Consumer-%d \u5904\u7406\u6D88\u606F: topic=%s, partition=%d, offset=%d, key=%s%n",\n                        consumerId, record.topic(), record.partition(), record.offset(), record.key());\n                    \n                    // \u6A21\u62DF\u6D88\u606F\u5904\u7406\n                    try {\n                        Thread.sleep(100);\n                    } catch (InterruptedException e) {\n                        Thread.currentThread().interrupt();\n                        break;\n                    }\n                }\n                \n                if (!records.isEmpty()) {\n                    consumer.commitSync();\n                }\n            }\n            \n        } catch (Exception e) {\n            System.err.println("Consumer-" + consumerId + " \u53D1\u751F\u5F02\u5E38: " + e.getMessage());\n        } finally {\n            consumer.close();\n            System.out.println("Consumer-" + consumerId + " \u5DF2\u5173\u95ED");\n        }\n    }\n    \n    /**\n     * \u505C\u6B62\u6240\u6709\u6D88\u8D39\u8005\n     */\n    public void stop() {\n        running = false;\n        \n        // \u7B49\u5F85\u6240\u6709\u6D88\u8D39\u8005\u7EBF\u7A0B\u7ED3\u675F\n        for (Thread thread : consumerThreads) {\n            try {\n                thread.join(5000); // \u6700\u591A\u7B49\u5F855\u79D2\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n        }\n        \n        System.out.println("\u6240\u6709\u6D88\u8D39\u8005\u5DF2\u505C\u6B62");\n    }\n    \n    public static void main(String[] args) {\n        MultiThreadConsumerGroup consumerGroup = new MultiThreadConsumerGroup(\n            "localhost:9092",\n            "multi-thread-group",\n            Arrays.asList("user-events"),\n            3 // \u542F\u52A83\u4E2A\u6D88\u8D39\u8005\n        );\n        \n        // \u542F\u52A8\u6D88\u8D39\u8005\u7EC4\n        consumerGroup.start();\n        \n        // \u8FD0\u884C\u4E00\u6BB5\u65F6\u95F4\n        try {\n            Thread.sleep(60000); // \u8FD0\u884C1\u5206\u949F\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        // \u505C\u6B62\u6D88\u8D39\u8005\u7EC4\n        consumerGroup.stop();\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"rebalance",label:"\u91CD\u5E73\u8861\u673A\u5236",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u6D88\u8D39\u8005\u91CD\u5E73\u8861\u76D1\u542C\u548C\u5904\u7406"',children:'import org.apache.kafka.clients.consumer.*;\nimport org.apache.kafka.common.TopicPartition;\nimport java.util.*;\nimport java.util.concurrent.ConcurrentHashMap;\n\n/**\n * \u6D88\u8D39\u8005\u91CD\u5E73\u8861\u76D1\u542C\u5668\u5B9E\u73B0\n * \u5904\u7406\u5206\u533A\u5206\u914D\u53D8\u5316\uFF0C\u5B9E\u73B0\u4F18\u96C5\u7684\u91CD\u5E73\u8861\n */\npublic class RebalanceAwareConsumer {\n    \n    private final KafkaConsumer<String, String> consumer;\n    private final Map<TopicPartition, OffsetAndMetadata> currentOffsets = new ConcurrentHashMap<>();\n    private volatile boolean running = false;\n    \n    public RebalanceAwareConsumer(String bootstrapServers, String groupId, List<String> topics) {\n        Properties props = new Properties();\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        \n        // \u91CD\u5E73\u8861\u76F8\u5173\u914D\u7F6E\n        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);          // \u7981\u7528\u81EA\u52A8\u63D0\u4EA4\n        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, 30000);          // \u4F1A\u8BDD\u8D85\u65F630\u79D2\n        props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 10000);       // \u5FC3\u8DF3\u95F4\u969410\u79D2\n        props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, 300000);       // \u6700\u5927poll\u95F4\u96945\u5206\u949F\n        \n        // \u4F7F\u7528\u534F\u4F5C\u5F0F\u91CD\u5E73\u8861\u7B56\u7565\uFF08Kafka 2.4+\uFF09\n        props.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, \n                 "org.apache.kafka.clients.consumer.CooperativeStickyAssignor");\n        \n        this.consumer = new KafkaConsumer<>(props);\n        \n        // \u8BA2\u9605Topic\u5E76\u8BBE\u7F6E\u91CD\u5E73\u8861\u76D1\u542C\u5668\n        consumer.subscribe(topics, new RebalanceListener());\n    }\n    \n    /**\n     * \u5F00\u59CB\u6D88\u8D39\n     */\n    public void startConsuming() {\n        running = true;\n        \n        try {\n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                for (ConsumerRecord<String, String> record : records) {\n                    // \u5904\u7406\u6D88\u606F\n                    processRecord(record);\n                    \n                    // \u8DDF\u8E2A\u5F53\u524D\u4F4D\u79FB\n                    currentOffsets.put(\n                        new TopicPartition(record.topic(), record.partition()),\n                        new OffsetAndMetadata(record.offset() + 1)\n                    );\n                }\n                \n                // \u5B9A\u671F\u63D0\u4EA4\u4F4D\u79FB\n                if (!records.isEmpty()) {\n                    commitOffsets();\n                }\n            }\n        } catch (Exception e) {\n            System.err.println("\u6D88\u8D39\u8FC7\u7A0B\u4E2D\u53D1\u751F\u5F02\u5E38: " + e.getMessage());\n        } finally {\n            try {\n                consumer.commitSync(currentOffsets);\n            } catch (Exception e) {\n                System.err.println("\u6700\u7EC8\u63D0\u4EA4\u4F4D\u79FB\u5931\u8D25: " + e.getMessage());\n            }\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u5904\u7406\u5355\u6761\u6D88\u606F\n     */\n    private void processRecord(ConsumerRecord<String, String> record) {\n        try {\n            System.out.printf("\u5904\u7406\u6D88\u606F: topic=%s, partition=%d, offset=%d, key=%s, value=%s%n",\n                record.topic(), record.partition(), record.offset(), record.key(), record.value());\n            \n            // \u6A21\u62DF\u6D88\u606F\u5904\u7406\u65F6\u95F4\n            Thread.sleep(50);\n            \n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } catch (Exception e) {\n            System.err.println("\u5904\u7406\u6D88\u606F\u5931\u8D25: " + e.getMessage());\n        }\n    }\n    \n    /**\n     * \u63D0\u4EA4\u4F4D\u79FB\n     */\n    private void commitOffsets() {\n        try {\n            consumer.commitAsync(currentOffsets, (offsets, exception) -> {\n                if (exception != null) {\n                    System.err.println("\u5F02\u6B65\u63D0\u4EA4\u4F4D\u79FB\u5931\u8D25: " + exception.getMessage());\n                }\n            });\n        } catch (Exception e) {\n            System.err.println("\u63D0\u4EA4\u4F4D\u79FB\u5F02\u5E38: " + e.getMessage());\n        }\n    }\n    \n    /**\n     * \u505C\u6B62\u6D88\u8D39\n     */\n    public void stop() {\n        running = false;\n    }\n    \n    /**\n     * \u91CD\u5E73\u8861\u76D1\u542C\u5668\u5B9E\u73B0\n     */\n    private class RebalanceListener implements ConsumerRebalanceListener {\n        \n        @Override\n        public void onPartitionsRevoked(Collection<TopicPartition> partitions) {\n            System.out.println("=== \u5206\u533A\u64A4\u9500\u5F00\u59CB ===");\n            System.out.println("\u88AB\u64A4\u9500\u7684\u5206\u533A: " + partitions);\n            \n            // \u5728\u5206\u533A\u88AB\u64A4\u9500\u524D\uFF0C\u540C\u6B65\u63D0\u4EA4\u5F53\u524D\u4F4D\u79FB\n            try {\n                Map<TopicPartition, OffsetAndMetadata> offsetsToCommit = new HashMap<>();\n                for (TopicPartition partition : partitions) {\n                    OffsetAndMetadata offset = currentOffsets.get(partition);\n                    if (offset != null) {\n                        offsetsToCommit.put(partition, offset);\n                    }\n                }\n                \n                if (!offsetsToCommit.isEmpty()) {\n                    consumer.commitSync(offsetsToCommit);\n                    System.out.println("\u64A4\u9500\u524D\u4F4D\u79FB\u63D0\u4EA4\u6210\u529F: " + offsetsToCommit);\n                }\n                \n                // \u6E05\u7406\u88AB\u64A4\u9500\u5206\u533A\u7684\u4F4D\u79FB\u8BB0\u5F55\n                for (TopicPartition partition : partitions) {\n                    currentOffsets.remove(partition);\n                }\n                \n            } catch (Exception e) {\n                System.err.println("\u64A4\u9500\u524D\u63D0\u4EA4\u4F4D\u79FB\u5931\u8D25: " + e.getMessage());\n            }\n            \n            System.out.println("=== \u5206\u533A\u64A4\u9500\u5B8C\u6210 ===");\n        }\n        \n        @Override\n        public void onPartitionsAssigned(Collection<TopicPartition> partitions) {\n            System.out.println("=== \u5206\u533A\u5206\u914D\u5F00\u59CB ===");\n            System.out.println("\u65B0\u5206\u914D\u7684\u5206\u533A: " + partitions);\n            \n            // \u53EF\u4EE5\u5728\u8FD9\u91CC\u8FDB\u884C\u4E00\u4E9B\u521D\u59CB\u5316\u5DE5\u4F5C\n            for (TopicPartition partition : partitions) {\n                // \u83B7\u53D6\u5F53\u524D\u5206\u533A\u7684\u4F4D\u79FB\n                OffsetAndMetadata committed = consumer.committed(partition);\n                if (committed != null) {\n                    System.out.println("\u5206\u533A " + partition + " \u7684\u5DF2\u63D0\u4EA4\u4F4D\u79FB: " + committed.offset());\n                } else {\n                    System.out.println("\u5206\u533A " + partition + " \u6CA1\u6709\u5DF2\u63D0\u4EA4\u7684\u4F4D\u79FB");\n                }\n            }\n            \n            System.out.println("=== \u5206\u533A\u5206\u914D\u5B8C\u6210 ===");\n        }\n        \n        @Override\n        public void onPartitionsLost(Collection<TopicPartition> partitions) {\n            System.out.println("=== \u5206\u533A\u4E22\u5931 ===");\n            System.out.println("\u4E22\u5931\u7684\u5206\u533A: " + partitions);\n            \n            // \u6E05\u7406\u4E22\u5931\u5206\u533A\u7684\u4F4D\u79FB\u8BB0\u5F55\n            for (TopicPartition partition : partitions) {\n                currentOffsets.remove(partition);\n            }\n            \n            // \u6CE8\u610F\uFF1A\u5206\u533A\u4E22\u5931\u65F6\u4E0D\u5E94\u8BE5\u63D0\u4EA4\u4F4D\u79FB\uFF0C\u56E0\u4E3A\u53EF\u80FD\u5DF2\u7ECF\u88AB\u5176\u4ED6\u6D88\u8D39\u8005\u63A5\u7BA1\n            System.out.println("=== \u5206\u533A\u4E22\u5931\u5904\u7406\u5B8C\u6210 ===");\n        }\n    }\n    \n    public static void main(String[] args) {\n        // \u521B\u5EFA\u591A\u4E2A\u6D88\u8D39\u8005\u5B9E\u4F8B\u6765\u6F14\u793A\u91CD\u5E73\u8861\n        List<RebalanceAwareConsumer> consumers = new ArrayList<>();\n        List<Thread> threads = new ArrayList<>();\n        \n        // \u542F\u52A8\u7B2C\u4E00\u4E2A\u6D88\u8D39\u8005\n        RebalanceAwareConsumer consumer1 = new RebalanceAwareConsumer(\n            "localhost:9092", "rebalance-demo-group", Arrays.asList("user-events"));\n        Thread thread1 = new Thread(consumer1::startConsuming, "Consumer-1");\n        consumers.add(consumer1);\n        threads.add(thread1);\n        thread1.start();\n        \n        try {\n            // \u7B49\u5F855\u79D2\u540E\u542F\u52A8\u7B2C\u4E8C\u4E2A\u6D88\u8D39\u8005\uFF08\u89E6\u53D1\u91CD\u5E73\u8861\uFF09\n            Thread.sleep(5000);\n            System.out.println("\\n\u542F\u52A8\u7B2C\u4E8C\u4E2A\u6D88\u8D39\u8005...\\n");\n            \n            RebalanceAwareConsumer consumer2 = new RebalanceAwareConsumer(\n                "localhost:9092", "rebalance-demo-group", Arrays.asList("user-events"));\n            Thread thread2 = new Thread(consumer2::startConsuming, "Consumer-2");\n            consumers.add(consumer2);\n            threads.add(thread2);\n            thread2.start();\n            \n            // \u518D\u7B49\u5F855\u79D2\u540E\u542F\u52A8\u7B2C\u4E09\u4E2A\u6D88\u8D39\u8005\uFF08\u518D\u6B21\u89E6\u53D1\u91CD\u5E73\u8861\uFF09\n            Thread.sleep(5000);\n            System.out.println("\\n\u542F\u52A8\u7B2C\u4E09\u4E2A\u6D88\u8D39\u8005...\\n");\n            \n            RebalanceAwareConsumer consumer3 = new RebalanceAwareConsumer(\n                "localhost:9092", "rebalance-demo-group", Arrays.asList("user-events"));\n            Thread thread3 = new Thread(consumer3::startConsuming, "Consumer-3");\n            consumers.add(consumer3);\n            threads.add(thread3);\n            thread3.start();\n            \n            // \u8FD0\u884C\u4E00\u6BB5\u65F6\u95F4\n            Thread.sleep(10000);\n            \n            // \u505C\u6B62\u7B2C\u4E8C\u4E2A\u6D88\u8D39\u8005\uFF08\u89E6\u53D1\u91CD\u5E73\u8861\uFF09\n            System.out.println("\\n\u505C\u6B62\u7B2C\u4E8C\u4E2A\u6D88\u8D39\u8005...\\n");\n            consumer2.stop();\n            thread2.join();\n            \n            // \u518D\u8FD0\u884C\u4E00\u6BB5\u65F6\u95F4\n            Thread.sleep(10000);\n            \n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        } finally {\n            // \u505C\u6B62\u6240\u6709\u6D88\u8D39\u8005\n            for (RebalanceAwareConsumer consumer : consumers) {\n                consumer.stop();\n            }\n            \n            for (Thread thread : threads) {\n                try {\n                    thread.join();\n                } catch (InterruptedException e) {\n                    Thread.currentThread().interrupt();\n                }\n            }\n        }\n    }\n}\n\n/**\n * \u91CD\u5E73\u8861\u7B56\u7565\u5BF9\u6BD4\u6F14\u793A\n */\npublic class PartitionAssignmentStrategyDemo {\n    \n    /**\n     * \u6F14\u793A\u4E0D\u540C\u5206\u533A\u5206\u914D\u7B56\u7565\u7684\u6548\u679C\n     */\n    public static void demonstrateAssignmentStrategies() {\n        System.out.println("=== \u5206\u533A\u5206\u914D\u7B56\u7565\u5BF9\u6BD4 ===");\n        \n        // \u6A21\u62DF\u573A\u666F\uFF1A3\u4E2A\u6D88\u8D39\u8005\uFF0C6\u4E2A\u5206\u533A\n        int consumerCount = 3;\n        int partitionCount = 6;\n        \n        System.out.println("\u573A\u666F: " + consumerCount + " \u4E2A\u6D88\u8D39\u8005, " + partitionCount + " \u4E2A\u5206\u533A");\n        \n        // Range\u7B56\u7565\n        System.out.println("\\n1. Range\u7B56\u7565 (\u9ED8\u8BA4):");\n        demonstrateRangeAssignment(consumerCount, partitionCount);\n        \n        // RoundRobin\u7B56\u7565\n        System.out.println("\\n2. RoundRobin\u7B56\u7565:");\n        demonstrateRoundRobinAssignment(consumerCount, partitionCount);\n        \n        // Sticky\u7B56\u7565\n        System.out.println("\\n3. Sticky\u7B56\u7565:");\n        demonstrateStickyAssignment(consumerCount, partitionCount);\n        \n        // CooperativeSticky\u7B56\u7565\n        System.out.println("\\n4. CooperativeSticky\u7B56\u7565:");\n        demonstrateCooperativeStickyAssignment(consumerCount, partitionCount);\n    }\n    \n    private static void demonstrateRangeAssignment(int consumers, int partitions) {\n        // Range\u7B56\u7565\uFF1A\u6309\u5206\u533A\u8303\u56F4\u5206\u914D\n        int partitionsPerConsumer = partitions / consumers;\n        int remainder = partitions % consumers;\n        \n        for (int i = 0; i < consumers; i++) {\n            int start = i * partitionsPerConsumer + Math.min(i, remainder);\n            int count = partitionsPerConsumer + (i < remainder ? 1 : 0);\n            int end = start + count - 1;\n            \n            System.out.printf("Consumer-%d: \u5206\u533A %d-%d (%d\u4E2A\u5206\u533A)%n", i, start, end, count);\n        }\n    }\n    \n    private static void demonstrateRoundRobinAssignment(int consumers, int partitions) {\n        // RoundRobin\u7B56\u7565\uFF1A\u8F6E\u8BE2\u5206\u914D\n        Map<Integer, List<Integer>> assignment = new HashMap<>();\n        for (int i = 0; i < consumers; i++) {\n            assignment.put(i, new ArrayList<>());\n        }\n        \n        for (int partition = 0; partition < partitions; partition++) {\n            int consumer = partition % consumers;\n            assignment.get(consumer).add(partition);\n        }\n        \n        for (int i = 0; i < consumers; i++) {\n            System.out.printf("Consumer-%d: \u5206\u533A %s (%d\u4E2A\u5206\u533A)%n", \n                i, assignment.get(i), assignment.get(i).size());\n        }\n    }\n    \n    private static void demonstrateStickyAssignment(int consumers, int partitions) {\n        // Sticky\u7B56\u7565\uFF1A\u5C3D\u53EF\u80FD\u4FDD\u6301\u539F\u6709\u5206\u914D\n        System.out.println("\u521D\u59CB\u5206\u914D\uFF08\u7C7B\u4F3CRoundRobin\uFF09:");\n        demonstrateRoundRobinAssignment(consumers, partitions);\n        \n        System.out.println("Consumer-1 \u79BB\u5F00\u540E\u7684\u91CD\u65B0\u5206\u914D:");\n        // \u6A21\u62DFConsumer-1\u79BB\u5F00\uFF0C\u5176\u5206\u533A\u88AB\u5176\u4ED6\u6D88\u8D39\u8005\u63A5\u7BA1\n        System.out.println("Consumer-0: \u5206\u533A [0, 3, 1] (3\u4E2A\u5206\u533A) - \u63A5\u7BA1\u4E86\u5206\u533A1");\n        System.out.println("Consumer-2: \u5206\u533A [2, 5, 4] (3\u4E2A\u5206\u533A) - \u63A5\u7BA1\u4E86\u5206\u533A4");\n    }\n    \n    private static void demonstrateCooperativeStickyAssignment(int consumers, int partitions) {\n        // CooperativeSticky\u7B56\u7565\uFF1A\u589E\u91CF\u91CD\u5E73\u8861\n        System.out.println("\u652F\u6301\u589E\u91CF\u91CD\u5E73\u8861\uFF0C\u51CF\u5C11\u505C\u987F\u65F6\u95F4");\n        System.out.println("\u53EA\u79FB\u52A8\u5FC5\u8981\u7684\u5206\u533A\uFF0C\u5176\u4ED6\u5206\u533A\u7EE7\u7EED\u5904\u7406\u6D88\u606F");\n        demonstrateStickyAssignment(consumers, partitions);\n    }\n    \n    public static void main(String[] args) {\n        demonstrateAssignmentStrategies();\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h2,{id:"4-kafka-streams\u6D41\u5904\u7406\u6846\u67B6",children:"4. Kafka Streams\u6D41\u5904\u7406\u6846\u67B6"}),"\n",(0,i.jsx)(e.h3,{id:"41-kafka-streams\u6838\u5FC3\u6982\u5FF5",children:"4.1 Kafka Streams\u6838\u5FC3\u6982\u5FF5"}),"\n",(0,i.jsx)(e.p,{children:"Kafka Streams\u662F\u4E00\u4E2A\u7528\u4E8E\u6784\u5EFA\u5B9E\u65F6\u6D41\u5904\u7406\u5E94\u7528\u7A0B\u5E8F\u7684Java\u5E93\uFF0C\u5B83\u5C06Kafka\u4F5C\u4E3A\u6D41\u5904\u7406\u7684\u57FA\u7840\u8BBE\u65BD\uFF0C\u63D0\u4F9B\u4E86\u9AD8\u7EA7\u7684\u6D41\u5904\u7406\u62BD\u8C61\u548C\u4E30\u5BCC\u7684\u64CD\u4F5C\u7B26\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsxs)(a.A,{value:"concepts",label:"\u6838\u5FC3\u6982\u5FF5",children:[(0,i.jsx)(e.mermaid,{value:'graph TB\n    subgraph "Kafka Streams\u67B6\u6784"\n        A[Stream] --\x3e B[KStream]\n        A --\x3e C[KTable]\n        A --\x3e D[GlobalKTable]\n        \n        B --\x3e E[\u65E0\u72B6\u6001\u64CD\u4F5C]\n        B --\x3e F[\u6709\u72B6\u6001\u64CD\u4F5C]\n        \n        E --\x3e E1[map/filter]\n        E --\x3e E2[flatMap]\n        E --\x3e E3[foreach]\n        \n        F --\x3e F1[groupBy]\n        F --\x3e F2[aggregate]\n        F --\x3e F3[join]\n        F --\x3e F4[windowing]\n        \n        G[Topology] --\x3e H[Source Processor]\n        G --\x3e I[Stream Processor]\n        G --\x3e J[Sink Processor]\n        \n        K[State Store] --\x3e L[RocksDB]\n        K --\x3e M[In-Memory]\n        K --\x3e N[Custom Store]\n    end'}),(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6838\u5FC3\u62BD\u8C61"}),"\uFF1A"]}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"KStream"}),"\uFF1A\u8BB0\u5F55\u6D41\uFF0C\u6BCF\u6761\u8BB0\u5F55\u4EE3\u8868\u4E00\u4E2A\u4E8B\u4EF6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"KTable"}),"\uFF1A\u53D8\u66F4\u6D41\uFF0C\u6BCF\u6761\u8BB0\u5F55\u4EE3\u8868\u4E00\u4E2A\u72B6\u6001\u66F4\u65B0"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"GlobalKTable"}),"\uFF1A\u5168\u5C40\u8868\uFF0C\u6240\u6709\u5B9E\u4F8B\u90FD\u6709\u5B8C\u6574\u526F\u672C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Topology"}),"\uFF1A\u6D41\u5904\u7406\u62D3\u6251\uFF0C\u5B9A\u4E49\u6570\u636E\u6D41\u8F6C\u6362\u903B\u8F91"]}),"\n"]})]}),(0,i.jsx)(a.A,{value:"basic-example",label:"\u57FA\u7840\u793A\u4F8B",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Kafka Streams\u57FA\u7840\u793A\u4F8B"',children:'import org.apache.kafka.common.serialization.Serdes;\nimport org.apache.kafka.streams.*;\nimport org.apache.kafka.streams.kstream.*;\nimport java.util.Properties;\nimport java.util.concurrent.CountDownLatch;\n\n/**\n * Kafka Streams\u57FA\u7840\u793A\u4F8B\n * \u5B9E\u73B0\u8BCD\u9891\u7EDF\u8BA1\u7684\u7ECF\u5178\u6D41\u5904\u7406\u5E94\u7528\n */\npublic class WordCountExample {\n    \n    public static void main(String[] args) {\n        // \u914D\u7F6EStreams\u5E94\u7528\n        Properties props = new Properties();\n        props.put(StreamsConfig.APPLICATION_ID_CONFIG, "wordcount-application");\n        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());\n        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());\n        \n        // \u6784\u5EFA\u6D41\u5904\u7406\u62D3\u6251\n        StreamsBuilder builder = new StreamsBuilder();\n        \n        // 1. \u4ECE\u8F93\u5165Topic\u8BFB\u53D6\u6570\u636E\n        KStream<String, String> textLines = builder.stream("text-input");\n        \n        // 2. \u6D41\u5904\u7406\u903B\u8F91\n        KTable<String, Long> wordCounts = textLines\n            // \u5C06\u6BCF\u884C\u6587\u672C\u8F6C\u6362\u4E3A\u5C0F\u5199\n            .mapValues(textLine -> textLine.toLowerCase())\n            // \u6309\u7A7A\u683C\u5206\u5272\u5355\u8BCD\n            .flatMapValues(textLine -> Arrays.asList(textLine.split("\\\\W+")))\n            // \u8FC7\u6EE4\u7A7A\u5B57\u7B26\u4E32\n            .filter((key, word) -> !word.isEmpty())\n            // \u91CD\u65B0\u8BBE\u7F6Ekey\u4E3A\u5355\u8BCD\n            .selectKey((key, word) -> word)\n            // \u6309\u5355\u8BCD\u5206\u7EC4\n            .groupByKey()\n            // \u8BA1\u6570\u805A\u5408\n            .count(Materialized.as("counts-store"));\n        \n        // 3. \u8F93\u51FA\u7ED3\u679C\u5230Topic\n        wordCounts.toStream().to("wordcount-output", Produced.with(Serdes.String(), Serdes.Long()));\n        \n        // \u6784\u5EFA\u5E76\u542F\u52A8Streams\u5E94\u7528\n        Topology topology = builder.build();\n        KafkaStreams streams = new KafkaStreams(topology, props);\n        \n        // \u4F18\u96C5\u5173\u95ED\u5904\u7406\n        CountDownLatch latch = new CountDownLatch(1);\n        Runtime.getRuntime().addShutdownHook(new Thread("streams-shutdown-hook") {\n            @Override\n            public void run() {\n                streams.close();\n                latch.countDown();\n            }\n        });\n        \n        try {\n            streams.start();\n            System.out.println("WordCount\u5E94\u7528\u5DF2\u542F\u52A8");\n            System.out.println("\u62D3\u6251\u7ED3\u6784:\\n" + topology.describe());\n            latch.await();\n        } catch (Throwable e) {\n            System.err.println("\u5E94\u7528\u5F02\u5E38\u9000\u51FA: " + e.getMessage());\n            System.exit(1);\n        }\n        System.exit(0);\n    }\n}\n\n/**\n * \u66F4\u590D\u6742\u7684\u6D41\u5904\u7406\u793A\u4F8B - \u7528\u6237\u884C\u4E3A\u5206\u6790\n */\npublic class UserBehaviorAnalysis {\n    \n    public static void main(String[] args) {\n        Properties props = new Properties();\n        props.put(StreamsConfig.APPLICATION_ID_CONFIG, "user-behavior-analysis");\n        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());\n        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());\n        \n        StreamsBuilder builder = new StreamsBuilder();\n        \n        // \u7528\u6237\u4E8B\u4EF6\u6D41\n        KStream<String, String> userEvents = builder.stream("user-events");\n        \n        // \u89E3\u6790JSON\u5E76\u8F6C\u6362\u4E3AUserEvent\u5BF9\u8C61\n        KStream<String, UserEvent> parsedEvents = userEvents\n            .mapValues(json -> parseUserEvent(json))\n            .filter((key, event) -> event != null);\n        \n        // 1. \u5B9E\u65F6\u7528\u6237\u6D3B\u8DC3\u5EA6\u7EDF\u8BA1\n        KTable<String, Long> userActivityCount = parsedEvents\n            .selectKey((key, event) -> event.getUserId())\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5)))\n            .count(Materialized.as("user-activity-store"))\n            .suppress(Suppressed.untilWindowCloses(Suppressed.BufferConfig.unbounded()))\n            .toStream()\n            .map((windowedKey, count) -> KeyValue.pair(windowedKey.key(), count))\n            .groupByKey()\n            .reduce((oldValue, newValue) -> newValue);\n        \n        // 2. \u9875\u9762\u8BBF\u95EE\u70ED\u5EA6\u7EDF\u8BA1\n        KTable<String, Long> pageViewCount = parsedEvents\n            .filter((key, event) -> "page_view".equals(event.getEventType()))\n            .selectKey((key, event) -> event.getPageId())\n            .groupByKey()\n            .count(Materialized.as("page-view-store"));\n        \n        // 3. \u7528\u6237\u8F6C\u5316\u6F0F\u6597\u5206\u6790\n        KStream<String, String> conversionFunnel = parsedEvents\n            .selectKey((key, event) -> event.getUserId())\n            .groupByKey()\n            .aggregate(\n                () -> new ConversionState(),\n                (key, event, state) -> updateConversionState(state, event),\n                Materialized.<String, ConversionState, KeyValueStore<Bytes, byte[]>>as("conversion-store")\n                    .withValueSerde(new ConversionStateSerde())\n            )\n            .toStream()\n            .filter((userId, state) -> state.isConverted())\n            .mapValues(state -> "\u7528\u6237 " + state.getUserId() + " \u5B8C\u6210\u8F6C\u5316");\n        \n        // \u8F93\u51FA\u7ED3\u679C\n        userActivityCount.toStream().to("user-activity-output", \n            Produced.with(Serdes.String(), Serdes.Long()));\n        pageViewCount.toStream().to("page-view-output", \n            Produced.with(Serdes.String(), Serdes.Long()));\n        conversionFunnel.to("conversion-output");\n        \n        // \u542F\u52A8\u5E94\u7528\n        Topology topology = builder.build();\n        KafkaStreams streams = new KafkaStreams(topology, props);\n        \n        streams.setStateListener((newState, oldState) -> {\n            System.out.println("\u72B6\u6001\u53D8\u66F4: " + oldState + " -> " + newState);\n        });\n        \n        streams.setUncaughtExceptionHandler((thread, exception) -> {\n            System.err.println("\u672A\u6355\u83B7\u5F02\u5E38: " + exception.getMessage());\n            return StreamsUncaughtExceptionHandler.StreamThreadExceptionResponse.SHUTDOWN_CLIENT;\n        });\n        \n        streams.start();\n        \n        // \u6DFB\u52A0\u5173\u95ED\u94A9\u5B50\n        Runtime.getRuntime().addShutdownHook(new Thread(streams::close));\n    }\n    \n    private static UserEvent parseUserEvent(String json) {\n        try {\n            // \u7B80\u5316\u7684JSON\u89E3\u6790\uFF0C\u5B9E\u9645\u5E94\u4F7F\u7528Jackson\u7B49\u5E93\n            // \u5047\u8BBEJSON\u683C\u5F0F: {"userId":"user1","eventType":"page_view","pageId":"home","timestamp":1640995200000}\n            return new UserEvent("user1", "page_view", "home", System.currentTimeMillis());\n        } catch (Exception e) {\n            System.err.println("\u89E3\u6790\u7528\u6237\u4E8B\u4EF6\u5931\u8D25: " + e.getMessage());\n            return null;\n        }\n    }\n    \n    private static ConversionState updateConversionState(ConversionState state, UserEvent event) {\n        // \u7B80\u5316\u7684\u8F6C\u5316\u72B6\u6001\u66F4\u65B0\u903B\u8F91\n        switch (event.getEventType()) {\n            case "page_view":\n                state.setViewedPage(true);\n                break;\n            case "add_to_cart":\n                state.setAddedToCart(true);\n                break;\n            case "purchase":\n                state.setPurchased(true);\n                break;\n        }\n        state.setLastEventTime(event.getTimestamp());\n        return state;\n    }\n    \n    // \u7528\u6237\u4E8B\u4EF6\u6570\u636E\u7C7B\n    public static class UserEvent {\n        private String userId;\n        private String eventType;\n        private String pageId;\n        private long timestamp;\n        \n        public UserEvent(String userId, String eventType, String pageId, long timestamp) {\n            this.userId = userId;\n            this.eventType = eventType;\n            this.pageId = pageId;\n            this.timestamp = timestamp;\n        }\n        \n        // Getters\n        public String getUserId() { return userId; }\n        public String getEventType() { return eventType; }\n        public String getPageId() { return pageId; }\n        public long getTimestamp() { return timestamp; }\n    }\n    \n    // \u8F6C\u5316\u72B6\u6001\u7C7B\n    public static class ConversionState {\n        private String userId;\n        private boolean viewedPage = false;\n        private boolean addedToCart = false;\n        private boolean purchased = false;\n        private long lastEventTime;\n        \n        public boolean isConverted() {\n            return viewedPage && addedToCart && purchased;\n        }\n        \n        // Getters and Setters\n        public String getUserId() { return userId; }\n        public void setUserId(String userId) { this.userId = userId; }\n        public boolean isViewedPage() { return viewedPage; }\n        public void setViewedPage(boolean viewedPage) { this.viewedPage = viewedPage; }\n        public boolean isAddedToCart() { return addedToCart; }\n        public void setAddedToCart(boolean addedToCart) { this.addedToCart = addedToCart; }\n        public boolean isPurchased() { return purchased; }\n        public void setPurchased(boolean purchased) { this.purchased = purchased; }\n        public long getLastEventTime() { return lastEventTime; }\n        public void setLastEventTime(long lastEventTime) { this.lastEventTime = lastEventTime; }\n    }\n    \n    // \u81EA\u5B9A\u4E49Serde\n    public static class ConversionStateSerde implements Serde<ConversionState> {\n        @Override\n        public Serializer<ConversionState> serializer() {\n            return new ConversionStateSerializer();\n        }\n        \n        @Override\n        public Deserializer<ConversionState> deserializer() {\n            return new ConversionStateDeserializer();\n        }\n    }\n    \n    public static class ConversionStateSerializer implements Serializer<ConversionState> {\n        @Override\n        public byte[] serialize(String topic, ConversionState data) {\n            // \u7B80\u5316\u7684\u5E8F\u5217\u5316\u5B9E\u73B0\n            return data.toString().getBytes();\n        }\n    }\n    \n    public static class ConversionStateDeserializer implements Deserializer<ConversionState> {\n        @Override\n        public ConversionState deserialize(String topic, byte[] data) {\n            // \u7B80\u5316\u7684\u53CD\u5E8F\u5217\u5316\u5B9E\u73B0\n            return new ConversionState();\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"windowing",label:"\u7A97\u53E3\u64CD\u4F5C",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Kafka Streams\u7A97\u53E3\u64CD\u4F5C\u8BE6\u89E3"',children:'import org.apache.kafka.streams.kstream.*;\nimport java.time.Duration;\n\n/**\n * Kafka Streams\u7A97\u53E3\u64CD\u4F5C\u793A\u4F8B\n * \u5C55\u793A\u4E0D\u540C\u7C7B\u578B\u7684\u65F6\u95F4\u7A97\u53E3\u548C\u7A97\u53E3\u64CD\u4F5C\n */\npublic class WindowingExample {\n    \n    /**\n     * \u65F6\u95F4\u7A97\u53E3\u7C7B\u578B\u6F14\u793A\n     */\n    public static void demonstrateWindowTypes(StreamsBuilder builder) {\n        KStream<String, String> events = builder.stream("events");\n        \n        // 1. \u6EDA\u52A8\u7A97\u53E3 (Tumbling Window)\n        // \u56FA\u5B9A\u5927\u5C0F\uFF0C\u4E0D\u91CD\u53E0\u7684\u65F6\u95F4\u7A97\u53E3\n        KTable<Windowed<String>, Long> tumblingWindowCount = events\n            .selectKey((key, value) -> extractUserId(value))\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5))) // 5\u5206\u949F\u6EDA\u52A8\u7A97\u53E3\n            .count(Materialized.as("tumbling-window-store"));\n        \n        // 2. \u8DF3\u8DC3\u7A97\u53E3 (Hopping Window)\n        // \u56FA\u5B9A\u5927\u5C0F\uFF0C\u6709\u91CD\u53E0\u7684\u65F6\u95F4\u7A97\u53E3\n        KTable<Windowed<String>, Long> hoppingWindowCount = events\n            .selectKey((key, value) -> extractUserId(value))\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5))\n                       .advanceBy(Duration.ofMinutes(1))) // 5\u5206\u949F\u7A97\u53E3\uFF0C\u6BCF1\u5206\u949F\u6ED1\u52A8\n            .count(Materialized.as("hopping-window-store"));\n        \n        // 3. \u4F1A\u8BDD\u7A97\u53E3 (Session Window)\n        // \u57FA\u4E8E\u6D3B\u52A8\u7684\u52A8\u6001\u7A97\u53E3\n        KTable<Windowed<String>, Long> sessionWindowCount = events\n            .selectKey((key, value) -> extractUserId(value))\n            .groupByKey()\n            .windowedBy(SessionWindows.with(Duration.ofMinutes(30))) // 30\u5206\u949F\u4E0D\u6D3B\u8DC3\u5219\u5173\u95ED\u4F1A\u8BDD\n            .count(Materialized.as("session-window-store"));\n        \n        // 4. \u6ED1\u52A8\u7A97\u53E3\u805A\u5408\u793A\u4F8B\n        KTable<Windowed<String>, Double> slidingAverage = events\n            .selectKey((key, value) -> extractUserId(value))\n            .mapValues(value -> extractValue(value))\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(10)))\n            .aggregate(\n                () -> new AggregateValue(0.0, 0),\n                (key, value, aggregate) -> new AggregateValue(\n                    aggregate.getSum() + value,\n                    aggregate.getCount() + 1\n                ),\n                Materialized.<String, AggregateValue, WindowStore<Bytes, byte[]>>as("sliding-avg-store")\n                    .withValueSerde(new AggregateValueSerde())\n            )\n            .mapValues(aggregate -> aggregate.getCount() > 0 ? \n                      aggregate.getSum() / aggregate.getCount() : 0.0);\n        \n        // \u8F93\u51FA\u7A97\u53E3\u7ED3\u679C\n        tumblingWindowCount.toStream()\n            .map((windowedKey, count) -> KeyValue.pair(\n                windowedKey.key() + "@" + windowedKey.window().start() + "-" + windowedKey.window().end(),\n                count\n            ))\n            .to("tumbling-window-output", Produced.with(Serdes.String(), Serdes.Long()));\n        \n        hoppingWindowCount.toStream()\n            .map((windowedKey, count) -> KeyValue.pair(\n                windowedKey.key() + "@" + windowedKey.window().start() + "-" + windowedKey.window().end(),\n                count\n            ))\n            .to("hopping-window-output", Produced.with(Serdes.String(), Serdes.Long()));\n        \n        sessionWindowCount.toStream()\n            .map((windowedKey, count) -> KeyValue.pair(\n                windowedKey.key() + "@" + windowedKey.window().start() + "-" + windowedKey.window().end(),\n                count\n            ))\n            .to("session-window-output", Produced.with(Serdes.String(), Serdes.Long()));\n    }\n    \n    /**\n     * \u7A97\u53E3\u6291\u5236\u548C\u89E6\u53D1\u7B56\u7565\n     */\n    public static void demonstrateWindowSuppression(StreamsBuilder builder) {\n        KStream<String, String> events = builder.stream("events");\n        \n        // 1. \u7A97\u53E3\u5173\u95ED\u65F6\u89E6\u53D1 (\u9ED8\u8BA4\u884C\u4E3A)\n        KTable<Windowed<String>, Long> windowClosedTrigger = events\n            .selectKey((key, value) -> extractUserId(value))\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5)))\n            .count()\n            .suppress(Suppressed.untilWindowCloses(Suppressed.BufferConfig.unbounded()));\n        \n        // 2. \u65F6\u95F4\u95F4\u9694\u89E6\u53D1\n        KTable<Windowed<String>, Long> timeIntervalTrigger = events\n            .selectKey((key, value) -> extractUserId(value))\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5)))\n            .count()\n            .suppress(Suppressed.untilTimeLimit(Duration.ofSeconds(30), \n                     Suppressed.BufferConfig.maxRecords(1000)));\n        \n        // 3. \u8BB0\u5F55\u6570\u91CF\u89E6\u53D1\n        KTable<Windowed<String>, Long> recordCountTrigger = events\n            .selectKey((key, value) -> extractUserId(value))\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5)))\n            .count()\n            .suppress(Suppressed.untilTimeLimit(Duration.ofMinutes(1),\n                     Suppressed.BufferConfig.maxRecords(100)));\n        \n        // \u8F93\u51FA\u7ED3\u679C\n        windowClosedTrigger.toStream().to("window-closed-output");\n        timeIntervalTrigger.toStream().to("time-interval-output");\n        recordCountTrigger.toStream().to("record-count-output");\n    }\n    \n    /**\n     * \u590D\u6742\u7A97\u53E3\u805A\u5408 - \u5B9E\u65F6\u6307\u6807\u8BA1\u7B97\n     */\n    public static void realTimeMetricsCalculation(StreamsBuilder builder) {\n        KStream<String, String> metrics = builder.stream("metrics");\n        \n        // \u89E3\u6790\u6307\u6807\u6570\u636E\n        KStream<String, MetricData> parsedMetrics = metrics\n            .mapValues(json -> parseMetricData(json))\n            .filter((key, metric) -> metric != null);\n        \n        // 1. \u5B9E\u65F6QPS\u8BA1\u7B97 (\u6BCF\u5206\u949F\u8BF7\u6C42\u6570)\n        KTable<Windowed<String>, Long> qpsMetrics = parsedMetrics\n            .filter((key, metric) -> "request".equals(metric.getType()))\n            .selectKey((key, metric) -> metric.getServiceName())\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(1)))\n            .count(Materialized.as("qps-store"));\n        \n        // 2. \u5B9E\u65F6\u54CD\u5E94\u65F6\u95F4\u7EDF\u8BA1\n        KTable<Windowed<String>, ResponseTimeStats> responseTimeStats = parsedMetrics\n            .filter((key, metric) -> "response_time".equals(metric.getType()))\n            .selectKey((key, metric) -> metric.getServiceName())\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5)))\n            .aggregate(\n                ResponseTimeStats::new,\n                (key, metric, stats) -> stats.update(metric.getValue()),\n                Materialized.<String, ResponseTimeStats, WindowStore<Bytes, byte[]>>as("response-time-store")\n                    .withValueSerde(new ResponseTimeStatsSerde())\n            );\n        \n        // 3. \u9519\u8BEF\u7387\u8BA1\u7B97\n        KTable<Windowed<String>, Double> errorRateMetrics = parsedMetrics\n            .filter((key, metric) -> "request".equals(metric.getType()))\n            .selectKey((key, metric) -> metric.getServiceName())\n            .groupByKey()\n            .windowedBy(TimeWindows.of(Duration.ofMinutes(5)))\n            .aggregate(\n                () -> new ErrorRateData(0, 0),\n                (key, metric, data) -> {\n                    data.incrementTotal();\n                    if (metric.getValue() >= 400) { // HTTP\u9519\u8BEF\u72B6\u6001\u7801\n                        data.incrementError();\n                    }\n                    return data;\n                },\n                Materialized.<String, ErrorRateData, WindowStore<Bytes, byte[]>>as("error-rate-store")\n                    .withValueSerde(new ErrorRateDataSerde())\n            )\n            .mapValues(data -> data.getTotal() > 0 ? \n                      (double) data.getError() / data.getTotal() * 100 : 0.0);\n        \n        // \u8F93\u51FA\u5B9E\u65F6\u6307\u6807\n        qpsMetrics.toStream()\n            .map((windowedKey, qps) -> KeyValue.pair(\n                "QPS:" + windowedKey.key() + "@" + windowedKey.window().start(),\n                qps\n            ))\n            .to("realtime-qps", Produced.with(Serdes.String(), Serdes.Long()));\n        \n        responseTimeStats.toStream()\n            .map((windowedKey, stats) -> KeyValue.pair(\n                "RT:" + windowedKey.key() + "@" + windowedKey.window().start(),\n                String.format("avg:%.2f,p95:%.2f,p99:%.2f", \n                             stats.getAverage(), stats.getP95(), stats.getP99())\n            ))\n            .to("realtime-response-time", Produced.with(Serdes.String(), Serdes.String()));\n        \n        errorRateMetrics.toStream()\n            .map((windowedKey, errorRate) -> KeyValue.pair(\n                "ErrorRate:" + windowedKey.key() + "@" + windowedKey.window().start(),\n                errorRate\n            ))\n            .to("realtime-error-rate", Produced.with(Serdes.String(), Serdes.Double()));\n    }\n    \n    // \u8F85\u52A9\u65B9\u6CD5\n    private static String extractUserId(String value) {\n        // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u89E3\u6790JSON\n        return "user1";\n    }\n    \n    private static Double extractValue(String value) {\n        // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u89E3\u6790JSON\n        return 1.0;\n    }\n    \n    private static MetricData parseMetricData(String json) {\n        // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u4F7F\u7528JSON\u5E93\n        return new MetricData("request", "user-service", 200.0, System.currentTimeMillis());\n    }\n    \n    // \u6570\u636E\u7C7B\u5B9A\u4E49\n    public static class AggregateValue {\n        private double sum;\n        private int count;\n        \n        public AggregateValue(double sum, int count) {\n            this.sum = sum;\n            this.count = count;\n        }\n        \n        public double getSum() { return sum; }\n        public int getCount() { return count; }\n    }\n    \n    public static class MetricData {\n        private String type;\n        private String serviceName;\n        private double value;\n        private long timestamp;\n        \n        public MetricData(String type, String serviceName, double value, long timestamp) {\n            this.type = type;\n            this.serviceName = serviceName;\n            this.value = value;\n            this.timestamp = timestamp;\n        }\n        \n        public String getType() { return type; }\n        public String getServiceName() { return serviceName; }\n        public double getValue() { return value; }\n        public long getTimestamp() { return timestamp; }\n    }\n    \n    public static class ResponseTimeStats {\n        private List<Double> values = new ArrayList<>();\n        \n        public ResponseTimeStats update(double value) {\n            values.add(value);\n            return this;\n        }\n        \n        public double getAverage() {\n            return values.stream().mapToDouble(Double::doubleValue).average().orElse(0.0);\n        }\n        \n        public double getP95() {\n            if (values.isEmpty()) return 0.0;\n            List<Double> sorted = new ArrayList<>(values);\n            Collections.sort(sorted);\n            int index = (int) Math.ceil(0.95 * sorted.size()) - 1;\n            return sorted.get(Math.max(0, index));\n        }\n        \n        public double getP99() {\n            if (values.isEmpty()) return 0.0;\n            List<Double> sorted = new ArrayList<>(values);\n            Collections.sort(sorted);\n            int index = (int) Math.ceil(0.99 * sorted.size()) - 1;\n            return sorted.get(Math.max(0, index));\n        }\n    }\n    \n    public static class ErrorRateData {\n        private int total;\n        private int error;\n        \n        public ErrorRateData(int total, int error) {\n            this.total = total;\n            this.error = error;\n        }\n        \n        public void incrementTotal() { total++; }\n        public void incrementError() { error++; }\n        public int getTotal() { return total; }\n        public int getError() { return error; }\n    }\n    \n    // Serde\u5B9E\u73B0\uFF08\u7B80\u5316\uFF09\n    public static class AggregateValueSerde implements Serde<AggregateValue> {\n        @Override\n        public Serializer<AggregateValue> serializer() { return null; }\n        @Override\n        public Deserializer<AggregateValue> deserializer() { return null; }\n    }\n    \n    public static class ResponseTimeStatsSerde implements Serde<ResponseTimeStats> {\n        @Override\n        public Serializer<ResponseTimeStats> serializer() { return null; }\n        @Override\n        public Deserializer<ResponseTimeStats> deserializer() { return null; }\n    }\n    \n    public static class ErrorRateDataSerde implements Serde<ErrorRateData> {\n        @Override\n        public Serializer<ErrorRateData> serializer() { return null; }\n        @Override\n        public Deserializer<ErrorRateData> deserializer() { return null; }\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h3,{id:"42-\u72B6\u6001\u5B58\u50A8\u4E0E\u5BB9\u9519\u673A\u5236",children:"4.2 \u72B6\u6001\u5B58\u50A8\u4E0E\u5BB9\u9519\u673A\u5236"}),"\n",(0,i.jsx)(e.p,{children:"Kafka Streams\u63D0\u4F9B\u4E86\u5F3A\u5927\u7684\u72B6\u6001\u7BA1\u7406\u80FD\u529B\uFF0C\u652F\u6301\u672C\u5730\u72B6\u6001\u5B58\u50A8\u548C\u5206\u5E03\u5F0F\u5BB9\u9519\u673A\u5236\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"state-stores",label:"\u72B6\u6001\u5B58\u50A8",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Kafka Streams\u72B6\u6001\u5B58\u50A8\u8BE6\u89E3"',children:'import org.apache.kafka.streams.processor.api.*;\nimport org.apache.kafka.streams.state.*;\nimport org.apache.kafka.common.serialization.Serdes;\n\n/**\n * Kafka Streams\u72B6\u6001\u5B58\u50A8\u793A\u4F8B\n * \u5C55\u793A\u4E0D\u540C\u7C7B\u578B\u7684\u72B6\u6001\u5B58\u50A8\u548C\u81EA\u5B9A\u4E49\u5904\u7406\u5668\n */\npublic class StateStoreExample {\n    \n    /**\n     * \u81EA\u5B9A\u4E49\u5904\u7406\u5668\u4F7F\u7528\u72B6\u6001\u5B58\u50A8\n     */\n    public static class UserSessionProcessor implements Processor<String, String, String, String> {\n        \n        private ProcessorContext<String, String> context;\n        private KeyValueStore<String, UserSession> sessionStore;\n        \n        @Override\n        public void init(ProcessorContext<String, String> context) {\n            this.context = context;\n            this.sessionStore = context.getStateStore("user-session-store");\n            \n            // \u5B9A\u671F\u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\n            context.schedule(Duration.ofMinutes(1), PunctuationType.WALL_CLOCK_TIME, this::cleanupExpiredSessions);\n        }\n        \n        @Override\n        public void process(Record<String, String> record) {\n            String userId = record.key();\n            String eventData = record.value();\n            \n            // \u83B7\u53D6\u6216\u521B\u5EFA\u7528\u6237\u4F1A\u8BDD\n            UserSession session = sessionStore.get(userId);\n            if (session == null) {\n                session = new UserSession(userId, System.currentTimeMillis());\n            }\n            \n            // \u66F4\u65B0\u4F1A\u8BDD\u4FE1\u606F\n            session.updateActivity(eventData, System.currentTimeMillis());\n            \n            // \u4FDD\u5B58\u4F1A\u8BDD\u72B6\u6001\n            sessionStore.put(userId, session);\n            \n            // \u8F93\u51FA\u4F1A\u8BDD\u66F4\u65B0\u4E8B\u4EF6\n            context.forward(record.withValue("\u4F1A\u8BDD\u66F4\u65B0: " + session.toString()));\n        }\n        \n        /**\n         * \u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\n         */\n        private void cleanupExpiredSessions(long timestamp) {\n            long expireTime = timestamp - Duration.ofHours(1).toMillis(); // 1\u5C0F\u65F6\u8FC7\u671F\n            \n            try (KeyValueIterator<String, UserSession> iterator = sessionStore.all()) {\n                while (iterator.hasNext()) {\n                    KeyValue<String, UserSession> entry = iterator.next();\n                    if (entry.value.getLastActivityTime() < expireTime) {\n                        sessionStore.delete(entry.key);\n                        System.out.println("\u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD: " + entry.key);\n                    }\n                }\n            }\n        }\n        \n        @Override\n        public void close() {\n            // \u6E05\u7406\u8D44\u6E90\n        }\n    }\n    \n    /**\n     * \u6784\u5EFA\u4F7F\u7528\u72B6\u6001\u5B58\u50A8\u7684\u62D3\u6251\n     */\n    public static Topology buildTopologyWithStateStore() {\n        StreamsBuilder builder = new StreamsBuilder();\n        \n        // 1. \u521B\u5EFA\u72B6\u6001\u5B58\u50A8\n        StoreBuilder<KeyValueStore<String, UserSession>> sessionStoreBuilder = \n            Stores.keyValueStoreBuilder(\n                Stores.persistentKeyValueStore("user-session-store"),\n                Serdes.String(),\n                new UserSessionSerde()\n            )\n            .withLoggingEnabled(Collections.singletonMap("cleanup.policy", "compact"))\n            .withCachingEnabled();\n        \n        // 2. \u6DFB\u52A0\u72B6\u6001\u5B58\u50A8\u5230\u62D3\u6251\n        Topology topology = builder.build();\n        topology.addStateStore(sessionStoreBuilder);\n        \n        // 3. \u6DFB\u52A0\u5904\u7406\u5668\u5E76\u8FDE\u63A5\u72B6\u6001\u5B58\u50A8\n        topology.addSource("source", "user-events")\n                .addProcessor("session-processor", UserSessionProcessor::new, "source")\n                .connectProcessorAndStateStores("session-processor", "user-session-store")\n                .addSink("sink", "user-sessions-output", "session-processor");\n        \n        return topology;\n    }\n    \n    /**\n     * \u7A97\u53E3\u72B6\u6001\u5B58\u50A8\u793A\u4F8B\n     */\n    public static void windowStateStoreExample(StreamsBuilder builder) {\n        // \u521B\u5EFA\u7A97\u53E3\u72B6\u6001\u5B58\u50A8\n        StoreBuilder<WindowStore<String, Long>> windowStoreBuilder = \n            Stores.windowStoreBuilder(\n                Stores.persistentWindowStore("page-view-window-store", \n                                            Duration.ofDays(1), // \u4FDD\u75591\u5929\n                                            Duration.ofMinutes(5), // 5\u5206\u949F\u7A97\u53E3\n                                            false), // \u4E0D\u4FDD\u7559\u91CD\u590D\n                Serdes.String(),\n                Serdes.Long()\n            )\n            .withLoggingEnabled(Collections.emptyMap())\n            .withCachingEnabled();\n        \n        // \u4F7F\u7528\u7A97\u53E3\u72B6\u6001\u5B58\u50A8\u7684\u5904\u7406\u5668\n        class PageViewWindowProcessor implements Processor<String, String, String, Long> {\n            private ProcessorContext<String, Long> context;\n            private WindowStore<String, Long> windowStore;\n            \n            @Override\n            public void init(ProcessorContext<String, Long> context) {\n                this.context = context;\n                this.windowStore = context.getStateStore("page-view-window-store");\n            }\n            \n            @Override\n            public void process(Record<String, String> record) {\n                String pageId = record.key();\n                long timestamp = record.timestamp();\n                \n                // \u83B7\u53D6\u5F53\u524D\u7A97\u53E3\u7684\u8BBF\u95EE\u91CF\n                Long currentCount = windowStore.fetch(pageId, timestamp);\n                if (currentCount == null) {\n                    currentCount = 0L;\n                }\n                \n                // \u66F4\u65B0\u8BBF\u95EE\u91CF\n                windowStore.put(pageId, currentCount + 1, timestamp);\n                \n                // \u8F93\u51FA\u66F4\u65B0\u540E\u7684\u8BBF\u95EE\u91CF\n                context.forward(record.withKey(pageId).withValue(currentCount + 1));\n            }\n        }\n        \n        // \u6DFB\u52A0\u5230\u62D3\u6251\n        Topology topology = builder.build();\n        topology.addStateStore(windowStoreBuilder)\n                .addSource("page-view-source", "page-views")\n                .addProcessor("page-view-window-processor", PageViewWindowProcessor::new, "page-view-source")\n                .connectProcessorAndStateStores("page-view-window-processor", "page-view-window-store")\n                .addSink("page-view-sink", "page-view-counts", "page-view-window-processor");\n    }\n    \n    /**\n     * \u4F1A\u8BDD\u72B6\u6001\u5B58\u50A8\u793A\u4F8B\n     */\n    public static void sessionStateStoreExample(StreamsBuilder builder) {\n        // \u521B\u5EFA\u4F1A\u8BDD\u72B6\u6001\u5B58\u50A8\n        StoreBuilder<SessionStore<String, String>> sessionStoreBuilder = \n            Stores.sessionStoreBuilder(\n                Stores.persistentSessionStore("user-session-events-store", \n                                             Duration.ofMinutes(30)), // 30\u5206\u949F\u4F1A\u8BDD\u8D85\u65F6\n                Serdes.String(),\n                Serdes.String()\n            )\n            .withLoggingEnabled(Collections.emptyMap());\n        \n        // \u4F7F\u7528\u4F1A\u8BDD\u72B6\u6001\u5B58\u50A8\u7684\u5904\u7406\u5668\n        class UserSessionEventProcessor implements Processor<String, String, String, String> {\n            private ProcessorContext<String, String> context;\n            private SessionStore<String, String> sessionStore;\n            \n            @Override\n            public void init(ProcessorContext<String, String> context) {\n                this.context = context;\n                this.sessionStore = context.getStateStore("user-session-events-store");\n            }\n            \n            @Override\n            public void process(Record<String, String> record) {\n                String userId = record.key();\n                String event = record.value();\n                long timestamp = record.timestamp();\n                \n                // \u67E5\u627E\u6D3B\u8DC3\u4F1A\u8BDD\n                try (KeyValueIterator<Windowed<String>, String> sessions = \n                     sessionStore.findSessions(userId, timestamp - Duration.ofMinutes(30).toMillis(), timestamp)) {\n                    \n                    if (sessions.hasNext()) {\n                        // \u66F4\u65B0\u73B0\u6709\u4F1A\u8BDD\n                        KeyValue<Windowed<String>, String> session = sessions.next();\n                        String updatedEvents = session.value + "," + event;\n                        sessionStore.put(new Windowed<>(userId, new SessionWindow(session.key.window().start(), timestamp)), \n                                       updatedEvents);\n                    } else {\n                        // \u521B\u5EFA\u65B0\u4F1A\u8BDD\n                        sessionStore.put(new Windowed<>(userId, new SessionWindow(timestamp, timestamp)), event);\n                    }\n                }\n                \n                context.forward(record.withValue("\u4F1A\u8BDD\u4E8B\u4EF6\u5DF2\u8BB0\u5F55: " + event));\n            }\n        }\n        \n        // \u6DFB\u52A0\u5230\u62D3\u6251\n        Topology topology = builder.build();\n        topology.addStateStore(sessionStoreBuilder)\n                .addSource("session-event-source", "user-session-events")\n                .addProcessor("session-event-processor", UserSessionEventProcessor::new, "session-event-source")\n                .connectProcessorAndStateStores("session-event-processor", "user-session-events-store")\n                .addSink("session-event-sink", "processed-session-events", "session-event-processor");\n    }\n    \n    /**\n     * \u72B6\u6001\u5B58\u50A8\u67E5\u8BE2\u793A\u4F8B\n     */\n    public static class StateStoreQueryService {\n        private final KafkaStreams streams;\n        \n        public StateStoreQueryService(KafkaStreams streams) {\n            this.streams = streams;\n        }\n        \n        /**\n         * \u67E5\u8BE2\u952E\u503C\u72B6\u6001\u5B58\u50A8\n         */\n        public UserSession getUserSession(String userId) {\n            ReadOnlyKeyValueStore<String, UserSession> store = \n                streams.store(StoreQueryParameters.fromNameAndType("user-session-store", QueryableStoreTypes.keyValueStore()));\n            \n            return store.get(userId);\n        }\n        \n        /**\n         * \u67E5\u8BE2\u6240\u6709\u7528\u6237\u4F1A\u8BDD\n         */\n        public Map<String, UserSession> getAllUserSessions() {\n            ReadOnlyKeyValueStore<String, UserSession> store = \n                streams.store(StoreQueryParameters.fromNameAndType("user-session-store", QueryableStoreTypes.keyValueStore()));\n            \n            Map<String, UserSession> sessions = new HashMap<>();\n            try (KeyValueIterator<String, UserSession> iterator = store.all()) {\n                while (iterator.hasNext()) {\n                    KeyValue<String, UserSession> entry = iterator.next();\n                    sessions.put(entry.key, entry.value);\n                }\n            }\n            return sessions;\n        }\n        \n        /**\n         * \u67E5\u8BE2\u7A97\u53E3\u72B6\u6001\u5B58\u50A8\n         */\n        public Long getPageViewCount(String pageId, long timestamp) {\n            ReadOnlyWindowStore<String, Long> store = \n                streams.store(StoreQueryParameters.fromNameAndType("page-view-window-store", QueryableStoreTypes.windowStore()));\n            \n            return store.fetch(pageId, timestamp);\n        }\n        \n        /**\n         * \u67E5\u8BE2\u65F6\u95F4\u8303\u56F4\u5185\u7684\u9875\u9762\u8BBF\u95EE\u91CF\n         */\n        public Map<Long, Long> getPageViewCounts(String pageId, long startTime, long endTime) {\n            ReadOnlyWindowStore<String, Long> store = \n                streams.store(StoreQueryParameters.fromNameAndType("page-view-window-store", QueryableStoreTypes.windowStore()));\n            \n            Map<Long, Long> counts = new HashMap<>();\n            try (WindowStoreIterator<Long> iterator = store.fetch(pageId, startTime, endTime)) {\n                while (iterator.hasNext()) {\n                    KeyValue<Long, Long> entry = iterator.next();\n                    counts.put(entry.key, entry.value);\n                }\n            }\n            return counts;\n        }\n    }\n    \n    // \u7528\u6237\u4F1A\u8BDD\u6570\u636E\u7C7B\n    public static class UserSession {\n        private String userId;\n        private long startTime;\n        private long lastActivityTime;\n        private int eventCount;\n        private List<String> events;\n        \n        public UserSession(String userId, long startTime) {\n            this.userId = userId;\n            this.startTime = startTime;\n            this.lastActivityTime = startTime;\n            this.eventCount = 0;\n            this.events = new ArrayList<>();\n        }\n        \n        public void updateActivity(String event, long timestamp) {\n            this.lastActivityTime = timestamp;\n            this.eventCount++;\n            this.events.add(event);\n            \n            // \u9650\u5236\u4E8B\u4EF6\u5217\u8868\u5927\u5C0F\n            if (events.size() > 100) {\n                events.remove(0);\n            }\n        }\n        \n        @Override\n        public String toString() {\n            return String.format("UserSession{userId=\'%s\', startTime=%d, lastActivityTime=%d, eventCount=%d}",\n                               userId, startTime, lastActivityTime, eventCount);\n        }\n        \n        // Getters\n        public String getUserId() { return userId; }\n        public long getStartTime() { return startTime; }\n        public long getLastActivityTime() { return lastActivityTime; }\n        public int getEventCount() { return eventCount; }\n        public List<String> getEvents() { return events; }\n    }\n    \n    // \u7528\u6237\u4F1A\u8BDD\u5E8F\u5217\u5316\u5668\n    public static class UserSessionSerde implements Serde<UserSession> {\n        @Override\n        public Serializer<UserSession> serializer() {\n            return new UserSessionSerializer();\n        }\n        \n        @Override\n        public Deserializer<UserSession> deserializer() {\n            return new UserSessionDeserializer();\n        }\n    }\n    \n    public static class UserSessionSerializer implements Serializer<UserSession> {\n        @Override\n        public byte[] serialize(String topic, UserSession data) {\n            // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u4F7F\u7528\u66F4\u9AD8\u6548\u7684\u5E8F\u5217\u5316\u65B9\u5F0F\n            return data.toString().getBytes();\n        }\n    }\n    \n    public static class UserSessionDeserializer implements Deserializer<UserSession> {\n        @Override\n        public UserSession deserialize(String topic, byte[] data) {\n            // \u7B80\u5316\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u5B9E\u73B0\u5B8C\u6574\u7684\u53CD\u5E8F\u5217\u5316\u903B\u8F91\n            return new UserSession("default", System.currentTimeMillis());\n        }\n    }\n}\n'})})}),(0,i.jsx)(a.A,{value:"fault-tolerance",label:"\u5BB9\u9519\u673A\u5236",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Kafka Streams\u5BB9\u9519\u548C\u6062\u590D\u673A\u5236"',children:'import org.apache.kafka.streams.*;\nimport org.apache.kafka.streams.errors.*;\n\n/**\n * Kafka Streams\u5BB9\u9519\u673A\u5236\u793A\u4F8B\n * \u5C55\u793A\u5F02\u5E38\u5904\u7406\u3001\u72B6\u6001\u6062\u590D\u3001\u91CD\u8BD5\u7B56\u7565\u7B49\u5BB9\u9519\u7279\u6027\n */\npublic class FaultToleranceExample {\n    \n    /**\n     * \u914D\u7F6E\u5BB9\u9519\u76F8\u5173\u53C2\u6570\n     */\n    public static Properties createFaultTolerantConfig() {\n        Properties props = new Properties();\n        \n        // \u57FA\u7840\u914D\u7F6E\n        props.put(StreamsConfig.APPLICATION_ID_CONFIG, "fault-tolerant-app");\n        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());\n        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());\n        \n        // \u5BB9\u9519\u914D\u7F6E\n        props.put(StreamsConfig.NUM_STREAM_THREADS_CONFIG, 2);              // 2\u4E2A\u6D41\u5904\u7406\u7EBF\u7A0B\n        props.put(StreamsConfig.REPLICATION_FACTOR_CONFIG, 3);              // \u72B6\u6001\u5B58\u50A8\u526F\u672C\u56E0\u5B50\n        props.put(StreamsConfig.NUM_STANDBY_REPLICAS_CONFIG, 1);            // 1\u4E2A\u5907\u7528\u526F\u672C\n        \n        // \u72B6\u6001\u5B58\u50A8\u914D\u7F6E\n        props.put(StreamsConfig.STATE_DIR_CONFIG, "/tmp/kafka-streams");    // \u72B6\u6001\u5B58\u50A8\u76EE\u5F55\n        props.put(StreamsConfig.COMMIT_INTERVAL_MS_CONFIG, 1000);           // 1\u79D2\u63D0\u4EA4\u4E00\u6B21\n        \n        // \u91CD\u8BD5\u914D\u7F6E\n        props.put(StreamsConfig.RETRY_BACKOFF_MS_CONFIG, 1000);             // \u91CD\u8BD5\u95F4\u96941\u79D2\n        props.put(StreamsConfig.RECONNECT_BACKOFF_MS_CONFIG, 1000);         // \u91CD\u8FDE\u95F4\u96941\u79D2\n        props.put(StreamsConfig.RECONNECT_BACKOFF_MAX_MS_CONFIG, 10000);    // \u6700\u5927\u91CD\u8FDE\u95F4\u969410\u79D2\n        \n        // \u7F13\u5B58\u914D\u7F6E\n        props.put(StreamsConfig.CACHE_MAX_BYTES_BUFFERING_CONFIG, 10 * 1024 * 1024); // 10MB\u7F13\u5B58\n        \n        return props;\n    }\n    \n    /**\n     * \u521B\u5EFA\u5177\u6709\u5F02\u5E38\u5904\u7406\u7684Streams\u5E94\u7528\n     */\n    public static KafkaStreams createFaultTolerantStreamsApp() {\n        StreamsBuilder builder = new StreamsBuilder();\n        \n        // \u6784\u5EFA\u5904\u7406\u62D3\u6251\n        KStream<String, String> input = builder.stream("input-topic");\n        \n        KStream<String, String> processed = input\n            .mapValues(value -> {\n                try {\n                    // \u6A21\u62DF\u53EF\u80FD\u5931\u8D25\u7684\u5904\u7406\u903B\u8F91\n                    if (value.contains("error")) {\n                        throw new RuntimeException("\u5904\u7406\u5931\u8D25: " + value);\n                    }\n                    return "processed: " + value.toUpperCase();\n                } catch (Exception e) {\n                    // \u8BB0\u5F55\u9519\u8BEF\u4F46\u4E0D\u4E2D\u65AD\u6D41\u5904\u7406\n                    System.err.println("\u5904\u7406\u6D88\u606F\u65F6\u53D1\u751F\u9519\u8BEF: " + e.getMessage());\n                    return "error: " + value;\n                }\n            })\n            .filter((key, value) -> !value.startsWith("error"));\n        \n        processed.to("output-topic");\n        \n        // \u521B\u5EFAStreams\u5B9E\u4F8B\n        Properties props = createFaultTolerantConfig();\n        KafkaStreams streams = new KafkaStreams(builder.build(), props);\n        \n        // \u8BBE\u7F6E\u5F02\u5E38\u5904\u7406\u5668\n        streams.setUncaughtExceptionHandler(new CustomUncaughtExceptionHandler());\n        \n        // \u8BBE\u7F6E\u72B6\u6001\u76D1\u542C\u5668\n        streams.setStateListener(new CustomStateListener());\n        \n        // \u8BBE\u7F6E\u5168\u5C40\u5F02\u5E38\u5904\u7406\u5668\n        streams.setGlobalStateRestoreListener(new CustomGlobalStateRestoreListener());\n        \n        return streams;\n    }\n    \n    /**\n     * \u81EA\u5B9A\u4E49\u672A\u6355\u83B7\u5F02\u5E38\u5904\u7406\u5668\n     */\n    public static class CustomUncaughtExceptionHandler implements StreamsUncaughtExceptionHandler {\n        \n        @Override\n        public StreamThreadExceptionResponse handle(Throwable exception) {\n            System.err.println("\u6D41\u5904\u7406\u7EBF\u7A0B\u53D1\u751F\u672A\u6355\u83B7\u5F02\u5E38: " + exception.getMessage());\n            exception.printStackTrace();\n            \n            // \u6839\u636E\u5F02\u5E38\u7C7B\u578B\u51B3\u5B9A\u5904\u7406\u7B56\u7565\n            if (exception instanceof StreamsException) {\n                StreamsException streamsException = (StreamsException) exception;\n                \n                if (streamsException.getCause() instanceof org.apache.kafka.common.errors.SerializationException) {\n                    // \u5E8F\u5217\u5316\u5F02\u5E38\uFF0C\u8DF3\u8FC7\u6709\u95EE\u9898\u7684\u8BB0\u5F55\n                    System.err.println("\u5E8F\u5217\u5316\u5F02\u5E38\uFF0C\u8DF3\u8FC7\u8BB0\u5F55\u5E76\u7EE7\u7EED\u5904\u7406");\n                    return StreamThreadExceptionResponse.REPLACE_THREAD;\n                }\n                \n                if (streamsException.getCause() instanceof org.apache.kafka.common.errors.TimeoutException) {\n                    // \u8D85\u65F6\u5F02\u5E38\uFF0C\u66FF\u6362\u7EBF\u7A0B\n                    System.err.println("\u8D85\u65F6\u5F02\u5E38\uFF0C\u66FF\u6362\u5904\u7406\u7EBF\u7A0B");\n                    return StreamThreadExceptionResponse.REPLACE_THREAD;\n                }\n            }\n            \n            // \u5176\u4ED6\u5F02\u5E38\uFF0C\u5173\u95ED\u5BA2\u6237\u7AEF\n            System.err.println("\u4E25\u91CD\u5F02\u5E38\uFF0C\u5173\u95EDStreams\u5BA2\u6237\u7AEF");\n            return StreamThreadExceptionResponse.SHUTDOWN_CLIENT;\n        }\n    }\n    \n    /**\n     * \u81EA\u5B9A\u4E49\u72B6\u6001\u76D1\u542C\u5668\n     */\n    public static class CustomStateListener implements KafkaStreams.StateListener {\n        \n        @Override\n        public void onChange(KafkaStreams.State newState, KafkaStreams.State oldState) {\n            System.out.println("Streams\u72B6\u6001\u53D8\u66F4: " + oldState + " -> " + newState);\n            \n            switch (newState) {\n                case RUNNING:\n                    System.out.println("Streams\u5E94\u7528\u6B63\u5728\u8FD0\u884C");\n                    break;\n                case REBALANCING:\n                    System.out.println("Streams\u5E94\u7528\u6B63\u5728\u91CD\u5E73\u8861");\n                    break;\n                case ERROR:\n                    System.err.println("Streams\u5E94\u7528\u8FDB\u5165\u9519\u8BEF\u72B6\u6001");\n                    // \u53EF\u4EE5\u5728\u8FD9\u91CC\u5B9E\u73B0\u544A\u8B66\u903B\u8F91\n                    break;\n                case NOT_RUNNING:\n                    System.out.println("Streams\u5E94\u7528\u5DF2\u505C\u6B62");\n                    break;\n                case PENDING_SHUTDOWN:\n                    System.out.println("Streams\u5E94\u7528\u6B63\u5728\u5173\u95ED");\n                    break;\n            }\n        }\n    }\n    \n    /**\n     * \u81EA\u5B9A\u4E49\u5168\u5C40\u72B6\u6001\u6062\u590D\u76D1\u542C\u5668\n     */\n    public static class CustomGlobalStateRestoreListener implements StateRestoreListener {\n        \n        @Override\n        public void onRestoreStart(TopicPartition topicPartition, String storeName, long startingOffset, long endingOffset) {\n            System.out.printf("\u5F00\u59CB\u6062\u590D\u72B6\u6001\u5B58\u50A8: %s, \u5206\u533A: %s, \u8D77\u59CB\u4F4D\u79FB: %d, \u7ED3\u675F\u4F4D\u79FB: %d%n",\n                             storeName, topicPartition, startingOffset, endingOffset);\n        }\n        \n        @Override\n        public void onBatchRestored(TopicPartition topicPartition, String storeName, long batchEndOffset, long numRestored) {\n            System.out.printf("\u6279\u91CF\u6062\u590D\u5B8C\u6210: %s, \u5206\u533A: %s, \u6279\u6B21\u7ED3\u675F\u4F4D\u79FB: %d, \u6062\u590D\u8BB0\u5F55\u6570: %d%n",\n                             storeName, topicPartition, batchEndOffset, numRestored);\n        }\n        \n        @Override\n        public void onRestoreEnd(TopicPartition topicPartition, String storeName, long totalRestored) {\n            System.out.printf("\u72B6\u6001\u6062\u590D\u5B8C\u6210: %s, \u5206\u533A: %s, \u603B\u6062\u590D\u8BB0\u5F55\u6570: %d%n",\n                             storeName, topicPartition, totalRestored);\n        }\n    }\n    \n    /**\n     * \u81EA\u5B9A\u4E49\u53CD\u5E8F\u5217\u5316\u5F02\u5E38\u5904\u7406\u5668\n     */\n    public static class CustomDeserializationExceptionHandler implements DeserializationExceptionHandler {\n        \n        @Override\n        public DeserializationHandlerResponse handle(ProcessorContext context, ConsumerRecord<byte[], byte[]> record, Exception exception) {\n            System.err.printf("\u53CD\u5E8F\u5217\u5316\u5F02\u5E38: topic=%s, partition=%d, offset=%d, \u5F02\u5E38=%s%n",\n                             record.topic(), record.partition(), record.offset(), exception.getMessage());\n            \n            // \u8BB0\u5F55\u6709\u95EE\u9898\u7684\u6D88\u606F\u5230\u6B7B\u4FE1\u961F\u5217\n            logToDeadLetterQueue(record, exception);\n            \n            // \u8DF3\u8FC7\u6709\u95EE\u9898\u7684\u8BB0\u5F55\uFF0C\u7EE7\u7EED\u5904\u7406\n            return DeserializationHandlerResponse.CONTINUE;\n        }\n        \n        private void logToDeadLetterQueue(ConsumerRecord<byte[], byte[]> record, Exception exception) {\n            // \u5B9E\u73B0\u6B7B\u4FE1\u961F\u5217\u903B\u8F91\n            System.out.println("\u5C06\u6709\u95EE\u9898\u7684\u6D88\u606F\u53D1\u9001\u5230\u6B7B\u4FE1\u961F\u5217: " + record.offset());\n        }\n        \n        @Override\n        public void configure(Map<String, ?> configs) {\n            // \u914D\u7F6E\u521D\u59CB\u5316\n        }\n    }\n    \n    /**\n     * \u81EA\u5B9A\u4E49\u751F\u4EA7\u5F02\u5E38\u5904\u7406\u5668\n     */\n    public static class CustomProductionExceptionHandler implements ProductionExceptionHandler {\n        \n        @Override\n        public ProductionExceptionHandlerResponse handle(ProducerRecord<byte[], byte[]> record, Exception exception) {\n            System.err.printf("\u751F\u4EA7\u6D88\u606F\u5F02\u5E38: topic=%s, \u5F02\u5E38=%s%n", record.topic(), exception.getMessage());\n            \n            // \u6839\u636E\u5F02\u5E38\u7C7B\u578B\u51B3\u5B9A\u5904\u7406\u7B56\u7565\n            if (exception instanceof org.apache.kafka.common.errors.RetriableException) {\n                // \u53EF\u91CD\u8BD5\u5F02\u5E38\uFF0C\u7EE7\u7EED\u91CD\u8BD5\n                System.out.println("\u53EF\u91CD\u8BD5\u5F02\u5E38\uFF0C\u7EE7\u7EED\u91CD\u8BD5");\n                return ProductionExceptionHandlerResponse.CONTINUE;\n            } else {\n                // \u4E0D\u53EF\u91CD\u8BD5\u5F02\u5E38\uFF0C\u5931\u8D25\u5904\u7406\n                System.err.println("\u4E0D\u53EF\u91CD\u8BD5\u5F02\u5E38\uFF0C\u5931\u8D25\u5904\u7406");\n                return ProductionExceptionHandlerResponse.FAIL;\n            }\n        }\n        \n        @Override\n        public void configure(Map<String, ?> configs) {\n            // \u914D\u7F6E\u521D\u59CB\u5316\n        }\n    }\n    \n    /**\n     * \u5E26\u6709\u5B8C\u6574\u5BB9\u9519\u673A\u5236\u7684Streams\u5E94\u7528\n     */\n    public static void runFaultTolerantApplication() {\n        Properties props = createFaultTolerantConfig();\n        \n        // \u8BBE\u7F6E\u5F02\u5E38\u5904\u7406\u5668\n        props.put(StreamsConfig.DEFAULT_DESERIALIZATION_EXCEPTION_HANDLER_CLASS_CONFIG, \n                 CustomDeserializationExceptionHandler.class);\n        props.put(StreamsConfig.DEFAULT_PRODUCTION_EXCEPTION_HANDLER_CLASS_CONFIG, \n                 CustomProductionExceptionHandler.class);\n        \n        StreamsBuilder builder = new StreamsBuilder();\n        \n        // \u6784\u5EFA\u5BB9\u9519\u7684\u5904\u7406\u62D3\u6251\n        KStream<String, String> input = builder.stream("fault-tolerant-input");\n        \n        KStream<String, String> processed = input\n            .mapValues(value -> {\n                try {\n                    // \u6A21\u62DF\u4E1A\u52A1\u5904\u7406\u903B\u8F91\n                    return processBusinessLogic(value);\n                } catch (Exception e) {\n                    // \u4E1A\u52A1\u5F02\u5E38\u5904\u7406\n                    System.err.println("\u4E1A\u52A1\u5904\u7406\u5F02\u5E38: " + e.getMessage());\n                    return "FAILED:" + value;\n                }\n            })\n            .filter((key, value) -> !value.startsWith("FAILED:"));\n        \n        processed.to("fault-tolerant-output");\n        \n        // \u521B\u5EFA\u5E76\u914D\u7F6EStreams\u5B9E\u4F8B\n        KafkaStreams streams = new KafkaStreams(builder.build(), props);\n        \n        // \u8BBE\u7F6E\u5404\u79CD\u76D1\u542C\u5668\u548C\u5F02\u5E38\u5904\u7406\u5668\n        streams.setUncaughtExceptionHandler(new CustomUncaughtExceptionHandler());\n        streams.setStateListener(new CustomStateListener());\n        streams.setGlobalStateRestoreListener(new CustomGlobalStateRestoreListener());\n        \n        // \u542F\u52A8\u5E94\u7528\n        streams.start();\n        \n        // \u6DFB\u52A0\u5173\u95ED\u94A9\u5B50\n        Runtime.getRuntime().addShutdownHook(new Thread(() -> {\n            System.out.println("\u6B63\u5728\u4F18\u96C5\u5173\u95EDStreams\u5E94\u7528...");\n            streams.close(Duration.ofSeconds(10));\n            System.out.println("Streams\u5E94\u7528\u5DF2\u5173\u95ED");\n        }));\n        \n        // \u76D1\u63A7\u5E94\u7528\u72B6\u6001\n        monitorApplicationHealth(streams);\n    }\n    \n    /**\n     * \u6A21\u62DF\u4E1A\u52A1\u5904\u7406\u903B\u8F91\n     */\n    private static String processBusinessLogic(String value) throws Exception {\n        // \u6A21\u62DF\u53EF\u80FD\u5931\u8D25\u7684\u4E1A\u52A1\u903B\u8F91\n        if (value.contains("exception")) {\n            throw new RuntimeException("\u4E1A\u52A1\u5904\u7406\u5931\u8D25");\n        }\n        \n        // \u6A21\u62DF\u5904\u7406\u65F6\u95F4\n        Thread.sleep(10);\n        \n        return "PROCESSED:" + value.toUpperCase();\n    }\n    \n    /**\n     * \u76D1\u63A7\u5E94\u7528\u5065\u5EB7\u72B6\u6001\n     */\n    private static void monitorApplicationHealth(KafkaStreams streams) {\n        Timer timer = new Timer();\n        timer.scheduleAtFixedRate(new TimerTask() {\n            @Override\n            public void run() {\n                KafkaStreams.State state = streams.state();\n                System.out.println("\u5F53\u524D\u5E94\u7528\u72B6\u6001: " + state);\n                \n                if (state == KafkaStreams.State.ERROR) {\n                    System.err.println("\u5E94\u7528\u5904\u4E8E\u9519\u8BEF\u72B6\u6001\uFF0C\u53EF\u80FD\u9700\u8981\u91CD\u542F");\n                    // \u53EF\u4EE5\u5728\u8FD9\u91CC\u5B9E\u73B0\u81EA\u52A8\u91CD\u542F\u903B\u8F91\n                }\n                \n                // \u6253\u5370\u7EBF\u7A0B\u4FE1\u606F\n                StreamsMetadata metadata = streams.localThreadsMetadata().iterator().next();\n                System.out.println("\u6D3B\u8DC3\u4EFB\u52A1\u6570: " + metadata.activeTasks().size());\n                System.out.println("\u5907\u7528\u4EFB\u52A1\u6570: " + metadata.standbyTasks().size());\n            }\n        }, 0, 30000); // \u6BCF30\u79D2\u68C0\u67E5\u4E00\u6B21\n    }\n    \n    public static void main(String[] args) {\n        runFaultTolerantApplication();\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h2,{id:"5-kafka\u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7",children:"5. Kafka\u6027\u80FD\u4F18\u5316\u4E0E\u76D1\u63A7"}),"\n",(0,i.jsx)(e.h3,{id:"51-\u6027\u80FD\u4F18\u5316\u7B56\u7565",children:"5.1 \u6027\u80FD\u4F18\u5316\u7B56\u7565"}),"\n",(0,i.jsx)(e.p,{children:"Kafka\u6027\u80FD\u4F18\u5316\u662F\u4E00\u4E2A\u7CFB\u7EDF\u5DE5\u7A0B\uFF0C\u9700\u8981\u4ECE\u786C\u4EF6\u3001\u64CD\u4F5C\u7CFB\u7EDF\u3001Kafka\u914D\u7F6E\u3001\u5E94\u7528\u7A0B\u5E8F\u7B49\u591A\u4E2A\u5C42\u9762\u8FDB\u884C\u7EFC\u5408\u4F18\u5316\u3002"}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(a.A,{value:"hardware-os",label:"\u786C\u4EF6\u4E0E\u64CD\u4F5C\u7CFB\u7EDF\u4F18\u5316",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",metastring:'title="\u786C\u4EF6\u548C\u64CD\u4F5C\u7CFB\u7EDF\u4F18\u5316\u914D\u7F6E"',children:'# ==================== \u786C\u4EF6\u9009\u62E9\u5EFA\u8BAE ====================\n# CPU: \n# - \u751F\u4EA7\u8005\u5BC6\u96C6\u578B\uFF1A\u9AD8\u9891\u7387CPU\uFF0C8-16\u6838\u5FC3\n# - \u6D88\u8D39\u8005\u5BC6\u96C6\u578B\uFF1A\u591A\u6838\u5FC3CPU\uFF0C16-32\u6838\u5FC3\n# - \u6DF7\u5408\u8D1F\u8F7D\uFF1A\u5E73\u8861\u578BCPU\uFF0C16-24\u6838\u5FC3\n\n# \u5185\u5B58:\n# - \u6700\u5C0F8GB\uFF0C\u63A8\u835032GB\u4EE5\u4E0A\n# - \u4E3A\u9875\u7F13\u5B58\u9884\u7559\u8DB3\u591F\u5185\u5B58\uFF1A\u603B\u5185\u5B58\u768450-75%\n# - JVM\u5806\u5185\u5B58\uFF1A6-8GB\uFF08\u4E0D\u8D85\u8FC732GB\uFF09\n\n# \u5B58\u50A8:\n# - \u4F7F\u7528SSD\u5B58\u50A8\u63D0\u9AD8I/O\u6027\u80FD\n# - \u591A\u78C1\u76D8RAID\u914D\u7F6E\uFF1ARAID 10\uFF08\u6027\u80FD\uFF09\u6216RAID 6\uFF08\u5BB9\u91CF\uFF09\n# - \u5206\u79BB\u65E5\u5FD7\u548C\u7D22\u5F15\u6587\u4EF6\u5230\u4E0D\u540C\u78C1\u76D8\n\n# \u7F51\u7EDC:\n# - \u4E07\u5146\u7F51\u5361\uFF0810Gbps\uFF09\n# - \u4F4E\u5EF6\u8FDF\u7F51\u7EDC\u4EA4\u6362\u673A\n# - \u4F18\u5316\u7F51\u7EDC\u7F13\u51B2\u533A\u5927\u5C0F\n\n# ==================== \u64CD\u4F5C\u7CFB\u7EDF\u4F18\u5316 ====================\n\n# 1. \u6587\u4EF6\u7CFB\u7EDF\u4F18\u5316\n# \u4F7F\u7528ext4\u6216xfs\u6587\u4EF6\u7CFB\u7EDF\uFF0C\u63A8\u8350xfs\nmkfs.xfs -f /dev/sdb1\n\n# \u6302\u8F7D\u9009\u9879\u4F18\u5316\nmount -t xfs -o noatime,nodiratime,nobarrier /dev/sdb1 /var/kafka-logs\n\n# /etc/fstab \u914D\u7F6E\necho "/dev/sdb1 /var/kafka-logs xfs noatime,nodiratime,nobarrier 0 0" >> /etc/fstab\n\n# 2. \u5185\u6838\u53C2\u6570\u4F18\u5316\ncat >> /etc/sysctl.conf << EOF\n# \u7F51\u7EDC\u4F18\u5316\nnet.core.rmem_default = 262144\nnet.core.rmem_max = 16777216\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 16777216\nnet.core.netdev_max_backlog = 5000\nnet.ipv4.tcp_rmem = 4096 65536 16777216\nnet.ipv4.tcp_wmem = 4096 65536 16777216\nnet.ipv4.tcp_congestion_control = bbr\n\n# \u6587\u4EF6\u7CFB\u7EDF\u4F18\u5316\nvm.swappiness = 1\nvm.dirty_ratio = 80\nvm.dirty_background_ratio = 5\nvm.dirty_expire_centisecs = 12000\nvm.dirty_writeback_centisecs = 1500\n\n# \u6587\u4EF6\u63CF\u8FF0\u7B26\u9650\u5236\nfs.file-max = 2097152\nfs.nr_open = 2097152\n\n# \u8FDB\u7A0B\u9650\u5236\nkernel.pid_max = 4194304\nkernel.threads-max = 4194304\nEOF\n\n# \u5E94\u7528\u5185\u6838\u53C2\u6570\nsysctl -p\n\n# 3. \u7528\u6237\u9650\u5236\u4F18\u5316\ncat >> /etc/security/limits.conf << EOF\nkafka soft nofile 1048576\nkafka hard nofile 1048576\nkafka soft nproc 1048576\nkafka hard nproc 1048576\nkafka soft memlock unlimited\nkafka hard memlock unlimited\nEOF\n\n# 4. \u78C1\u76D8\u8C03\u5EA6\u5668\u4F18\u5316\n# \u5BF9\u4E8ESSD\u4F7F\u7528noop\u6216deadline\u8C03\u5EA6\u5668\necho noop > /sys/block/sdb/queue/scheduler\n\n# \u5BF9\u4E8E\u673A\u68B0\u786C\u76D8\u4F7F\u7528cfq\u8C03\u5EA6\u5668\necho cfq > /sys/block/sda/queue/scheduler\n\n# 5. CPU\u9891\u7387\u8C03\u8282\u5668\n# \u8BBE\u7F6E\u4E3Aperformance\u6A21\u5F0F\ncpupower frequency-set -g performance\n\n# 6. \u900F\u660E\u5927\u9875\u4F18\u5316\n# \u7981\u7528\u900F\u660E\u5927\u9875\uFF08\u53EF\u80FD\u5F71\u54CD\u6027\u80FD\uFF09\necho never > /sys/kernel/mm/transparent_hugepage/enabled\necho never > /sys/kernel/mm/transparent_hugepage/defrag\n\n# 7. NUMA\u4F18\u5316\n# \u67E5\u770BNUMA\u62D3\u6251\nnumactl --hardware\n\n# \u7ED1\u5B9AKafka\u8FDB\u7A0B\u5230\u7279\u5B9ANUMA\u8282\u70B9\nnumactl --cpunodebind=0 --membind=0 /opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/server.properties\n\n# ==================== JVM\u4F18\u5316 ====================\n\n# Kafka JVM\u542F\u52A8\u53C2\u6570\u4F18\u5316\ncat > /opt/kafka/bin/kafka-server-start-optimized.sh << \'EOF\'\n#!/bin/bash\n\n# JVM\u5806\u5185\u5B58\u8BBE\u7F6E\uFF08\u6839\u636E\u5B9E\u9645\u5185\u5B58\u8C03\u6574\uFF09\nexport KAFKA_HEAP_OPTS="-Xmx6g -Xms6g"\n\n# GC\u4F18\u5316\u914D\u7F6E\nexport KAFKA_JVM_PERFORMANCE_OPTS="-server \\\n-XX:+UseG1GC \\\n-XX:MaxGCPauseMillis=20 \\\n-XX:InitiatingHeapOccupancyPercent=35 \\\n-XX:+ExplicitGCInvokesConcurrent \\\n-XX:MaxInlineLevel=15 \\\n-Djava.awt.headless=true"\n\n# JVM\u76D1\u63A7\u548C\u8C03\u8BD5\u53C2\u6570\nexport KAFKA_JVM_PERFORMANCE_OPTS="$KAFKA_JVM_PERFORMANCE_OPTS \\\n-XX:+UnlockCommercialFeatures \\\n-XX:+FlightRecorder \\\n-XX:+UnlockDiagnosticVMOptions \\\n-XX:+DebugNonSafepoints \\\n-XX:+PrintGC \\\n-XX:+PrintGCDetails \\\n-XX:+PrintGCTimeStamps \\\n-XX:+PrintGCApplicationStoppedTime \\\n-Xloggc:/var/log/kafka/kafka-gc.log \\\n-XX:+UseGCLogFileRotation \\\n-XX:NumberOfGCLogFiles=10 \\\n-XX:GCLogFileSize=100M"\n\n# \u542F\u52A8Kafka\nexec /opt/kafka/bin/kafka-server-start.sh "$@"\nEOF\n\nchmod +x /opt/kafka/bin/kafka-server-start-optimized.sh\n\n# ==================== \u76D1\u63A7\u811A\u672C ====================\n\n# \u7CFB\u7EDF\u6027\u80FD\u76D1\u63A7\u811A\u672C\ncat > /opt/kafka/bin/system-monitor.sh << \'EOF\'\n#!/bin/bash\n\nLOG_FILE="/var/log/kafka/system-monitor.log"\n\nwhile true; do\n    echo "=== $(date) ===" >> $LOG_FILE\n    \n    # CPU\u4F7F\u7528\u7387\n    echo "CPU\u4F7F\u7528\u7387:" >> $LOG_FILE\n    top -bn1 | grep "Cpu(s)" >> $LOG_FILE\n    \n    # \u5185\u5B58\u4F7F\u7528\u60C5\u51B5\n    echo "\u5185\u5B58\u4F7F\u7528\u60C5\u51B5:" >> $LOG_FILE\n    free -h >> $LOG_FILE\n    \n    # \u78C1\u76D8I/O\n    echo "\u78C1\u76D8I/O:" >> $LOG_FILE\n    iostat -x 1 1 >> $LOG_FILE\n    \n    # \u7F51\u7EDC\u6D41\u91CF\n    echo "\u7F51\u7EDC\u6D41\u91CF:" >> $LOG_FILE\n    sar -n DEV 1 1 >> $LOG_FILE\n    \n    # Kafka\u8FDB\u7A0B\u72B6\u6001\n    echo "Kafka\u8FDB\u7A0B:" >> $LOG_FILE\n    ps aux | grep kafka >> $LOG_FILE\n    \n    echo "" >> $LOG_FILE\n    sleep 60\ndone\nEOF\n\nchmod +x /opt/kafka/bin/system-monitor.sh\n\n# \u542F\u52A8\u7CFB\u7EDF\u76D1\u63A7\nnohup /opt/kafka/bin/system-monitor.sh &\n'})})}),(0,i.jsxs)(a.A,{value:"broker-optimization",label:"Broker\u914D\u7F6E\u4F18\u5316",children:[(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",metastring:'title="Broker\u6027\u80FD\u4F18\u5316\u914D\u7F6E"',children:"# server.properties - \u751F\u4EA7\u73AF\u5883\u4F18\u5316\u914D\u7F6E\n\n############################# \u57FA\u7840\u914D\u7F6E #############################\n# Broker ID\uFF08\u96C6\u7FA4\u4E2D\u552F\u4E00\uFF09\nbroker.id=1\n\n# \u76D1\u542C\u914D\u7F6E\nlisteners=PLAINTEXT://0.0.0.0:9092\nadvertised.listeners=PLAINTEXT://kafka-broker-1:9092\n\n############################# \u7F51\u7EDC\u548C\u7EBF\u7A0B\u914D\u7F6E #############################\n# \u7F51\u7EDC\u7EBF\u7A0B\u6570 - \u5904\u7406\u7F51\u7EDC\u8BF7\u6C42\n# \u5EFA\u8BAE\uFF1ACPU\u6838\u6570\uFF0C\u9AD8\u5E76\u53D1\u573A\u666F\u53EF\u8BBE\u7F6E\u4E3ACPU\u6838\u6570\u76841.5-2\u500D\nnum.network.threads=16\n\n# I/O\u7EBF\u7A0B\u6570 - \u5904\u7406\u78C1\u76D8\u8BFB\u5199\n# \u5EFA\u8BAE\uFF1A\u78C1\u76D8\u6570\u91CF\u76842-3\u500D\uFF0C\u6216CPU\u6838\u6570\nnum.io.threads=32\n\n# Socket\u7F13\u51B2\u533A\u5927\u5C0F\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\n\n# \u8BF7\u6C42\u961F\u5217\u5927\u5C0F\nqueued.max.requests=500\n\n############################# \u65E5\u5FD7\u914D\u7F6E #############################\n# \u65E5\u5FD7\u76EE\u5F55 - \u4F7F\u7528\u591A\u4E2A\u76EE\u5F55\u5206\u6563I/O\u8D1F\u8F7D\nlog.dirs=/var/kafka-logs-1,/var/kafka-logs-2,/var/kafka-logs-3,/var/kafka-logs-4\n\n# \u5206\u533A\u6570\u914D\u7F6E\nnum.partitions=6\ndefault.replication.factor=3\nmin.insync.replicas=2\n\n# \u65E5\u5FD7\u6BB5\u914D\u7F6E\nlog.segment.bytes=1073741824          # 1GB\u6BB5\u5927\u5C0F\nlog.roll.hours=168                    # 7\u5929\u6EDA\u52A8\nlog.retention.hours=168               # 7\u5929\u4FDD\u7559\nlog.retention.bytes=1073741824000     # 1TB\u4FDD\u7559\u5927\u5C0F\n\n# \u65E5\u5FD7\u6E05\u7406\u914D\u7F6E\nlog.cleanup.policy=delete\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=true\nlog.cleaner.threads=2\nlog.cleaner.io.max.bytes.per.second=104857600\n\n############################# \u526F\u672C\u914D\u7F6E #############################\n# \u526F\u672C\u62C9\u53D6\u914D\u7F6E\nreplica.fetch.max.bytes=1048576\nreplica.fetch.wait.max.ms=500\nreplica.high.watermark.checkpoint.interval.ms=5000\nreplica.lag.time.max.ms=30000\n\n# Leader\u9009\u4E3E\u914D\u7F6E\nunclean.leader.election.enable=false\nleader.imbalance.per.broker.percentage=10\nleader.imbalance.check.interval.seconds=300\n\n############################# \u538B\u7F29\u914D\u7F6E #############################\n# \u542F\u7528\u538B\u7F29\ncompression.type=lz4\n\n# \u65E5\u5FD7\u538B\u7F29\u914D\u7F6E\uFF08\u9488\u5BF9compacted topics\uFF09\nlog.cleaner.min.cleanable.ratio=0.5\nlog.cleaner.min.compaction.lag.ms=0\nlog.cleaner.max.compaction.lag.ms=9223372036854775807\n\n############################# \u5185\u5B58\u548C\u7F13\u5B58\u914D\u7F6E #############################\n# \u9875\u7F13\u5B58\u5237\u76D8\u914D\u7F6E\nlog.flush.interval.messages=10000\nlog.flush.interval.ms=1000\n\n# \u7D22\u5F15\u914D\u7F6E\nlog.index.size.max.bytes=10485760\nlog.index.interval.bytes=4096\n\n############################# \u8FDE\u63A5\u548C\u8D85\u65F6\u914D\u7F6E #############################\n# \u8FDE\u63A5\u914D\u7F6E\nconnections.max.idle.ms=600000\nrequest.timeout.ms=30000\n\n# ZooKeeper\u914D\u7F6E\nzookeeper.connect=zk1:2181,zk2:2181,zk3:2181/kafka\nzookeeper.connection.timeout.ms=18000\nzookeeper.session.timeout.ms=18000\n\n############################# \u76D1\u63A7\u914D\u7F6E #############################\n# JMX\u914D\u7F6E\njmx.port=9999\n\n# \u6307\u6807\u62A5\u544A\u914D\u7F6E\nmetric.reporters=\nmetrics.num.samples=2\nmetrics.sample.window.ms=30000\n\n############################# \u5B89\u5168\u914D\u7F6E #############################\n# \u81EA\u52A8\u521B\u5EFATopic\uFF08\u751F\u4EA7\u73AF\u5883\u5EFA\u8BAE\u5173\u95ED\uFF09\nauto.create.topics.enable=false\ndelete.topic.enable=true\n\n# \u4E8B\u52A1\u914D\u7F6E\ntransaction.state.log.replication.factor=3\ntransaction.state.log.min.isr=2\ntransaction.state.log.num.partitions=50\n\n############################# \u9AD8\u7EA7\u914D\u7F6E #############################\n# \u7EC4\u534F\u8C03\u5668\u914D\u7F6E\ngroup.initial.rebalance.delay.ms=3000\ngroup.max.session.timeout.ms=1800000\ngroup.min.session.timeout.ms=6000\n\n# \u751F\u4EA7\u8005\u914D\u7F6E\nproducer.purgatory.purge.interval.requests=1000\nfetch.purgatory.purge.interval.requests=1000\n\n# \u914D\u7F6E\u52A8\u6001\u66F4\u65B0\nconfig.providers=file\nconfig.providers.file.class=org.apache.kafka.common.config.provider.FileConfigProvider\n"})}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="Broker\u6027\u80FD\u76D1\u63A7\u5DE5\u5177"',children:'import org.apache.kafka.clients.admin.*;\nimport javax.management.*;\nimport javax.management.remote.*;\nimport java.util.*;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.ScheduledExecutorService;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * Kafka Broker\u6027\u80FD\u76D1\u63A7\u5DE5\u5177\n * \u901A\u8FC7JMX\u76D1\u63A7Broker\u7684\u5173\u952E\u6027\u80FD\u6307\u6807\n */\npublic class BrokerPerformanceMonitor {\n    \n    private final MBeanServerConnection mbeanConnection;\n    private final ScheduledExecutorService scheduler;\n    private final Map<String, Double> previousValues = new HashMap<>();\n    \n    public BrokerPerformanceMonitor(String jmxUrl) throws Exception {\n        JMXServiceURL serviceURL = new JMXServiceURL(jmxUrl);\n        JMXConnector connector = JMXConnectorFactory.connect(serviceURL);\n        this.mbeanConnection = connector.getMBeanServerConnection();\n        this.scheduler = Executors.newScheduledThreadPool(1);\n    }\n    \n    /**\n     * \u542F\u52A8\u6027\u80FD\u76D1\u63A7\n     */\n    public void startMonitoring() {\n        scheduler.scheduleAtFixedRate(this::collectAndReportMetrics, 0, 30, TimeUnit.SECONDS);\n    }\n    \n    /**\n     * \u6536\u96C6\u5E76\u62A5\u544A\u6027\u80FD\u6307\u6807\n     */\n    private void collectAndReportMetrics() {\n        try {\n            System.out.println("=== Kafka Broker\u6027\u80FD\u6307\u6807 (" + new Date() + ") ===");\n            \n            // 1. \u6D88\u606F\u541E\u5410\u91CF\u6307\u6807\n            collectThroughputMetrics();\n            \n            // 2. \u7F51\u7EDC\u6307\u6807\n            collectNetworkMetrics();\n            \n            // 3. \u78C1\u76D8I/O\u6307\u6807\n            collectDiskIOMetrics();\n            \n            // 4. JVM\u6307\u6807\n            collectJVMMetrics();\n            \n            // 5. \u526F\u672C\u6307\u6807\n            collectReplicationMetrics();\n            \n            // 6. \u8BF7\u6C42\u5904\u7406\u6307\u6807\n            collectRequestMetrics();\n            \n            System.out.println();\n            \n        } catch (Exception e) {\n            System.err.println("\u6536\u96C6\u6027\u80FD\u6307\u6807\u5931\u8D25: " + e.getMessage());\n        }\n    }\n    \n    /**\n     * \u6536\u96C6\u541E\u5410\u91CF\u6307\u6807\n     */\n    private void collectThroughputMetrics() throws Exception {\n        // \u6D88\u606F\u8F93\u5165\u901F\u7387\n        ObjectName messagesInPerSec = new ObjectName("kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec");\n        Double messagesInRate = (Double) mbeanConnection.getAttribute(messagesInPerSec, "OneMinuteRate");\n        \n        // \u5B57\u8282\u8F93\u5165\u901F\u7387\n        ObjectName bytesInPerSec = new ObjectName("kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec");\n        Double bytesInRate = (Double) mbeanConnection.getAttribute(bytesInPerSec, "OneMinuteRate");\n        \n        // \u5B57\u8282\u8F93\u51FA\u901F\u7387\n        ObjectName bytesOutPerSec = new ObjectName("kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec");\n        Double bytesOutRate = (Double) mbeanConnection.getAttribute(bytesOutPerSec, "OneMinuteRate");\n        \n        System.out.printf("\u541E\u5410\u91CF\u6307\u6807 - \u6D88\u606F\u8F93\u5165: %.2f msg/s, \u5B57\u8282\u8F93\u5165: %.2f MB/s, \u5B57\u8282\u8F93\u51FA: %.2f MB/s%n",\n                         messagesInRate, bytesInRate / 1024 / 1024, bytesOutRate / 1024 / 1024);\n    }\n    \n    /**\n     * \u6536\u96C6\u7F51\u7EDC\u6307\u6807\n     */\n    private void collectNetworkMetrics() throws Exception {\n        // \u7F51\u7EDC\u5904\u7406\u5668\u5E73\u5747\u7A7A\u95F2\u7387\n        ObjectName networkProcessorAvgIdlePercent = new ObjectName("kafka.network:type=SocketServer,name=NetworkProcessorAvgIdlePercent");\n        Double networkIdlePercent = (Double) mbeanConnection.getAttribute(networkProcessorAvgIdlePercent, "Value");\n        \n        // \u8BF7\u6C42\u961F\u5217\u5927\u5C0F\n        ObjectName requestQueueSize = new ObjectName("kafka.network:type=RequestChannel,name=RequestQueueSize");\n        Double queueSize = (Double) mbeanConnection.getAttribute(requestQueueSize, "Value");\n        \n        System.out.printf("\u7F51\u7EDC\u6307\u6807 - \u7F51\u7EDC\u5904\u7406\u5668\u7A7A\u95F2\u7387: %.2f%%, \u8BF7\u6C42\u961F\u5217\u5927\u5C0F: %.0f%n",\n                         networkIdlePercent * 100, queueSize);\n    }\n    \n    /**\n     * \u6536\u96C6\u78C1\u76D8I/O\u6307\u6807\n     */\n    private void collectDiskIOMetrics() throws Exception {\n        // \u65E5\u5FD7\u5237\u76D8\u901F\u7387\n        ObjectName logFlushRateAndTimeMs = new ObjectName("kafka.log:type=LogFlushStats,name=LogFlushRateAndTimeMs");\n        Double logFlushRate = (Double) mbeanConnection.getAttribute(logFlushRateAndTimeMs, "OneMinuteRate");\n        Double logFlushTime = (Double) mbeanConnection.getAttribute(logFlushRateAndTimeMs, "Mean");\n        \n        System.out.printf("\u78C1\u76D8I/O\u6307\u6807 - \u65E5\u5FD7\u5237\u76D8\u901F\u7387: %.2f/s, \u5E73\u5747\u5237\u76D8\u65F6\u95F4: %.2f ms%n",\n                         logFlushRate, logFlushTime);\n    }\n    \n    /**\n     * \u6536\u96C6JVM\u6307\u6807\n     */\n    private void collectJVMMetrics() throws Exception {\n        // \u5806\u5185\u5B58\u4F7F\u7528\n        ObjectName heapMemoryUsage = new ObjectName("java.lang:type=Memory");\n        CompositeData heapMemory = (CompositeData) mbeanConnection.getAttribute(heapMemoryUsage, "HeapMemoryUsage");\n        Long heapUsed = (Long) heapMemory.get("used");\n        Long heapMax = (Long) heapMemory.get("max");\n        \n        // GC\u4FE1\u606F\n        ObjectName gcInfo = new ObjectName("java.lang:type=GarbageCollector,name=G1 Young Generation");\n        Long gcCount = (Long) mbeanConnection.getAttribute(gcInfo, "CollectionCount");\n        Long gcTime = (Long) mbeanConnection.getAttribute(gcInfo, "CollectionTime");\n        \n        System.out.printf("JVM\u6307\u6807 - \u5806\u5185\u5B58\u4F7F\u7528: %.2f%% (%d MB / %d MB), GC\u6B21\u6570: %d, GC\u65F6\u95F4: %d ms%n",\n                         (double) heapUsed / heapMax * 100, heapUsed / 1024 / 1024, heapMax / 1024 / 1024,\n                         gcCount, gcTime);\n    }\n    \n    /**\n     * \u6536\u96C6\u526F\u672C\u6307\u6807\n     */\n    private void collectReplicationMetrics() throws Exception {\n        // \u672A\u540C\u6B65\u526F\u672C\u6570\u91CF\n        ObjectName underReplicatedPartitions = new ObjectName("kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions");\n        Double underReplicated = (Double) mbeanConnection.getAttribute(underReplicatedPartitions, "Value");\n        \n        // \u79BB\u7EBF\u5206\u533A\u6570\u91CF\n        ObjectName offlinePartitionsCount = new ObjectName("kafka.controller:type=KafkaController,name=OfflinePartitionsCount");\n        Double offlinePartitions = (Double) mbeanConnection.getAttribute(offlinePartitionsCount, "Value");\n        \n        System.out.printf("\u526F\u672C\u6307\u6807 - \u672A\u540C\u6B65\u526F\u672C: %.0f, \u79BB\u7EBF\u5206\u533A: %.0f%n",\n                         underReplicated, offlinePartitions);\n    }\n    \n    /**\n     * \u6536\u96C6\u8BF7\u6C42\u5904\u7406\u6307\u6807\n     */\n    private void collectRequestMetrics() throws Exception {\n        // \u751F\u4EA7\u8BF7\u6C42\u5904\u7406\u65F6\u95F4\n        ObjectName produceRequestTime = new ObjectName("kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Produce");\n        Double produceTime = (Double) mbeanConnection.getAttribute(produceRequestTime, "Mean");\n        \n        // \u62C9\u53D6\u8BF7\u6C42\u5904\u7406\u65F6\u95F4\n        ObjectName fetchRequestTime = new ObjectName("kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchConsumer");\n        Double fetchTime = (Double) mbeanConnection.getAttribute(fetchRequestTime, "Mean");\n        \n        System.out.printf("\u8BF7\u6C42\u5904\u7406\u6307\u6807 - \u751F\u4EA7\u8BF7\u6C42\u5E73\u5747\u65F6\u95F4: %.2f ms, \u62C9\u53D6\u8BF7\u6C42\u5E73\u5747\u65F6\u95F4: %.2f ms%n",\n                         produceTime, fetchTime);\n    }\n    \n    /**\n     * \u751F\u6210\u6027\u80FD\u62A5\u544A\n     */\n    public void generatePerformanceReport() {\n        try {\n            System.out.println("=== Kafka Broker\u6027\u80FD\u62A5\u544A ===");\n            \n            // \u6536\u96C6\u8BE6\u7EC6\u6307\u6807\n            Map<String, Object> metrics = new HashMap<>();\n            \n            // \u541E\u5410\u91CF\u6307\u6807\n            ObjectName messagesInPerSec = new ObjectName("kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec");\n            metrics.put("messagesInPerSec", mbeanConnection.getAttribute(messagesInPerSec, "OneMinuteRate"));\n            \n            ObjectName bytesInPerSec = new ObjectName("kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec");\n            metrics.put("bytesInPerSec", mbeanConnection.getAttribute(bytesInPerSec, "OneMinuteRate"));\n            \n            ObjectName bytesOutPerSec = new ObjectName("kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec");\n            metrics.put("bytesOutPerSec", mbeanConnection.getAttribute(bytesOutPerSec, "OneMinuteRate"));\n            \n            // \u5EF6\u8FDF\u6307\u6807\n            ObjectName produceRequestTime = new ObjectName("kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Produce");\n            metrics.put("produceLatency", mbeanConnection.getAttribute(produceRequestTime, "Mean"));\n            \n            ObjectName fetchRequestTime = new ObjectName("kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchConsumer");\n            metrics.put("fetchLatency", mbeanConnection.getAttribute(fetchRequestTime, "Mean"));\n            \n            // \u8D44\u6E90\u4F7F\u7528\u6307\u6807\n            ObjectName heapMemoryUsage = new ObjectName("java.lang:type=Memory");\n            CompositeData heapMemory = (CompositeData) mbeanConnection.getAttribute(heapMemoryUsage, "HeapMemoryUsage");\n            metrics.put("heapUsedPercent", (double) ((Long) heapMemory.get("used")) / ((Long) heapMemory.get("max")) * 100);\n            \n            // \u6253\u5370\u62A5\u544A\n            System.out.println("\u6027\u80FD\u6307\u6807\u6458\u8981:");\n            System.out.printf("  \u6D88\u606F\u541E\u5410\u91CF: %.2f msg/s%n", (Double) metrics.get("messagesInPerSec"));\n            System.out.printf("  \u6570\u636E\u8F93\u5165\u901F\u7387: %.2f MB/s%n", (Double) metrics.get("bytesInPerSec") / 1024 / 1024);\n            System.out.printf("  \u6570\u636E\u8F93\u51FA\u901F\u7387: %.2f MB/s%n", (Double) metrics.get("bytesOutPerSec") / 1024 / 1024);\n            System.out.printf("  \u751F\u4EA7\u5EF6\u8FDF: %.2f ms%n", (Double) metrics.get("produceLatency"));\n            System.out.printf("  \u62C9\u53D6\u5EF6\u8FDF: %.2f ms%n", (Double) metrics.get("fetchLatency"));\n            System.out.printf("  \u5806\u5185\u5B58\u4F7F\u7528\u7387: %.2f%%%n", (Double) metrics.get("heapUsedPercent"));\n            \n            // \u6027\u80FD\u8BC4\u4F30\n            evaluatePerformance(metrics);\n            \n        } catch (Exception e) {\n            System.err.println("\u751F\u6210\u6027\u80FD\u62A5\u544A\u5931\u8D25: " + e.getMessage());\n        }\n    }\n    \n    /**\n     * \u6027\u80FD\u8BC4\u4F30\u548C\u5EFA\u8BAE\n     */\n    private void evaluatePerformance(Map<String, Object> metrics) {\n        System.out.println("\\n\u6027\u80FD\u8BC4\u4F30\u548C\u5EFA\u8BAE:");\n        \n        Double messagesInPerSec = (Double) metrics.get("messagesInPerSec");\n        Double produceLatency = (Double) metrics.get("produceLatency");\n        Double fetchLatency = (Double) metrics.get("fetchLatency");\n        Double heapUsedPercent = (Double) metrics.get("heapUsedPercent");\n        \n        // \u541E\u5410\u91CF\u8BC4\u4F30\n        if (messagesInPerSec < 1000) {\n            System.out.println("  \u26A0\uFE0F  \u6D88\u606F\u541E\u5410\u91CF\u8F83\u4F4E\uFF0C\u5EFA\u8BAE\u68C0\u67E5\u751F\u4EA7\u8005\u914D\u7F6E\u548C\u7F51\u7EDC\u72B6\u51B5");\n        } else if (messagesInPerSec > 50000) {\n            System.out.println("  \u2705 \u6D88\u606F\u541E\u5410\u91CF\u826F\u597D");\n        }\n        \n        // \u5EF6\u8FDF\u8BC4\u4F30\n        if (produceLatency > 100) {\n            System.out.println("  \u26A0\uFE0F  \u751F\u4EA7\u5EF6\u8FDF\u8F83\u9AD8\uFF0C\u5EFA\u8BAE\u4F18\u5316\u78C1\u76D8I/O\u548C\u7F51\u7EDC\u914D\u7F6E");\n        } else {\n            System.out.println("  \u2705 \u751F\u4EA7\u5EF6\u8FDF\u6B63\u5E38");\n        }\n        \n        if (fetchLatency > 50) {\n            System.out.println("  \u26A0\uFE0F  \u62C9\u53D6\u5EF6\u8FDF\u8F83\u9AD8\uFF0C\u5EFA\u8BAE\u68C0\u67E5\u6D88\u8D39\u8005\u914D\u7F6E");\n        } else {\n            System.out.println("  \u2705 \u62C9\u53D6\u5EF6\u8FDF\u6B63\u5E38");\n        }\n        \n        // \u5185\u5B58\u8BC4\u4F30\n        if (heapUsedPercent > 80) {\n            System.out.println("  \u26A0\uFE0F  \u5806\u5185\u5B58\u4F7F\u7528\u7387\u8FC7\u9AD8\uFF0C\u5EFA\u8BAE\u589E\u52A0\u5806\u5185\u5B58\u6216\u4F18\u5316\u5E94\u7528");\n        } else {\n            System.out.println("  \u2705 \u5806\u5185\u5B58\u4F7F\u7528\u7387\u6B63\u5E38");\n        }\n    }\n    \n    public void shutdown() {\n        scheduler.shutdown();\n    }\n    \n    public static void main(String[] args) {\n        try {\n            // JMX\u8FDE\u63A5URL\uFF0C\u6839\u636E\u5B9E\u9645\u914D\u7F6E\u8C03\u6574\n            String jmxUrl = "service:jmx:rmi:///jndi/rmi://localhost:9999/jmxrmi";\n            \n            BrokerPerformanceMonitor monitor = new BrokerPerformanceMonitor(jmxUrl);\n            \n            // \u542F\u52A8\u76D1\u63A7\n            monitor.startMonitoring();\n            \n            // \u751F\u6210\u6027\u80FD\u62A5\u544A\n            Thread.sleep(60000); // \u7B49\u5F851\u5206\u949F\u6536\u96C6\u6570\u636E\n            monitor.generatePerformanceReport();\n            \n            // \u6DFB\u52A0\u5173\u95ED\u94A9\u5B50\n            Runtime.getRuntime().addShutdownHook(new Thread(monitor::shutdown));\n            \n        } catch (Exception e) {\n            System.err.println("\u542F\u52A8\u6027\u80FD\u76D1\u63A7\u5931\u8D25: " + e.getMessage());\n            e.printStackTrace();\n        }\n    }\n}\n'})})]}),(0,i.jsx)(a.A,{value:"client-optimization",label:"\u5BA2\u6237\u7AEF\u4F18\u5316",children:(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",metastring:'title="\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u6027\u80FD\u4F18\u5316"',children:'import org.apache.kafka.clients.producer.*;\nimport org.apache.kafka.clients.consumer.*;\nimport org.apache.kafka.common.serialization.*;\nimport java.util.*;\nimport java.util.concurrent.*;\n\n/**\n * Kafka\u5BA2\u6237\u7AEF\u6027\u80FD\u4F18\u5316\u793A\u4F8B\n * \u5C55\u793A\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u7684\u6700\u4F73\u914D\u7F6E\u5B9E\u8DF5\n */\npublic class ClientOptimizationExample {\n    \n    /**\n     * \u9AD8\u6027\u80FD\u751F\u4EA7\u8005\u914D\u7F6E\n     */\n    public static Properties createOptimizedProducerConfig(String bootstrapServers) {\n        Properties props = new Properties();\n        \n        // \u57FA\u7840\u8FDE\u63A5\u914D\u7F6E\n        props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\n        \n        // \u53EF\u9760\u6027\u914D\u7F6E\n        props.put(ProducerConfig.ACKS_CONFIG, "1");                     // \u5E73\u8861\u6027\u80FD\u548C\u53EF\u9760\u6027\n        props.put(ProducerConfig.RETRIES_CONFIG, 3);                    // \u91CD\u8BD53\u6B21\n        props.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, 100);         // \u91CD\u8BD5\u95F4\u9694100ms\n        props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);      // \u542F\u7528\u5E42\u7B49\u6027\n        \n        // \u6279\u5904\u7406\u4F18\u5316\n        props.put(ProducerConfig.BATCH_SIZE_CONFIG, 65536);             // 64KB\u6279\u6B21\u5927\u5C0F\n        props.put(ProducerConfig.LINGER_MS_CONFIG, 20);                 // \u7B49\u5F8520ms\u6536\u96C6\u66F4\u591A\u6D88\u606F\n        props.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 134217728);      // 128MB\u7F13\u51B2\u533A\n        \n        // \u538B\u7F29\u914D\u7F6E\n        props.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");       // LZ4\u538B\u7F29\uFF0C\u5E73\u8861\u538B\u7F29\u7387\u548CCPU\n        \n        // \u7F51\u7EDC\u4F18\u5316\n        props.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 5);\n        props.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, 30000);     // \u8BF7\u6C42\u8D85\u65F630\u79D2\n        props.put(ProducerConfig.DELIVERY_TIMEOUT_MS_CONFIG, 120000);   // \u6295\u9012\u8D85\u65F62\u5206\u949F\n        \n        // \u5206\u533A\u5668\u914D\u7F6E\n        props.put(ProducerConfig.PARTITIONER_CLASS_CONFIG, "org.apache.kafka.clients.producer.RoundRobinPartitioner");\n        \n        return props;\n    }\n    \n    /**\n     * \u9AD8\u6027\u80FD\u6D88\u8D39\u8005\u914D\u7F6E\n     */\n    public static Properties createOptimizedConsumerConfig(String bootstrapServers, String groupId) {\n        Properties props = new Properties();\n        \n        // \u57FA\u7840\u8FDE\u63A5\u914D\u7F6E\n        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);\n        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());\n        \n        // \u4F4D\u79FB\u7BA1\u7406\u914D\u7F6E\n        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);     // \u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\n        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "earliest"); // \u4ECE\u6700\u65E9\u4F4D\u79FB\u5F00\u59CB\n        \n        // \u62C9\u53D6\u4F18\u5316\u914D\u7F6E\n        props.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 50000);        // \u6700\u5C0F\u62C9\u53D650KB\n        props.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, 500);        // \u6700\u5927\u7B49\u5F85500ms\n        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 1000);        // \u6BCF\u6B21\u6700\u591A\u62C9\u53D61000\u6761\n        props.put(ConsumerConfig.MAX_PARTITION_FETCH_BYTES_CONFIG, 2097152); // \u6BCF\u5206\u533A\u6700\u59272MB\n        \n        // \u4F1A\u8BDD\u548C\u5FC3\u8DF3\u914D\u7F6E\n        props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, 30000);     // \u4F1A\u8BDD\u8D85\u65F630\u79D2\n        props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 10000);  // \u5FC3\u8DF3\u95F4\u969410\u79D2\n        props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, 300000);  // \u6700\u5927poll\u95F4\u96945\u5206\u949F\n        \n        // \u5206\u533A\u5206\u914D\u7B56\u7565\n        props.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, \n                 "org.apache.kafka.clients.consumer.CooperativeStickyAssignor");\n        \n        return props;\n    }\n    \n    /**\n     * \u9AD8\u6027\u80FD\u751F\u4EA7\u8005\u5B9E\u73B0\n     */\n    public static class HighPerformanceProducer {\n        private final KafkaProducer<String, String> producer;\n        private final String topicName;\n        private final AtomicLong messageCount = new AtomicLong(0);\n        private final AtomicLong byteCount = new AtomicLong(0);\n        \n        public HighPerformanceProducer(String bootstrapServers, String topicName) {\n            this.topicName = topicName;\n            this.producer = new KafkaProducer<>(createOptimizedProducerConfig(bootstrapServers));\n        }\n        \n        /**\n         * \u5F02\u6B65\u6279\u91CF\u53D1\u9001\n         */\n        public void sendBatchAsync(List<String> messages) {\n            CountDownLatch latch = new CountDownLatch(messages.size());\n            \n            for (String message : messages) {\n                ProducerRecord<String, String> record = new ProducerRecord<>(topicName, message);\n                \n                producer.send(record, (metadata, exception) -> {\n                    if (exception == null) {\n                        messageCount.incrementAndGet();\n                        byteCount.addAndGet(message.getBytes().length);\n                    } else {\n                        System.err.println("\u53D1\u9001\u5931\u8D25: " + exception.getMessage());\n                    }\n                    latch.countDown();\n                });\n            }\n            \n            try {\n                latch.await(30, TimeUnit.SECONDS);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n        }\n        \n        /**\n         * \u83B7\u53D6\u6027\u80FD\u7EDF\u8BA1\n         */\n        public void printStats() {\n            System.out.printf("\u751F\u4EA7\u8005\u7EDF\u8BA1 - \u6D88\u606F\u6570: %d, \u5B57\u8282\u6570: %d%n", \n                             messageCount.get(), byteCount.get());\n        }\n        \n        public void close() {\n            producer.close();\n        }\n    }\n    \n    /**\n     * \u9AD8\u6027\u80FD\u6D88\u8D39\u8005\u5B9E\u73B0\n     */\n    public static class HighPerformanceConsumer {\n        private final KafkaConsumer<String, String> consumer;\n        private final ExecutorService executorService;\n        private final AtomicLong messageCount = new AtomicLong(0);\n        private final AtomicLong byteCount = new AtomicLong(0);\n        private volatile boolean running = false;\n        \n        public HighPerformanceConsumer(String bootstrapServers, String groupId, List<String> topics) {\n            this.consumer = new KafkaConsumer<>(createOptimizedConsumerConfig(bootstrapServers, groupId));\n            this.executorService = Executors.newFixedThreadPool(4); // 4\u4E2A\u5904\u7406\u7EBF\u7A0B\n            consumer.subscribe(topics);\n        }\n        \n        /**\n         * \u5F00\u59CB\u9AD8\u6027\u80FD\u6D88\u8D39\n         */\n        public void startConsuming() {\n            running = true;\n            \n            while (running) {\n                ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n                \n                if (!records.isEmpty()) {\n                    // \u6309\u5206\u533A\u5E76\u884C\u5904\u7406\n                    Map<TopicPartition, List<ConsumerRecord<String, String>>> partitionRecords = new HashMap<>();\n                    \n                    for (ConsumerRecord<String, String> record : records) {\n                        TopicPartition partition = new TopicPartition(record.topic(), record.partition());\n                        partitionRecords.computeIfAbsent(partition, k -> new ArrayList<>()).add(record);\n                    }\n                    \n                    // \u63D0\u4EA4\u5904\u7406\u4EFB\u52A1\n                    List<Future<?>> futures = new ArrayList<>();\n                    for (List<ConsumerRecord<String, String>> partitionBatch : partitionRecords.values()) {\n                        Future<?> future = executorService.submit(() -> processBatch(partitionBatch));\n                        futures.add(future);\n                    }\n                    \n                    // \u7B49\u5F85\u6240\u6709\u6279\u6B21\u5904\u7406\u5B8C\u6210\n                    for (Future<?> future : futures) {\n                        try {\n                            future.get(30, TimeUnit.SECONDS);\n                        } catch (Exception e) {\n                            System.err.println("\u6279\u6B21\u5904\u7406\u5931\u8D25: " + e.getMessage());\n                        }\n                    }\n                    \n                    // \u63D0\u4EA4\u4F4D\u79FB\n                    try {\n                        consumer.commitSync();\n                    } catch (Exception e) {\n                        System.err.println("\u4F4D\u79FB\u63D0\u4EA4\u5931\u8D25: " + e.getMessage());\n                    }\n                }\n            }\n        }\n        \n        /**\n         * \u6279\u91CF\u5904\u7406\u6D88\u606F\n         */\n        private void processBatch(List<ConsumerRecord<String, String>> batch) {\n            for (ConsumerRecord<String, String> record : batch) {\n                try {\n                    // \u6A21\u62DF\u6D88\u606F\u5904\u7406\n                    processMessage(record);\n                    \n                    messageCount.incrementAndGet();\n                    byteCount.addAndGet(record.value().getBytes().length);\n                    \n                } catch (Exception e) {\n                    System.err.println("\u5904\u7406\u6D88\u606F\u5931\u8D25: " + e.getMessage());\n                }\n            }\n        }\n        \n        private void processMessage(ConsumerRecord<String, String> record) {\n            // \u5B9E\u9645\u7684\u6D88\u606F\u5904\u7406\u903B\u8F91\n            // \u8FD9\u91CC\u53EA\u662F\u6A21\u62DF\u5904\u7406\u65F6\u95F4\n            try {\n                Thread.sleep(1);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n        }\n        \n        /**\n         * \u83B7\u53D6\u6027\u80FD\u7EDF\u8BA1\n         */\n        public void printStats() {\n            System.out.printf("\u6D88\u8D39\u8005\u7EDF\u8BA1 - \u6D88\u606F\u6570: %d, \u5B57\u8282\u6570: %d%n", \n                             messageCount.get(), byteCount.get());\n        }\n        \n        public void stop() {\n            running = false;\n            executorService.shutdown();\n            consumer.close();\n        }\n    }\n    \n    /**\n     * \u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177\n     */\n    public static class PerformanceTest {\n        \n        /**\n         * \u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\n         */\n        public static void testProducerPerformance(String bootstrapServers, String topic, \n                                                 int messageCount, int messageSize) {\n            System.out.println("\u5F00\u59CB\u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5...");\n            \n            HighPerformanceProducer producer = new HighPerformanceProducer(bootstrapServers, topic);\n            \n            // \u751F\u6210\u6D4B\u8BD5\u6D88\u606F\n            List<String> messages = new ArrayList<>();\n            String messageTemplate = "A".repeat(messageSize);\n            \n            for (int i = 0; i < messageCount; i++) {\n                messages.add(messageTemplate + "-" + i);\n            }\n            \n            // \u6027\u80FD\u6D4B\u8BD5\n            long startTime = System.currentTimeMillis();\n            \n            // \u5206\u6279\u53D1\u9001\n            int batchSize = 1000;\n            for (int i = 0; i < messages.size(); i += batchSize) {\n                int endIndex = Math.min(i + batchSize, messages.size());\n                List<String> batch = messages.subList(i, endIndex);\n                producer.sendBatchAsync(batch);\n            }\n            \n            long endTime = System.currentTimeMillis();\n            \n            // \u6253\u5370\u7ED3\u679C\n            long duration = endTime - startTime;\n            double throughput = (double) messageCount / duration * 1000; // \u6D88\u606F/\u79D2\n            double mbps = (double) messageCount * messageSize / duration / 1024; // MB/\u79D2\n            \n            System.out.printf("\u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\u7ED3\u679C:%n");\n            System.out.printf("  \u6D88\u606F\u6570\u91CF: %d%n", messageCount);\n            System.out.printf("  \u6D88\u606F\u5927\u5C0F: %d \u5B57\u8282%n", messageSize);\n            System.out.printf("  \u603B\u8017\u65F6: %d ms%n", duration);\n            System.out.printf("  \u541E\u5410\u91CF: %.2f \u6D88\u606F/\u79D2%n", throughput);\n            System.out.printf("  \u6570\u636E\u901F\u7387: %.2f MB/\u79D2%n", mbps);\n            \n            producer.close();\n        }\n        \n        /**\n         * \u6D88\u8D39\u8005\u6027\u80FD\u6D4B\u8BD5\n         */\n        public static void testConsumerPerformance(String bootstrapServers, String groupId, \n                                                 List<String> topics, int durationSeconds) {\n            System.out.println("\u5F00\u59CB\u6D88\u8D39\u8005\u6027\u80FD\u6D4B\u8BD5...");\n            \n            HighPerformanceConsumer consumer = new HighPerformanceConsumer(bootstrapServers, groupId, topics);\n            \n            // \u542F\u52A8\u6D88\u8D39\u7EBF\u7A0B\n            Thread consumerThread = new Thread(consumer::startConsuming);\n            consumerThread.start();\n            \n            // \u8FD0\u884C\u6307\u5B9A\u65F6\u95F4\n            try {\n                Thread.sleep(durationSeconds * 1000);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n            \n            // \u505C\u6B62\u6D88\u8D39\u8005\n            consumer.stop();\n            \n            try {\n                consumerThread.join();\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n            }\n            \n            // \u6253\u5370\u7ED3\u679C\n            consumer.printStats();\n        }\n    }\n    \n    public static void main(String[] args) {\n        String bootstrapServers = "localhost:9092";\n        String topic = "performance-test";\n        \n        // \u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\n        PerformanceTest.testProducerPerformance(bootstrapServers, topic, 10000, 1024);\n        \n        // \u7B49\u5F85\u4E00\u6BB5\u65F6\u95F4\n        try {\n            Thread.sleep(5000);\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n        \n        // \u6D88\u8D39\u8005\u6027\u80FD\u6D4B\u8BD5\n        PerformanceTest.testConsumerPerformance(bootstrapServers, "perf-test-group", \n                                              Arrays.asList(topic), 30);\n    }\n}\n'})})})]}),"\n",(0,i.jsx)(e.h2,{id:"6-kafka\u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u6DF1\u5EA6\u89E3\u6790",children:"6. Kafka\u9762\u8BD5\u9898\u7CBE\u9009\u4E0E\u6DF1\u5EA6\u89E3\u6790"}),"\n",(0,i.jsx)(e.h3,{id:"61-\u57FA\u7840\u6982\u5FF5\u4E0E\u67B6\u6784\u9898",children:"6.1 \u57FA\u7840\u6982\u5FF5\u4E0E\u67B6\u6784\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q1: \u8BE6\u7EC6\u89E3\u91CAKafka\u7684\u6838\u5FC3\u7EC4\u4EF6\u53CA\u5176\u4F5C\u7528\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," Kafka\u7684\u6838\u5FC3\u7EC4\u4EF6\u5305\u62EC\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Broker\uFF08\u4EE3\u7406\u670D\u52A1\u5668\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F5C\u7528\uFF1AKafka\u96C6\u7FA4\u4E2D\u7684\u670D\u52A1\u5668\u8282\u70B9\uFF0C\u8D1F\u8D23\u5B58\u50A8\u548C\u5904\u7406\u6D88\u606F"}),"\n",(0,i.jsx)(e.li,{children:"\u804C\u8D23\uFF1A\u7BA1\u7406Topic\u5206\u533A\u3001\u5904\u7406\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005\u8BF7\u6C42\u3001\u53C2\u4E0ELeader\u9009\u4E3E"}),"\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u65E0\u72B6\u6001\u8BBE\u8BA1\uFF0C\u652F\u6301\u6C34\u5E73\u6269\u5C55"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Topic\uFF08\u4E3B\u9898\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F5C\u7528\uFF1A\u6D88\u606F\u7684\u903B\u8F91\u5206\u7C7B\uFF0C\u7C7B\u4F3C\u6570\u636E\u5E93\u4E2D\u7684\u8868"}),"\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u652F\u6301\u591A\u5206\u533A\u3001\u591A\u526F\u672C\uFF0C\u63D0\u4F9B\u5E76\u884C\u5904\u7406\u80FD\u529B"}),"\n",(0,i.jsx)(e.li,{children:"\u547D\u540D\uFF1A\u5EFA\u8BAE\u4F7F\u7528\u4E1A\u52A1\u57DF.\u6570\u636E\u7C7B\u578B.\u7248\u672C\u7684\u683C\u5F0F"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Partition\uFF08\u5206\u533A\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F5C\u7528\uFF1ATopic\u7684\u7269\u7406\u5206\u5272\uFF0C\u63D0\u4F9B\u5E76\u884C\u5904\u7406\u548C\u8D1F\u8F7D\u5206\u6563"}),"\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u6709\u5E8F\u3001\u4E0D\u53EF\u53D8\u7684\u6D88\u606F\u5E8F\u5217\uFF0C\u652F\u6301\u6C34\u5E73\u6269\u5C55"}),"\n",(0,i.jsx)(e.li,{children:"\u5206\u914D\uFF1A\u901A\u8FC7\u5206\u533A\u5668\u51B3\u5B9A\u6D88\u606F\u5206\u914D\u5230\u54EA\u4E2A\u5206\u533A"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Producer\uFF08\u751F\u4EA7\u8005\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F5C\u7528\uFF1A\u5411Kafka\u53D1\u9001\u6D88\u606F\u7684\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u652F\u6301\u540C\u6B65/\u5F02\u6B65\u53D1\u9001\u3001\u6279\u5904\u7406\u3001\u538B\u7F29"}),"\n",(0,i.jsx)(e.li,{children:"\u914D\u7F6E\uFF1A\u53EF\u914D\u7F6E\u53EF\u9760\u6027\u3001\u6027\u80FD\u3001\u5206\u533A\u7B56\u7565\u7B49\u53C2\u6570"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Consumer\uFF08\u6D88\u8D39\u8005\uFF09"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F5C\u7528\uFF1A\u4ECEKafka\u8BFB\u53D6\u6D88\u606F\u7684\u5BA2\u6237\u7AEF"}),"\n",(0,i.jsx)(e.li,{children:"\u7279\u70B9\uFF1A\u652F\u6301\u6D88\u8D39\u8005\u7EC4\u3001\u4F4D\u79FB\u7BA1\u7406\u3001\u91CD\u5E73\u8861"}),"\n",(0,i.jsx)(e.li,{children:"\u6A21\u5F0F\uFF1A\u63A8\u6A21\u5F0F\uFF08\u5B9E\u9645\u662F\u62C9\u6A21\u5F0F\uFF09\u3001\u652F\u6301\u6279\u91CF\u6D88\u8D39"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q2: Kafka\u5982\u4F55\u4FDD\u8BC1\u6D88\u606F\u7684\u987A\u5E8F\u6027\uFF1F\u5728\u4EC0\u4E48\u60C5\u51B5\u4E0B\u4F1A\u51FA\u73B0\u4E71\u5E8F\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," Kafka\u7684\u6D88\u606F\u987A\u5E8F\u6027\u4FDD\u8BC1\u673A\u5236\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u533A\u7EA7\u522B\u6709\u5E8F"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Kafka\u53EA\u5728\u5355\u4E2A\u5206\u533A\u5185\u4FDD\u8BC1\u6D88\u606F\u987A\u5E8F"}),"\n",(0,i.jsx)(e.li,{children:"\u540C\u4E00\u5206\u533A\u5185\u7684\u6D88\u606F\u6309\u7167\u53D1\u9001\u987A\u5E8F\u5B58\u50A8\u548C\u6D88\u8D39"}),"\n",(0,i.jsx)(e.li,{children:"\u8DE8\u5206\u533A\u65E0\u6CD5\u4FDD\u8BC1\u5168\u5C40\u987A\u5E8F"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u7AEF\u987A\u5E8F\u4FDD\u8BC1"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u786E\u4FDD\u987A\u5E8F\u7684\u914D\u7F6E\nprops.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 1);\nprops.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\nprops.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE);\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u7AEF\u987A\u5E8F\u4FDD\u8BC1"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5355\u7EBF\u7A0B\u6D88\u8D39\u540C\u4E00\u5206\u533A"}),"\n",(0,i.jsx)(e.li,{children:"\u6309\u4F4D\u79FB\u987A\u5E8F\u5904\u7406\u6D88\u606F"}),"\n",(0,i.jsx)(e.li,{children:"\u907F\u514D\u5E76\u884C\u5904\u7406\u540C\u4E00\u5206\u533A\u7684\u6D88\u606F"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53EF\u80FD\u51FA\u73B0\u4E71\u5E8F\u7684\u60C5\u51B5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u91CD\u8BD5"}),"\uFF1A\u7F51\u7EDC\u5F02\u5E38\u5BFC\u81F4\u91CD\u8BD5\u65F6\u53EF\u80FD\u4E71\u5E8F"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u5206\u533A"}),"\uFF1A\u4E0D\u540C\u5206\u533A\u95F4\u65E0\u6CD5\u4FDD\u8BC1\u987A\u5E8F"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5E76\u884C\u6D88\u8D39"}),"\uFF1A\u591A\u7EBF\u7A0B\u5E76\u884C\u5904\u7406\u540C\u4E00\u5206\u533A\u6D88\u606F"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5F02\u6B65\u5904\u7406"}),"\uFF1A\u6D88\u8D39\u8005\u5F02\u6B65\u5904\u7406\u6D88\u606F\u65F6\u53EF\u80FD\u4E71\u5E8F"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q3: \u8BE6\u7EC6\u8BF4\u660EKafka\u7684\u526F\u672C\u673A\u5236\u548CISR\u7684\u4F5C\u7528\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," Kafka\u526F\u672C\u673A\u5236\u8BE6\u89E3\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u526F\u672C\u7C7B\u578B"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Leader\u526F\u672C"}),"\uFF1A\u5904\u7406\u6240\u6709\u8BFB\u5199\u8BF7\u6C42\uFF0C\u7EF4\u62A4\u6D88\u606F\u987A\u5E8F"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Follower\u526F\u672C"}),"\uFF1A\u88AB\u52A8\u590D\u5236Leader\u6570\u636E\uFF0C\u4E0D\u5904\u7406\u5BA2\u6237\u7AEF\u8BF7\u6C42"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"ISR\u526F\u672C"}),"\uFF1AIn-Sync Replicas\uFF0C\u4E0ELeader\u4FDD\u6301\u540C\u6B65\u7684\u526F\u672C\u96C6\u5408"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ISR\u673A\u5236"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// ISR\u76F8\u5173\u914D\u7F6E\nreplica.lag.time.max.ms=30000          // \u526F\u672C\u6700\u5927\u6EDE\u540E\u65F6\u95F4\nmin.insync.replicas=2                  // \u6700\u5C0F\u540C\u6B65\u526F\u672C\u6570\nunclean.leader.election.enable=false   // \u7981\u7528\u4E0D\u5B89\u5168Leader\u9009\u4E3E\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u526F\u672C\u540C\u6B65\u8FC7\u7A0B"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"Follower\u5411Leader\u53D1\u9001\u62C9\u53D6\u8BF7\u6C42"}),"\n",(0,i.jsx)(e.li,{children:"Leader\u8FD4\u56DE\u6D88\u606F\u6570\u636E"}),"\n",(0,i.jsx)(e.li,{children:"Follower\u5199\u5165\u672C\u5730\u65E5\u5FD7"}),"\n",(0,i.jsx)(e.li,{children:"Follower\u53D1\u9001\u786E\u8BA4\u7ED9Leader"}),"\n",(0,i.jsx)(e.li,{children:"Leader\u66F4\u65B0\u9AD8\u6C34\u4F4D\u6807\u8BB0"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"ISR\u7BA1\u7406"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u526F\u672C\u6EDE\u540E\u8D85\u8FC7",(0,i.jsx)(e.code,{children:"replica.lag.time.max.ms"}),"\u4F1A\u88AB\u79FB\u51FAISR"]}),"\n",(0,i.jsx)(e.li,{children:"\u526F\u672C\u8FFD\u4E0A\u8FDB\u5EA6\u540E\u4F1A\u91CD\u65B0\u52A0\u5165ISR"}),"\n",(0,i.jsx)(e.li,{children:"\u53EA\u6709ISR\u4E2D\u7684\u526F\u672C\u624D\u80FD\u88AB\u9009\u4E3A\u65B0Leader"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"62-\u6027\u80FD\u4F18\u5316\u4E0E\u8C03\u4F18\u9898",children:"6.2 \u6027\u80FD\u4F18\u5316\u4E0E\u8C03\u4F18\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q4: \u5982\u4F55\u4F18\u5316Kafka\u7684\u541E\u5410\u91CF\uFF1F\u4ECE\u54EA\u4E9B\u65B9\u9762\u5165\u624B\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," Kafka\u541E\u5410\u91CF\u4F18\u5316\u7B56\u7565\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u9AD8\u541E\u5410\u91CF\u751F\u4EA7\u8005\u914D\u7F6E\nprops.put(ProducerConfig.BATCH_SIZE_CONFIG, 65536);        // \u589E\u5927\u6279\u6B21\nprops.put(ProducerConfig.LINGER_MS_CONFIG, 100);           // \u589E\u52A0\u7B49\u5F85\u65F6\u95F4\nprops.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");  // \u542F\u7528\u538B\u7F29\nprops.put(ProducerConfig.ACKS_CONFIG, "1");                // \u964D\u4F4E\u786E\u8BA4\u7EA7\u522B\nprops.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 134217728); // \u589E\u5927\u7F13\u51B2\u533A\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9AD8\u541E\u5410\u91CF\u6D88\u8D39\u8005\u914D\u7F6E\nprops.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 100000);     // \u589E\u5927\u62C9\u53D6\u5927\u5C0F\nprops.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 2000);      // \u589E\u52A0\u62C9\u53D6\u8BB0\u5F55\u6570\nprops.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, 500);      // \u9002\u5F53\u7B49\u5F85\u65F6\u95F4\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Broker\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u589E\u52A0\u7F51\u7EDC\u548CI/O\u7EBF\u7A0B\nnum.network.threads=16\nnum.io.threads=32\n\n# \u4F18\u5316\u65E5\u5FD7\u914D\u7F6E\nlog.segment.bytes=1073741824\nlog.flush.interval.messages=10000\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u786C\u4EF6\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528SSD\u5B58\u50A8\u63D0\u9AD8I/O\u6027\u80FD"}),"\n",(0,i.jsx)(e.li,{children:"\u589E\u52A0\u7F51\u7EDC\u5E26\u5BBD\uFF08\u4E07\u5146\u7F51\u5361\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u4F18\u5316JVM\u53C2\u6570\u548CGC\u7B56\u7565"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u591A\u78C1\u76D8\u5206\u6563I/O\u8D1F\u8F7D"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q5: Kafka\u6D88\u606F\u4E22\u5931\u7684\u573A\u666F\u6709\u54EA\u4E9B\uFF1F\u5982\u4F55\u907F\u514D\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," Kafka\u6D88\u606F\u4E22\u5931\u573A\u666F\u53CA\u89E3\u51B3\u65B9\u6848\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u7AEF\u4E22\u5931"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u573A\u666F\uFF1A\u7F51\u7EDC\u5F02\u5E38\u3001Broker\u6545\u969C\u3001\u7F13\u51B2\u533A\u6EE1\n// \u89E3\u51B3\u65B9\u6848\uFF1A\nprops.put(ProducerConfig.ACKS_CONFIG, "all");              // \u7B49\u5F85\u6240\u6709\u526F\u672C\u786E\u8BA4\nprops.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE); // \u65E0\u9650\u91CD\u8BD5\nprops.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);   // \u542F\u7528\u5E42\u7B49\u6027\nprops.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 1); // \u4FDD\u8BC1\u987A\u5E8F\n\n// \u540C\u6B65\u53D1\u9001\u786E\u4FDD\u6D88\u606F\u9001\u8FBE\nRecordMetadata metadata = producer.send(record).get();\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Broker\u7AEF\u4E22\u5931"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u573A\u666F\uFF1A\u78C1\u76D8\u6545\u969C\u3001\u526F\u672C\u4E0D\u8DB3\u3001\u4E0D\u5B89\u5168Leader\u9009\u4E3E\n# \u89E3\u51B3\u65B9\u6848\uFF1A\ndefault.replication.factor=3           # \u589E\u52A0\u526F\u672C\u56E0\u5B50\nmin.insync.replicas=2                  # \u8BBE\u7F6E\u6700\u5C0F\u540C\u6B65\u526F\u672C\nunclean.leader.election.enable=false   # \u7981\u7528\u4E0D\u5B89\u5168\u9009\u4E3E\nlog.flush.interval.messages=1          # \u5F3A\u5236\u5237\u76D8\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u7AEF\u4E22\u5931"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u573A\u666F\uFF1A\u81EA\u52A8\u63D0\u4EA4\u4F4D\u79FB\u3001\u5904\u7406\u5F02\u5E38\u672A\u5904\u7406\n// \u89E3\u51B3\u65B9\u6848\uFF1A\nprops.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false); // \u7981\u7528\u81EA\u52A8\u63D0\u4EA4\n\n// \u624B\u52A8\u63D0\u4EA4\u4F4D\u79FB\nwhile (true) {\n    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));\n    for (ConsumerRecord<String, String> record : records) {\n        try {\n            processMessage(record); // \u5904\u7406\u6D88\u606F\n        } catch (Exception e) {\n            // \u5904\u7406\u5F02\u5E38\uFF0C\u51B3\u5B9A\u662F\u5426\u8DF3\u8FC7\u6216\u91CD\u8BD5\n            handleException(record, e);\n        }\n    }\n    consumer.commitSync(); // \u5904\u7406\u5B8C\u6210\u540E\u63D0\u4EA4\u4F4D\u79FB\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"63-\u67B6\u6784\u8BBE\u8BA1\u4E0E\u5B9E\u6218\u9898",children:"6.3 \u67B6\u6784\u8BBE\u8BA1\u4E0E\u5B9E\u6218\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q6: \u8BBE\u8BA1\u4E00\u4E2A\u9AD8\u53EF\u7528\u7684Kafka\u96C6\u7FA4\u67B6\u6784\uFF0C\u9700\u8981\u8003\u8651\u54EA\u4E9B\u56E0\u7D20\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," \u9AD8\u53EF\u7528Kafka\u96C6\u7FA4\u8BBE\u8BA1\u8981\u70B9\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u96C6\u7FA4\u89C4\u5212"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u6700\u5C0F3\u8282\u70B9\u96C6\u7FA4\uFF08\u5947\u6570\u8282\u70B9\uFF09\nBroker-1: 192.168.1.101:9092\nBroker-2: 192.168.1.102:9092  \nBroker-3: 192.168.1.103:9092\n\n# ZooKeeper\u96C6\u7FA4\uFF083\u62165\u8282\u70B9\uFF09\nZK-1: 192.168.1.201:2181\nZK-2: 192.168.1.202:2181\nZK-3: 192.168.1.203:2181\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u526F\u672C\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u526F\u672C\u56E0\u5B50\u548CISR\u914D\u7F6E\ndefault.replication.factor=3\nmin.insync.replicas=2\nunclean.leader.election.enable=false\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7F51\u7EDC\u548C\u5B58\u50A8"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u8DE8\u673A\u67B6\u90E8\u7F72\uFF0C\u907F\u514D\u5355\u70B9\u6545\u969C"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u4E13\u7528\u7F51\u7EDC\uFF0C\u4FDD\u8BC1\u7F51\u7EDC\u7A33\u5B9A\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u591A\u78C1\u76D8RAID\u914D\u7F6E\uFF0C\u63D0\u9AD8\u5B58\u50A8\u53EF\u9760\u6027"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u671F\u5907\u4EFD\u91CD\u8981\u6570\u636E"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u76D1\u63A7\u544A\u8B66"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u5173\u952E\u6307\u6807\u76D1\u63A7\n- Broker\u5B58\u6D3B\u72B6\u6001\n- \u5206\u533ALeader\u5206\u5E03\n- ISR\u526F\u672C\u72B6\u6001\n- \u6D88\u606F\u79EF\u538B\u60C5\u51B5\n- \u78C1\u76D8\u4F7F\u7528\u7387\n- \u7F51\u7EDC\u5EF6\u8FDF\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6545\u969C\u6062\u590D"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u5236\u5B9A\u6545\u969C\u6062\u590D\u6D41\u7A0B"}),"\n",(0,i.jsx)(e.li,{children:"\u5B9A\u671F\u6F14\u7EC3\u6545\u969C\u5207\u6362"}),"\n",(0,i.jsx)(e.li,{children:"\u51C6\u5907\u5907\u7528\u786C\u4EF6\u8D44\u6E90"}),"\n",(0,i.jsx)(e.li,{children:"\u5EFA\u7ACB\u8FD0\u7EF4\u6587\u6863"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q7: \u5982\u4F55\u8BBE\u8BA1\u4E00\u4E2A\u652F\u6301\u767E\u4E07\u7EA7TPS\u7684Kafka\u6D88\u606F\u7CFB\u7EDF\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," \u767E\u4E07\u7EA7TPS Kafka\u7CFB\u7EDF\u8BBE\u8BA1\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u786C\u4EF6\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u670D\u52A1\u5668\u914D\u7F6E\uFF08\u6BCF\u53F0\uFF09\nCPU: 32\u6838\u5FC3 2.4GHz\n\u5185\u5B58: 128GB\n\u5B58\u50A8: 8\u57572TB NVMe SSD RAID10\n\u7F51\u7EDC: \u53CC\u4E07\u5146\u7F51\u5361\u7ED1\u5B9A\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u96C6\u7FA4\u89C4\u6A21"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u96C6\u7FA4\u914D\u7F6E\nBroker\u6570\u91CF: 12\u53F0\nZooKeeper: 5\u53F0\n\u5206\u533A\u603B\u6570: 1000+\n\u526F\u672C\u56E0\u5B50: 3\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Topic\u8BBE\u8BA1"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9AD8\u5E76\u53D1Topic\u914D\u7F6E\n\u5206\u533A\u6570: 100\u4E2A\u5206\u533A\uFF08\u652F\u6301100\u4E2A\u5E76\u53D1\u6D88\u8D39\u8005\uFF09\n\u526F\u672C\u56E0\u5B50: 3\n\u538B\u7F29\u7C7B\u578B: lz4\n\u6E05\u7406\u7B56\u7565: delete\n\u4FDD\u7559\u65F6\u95F4: 3\u5929\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'// \u9AD8\u6027\u80FD\u751F\u4EA7\u8005\u914D\u7F6E\nprops.put(ProducerConfig.BATCH_SIZE_CONFIG, 131072);       // 128KB\u6279\u6B21\nprops.put(ProducerConfig.LINGER_MS_CONFIG, 50);            // 50ms\u7B49\u5F85\nprops.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 268435456); // 256MB\u7F13\u51B2\u533A\nprops.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");\nprops.put(ProducerConfig.ACKS_CONFIG, "1");                // \u5E73\u8861\u6027\u80FD\u548C\u53EF\u9760\u6027\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u9AD8\u6027\u80FD\u6D88\u8D39\u8005\u914D\u7F6E\nprops.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 1048576);    // 1MB\u6700\u5C0F\u62C9\u53D6\nprops.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 5000);      // 5000\u6761\u8BB0\u5F55\nprops.put(ConsumerConfig.MAX_PARTITION_FETCH_BYTES_CONFIG, 10485760); // 10MB\u5206\u533A\u62C9\u53D6\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7CFB\u7EDF\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u64CD\u4F5C\u7CFB\u7EDF\u4F18\u5316\nvm.swappiness=1\nvm.dirty_ratio=80\nnet.core.rmem_max=134217728\nnet.core.wmem_max=134217728\n\n# JVM\u4F18\u5316\n-Xmx12g -Xms12g\n-XX:+UseG1GC\n-XX:MaxGCPauseMillis=20\n"})}),"\n",(0,i.jsx)(e.h3,{id:"64-\u6545\u969C\u6392\u67E5\u4E0E\u8FD0\u7EF4\u9898",children:"6.4 \u6545\u969C\u6392\u67E5\u4E0E\u8FD0\u7EF4\u9898"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q8: Kafka\u96C6\u7FA4\u51FA\u73B0\u6D88\u606F\u79EF\u538B\uFF0C\u5982\u4F55\u6392\u67E5\u548C\u89E3\u51B3\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," \u6D88\u606F\u79EF\u538B\u6392\u67E5\u548C\u89E3\u51B3\u65B9\u6848\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6392\u67E5\u6B65\u9AA4"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# 1. \u68C0\u67E5\u6D88\u8D39\u8005\u7EC4\u72B6\u6001\nkafka-consumer-groups.sh --bootstrap-server localhost:9092 \\\n  --group my-group --describe\n\n# 2. \u67E5\u770BTopic\u5206\u533A\u72B6\u6001\nkafka-topics.sh --bootstrap-server localhost:9092 \\\n  --topic my-topic --describe\n\n# 3. \u68C0\u67E5Broker\u6027\u80FD\u6307\u6807\n# \u901A\u8FC7JMX\u76D1\u63A7\u6216Kafka Manager\u67E5\u770B\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5E38\u89C1\u539F\u56E0\u53CA\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u6027\u80FD\u4E0D\u8DB3"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u89E3\u51B3\u65B9\u6848\uFF1A\n1. \u589E\u52A0\u6D88\u8D39\u8005\u5B9E\u4F8B\u6570\u91CF\n2. \u4F18\u5316\u6D88\u8D39\u8005\u914D\u7F6E\nprops.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 1000);\nprops.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 50000);\n\n3. \u5E76\u884C\u5904\u7406\u6D88\u606F\nExecutorService executor = Executors.newFixedThreadPool(10);\nfor (ConsumerRecord<String, String> record : records) {\n    executor.submit(() -> processMessage(record));\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u533A\u6570\u91CF\u4E0D\u8DB3"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u589E\u52A0\u5206\u533A\u6570\u91CF\nkafka-topics.sh --bootstrap-server localhost:9092 \\\n  --topic my-topic --alter --partitions 20\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u5904\u7406\u903B\u8F91\u6162"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// \u4F18\u5316\u5904\u7406\u903B\u8F91\n1. \u5F02\u6B65\u5904\u7406\u975E\u5173\u952E\u903B\u8F91\n2. \u6279\u91CF\u5904\u7406\u6570\u636E\u5E93\u64CD\u4F5C\n3. \u4F7F\u7528\u7F13\u5B58\u51CF\u5C11\u5916\u90E8\u8C03\u7528\n4. \u4F18\u5316\u7B97\u6CD5\u548C\u6570\u636E\u7ED3\u6784\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7F51\u7EDC\u6216\u78C1\u76D8I/O\u74F6\u9888"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u68C0\u67E5\u7CFB\u7EDF\u8D44\u6E90\niostat -x 1\nsar -n DEV 1\ntop -p $(pgrep java)\n\n# \u4F18\u5316\u5EFA\u8BAE\n1. \u5347\u7EA7\u786C\u4EF6\u914D\u7F6E\n2. \u4F18\u5316\u7F51\u7EDC\u914D\u7F6E\n3. \u4F7F\u7528SSD\u5B58\u50A8\n4. \u8C03\u6574JVM\u53C2\u6570\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Q9: \u5982\u4F55\u76D1\u63A7Kafka\u96C6\u7FA4\u7684\u5065\u5EB7\u72B6\u6001\uFF1F"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"A:"})," Kafka\u96C6\u7FA4\u76D1\u63A7\u4F53\u7CFB\uFF1A"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5173\u952E\u6307\u6807\u76D1\u63A7"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"// JMX\u6307\u6807\u76D1\u63A7\n1. \u541E\u5410\u91CF\u6307\u6807\n   - MessagesInPerSec: \u6D88\u606F\u8F93\u5165\u901F\u7387\n   - BytesInPerSec: \u5B57\u8282\u8F93\u5165\u901F\u7387\n   - BytesOutPerSec: \u5B57\u8282\u8F93\u51FA\u901F\u7387\n\n2. \u5EF6\u8FDF\u6307\u6807\n   - ProduceRequestTime: \u751F\u4EA7\u8BF7\u6C42\u65F6\u95F4\n   - FetchRequestTime: \u62C9\u53D6\u8BF7\u6C42\u65F6\u95F4\n   - NetworkProcessorAvgIdlePercent: \u7F51\u7EDC\u5904\u7406\u5668\u7A7A\u95F2\u7387\n\n3. \u53EF\u7528\u6027\u6307\u6807\n   - UnderReplicatedPartitions: \u672A\u5145\u5206\u590D\u5236\u7684\u5206\u533A\n   - OfflinePartitionsCount: \u79BB\u7EBF\u5206\u533A\u6570\u91CF\n   - ActiveControllerCount: \u6D3B\u8DC3\u63A7\u5236\u5668\u6570\u91CF\n\n4. \u8D44\u6E90\u6307\u6807\n   - JVM\u5806\u5185\u5B58\u4F7F\u7528\u7387\n   - GC\u9891\u7387\u548C\u65F6\u95F4\n   - \u78C1\u76D8\u4F7F\u7528\u7387\n   - \u7F51\u7EDCI/O\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u76D1\u63A7\u5DE5\u5177\u9009\u62E9"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5F00\u6E90\u76D1\u63A7\u65B9\u6848\n1. Kafka Manager (CMAK)\n2. Kafka Eagle\n3. Prometheus + Grafana\n4. ELK Stack\n\n# \u5546\u4E1A\u76D1\u63A7\u65B9\u6848\n1. Confluent Control Center\n2. DataDog\n3. New Relic\n4. AppDynamics\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u544A\u8B66\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'# Prometheus\u544A\u8B66\u89C4\u5219\u793A\u4F8B\ngroups:\n- name: kafka.rules\n  rules:\n  - alert: KafkaBrokerDown\n    expr: up{job="kafka"} == 0\n    for: 1m\n    labels:\n      severity: critical\n    annotations:\n      summary: "Kafka broker is down"\n      \n  - alert: KafkaUnderReplicatedPartitions\n    expr: kafka_server_replicamanager_underreplicatedpartitions > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: "Kafka has under-replicated partitions"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"7-kafka\u5B9E\u6218\u9879\u76EE\u6848\u4F8B",children:"7. Kafka\u5B9E\u6218\u9879\u76EE\u6848\u4F8B"}),"\n",(0,i.jsx)(e.h3,{id:"71-\u7535\u5546\u8BA2\u5355\u5904\u7406\u7CFB\u7EDF",children:"7.1 \u7535\u5546\u8BA2\u5355\u5904\u7406\u7CFB\u7EDF"}),"\n",(0,i.jsx)(e.p,{children:"\u8FD9\u662F\u4E00\u4E2A\u57FA\u4E8E Kafka \u7684\u5B8C\u6574\u7535\u5546\u8BA2\u5355\u5904\u7406\u7CFB\u7EDF\uFF0C\u5C55\u793A\u4E86 Kafka \u5728\u5B9E\u9645\u4E1A\u52A1\u573A\u666F\u4E2D\u7684\u5E94\u7528\u3002"}),"\n",(0,i.jsx)(e.h4,{id:"711-\u7CFB\u7EDF\u67B6\u6784\u8BBE\u8BA1",children:"7.1.1 \u7CFB\u7EDF\u67B6\u6784\u8BBE\u8BA1"}),"\n",(0,i.jsx)(e.mermaid,{value:'graph TB\n    subgraph "\u524D\u7AEF\u5C42"\n        A[\u7528\u6237\u4E0B\u5355] --\x3e B[\u8BA2\u5355\u670D\u52A1]\n        C[\u652F\u4ED8\u670D\u52A1] --\x3e D[\u5E93\u5B58\u670D\u52A1]\n    end\n    \n    subgraph "Kafka\u6D88\u606F\u5C42"\n        E[\u8BA2\u5355\u4E8B\u4EF6Topic]\n        F[\u652F\u4ED8\u4E8B\u4EF6Topic] \n        G[\u5E93\u5B58\u4E8B\u4EF6Topic]\n        H[\u901A\u77E5\u4E8B\u4EF6Topic]\n    end\n    \n    subgraph "\u4E1A\u52A1\u5904\u7406\u5C42"\n        I[\u8BA2\u5355\u5904\u7406\u5668]\n        J[\u652F\u4ED8\u5904\u7406\u5668]\n        K[\u5E93\u5B58\u5904\u7406\u5668]\n        L[\u901A\u77E5\u5904\u7406\u5668]\n    end\n    \n    subgraph "\u6570\u636E\u5B58\u50A8\u5C42"\n        M[\u8BA2\u5355\u6570\u636E\u5E93]\n        N[\u5E93\u5B58\u6570\u636E\u5E93]\n        O[\u7528\u6237\u6570\u636E\u5E93]\n    end\n    \n    B --\x3e E\n    C --\x3e F\n    D --\x3e G\n    \n    E --\x3e I\n    F --\x3e J\n    G --\x3e K\n    H --\x3e L\n    \n    I --\x3e M\n    J --\x3e M\n    K --\x3e N\n    L --\x3e O'}),"\n",(0,i.jsx)(e.h4,{id:"712-\u9879\u76EE\u7ED3\u6784",children:"7.1.2 \u9879\u76EE\u7ED3\u6784"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"ecommerce-kafka-system/\n\u251C\u2500\u2500 pom.xml\n\u251C\u2500\u2500 src/main/java/com/ecommerce/\n\u2502   \u251C\u2500\u2500 config/\n\u2502   \u2502   \u251C\u2500\u2500 KafkaConfig.java\n\u2502   \u2502   \u2514\u2500\u2500 DatabaseConfig.java\n\u2502   \u251C\u2500\u2500 model/\n\u2502   \u2502   \u251C\u2500\u2500 Order.java\n\u2502   \u2502   \u251C\u2500\u2500 Payment.java\n\u2502   \u2502   \u2514\u2500\u2500 Inventory.java\n\u2502   \u251C\u2500\u2500 producer/\n\u2502   \u2502   \u251C\u2500\u2500 OrderEventProducer.java\n\u2502   \u2502   \u2514\u2500\u2500 PaymentEventProducer.java\n\u2502   \u251C\u2500\u2500 consumer/\n\u2502   \u2502   \u251C\u2500\u2500 OrderEventConsumer.java\n\u2502   \u2502   \u2514\u2500\u2500 PaymentEventConsumer.java\n\u2502   \u251C\u2500\u2500 service/\n\u2502   \u2502   \u251C\u2500\u2500 OrderService.java\n\u2502   \u2502   \u2514\u2500\u2500 PaymentService.java\n\u2502   \u2514\u2500\u2500 controller/\n\u2502       \u2514\u2500\u2500 OrderController.java\n\u251C\u2500\u2500 src/main/resources/\n\u2502   \u251C\u2500\u2500 application.yml\n\u2502   \u2514\u2500\u2500 logback-spring.xml\n\u2514\u2500\u2500 docker-compose.yml\n"})}),"\n",(0,i.jsx)(e.h4,{id:"713-\u6838\u5FC3\u4EE3\u7801\u5B9E\u73B0",children:"7.1.3 \u6838\u5FC3\u4EE3\u7801\u5B9E\u73B0"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8BA2\u5355\u4E8B\u4EF6\u6A21\u578B"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\npublic class OrderEvent {\n    private String orderId;\n    private String userId;\n    private String productId;\n    private Integer quantity;\n    private BigDecimal amount;\n    private OrderStatus status;\n    private LocalDateTime timestamp;\n    private String correlationId; // \u7528\u4E8E\u8FFD\u8E2A\u6D88\u606F\u94FE\u8DEF\n    \n    public enum OrderStatus {\n        CREATED, PAID, SHIPPED, DELIVERED, CANCELLED\n    }\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8BA2\u5355\u4E8B\u4EF6\u751F\u4EA7\u8005"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class OrderEventProducer {\n    \n    @Autowired\n    private KafkaTemplate<String, OrderEvent> kafkaTemplate;\n    \n    @Value("${kafka.topic.order}")\n    private String orderTopic;\n    \n    public void sendOrderEvent(OrderEvent orderEvent) {\n        try {\n            // \u8BBE\u7F6E\u6D88\u606F\u5934\n            ProducerRecord<String, OrderEvent> record = new ProducerRecord<>(\n                orderTopic, \n                orderEvent.getOrderId(), \n                orderEvent\n            );\n            \n            // \u6DFB\u52A0\u6D88\u606F\u5934\u7528\u4E8E\u8FFD\u8E2A\n            record.headers().add("correlation-id", \n                orderEvent.getCorrelationId().getBytes());\n            record.headers().add("event-type", \n                "ORDER_CREATED".getBytes());\n            \n            // \u5F02\u6B65\u53D1\u9001\n            kafkaTemplate.send(record).addCallback(\n                result -> {\n                    if (result != null) {\n                        log.info("\u8BA2\u5355\u4E8B\u4EF6\u53D1\u9001\u6210\u529F: orderId={}, partition={}, offset={}", \n                            orderEvent.getOrderId(),\n                            result.getRecordMetadata().partition(),\n                            result.getRecordMetadata().offset());\n                    }\n                },\n                failure -> {\n                    log.error("\u8BA2\u5355\u4E8B\u4EF6\u53D1\u9001\u5931\u8D25: orderId={}, error={}", \n                        orderEvent.getOrderId(), failure.getMessage());\n                    // \u5B9E\u73B0\u91CD\u8BD5\u673A\u5236\n                    retrySendOrderEvent(orderEvent);\n                }\n            );\n            \n        } catch (Exception e) {\n            log.error("\u53D1\u9001\u8BA2\u5355\u4E8B\u4EF6\u5F02\u5E38: {}", e.getMessage(), e);\n            throw new RuntimeException("\u53D1\u9001\u8BA2\u5355\u4E8B\u4EF6\u5931\u8D25", e);\n        }\n    }\n    \n    private void retrySendOrderEvent(OrderEvent orderEvent) {\n        // \u5B9E\u73B0\u6307\u6570\u9000\u907F\u91CD\u8BD5\n        CompletableFuture.delayedExecutor(1, TimeUnit.SECONDS)\n            .execute(() -> sendOrderEvent(orderEvent));\n    }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8BA2\u5355\u4E8B\u4EF6\u6D88\u8D39\u8005"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class OrderEventConsumer {\n    \n    @Autowired\n    private OrderService orderService;\n    \n    @Autowired\n    private PaymentEventProducer paymentEventProducer;\n    \n    @KafkaListener(\n        topics = "${kafka.topic.order}",\n        groupId = "order-processing-group",\n        containerFactory = "kafkaListenerContainerFactory"\n    )\n    public void handleOrderEvent(\n            @Payload OrderEvent orderEvent,\n            @Header(KafkaHeaders.RECEIVED_TOPIC) String topic,\n            @Header(KafkaHeaders.RECEIVED_PARTITION_ID) int partition,\n            @Header(KafkaHeaders.OFFSET) long offset,\n            @Header("correlation-id") String correlationId) {\n        \n        try {\n            log.info("\u63A5\u6536\u5230\u8BA2\u5355\u4E8B\u4EF6: orderId={}, partition={}, offset={}", \n                orderEvent.getOrderId(), partition, offset);\n            \n            // \u5E42\u7B49\u6027\u68C0\u67E5\n            if (orderService.isOrderProcessed(orderEvent.getOrderId())) {\n                log.warn("\u8BA2\u5355\u5DF2\u5904\u7406\uFF0C\u8DF3\u8FC7: orderId={}", orderEvent.getOrderId());\n                return;\n            }\n            \n            // \u4E1A\u52A1\u5904\u7406\n            processOrderEvent(orderEvent);\n            \n            // \u624B\u52A8\u63D0\u4EA4\u504F\u79FB\u91CF\n            // \u6CE8\u610F\uFF1A\u8FD9\u91CC\u9700\u8981\u6839\u636E\u5B9E\u9645\u914D\u7F6E\u51B3\u5B9A\u662F\u5426\u624B\u52A8\u63D0\u4EA4\n            \n        } catch (Exception e) {\n            log.error("\u5904\u7406\u8BA2\u5355\u4E8B\u4EF6\u5931\u8D25: orderId={}, error={}", \n                orderEvent.getOrderId(), e.getMessage(), e);\n            \n            // \u5B9E\u73B0\u6B7B\u4FE1\u961F\u5217\u5904\u7406\n            handleFailedOrderEvent(orderEvent, e);\n        }\n    }\n    \n    private void processOrderEvent(OrderEvent orderEvent) {\n        // 1. \u9A8C\u8BC1\u8BA2\u5355\n        validateOrder(orderEvent);\n        \n        // 2. \u68C0\u67E5\u5E93\u5B58\n        checkInventory(orderEvent);\n        \n        // 3. \u521B\u5EFA\u652F\u4ED8\u4E8B\u4EF6\n        PaymentEvent paymentEvent = PaymentEvent.builder()\n            .orderId(orderEvent.getOrderId())\n            .amount(orderEvent.getAmount())\n            .userId(orderEvent.getUserId())\n            .correlationId(orderEvent.getCorrelationId())\n            .build();\n        \n        // 4. \u53D1\u9001\u652F\u4ED8\u4E8B\u4EF6\n        paymentEventProducer.sendPaymentEvent(paymentEvent);\n        \n        // 5. \u66F4\u65B0\u8BA2\u5355\u72B6\u6001\n        orderService.updateOrderStatus(orderEvent.getOrderId(), \n            OrderEvent.OrderStatus.PENDING_PAYMENT);\n    }\n    \n    private void handleFailedOrderEvent(OrderEvent orderEvent, Exception e) {\n        // \u53D1\u9001\u5230\u6B7B\u4FE1\u961F\u5217\u6216\u9519\u8BEF\u5904\u7406Topic\n        log.error("\u8BA2\u5355\u5904\u7406\u5931\u8D25\uFF0C\u53D1\u9001\u5230\u9519\u8BEF\u5904\u7406\u961F\u5217: orderId={}", \n            orderEvent.getOrderId());\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"714-\u914D\u7F6E\u7BA1\u7406",children:"7.1.4 \u914D\u7F6E\u7BA1\u7406"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"application.yml"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'spring:\n  kafka:\n    bootstrap-servers: localhost:9092\n    producer:\n      key-serializer: org.apache.kafka.common.serialization.StringSerializer\n      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer\n      acks: all\n      retries: 3\n      batch-size: 16384\n      linger-ms: 5\n      buffer-memory: 33554432\n      properties:\n        enable.idempotence: true\n        max.in.flight.requests.per.connection: 5\n    consumer:\n      group-id: ecommerce-group\n      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer\n      auto-offset-reset: earliest\n      enable-auto-commit: false\n      properties:\n        spring.json.trusted.packages: "com.ecommerce.model"\n        max.poll.records: 500\n        session.timeout.ms: 30000\n        heartbeat.interval.ms: 10000\n    listener:\n      ack-mode: manual_immediate\n      concurrency: 3\n      missing-topics-fatal: false\n\nkafka:\n  topic:\n    order: order-events\n    payment: payment-events\n    inventory: inventory-events\n    notification: notification-events\n    dlq: dead-letter-queue\n'})}),"\n",(0,i.jsx)(e.h4,{id:"715-docker\u90E8\u7F72\u914D\u7F6E",children:"7.1.5 Docker\u90E8\u7F72\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"docker-compose.yml"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  zookeeper:\n    image: confluentinc/cp-zookeeper:7.4.0\n    hostname: zookeeper\n    container_name: zookeeper\n    ports:\n      - "2181:2181"\n    environment:\n      ZOOKEEPER_CLIENT_PORT: 2181\n      ZOOKEEPER_TICK_TIME: 2000\n\n  kafka:\n    image: confluentinc/cp-kafka:7.4.0\n    hostname: kafka\n    container_name: kafka\n    depends_on:\n      - zookeeper\n    ports:\n      - "9092:9092"\n      - "9101:9101"\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ZOOKEEPER_CONNECT: \'zookeeper:2181\'\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:29092,PLAINTEXT_HOST://localhost:9092\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1\n      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1\n      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1\n      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0\n      KAFKA_JMX_PORT: 9101\n      KAFKA_JMX_HOSTNAME: localhost\n\n  kafka-ui:\n    image: provectuslabs/kafka-ui:latest\n    container_name: kafka-ui\n    depends_on:\n      - kafka\n    ports:\n      - "8080:8080"\n    environment:\n      KAFKA_CLUSTERS_0_NAME: local\n      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka:29092\n\n  mysql:\n    image: mysql:8.0\n    container_name: mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: root\n      MYSQL_DATABASE: ecommerce\n    ports:\n      - "3306:3306"\n    volumes:\n      - mysql_data:/var/lib/mysql\n\nvolumes:\n  mysql_data:\n'})}),"\n",(0,i.jsx)(e.h4,{id:"716-\u76D1\u63A7\u548C\u544A\u8B66",children:"7.1.6 \u76D1\u63A7\u548C\u544A\u8B66"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Prometheus\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# prometheus.yml\nglobal:\n  scrape_interval: 15s\n\nscrape_configs:\n  - job_name: 'kafka'\n    static_configs:\n      - targets: ['kafka:9092']\n    metrics_path: /metrics\n    scrape_interval: 5s\n\n  - job_name: 'kafka-jmx'\n    static_configs:\n      - targets: ['kafka:9101']\n    scrape_interval: 5s\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Grafana\u4EEA\u8868\u677F"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "dashboard": {\n    "title": "Kafka\u7535\u5546\u7CFB\u7EDF\u76D1\u63A7",\n    "panels": [\n      {\n        "title": "\u6D88\u606F\u751F\u4EA7\u901F\u7387",\n        "type": "graph",\n        "targets": [\n          {\n            "expr": "rate(kafka_server_brokertopicmetrics_messagesin_total[5m])",\n            "legendFormat": "{{topic}}"\n          }\n        ]\n      },\n      {\n        "title": "\u6D88\u8D39\u8005\u5EF6\u8FDF",\n        "type": "graph", \n        "targets": [\n          {\n            "expr": "kafka_consumer_lag_sum",\n            "legendFormat": "{{consumer_group}}"\n          }\n        ]\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"72-\u6027\u80FD\u6D4B\u8BD5\u5B9E\u8DF5",children:"7.2 \u6027\u80FD\u6D4B\u8BD5\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.h4,{id:"721-\u538B\u529B\u6D4B\u8BD5\u811A\u672C",children:"7.2.1 \u538B\u529B\u6D4B\u8BD5\u811A\u672C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"#!/bin/bash\n# kafka-performance-test.sh\n\n# \u6D4B\u8BD5\u751F\u4EA7\u8005\u6027\u80FD\nkafka-producer-perf-test.sh \\\n  --topic order-events \\\n  --num-records 1000000 \\\n  --record-size 1024 \\\n  --throughput 10000 \\\n  --producer-props bootstrap.servers=localhost:9092 \\\n  --producer-props acks=all \\\n  --producer-props retries=3\n\n# \u6D4B\u8BD5\u6D88\u8D39\u8005\u6027\u80FD  \nkafka-consumer-perf-test.sh \\\n  --topic order-events \\\n  --bootstrap-server localhost:9092 \\\n  --messages 1000000 \\\n  --threads 4\n"})}),"\n",(0,i.jsx)(e.h4,{id:"722-jmeter\u6D4B\u8BD5\u8BA1\u5212",children:"7.2.2 JMeter\u6D4B\u8BD5\u8BA1\u5212"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<jmeterTestPlan version="1.2">\n  <hashTree>\n    <TestPlan testname="Kafka\u6027\u80FD\u6D4B\u8BD5">\n      <elementProp name="TestPlan.arguments" elementType="Arguments" guiclass="ArgumentsPanel">\n        <collectionProp name="Arguments.arguments"/>\n      </elementProp>\n      <stringProp name="TestPlan.user_define_classpath"></stringProp>\n      <boolProp name="TestPlan.functional_mode">false</boolProp>\n      <boolProp name="TestPlan.tearDown_on_shutdown">true</boolProp>\n      <boolProp name="TestPlan.serialize_threadgroups">false</boolProp>\n    </TestPlan>\n  </hashTree>\n</jmeterTestPlan>\n'})}),"\n",(0,i.jsx)(e.h3,{id:"73-\u751F\u4EA7\u73AF\u5883\u90E8\u7F72\u6307\u5357",children:"7.3 \u751F\u4EA7\u73AF\u5883\u90E8\u7F72\u6307\u5357"}),"\n",(0,i.jsx)(e.h4,{id:"731-\u96C6\u7FA4\u89C4\u5212",children:"7.3.1 \u96C6\u7FA4\u89C4\u5212"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u786C\u4EF6\u914D\u7F6E\u5EFA\u8BAE"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7EC4\u4EF6"}),(0,i.jsx)(e.th,{children:"CPU"}),(0,i.jsx)(e.th,{children:"\u5185\u5B58"}),(0,i.jsx)(e.th,{children:"\u78C1\u76D8"}),(0,i.jsx)(e.th,{children:"\u7F51\u7EDC"}),(0,i.jsx)(e.th,{children:"\u8BF4\u660E"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Kafka Broker"})}),(0,i.jsx)(e.td,{children:"8\u6838+"}),(0,i.jsx)(e.td,{children:"32GB+"}),(0,i.jsx)(e.td,{children:"SSD 1TB+"}),(0,i.jsx)(e.td,{children:"\u4E07\u5146"}),(0,i.jsx)(e.td,{children:"\u9AD8\u6027\u80FD\u5B58\u50A8\u548C\u7F51\u7EDC"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Zookeeper"})}),(0,i.jsx)(e.td,{children:"4\u6838+"}),(0,i.jsx)(e.td,{children:"8GB+"}),(0,i.jsx)(e.td,{children:"SSD 100GB+"}),(0,i.jsx)(e.td,{children:"\u5343\u5146"}),(0,i.jsx)(e.td,{children:"\u5143\u6570\u636E\u5B58\u50A8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u76D1\u63A7\u8282\u70B9"})}),(0,i.jsx)(e.td,{children:"4\u6838+"}),(0,i.jsx)(e.td,{children:"16GB+"}),(0,i.jsx)(e.td,{children:"SSD 500GB+"}),(0,i.jsx)(e.td,{children:"\u5343\u5146"}),(0,i.jsx)(e.td,{children:"Prometheus/Grafana"})]})]})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u96C6\u7FA4\u89C4\u6A21\u89C4\u5212"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"# \u751F\u4EA7\u73AF\u5883\u96C6\u7FA4\u914D\u7F6E\nproduction-cluster:\n  brokers: 3-5\u4E2A\u8282\u70B9\n  zookeeper: 3\u4E2A\u8282\u70B9\uFF08\u5947\u6570\uFF09\n  partitions: \u6839\u636E\u4E1A\u52A1\u91CF\u8BA1\u7B97\n  replication-factor: 3\n  min-insync-replicas: 2\n"})}),"\n",(0,i.jsx)(e.h4,{id:"732-\u914D\u7F6E\u6587\u4EF6\u4F18\u5316",children:"7.3.2 \u914D\u7F6E\u6587\u4EF6\u4F18\u5316"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"server.properties \u751F\u4EA7\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-properties",children:"# \u57FA\u7840\u914D\u7F6E\nbroker.id=1\nlisteners=PLAINTEXT://0.0.0.0:9092\nadvertised.listeners=PLAINTEXT://kafka-1.example.com:9092\n\n# \u65E5\u5FD7\u914D\u7F6E\nlog.dirs=/data/kafka-logs\nnum.partitions=3\ndefault.replication.factor=3\nmin.insync.replicas=2\n\n# \u6027\u80FD\u4F18\u5316\nnum.network.threads=8\nnum.io.threads=16\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\n\n# \u65E5\u5FD7\u6BB5\u914D\u7F6E\nlog.segment.bytes=1073741824\nlog.retention.hours=168\nlog.retention.bytes=107374182400\nlog.cleanup.policy=delete\n\n# \u538B\u7F29\u914D\u7F6E\ncompression.type=snappy\nmessage.max.bytes=1000000\nreplica.fetch.max.bytes=1048576\n\n# \u526F\u672C\u914D\u7F6E\nreplica.lag.time.max.ms=10000\nreplica.fetch.wait.max.ms=500\nreplica.socket.timeout.ms=30000\n\n# \u63A7\u5236\u5668\u914D\u7F6E\ncontroller.socket.timeout.ms=30000\n"})}),"\n",(0,i.jsx)(e.h4,{id:"733-\u5B89\u5168\u914D\u7F6E",children:"7.3.3 \u5B89\u5168\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"SSL/TLS \u52A0\u5BC6\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-properties",children:"# SSL\u914D\u7F6E\nlisteners=SSL://0.0.0.0:9093\nsecurity.inter.broker.protocol=SSL\nssl.keystore.location=/opt/kafka/ssl/kafka.server.keystore.jks\nssl.keystore.password=keystore_password\nssl.key.password=key_password\nssl.truststore.location=/opt/kafka/ssl/kafka.server.truststore.jks\nssl.truststore.password=truststore_password\nssl.client.auth=required\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"SASL\u8BA4\u8BC1\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-properties",children:'# SASL\u914D\u7F6E\nlisteners=SASL_SSL://0.0.0.0:9094\nsecurity.inter.broker.protocol=SASL_SSL\nsasl.mechanism.inter.broker.protocol=PLAIN\nsasl.enabled.mechanisms=PLAIN\nsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required \\\n  username="admin" \\\n  password="admin-secret" \\\n  user_admin="admin-secret" \\\n  user_alice="alice-secret";\n'})}),"\n",(0,i.jsx)(e.h4,{id:"734-\u76D1\u63A7\u914D\u7F6E",children:"7.3.4 \u76D1\u63A7\u914D\u7F6E"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"JMX\u76D1\u63A7\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-properties",children:"# JMX\u914D\u7F6E\njmx.port=9999\nkafka.jmx.port=9999\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Prometheus JMX Exporter\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'# jmx_prometheus_javaagent.yml\nstartDelaySeconds: 0\nssl: false\nlowercaseOutputName: false\nlowercaseOutputLabelNames: false\nrules:\n  - pattern: kafka.server<type=BrokerTopicMetrics, name=MessagesInPerSec, topic=(.+)><>Count\n    name: kafka_server_brokertopicmetrics_messagesin_total\n    labels:\n      topic: "$1"\n    type: COUNTER\n  - pattern: kafka.server<type=BrokerTopicMetrics, name=BytesInPerSec, topic=(.+)><>Count\n    name: kafka_server_brokertopicmetrics_bytesin_total\n    labels:\n      topic: "$1"\n    type: COUNTER\n'})}),"\n",(0,i.jsx)(e.h3,{id:"74-\u8FD0\u7EF4\u7BA1\u7406\u5B9E\u8DF5",children:"7.4 \u8FD0\u7EF4\u7BA1\u7406\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.h4,{id:"741-\u65E5\u5E38\u8FD0\u7EF4\u811A\u672C",children:"7.4.1 \u65E5\u5E38\u8FD0\u7EF4\u811A\u672C"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u96C6\u7FA4\u5065\u5EB7\u68C0\u67E5\u811A\u672C"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# kafka-health-check.sh\n\nKAFKA_HOME="/opt/kafka"\nBROKER_LIST="localhost:9092"\n\necho "=== Kafka\u96C6\u7FA4\u5065\u5EB7\u68C0\u67E5 ==="\n\n# \u68C0\u67E5Broker\u72B6\u6001\necho "1. \u68C0\u67E5Broker\u72B6\u6001..."\n$KAFKA_HOME/bin/kafka-broker-api-versions.sh --bootstrap-server $BROKER_LIST\n\n# \u68C0\u67E5Topic\u5217\u8868\necho "2. \u68C0\u67E5Topic\u5217\u8868..."\n$KAFKA_HOME/bin/kafka-topics.sh --bootstrap-server $BROKER_LIST --list\n\n# \u68C0\u67E5\u6D88\u8D39\u8005\u7EC4\necho "3. \u68C0\u67E5\u6D88\u8D39\u8005\u7EC4..."\n$KAFKA_HOME/bin/kafka-consumer-groups.sh --bootstrap-server $BROKER_LIST --list\n\n# \u68C0\u67E5\u5206\u533A\u72B6\u6001\necho "4. \u68C0\u67E5\u5206\u533A\u72B6\u6001..."\n$KAFKA_HOME/bin/kafka-topics.sh --bootstrap-server $BROKER_LIST --describe\n\n# \u68C0\u67E5\u65E5\u5FD7\u5927\u5C0F\necho "5. \u68C0\u67E5\u65E5\u5FD7\u5927\u5C0F..."\ndu -sh /data/kafka-logs/*\n\n# \u68C0\u67E5\u78C1\u76D8\u4F7F\u7528\u7387\necho "6. \u68C0\u67E5\u78C1\u76D8\u4F7F\u7528\u7387..."\ndf -h /data\n\necho "=== \u5065\u5EB7\u68C0\u67E5\u5B8C\u6210 ==="\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u52A8\u5907\u4EFD\u811A\u672C"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# kafka-backup.sh\n\nBACKUP_DIR="/backup/kafka"\nDATE=$(date +%Y%m%d_%H%M%S)\nKAFKA_HOME="/opt/kafka"\n\n# \u521B\u5EFA\u5907\u4EFD\u76EE\u5F55\nmkdir -p $BACKUP_DIR/$DATE\n\n# \u5907\u4EFD\u914D\u7F6E\u6587\u4EF6\ncp -r $KAFKA_HOME/config $BACKUP_DIR/$DATE/\n\n# \u5907\u4EFDTopic\u5143\u6570\u636E\n$KAFKA_HOME/bin/kafka-topics.sh --bootstrap-server localhost:9092 --list > $BACKUP_DIR/$DATE/topics.txt\n\n# \u5907\u4EFD\u6D88\u8D39\u8005\u7EC4\u4FE1\u606F\n$KAFKA_HOME/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list > $BACKUP_DIR/$DATE/consumer-groups.txt\n\n# \u538B\u7F29\u5907\u4EFD\ntar -czf $BACKUP_DIR/kafka-backup-$DATE.tar.gz -C $BACKUP_DIR $DATE\n\n# \u6E05\u7406\u65E7\u5907\u4EFD\uFF08\u4FDD\u75597\u5929\uFF09\nfind $BACKUP_DIR -name "kafka-backup-*.tar.gz" -mtime +7 -delete\n\necho "\u5907\u4EFD\u5B8C\u6210: kafka-backup-$DATE.tar.gz"\n'})}),"\n",(0,i.jsx)(e.h4,{id:"742-\u6545\u969C\u6392\u67E5\u6307\u5357",children:"7.4.2 \u6545\u969C\u6392\u67E5\u6307\u5357"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5E38\u89C1\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u95EE\u9898"}),(0,i.jsx)(e.th,{children:"\u75C7\u72B6"}),(0,i.jsx)(e.th,{children:"\u539F\u56E0"}),(0,i.jsx)(e.th,{children:"\u89E3\u51B3\u65B9\u6848"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Leader\u4E0D\u53EF\u7528"})}),(0,i.jsx)(e.td,{children:"\u5206\u533A\u65E0Leader"}),(0,i.jsx)(e.td,{children:"Broker\u5B95\u673A"}),(0,i.jsx)(e.td,{children:"\u91CD\u542FBroker\u6216\u91CD\u65B0\u5206\u914D\u5206\u533A"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6D88\u606F\u4E22\u5931"})}),(0,i.jsx)(e.td,{children:"\u6D88\u8D39\u8005\u6536\u4E0D\u5230\u6D88\u606F"}),(0,i.jsx)(e.td,{children:"\u526F\u672C\u4E0D\u8DB3"}),(0,i.jsx)(e.td,{children:"\u589E\u52A0\u526F\u672C\u56E0\u5B50"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u4E0B\u964D"})}),(0,i.jsx)(e.td,{children:"\u541E\u5410\u91CF\u964D\u4F4E"}),(0,i.jsx)(e.td,{children:"\u78C1\u76D8IO\u74F6\u9888"}),(0,i.jsx)(e.td,{children:"\u4F18\u5316\u78C1\u76D8\u914D\u7F6E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5185\u5B58\u6EA2\u51FA"})}),(0,i.jsx)(e.td,{children:"Broker\u5D29\u6E83"}),(0,i.jsx)(e.td,{children:"\u5185\u5B58\u4E0D\u8DB3"}),(0,i.jsx)(e.td,{children:"\u8C03\u6574JVM\u53C2\u6570"})]})]})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6545\u969C\u6392\u67E5\u811A\u672C"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# kafka-troubleshoot.sh\n\necho "=== Kafka\u6545\u969C\u6392\u67E5 ==="\n\n# 1. \u68C0\u67E5Broker\u72B6\u6001\necho "1. \u68C0\u67E5Broker\u72B6\u6001..."\n$KAFKA_HOME/bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092\n\n# 2. \u68C0\u67E5\u5206\u533A\u72B6\u6001\necho "2. \u68C0\u67E5\u5206\u533A\u72B6\u6001..."\n$KAFKA_HOME/bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe --unavailable-partitions\n\n# 3. \u68C0\u67E5\u526F\u672C\u72B6\u6001\necho "3. \u68C0\u67E5\u526F\u672C\u72B6\u6001..."\n$KAFKA_HOME/bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe --under-replicated-partitions\n\n# 4. \u68C0\u67E5\u6D88\u8D39\u8005\u5EF6\u8FDF\necho "4. \u68C0\u67E5\u6D88\u8D39\u8005\u5EF6\u8FDF..."\n$KAFKA_HOME/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --all-groups\n\n# 5. \u68C0\u67E5\u65E5\u5FD7\u6587\u4EF6\necho "5. \u68C0\u67E5\u65E5\u5FD7\u6587\u4EF6..."\ntail -n 100 $KAFKA_HOME/logs/server.log | grep ERROR\n\n# 6. \u68C0\u67E5\u7CFB\u7EDF\u8D44\u6E90\necho "6. \u68C0\u67E5\u7CFB\u7EDF\u8D44\u6E90..."\necho "CPU\u4F7F\u7528\u7387:"\ntop -bn1 | grep "Cpu(s)"\necho "\u5185\u5B58\u4F7F\u7528\u7387:"\nfree -h\necho "\u78C1\u76D8\u4F7F\u7528\u7387:"\ndf -h\n\necho "=== \u6545\u969C\u6392\u67E5\u5B8C\u6210 ==="\n'})}),"\n",(0,i.jsx)(e.h4,{id:"743-\u6027\u80FD\u8C03\u4F18\u5B9E\u8DF5",children:"7.4.3 \u6027\u80FD\u8C03\u4F18\u5B9E\u8DF5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"JVM\u53C2\u6570\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# kafka-server-start.sh\nexport KAFKA_HEAP_OPTS="-Xmx8g -Xms8g"\nexport KAFKA_JVM_PERFORMANCE_OPTS="-server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:MaxInlineLevel=15 -Djava.awt.headless=true"\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u7CFB\u7EDF\u53C2\u6570\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# /etc/sysctl.conf\n# \u7F51\u7EDC\u53C2\u6570\nnet.core.rmem_max = 134217728\nnet.core.wmem_max = 134217728\nnet.ipv4.tcp_rmem = 4096 65536 134217728\nnet.ipv4.tcp_wmem = 4096 65536 134217728\n\n# \u6587\u4EF6\u63CF\u8FF0\u7B26\nfs.file-max = 1000000\n\n# \u865A\u62DF\u5185\u5B58\nvm.swappiness = 1\nvm.dirty_ratio = 15\nvm.dirty_background_ratio = 5\n"})}),"\n",(0,i.jsx)(e.h3,{id:"75-\u4E0E\u5176\u4ED6\u6280\u672F\u6808\u96C6\u6210",children:"7.5 \u4E0E\u5176\u4ED6\u6280\u672F\u6808\u96C6\u6210"}),"\n",(0,i.jsx)(e.h4,{id:"751-spring-boot\u96C6\u6210",children:"7.5.1 Spring Boot\u96C6\u6210"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Maven\u4F9D\u8D56"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"<dependencies>\n    <dependency>\n        <groupId>org.springframework.kafka</groupId>\n        <artifactId>spring-kafka</artifactId>\n        <version>2.9.0</version>\n    </dependency>\n    <dependency>\n        <groupId>org.apache.kafka</groupId>\n        <artifactId>kafka-streams</artifactId>\n        <version>3.4.0</version>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u914D\u7F6E\u7C7B"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Configuration\n@EnableKafka\npublic class KafkaConfig {\n    \n    @Bean\n    public ProducerFactory<String, Object> producerFactory() {\n        Map<String, Object> configProps = new HashMap<>();\n        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);\n        configProps.put(ProducerConfig.ACKS_CONFIG, "all");\n        configProps.put(ProducerConfig.RETRIES_CONFIG, 3);\n        configProps.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n        return new DefaultKafkaProducerFactory<>(configProps);\n    }\n    \n    @Bean\n    public KafkaTemplate<String, Object> kafkaTemplate() {\n        return new KafkaTemplate<>(producerFactory());\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"752-\u4E0E\u6570\u636E\u5E93\u96C6\u6210",children:"7.5.2 \u4E0E\u6570\u636E\u5E93\u96C6\u6210"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Kafka Connect\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "name": "mysql-source-connector",\n  "config": {\n    "connector.class": "io.confluent.connect.jdbc.JdbcSourceConnector",\n    "connection.url": "jdbc:mysql://localhost:3306/ecommerce",\n    "connection.user": "root",\n    "connection.password": "password",\n    "table.whitelist": "orders",\n    "mode": "incrementing",\n    "incrementing.column.name": "id",\n    "topic.prefix": "mysql-",\n    "poll.interval.ms": 1000\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"753-\u4E0Eelasticsearch\u96C6\u6210",children:"7.5.3 \u4E0EElasticsearch\u96C6\u6210"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Logstash\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ruby",children:'input {\n  kafka {\n    bootstrap_servers => "localhost:9092"\n    topics => ["order-events"]\n    group_id => "logstash"\n    consumer_threads => 4\n  }\n}\n\nfilter {\n  json {\n    source => "message"\n  }\n  \n  date {\n    match => ["timestamp", "ISO8601"]\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => ["localhost:9200"]\n    index => "kafka-events-%{+YYYY.MM.dd}"\n  }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"76-\u9AD8\u7EA7\u9519\u8BEF\u5904\u7406\u4E0E\u5BB9\u9519\u673A\u5236",children:"7.6 \u9AD8\u7EA7\u9519\u8BEF\u5904\u7406\u4E0E\u5BB9\u9519\u673A\u5236"}),"\n",(0,i.jsx)(e.h4,{id:"761-\u751F\u4EA7\u8005\u9519\u8BEF\u5904\u7406",children:"7.6.1 \u751F\u4EA7\u8005\u9519\u8BEF\u5904\u7406"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u91CD\u8BD5\u673A\u5236\u5B9E\u73B0"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class RobustKafkaProducer {\n    \n    private final KafkaTemplate<String, Object> kafkaTemplate;\n    private final RetryTemplate retryTemplate;\n    \n    public RobustKafkaProducer(KafkaTemplate<String, Object> kafkaTemplate) {\n        this.kafkaTemplate = kafkaTemplate;\n        this.retryTemplate = createRetryTemplate();\n    }\n    \n    private RetryTemplate createRetryTemplate() {\n        RetryTemplate template = new RetryTemplate();\n        \n        // \u91CD\u8BD5\u7B56\u7565\uFF1A\u6307\u6570\u9000\u907F\n        ExponentialBackOffPolicy backOffPolicy = new ExponentialBackOffPolicy();\n        backOffPolicy.setInitialInterval(1000);\n        backOffPolicy.setMultiplier(2.0);\n        backOffPolicy.setMaxInterval(10000);\n        template.setBackOffPolicy(backOffPolicy);\n        \n        // \u91CD\u8BD5\u6761\u4EF6\uFF1A\u53EF\u91CD\u8BD5\u7684\u5F02\u5E38\n        SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy(3, \n            Map.of(\n                RetriableException.class, true,\n                TimeoutException.class, true,\n                NetworkException.class, true\n            ));\n        template.setRetryPolicy(retryPolicy);\n        \n        return template;\n    }\n    \n    public void sendMessageWithRetry(String topic, String key, Object message) {\n        try {\n            retryTemplate.execute(context -> {\n                try {\n                    ListenableFuture<SendResult<String, Object>> future = \n                        kafkaTemplate.send(topic, key, message);\n                    \n                    return future.get(5, TimeUnit.SECONDS);\n                } catch (Exception e) {\n                    log.warn("\u53D1\u9001\u6D88\u606F\u5931\u8D25\uFF0C\u91CD\u8BD5\u7B2C{}\u6B21: {}", \n                        context.getRetryCount() + 1, e.getMessage());\n                    throw new RetriableException("\u6D88\u606F\u53D1\u9001\u5931\u8D25", e);\n                }\n            });\n        } catch (Exception e) {\n            log.error("\u6D88\u606F\u53D1\u9001\u6700\u7EC8\u5931\u8D25: topic={}, key={}, error={}", \n                topic, key, e.getMessage());\n            // \u53D1\u9001\u5230\u6B7B\u4FE1\u961F\u5217\n            sendToDeadLetterQueue(topic, key, message, e);\n        }\n    }\n    \n    private void sendToDeadLetterQueue(String topic, String key, \n                                     Object message, Exception error) {\n        DeadLetterMessage dlqMessage = DeadLetterMessage.builder()\n            .originalTopic(topic)\n            .originalKey(key)\n            .originalMessage(message)\n            .errorMessage(error.getMessage())\n            .timestamp(Instant.now())\n            .build();\n        \n        kafkaTemplate.send("dlq-topic", key, dlqMessage);\n    }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6B7B\u4FE1\u961F\u5217\u5904\u7406"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class DeadLetterQueueHandler {\n    \n    @KafkaListener(topics = "dlq-topic", groupId = "dlq-handler")\n    public void handleDeadLetterMessage(@Payload DeadLetterMessage dlqMessage) {\n        log.error("\u5904\u7406\u6B7B\u4FE1\u6D88\u606F: topic={}, key={}, error={}", \n            dlqMessage.getOriginalTopic(),\n            dlqMessage.getOriginalKey(),\n            dlqMessage.getErrorMessage());\n        \n        // 1. \u8BB0\u5F55\u5230\u6570\u636E\u5E93\n        saveDeadLetterRecord(dlqMessage);\n        \n        // 2. \u53D1\u9001\u544A\u8B66\n        sendAlert(dlqMessage);\n        \n        // 3. \u5C1D\u8BD5\u4FEE\u590D\u6216\u4EBA\u5DE5\u5904\u7406\n        attemptRecovery(dlqMessage);\n    }\n    \n    private void saveDeadLetterRecord(DeadLetterMessage dlqMessage) {\n        // \u4FDD\u5B58\u5230\u6570\u636E\u5E93\u7528\u4E8E\u540E\u7EED\u5206\u6790\n        DeadLetterRecord record = DeadLetterRecord.builder()\n            .originalTopic(dlqMessage.getOriginalTopic())\n            .originalKey(dlqMessage.getOriginalKey())\n            .errorMessage(dlqMessage.getErrorMessage())\n            .timestamp(dlqMessage.getTimestamp())\n            .status(DeadLetterStatus.PENDING)\n            .build();\n        \n        deadLetterRepository.save(record);\n    }\n    \n    private void sendAlert(DeadLetterMessage dlqMessage) {\n        AlertMessage alert = AlertMessage.builder()\n            .level(AlertLevel.ERROR)\n            .title("Kafka\u6D88\u606F\u53D1\u9001\u5931\u8D25")\n            .content(String.format("Topic: %s, Key: %s, Error: %s", \n                dlqMessage.getOriginalTopic(),\n                dlqMessage.getOriginalKey(),\n                dlqMessage.getErrorMessage()))\n            .timestamp(Instant.now())\n            .build();\n        \n        alertService.sendAlert(alert);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"762-\u6D88\u8D39\u8005\u9519\u8BEF\u5904\u7406",children:"7.6.2 \u6D88\u8D39\u8005\u9519\u8BEF\u5904\u7406"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6D88\u8D39\u8005\u5BB9\u9519\u673A\u5236"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class FaultTolerantConsumer {\n    \n    private final OrderService orderService;\n    private final CircuitBreaker circuitBreaker;\n    \n    public FaultTolerantConsumer(OrderService orderService) {\n        this.orderService = orderService;\n        this.circuitBreaker = createCircuitBreaker();\n    }\n    \n    private CircuitBreaker createCircuitBreaker() {\n        return CircuitBreaker.ofDefaults("order-processing")\n            .toBuilder()\n            .failureRateThreshold(50)\n            .waitDurationInOpenState(Duration.ofSeconds(30))\n            .slidingWindowSize(10)\n            .build();\n    }\n    \n    @KafkaListener(topics = "order-events", groupId = "order-processor")\n    public void handleOrderEvent(@Payload OrderEvent orderEvent,\n                               Acknowledgment acknowledgment) {\n        try {\n            // \u4F7F\u7528\u65AD\u8DEF\u5668\u4FDD\u62A4\n            circuitBreaker.executeSupplier(() -> {\n                processOrderEvent(orderEvent);\n                return null;\n            });\n            \n            // \u5904\u7406\u6210\u529F\uFF0C\u63D0\u4EA4\u504F\u79FB\u91CF\n            acknowledgment.acknowledge();\n            \n        } catch (Exception e) {\n            log.error("\u5904\u7406\u8BA2\u5355\u4E8B\u4EF6\u5931\u8D25: orderId={}, error={}", \n                orderEvent.getOrderId(), e.getMessage(), e);\n            \n            // \u6839\u636E\u5F02\u5E38\u7C7B\u578B\u51B3\u5B9A\u5904\u7406\u7B56\u7565\n            handleConsumerError(orderEvent, e, acknowledgment);\n        }\n    }\n    \n    private void handleConsumerError(OrderEvent orderEvent, Exception error, \n                                   Acknowledgment acknowledgment) {\n        if (isRetryableError(error)) {\n            // \u53EF\u91CD\u8BD5\u9519\u8BEF\uFF1A\u5EF6\u8FDF\u91CD\u8BD5\n            scheduleRetry(orderEvent, error);\n            // \u4E0D\u63D0\u4EA4\u504F\u79FB\u91CF\uFF0C\u7B49\u5F85\u91CD\u8BD5\n        } else if (isBusinessError(error)) {\n            // \u4E1A\u52A1\u9519\u8BEF\uFF1A\u8BB0\u5F55\u5E76\u8DF3\u8FC7\n            logBusinessError(orderEvent, error);\n            acknowledgment.acknowledge();\n        } else {\n            // \u7CFB\u7EDF\u9519\u8BEF\uFF1A\u53D1\u9001\u5230\u6B7B\u4FE1\u961F\u5217\n            sendToDeadLetterQueue(orderEvent, error);\n            acknowledgment.acknowledge();\n        }\n    }\n    \n    private boolean isRetryableError(Exception error) {\n        return error instanceof TimeoutException ||\n               error instanceof ConnectException ||\n               error instanceof SocketTimeoutException;\n    }\n    \n    private boolean isBusinessError(Exception error) {\n        return error instanceof ValidationException ||\n               error instanceof BusinessLogicException;\n    }\n    \n    private void scheduleRetry(OrderEvent orderEvent, Exception error) {\n        // \u4F7F\u7528\u5EF6\u8FDF\u961F\u5217\u5B9E\u73B0\u91CD\u8BD5\n        RetryMessage retryMessage = RetryMessage.builder()\n            .originalMessage(orderEvent)\n            .retryCount(0)\n            .maxRetries(3)\n            .nextRetryTime(Instant.now().plusSeconds(30))\n            .build();\n        \n        kafkaTemplate.send("retry-topic", orderEvent.getOrderId(), retryMessage);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"763-\u6D88\u606F\u53BB\u91CD\u4E0E\u5E42\u7B49\u6027",children:"7.6.3 \u6D88\u606F\u53BB\u91CD\u4E0E\u5E42\u7B49\u6027"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5E42\u7B49\u6027\u4FDD\u8BC1"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class IdempotentMessageProcessor {\n    \n    private final RedisTemplate<String, String> redisTemplate;\n    private final OrderService orderService;\n    \n    @KafkaListener(topics = "order-events", groupId = "idempotent-processor")\n    public void processOrderEvent(@Payload OrderEvent orderEvent,\n                                @Header("message-id") String messageId) {\n        \n        // 1. \u68C0\u67E5\u6D88\u606F\u662F\u5426\u5DF2\u5904\u7406\n        if (isMessageProcessed(messageId)) {\n            log.info("\u6D88\u606F\u5DF2\u5904\u7406\uFF0C\u8DF3\u8FC7: messageId={}", messageId);\n            return;\n        }\n        \n        // 2. \u6807\u8BB0\u6D88\u606F\u4E3A\u5904\u7406\u4E2D\n        markMessageAsProcessing(messageId);\n        \n        try {\n            // 3. \u4E1A\u52A1\u5904\u7406\n            orderService.processOrder(orderEvent);\n            \n            // 4. \u6807\u8BB0\u6D88\u606F\u4E3A\u5DF2\u5904\u7406\n            markMessageAsProcessed(messageId);\n            \n        } catch (Exception e) {\n            // 5. \u5904\u7406\u5931\u8D25\uFF0C\u6E05\u9664\u5904\u7406\u6807\u8BB0\n            clearProcessingMark(messageId);\n            throw e;\n        }\n    }\n    \n    private boolean isMessageProcessed(String messageId) {\n        String key = "processed:" + messageId;\n        return redisTemplate.hasKey(key);\n    }\n    \n    private void markMessageAsProcessing(String messageId) {\n        String key = "processing:" + messageId;\n        String processingKey = "processed:" + messageId;\n        \n        // \u4F7F\u7528Redis\u539F\u5B50\u64CD\u4F5C\u4FDD\u8BC1\u5E76\u53D1\u5B89\u5168\n        Boolean success = redisTemplate.opsForValue()\n            .setIfAbsent(key, "processing", Duration.ofMinutes(5));\n        \n        if (!success) {\n            throw new DuplicateMessageException("\u6D88\u606F\u6B63\u5728\u5904\u7406\u4E2D: " + messageId);\n        }\n    }\n    \n    private void markMessageAsProcessed(String messageId) {\n        String processingKey = "processing:" + messageId;\n        String processedKey = "processed:" + messageId;\n        \n        // \u539F\u5B50\u64CD\u4F5C\uFF1A\u5220\u9664\u5904\u7406\u6807\u8BB0\uFF0C\u6DFB\u52A0\u5DF2\u5904\u7406\u6807\u8BB0\n        redisTemplate.execute(new SessionCallback<Object>() {\n            @Override\n            public Object execute(RedisOperations operations) {\n                operations.multi();\n                operations.delete(processingKey);\n                operations.opsForValue().set(processedKey, "processed", \n                    Duration.ofHours(24));\n                return operations.exec();\n            }\n        });\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"764-\u6D88\u606F\u987A\u5E8F\u4FDD\u8BC1",children:"7.6.4 \u6D88\u606F\u987A\u5E8F\u4FDD\u8BC1"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5206\u533A\u5185\u987A\u5E8F\u5904\u7406"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class OrderedMessageProcessor {\n    \n    private final Map<String, BlockingQueue<OrderEvent>> partitionQueues = new ConcurrentHashMap<>();\n    private final ExecutorService executorService = Executors.newFixedThreadPool(10);\n    \n    @KafkaListener(topics = "order-events", groupId = "ordered-processor")\n    public void handleOrderEvent(@Payload OrderEvent orderEvent,\n                               @Header(KafkaHeaders.RECEIVED_PARTITION_ID) int partition) {\n        \n        String partitionKey = "partition-" + partition;\n        \n        // \u5C06\u6D88\u606F\u653E\u5165\u5BF9\u5E94\u5206\u533A\u7684\u961F\u5217\n        partitionQueues.computeIfAbsent(partitionKey, \n            k -> new LinkedBlockingQueue<>()).offer(orderEvent);\n        \n        // \u5F02\u6B65\u5904\u7406\u8BE5\u5206\u533A\u7684\u6D88\u606F\n        executorService.submit(() -> processPartitionMessages(partitionKey));\n    }\n    \n    private void processPartitionMessages(String partitionKey) {\n        BlockingQueue<OrderEvent> queue = partitionQueues.get(partitionKey);\n        \n        while (!queue.isEmpty()) {\n            try {\n                OrderEvent orderEvent = queue.take();\n                processOrderEvent(orderEvent);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                break;\n            } catch (Exception e) {\n                log.error("\u5904\u7406\u5206\u533A\u6D88\u606F\u5931\u8D25: partition={}, error={}", \n                    partitionKey, e.getMessage(), e);\n                // \u9519\u8BEF\u5904\u7406\u903B\u8F91\n                handleProcessingError(partitionKey, e);\n            }\n        }\n    }\n    \n    private void processOrderEvent(OrderEvent orderEvent) {\n        // \u786E\u4FDD\u540C\u4E00\u5206\u533A\u7684\u6D88\u606F\u6309\u987A\u5E8F\u5904\u7406\n        log.info("\u5904\u7406\u8BA2\u5355\u4E8B\u4EF6: orderId={}, partition={}", \n            orderEvent.getOrderId(), orderEvent.getPartition());\n        \n        // \u4E1A\u52A1\u5904\u7406\u903B\u8F91\n        orderService.processOrder(orderEvent);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"765-\u76D1\u63A7\u4E0E\u544A\u8B66",children:"7.6.5 \u76D1\u63A7\u4E0E\u544A\u8B66"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u76D1\u63A7\u6307\u6807"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class KafkaMetricsCollector {\n    \n    private final MeterRegistry meterRegistry;\n    private final Counter messageProcessedCounter;\n    private final Counter messageFailedCounter;\n    private final Timer messageProcessingTimer;\n    private final Gauge consumerLagGauge;\n    \n    public KafkaMetricsCollector(MeterRegistry meterRegistry) {\n        this.meterRegistry = meterRegistry;\n        \n        // \u6D88\u606F\u5904\u7406\u8BA1\u6570\u5668\n        this.messageProcessedCounter = Counter.builder("kafka.messages.processed")\n            .description("\u5DF2\u5904\u7406\u7684\u6D88\u606F\u6570\u91CF")\n            .register(meterRegistry);\n        \n        // \u6D88\u606F\u5931\u8D25\u8BA1\u6570\u5668\n        this.messageFailedCounter = Counter.builder("kafka.messages.failed")\n            .description("\u5904\u7406\u5931\u8D25\u7684\u6D88\u606F\u6570\u91CF")\n            .register(meterRegistry);\n        \n        // \u6D88\u606F\u5904\u7406\u65F6\u95F4\n        this.messageProcessingTimer = Timer.builder("kafka.message.processing.time")\n            .description("\u6D88\u606F\u5904\u7406\u65F6\u95F4")\n            .register(meterRegistry);\n        \n        // \u6D88\u8D39\u8005\u5EF6\u8FDF\n        this.consumerLagGauge = Gauge.builder("kafka.consumer.lag")\n            .description("\u6D88\u8D39\u8005\u5EF6\u8FDF")\n            .register(meterRegistry, this, KafkaMetricsCollector::getConsumerLag);\n    }\n    \n    public void recordMessageProcessed(String topic, String consumerGroup) {\n        messageProcessedCounter.increment(\n            Tags.of("topic", topic, "consumer_group", consumerGroup));\n    }\n    \n    public void recordMessageFailed(String topic, String consumerGroup, String errorType) {\n        messageFailedCounter.increment(\n            Tags.of("topic", topic, "consumer_group", consumerGroup, "error_type", errorType));\n    }\n    \n    public void recordProcessingTime(String topic, Duration duration) {\n        messageProcessingTimer.record(duration);\n    }\n    \n    private double getConsumerLag() {\n        // \u5B9E\u73B0\u83B7\u53D6\u6D88\u8D39\u8005\u5EF6\u8FDF\u7684\u903B\u8F91\n        return calculateConsumerLag();\n    }\n    \n    private double calculateConsumerLag() {\n        // \u5B9E\u9645\u5B9E\u73B0\u4E2D\u9700\u8981\u67E5\u8BE2Kafka\u83B7\u53D6\u5EF6\u8FDF\u4FE1\u606F\n        return 0.0;\n    }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5065\u5EB7\u68C0\u67E5\u7AEF\u70B9"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@RestController\n@RequestMapping("/health")\npublic class KafkaHealthController {\n    \n    private final KafkaAdmin kafkaAdmin;\n    private final KafkaMetricsCollector metricsCollector;\n    \n    @GetMapping("/kafka")\n    public ResponseEntity<Map<String, Object>> checkKafkaHealth() {\n        Map<String, Object> health = new HashMap<>();\n        \n        try {\n            // \u68C0\u67E5Kafka\u8FDE\u63A5\n            boolean isConnected = checkKafkaConnection();\n            health.put("status", isConnected ? "UP" : "DOWN");\n            health.put("kafka_connection", isConnected);\n            \n            // \u68C0\u67E5\u6D88\u8D39\u8005\u5EF6\u8FDF\n            double consumerLag = metricsCollector.getConsumerLag();\n            health.put("consumer_lag", consumerLag);\n            health.put("lag_status", consumerLag < 1000 ? "NORMAL" : "HIGH");\n            \n            // \u68C0\u67E5\u5904\u7406\u901F\u7387\n            double processingRate = getProcessingRate();\n            health.put("processing_rate", processingRate);\n            \n            return ResponseEntity.ok(health);\n            \n        } catch (Exception e) {\n            health.put("status", "DOWN");\n            health.put("error", e.getMessage());\n            return ResponseEntity.status(503).body(health);\n        }\n    }\n    \n    private boolean checkKafkaConnection() {\n        try {\n            kafkaAdmin.describeTopics("test-topic");\n            return true;\n        } catch (Exception e) {\n            return false;\n        }\n    }\n    \n    private double getProcessingRate() {\n        // \u5B9E\u73B0\u83B7\u53D6\u5904\u7406\u901F\u7387\u7684\u903B\u8F91\n        return 0.0;\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"77-\u6027\u80FD\u6D4B\u8BD5\u4E0E\u8C03\u4F18\u5B9E\u8DF5",children:"7.7 \u6027\u80FD\u6D4B\u8BD5\u4E0E\u8C03\u4F18\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.h4,{id:"771-\u6027\u80FD\u57FA\u51C6\u6D4B\u8BD5",children:"7.7.1 \u6027\u80FD\u57FA\u51C6\u6D4B\u8BD5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Kafka\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# kafka-benchmark.sh\n\nKAFKA_HOME="/opt/kafka"\nBROKER_LIST="localhost:9092"\nTOPIC_NAME="benchmark-topic"\n\necho "=== Kafka\u6027\u80FD\u57FA\u51C6\u6D4B\u8BD5 ==="\n\n# 1. \u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\necho "1. \u6D4B\u8BD5\u751F\u4EA7\u8005\u6027\u80FD..."\nkafka-producer-perf-test.sh \\\n  --topic $TOPIC_NAME \\\n  --num-records 1000000 \\\n  --record-size 1024 \\\n  --throughput 10000 \\\n  --producer-props bootstrap.servers=$BROKER_LIST \\\n  --producer-props acks=all \\\n  --producer-props retries=3 \\\n  --producer-props batch.size=16384 \\\n  --producer-props linger.ms=5\n\n# 2. \u6D88\u8D39\u8005\u6027\u80FD\u6D4B\u8BD5\necho "2. \u6D4B\u8BD5\u6D88\u8D39\u8005\u6027\u80FD..."\nkafka-consumer-perf-test.sh \\\n  --topic $TOPIC_NAME \\\n  --bootstrap-server $BROKER_LIST \\\n  --messages 1000000 \\\n  --threads 4 \\\n  --group test-group\n\n# 3. \u7AEF\u5230\u7AEF\u5EF6\u8FDF\u6D4B\u8BD5\necho "3. \u6D4B\u8BD5\u7AEF\u5230\u7AEF\u5EF6\u8FDF..."\nkafka-producer-perf-test.sh \\\n  --topic $TOPIC_NAME \\\n  --num-records 10000 \\\n  --record-size 1024 \\\n  --throughput -1 \\\n  --producer-props bootstrap.servers=$BROKER_LIST \\\n  --producer-props acks=1 &\n\nsleep 5\n\nkafka-consumer-perf-test.sh \\\n  --topic $TOPIC_NAME \\\n  --bootstrap-server $BROKER_LIST \\\n  --messages 10000 \\\n  --threads 1 \\\n  --group latency-test-group\n\necho "=== \u6027\u80FD\u6D4B\u8BD5\u5B8C\u6210 ==="\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u81EA\u5B9A\u4E49\u6027\u80FD\u6D4B\u8BD5\u5DE5\u5177"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class KafkaPerformanceTester {\n    \n    private final KafkaTemplate<String, Object> kafkaTemplate;\n    private final MeterRegistry meterRegistry;\n    \n    public void runProducerBenchmark(String topic, int messageCount, int messageSize) {\n        log.info("\u5F00\u59CB\u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5: topic={}, count={}, size={}", \n            topic, messageCount, messageSize);\n        \n        Timer.Sample sample = Timer.start(meterRegistry);\n        \n        for (int i = 0; i < messageCount; i++) {\n            String message = generateMessage(messageSize);\n            kafkaTemplate.send(topic, String.valueOf(i), message);\n        }\n        \n        sample.stop(Timer.builder("kafka.producer.benchmark")\n            .register(meterRegistry));\n        \n        log.info("\u751F\u4EA7\u8005\u6027\u80FD\u6D4B\u8BD5\u5B8C\u6210");\n    }\n    \n    public void runConsumerBenchmark(String topic, String groupId, int expectedMessages) {\n        log.info("\u5F00\u59CB\u6D88\u8D39\u8005\u6027\u80FD\u6D4B\u8BD5: topic={}, group={}, expected={}", \n            topic, groupId, expectedMessages);\n        \n        AtomicInteger messageCount = new AtomicInteger(0);\n        Timer.Sample sample = Timer.start(meterRegistry);\n        \n        // \u4F7F\u7528KafkaListener\u8FDB\u884C\u6D4B\u8BD5\n        // \u5B9E\u9645\u5B9E\u73B0\u4E2D\u9700\u8981\u914D\u7F6E\u6D4B\u8BD5\u4E13\u7528\u7684\u6D88\u8D39\u8005\n        \n        log.info("\u6D88\u8D39\u8005\u6027\u80FD\u6D4B\u8BD5\u5B8C\u6210: processed={}", messageCount.get());\n    }\n    \n    private String generateMessage(int size) {\n        StringBuilder sb = new StringBuilder();\n        for (int i = 0; i < size; i++) {\n            sb.append(\'A\');\n        }\n        return sb.toString();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"772-\u6027\u80FD\u8C03\u4F18\u7B56\u7565",children:"7.7.2 \u6027\u80FD\u8C03\u4F18\u7B56\u7565"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u751F\u4EA7\u8005\u8C03\u4F18"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Configuration\npublic class OptimizedKafkaConfig {\n    \n    @Bean\n    public ProducerFactory<String, Object> optimizedProducerFactory() {\n        Map<String, Object> configProps = new HashMap<>();\n        \n        // \u57FA\u7840\u914D\u7F6E\n        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);\n        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);\n        \n        // \u6027\u80FD\u4F18\u5316\u914D\u7F6E\n        configProps.put(ProducerConfig.ACKS_CONFIG, "1"); // \u964D\u4F4E\u5EF6\u8FDF\n        configProps.put(ProducerConfig.RETRIES_CONFIG, 3);\n        configProps.put(ProducerConfig.BATCH_SIZE_CONFIG, 32768); // \u589E\u52A0\u6279\u6B21\u5927\u5C0F\n        configProps.put(ProducerConfig.LINGER_MS_CONFIG, 10); // \u589E\u52A0\u7B49\u5F85\u65F6\u95F4\n        configProps.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 67108864); // \u589E\u52A0\u7F13\u51B2\u533A\n        configProps.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "snappy"); // \u542F\u7528\u538B\u7F29\n        configProps.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 5);\n        configProps.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n        \n        // \u7F51\u7EDC\u4F18\u5316\n        configProps.put(ProducerConfig.SEND_BUFFER_CONFIG, 131072);\n        configProps.put(ProducerConfig.RECEIVE_BUFFER_CONFIG, 131072);\n        \n        return new DefaultKafkaProducerFactory<>(configProps);\n    }\n    \n    @Bean\n    public ConsumerFactory<String, Object> optimizedConsumerFactory() {\n        Map<String, Object> configProps = new HashMap<>();\n        \n        // \u57FA\u7840\u914D\u7F6E\n        configProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\n        configProps.put(ConsumerConfig.GROUP_ID_CONFIG, "optimized-group");\n        configProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n        configProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);\n        \n        // \u6027\u80FD\u4F18\u5316\u914D\u7F6E\n        configProps.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 1048576); // \u589E\u52A0\u6700\u5C0F\u62C9\u53D6\u5927\u5C0F\n        configProps.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, 500); // \u51CF\u5C11\u7B49\u5F85\u65F6\u95F4\n        configProps.put(ConsumerConfig.MAX_PARTITION_FETCH_BYTES_CONFIG, 1048576); // \u589E\u52A0\u5206\u533A\u62C9\u53D6\u5927\u5C0F\n        configProps.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, 30000);\n        configProps.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 10000);\n        configProps.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "latest");\n        configProps.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false); // \u624B\u52A8\u63D0\u4EA4\n        \n        return new DefaultKafkaConsumerFactory<>(configProps);\n    }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"JVM\u8C03\u4F18\u914D\u7F6E"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# kafka-jvm-tuning.sh\n\n# \u8BBE\u7F6EJVM\u53C2\u6570\nexport KAFKA_HEAP_OPTS="-Xmx8g -Xms8g"\n\n# G1GC\u4F18\u5316\u53C2\u6570\nexport KAFKA_JVM_PERFORMANCE_OPTS="\n-server\n-XX:+UseG1GC\n-XX:MaxGCPauseMillis=20\n-XX:InitiatingHeapOccupancyPercent=35\n-XX:+ExplicitGCInvokesConcurrent\n-XX:MaxInlineLevel=15\n-XX:+UseStringDeduplication\n-XX:+OptimizeStringConcat\n-XX:+UseCompressedOops\n-XX:+UseCompressedClassPointers\n-Djava.awt.headless=true\n"\n\n# \u7F51\u7EDC\u4F18\u5316\u53C2\u6570\nexport KAFKA_OPTS="\n-Djava.net.preferIPv4Stack=true\n-Dcom.sun.management.jmxremote\n-Dcom.sun.management.jmxremote.authenticate=false\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.port=9999\n"\n\necho "JVM\u8C03\u4F18\u53C2\u6570\u5DF2\u8BBE\u7F6E"\n'})}),"\n",(0,i.jsx)(e.h4,{id:"773-\u7CFB\u7EDF\u7EA7\u4F18\u5316",children:"7.7.3 \u7CFB\u7EDF\u7EA7\u4F18\u5316"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Linux\u7CFB\u7EDF\u4F18\u5316"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# kafka-system-tuning.sh\n\necho "=== Kafka\u7CFB\u7EDF\u7EA7\u4F18\u5316 ==="\n\n# 1. \u7F51\u7EDC\u53C2\u6570\u4F18\u5316\necho "1. \u4F18\u5316\u7F51\u7EDC\u53C2\u6570..."\ncat >> /etc/sysctl.conf << EOF\n# \u7F51\u7EDC\u7F13\u51B2\u533A\nnet.core.rmem_max = 134217728\nnet.core.wmem_max = 134217728\nnet.ipv4.tcp_rmem = 4096 65536 134217728\nnet.ipv4.tcp_wmem = 4096 65536 134217728\n\n# \u7F51\u7EDC\u8FDE\u63A5\u4F18\u5316\nnet.core.netdev_max_backlog = 5000\nnet.ipv4.tcp_max_syn_backlog = 4096\nnet.ipv4.tcp_keepalive_time = 600\nnet.ipv4.tcp_keepalive_intvl = 60\nnet.ipv4.tcp_keepalive_probes = 3\n\n# \u6587\u4EF6\u63CF\u8FF0\u7B26\nfs.file-max = 1000000\nfs.nr_open = 1000000\nEOF\n\n# 2. \u78C1\u76D8I/O\u4F18\u5316\necho "2. \u4F18\u5316\u78C1\u76D8I/O..."\ncat >> /etc/sysctl.conf << EOF\n# \u865A\u62DF\u5185\u5B58\u4F18\u5316\nvm.swappiness = 1\nvm.dirty_ratio = 15\nvm.dirty_background_ratio = 5\nvm.dirty_expire_centisecs = 3000\nvm.dirty_writeback_centisecs = 500\nEOF\n\n# 3. \u5E94\u7528\u7CFB\u7EDF\u53C2\u6570\nsysctl -p\n\n# 4. \u8BBE\u7F6E\u6587\u4EF6\u63CF\u8FF0\u7B26\u9650\u5236\necho "3. \u8BBE\u7F6E\u6587\u4EF6\u63CF\u8FF0\u7B26\u9650\u5236..."\ncat >> /etc/security/limits.conf << EOF\nkafka soft nofile 1000000\nkafka hard nofile 1000000\nkafka soft nproc 1000000\nkafka hard nproc 1000000\nEOF\n\n# 5. \u78C1\u76D8\u6302\u8F7D\u4F18\u5316\necho "4. \u4F18\u5316\u78C1\u76D8\u6302\u8F7D..."\n# \u4E3AKafka\u6570\u636E\u76EE\u5F55\u6DFB\u52A0noatime\u9009\u9879\nmount -o remount,noatime /data\n\necho "=== \u7CFB\u7EDF\u4F18\u5316\u5B8C\u6210 ==="\n'})}),"\n",(0,i.jsx)(e.h4,{id:"774-\u76D1\u63A7\u6307\u6807\u5206\u6790",children:"7.7.4 \u76D1\u63A7\u6307\u6807\u5206\u6790"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5173\u952E\u6027\u80FD\u6307\u6807"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class KafkaPerformanceAnalyzer {\n    \n    private final MeterRegistry meterRegistry;\n    private final KafkaAdmin kafkaAdmin;\n    \n    public PerformanceReport analyzePerformance() {\n        PerformanceReport report = new PerformanceReport();\n        \n        // 1. \u541E\u5410\u91CF\u5206\u6790\n        double producerThroughput = calculateProducerThroughput();\n        double consumerThroughput = calculateConsumerThroughput();\n        report.setProducerThroughput(producerThroughput);\n        report.setConsumerThroughput(consumerThroughput);\n        \n        // 2. \u5EF6\u8FDF\u5206\u6790\n        double p99Latency = calculateP99Latency();\n        double avgLatency = calculateAverageLatency();\n        report.setP99Latency(p99Latency);\n        report.setAverageLatency(avgLatency);\n        \n        // 3. \u8D44\u6E90\u4F7F\u7528\u7387\n        double cpuUsage = getCpuUsage();\n        double memoryUsage = getMemoryUsage();\n        double diskUsage = getDiskUsage();\n        report.setCpuUsage(cpuUsage);\n        report.setMemoryUsage(memoryUsage);\n        report.setDiskUsage(diskUsage);\n        \n        // 4. \u6D88\u8D39\u8005\u5EF6\u8FDF\n        double consumerLag = getConsumerLag();\n        report.setConsumerLag(consumerLag);\n        \n        // 5. \u751F\u6210\u6027\u80FD\u62A5\u544A\n        generatePerformanceReport(report);\n        \n        return report;\n    }\n    \n    private void generatePerformanceReport(PerformanceReport report) {\n        log.info("=== Kafka\u6027\u80FD\u5206\u6790\u62A5\u544A ===");\n        log.info("\u751F\u4EA7\u8005\u541E\u5410\u91CF: {} msg/s", report.getProducerThroughput());\n        log.info("\u6D88\u8D39\u8005\u541E\u5410\u91CF: {} msg/s", report.getConsumerThroughput());\n        log.info("P99\u5EF6\u8FDF: {} ms", report.getP99Latency());\n        log.info("\u5E73\u5747\u5EF6\u8FDF: {} ms", report.getAverageLatency());\n        log.info("CPU\u4F7F\u7528\u7387: {}%", report.getCpuUsage());\n        log.info("\u5185\u5B58\u4F7F\u7528\u7387: {}%", report.getMemoryUsage());\n        log.info("\u78C1\u76D8\u4F7F\u7528\u7387: {}%", report.getDiskUsage());\n        log.info("\u6D88\u8D39\u8005\u5EF6\u8FDF: {} ms", report.getConsumerLag());\n        \n        // \u6027\u80FD\u5EFA\u8BAE\n        providePerformanceRecommendations(report);\n    }\n    \n    private void providePerformanceRecommendations(PerformanceReport report) {\n        log.info("=== \u6027\u80FD\u4F18\u5316\u5EFA\u8BAE ===");\n        \n        if (report.getProducerThroughput() < 10000) {\n            log.warn("\u751F\u4EA7\u8005\u541E\u5410\u91CF\u8F83\u4F4E\uFF0C\u5EFA\u8BAE\uFF1A");\n            log.warn("- \u589E\u52A0batch.size");\n            log.warn("- \u542F\u7528\u538B\u7F29");\n            log.warn("- \u8C03\u6574linger.ms");\n        }\n        \n        if (report.getP99Latency() > 100) {\n            log.warn("\u5EF6\u8FDF\u8F83\u9AD8\uFF0C\u5EFA\u8BAE\uFF1A");\n            log.warn("- \u51CF\u5C11acks\u914D\u7F6E");\n            log.warn("- \u4F18\u5316\u7F51\u7EDC\u53C2\u6570");\n            log.warn("- \u68C0\u67E5\u78C1\u76D8I/O");\n        }\n        \n        if (report.getConsumerLag() > 1000) {\n            log.warn("\u6D88\u8D39\u8005\u5EF6\u8FDF\u8F83\u9AD8\uFF0C\u5EFA\u8BAE\uFF1A");\n            log.warn("- \u589E\u52A0\u6D88\u8D39\u8005\u5B9E\u4F8B");\n            log.warn("- \u4F18\u5316fetch\u914D\u7F6E");\n            log.warn("- \u68C0\u67E5\u5904\u7406\u903B\u8F91\u6027\u80FD");\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"775-\u538B\u529B\u6D4B\u8BD5\u573A\u666F",children:"7.7.5 \u538B\u529B\u6D4B\u8BD5\u573A\u666F"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u573A\u666F\u538B\u529B\u6D4B\u8BD5"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class KafkaStressTester {\n    \n    private final KafkaTemplate<String, Object> kafkaTemplate;\n    private final ExecutorService executorService = Executors.newFixedThreadPool(20);\n    \n    public void runStressTest() {\n        log.info("\u5F00\u59CBKafka\u538B\u529B\u6D4B\u8BD5...");\n        \n        // \u573A\u666F1\uFF1A\u9AD8\u5E76\u53D1\u5199\u5165\n        runHighConcurrencyWriteTest();\n        \n        // \u573A\u666F2\uFF1A\u5927\u6D88\u606F\u5904\u7406\n        runLargeMessageTest();\n        \n        // \u573A\u666F3\uFF1A\u957F\u65F6\u95F4\u8FD0\u884C\n        runLongRunningTest();\n        \n        // \u573A\u666F4\uFF1A\u6545\u969C\u6062\u590D\n        runFailureRecoveryTest();\n        \n        log.info("\u538B\u529B\u6D4B\u8BD5\u5B8C\u6210");\n    }\n    \n    private void runHighConcurrencyWriteTest() {\n        log.info("\u573A\u666F1\uFF1A\u9AD8\u5E76\u53D1\u5199\u5165\u6D4B\u8BD5");\n        \n        int threadCount = 20;\n        int messagesPerThread = 10000;\n        \n        CountDownLatch latch = new CountDownLatch(threadCount);\n        \n        for (int i = 0; i < threadCount; i++) {\n            final int threadId = i;\n            executorService.submit(() -> {\n                try {\n                    for (int j = 0; j < messagesPerThread; j++) {\n                        String message = String.format("Thread-%d-Message-%d", threadId, j);\n                        kafkaTemplate.send("stress-test-topic", String.valueOf(j), message);\n                    }\n                } finally {\n                    latch.countDown();\n                }\n            });\n        }\n        \n        try {\n            latch.await(5, TimeUnit.MINUTES);\n            log.info("\u9AD8\u5E76\u53D1\u5199\u5165\u6D4B\u8BD5\u5B8C\u6210");\n        } catch (InterruptedException e) {\n            Thread.currentThread().interrupt();\n        }\n    }\n    \n    private void runLargeMessageTest() {\n        log.info("\u573A\u666F2\uFF1A\u5927\u6D88\u606F\u5904\u7406\u6D4B\u8BD5");\n        \n        int[] messageSizes = {1024, 10240, 102400, 1048576}; // 1KB, 10KB, 100KB, 1MB\n        \n        for (int size : messageSizes) {\n            String largeMessage = generateLargeMessage(size);\n            long startTime = System.currentTimeMillis();\n            \n            kafkaTemplate.send("large-message-topic", "large-message", largeMessage);\n            \n            long endTime = System.currentTimeMillis();\n            log.info("\u5927\u6D88\u606F\u6D4B\u8BD5\u5B8C\u6210: size={} bytes, time={} ms", \n                size, endTime - startTime);\n        }\n    }\n    \n    private void runLongRunningTest() {\n        log.info("\u573A\u666F3\uFF1A\u957F\u65F6\u95F4\u8FD0\u884C\u6D4B\u8BD5");\n        \n        long startTime = System.currentTimeMillis();\n        long endTime = startTime + TimeUnit.HOURS.toMillis(1); // \u8FD0\u884C1\u5C0F\u65F6\n        \n        int messageCount = 0;\n        while (System.currentTimeMillis() < endTime) {\n            String message = String.format("LongRunning-Message-%d", messageCount++);\n            kafkaTemplate.send("long-running-topic", String.valueOf(messageCount), message);\n            \n            if (messageCount % 1000 == 0) {\n                log.info("\u957F\u65F6\u95F4\u8FD0\u884C\u6D4B\u8BD5: \u5DF2\u53D1\u9001 {} \u6761\u6D88\u606F", messageCount);\n            }\n            \n            try {\n                Thread.sleep(10); // 10ms\u95F4\u9694\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt();\n                break;\n            }\n        }\n        \n        log.info("\u957F\u65F6\u95F4\u8FD0\u884C\u6D4B\u8BD5\u5B8C\u6210: \u603B\u5171\u53D1\u9001 {} \u6761\u6D88\u606F", messageCount);\n    }\n    \n    private void runFailureRecoveryTest() {\n        log.info("\u573A\u666F4\uFF1A\u6545\u969C\u6062\u590D\u6D4B\u8BD5");\n        \n        // \u6A21\u62DF\u7F51\u7EDC\u4E2D\u65AD\n        simulateNetworkFailure();\n        \n        // \u6A21\u62DFBroker\u91CD\u542F\n        simulateBrokerRestart();\n        \n        // \u6A21\u62DF\u6D88\u8D39\u8005\u91CD\u542F\n        simulateConsumerRestart();\n        \n        log.info("\u6545\u969C\u6062\u590D\u6D4B\u8BD5\u5B8C\u6210");\n    }\n    \n    private String generateLargeMessage(int size) {\n        StringBuilder sb = new StringBuilder();\n        for (int i = 0; i < size; i++) {\n            sb.append(\'A\');\n        }\n        return sb.toString();\n    }\n    \n    private void simulateNetworkFailure() {\n        // \u5B9E\u9645\u5B9E\u73B0\u4E2D\u9700\u8981\u6A21\u62DF\u7F51\u7EDC\u6545\u969C\n        log.info("\u6A21\u62DF\u7F51\u7EDC\u6545\u969C...");\n    }\n    \n    private void simulateBrokerRestart() {\n        // \u5B9E\u9645\u5B9E\u73B0\u4E2D\u9700\u8981\u91CD\u542FBroker\n        log.info("\u6A21\u62DFBroker\u91CD\u542F...");\n    }\n    \n    private void simulateConsumerRestart() {\n        // \u5B9E\u9645\u5B9E\u73B0\u4E2D\u9700\u8981\u91CD\u542F\u6D88\u8D39\u8005\n        log.info("\u6A21\u62DF\u6D88\u8D39\u8005\u91CD\u542F...");\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"8-kafka\u6700\u4F73\u5B9E\u8DF5\u4E0E\u603B\u7ED3",children:"8. Kafka\u6700\u4F73\u5B9E\u8DF5\u4E0E\u603B\u7ED3"}),"\n",(0,i.jsx)(e.h3,{id:"81-\u8BBE\u8BA1\u539F\u5219\u4E0E\u6700\u4F73\u5B9E\u8DF5",children:"8.1 \u8BBE\u8BA1\u539F\u5219\u4E0E\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u67B6\u6784\u8BBE\u8BA1\u539F\u5219"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5408\u7406\u89C4\u5212\u5206\u533A\u6570"}),"\uFF1A\u6839\u636E\u5E76\u53D1\u9700\u6C42\u548C\u6570\u636E\u91CF\u8BBE\u7F6E\u5206\u533A\u6570"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u9009\u62E9\u5408\u9002\u526F\u672C\u56E0\u5B50"}),"\uFF1A\u5E73\u8861\u53EF\u9760\u6027\u548C\u5B58\u50A8\u6210\u672C"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8BBE\u8BA1\u5408\u7406\u7684Topic\u7ED3\u6784"}),"\uFF1A\u6309\u4E1A\u52A1\u57DF\u548C\u6570\u636E\u7C7B\u578B\u5212\u5206"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8003\u8651\u6570\u636E\u4FDD\u7559\u7B56\u7565"}),"\uFF1A\u6839\u636E\u4E1A\u52A1\u9700\u6C42\u8BBE\u7F6E\u4FDD\u7559\u65F6\u95F4\u548C\u5927\u5C0F"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u6027\u80FD\u4F18\u5316\u539F\u5219"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6279\u91CF\u5904\u7406\u4F18\u5148"}),"\uFF1A\u4F7F\u7528\u6279\u91CF\u53D1\u9001\u548C\u6D88\u8D39\u63D0\u9AD8\u541E\u5410\u91CF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5F02\u6B65\u64CD\u4F5C\u4F18\u5148"}),"\uFF1A\u4F18\u5148\u4F7F\u7528\u5F02\u6B65API\u51CF\u5C11\u5EF6\u8FDF"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5408\u7406\u4F7F\u7528\u538B\u7F29"}),"\uFF1A\u9009\u62E9\u5408\u9002\u7684\u538B\u7F29\u7B97\u6CD5\u5E73\u8861CPU\u548C\u7F51\u7EDC"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u76D1\u63A7\u9A71\u52A8\u4F18\u5316"}),"\uFF1A\u57FA\u4E8E\u76D1\u63A7\u6570\u636E\u8FDB\u884C\u9488\u5BF9\u6027\u4F18\u5316"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u53EF\u9760\u6027\u4FDD\u8BC1\u539F\u5219"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u591A\u526F\u672C\u5197\u4F59"}),"\uFF1A\u4F7F\u7528\u591A\u526F\u672C\u4FDD\u8BC1\u6570\u636E\u5B89\u5168"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4F18\u96C5\u964D\u7EA7"}),"\uFF1A\u8BBE\u8BA1\u964D\u7EA7\u7B56\u7565\u5E94\u5BF9\u5F02\u5E38\u60C5\u51B5"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5B8C\u5584\u76D1\u63A7"}),"\uFF1A\u5EFA\u7ACB\u5B8C\u6574\u7684\u76D1\u63A7\u548C\u544A\u8B66\u4F53\u7CFB"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5B9A\u671F\u6F14\u7EC3"}),"\uFF1A\u5B9A\u671F\u8FDB\u884C\u6545\u969C\u6F14\u7EC3\u548C\u6062\u590D\u6D4B\u8BD5"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"72-\u6280\u672F\u9009\u578B\u5EFA\u8BAE",children:"7.2 \u6280\u672F\u9009\u578B\u5EFA\u8BAE"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Kafka\u9002\u7528\u573A\u666F"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u9AD8\u541E\u5410\u91CF\u7684\u5B9E\u65F6\u6570\u636E\u7BA1\u9053"}),"\n",(0,i.jsx)(e.li,{children:"\u4E8B\u4EF6\u9A71\u52A8\u67B6\u6784\u7684\u6D88\u606F\u4E2D\u95F4\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:"\u5927\u6570\u636E\u5E73\u53F0\u7684\u6570\u636E\u6536\u96C6"}),"\n",(0,i.jsx)(e.li,{children:"\u5FAE\u670D\u52A1\u95F4\u7684\u5F02\u6B65\u901A\u4FE1"}),"\n",(0,i.jsx)(e.li,{children:"\u65E5\u5FD7\u805A\u5408\u548C\u76D1\u63A7\u6570\u636E\u6536\u96C6"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4E0E\u5176\u4ED6\u6D88\u606F\u961F\u5217\u5BF9\u6BD4"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"Kafka"}),(0,i.jsx)(e.th,{children:"RabbitMQ"}),(0,i.jsx)(e.th,{children:"RocketMQ"}),(0,i.jsx)(e.th,{children:"ActiveMQ"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u541E\u5410\u91CF"})}),(0,i.jsx)(e.td,{children:"\u6781\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5EF6\u8FDF"})}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u53EF\u9760\u6027"})}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u6269\u5C55\u6027"})}),(0,i.jsx)(e.td,{children:"\u4F18\u79C0"}),(0,i.jsx)(e.td,{children:"\u826F\u597D"}),(0,i.jsx)(e.td,{children:"\u4F18\u79C0"}),(0,i.jsx)(e.td,{children:"\u4E00\u822C"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u8FD0\u7EF4\u590D\u6742\u5EA6"})}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u4F4E"}),(0,i.jsx)(e.td,{children:"\u9AD8"}),(0,i.jsx)(e.td,{children:"\u4F4E"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u751F\u6001\u7CFB\u7EDF"})}),(0,i.jsx)(e.td,{children:"\u4E30\u5BCC"}),(0,i.jsx)(e.td,{children:"\u4E30\u5BCC"}),(0,i.jsx)(e.td,{children:"\u4E2D\u7B49"}),(0,i.jsx)(e.td,{children:"\u4E30\u5BCC"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"73-\u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE",children:"7.3 \u5B66\u4E60\u8DEF\u5F84\u5EFA\u8BAE"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u57FA\u7840\u9636\u6BB5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u7406\u89E3Kafka\u6838\u5FC3\u6982\u5FF5\u548C\u67B6\u6784"}),"\n",(0,i.jsx)(e.li,{children:"\u638C\u63E1\u57FA\u672C\u7684\u751F\u4EA7\u8005\u548C\u6D88\u8D39\u8005API"}),"\n",(0,i.jsx)(e.li,{children:"\u5B66\u4E60Topic\u548C\u5206\u533A\u7684\u8BBE\u8BA1\u539F\u5219"}),"\n",(0,i.jsx)(e.li,{children:"\u4E86\u89E3\u526F\u672C\u673A\u5236\u548C\u4E00\u81F4\u6027\u4FDD\u8BC1"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u8FDB\u9636\u9636\u6BB5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6DF1\u5165\u5B66\u4E60Kafka Streams\u6D41\u5904\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u638C\u63E1\u6027\u80FD\u4F18\u5316\u548C\u8C03\u4F18\u6280\u5DE7"}),"\n",(0,i.jsx)(e.li,{children:"\u5B66\u4E60\u96C6\u7FA4\u90E8\u7F72\u548C\u8FD0\u7EF4\u7BA1\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u4E86\u89E3\u76D1\u63A7\u548C\u6545\u969C\u6392\u67E5\u65B9\u6CD5"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9AD8\u7EA7\u9636\u6BB5"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u7814\u7A76Kafka\u6E90\u7801\u548C\u5B9E\u73B0\u539F\u7406"}),"\n",(0,i.jsx)(e.li,{children:"\u8BBE\u8BA1\u5927\u89C4\u6A21\u5206\u5E03\u5F0F\u6D88\u606F\u7CFB\u7EDF"}),"\n",(0,i.jsx)(e.li,{children:"\u53C2\u4E0E\u5F00\u6E90\u793E\u533A\u8D21\u732E\u4EE3\u7801"}),"\n",(0,i.jsx)(e.li,{children:"\u5206\u4EAB\u7ECF\u9A8C\u548C\u6700\u4F73\u5B9E\u8DF5"}),"\n"]}),"\n",(0,i.jsx)(e.admonition,{title:"Kafka\u5B66\u4E60\u5EFA\u8BAE",type:"tip",children:(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7406\u8BBA\u4E0E\u5B9E\u8DF5\u7ED3\u5408"}),"\uFF1A\u5728\u7406\u89E3\u6982\u5FF5\u7684\u57FA\u7840\u4E0A\u591A\u505A\u5B9E\u9645\u9879\u76EE"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5173\u6CE8\u6027\u80FD\u4F18\u5316"}),"\uFF1A\u5B66\u4F1A\u5206\u6790\u548C\u4F18\u5316Kafka\u6027\u80FD"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u638C\u63E1\u8FD0\u7EF4\u6280\u80FD"}),"\uFF1A\u80FD\u591F\u90E8\u7F72\u548C\u7BA1\u7406\u751F\u4EA7\u73AF\u5883\u7684Kafka\u96C6\u7FA4"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u8DDF\u8FDB\u6280\u672F\u53D1\u5C55"}),"\uFF1A\u5173\u6CE8Kafka\u65B0\u7248\u672C\u7279\u6027\u548C\u793E\u533A\u52A8\u6001"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u79EF\u7D2F\u5B9E\u6218\u7ECF\u9A8C"}),"\uFF1A\u901A\u8FC7\u5B9E\u9645\u9879\u76EE\u79EF\u7D2F\u6545\u969C\u6392\u67E5\u548C\u4F18\u5316\u7ECF\u9A8C"]}),"\n"]})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.p,{children:"\u901A\u8FC7\u672C\u7AE0\u7684\u6DF1\u5165\u5B66\u4E60\uFF0C\u4F60\u5E94\u8BE5\u5DF2\u7ECF\u5168\u9762\u638C\u63E1\u4E86Apache Kafka\u7684\u6838\u5FC3\u6982\u5FF5\u3001\u67B6\u6784\u8BBE\u8BA1\u3001\u6027\u80FD\u4F18\u5316\u548C\u5B9E\u6218\u5E94\u7528\u3002Kafka\u4F5C\u4E3A\u73B0\u4EE3\u5927\u6570\u636E\u548C\u5B9E\u65F6\u5904\u7406\u67B6\u6784\u4E2D\u7684\u6838\u5FC3\u7EC4\u4EF6\uFF0C\u5728\u6784\u5EFA\u9AD8\u6027\u80FD\u3001\u9AD8\u53EF\u9760\u7684\u6570\u636E\u7BA1\u9053\u548C\u4E8B\u4EF6\u9A71\u52A8\u7CFB\u7EDF\u4E2D\u53D1\u6325\u7740\u5173\u952E\u4F5C\u7528\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u5408\u7406\u4F7F\u7528Kafka\u4E0D\u4EC5\u80FD\u591F\u5904\u7406\u5927\u89C4\u6A21\u7684\u5B9E\u65F6\u6570\u636E\u6D41\uFF0C\u8FD8\u80FD\u7B80\u5316\u7CFB\u7EDF\u67B6\u6784\uFF0C\u63D0\u9AD8\u5F00\u53D1\u6548\u7387\u3002\u5E0C\u671B\u8FD9\u4EFD\u8BE6\u7EC6\u7684Kafka\u6307\u5357\u80FD\u591F\u5E2E\u52A9\u4F60\u5728\u6280\u672F\u9762\u8BD5\u548C\u5B9E\u9645\u5DE5\u4F5C\u4E2D\u6E38\u5203\u6709\u4F59\uFF0C\u6210\u4E3AKafka\u6280\u672F\u4E13\u5BB6\uFF01"})]})}function g(n={}){let{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(u,{...n})}):u(n)}},57250:function(n,e,t){t.d(e,{A:()=>s});var r=t(74848);t(96540);var i=t(34164);function s({children:n,hidden:e,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.A)("tabItem_Ymn6",t),hidden:e,children:n})}},78010:function(n,e,t){t.d(e,{A:()=>v});var r=t(74848),i=t(96540),s=t(34164),o=t(88287),a=t(28584),c=t(56347),l=t(99989),p=t(96629),d=t(80618),u=t(41367);function g(n){return i.Children.toArray(n).filter(n=>"\n"!==n).map(n=>{if(!n||(0,i.isValidElement)(n)&&function(n){let{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:n,tabValues:e}){return e.some(e=>e.value===n)}var h=t(19863);function f({className:n,block:e,selectedValue:t,selectValue:i,tabValues:o}){let c=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),p=n=>{let e=n.currentTarget,r=o[c.indexOf(e)].value;r!==t&&(l(e),i(r))},d=n=>{let e=null;switch(n.key){case"Enter":p(n);break;case"ArrowRight":{let t=c.indexOf(n.currentTarget)+1;e=c[t]??c[0];break}case"ArrowLeft":{let t=c.indexOf(n.currentTarget)-1;e=c[t]??c[c.length-1]}}e?.focus()};return(0,r.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":e},n),children:o.map(({value:n,label:e,attributes:i})=>(0,r.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:n=>{c.push(n)},onKeyDown:d,onClick:p,...i,className:(0,s.A)("tabs__item","tabItem_LNqP",i?.className,{"tabs__item--active":t===n}),children:e??n},n))})}function S({lazy:n,children:e,selectedValue:t}){let o=(Array.isArray(e)?e:[e]).filter(Boolean);if(n){let n=o.find(n=>n.props.value===t);return n?(0,i.cloneElement)(n,{className:(0,s.A)("margin-top--md",n.props.className)}):null}return(0,r.jsx)("div",{className:"margin-top--md",children:o.map((n,e)=>(0,i.cloneElement)(n,{key:e,hidden:n.props.value!==t}))})}function x(n){let e=function(n){let e,{defaultValue:t,queryString:r=!1,groupId:s}=n,o=function(n){let{values:e,children:t}=n;return(0,i.useMemo)(()=>{let n=e??g(t).map(({props:{value:n,label:e,attributes:t,default:r}})=>({value:n,label:e,attributes:t,default:r})),r=(0,d.XI)(n,(n,e)=>n.value===e.value);if(r.length>0)throw Error(`Docusaurus error: Duplicate values "${r.map(n=>n.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return n},[e,t])}(n),[a,h]=(0,i.useState)(()=>(function({defaultValue:n,tabValues:e}){if(0===e.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:e}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${e.map(n=>n.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let t=e.find(n=>n.default)??e[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:t,tabValues:o})),[f,S]=function({queryString:n=!1,groupId:e}){let t=(0,c.W6)(),r=function({queryString:n=!1,groupId:e}){if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!e)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return e??null}({queryString:n,groupId:e});return[(0,p.aZ)(r),(0,i.useCallback)(n=>{if(!r)return;let e=new URLSearchParams(t.location.search);e.set(r,n),t.replace({...t.location,search:e.toString()})},[r,t])]}({queryString:r,groupId:s}),[x,v]=function({groupId:n}){let e=n?`docusaurus.tab.${n}`:null,[t,r]=(0,u.Dv)(e);return[t,(0,i.useCallback)(n=>{e&&r.set(n)},[e,r])]}({groupId:s}),C=m({value:e=f??x,tabValues:o})?e:null;return(0,l.A)(()=>{C&&h(C)},[C]),{selectedValue:a,selectValue:(0,i.useCallback)(n=>{if(!m({value:n,tabValues:o}))throw Error(`Can't select invalid tab value=${n}`);h(n),S(n),v(n)},[S,v,o]),tabValues:o}}(n);return(0,r.jsxs)("div",{className:(0,s.A)(o.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,r.jsx)(f,{...e,...n}),(0,r.jsx)(S,{...e,...n})]})}function v(n){let e=(0,h.A)();return(0,r.jsx)(x,{...n,children:g(n.children)},String(e))}},67810:function(n,e,t){t.d(e,{A:()=>s});var r=t(83941),i=t(61022);function s(){let{prism:n}=(0,i.p)(),{colorMode:e}=(0,r.G)(),t=n.theme,s=n.darkTheme||t;return"dark"===e?s:t}},25591:function(n,e,t){t.d(e,{A:()=>g});var r=t(74848),i=t(96540),s=t(34164),o=t(71765),a=t(33436),c=t(61022),l=t(67810);let p="codeDot_PWGG",d="langIcon_gX7_",u="copyButtonIcon_f_OW",g=function({children:n,className:e,metastring:t,title:g}){let m,h,[f,S]=(0,i.useState)(!1),[x,v]=(0,i.useState)(!1),C=(0,i.useRef)(null),y=(0,i.useRef)(null),b=(0,i.useRef)(null),{prism:k}=(0,c.p)(),j=(0,l.A)();(0,i.useEffect)(()=>{v(!0)},[]),(0,i.useEffect)(()=>{let n;if(!b.current)return;let e=document.createElement("canvas"),t=document.createElement("div");t.className="matrixContainer_iCb4",t.appendChild(e),b.current.prepend(t);let r=e.getContext("2d"),i=()=>{let n=b.current.getBoundingClientRect();e.width=n.width,e.height=n.height};i(),window.addEventListener("resize",i);let s=()=>"dark"===document.documentElement.getAttribute("data-theme"),o=()=>{let n=(s(),15),t=Math.floor(e.width/n);return{fontSize:n,columns:t}},{fontSize:a,columns:c}=o(),l=[];for(let n=0;n<c;n++)l[n]=Math.floor(Math.random()*e.height/a);let p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789labylabylaby",d=()=>{let t=c;if({fontSize:a,columns:c}=o(),c!==t)for(let n=0;n<c;n++)n<t||(l[n]=Math.floor(Math.random()*e.height/a));s()?r.fillStyle="rgba(0, 0, 0, 0.05)":r.fillStyle="rgba(255, 255, 255, 0.05)",r.fillRect(0,0,e.width,e.height),s()?r.fillStyle="#0F0":r.fillStyle="rgba(0, 80, 0, 0.8)",r.font=`${a}px 'Courier New', monospace`,r.textBaseline="top";for(let n=0;n<l.length;n++){let t=p[Math.floor(Math.random()*p.length)];r.fillText(t,n*a,l[n]*a),l[n]*a>e.height&&Math.random()>.975&&(l[n]=0),Math.random()>.6&&l[n]++}n=setTimeout(()=>requestAnimationFrame(d),70)};d();let u=new MutationObserver(n=>{n.forEach(n=>{"data-theme"===n.attributeName&&r.clearRect(0,0,e.width,e.height)})});return u.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>{u.disconnect(),window.removeEventListener("resize",i),clearTimeout(n),cancelAnimationFrame(n)}},[x]);let T=e&&(/language-(\w+)/.exec(e)||["","text"])[1],E=g||(t&&t.match(/title="([^"]+)"/))?.[1]||"";return(0,r.jsxs)("div",{className:(0,s.A)("codeBlockContainer_X7hc",T&&`language-${T}`),ref:y,children:[(0,r.jsxs)("div",{className:"codeBlockHeader_viex",children:[(0,r.jsxs)("div",{className:"codeBlockControls_mxj2",children:[(0,r.jsx)("span",{className:(0,s.A)(p,"codeDotRed_ANoD")}),(0,r.jsx)("span",{className:(0,s.A)(p,"codeDotYellow_HH1J")}),(0,r.jsx)("span",{className:(0,s.A)(p,"codeDotGreen_RM6U")})]}),E&&(0,r.jsx)("div",{className:"codeBlockTitle_B2tn",children:E}),(0,r.jsxs)("div",{className:"codeBlockMeta_lRk3",children:[T&&(0,r.jsxs)("div",{className:"codeBlockLanguage_Vqu6",children:[(m={javascript:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM243.8 381.4c0 43.6-25.6 63.5-62.9 63.5-33.7 0-53.2-17.4-63.2-38.5l34.3-20.7c6.6 11.7 12.6 21.6 27.1 21.6 13.8 0 22.6-5.4 22.6-26.5V237.7h42.1v143.7zm99.6 63.5c-39.1 0-64.4-18.6-76.7-43l34.3-19.8c9 14.7 20.8 25.6 41.5 25.6 17.4 0 28.6-8.7 28.6-20.8 0-14.4-11.4-19.5-30.7-28l-10.5-4.5c-30.4-12.9-50.5-29.2-50.5-63.5 0-31.6 24.1-55.6 61.6-55.6 26.8 0 46 9.3 59.8 33.7L368 290c-7.2-12.9-15-18-27.1-18-12.3 0-20.1 7.8-20.1 18 0 12.6 7.8 17.7 25.9 25.6l10.5 4.5c35.8 15.3 55.9 31 55.9 66.2 0 37.8-29.8 58.6-69.7 58.6z"})}),jsx:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M418.2 177.2c-5.4-1.8-10.8-3.5-16.2-5.1.9-3.7 1.7-7.4 2.5-11.1 12.3-59.6 4.2-107.5-23.1-123.3-26.3-15.1-69.2.6-112.6 38.4-4.3 3.7-8.5 7.6-12.5 11.5-2.7-2.6-5.5-5.2-8.3-7.7-45.5-40.4-91.1-57.4-118.4-41.5-26.2 15.2-34 60.3-23 116.7 1.1 5.6 2.3 11.1 3.7 16.7-6.4 1.8-12.7 3.8-18.6 5.9C38.3 196.2 0 225.4 0 255.6c0 31.2 40.8 62.5 96.3 81.5 4.5 1.5 9 3 13.6 4.3-1.5 6-2.8 11.9-4 18-10.5 55.5-2.3 99.5 23.9 114.6 27 15.6 72.4-.4 116.6-39.1 3.5-3.1 7-6.3 10.5-9.7 4.4 4.3 9 8.4 13.6 12.4 42.8 36.8 85.1 51.7 111.2 36.6 27-15.6 35.8-62.9 24.4-120.5-.9-4.4-1.9-8.9-3-13.5 3.2-.9 6.3-1.9 9.4-2.9 57.7-19.1 99.5-50 99.5-81.7 0-30.3-39.4-59.7-93.8-78.4zM282.9 92.3c37.2-32.4 71.9-45.1 87.7-36 16.9 9.7 23.4 48.9 12.8 100.4-.7 3.4-1.4 6.7-2.3 10-22.2-5-44.7-8.6-67.3-10.6-13-18.6-27.2-36.4-42.6-53.1 3.9-3.7 7.7-7.2 11.7-10.7zM167.2 307.5c5.1 8.7 10.3 17.4 15.8 25.9-15.6-1.7-31.1-4.2-46.4-7.5 4.4-14.4 9.9-29.3 16.3-44.5 4.6 8.8 9.3 17.5 14.3 26.1zm-30.3-120.3c14.4-3.2 29.7-5.8 45.6-7.8-5.3 8.3-10.5 16.8-15.4 25.4-4.9 8.5-9.7 17.2-14.2 26-6.3-14.9-11.6-29.5-16-43.6zm27.4 68.9c6.6-13.8 13.8-27.3 21.4-40.6s15.8-26.2 24.4-38.9c15-1.1 30.3-1.7 45.9-1.7s31 .6 45.9 1.7c8.5 12.6 16.6 25.5 24.3 38.7s14.9 26.7 21.7 40.4c-6.7 13.8-13.9 27.4-21.6 40.8-7.6 13.3-15.7 26.2-24.2 39-14.9 1.1-30.4 1.6-46.1 1.6s-30.9-.5-45.6-1.4c-8.7-12.7-16.9-25.7-24.6-39s-14.8-26.8-21.5-40.6zm180.6 51.2c5.1-8.8 9.9-17.7 14.6-26.7 6.4 14.5 12 29.2 16.9 44.3-15.5 3.5-31.2 6.2-47 8 5.4-8.4 10.5-17 15.5-25.6zm14.4-76.5c-4.7-8.8-9.5-17.6-14.5-26.2-4.9-8.5-10-16.9-15.3-25.2 16.1 2 31.5 4.7 45.9 8-4.6 14.8-10 29.2-16.1 43.4zM256.2 118.3c10.5 11.4 20.4 23.4 29.6 35.8-19.8-.9-39.7-.9-59.5 0 9.8-12.9 19.9-24.9 29.9-35.8zM140.2 57c16.8-9.8 54.1 4.2 93.4 39 2.5 2.2 5 4.6 7.6 7-15.5 16.7-29.8 34.5-42.9 53.1-22.6 2-45 5.5-67.2 10.4-1.3-5.1-2.4-10.3-3.5-15.5-9.4-48.4-3.2-84.9 12.6-94zm-24.5 263.6c-4.2-1.2-8.3-2.5-12.4-3.9-21.3-6.7-45.5-17.3-63-31.2-10.1-7-16.9-17.8-18.8-29.9 0-18.3 31.6-41.7 77.2-57.6 5.7-2 11.5-3.8 17.3-5.5 6.8 21.7 15 43 24.5 63.6-9.6 20.9-17.9 42.5-24.8 64.5zm116.6 98c-16.5 15.1-35.6 27.1-56.4 35.3-11.1 5.3-23.9 5.8-35.3 1.3-15.9-9.2-22.5-44.5-13.5-92 1.1-5.6 2.3-11.2 3.7-16.7 22.4 4.8 45 8.1 67.9 9.8 13.2 18.7 27.7 36.6 43.2 53.4-3.2 3.1-6.4 6.1-9.6 8.9zm24.5-24.3c-10.2-11-20.4-23.2-30.3-36.3 9.6.4 19.5.6 29.5.6 10.3 0 20.4-.2 30.4-.7-9.2 12.7-19.1 24.8-29.6 36.4zm130.7 30c-.9 12.2-6.9 23.6-16.5 31.3-15.9 9.2-49.8-2.8-86.4-34.2-4.2-3.6-8.4-7.5-12.7-11.5 15.3-16.9 29.4-34.8 42.2-53.6 22.9-1.9 45.7-5.4 68.2-10.5 1 4.1 1.9 8.2 2.7 12.2 4.9 21.6 5.7 44.1 2.5 66.3zm18.2-107.5c-2.8.9-5.6 1.8-8.5 2.6-7-21.8-15.6-43.1-25.5-63.8 9.6-20.4 17.7-41.4 24.5-62.9 5.2 1.5 10.2 3.1 15 4.7 46.6 16 79.3 39.8 79.3 58 0 19.6-34.9 44.9-84.8 61.4zm-149.7-15c25.3 0 45.8-20.5 45.8-45.8s-20.5-45.8-45.8-45.8c-25.3 0-45.8 20.5-45.8 45.8s20.5 45.8 45.8 45.8z"})}),typescript:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",className:d,children:[(0,r.jsx)("path",{fill:"currentColor",d:"M233.277 177.622h-82.44v156.756h32.967v-58.743h49.472c39.168 0 71.15-26.284 71.15-49.006.001-22.729-31.981-49.007-71.15-49.007zm-3.533 66.293H183.71v-33.496h46.034c17.392 0 31.407 7.41 31.407 16.747.001 9.341-14.014 16.75-31.407 16.75zm212.408-66.293v32.965h-33.403v123.79h-32.973v-123.79h-33.405v-32.966h99.781z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M512 256.001c0 141.395-114.606 255.996-255.996 255.996C114.606 511.997 0 397.396 0 256.001 0 114.606 114.606 0 256.004 0 397.394 0 512 114.606 512 256.001z",opacity:".1"})]}),css:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"})}),html:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L191.5 480l157.6-52.2L384 32H0zm308.2 127.9H124.4l4.1 49.4h175.6l-13.6 148.4-97.9 27v.3h-1.1l-98.7-27.3-6-75.8h47.7L138 320l53.5 14.5 53.7-14.5 6-62.2H84.3L71.5 112.2h241.1l-4.4 47.7z"})}),java:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M277.74 312.9c9.8-6.7 23.4-12.5 23.4-12.5s-38.7 7-77.2 10.2c-47.1 3.9-97.7 4.7-123.1 1.3-60.1-8 33-30.1 33-30.1s-36.1-2.4-80.6 19c-52.5 25.4 130 37 224.5 12.1zm-85.4-32.1c-19-42.7-83.1-80.2 0-145.8C296 45.2 242.8 8.1 242.8 8.1s12.7 50.9-23.5 79.4c-60.3 47.5-78.2-12.6-78.2-12.6-117.2 68.1 38.4 69.6 51.3 93.4 22.9 41.5-40.2 104.8-80.4 93.7-9-2.5 5.2 9.6 19.5 19.4 20.8 14.3 76.1 20.5 116.2-2.8 31.3-18.1-11.7-53.8-23.5-70.7zM381 261.1c-15.6-5.9-37.8-6.6-37.8-6.6s9.4-28.4-37.3-42.3c-94.4-28.3-189 11.5-189 11.5s52.9 47.3 138.2 35c16.6-2.4 51-13.1 51-13.1s-23.8 6.1-32.7 12.1c-223.1 62.2-75.6-7.5-75.6-7.5s19 10.7 50.9 12.8c116.2 8.1 117.1-35.9 132.3-2.9zM239 64.7c-56.6 19.6-49.4 42.6-49.4 42.6 49.3-32 121.4-22.3 121.4-22.3s-23.1-10.1-72 -20.3zm-99.6 23.6c27.8-15.7 49.9-8 49.9-8s-28.6-15.9-60.4-7.6c-21.1 5.6-14.8 23.7-14.8 23.7s5-9.4 25.3-8.1zm146.4 44.6c-39.4 13-43.6 61.5-43.6 61.5s75-36.4 43.6-61.5z"})}),python:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"})}),bash:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"})}),json:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"})}),yaml:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"})}),markdown:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 208 128",className:d,children:[(0,r.jsx)("rect",{width:"198",height:"118",x:"5",y:"5",ry:"10",stroke:"currentColor",strokeWidth:"10",fill:"none"}),(0,r.jsx)("path",{d:"M30 98V30h20l20 25 20-25h20v68H90V59L70 84 50 59v39zm125 0l-30-33h20V30h20v35h20z",fill:"currentColor"})]}),sql:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"})})},h=(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",className:d,children:(0,r.jsx)("path",{fill:"currentColor",d:"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"})}),m["string"==typeof T&&T?T.toLowerCase():""]||h),(0,r.jsx)("span",{children:T})]}),(0,r.jsx)("button",{ref:C,type:"button","aria-label":"\u590D\u5236\u4EE3\u7801",className:"copyButton_H_xL",onClick:()=>{if(y.current){let n=y.current.textContent;(0,a.A)(n),S(!0),setTimeout(()=>{S(!1)},2e3)}},children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:u,children:(0,r.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"})}),(0,r.jsx)("span",{children:"\u5DF2\u590D\u5236"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:u,children:(0,r.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"})}),(0,r.jsx)("span",{children:"\u590D\u5236"})]})})]})]}),(0,r.jsx)("div",{className:"codeBlockContent_vqWU",ref:b,children:(0,r.jsx)(o.f4,{code:n.trim(),language:T||"text",theme:j,children:({className:n,style:e,tokens:t,getLineProps:i,getTokenProps:o})=>(0,r.jsx)("pre",{className:(0,s.A)(n,"codeBlock_wPnj"),style:e,children:(0,r.jsx)("code",{className:"codeBlockLines_fQUY",children:t.map((n,e)=>{1===n.length&&"\n"===n[0].content&&(n[0].content="");let{key:t,...a}=i({line:n,key:e});return(0,r.jsxs)("div",{...a,className:(0,s.A)(a.className,"codeLine_fSta"),children:[(0,r.jsx)("span",{className:"codeLineNumber_x9bH",children:e+1}),(0,r.jsx)("span",{className:"codeLineContent_HA3z",children:n.map((n,e)=>{let{key:t,...i}=o({token:n,key:e});return(0,r.jsx)("span",{...i},t||e)})})]},t||e)})})})})})]})}},28453:function(n,e,t){t.d(e,{R:()=>o,x:()=>a});var r=t(96540);let i={},s=r.createContext(i);function o(n){let e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),r.createElement(s.Provider,{value:e},n.children)}},33436:function(n,e,t){t.d(e,{A:()=>r});function r(n,{target:e=document.body}={}){if("string"!=typeof n)throw TypeError(`Expected parameter \`text\` to be a \`string\`, got \`${typeof n}\`.`);let t=document.createElement("textarea"),i=document.activeElement;t.value=n,t.setAttribute("readonly",""),t.style.all="unset",t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.style.fontSize="12pt",t.style.whiteSpace="pre";let s=document.getSelection(),o=s.rangeCount>0&&s.getRangeAt(0);e.append(t),t.select(),t.selectionStart=0,t.selectionEnd=n.length;let a=!1;try{a=document.execCommand("copy")}catch{}return t.remove(),o&&(s.removeAllRanges(),s.addRange(o)),i&&i.focus(),a}}}]);